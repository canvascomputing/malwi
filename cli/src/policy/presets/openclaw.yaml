version: 1
includes: [base]

# Auto-policy for openclaw (multi-channel AI gateway)
# Customise: ~/.config/malwi/policies/openclaw.yaml
#
# Inherits from base: files, symbols, network deny/warn.
# Custom envvars section (openclaw needs API tokens — warn instead of deny).

nodejs:
  allow:
    - dns.lookup
    - dns.resolve
    - net.connect
    - net.createServer
    - tls.connect
    - fetch
    - "http.request"
    - "https.request"
    - "http.get"
    - "https.get"
    - "http.createServer"
    - "https.createServer"
  deny:
    - eval
    - vm.runInContext
    - vm.runInNewContext
    - vm.compileFunction
    - "child_process.exec"
    - "child_process.execSync"

commands:
  allow:
    # Core runtime
    - node
    - git
    - npm
    - npx
    - pnpm
    - corepack
    # Service management (daemon install/restart)
    - launchctl
    - systemctl
    - schtasks
    # Sandbox containers
    - docker
    # SSH tunnels (remote gateway connections)
    - ssh
    # TLS certificate generation
    - openssl
    # Audio/voice message processing (Discord)
    - ffmpeg
    - ffprobe
    # macOS system info + keychain
    - security
    - sw_vers
    - sysctl
    - scutil
    - defaults
    - lsof
    # Package management
    - brew
    # Google Cloud CLI (Gmail integration)
    - gcloud
    # Windows process control
    - taskkill
  deny:
    # Network tools openclaw never uses (it uses Node.js HTTP)
    - curl
    - wget
    - nc
    - ncat
    - netcat
    - socat
    - telnet
    - scp
    # Interpreters openclaw never spawns
    - "python*"
    - perl
    - ruby
    # Obfuscation / exfiltration
    - base64
    - xxd
    - pbcopy
    - xclip
    # Persistence mechanisms
    - crontab
  warn:
    # openclaw uses PTY shells and shell-env; warn for visibility
    - sh
    - bash
  review:
    # openclaw uses sudo for DNS/coredns setup; prompt user
    - sudo
    - su
    - doas

# Multi-service gateway — allow AI APIs, messaging platforms, local dev.
# Base provides cloud metadata deny + anonymity domain warnings.
network:
  allow:
    - "openclaw.ai/**"
    - "*.openclaw.ai/**"
    - "registry.npmjs.org/**"
    - "*.npmjs.org/**"
    - "github.com/**"
    - "*.githubusercontent.com/**"
    # AI provider APIs
    - "api.anthropic.com/**"
    - "api.openai.com/**"
    # Messaging platforms
    - "slack.com/**"
    - "*.slack.com/**"
    - "api.telegram.org/**"
    - "discord.com/**"
    - "*.discord.com/**"
    - "gateway.discord.gg/**"
    - "graph.facebook.com/**"
    # Local dev
    - "127.0.0.1:*/**"
    - "localhost:*/**"
  protocols: [https, http, wss, ws]

# Openclaw-specific envvar overrides: API tokens are needed, warn instead of deny.
# This overrides base's deny for *TOKEN*/*API_KEY* — child disposition takes priority.
envvars:
  deny:
    - "*SECRET*"
    - "*PASSWORD*"
    - "*PRIVATE_KEY*"
    - "AWS_*"
    - "GITHUB_*"
    - "GCP_*"
    - "AZURE_*"
    - DYLD_INSERT_LIBRARIES
    - LD_PRELOAD
  warn:
    # These are in base's deny, but openclaw needs them — warn instead
    - "*TOKEN*"
    - "*API_KEY*"
    - "OPENAI_*"
    - "ANTHROPIC_*"
    - "CLAUDE_*"
    - "OPENCLAW_*"
    - HF_TOKEN
