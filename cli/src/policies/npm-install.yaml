version: 1
includes: [base]

# Auto-policy for npm install / add / ci
# Customise: ~/.config/malwi/policies/npm-install.yaml
#
# Inherits from base: files, envvars, symbols, network deny/warn.
# Only policy-specific overrides below.

nodejs:
  allow:
    - dns.lookup
    - dns.resolve
    - net.connect
    - tls.connect
    - fetch
    - "http.request"
    - "https.request"
    - "http.get"
    - "https.get"
  deny:
    - eval
    - vm.runInContext
    - vm.runInNewContext

commands:
  allow:
    - node
    - sh
    - bash
    - git
  deny:
    # HTTP clients — npm should use its own registry client, not shell out to curl
    - curl
    - wget
    # Remote access — no legitimate reason for npm scripts to open SSH sessions
    - ssh
    # Raw networking — can open arbitrary TCP/UDP connections, reverse shells
    - nc
    - ncat
    # Privilege escalation — npm scripts should never need root
    - "*sudo*"
    # Interpreters — prevent proxy execution attacks via other runtimes
    - "python*"
    - perl
    - ruby

# npm registry only — other domains blocked by default (base denies metadata + .onion)
network:
  allow:
    - "registry.npmjs.org/**"
    - "*.npmjs.org/**"
