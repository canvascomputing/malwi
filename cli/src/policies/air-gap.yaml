version: 1
includes: [base]

# Air-gap policy — total network isolation.
# No outbound connections of any kind.
# Use: malwi x --policy air-gap -- <command>
# Customise: ~/.config/malwi/policies/air-gap.yaml
#
# Inherits from base: files, envvars, command warnings.
# Overrides symbols with extended networking block list.

# Block ALL network access.
network:
  deny:
    - "*"        # all domains
    - "*/**"     # all URLs
    - "*:*"      # all endpoints

# Block network-capable commands, privilege escalation, and network config.
# Base already warns on many threats; this policy denies the worst offenders.
commands:
  deny:
    # HTTP/download tools — primary data exfiltration vectors
    - curl
    - wget
    - aria2c          # download manager with RPC interface
    # Remote access / file transfer — can establish outbound connections
    - ssh
    - scp
    - sftp
    - ftp
    - rsync           # bidirectional file sync, can exfil over SSH
    # Raw networking — can open arbitrary TCP/UDP connections, reverse shells
    - nc
    - ncat
    - netcat
    - socat
    - telnet
    - openssl         # encrypted channel: openssl s_client -connect host:443
    # Network reconnaissance — can probe internal/external hosts
    - nmap
    - ping            # ICMP echo (can also encode data in ICMP payloads)
    - ping6
    - traceroute
    - tracepath
    # DNS tools — can exfiltrate data via DNS queries
    - dig
    - nslookup
    - host
    # Privilege escalation — can reconfigure network settings
    - sudo
    - su
    - doas
    # Network configuration — can create interfaces, routes, firewall rules
    - ip              # configure interfaces, routes (Linux)
    - ifconfig        # configure interfaces (legacy)
    - iptables        # configure firewall rules (Linux)
    - nft             # nftables firewall (Linux)
    - route           # configure routing table
    # Data exfiltration — can stage data for later transfer
    - ditto           # bulk file copy (macOS)
    - zip             # bulk archival

# Block ALL networking at the C level — catches Python socket.connect(),
# Node.js net.connect(), and Bash /dev/tcp regardless of runtime.
# Extends base symbols with full socket API coverage.
symbols:
  deny:
    # Socket creation
    - socket
    # Outbound connections
    - connect
    # Data sending (covers UDP without connect, inherited FDs)
    - sendto
    - send
    # Server binding/listening
    - bind
    - listen
    - accept
    - accept4
    # DNS resolution
    - getaddrinfo
    - gethostbyname
    - gethostbyname2
    # Raw syscall wrapper (blocks syscall(SYS_socket, ...) style bypass)
    - syscall
    # Credential interception (from base policy)
    - getpass
    - crypt
