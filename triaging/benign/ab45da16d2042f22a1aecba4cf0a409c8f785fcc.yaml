statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/quantiumbase/0.8.1/quantiumbase-0.8.1/quantiumbase-0.8.1/quantiumbase/backends/sqlite.py
  contents:
  - name: SQLiteTransaction.start
    score: 0.0
    code: |-
      async def start(
              self, is_root: bool, extra_options: typing.Dict[typing.Any, typing.Any]
          ) -> None:
              assert self._connection._connection is not None, "Connection is not acquired"
              self._is_root = is_root
              if self._is_root:
                  async with self._connection._connection.execute("BEGIN") as cursor:
                      await cursor.close()
              else:
                  id = str(uuid.uuid4()).replace("-", "_")
                  self._savepoint_name = f"STARLETTE_SAVEPOINT_{id}"
                  async with self._connection._connection.execute(
                      f"SAVEPOINT {self._savepoint_name}"
                  ) as cursor:
                      await cursor.close()
    tokens: return_generator pop_top resume load_fast self load_attr _connection load_attr _connection pop_jump_if_not_none TO_NUMBER load_assertion_error load_const STRING_LEN_S_ENT_HIGH call raise_varargs load_fast is_root load_fast self store_attr _is_root load_fast self load_attr _is_root pop_jump_if_false TO_NUMBER load_fast self load_attr _connection load_attr _connection load_attr execute load_const BEGIN call before_async_with get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send store_fast cursor load_fast cursor load_attr close call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top load_const load_const load_const call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top return_const None load_global str load_global uuid load_attr uuid4 call call load_attr replace load_const - load_const _ call store_fast id load_const STRING_LEN_S_ENT_HIGH load_fast id format_value INTEGER build_string load_fast self store_attr _savepoint_name load_fast self load_attr _connection load_attr _connection load_attr execute load_const SAVEPOINT load_fast self load_attr _savepoint_name format_value INTEGER build_string call before_async_with get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send store_fast cursor load_fast cursor load_attr close call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top load_const load_const load_const call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top return_const None cleanup_throw jump_backward TO_NUMBER cleanup_throw jump_backward TO_NUMBER cleanup_throw jump_backward TO_NUMBER push_exc_info with_except_start get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER cleanup_throw end_send pop_jump_if_true TO_NUMBER reraise pop_top pop_except pop_top pop_top return_const None copy pop_except reraise cleanup_throw jump_backward TO_NUMBER cleanup_throw jump_backward TO_NUMBER cleanup_throw jump_backward TO_NUMBER push_exc_info with_except_start get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER cleanup_throw end_send pop_jump_if_true TO_NUMBER reraise pop_top pop_except pop_top pop_top return_const None copy pop_except reraise call_intrinsic_1 INTRINSIC_STOPITERATION_ERROR reraise
    hash: 72ec593cad7e0fecd6f7568f380a10ecf9f7830a63a0b6ba11c0092abe34edfa
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/quantiumbase/0.8.1/quantiumbase-0.8.1/quantiumbase-0.8.1/quantiumbase/backends/sqlite.py
  : aW1wb3J0IGxvZ2dpbmcKaW1wb3J0IHR5cGluZwppbXBvcnQgdXVpZAoKaW1wb3J0IGFpb3NxbGl0ZQpmcm9tIHNxbGFsY2hlbXkuZGlhbGVjdHMuc3FsaXRlIGltcG9ydCBweXNxbGl0ZQpmcm9tIHNxbGFsY2hlbXkuZW5naW5lLmN1cnNvciBpbXBvcnQgQ3Vyc29yUmVzdWx0TWV0YURhdGEKZnJvbSBzcWxhbGNoZW15LmVuZ2luZS5pbnRlcmZhY2VzIGltcG9ydCBEaWFsZWN0LCBFeGVjdXRpb25Db250ZXh0CmZyb20gc3FsYWxjaGVteS5lbmdpbmUucm93IGltcG9ydCBSb3cKZnJvbSBzcWxhbGNoZW15LnNxbCBpbXBvcnQgQ2xhdXNlRWxlbWVudApmcm9tIHNxbGFsY2hlbXkuc3FsLmRkbCBpbXBvcnQgRERMRWxlbWVudAoKZnJvbSBxdWFudGl1bWJhc2UuY29yZSBpbXBvcnQgTE9HX0VYVFJBLCBEYXRhYmFzZVVSTApmcm9tIHF1YW50aXVtYmFzZS5pbnRlcmZhY2VzIGltcG9ydCAoCiAgICBDb25uZWN0aW9uQmFja2VuZCwKICAgIERhdGFiYXNlQmFja2VuZCwKICAgIFJlY29yZCwKICAgIFRyYW5zYWN0aW9uQmFja2VuZCwKKQoKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoInF1YW50aXVtYmFzZSIpCgoKY2xhc3MgU1FMaXRlQmFja2VuZChEYXRhYmFzZUJhY2tlbmQpOgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsIGRhdGFiYXNlX3VybDogdHlwaW5nLlVuaW9uW0RhdGFiYXNlVVJMLCBzdHJdLCAqKm9wdGlvbnM6IHR5cGluZy5BbnkKICAgICkgLT4gTm9uZToKICAgICAgICBzZWxmLl9kYXRhYmFzZV91cmwgPSBEYXRhYmFzZVVSTChkYXRhYmFzZV91cmwpCiAgICAgICAgc2VsZi5fb3B0aW9ucyA9IG9wdGlvbnMKICAgICAgICBzZWxmLl9kaWFsZWN0ID0gcHlzcWxpdGUuZGlhbGVjdChwYXJhbXN0eWxlPSJxbWFyayIpCiAgICAgICAgIyBhaW9zcWxpdGUgZG9lcyBub3Qgc3VwcG9ydCBkZWNpbWFscwogICAgICAgIHNlbGYuX2RpYWxlY3Quc3VwcG9ydHNfbmF0aXZlX2RlY2ltYWwgPSBGYWxzZQogICAgICAgIHNlbGYuX3Bvb2wgPSBTUUxpdGVQb29sKHNlbGYuX2RhdGFiYXNlX3VybCwgKipzZWxmLl9vcHRpb25zKQoKICAgIGFzeW5jIGRlZiBjb25uZWN0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgcGFzcwogICAgICAgICMgYXNzZXJ0IHNlbGYuX3Bvb2wgaXMgTm9uZSwgIkRhdGFiYXNlQmFja2VuZCBpcyBhbHJlYWR5IHJ1bm5pbmciCiAgICAgICAgIyBzZWxmLl9wb29sID0gYXdhaXQgYWlvbXlzcWwuY3JlYXRlX3Bvb2woCiAgICAgICAgIyAgICAgaG9zdD1zZWxmLl9kYXRhYmFzZV91cmwuaG9zdG5hbWUsCiAgICAgICAgIyAgICAgcG9ydD1zZWxmLl9kYXRhYmFzZV91cmwucG9ydCBvciAzMzA2LAogICAgICAgICMgICAgIHVzZXI9c2VsZi5fZGF0YWJhc2VfdXJsLnVzZXJuYW1lIG9yIGdldHBhc3MuZ2V0dXNlcigpLAogICAgICAgICMgICAgIHBhc3N3b3JkPXNlbGYuX2RhdGFiYXNlX3VybC5wYXNzd29yZCwKICAgICAgICAjICAgICBkYj1zZWxmLl9kYXRhYmFzZV91cmwuZGF0YWJhc2UsCiAgICAgICAgIyAgICAgYXV0b2NvbW1pdD1UcnVlLAogICAgICAgICMgKQoKICAgIGFzeW5jIGRlZiBkaXNjb25uZWN0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgcGFzcwogICAgICAgICMgYXNzZXJ0IHNlbGYuX3Bvb2wgaXMgbm90IE5vbmUsICJEYXRhYmFzZUJhY2tlbmQgaXMgbm90IHJ1bm5pbmciCiAgICAgICAgIyBzZWxmLl9wb29sLmNsb3NlKCkKICAgICAgICAjIGF3YWl0IHNlbGYuX3Bvb2wud2FpdF9jbG9zZWQoKQogICAgICAgICMgc2VsZi5fcG9vbCA9IE5vbmUKCiAgICBkZWYgY29ubmVjdGlvbihzZWxmKSAtPiAiU1FMaXRlQ29ubmVjdGlvbiI6CiAgICAgICAgcmV0dXJuIFNRTGl0ZUNvbm5lY3Rpb24oc2VsZi5fcG9vbCwgc2VsZi5fZGlhbGVjdCkKCgpjbGFzcyBTUUxpdGVQb29sOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHVybDogRGF0YWJhc2VVUkwsICoqb3B0aW9uczogdHlwaW5nLkFueSkgLT4gTm9uZToKICAgICAgICBzZWxmLl91cmwgPSB1cmwKICAgICAgICBzZWxmLl9vcHRpb25zID0gb3B0aW9ucwoKICAgIGFzeW5jIGRlZiBhY3F1aXJlKHNlbGYpIC0+IGFpb3NxbGl0ZS5Db25uZWN0aW9uOgogICAgICAgIGNvbm5lY3Rpb24gPSBhaW9zcWxpdGUuY29ubmVjdCgKICAgICAgICAgICAgZGF0YWJhc2U9c2VsZi5fdXJsLmRhdGFiYXNlLCBpc29sYXRpb25fbGV2ZWw9Tm9uZSwgKipzZWxmLl9vcHRpb25zCiAgICAgICAgKQogICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uX19hZW50ZXJfXygpCiAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb24KCiAgICBhc3luYyBkZWYgcmVsZWFzZShzZWxmLCBjb25uZWN0aW9uOiBhaW9zcWxpdGUuQ29ubmVjdGlvbikgLT4gTm9uZToKICAgICAgICBhd2FpdCBjb25uZWN0aW9uLl9fYWV4aXRfXyhOb25lLCBOb25lLCBOb25lKQoKCmNsYXNzIENvbXBpbGF0aW9uQ29udGV4dDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb250ZXh0OiBFeGVjdXRpb25Db250ZXh0KToKICAgICAgICBzZWxmLmNvbnRleHQgPSBjb250ZXh0CgoKY2xhc3MgU1FMaXRlQ29ubmVjdGlvbihDb25uZWN0aW9uQmFja2VuZCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgcG9vbDogU1FMaXRlUG9vbCwgZGlhbGVjdDogRGlhbGVjdCk6CiAgICAgICAgc2VsZi5fcG9vbCA9IHBvb2wKICAgICAgICBzZWxmLl9kaWFsZWN0ID0gZGlhbGVjdAogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBOb25lICAjIHR5cGU6IHR5cGluZy5PcHRpb25hbFthaW9zcWxpdGUuQ29ubmVjdGlvbl0KCiAgICBhc3luYyBkZWYgYWNxdWlyZShzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIE5vbmUsICJDb25uZWN0aW9uIGlzIGFscmVhZHkgYWNxdWlyZWQiCiAgICAgICAgc2VsZi5fY29ubmVjdGlvbiA9IGF3YWl0IHNlbGYuX3Bvb2wuYWNxdWlyZSgpCgogICAgYXN5bmMgZGVmIHJlbGVhc2Uoc2VsZikgLT4gTm9uZToKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbiBpcyBub3QgTm9uZSwgIkNvbm5lY3Rpb24gaXMgbm90IGFjcXVpcmVkIgogICAgICAgIGF3YWl0IHNlbGYuX3Bvb2wucmVsZWFzZShzZWxmLl9jb25uZWN0aW9uKQogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBOb25lCgogICAgYXN5bmMgZGVmIGZldGNoX2FsbChzZWxmLCBxdWVyeTogQ2xhdXNlRWxlbWVudCkgLT4gdHlwaW5nLkxpc3RbUmVjb3JkXToKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbiBpcyBub3QgTm9uZSwgIkNvbm5lY3Rpb24gaXMgbm90IGFjcXVpcmVkIgogICAgICAgIHF1ZXJ5X3N0ciwgYXJncywgY29udGV4dCA9IHNlbGYuX2NvbXBpbGUocXVlcnkpCgogICAgICAgIGFzeW5jIHdpdGggc2VsZi5fY29ubmVjdGlvbi5leGVjdXRlKHF1ZXJ5X3N0ciwgYXJncykgYXMgY3Vyc29yOgogICAgICAgICAgICByb3dzID0gYXdhaXQgY3Vyc29yLmZldGNoYWxsKCkKICAgICAgICAgICAgbWV0YWRhdGEgPSBDdXJzb3JSZXN1bHRNZXRhRGF0YShjb250ZXh0LCBjdXJzb3IuZGVzY3JpcHRpb24pCiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICBSb3coCiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEsCiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuX3Byb2Nlc3NvcnMsCiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuX2tleW1hcCwKICAgICAgICAgICAgICAgICAgICBSb3cuX2RlZmF1bHRfa2V5X3N0eWxlLAogICAgICAgICAgICAgICAgICAgIHJvdywKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGZvciByb3cgaW4gcm93cwogICAgICAgICAgICBdCgogICAgYXN5bmMgZGVmIGZldGNoX29uZShzZWxmLCBxdWVyeTogQ2xhdXNlRWxlbWVudCkgLT4gdHlwaW5nLk9wdGlvbmFsW1JlY29yZF06CiAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUsICJDb25uZWN0aW9uIGlzIG5vdCBhY3F1aXJlZCIKICAgICAgICBxdWVyeV9zdHIsIGFyZ3MsIGNvbnRleHQgPSBzZWxmLl9jb21waWxlKHF1ZXJ5KQoKICAgICAgICBhc3luYyB3aXRoIHNlbGYuX2Nvbm5lY3Rpb24uZXhlY3V0ZShxdWVyeV9zdHIsIGFyZ3MpIGFzIGN1cnNvcjoKICAgICAgICAgICAgcm93ID0gYXdhaXQgY3Vyc29yLmZldGNob25lKCkKICAgICAgICAgICAgaWYgcm93IGlzIE5vbmU6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICBtZXRhZGF0YSA9IEN1cnNvclJlc3VsdE1ldGFEYXRhKGNvbnRleHQsIGN1cnNvci5kZXNjcmlwdGlvbikKICAgICAgICAgICAgcmV0dXJuIFJvdygKICAgICAgICAgICAgICAgIG1ldGFkYXRhLAogICAgICAgICAgICAgICAgbWV0YWRhdGEuX3Byb2Nlc3NvcnMsCiAgICAgICAgICAgICAgICBtZXRhZGF0YS5fa2V5bWFwLAogICAgICAgICAgICAgICAgUm93Ll9kZWZhdWx0X2tleV9zdHlsZSwKICAgICAgICAgICAgICAgIHJvdywKICAgICAgICAgICAgKQoKICAgIGFzeW5jIGRlZiBleGVjdXRlKHNlbGYsIHF1ZXJ5OiBDbGF1c2VFbGVtZW50KSAtPiB0eXBpbmcuQW55OgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgcXVlcnlfc3RyLCBhcmdzLCBjb250ZXh0ID0gc2VsZi5fY29tcGlsZShxdWVyeSkKICAgICAgICBhc3luYyB3aXRoIHNlbGYuX2Nvbm5lY3Rpb24uY3Vyc29yKCkgYXMgY3Vyc29yOgogICAgICAgICAgICBhd2FpdCBjdXJzb3IuZXhlY3V0ZShxdWVyeV9zdHIsIGFyZ3MpCiAgICAgICAgICAgIGlmIGN1cnNvci5sYXN0cm93aWQgPT0gMDoKICAgICAgICAgICAgICAgIHJldHVybiBjdXJzb3Iucm93Y291bnQKICAgICAgICAgICAgcmV0dXJuIGN1cnNvci5sYXN0cm93aWQKCiAgICBhc3luYyBkZWYgZXhlY3V0ZV9tYW55KHNlbGYsIHF1ZXJpZXM6IHR5cGluZy5MaXN0W0NsYXVzZUVsZW1lbnRdKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgZm9yIHNpbmdsZV9xdWVyeSBpbiBxdWVyaWVzOgogICAgICAgICAgICBhd2FpdCBzZWxmLmV4ZWN1dGUoc2luZ2xlX3F1ZXJ5KQoKICAgIGFzeW5jIGRlZiBpdGVyYXRlKAogICAgICAgIHNlbGYsIHF1ZXJ5OiBDbGF1c2VFbGVtZW50CiAgICApIC0+IHR5cGluZy5Bc3luY0dlbmVyYXRvclt0eXBpbmcuQW55LCBOb25lXToKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbiBpcyBub3QgTm9uZSwgIkNvbm5lY3Rpb24gaXMgbm90IGFjcXVpcmVkIgogICAgICAgIHF1ZXJ5X3N0ciwgYXJncywgY29udGV4dCA9IHNlbGYuX2NvbXBpbGUocXVlcnkpCiAgICAgICAgYXN5bmMgd2l0aCBzZWxmLl9jb25uZWN0aW9uLmV4ZWN1dGUocXVlcnlfc3RyLCBhcmdzKSBhcyBjdXJzb3I6CiAgICAgICAgICAgIG1ldGFkYXRhID0gQ3Vyc29yUmVzdWx0TWV0YURhdGEoY29udGV4dCwgY3Vyc29yLmRlc2NyaXB0aW9uKQogICAgICAgICAgICBhc3luYyBmb3Igcm93IGluIGN1cnNvcjoKICAgICAgICAgICAgICAgIHlpZWxkIFJvdygKICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YSwKICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5fcHJvY2Vzc29ycywKICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5fa2V5bWFwLAogICAgICAgICAgICAgICAgICAgIFJvdy5fZGVmYXVsdF9rZXlfc3R5bGUsCiAgICAgICAgICAgICAgICAgICAgcm93LAogICAgICAgICAgICAgICAgKQoKICAgIGRlZiB0cmFuc2FjdGlvbihzZWxmKSAtPiBUcmFuc2FjdGlvbkJhY2tlbmQ6CiAgICAgICAgcmV0dXJuIFNRTGl0ZVRyYW5zYWN0aW9uKHNlbGYpCgogICAgZGVmIF9jb21waWxlKAogICAgICAgIHNlbGYsIHF1ZXJ5OiBDbGF1c2VFbGVtZW50CiAgICApIC0+IHR5cGluZy5UdXBsZVtzdHIsIGxpc3QsIENvbXBpbGF0aW9uQ29udGV4dF06CiAgICAgICAgY29tcGlsZWQgPSBxdWVyeS5jb21waWxlKAogICAgICAgICAgICBkaWFsZWN0PXNlbGYuX2RpYWxlY3QsIGNvbXBpbGVfa3dhcmdzPXsicmVuZGVyX3Bvc3Rjb21waWxlIjogVHJ1ZX0KICAgICAgICApCgogICAgICAgIGV4ZWN1dGlvbl9jb250ZXh0ID0gc2VsZi5fZGlhbGVjdC5leGVjdXRpb25fY3R4X2NscygpCiAgICAgICAgZXhlY3V0aW9uX2NvbnRleHQuZGlhbGVjdCA9IHNlbGYuX2RpYWxlY3QKCiAgICAgICAgYXJncyA9IFtdCgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHF1ZXJ5LCBERExFbGVtZW50KToKICAgICAgICAgICAgcGFyYW1zID0gY29tcGlsZWQuY29uc3RydWN0X3BhcmFtcygpCiAgICAgICAgICAgIGZvciBrZXkgaW4gY29tcGlsZWQucG9zaXRpb250dXA6CiAgICAgICAgICAgICAgICByYXdfdmFsID0gcGFyYW1zW2tleV0KICAgICAgICAgICAgICAgIGlmIGtleSBpbiBjb21waWxlZC5fYmluZF9wcm9jZXNzb3JzOgogICAgICAgICAgICAgICAgICAgIHZhbCA9IGNvbXBpbGVkLl9iaW5kX3Byb2Nlc3NvcnNba2V5XShyYXdfdmFsKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB2YWwgPSByYXdfdmFsCiAgICAgICAgICAgICAgICBhcmdzLmFwcGVuZCh2YWwpCgogICAgICAgICAgICBleGVjdXRpb25fY29udGV4dC5yZXN1bHRfY29sdW1uX3N0cnVjdCA9ICgKICAgICAgICAgICAgICAgIGNvbXBpbGVkLl9yZXN1bHRfY29sdW1ucywKICAgICAgICAgICAgICAgIGNvbXBpbGVkLl9vcmRlcmVkX2NvbHVtbnMsCiAgICAgICAgICAgICAgICBjb21waWxlZC5fdGV4dHVhbF9vcmRlcmVkX2NvbHVtbnMsCiAgICAgICAgICAgICAgICBjb21waWxlZC5fYWRfaG9jX3RleHR1YWwsCiAgICAgICAgICAgICAgICBjb21waWxlZC5fbG9vc2VfY29sdW1uX25hbWVfbWF0Y2hpbmcsCiAgICAgICAgICAgICkKCiAgICAgICAgcXVlcnlfbWVzc2FnZSA9IGNvbXBpbGVkLnN0cmluZy5yZXBsYWNlKCIgXG4iLCAiICIpLnJlcGxhY2UoIlxuIiwgIiAiKQogICAgICAgIGxvZ2dlci5kZWJ1ZygKICAgICAgICAgICAgIlF1ZXJ5OiAlcyBBcmdzOiAlcyIsIHF1ZXJ5X21lc3NhZ2UsIHJlcHIodHVwbGUoYXJncykpLCBleHRyYT1MT0dfRVhUUkEKICAgICAgICApCiAgICAgICAgcmV0dXJuIGNvbXBpbGVkLnN0cmluZywgYXJncywgQ29tcGlsYXRpb25Db250ZXh0KGV4ZWN1dGlvbl9jb250ZXh0KQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHJhd19jb25uZWN0aW9uKHNlbGYpIC0+IGFpb3NxbGl0ZS5jb3JlLkNvbm5lY3Rpb246CiAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUsICJDb25uZWN0aW9uIGlzIG5vdCBhY3F1aXJlZCIKICAgICAgICByZXR1cm4gc2VsZi5fY29ubmVjdGlvbgoKCmNsYXNzIFNRTGl0ZVRyYW5zYWN0aW9uKFRyYW5zYWN0aW9uQmFja2VuZCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgY29ubmVjdGlvbjogU1FMaXRlQ29ubmVjdGlvbik6CiAgICAgICAgc2VsZi5fY29ubmVjdGlvbiA9IGNvbm5lY3Rpb24KICAgICAgICBzZWxmLl9pc19yb290ID0gRmFsc2UKICAgICAgICBzZWxmLl9zYXZlcG9pbnRfbmFtZSA9ICIiCgogICAgYXN5bmMgZGVmIHN0YXJ0KAogICAgICAgIHNlbGYsIGlzX3Jvb3Q6IGJvb2wsIGV4dHJhX29wdGlvbnM6IHR5cGluZy5EaWN0W3R5cGluZy5BbnksIHR5cGluZy5BbnldCiAgICApIC0+IE5vbmU6CiAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24uX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUsICJDb25uZWN0aW9uIGlzIG5vdCBhY3F1aXJlZCIKICAgICAgICBzZWxmLl9pc19yb290ID0gaXNfcm9vdAogICAgICAgIGlmIHNlbGYuX2lzX3Jvb3Q6CiAgICAgICAgICAgIGFzeW5jIHdpdGggc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbi5leGVjdXRlKCJCRUdJTiIpIGFzIGN1cnNvcjoKICAgICAgICAgICAgICAgIGF3YWl0IGN1cnNvci5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWQgPSBzdHIodXVpZC51dWlkNCgpKS5yZXBsYWNlKCItIiwgIl8iKQogICAgICAgICAgICBzZWxmLl9zYXZlcG9pbnRfbmFtZSA9IGYiU1RBUkxFVFRFX1NBVkVQT0lOVF97aWR9IgogICAgICAgICAgICBhc3luYyB3aXRoIHNlbGYuX2Nvbm5lY3Rpb24uX2Nvbm5lY3Rpb24uZXhlY3V0ZSgKICAgICAgICAgICAgICAgIGYiU0FWRVBPSU5UIHtzZWxmLl9zYXZlcG9pbnRfbmFtZX0iCiAgICAgICAgICAgICkgYXMgY3Vyc29yOgogICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmNsb3NlKCkKCiAgICBhc3luYyBkZWYgY29tbWl0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24uX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUsICJDb25uZWN0aW9uIGlzIG5vdCBhY3F1aXJlZCIKICAgICAgICBpZiBzZWxmLl9pc19yb290OgogICAgICAgICAgICBhc3luYyB3aXRoIHNlbGYuX2Nvbm5lY3Rpb24uX2Nvbm5lY3Rpb24uZXhlY3V0ZSgiQ09NTUlUIikgYXMgY3Vyc29yOgogICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmNsb3NlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBhc3luYyB3aXRoIHNlbGYuX2Nvbm5lY3Rpb24uX2Nvbm5lY3Rpb24uZXhlY3V0ZSgKICAgICAgICAgICAgICAgIGYiUkVMRUFTRSBTQVZFUE9JTlQge3NlbGYuX3NhdmVwb2ludF9uYW1lfSIKICAgICAgICAgICAgKSBhcyBjdXJzb3I6CiAgICAgICAgICAgICAgICBhd2FpdCBjdXJzb3IuY2xvc2UoKQoKICAgIGFzeW5jIGRlZiByb2xsYmFjayhzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgaWYgc2VsZi5faXNfcm9vdDoKICAgICAgICAgICAgYXN5bmMgd2l0aCBzZWxmLl9jb25uZWN0aW9uLl9jb25uZWN0aW9uLmV4ZWN1dGUoIlJPTExCQUNLIikgYXMgY3Vyc29yOgogICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmNsb3NlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBhc3luYyB3aXRoIHNlbGYuX2Nvbm5lY3Rpb24uX2Nvbm5lY3Rpb24uZXhlY3V0ZSgKICAgICAgICAgICAgICAgIGYiUk9MTEJBQ0sgVE8gU0FWRVBPSU5UIHtzZWxmLl9zYXZlcG9pbnRfbmFtZX0iCiAgICAgICAgICAgICkgYXMgY3Vyc29yOgogICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmNsb3NlKCkK
