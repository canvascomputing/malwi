statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/quantiumbase/0.8.1/quantiumbase-0.8.1/quantiumbase-0.8.1/quantiumbase/backends/postgres.py
  contents:
  - name: PostgresBackend.__init__
    score: 0.0
    code: |-
      def __init__(
              self, database_url: typing.Union[DatabaseURL, str], **options: typing.Any
          ) -> None:
              self._database_url = DatabaseURL(database_url)
              self._options = options
              self._dialect = self._get_dialect()
              self._pool = None
    tokens: resume load_global DatabaseURL load_fast database_url call load_fast self store_attr _database_url load_fast options load_fast self store_attr _options load_fast self load_attr _get_dialect call load_fast self store_attr _dialect load_const load_fast self store_attr _pool return_const None
    hash: 93b4610015d2d77e0412dfd94e662abc32a1386f35d27604ada7073eff51b14f
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/quantiumbase/0.8.1/quantiumbase-0.8.1/quantiumbase-0.8.1/quantiumbase/backends/postgres.py
  : aW1wb3J0IGxvZ2dpbmcKaW1wb3J0IHR5cGluZwoKaW1wb3J0IGFzeW5jcGcKZnJvbSBzcWxhbGNoZW15LmRpYWxlY3RzLnBvc3RncmVzcWwgaW1wb3J0IHB5cG9zdGdyZXNxbApmcm9tIHNxbGFsY2hlbXkuZW5naW5lLmludGVyZmFjZXMgaW1wb3J0IERpYWxlY3QKZnJvbSBzcWxhbGNoZW15LnNxbCBpbXBvcnQgQ2xhdXNlRWxlbWVudApmcm9tIHNxbGFsY2hlbXkuc3FsLmRkbCBpbXBvcnQgRERMRWxlbWVudApmcm9tIHNxbGFsY2hlbXkuc3FsLnNjaGVtYSBpbXBvcnQgQ29sdW1uCmZyb20gc3FsYWxjaGVteS50eXBlcyBpbXBvcnQgVHlwZUVuZ2luZQoKZnJvbSBxdWFudGl1bWJhc2UuY29yZSBpbXBvcnQgTE9HX0VYVFJBLCBEYXRhYmFzZVVSTApmcm9tIHF1YW50aXVtYmFzZS5pbnRlcmZhY2VzIGltcG9ydCAoCiAgICBDb25uZWN0aW9uQmFja2VuZCwKICAgIERhdGFiYXNlQmFja2VuZCwKICAgIFJlY29yZCBhcyBSZWNvcmRJbnRlcmZhY2UsCiAgICBUcmFuc2FjdGlvbkJhY2tlbmQsCikKCmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKCJxdWFudGl1bWJhc2UiKQoKCmNsYXNzIFBvc3RncmVzQmFja2VuZChEYXRhYmFzZUJhY2tlbmQpOgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsIGRhdGFiYXNlX3VybDogdHlwaW5nLlVuaW9uW0RhdGFiYXNlVVJMLCBzdHJdLCAqKm9wdGlvbnM6IHR5cGluZy5BbnkKICAgICkgLT4gTm9uZToKICAgICAgICBzZWxmLl9kYXRhYmFzZV91cmwgPSBEYXRhYmFzZVVSTChkYXRhYmFzZV91cmwpCiAgICAgICAgc2VsZi5fb3B0aW9ucyA9IG9wdGlvbnMKICAgICAgICBzZWxmLl9kaWFsZWN0ID0gc2VsZi5fZ2V0X2RpYWxlY3QoKQogICAgICAgIHNlbGYuX3Bvb2wgPSBOb25lCgogICAgZGVmIF9nZXRfZGlhbGVjdChzZWxmKSAtPiBEaWFsZWN0OgogICAgICAgIGRpYWxlY3QgPSBweXBvc3RncmVzcWwuZGlhbGVjdChwYXJhbXN0eWxlPSJweWZvcm1hdCIpCgogICAgICAgIGRpYWxlY3QuaW1wbGljaXRfcmV0dXJuaW5nID0gVHJ1ZQogICAgICAgIGRpYWxlY3Quc3VwcG9ydHNfbmF0aXZlX2VudW0gPSBUcnVlCiAgICAgICAgZGlhbGVjdC5zdXBwb3J0c19zbWFsbHNlcmlhbCA9IFRydWUgICMgOS4yKwogICAgICAgIGRpYWxlY3QuX2JhY2tzbGFzaF9lc2NhcGVzID0gRmFsc2UKICAgICAgICBkaWFsZWN0LnN1cHBvcnRzX3NhbmVfbXVsdGlfcm93Y291bnQgPSBUcnVlICAjIHBzeWNvcGcgMi4wLjkrCiAgICAgICAgZGlhbGVjdC5faGFzX25hdGl2ZV9oc3RvcmUgPSBUcnVlCiAgICAgICAgZGlhbGVjdC5zdXBwb3J0c19uYXRpdmVfZGVjaW1hbCA9IFRydWUKCiAgICAgICAgcmV0dXJuIGRpYWxlY3QKCiAgICBkZWYgX2dldF9jb25uZWN0aW9uX2t3YXJncyhzZWxmKSAtPiBkaWN0OgogICAgICAgIHVybF9vcHRpb25zID0gc2VsZi5fZGF0YWJhc2VfdXJsLm9wdGlvbnMKCiAgICAgICAga3dhcmdzID0ge30gICMgdHlwZTogdHlwaW5nLkRpY3Rbc3RyLCB0eXBpbmcuQW55XQogICAgICAgIG1pbl9zaXplID0gdXJsX29wdGlvbnMuZ2V0KCJtaW5fc2l6ZSIpCiAgICAgICAgbWF4X3NpemUgPSB1cmxfb3B0aW9ucy5nZXQoIm1heF9zaXplIikKICAgICAgICBzc2wgPSB1cmxfb3B0aW9ucy5nZXQoInNzbCIpCgogICAgICAgIGlmIG1pbl9zaXplIGlzIG5vdCBOb25lOgogICAgICAgICAgICBrd2FyZ3NbIm1pbl9zaXplIl0gPSBpbnQobWluX3NpemUpCiAgICAgICAgaWYgbWF4X3NpemUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGt3YXJnc1sibWF4X3NpemUiXSA9IGludChtYXhfc2l6ZSkKICAgICAgICBpZiBzc2wgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGt3YXJnc1sic3NsIl0gPSB7InRydWUiOiBUcnVlLCAiZmFsc2UiOiBGYWxzZX1bc3NsLmxvd2VyKCldCgogICAgICAgIGt3YXJncy51cGRhdGUoc2VsZi5fb3B0aW9ucykKCiAgICAgICAgcmV0dXJuIGt3YXJncwoKICAgIGFzeW5jIGRlZiBjb25uZWN0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgYXNzZXJ0IHNlbGYuX3Bvb2wgaXMgTm9uZSwgIkRhdGFiYXNlQmFja2VuZCBpcyBhbHJlYWR5IHJ1bm5pbmciCiAgICAgICAga3dhcmdzID0gZGljdCgKICAgICAgICAgICAgaG9zdD1zZWxmLl9kYXRhYmFzZV91cmwuaG9zdG5hbWUsCiAgICAgICAgICAgIHBvcnQ9c2VsZi5fZGF0YWJhc2VfdXJsLnBvcnQsCiAgICAgICAgICAgIHVzZXI9c2VsZi5fZGF0YWJhc2VfdXJsLnVzZXJuYW1lLAogICAgICAgICAgICBwYXNzd29yZD1zZWxmLl9kYXRhYmFzZV91cmwucGFzc3dvcmQsCiAgICAgICAgICAgIGRhdGFiYXNlPXNlbGYuX2RhdGFiYXNlX3VybC5kYXRhYmFzZSwKICAgICAgICApCiAgICAgICAga3dhcmdzLnVwZGF0ZShzZWxmLl9nZXRfY29ubmVjdGlvbl9rd2FyZ3MoKSkKICAgICAgICBzZWxmLl9wb29sID0gYXdhaXQgYXN5bmNwZy5jcmVhdGVfcG9vbCgqKmt3YXJncykKCiAgICBhc3luYyBkZWYgZGlzY29ubmVjdChzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9wb29sIGlzIG5vdCBOb25lLCAiRGF0YWJhc2VCYWNrZW5kIGlzIG5vdCBydW5uaW5nIgogICAgICAgIGF3YWl0IHNlbGYuX3Bvb2wuY2xvc2UoKQogICAgICAgIHNlbGYuX3Bvb2wgPSBOb25lCgogICAgZGVmIGNvbm5lY3Rpb24oc2VsZikgLT4gIlBvc3RncmVzQ29ubmVjdGlvbiI6CiAgICAgICAgcmV0dXJuIFBvc3RncmVzQ29ubmVjdGlvbihzZWxmLCBzZWxmLl9kaWFsZWN0KQoKCmNsYXNzIFJlY29yZChSZWNvcmRJbnRlcmZhY2UpOgogICAgX19zbG90c19fID0gKAogICAgICAgICJfcm93IiwKICAgICAgICAiX3Jlc3VsdF9jb2x1bW5zIiwKICAgICAgICAiX2RpYWxlY3QiLAogICAgICAgICJfY29sdW1uX21hcCIsCiAgICAgICAgIl9jb2x1bW5fbWFwX2ludCIsCiAgICAgICAgIl9jb2x1bW5fbWFwX2Z1bGwiLAogICAgKQoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIHJvdzogYXN5bmNwZy5SZWNvcmQsCiAgICAgICAgcmVzdWx0X2NvbHVtbnM6IHR1cGxlLAogICAgICAgIGRpYWxlY3Q6IERpYWxlY3QsCiAgICAgICAgY29sdW1uX21hcHM6IHR5cGluZy5UdXBsZVsKICAgICAgICAgICAgdHlwaW5nLk1hcHBpbmdbdHlwaW5nLkFueSwgdHlwaW5nLlR1cGxlW2ludCwgVHlwZUVuZ2luZV1dLAogICAgICAgICAgICB0eXBpbmcuTWFwcGluZ1tpbnQsIHR5cGluZy5UdXBsZVtpbnQsIFR5cGVFbmdpbmVdXSwKICAgICAgICAgICAgdHlwaW5nLk1hcHBpbmdbc3RyLCB0eXBpbmcuVHVwbGVbaW50LCBUeXBlRW5naW5lXV0sCiAgICAgICAgXSwKICAgICkgLT4gTm9uZToKICAgICAgICBzZWxmLl9yb3cgPSByb3cKICAgICAgICBzZWxmLl9yZXN1bHRfY29sdW1ucyA9IHJlc3VsdF9jb2x1bW5zCiAgICAgICAgc2VsZi5fZGlhbGVjdCA9IGRpYWxlY3QKICAgICAgICBzZWxmLl9jb2x1bW5fbWFwLCBzZWxmLl9jb2x1bW5fbWFwX2ludCwgc2VsZi5fY29sdW1uX21hcF9mdWxsID0gY29sdW1uX21hcHMKCiAgICBAcHJvcGVydHkKICAgIGRlZiBfbWFwcGluZyhzZWxmKSAtPiB0eXBpbmcuTWFwcGluZzoKICAgICAgICByZXR1cm4gc2VsZi5fcm93CgogICAgZGVmIGtleXMoc2VsZikgLT4gdHlwaW5nLktleXNWaWV3OgogICAgICAgIGltcG9ydCB3YXJuaW5ncwoKICAgICAgICB3YXJuaW5ncy53YXJuKAogICAgICAgICAgICAiVGhlIGBSb3cua2V5cygpYCBtZXRob2QgaXMgZGVwcmVjYXRlZCB0byBtaW1pYyBTUUxBbGNoZW15IGJlaGF2aW91ciwgIgogICAgICAgICAgICAidXNlIGBSb3cuX21hcHBpbmcua2V5cygpYCBpbnN0ZWFkLiIsCiAgICAgICAgICAgIERlcHJlY2F0aW9uV2FybmluZywKICAgICAgICApCiAgICAgICAgcmV0dXJuIHNlbGYuX21hcHBpbmcua2V5cygpCgogICAgZGVmIHZhbHVlcyhzZWxmKSAtPiB0eXBpbmcuVmFsdWVzVmlldzoKICAgICAgICBpbXBvcnQgd2FybmluZ3MKCiAgICAgICAgd2FybmluZ3Mud2FybigKICAgICAgICAgICAgIlRoZSBgUm93LnZhbHVlcygpYCBtZXRob2QgaXMgZGVwcmVjYXRlZCB0byBtaW1pYyBTUUxBbGNoZW15IGJlaGF2aW91ciwgIgogICAgICAgICAgICAidXNlIGBSb3cuX21hcHBpbmcudmFsdWVzKClgIGluc3RlYWQuIiwKICAgICAgICAgICAgRGVwcmVjYXRpb25XYXJuaW5nLAogICAgICAgICkKICAgICAgICByZXR1cm4gc2VsZi5fbWFwcGluZy52YWx1ZXMoKQoKICAgIGRlZiBfX2dldGl0ZW1fXyhzZWxmLCBrZXk6IHR5cGluZy5BbnkpIC0+IHR5cGluZy5Bbnk6CiAgICAgICAgaWYgbGVuKHNlbGYuX2NvbHVtbl9tYXApID09IDA6ICAjIHJhdyBxdWVyeQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcm93W2tleV0KICAgICAgICBlbGlmIGlzaW5zdGFuY2Uoa2V5LCBDb2x1bW4pOgogICAgICAgICAgICBpZHgsIGRhdGF0eXBlID0gc2VsZi5fY29sdW1uX21hcF9mdWxsW3N0cihrZXkpXQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShrZXksIGludCk6CiAgICAgICAgICAgIGlkeCwgZGF0YXR5cGUgPSBzZWxmLl9jb2x1bW5fbWFwX2ludFtrZXldCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWR4LCBkYXRhdHlwZSA9IHNlbGYuX2NvbHVtbl9tYXBba2V5XQogICAgICAgIHJhdyA9IHNlbGYuX3Jvd1tpZHhdCiAgICAgICAgcHJvY2Vzc29yID0gZGF0YXR5cGUuX2NhY2hlZF9yZXN1bHRfcHJvY2Vzc29yKHNlbGYuX2RpYWxlY3QsIE5vbmUpCgogICAgICAgIGlmIHByb2Nlc3NvciBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NvcihyYXcpCiAgICAgICAgcmV0dXJuIHJhdwoKICAgIGRlZiBfX2l0ZXJfXyhzZWxmKSAtPiB0eXBpbmcuSXRlcmF0b3I6CiAgICAgICAgcmV0dXJuIGl0ZXIoc2VsZi5fcm93LmtleXMoKSkKCiAgICBkZWYgX19sZW5fXyhzZWxmKSAtPiBpbnQ6CiAgICAgICAgcmV0dXJuIGxlbihzZWxmLl9yb3cpCgogICAgZGVmIF9fZ2V0YXR0cl9fKHNlbGYsIG5hbWU6IHN0cikgLT4gdHlwaW5nLkFueToKICAgICAgICByZXR1cm4gc2VsZi5fbWFwcGluZy5nZXQobmFtZSkKCgpjbGFzcyBQb3N0Z3Jlc0Nvbm5lY3Rpb24oQ29ubmVjdGlvbkJhY2tlbmQpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRhdGFiYXNlOiBQb3N0Z3Jlc0JhY2tlbmQsIGRpYWxlY3Q6IERpYWxlY3QpOgogICAgICAgIHNlbGYuX2RhdGFiYXNlID0gZGF0YWJhc2UKICAgICAgICBzZWxmLl9kaWFsZWN0ID0gZGlhbGVjdAogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBOb25lICAjIHR5cGU6IHR5cGluZy5PcHRpb25hbFthc3luY3BnLmNvbm5lY3Rpb24uQ29ubmVjdGlvbl0KCiAgICBhc3luYyBkZWYgYWNxdWlyZShzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIE5vbmUsICJDb25uZWN0aW9uIGlzIGFscmVhZHkgYWNxdWlyZWQiCiAgICAgICAgYXNzZXJ0IHNlbGYuX2RhdGFiYXNlLl9wb29sIGlzIG5vdCBOb25lLCAiRGF0YWJhc2VCYWNrZW5kIGlzIG5vdCBydW5uaW5nIgogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBhd2FpdCBzZWxmLl9kYXRhYmFzZS5fcG9vbC5hY3F1aXJlKCkKCiAgICBhc3luYyBkZWYgcmVsZWFzZShzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgYXNzZXJ0IHNlbGYuX2RhdGFiYXNlLl9wb29sIGlzIG5vdCBOb25lLCAiRGF0YWJhc2VCYWNrZW5kIGlzIG5vdCBydW5uaW5nIgogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBhd2FpdCBzZWxmLl9kYXRhYmFzZS5fcG9vbC5yZWxlYXNlKHNlbGYuX2Nvbm5lY3Rpb24pCiAgICAgICAgc2VsZi5fY29ubmVjdGlvbiA9IE5vbmUKCiAgICBhc3luYyBkZWYgZmV0Y2hfYWxsKHNlbGYsIHF1ZXJ5OiBDbGF1c2VFbGVtZW50KSAtPiB0eXBpbmcuTGlzdFtSZWNvcmRJbnRlcmZhY2VdOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgcXVlcnlfc3RyLCBhcmdzLCByZXN1bHRfY29sdW1ucyA9IHNlbGYuX2NvbXBpbGUocXVlcnkpCiAgICAgICAgcm93cyA9IGF3YWl0IHNlbGYuX2Nvbm5lY3Rpb24uZmV0Y2gocXVlcnlfc3RyLCAqYXJncykKICAgICAgICBkaWFsZWN0ID0gc2VsZi5fZGlhbGVjdAogICAgICAgIGNvbHVtbl9tYXBzID0gc2VsZi5fY3JlYXRlX2NvbHVtbl9tYXBzKHJlc3VsdF9jb2x1bW5zKQogICAgICAgIHJldHVybiBbUmVjb3JkKHJvdywgcmVzdWx0X2NvbHVtbnMsIGRpYWxlY3QsIGNvbHVtbl9tYXBzKSBmb3Igcm93IGluIHJvd3NdCgogICAgYXN5bmMgZGVmIGZldGNoX29uZShzZWxmLCBxdWVyeTogQ2xhdXNlRWxlbWVudCkgLT4gdHlwaW5nLk9wdGlvbmFsW1JlY29yZEludGVyZmFjZV06CiAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUsICJDb25uZWN0aW9uIGlzIG5vdCBhY3F1aXJlZCIKICAgICAgICBxdWVyeV9zdHIsIGFyZ3MsIHJlc3VsdF9jb2x1bW5zID0gc2VsZi5fY29tcGlsZShxdWVyeSkKICAgICAgICByb3cgPSBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLmZldGNocm93KHF1ZXJ5X3N0ciwgKmFyZ3MpCiAgICAgICAgaWYgcm93IGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgcmV0dXJuIFJlY29yZCgKICAgICAgICAgICAgcm93LAogICAgICAgICAgICByZXN1bHRfY29sdW1ucywKICAgICAgICAgICAgc2VsZi5fZGlhbGVjdCwKICAgICAgICAgICAgc2VsZi5fY3JlYXRlX2NvbHVtbl9tYXBzKHJlc3VsdF9jb2x1bW5zKSwKICAgICAgICApCgogICAgYXN5bmMgZGVmIGZldGNoX3ZhbCgKICAgICAgICBzZWxmLCBxdWVyeTogQ2xhdXNlRWxlbWVudCwgY29sdW1uOiB0eXBpbmcuQW55ID0gMAogICAgKSAtPiB0eXBpbmcuQW55OgogICAgICAgICMgd2UgYXJlIG5vdCBjYWxsaW5nIHNlbGYuX2Nvbm5lY3Rpb24uZmV0Y2h2YWwgaGVyZSBiZWNhdXNlCiAgICAgICAgIyBpdCBkb2VzIG5vdCBjb252ZXJ0IGFsbCB0aGUgdHlwZXMsIGUuZy4gSlNPTiBzdGF5cyBzdHJpbmcKICAgICAgICAjIGluc3RlYWQgb2YgYW4gb2JqZWN0CiAgICAgICAgIyBzZWUgYWxzbzoKICAgICAgICAjIGh0dHBzOi8vZ2l0aHViLmNvbS9xdWFudGl1bWRldnN0L3F1YW50aXVtYmFzZS9wdWxsLzEzMQogICAgICAgICMgaHR0cHM6Ly9naXRodWIuY29tL3F1YW50aXVtZGV2c3QvcXVhbnRpdW1iYXNlL3B1bGwvMTMyCiAgICAgICAgIyBodHRwczovL2dpdGh1Yi5jb20vcXVhbnRpdW1kZXZzdC9xdWFudGl1bWJhc2UvcHVsbC8yNDYKICAgICAgICByb3cgPSBhd2FpdCBzZWxmLmZldGNoX29uZShxdWVyeSkKICAgICAgICBpZiByb3cgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICByZXR1cm4gcm93W2NvbHVtbl0KCiAgICBhc3luYyBkZWYgZXhlY3V0ZShzZWxmLCBxdWVyeTogQ2xhdXNlRWxlbWVudCkgLT4gdHlwaW5nLkFueToKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbiBpcyBub3QgTm9uZSwgIkNvbm5lY3Rpb24gaXMgbm90IGFjcXVpcmVkIgogICAgICAgIHF1ZXJ5X3N0ciwgYXJncywgcmVzdWx0X2NvbHVtbnMgPSBzZWxmLl9jb21waWxlKHF1ZXJ5KQogICAgICAgIHJldHVybiBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLmZldGNodmFsKHF1ZXJ5X3N0ciwgKmFyZ3MpCgogICAgYXN5bmMgZGVmIGV4ZWN1dGVfbWFueShzZWxmLCBxdWVyaWVzOiB0eXBpbmcuTGlzdFtDbGF1c2VFbGVtZW50XSkgLT4gTm9uZToKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbiBpcyBub3QgTm9uZSwgIkNvbm5lY3Rpb24gaXMgbm90IGFjcXVpcmVkIgogICAgICAgICMgYXN5bmNwZyB1c2VzIHByZXBhcmVkIHN0YXRlbWVudHMgdW5kZXIgdGhlIGhvb2QsIHNvIHdlIGp1c3QKICAgICAgICAjIGxvb3AgdGhyb3VnaCBtdWx0aXBsZSBleGVjdXRlcyBoZXJlLCB3aGljaCBzaG91bGQgYWxsIGVuZCB1cAogICAgICAgICMgdXNpbmcgdGhlIHNhbWUgcHJlcGFyZWQgc3RhdGVtZW50LgogICAgICAgIGZvciBzaW5nbGVfcXVlcnkgaW4gcXVlcmllczoKICAgICAgICAgICAgc2luZ2xlX3F1ZXJ5LCBhcmdzLCByZXN1bHRfY29sdW1ucyA9IHNlbGYuX2NvbXBpbGUoc2luZ2xlX3F1ZXJ5KQogICAgICAgICAgICBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLmV4ZWN1dGUoc2luZ2xlX3F1ZXJ5LCAqYXJncykKCiAgICBhc3luYyBkZWYgaXRlcmF0ZSgKICAgICAgICBzZWxmLCBxdWVyeTogQ2xhdXNlRWxlbWVudAogICAgKSAtPiB0eXBpbmcuQXN5bmNHZW5lcmF0b3JbdHlwaW5nLkFueSwgTm9uZV06CiAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUsICJDb25uZWN0aW9uIGlzIG5vdCBhY3F1aXJlZCIKICAgICAgICBxdWVyeV9zdHIsIGFyZ3MsIHJlc3VsdF9jb2x1bW5zID0gc2VsZi5fY29tcGlsZShxdWVyeSkKICAgICAgICBjb2x1bW5fbWFwcyA9IHNlbGYuX2NyZWF0ZV9jb2x1bW5fbWFwcyhyZXN1bHRfY29sdW1ucykKICAgICAgICBhc3luYyBmb3Igcm93IGluIHNlbGYuX2Nvbm5lY3Rpb24uY3Vyc29yKHF1ZXJ5X3N0ciwgKmFyZ3MpOgogICAgICAgICAgICB5aWVsZCBSZWNvcmQocm93LCByZXN1bHRfY29sdW1ucywgc2VsZi5fZGlhbGVjdCwgY29sdW1uX21hcHMpCgogICAgZGVmIHRyYW5zYWN0aW9uKHNlbGYpIC0+IFRyYW5zYWN0aW9uQmFja2VuZDoKICAgICAgICByZXR1cm4gUG9zdGdyZXNUcmFuc2FjdGlvbihjb25uZWN0aW9uPXNlbGYpCgogICAgZGVmIF9jb21waWxlKHNlbGYsIHF1ZXJ5OiBDbGF1c2VFbGVtZW50KSAtPiB0eXBpbmcuVHVwbGVbc3RyLCBsaXN0LCB0dXBsZV06CiAgICAgICAgY29tcGlsZWQgPSBxdWVyeS5jb21waWxlKAogICAgICAgICAgICBkaWFsZWN0PXNlbGYuX2RpYWxlY3QsIGNvbXBpbGVfa3dhcmdzPXsicmVuZGVyX3Bvc3Rjb21waWxlIjogVHJ1ZX0KICAgICAgICApCgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHF1ZXJ5LCBERExFbGVtZW50KToKICAgICAgICAgICAgY29tcGlsZWRfcGFyYW1zID0gc29ydGVkKGNvbXBpbGVkLnBhcmFtcy5pdGVtcygpKQoKICAgICAgICAgICAgbWFwcGluZyA9IHsKICAgICAgICAgICAgICAgIGtleTogIiQiICsgc3RyKGkpIGZvciBpLCAoa2V5LCBfKSBpbiBlbnVtZXJhdGUoY29tcGlsZWRfcGFyYW1zLCBzdGFydD0xKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbXBpbGVkX3F1ZXJ5ID0gY29tcGlsZWQuc3RyaW5nICUgbWFwcGluZwoKICAgICAgICAgICAgcHJvY2Vzc29ycyA9IGNvbXBpbGVkLl9iaW5kX3Byb2Nlc3NvcnMKICAgICAgICAgICAgYXJncyA9IFsKICAgICAgICAgICAgICAgIHByb2Nlc3NvcnNba2V5XSh2YWwpIGlmIGtleSBpbiBwcm9jZXNzb3JzIGVsc2UgdmFsCiAgICAgICAgICAgICAgICBmb3Iga2V5LCB2YWwgaW4gY29tcGlsZWRfcGFyYW1zCiAgICAgICAgICAgIF0KCiAgICAgICAgICAgIHJlc3VsdF9tYXAgPSBjb21waWxlZC5fcmVzdWx0X2NvbHVtbnMKICAgICAgICBlbHNlOgogICAgICAgICAgICBjb21waWxlZF9xdWVyeSA9IGNvbXBpbGVkLnN0cmluZwogICAgICAgICAgICBhcmdzID0gW10KICAgICAgICAgICAgcmVzdWx0X21hcCA9IE5vbmUKCiAgICAgICAgcXVlcnlfbWVzc2FnZSA9IGNvbXBpbGVkX3F1ZXJ5LnJlcGxhY2UoIiBcbiIsICIgIikucmVwbGFjZSgiXG4iLCAiICIpCiAgICAgICAgbG9nZ2VyLmRlYnVnKAogICAgICAgICAgICAiUXVlcnk6ICVzIEFyZ3M6ICVzIiwgcXVlcnlfbWVzc2FnZSwgcmVwcih0dXBsZShhcmdzKSksIGV4dHJhPUxPR19FWFRSQQogICAgICAgICkKICAgICAgICByZXR1cm4gY29tcGlsZWRfcXVlcnksIGFyZ3MsIHJlc3VsdF9tYXAKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgX2NyZWF0ZV9jb2x1bW5fbWFwcygKICAgICAgICByZXN1bHRfY29sdW1uczogdHVwbGUsCiAgICApIC0+IHR5cGluZy5UdXBsZVsKICAgICAgICB0eXBpbmcuTWFwcGluZ1t0eXBpbmcuQW55LCB0eXBpbmcuVHVwbGVbaW50LCBUeXBlRW5naW5lXV0sCiAgICAgICAgdHlwaW5nLk1hcHBpbmdbaW50LCB0eXBpbmcuVHVwbGVbaW50LCBUeXBlRW5naW5lXV0sCiAgICAgICAgdHlwaW5nLk1hcHBpbmdbc3RyLCB0eXBpbmcuVHVwbGVbaW50LCBUeXBlRW5naW5lXV0sCiAgICBdOgogICAgICAgICIiIgogICAgICAgIEdlbmVyYXRlIGNvbHVtbiAtPiBkYXRhdHlwZSBtYXBwaW5ncyBmcm9tIHRoZSBjb2x1bW4gZGVmaW5pdGlvbnMuCgogICAgICAgIFRoZXNlIG1hcHBpbmdzIGFyZSB1c2VkIHRocm91Z2hvdXQgUG9zdGdyZXNDb25uZWN0aW9uIG1ldGhvZHMKICAgICAgICB0byBpbml0aWFsaXplIFJlY29yZC1zLiBUaGUgdW5kZXJseWluZyBEQiBkcml2ZXIgZG9lcyBub3QgZG8gdHlwZQogICAgICAgIGNvbnZlcnNpb24gZm9yIHVzIHNvIHdlIGhhdmUgd3JhcCB0aGUgcmV0dXJuZWQgYXN5bmNwZy5SZWNvcmQtcy4KCiAgICAgICAgOnJldHVybjogVGhyZWUgbWFwcGluZ3MgZnJvbSBkaWZmZXJlbnQgd2F5cyB0byBhZGRyZXNzIGEgY29sdW1uIHRvIFwKICAgICAgICAgICAgICAgICBjb3JyZXNwb25kaW5nIGNvbHVtbiBpbmRleGVzIGFuZCBkYXRhdHlwZXM6IFwKICAgICAgICAgICAgICAgICAxLiBieSBjb2x1bW4gaWRlbnRpZmllcjsgXAogICAgICAgICAgICAgICAgIDIuIGJ5IGNvbHVtbiBpbmRleDsgXAogICAgICAgICAgICAgICAgIDMuIGJ5IGNvbHVtbiBuYW1lIGluIENvbHVtbiBzcWxhbGNoZW15IG9iamVjdHMuCiAgICAgICAgIiIiCiAgICAgICAgY29sdW1uX21hcCwgY29sdW1uX21hcF9pbnQsIGNvbHVtbl9tYXBfZnVsbCA9IHt9LCB7fSwge30KICAgICAgICBmb3IgaWR4LCAoY29sdW1uX25hbWUsIF8sIGNvbHVtbiwgZGF0YXR5cGUpIGluIGVudW1lcmF0ZShyZXN1bHRfY29sdW1ucyk6CiAgICAgICAgICAgIGNvbHVtbl9tYXBbY29sdW1uX25hbWVdID0gKGlkeCwgZGF0YXR5cGUpCiAgICAgICAgICAgIGNvbHVtbl9tYXBfaW50W2lkeF0gPSAoaWR4LCBkYXRhdHlwZSkKICAgICAgICAgICAgY29sdW1uX21hcF9mdWxsW3N0cihjb2x1bW5bMF0pXSA9IChpZHgsIGRhdGF0eXBlKQogICAgICAgIHJldHVybiBjb2x1bW5fbWFwLCBjb2x1bW5fbWFwX2ludCwgY29sdW1uX21hcF9mdWxsCgogICAgQHByb3BlcnR5CiAgICBkZWYgcmF3X2Nvbm5lY3Rpb24oc2VsZikgLT4gYXN5bmNwZy5jb25uZWN0aW9uLkNvbm5lY3Rpb246CiAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUsICJDb25uZWN0aW9uIGlzIG5vdCBhY3F1aXJlZCIKICAgICAgICByZXR1cm4gc2VsZi5fY29ubmVjdGlvbgoKCmNsYXNzIFBvc3RncmVzVHJhbnNhY3Rpb24oVHJhbnNhY3Rpb25CYWNrZW5kKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb25uZWN0aW9uOiBQb3N0Z3Jlc0Nvbm5lY3Rpb24pOgogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBjb25uZWN0aW9uCiAgICAgICAgc2VsZi5fdHJhbnNhY3Rpb24gPSAoCiAgICAgICAgICAgIE5vbmUKICAgICAgICApICAjIHR5cGU6IHR5cGluZy5PcHRpb25hbFthc3luY3BnLnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uXQoKICAgIGFzeW5jIGRlZiBzdGFydCgKICAgICAgICBzZWxmLCBpc19yb290OiBib29sLCBleHRyYV9vcHRpb25zOiB0eXBpbmcuRGljdFt0eXBpbmcuQW55LCB0eXBpbmcuQW55XQogICAgKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgc2VsZi5fdHJhbnNhY3Rpb24gPSBzZWxmLl9jb25uZWN0aW9uLl9jb25uZWN0aW9uLnRyYW5zYWN0aW9uKCoqZXh0cmFfb3B0aW9ucykKICAgICAgICBhd2FpdCBzZWxmLl90cmFuc2FjdGlvbi5zdGFydCgpCgogICAgYXN5bmMgZGVmIGNvbW1pdChzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl90cmFuc2FjdGlvbiBpcyBub3QgTm9uZQogICAgICAgIGF3YWl0IHNlbGYuX3RyYW5zYWN0aW9uLmNvbW1pdCgpCgogICAgYXN5bmMgZGVmIHJvbGxiYWNrKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgYXNzZXJ0IHNlbGYuX3RyYW5zYWN0aW9uIGlzIG5vdCBOb25lCiAgICAgICAgYXdhaXQgc2VsZi5fdHJhbnNhY3Rpb24ucm9sbGJhY2soKQo=
