statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/clidocs.py
  contents:
  - name: GlobalOptionsDocumenter.__init__
    score: 0.0
    code: |-
      def __init__(self, help_command):
              self._help_command = help_command
    tokens: resume load_fast help_command load_fast self store_attr _help_command return_const None
    hash: 5b865ddfc21c599dcef599aaed5021423951a83f6f899c2a383f5a0b08bb9fa1
sources:
  .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/clidocs.py: IyBDb3B5cmlnaHQgMjAxMi0yMDEzIEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKS4gWW91CiMgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZgojIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXQKIwojICAgICBodHRwOi8vYXdzLmFtYXpvbi5jb20vYXBhY2hlMi4wLwojCiMgb3IgaW4gdGhlICJsaWNlbnNlIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcwojIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GCiMgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljCiMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KaW1wb3J0IGxvZ2dpbmcKaW1wb3J0IG9zCmltcG9ydCByZQpmcm9tIGJvdG9jb3JlIGltcG9ydCB4Zm9ybV9uYW1lCmZyb20gYm90b2NvcmUubW9kZWwgaW1wb3J0IFN0cmluZ1NoYXBlCmZyb20gYm90b2NvcmUudXRpbHMgaW1wb3J0IGlzX2pzb25fdmFsdWVfaGVhZGVyCgpmcm9tIGF3c2NsaSBpbXBvcnQgU0NBTEFSX1RZUEVTCmZyb20gYXdzY2xpLmFyZ3Byb2Nlc3MgaW1wb3J0IFBhcmFtU2hvcnRoYW5kRG9jR2VuCmZyb20gYXdzY2xpLmJjZG9jLmRvY2V2ZW50cyBpbXBvcnQgRE9DX0VWRU5UUwpmcm9tIGF3c2NsaS50b3BpY3RhZ3MgaW1wb3J0IFRvcGljVGFnREIKZnJvbSBhd3NjbGkudXRpbHMgaW1wb3J0ICgKICAgIGZpbmRfc2VydmljZV9hbmRfbWV0aG9kX2luX2V2ZW50X25hbWUsIGlzX2RvY3VtZW50X3R5cGUsCiAgICBvcGVyYXRpb25fdXNlc19kb2N1bWVudF90eXBlcywgaXNfc3RyZWFtaW5nX2Jsb2JfdHlwZSwKICAgIGlzX3RhZ2dlZF91bmlvbl90eXBlCikKCkxPRyA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQpFWEFNUExFU19ESVIgPSBvcy5wYXRoLmpvaW4ob3MucGF0aC5kaXJuYW1lKG9zLnBhdGguYWJzcGF0aChfX2ZpbGVfXykpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2V4YW1wbGVzJykKR0xPQkFMX09QVElPTlNfRklMRSA9IG9zLnBhdGguam9pbihFWEFNUExFU19ESVIsICdnbG9iYWxfb3B0aW9ucy5yc3QnKQpHTE9CQUxfT1BUSU9OU19TWU5PUFNJU19GSUxFID0gb3MucGF0aC5qb2luKEVYQU1QTEVTX0RJUiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ2xvYmFsX3N5bm9wc2lzLnJzdCcpCgoKY2xhc3MgQ0xJRG9jdW1lbnRFdmVudEhhbmRsZXIob2JqZWN0KToKCiAgICBkZWYgX19pbml0X18oc2VsZiwgaGVscF9jb21tYW5kKToKICAgICAgICBzZWxmLmhlbHBfY29tbWFuZCA9IGhlbHBfY29tbWFuZAogICAgICAgIHNlbGYucmVnaXN0ZXIoaGVscF9jb21tYW5kLnNlc3Npb24sIGhlbHBfY29tbWFuZC5ldmVudF9jbGFzcykKICAgICAgICBzZWxmLl9hcmdfZ3JvdXBzID0gc2VsZi5fYnVpbGRfYXJnX3RhYmxlX2dyb3VwcyhoZWxwX2NvbW1hbmQpCiAgICAgICAgc2VsZi5fZG9jdW1lbnRlZF9hcmdfZ3JvdXBzID0gW10KCiAgICBkZWYgX2J1aWxkX2FyZ190YWJsZV9ncm91cHMoc2VsZiwgaGVscF9jb21tYW5kKToKICAgICAgICBhcmdfZ3JvdXBzID0ge30KICAgICAgICBmb3IgYXJnIGluIGhlbHBfY29tbWFuZC5hcmdfdGFibGUudmFsdWVzKCk6CiAgICAgICAgICAgIGlmIGFyZy5ncm91cF9uYW1lIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgYXJnX2dyb3Vwcy5zZXRkZWZhdWx0KGFyZy5ncm91cF9uYW1lLCBbXSkuYXBwZW5kKGFyZykKICAgICAgICByZXR1cm4gYXJnX2dyb3VwcwoKICAgIGRlZiBfZ2V0X2FyZ3VtZW50X3R5cGVfbmFtZShzZWxmLCBzaGFwZSwgZGVmYXVsdCk6CiAgICAgICAgaWYgaXNfanNvbl92YWx1ZV9oZWFkZXIoc2hhcGUpOgogICAgICAgICAgICByZXR1cm4gJ0pTT04nCiAgICAgICAgaWYgaXNfZG9jdW1lbnRfdHlwZShzaGFwZSk6CiAgICAgICAgICAgIHJldHVybiAnZG9jdW1lbnQnCiAgICAgICAgaWYgaXNfc3RyZWFtaW5nX2Jsb2JfdHlwZShzaGFwZSk6CiAgICAgICAgICAgIHJldHVybiAnc3RyZWFtaW5nIGJsb2InCiAgICAgICAgaWYgaXNfdGFnZ2VkX3VuaW9uX3R5cGUoc2hhcGUpOgogICAgICAgICAgICByZXR1cm4gJ3RhZ2dlZCB1bmlvbiBzdHJ1Y3R1cmUnCiAgICAgICAgcmV0dXJuIGRlZmF1bHQKCiAgICBkZWYgX21hcF9oYW5kbGVycyhzZWxmLCBzZXNzaW9uLCBldmVudF9jbGFzcywgbWFwZm4pOgogICAgICAgIGZvciBldmVudCBpbiBET0NfRVZFTlRTOgogICAgICAgICAgICBldmVudF9oYW5kbGVyX25hbWUgPSBldmVudC5yZXBsYWNlKCctJywgJ18nKQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsIGV2ZW50X2hhbmRsZXJfbmFtZSk6CiAgICAgICAgICAgICAgICBldmVudF9oYW5kbGVyID0gZ2V0YXR0cihzZWxmLCBldmVudF9oYW5kbGVyX25hbWUpCiAgICAgICAgICAgICAgICBmb3JtYXRfc3RyaW5nID0gRE9DX0VWRU5UU1tldmVudF0KICAgICAgICAgICAgICAgIG51bV9hcmdzID0gbGVuKGZvcm1hdF9zdHJpbmcuc3BsaXQoJy4nKSkgLSAyCiAgICAgICAgICAgICAgICBmb3JtYXRfYXJncyA9IChldmVudF9jbGFzcywpICsgKCcqJywpICogbnVtX2FyZ3MKICAgICAgICAgICAgICAgIGV2ZW50X3N0cmluZyA9IGV2ZW50ICsgZm9ybWF0X3N0cmluZyAlIGZvcm1hdF9hcmdzCiAgICAgICAgICAgICAgICB1bmlxdWVfaWQgPSBldmVudF9jbGFzcyArIGV2ZW50X2hhbmRsZXJfbmFtZQogICAgICAgICAgICAgICAgbWFwZm4oZXZlbnRfc3RyaW5nLCBldmVudF9oYW5kbGVyLCB1bmlxdWVfaWQpCgogICAgZGVmIHJlZ2lzdGVyKHNlbGYsIHNlc3Npb24sIGV2ZW50X2NsYXNzKToKICAgICAgICAiIiIKICAgICAgICBUaGUgZGVmYXVsdCByZWdpc3RlciBpdGVyYXRlcyB0aHJvdWdoIGFsbCBvZiB0aGUKICAgICAgICBhdmFpbGFibGUgZG9jdW1lbnQgZXZlbnRzIGFuZCBsb29rcyBmb3IgYSBjb3JyZXNwb25kaW5nCiAgICAgICAgaGFuZGxlciBtZXRob2QgZGVmaW5lZCBpbiB0aGUgb2JqZWN0LiAgSWYgaXQncyB0aGVyZSwgdGhhdAogICAgICAgIGhhbmRsZXIgbWV0aG9kIHdpbGwgYmUgcmVnaXN0ZXJlZCBmb3IgdGhlIGFsbCBldmVudHMgb2YKICAgICAgICB0aGF0IHR5cGUgZm9yIHRoZSBzcGVjaWZpZWQgYGBldmVudF9jbGFzc2BgLgogICAgICAgICIiIgogICAgICAgIHNlbGYuX21hcF9oYW5kbGVycyhzZXNzaW9uLCBldmVudF9jbGFzcywgc2Vzc2lvbi5yZWdpc3RlcikKCiAgICBkZWYgdW5yZWdpc3RlcihzZWxmKToKICAgICAgICAiIiIKICAgICAgICBUaGUgZGVmYXVsdCB1bnJlZ2lzdGVyIGl0ZXJhdGVzIHRocm91Z2ggYWxsIG9mIHRoZQogICAgICAgIGF2YWlsYWJsZSBkb2N1bWVudCBldmVudHMgYW5kIGxvb2tzIGZvciBhIGNvcnJlc3BvbmRpbmcKICAgICAgICBoYW5kbGVyIG1ldGhvZCBkZWZpbmVkIGluIHRoZSBvYmplY3QuICBJZiBpdCdzIHRoZXJlLCB0aGF0CiAgICAgICAgaGFuZGxlciBtZXRob2Qgd2lsbCBiZSB1bnJlZ2lzdGVyZWQgZm9yIHRoZSBhbGwgZXZlbnRzIG9mCiAgICAgICAgdGhhdCB0eXBlIGZvciB0aGUgc3BlY2lmaWVkIGBgZXZlbnRfY2xhc3NgYC4KICAgICAgICAiIiIKICAgICAgICBzZWxmLl9tYXBfaGFuZGxlcnMoc2VsZi5oZWxwX2NvbW1hbmQuc2Vzc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oZWxwX2NvbW1hbmQuZXZlbnRfY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGVscF9jb21tYW5kLnNlc3Npb24udW5yZWdpc3RlcikKCiAgICAjIFRoZXNlIGFyZSBkZWZhdWx0IGRvYyBoYW5kbGVycyB0aGF0IGFwcGx5IGluIHRoZSBnZW5lcmFsIGNhc2UuCgogICAgZGVmIGRvY19icmVhZGNydW1icyhzZWxmLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgaWYgZG9jLnRhcmdldCAhPSAnbWFuJzoKICAgICAgICAgICAgY21kX25hbWVzID0gaGVscF9jb21tYW5kLmV2ZW50X2NsYXNzLnNwbGl0KCcuJykKICAgICAgICAgICAgZG9jLndyaXRlKCdbICcpCiAgICAgICAgICAgIGRvYy53cml0ZSgnOnJlZjpgYXdzIDxjbGk6YXdzPmAnKQogICAgICAgICAgICBmdWxsX2NtZF9saXN0ID0gWydhd3MnXQogICAgICAgICAgICBmb3IgY21kIGluIGNtZF9uYW1lc1s6LTFdOgogICAgICAgICAgICAgICAgZG9jLndyaXRlKCcgLiAnKQogICAgICAgICAgICAgICAgZnVsbF9jbWRfbGlzdC5hcHBlbmQoY21kKQogICAgICAgICAgICAgICAgZnVsbF9jbWRfbmFtZSA9ICcgJy5qb2luKGZ1bGxfY21kX2xpc3QpCiAgICAgICAgICAgICAgICBkb2Mud3JpdGUoJzpyZWY6YCVzIDxjbGk6JXM+YCcgJSAoY21kLCBmdWxsX2NtZF9uYW1lKSkKICAgICAgICAgICAgZG9jLndyaXRlKCcgXScpCgogICAgZGVmIGRvY190aXRsZShzZWxmLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgZG9jLnN0eWxlLm5ld19wYXJhZ3JhcGgoKQogICAgICAgIHJlZmVyZW5jZSA9IGhlbHBfY29tbWFuZC5ldmVudF9jbGFzcy5yZXBsYWNlKCcuJywgJyAnKQogICAgICAgIGlmIHJlZmVyZW5jZSAhPSAnYXdzJzoKICAgICAgICAgICAgcmVmZXJlbmNlID0gJ2F3cyAnICsgcmVmZXJlbmNlCiAgICAgICAgZG9jLndyaXRlbG4oJy4uIF9jbGk6JXM6JyAlIHJlZmVyZW5jZSkKICAgICAgICBkb2Muc3R5bGUuaDEoaGVscF9jb21tYW5kLm5hbWUpCgogICAgZGVmIGRvY19kZXNjcmlwdGlvbihzZWxmLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgZG9jLnN0eWxlLmgyKCdEZXNjcmlwdGlvbicpCiAgICAgICAgZG9jLmluY2x1ZGVfZG9jX3N0cmluZyhoZWxwX2NvbW1hbmQuZGVzY3JpcHRpb24pCiAgICAgICAgZG9jLnN0eWxlLm5ld19wYXJhZ3JhcGgoKQoKICAgIGRlZiBkb2Nfc3lub3BzaXNfc3RhcnQoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgc2VsZi5fZG9jdW1lbnRlZF9hcmdfZ3JvdXBzID0gW10KICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgZG9jLnN0eWxlLmgyKCdTeW5vcHNpcycpCiAgICAgICAgZG9jLnN0eWxlLnN0YXJ0X2NvZGVibG9jaygpCiAgICAgICAgZG9jLndyaXRlbG4oJyVzJyAlIGhlbHBfY29tbWFuZC5uYW1lKQoKICAgIGRlZiBkb2Nfc3lub3BzaXNfb3B0aW9uKHNlbGYsIGFyZ19uYW1lLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgYXJndW1lbnQgPSBoZWxwX2NvbW1hbmQuYXJnX3RhYmxlW2FyZ19uYW1lXQogICAgICAgIGlmIGFyZ3VtZW50Lmdyb3VwX25hbWUgaW4gc2VsZi5fYXJnX2dyb3VwczoKICAgICAgICAgICAgaWYgYXJndW1lbnQuZ3JvdXBfbmFtZSBpbiBzZWxmLl9kb2N1bWVudGVkX2FyZ19ncm91cHM6CiAgICAgICAgICAgICAgICAjIFRoaXMgYXJnIGlzIGFscmVhZHkgZG9jdW1lbnRlZCBzbyB3ZSBjYW4gbW92ZSBvbi4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBvcHRpb25fc3RyID0gJyB8ICcuam9pbigKICAgICAgICAgICAgICAgIFthLmNsaV9uYW1lIGZvciBhIGluCiAgICAgICAgICAgICAgICAgc2VsZi5fYXJnX2dyb3Vwc1thcmd1bWVudC5ncm91cF9uYW1lXV0pCiAgICAgICAgICAgIHNlbGYuX2RvY3VtZW50ZWRfYXJnX2dyb3Vwcy5hcHBlbmQoYXJndW1lbnQuZ3JvdXBfbmFtZSkKICAgICAgICBlbGlmIGFyZ3VtZW50LmNsaV9uYW1lLnN0YXJ0c3dpdGgoJy0tJyk6CiAgICAgICAgICAgIG9wdGlvbl9zdHIgPSAnJXMgPHZhbHVlPicgJSBhcmd1bWVudC5jbGlfbmFtZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG9wdGlvbl9zdHIgPSAnPCVzPicgJSBhcmd1bWVudC5jbGlfbmFtZQogICAgICAgIGlmIG5vdCAoYXJndW1lbnQucmVxdWlyZWQKICAgICAgICAgICAgICAgIG9yIGdldGF0dHIoYXJndW1lbnQsICdfRE9DVU1FTlRfQVNfUkVRVUlSRUQnLCBGYWxzZSkpOgogICAgICAgICAgICBvcHRpb25fc3RyID0gJ1slc10nICUgb3B0aW9uX3N0cgogICAgICAgIGRvYy53cml0ZWxuKCclcycgJSBvcHRpb25fc3RyKQoKICAgIGRlZiBkb2Nfc3lub3BzaXNfZW5kKHNlbGYsIGhlbHBfY29tbWFuZCwgKiprd2FyZ3MpOgogICAgICAgIGRvYyA9IGhlbHBfY29tbWFuZC5kb2MKICAgICAgICAjIEFwcGVuZCBzeW5vcHNpcyBmb3IgZ2xvYmFsIG9wdGlvbnMuCiAgICAgICAgZG9jLndyaXRlX2Zyb21fZmlsZShHTE9CQUxfT1BUSU9OU19TWU5PUFNJU19GSUxFKQogICAgICAgIGRvYy5zdHlsZS5lbmRfY29kZWJsb2NrKCkKICAgICAgICAjIFJlc2V0IHRoZSBkb2N1bWVudGVkIGFyZyBncm91cHMgZm9yIG90aGVyIHNlY3Rpb25zCiAgICAgICAgIyB0aGF0IG1heSBkb2N1bWVudCBhcmdzICh0aGUgZGV0YWlsZWQgZG9jcyBmb2xsb3dpbmcKICAgICAgICAjIHRoZSBzeW5vcHNpcykuCiAgICAgICAgc2VsZi5fZG9jdW1lbnRlZF9hcmdfZ3JvdXBzID0gW10KCiAgICBkZWYgZG9jX29wdGlvbnNfc3RhcnQoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgIGRvYy5zdHlsZS5oMignT3B0aW9ucycpCiAgICAgICAgaWYgbm90IGhlbHBfY29tbWFuZC5hcmdfdGFibGU6CiAgICAgICAgICAgIGRvYy53cml0ZSgnKk5vbmUqXG4nKQoKICAgIGRlZiBkb2Nfb3B0aW9uKHNlbGYsIGFyZ19uYW1lLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgYXJndW1lbnQgPSBoZWxwX2NvbW1hbmQuYXJnX3RhYmxlW2FyZ19uYW1lXQogICAgICAgIGlmIGFyZ3VtZW50Lmdyb3VwX25hbWUgaW4gc2VsZi5fYXJnX2dyb3VwczoKICAgICAgICAgICAgaWYgYXJndW1lbnQuZ3JvdXBfbmFtZSBpbiBzZWxmLl9kb2N1bWVudGVkX2FyZ19ncm91cHM6CiAgICAgICAgICAgICAgICAjIFRoaXMgYXJnIGlzIGFscmVhZHkgZG9jdW1lbnRlZCBzbyB3ZSBjYW4gbW92ZSBvbi4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBuYW1lID0gJyB8ICcuam9pbigKICAgICAgICAgICAgICAgIFsnYGAlc2BgJyAlIGEuY2xpX25hbWUgZm9yIGEgaW4KICAgICAgICAgICAgICAgICBzZWxmLl9hcmdfZ3JvdXBzW2FyZ3VtZW50Lmdyb3VwX25hbWVdXSkKICAgICAgICAgICAgc2VsZi5fZG9jdW1lbnRlZF9hcmdfZ3JvdXBzLmFwcGVuZChhcmd1bWVudC5ncm91cF9uYW1lKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5hbWUgPSAnYGAlc2BgJyAlIGFyZ3VtZW50LmNsaV9uYW1lCiAgICAgICAgZG9jLndyaXRlKCclcyAoJXMpXG4nICUgKG5hbWUsIHNlbGYuX2dldF9hcmd1bWVudF90eXBlX25hbWUoCiAgICAgICAgICAgIGFyZ3VtZW50LmFyZ3VtZW50X21vZGVsLCBhcmd1bWVudC5jbGlfdHlwZV9uYW1lKSkpCiAgICAgICAgZG9jLnN0eWxlLmluZGVudCgpCiAgICAgICAgZG9jLmluY2x1ZGVfZG9jX3N0cmluZyhhcmd1bWVudC5kb2N1bWVudGF0aW9uKQogICAgICAgIGlmIGlzX3N0cmVhbWluZ19ibG9iX3R5cGUoYXJndW1lbnQuYXJndW1lbnRfbW9kZWwpOgogICAgICAgICAgICBzZWxmLl9hZGRfc3RyZWFtaW5nX2Jsb2Jfbm90ZShkb2MpCiAgICAgICAgaWYgaXNfdGFnZ2VkX3VuaW9uX3R5cGUoYXJndW1lbnQuYXJndW1lbnRfbW9kZWwpOgogICAgICAgICAgICBzZWxmLl9hZGRfdGFnZ2VkX3VuaW9uX25vdGUoYXJndW1lbnQuYXJndW1lbnRfbW9kZWwsIGRvYykKICAgICAgICBpZiBoYXNhdHRyKGFyZ3VtZW50LCAnYXJndW1lbnRfbW9kZWwnKToKICAgICAgICAgICAgc2VsZi5fZG9jdW1lbnRfZW51bXMoYXJndW1lbnQuYXJndW1lbnRfbW9kZWwsIGRvYykKICAgICAgICAgICAgc2VsZi5fZG9jdW1lbnRfbmVzdGVkX3N0cnVjdHVyZShhcmd1bWVudC5hcmd1bWVudF9tb2RlbCwgZG9jKQogICAgICAgIGRvYy5zdHlsZS5kZWRlbnQoKQogICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKCiAgICBkZWYgZG9jX2dsb2JhbF9vcHRpb24oc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgIGRvYy5zdHlsZS5oMignR2xvYmFsIE9wdGlvbnMnKQogICAgICAgIGRvYy53cml0ZV9mcm9tX2ZpbGUoR0xPQkFMX09QVElPTlNfRklMRSkKCiAgICBkZWYgZG9jX3JlbGF0ZWRpdGVtc19zdGFydChzZWxmLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBpZiBoZWxwX2NvbW1hbmQucmVsYXRlZF9pdGVtczoKICAgICAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgICAgICBkb2Muc3R5bGUuaDIoJ1NlZSBBbHNvJykKCiAgICBkZWYgZG9jX3JlbGF0ZWRpdGVtKHNlbGYsIGhlbHBfY29tbWFuZCwgcmVsYXRlZF9pdGVtLCAqKmt3YXJncyk6CiAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgIGRvYy53cml0ZSgnKiAnKQogICAgICAgIGRvYy5zdHlsZS5zcGhpbnhfcmVmZXJlbmNlX2xhYmVsKAogICAgICAgICAgICBsYWJlbD0nY2xpOiVzJyAlIHJlbGF0ZWRfaXRlbSwKICAgICAgICAgICAgdGV4dD1yZWxhdGVkX2l0ZW0KICAgICAgICApCiAgICAgICAgZG9jLndyaXRlKCdcbicpCgogICAgZGVmIF9kb2N1bWVudF9lbnVtcyhzZWxmLCBtb2RlbCwgZG9jKToKICAgICAgICAiIiJEb2N1bWVudHMgdG9wLWxldmVsIHBhcmFtZXRlciBlbnVtcyIiIgogICAgICAgIGlmIGlzaW5zdGFuY2UobW9kZWwsIFN0cmluZ1NoYXBlKToKICAgICAgICAgICAgaWYgbW9kZWwuZW51bToKICAgICAgICAgICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICAgICAgICAgIGRvYy53cml0ZSgnUG9zc2libGUgdmFsdWVzOicpCiAgICAgICAgICAgICAgICBkb2Muc3R5bGUuc3RhcnRfdWwoKQogICAgICAgICAgICAgICAgZm9yIGVudW0gaW4gbW9kZWwuZW51bToKICAgICAgICAgICAgICAgICAgICBkb2Muc3R5bGUubGkoJ2BgJXNgYCcgJSBlbnVtKQogICAgICAgICAgICAgICAgZG9jLnN0eWxlLmVuZF91bCgpCgogICAgZGVmIF9kb2N1bWVudF9uZXN0ZWRfc3RydWN0dXJlKHNlbGYsIG1vZGVsLCBkb2MpOgogICAgICAgICIiIlJlY3Vyc2l2ZWx5IGRvY3VtZW50cyBwYXJhbWV0ZXJzIGluIG5lc3RlZCBzdHJ1Y3R1cmVzIiIiCiAgICAgICAgbWVtYmVyX3R5cGVfbmFtZSA9IGdldGF0dHIobW9kZWwsICd0eXBlX25hbWUnLCBOb25lKQogICAgICAgIGlmIG1lbWJlcl90eXBlX25hbWUgPT0gJ3N0cnVjdHVyZSc6CiAgICAgICAgICAgIGZvciBtZW1iZXJfbmFtZSwgbWVtYmVyX3NoYXBlIGluIG1vZGVsLm1lbWJlcnMuaXRlbXMoKToKICAgICAgICAgICAgICAgIHNlbGYuX2RvY19tZW1iZXIoZG9jLCBtZW1iZXJfbmFtZSwgbWVtYmVyX3NoYXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjaz1bbW9kZWwubmFtZV0pCiAgICAgICAgZWxpZiBtZW1iZXJfdHlwZV9uYW1lID09ICdsaXN0JzoKICAgICAgICAgICAgc2VsZi5fZG9jX21lbWJlcihkb2MsICcnLCBtb2RlbC5tZW1iZXIsIHN0YWNrPVttb2RlbC5uYW1lXSkKICAgICAgICBlbGlmIG1lbWJlcl90eXBlX25hbWUgPT0gJ21hcCc6CiAgICAgICAgICAgIGtleV9zaGFwZSA9IG1vZGVsLmtleQogICAgICAgICAgICBrZXlfbmFtZSA9IGtleV9zaGFwZS5zZXJpYWxpemF0aW9uLmdldCgnbmFtZScsICdrZXknKQogICAgICAgICAgICBzZWxmLl9kb2NfbWVtYmVyKGRvYywga2V5X25hbWUsIGtleV9zaGFwZSwgc3RhY2s9W21vZGVsLm5hbWVdKQogICAgICAgICAgICB2YWx1ZV9zaGFwZSA9IG1vZGVsLnZhbHVlCiAgICAgICAgICAgIHZhbHVlX25hbWUgPSB2YWx1ZV9zaGFwZS5zZXJpYWxpemF0aW9uLmdldCgnbmFtZScsICd2YWx1ZScpCiAgICAgICAgICAgIHNlbGYuX2RvY19tZW1iZXIoZG9jLCB2YWx1ZV9uYW1lLCB2YWx1ZV9zaGFwZSwgc3RhY2s9W21vZGVsLm5hbWVdKQoKICAgIGRlZiBfZG9jX21lbWJlcihzZWxmLCBkb2MsIG1lbWJlcl9uYW1lLCBtZW1iZXJfc2hhcGUsIHN0YWNrKToKICAgICAgICBpZiBtZW1iZXJfc2hhcGUubmFtZSBpbiBzdGFjazoKICAgICAgICAgICAgIyBEb2N1bWVudCB0aGUgcmVjdXJzaW9uIG9uY2UsIG90aGVyd2lzZSBqdXN0CiAgICAgICAgICAgICMgbm90ZSB0aGUgZmFjdCB0aGF0IGl0J3MgcmVjdXJzaXZlIGFuZCByZXR1cm4uCiAgICAgICAgICAgIGlmIHN0YWNrLmNvdW50KG1lbWJlcl9zaGFwZS5uYW1lKSA+IDE6CiAgICAgICAgICAgICAgICBpZiBtZW1iZXJfc2hhcGUudHlwZV9uYW1lID09ICdzdHJ1Y3R1cmUnOgogICAgICAgICAgICAgICAgICAgIGRvYy53cml0ZSgnKCAuLi4gcmVjdXJzaXZlIC4uLiApJykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgIHN0YWNrLmFwcGVuZChtZW1iZXJfc2hhcGUubmFtZSkKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuX2RvX2RvY19tZW1iZXIoZG9jLCBtZW1iZXJfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW1iZXJfc2hhcGUsIHN0YWNrKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIHN0YWNrLnBvcCgpCgogICAgZGVmIF9kb19kb2NfbWVtYmVyKHNlbGYsIGRvYywgbWVtYmVyX25hbWUsIG1lbWJlcl9zaGFwZSwgc3RhY2spOgogICAgICAgIGRvY3MgPSBtZW1iZXJfc2hhcGUuZG9jdW1lbnRhdGlvbgogICAgICAgIHR5cGVfbmFtZSA9IHNlbGYuX2dldF9hcmd1bWVudF90eXBlX25hbWUoCiAgICAgICAgICAgIG1lbWJlcl9zaGFwZSwgbWVtYmVyX3NoYXBlLnR5cGVfbmFtZSkKICAgICAgICBpZiBtZW1iZXJfbmFtZToKICAgICAgICAgICAgZG9jLndyaXRlKCclcyAtPiAoJXMpJyAlIChtZW1iZXJfbmFtZSwgdHlwZV9uYW1lKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBkb2Mud3JpdGUoJyglcyknICUgdHlwZV9uYW1lKQogICAgICAgIGRvYy5zdHlsZS5pbmRlbnQoKQogICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICBkb2MuaW5jbHVkZV9kb2Nfc3RyaW5nKGRvY3MpCiAgICAgICAgaWYgaXNfdGFnZ2VkX3VuaW9uX3R5cGUobWVtYmVyX3NoYXBlKToKICAgICAgICAgICAgc2VsZi5fYWRkX3RhZ2dlZF91bmlvbl9ub3RlKG1lbWJlcl9zaGFwZSwgZG9jKQogICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICBtZW1iZXJfdHlwZV9uYW1lID0gbWVtYmVyX3NoYXBlLnR5cGVfbmFtZQogICAgICAgIGlmIG1lbWJlcl90eXBlX25hbWUgPT0gJ3N0cnVjdHVyZSc6CiAgICAgICAgICAgIGZvciBzdWJfbmFtZSwgc3ViX3NoYXBlIGluIG1lbWJlcl9zaGFwZS5tZW1iZXJzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBzZWxmLl9kb2NfbWVtYmVyKGRvYywgc3ViX25hbWUsIHN1Yl9zaGFwZSwgc3RhY2spCiAgICAgICAgZWxpZiBtZW1iZXJfdHlwZV9uYW1lID09ICdtYXAnOgogICAgICAgICAgICBrZXlfc2hhcGUgPSBtZW1iZXJfc2hhcGUua2V5CiAgICAgICAgICAgIGtleV9uYW1lID0ga2V5X3NoYXBlLnNlcmlhbGl6YXRpb24uZ2V0KCduYW1lJywgJ2tleScpCiAgICAgICAgICAgIHNlbGYuX2RvY19tZW1iZXIoZG9jLCBrZXlfbmFtZSwga2V5X3NoYXBlLCBzdGFjaykKICAgICAgICAgICAgdmFsdWVfc2hhcGUgPSBtZW1iZXJfc2hhcGUudmFsdWUKICAgICAgICAgICAgdmFsdWVfbmFtZSA9IHZhbHVlX3NoYXBlLnNlcmlhbGl6YXRpb24uZ2V0KCduYW1lJywgJ3ZhbHVlJykKICAgICAgICAgICAgc2VsZi5fZG9jX21lbWJlcihkb2MsIHZhbHVlX25hbWUsIHZhbHVlX3NoYXBlLCBzdGFjaykKICAgICAgICBlbGlmIG1lbWJlcl90eXBlX25hbWUgPT0gJ2xpc3QnOgogICAgICAgICAgICBzZWxmLl9kb2NfbWVtYmVyKGRvYywgJycsIG1lbWJlcl9zaGFwZS5tZW1iZXIsIHN0YWNrKQogICAgICAgIGRvYy5zdHlsZS5kZWRlbnQoKQogICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKCiAgICBkZWYgX2FkZF9zdHJlYW1pbmdfYmxvYl9ub3RlKHNlbGYsIGRvYyk6CiAgICAgICAgZG9jLnN0eWxlLnN0YXJ0X25vdGUoKQogICAgICAgIG1zZyA9ICgiVGhpcyBhcmd1bWVudCBpcyBvZiB0eXBlOiBzdHJlYW1pbmcgYmxvYi4gIgogICAgICAgICAgICAgICAiSXRzIHZhbHVlIG11c3QgYmUgdGhlIHBhdGggdG8gYSBmaWxlICIKICAgICAgICAgICAgICAgIihlLmcuIGBgcGF0aC90by9maWxlYGApIGFuZCBtdXN0ICoqbm90KiogIgogICAgICAgICAgICAgICAiYmUgcHJlZml4ZWQgd2l0aCBgYGZpbGU6Ly9gYCBvciBgYGZpbGViOi8vYGAiKQogICAgICAgIGRvYy53cml0ZWxuKG1zZykKICAgICAgICBkb2Muc3R5bGUuZW5kX25vdGUoKQoKICAgIGRlZiBfYWRkX3RhZ2dlZF91bmlvbl9ub3RlKHNlbGYsIHNoYXBlLCBkb2MpOgogICAgICAgIGRvYy5zdHlsZS5zdGFydF9ub3RlKCkKICAgICAgICBtZW1iZXJzX3N0ciA9ICIsICIuam9pbigKICAgICAgICAgICAgW2YnYGB7a2V5fWBgJyBmb3Iga2V5IGluIHNoYXBlLm1lbWJlcnMua2V5cygpXQogICAgICAgICkKICAgICAgICBtc2cgPSAoIlRoaXMgaXMgYSBUYWdnZWQgVW5pb24gc3RydWN0dXJlLiBPbmx5IG9uZSBvZiB0aGUgIgogICAgICAgICAgICAgICBmImZvbGxvd2luZyB0b3AgbGV2ZWwga2V5cyBjYW4gYmUgc2V0OiB7bWVtYmVyc19zdHJ9LiIpCiAgICAgICAgZG9jLndyaXRlbG4obXNnKQogICAgICAgIGRvYy5zdHlsZS5lbmRfbm90ZSgpCgoKY2xhc3MgUHJvdmlkZXJEb2N1bWVudEV2ZW50SGFuZGxlcihDTElEb2N1bWVudEV2ZW50SGFuZGxlcik6CgogICAgZGVmIGRvY19icmVhZGNydW1icyhzZWxmLCBoZWxwX2NvbW1hbmQsIGV2ZW50X25hbWUsICoqa3dhcmdzKToKICAgICAgICBwYXNzCgogICAgZGVmIGRvY19zeW5vcHNpc19zdGFydChzZWxmLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgZG9jLnN0eWxlLmgyKCdTeW5vcHNpcycpCiAgICAgICAgZG9jLnN0eWxlLmNvZGVibG9jayhoZWxwX2NvbW1hbmQuc3lub3BzaXMpCiAgICAgICAgZG9jLmluY2x1ZGVfZG9jX3N0cmluZyhoZWxwX2NvbW1hbmQuaGVscF91c2FnZSkKCiAgICBkZWYgZG9jX3N5bm9wc2lzX29wdGlvbihzZWxmLCBhcmdfbmFtZSwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBkb2Nfc3lub3BzaXNfZW5kKHNlbGYsIGhlbHBfY29tbWFuZCwgKiprd2FyZ3MpOgogICAgICAgIGRvYyA9IGhlbHBfY29tbWFuZC5kb2MKICAgICAgICBkb2Muc3R5bGUubmV3X3BhcmFncmFwaCgpCgogICAgZGVmIGRvY19vcHRpb25zX3N0YXJ0KHNlbGYsIGhlbHBfY29tbWFuZCwgKiprd2FyZ3MpOgogICAgICAgIHBhc3MKCiAgICBkZWYgZG9jX29wdGlvbihzZWxmLCBhcmdfbmFtZSwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBkb2Nfc3ViaXRlbXNfc3RhcnQoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgIGRvYy5zdHlsZS5oMignQXZhaWxhYmxlIFNlcnZpY2VzJykKICAgICAgICBkb2Muc3R5bGUudG9jdHJlZSgpCgogICAgZGVmIGRvY19zdWJpdGVtKHNlbGYsIGNvbW1hbmRfbmFtZSwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgIGZpbGVfbmFtZSA9ICclcy9pbmRleCcgJSBjb21tYW5kX25hbWUKICAgICAgICBkb2Muc3R5bGUudG9jaXRlbShjb21tYW5kX25hbWUsIGZpbGVfbmFtZT1maWxlX25hbWUpCgoKY2xhc3MgU2VydmljZURvY3VtZW50RXZlbnRIYW5kbGVyKENMSURvY3VtZW50RXZlbnRIYW5kbGVyKToKCiAgICAjIEEgc2VydmljZSBkb2N1bWVudCBoYXMgbm8gc3lub3BzaXMuCiAgICBkZWYgZG9jX3N5bm9wc2lzX3N0YXJ0KHNlbGYsIGhlbHBfY29tbWFuZCwgKiprd2FyZ3MpOgogICAgICAgIHBhc3MKCiAgICBkZWYgZG9jX3N5bm9wc2lzX29wdGlvbihzZWxmLCBhcmdfbmFtZSwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBkb2Nfc3lub3BzaXNfZW5kKHNlbGYsIGhlbHBfY29tbWFuZCwgKiprd2FyZ3MpOgogICAgICAgIHBhc3MKCiAgICAjIEEgc2VydmljZSBkb2N1bWVudCBoYXMgbm8gb3B0aW9uIHNlY3Rpb24uCiAgICBkZWYgZG9jX29wdGlvbnNfc3RhcnQoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBkb2Nfb3B0aW9uKHNlbGYsIGFyZ19uYW1lLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBwYXNzCgogICAgZGVmIGRvY19vcHRpb25fZXhhbXBsZShzZWxmLCBhcmdfbmFtZSwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBkb2Nfb3B0aW9uc19lbmQoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBkb2NfZ2xvYmFsX29wdGlvbihzZWxmLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBwYXNzCgogICAgZGVmIGRvY19kZXNjcmlwdGlvbihzZWxmLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgc2VydmljZV9tb2RlbCA9IGhlbHBfY29tbWFuZC5vYmoKICAgICAgICBkb2Muc3R5bGUuaDIoJ0Rlc2NyaXB0aW9uJykKICAgICAgICAjIFRPRE86IG5lZWQgYSBkb2N1bWVudGF0aW9uIGF0dHJpYnV0ZS4KICAgICAgICBkb2MuaW5jbHVkZV9kb2Nfc3RyaW5nKHNlcnZpY2VfbW9kZWwuZG9jdW1lbnRhdGlvbikKCiAgICBkZWYgZG9jX3N1Yml0ZW1zX3N0YXJ0KHNlbGYsIGhlbHBfY29tbWFuZCwgKiprd2FyZ3MpOgogICAgICAgIGRvYyA9IGhlbHBfY29tbWFuZC5kb2MKICAgICAgICBkb2Muc3R5bGUuaDIoJ0F2YWlsYWJsZSBDb21tYW5kcycpCiAgICAgICAgZG9jLnN0eWxlLnRvY3RyZWUoKQoKICAgIGRlZiBkb2Nfc3ViaXRlbShzZWxmLCBjb21tYW5kX25hbWUsIGhlbHBfY29tbWFuZCwgKiprd2FyZ3MpOgogICAgICAgIGRvYyA9IGhlbHBfY29tbWFuZC5kb2MKICAgICAgICBzdWJjb21tYW5kID0gaGVscF9jb21tYW5kLmNvbW1hbmRfdGFibGVbY29tbWFuZF9uYW1lXQogICAgICAgIHN1YmNvbW1hbmRfdGFibGUgPSBnZXRhdHRyKHN1YmNvbW1hbmQsICdzdWJjb21tYW5kX3RhYmxlJywge30pCiAgICAgICAgIyBJZiB0aGUgc3ViY29tbWFuZCB0YWJsZSBoYXMgY29tbWFuZHMgaW4gaXQsCiAgICAgICAgIyBkaXJlY3QgdGhlIHN1Yml0ZW0gdG8gdGhlIGNvbW1hbmQncyBpbmRleCBiZWNhdXNlCiAgICAgICAgIyBpdCBoYXMgbW9yZSBzdWJjb21tYW5kcyB0byBiZSBkb2N1bWVudGVkLgogICAgICAgIGlmIChsZW4oc3ViY29tbWFuZF90YWJsZSkgPiAwKToKICAgICAgICAgICAgZmlsZV9uYW1lID0gJyVzL2luZGV4JyAlIGNvbW1hbmRfbmFtZQogICAgICAgICAgICBkb2Muc3R5bGUudG9jaXRlbShjb21tYW5kX25hbWUsIGZpbGVfbmFtZT1maWxlX25hbWUpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZG9jLnN0eWxlLnRvY2l0ZW0oY29tbWFuZF9uYW1lKQoKCmNsYXNzIE9wZXJhdGlvbkRvY3VtZW50RXZlbnRIYW5kbGVyKENMSURvY3VtZW50RXZlbnRIYW5kbGVyKToKCiAgICBBV1NfRE9DX0JBU0UgPSAnaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2dvdG8vV2ViQVBJJwoKICAgIGRlZiBkb2NfZGVzY3JpcHRpb24oc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgIG9wZXJhdGlvbl9tb2RlbCA9IGhlbHBfY29tbWFuZC5vYmoKICAgICAgICBkb2Muc3R5bGUuaDIoJ0Rlc2NyaXB0aW9uJykKICAgICAgICBkb2MuaW5jbHVkZV9kb2Nfc3RyaW5nKG9wZXJhdGlvbl9tb2RlbC5kb2N1bWVudGF0aW9uKQogICAgICAgIHNlbGYuX2FkZF93ZWJhcGlfY3Jvc3NsaW5rKGhlbHBfY29tbWFuZCkKICAgICAgICBzZWxmLl9hZGRfbm90ZV9mb3JfZG9jdW1lbnRfdHlwZXNfaWZfdXNlZChoZWxwX2NvbW1hbmQpCgoKICAgIGRlZiBfYWRkX3dlYmFwaV9jcm9zc2xpbmsoc2VsZiwgaGVscF9jb21tYW5kKToKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgb3BlcmF0aW9uX21vZGVsID0gaGVscF9jb21tYW5kLm9iagogICAgICAgIHNlcnZpY2VfbW9kZWwgPSBvcGVyYXRpb25fbW9kZWwuc2VydmljZV9tb2RlbAogICAgICAgIHNlcnZpY2VfdWlkID0gc2VydmljZV9tb2RlbC5tZXRhZGF0YS5nZXQoJ3VpZCcpCiAgICAgICAgaWYgc2VydmljZV91aWQgaXMgTm9uZToKICAgICAgICAgICAgIyBJZiB0aGVyZSdzIG5vIHNlcnZpY2VfdWlkIGluIHRoZSBtb2RlbCwgd2UgY2FuJ3QKICAgICAgICAgICAgIyBiZSBjZXJ0YWluIGlmIHRoZSBnZW5lcmF0ZWQgY3Jvc3MgbGluayB3aWxsIHdvcmsKICAgICAgICAgICAgIyBzbyB3ZSBkb24ndCBnZW5lcmF0ZSBhbnkgY3Jvc3NsaW5rIGluZm8uCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICBkb2Mud3JpdGUoIlNlZSBhbHNvOiAiKQogICAgICAgIGxpbmsgPSAnJXMvJXMvJXMnICUgKHNlbGYuQVdTX0RPQ19CQVNFLCBzZXJ2aWNlX3VpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb25fbW9kZWwubmFtZSkKICAgICAgICBkb2Muc3R5bGUuZXh0ZXJuYWxfbGluayh0aXRsZT0iQVdTIEFQSSBEb2N1bWVudGF0aW9uIiwgbGluaz1saW5rKQogICAgICAgIGRvYy53cml0ZWxuKCcnKQoKICAgIGRlZiBfYWRkX25vdGVfZm9yX2RvY3VtZW50X3R5cGVzX2lmX3VzZWQoc2VsZiwgaGVscF9jb21tYW5kKToKICAgICAgICBpZiBvcGVyYXRpb25fdXNlc19kb2N1bWVudF90eXBlcyhoZWxwX2NvbW1hbmQub2JqKToKICAgICAgICAgICAgaGVscF9jb21tYW5kLmRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICAgICAgaGVscF9jb21tYW5kLmRvYy53cml0ZWxuKAogICAgICAgICAgICAgICAgJ2BgJXNgYCB1c2VzIGRvY3VtZW50IHR5cGUgdmFsdWVzLiBEb2N1bWVudCB0eXBlcyBmb2xsb3cgdGhlICcKICAgICAgICAgICAgICAgICdKU09OIGRhdGEgbW9kZWwgd2hlcmUgdmFsaWQgdmFsdWVzIGFyZTogc3RyaW5ncywgbnVtYmVycywgJwogICAgICAgICAgICAgICAgJ2Jvb2xlYW5zLCBudWxsLCBhcnJheXMsIGFuZCBvYmplY3RzLiBGb3IgY29tbWFuZCBpbnB1dCwgJwogICAgICAgICAgICAgICAgJ29wdGlvbnMgYW5kIG5lc3RlZCBwYXJhbWV0ZXJzIHRoYXQgYXJlIGxhYmVsZWQgd2l0aCB0aGUgdHlwZSAnCiAgICAgICAgICAgICAgICAnYGBkb2N1bWVudGBgIG11c3QgYmUgcHJvdmlkZWQgYXMgSlNPTi4gU2hvcnRoYW5kIHN5bnRheCBkb2VzICcKICAgICAgICAgICAgICAgICdub3Qgc3VwcG9ydCBkb2N1bWVudCB0eXBlcy4nICUgaGVscF9jb21tYW5kLm5hbWUKICAgICAgICAgICAgKQoKICAgIGRlZiBfanNvbl9leGFtcGxlX3ZhbHVlX25hbWUoc2VsZiwgYXJndW1lbnRfbW9kZWwsIGluY2x1ZGVfZW51bV92YWx1ZXM9VHJ1ZSk6CiAgICAgICAgIyBJZiBpbmNsdWRlX2VudW1fdmFsdWVzIGlzIFRydWUsIHRoZW4gdGhlIHZhbGlkIGVudW0gdmFsdWVzCiAgICAgICAgIyBhcmUgaW5jbHVkZWQgYXMgdGhlIHNhbXBsZSBKU09OIHZhbHVlLgogICAgICAgIGlmIGlzaW5zdGFuY2UoYXJndW1lbnRfbW9kZWwsIFN0cmluZ1NoYXBlKToKICAgICAgICAgICAgaWYgYXJndW1lbnRfbW9kZWwuZW51bSBhbmQgaW5jbHVkZV9lbnVtX3ZhbHVlczoKICAgICAgICAgICAgICAgIGNob2ljZXMgPSBhcmd1bWVudF9tb2RlbC5lbnVtCiAgICAgICAgICAgICAgICByZXR1cm4gJ3wnLmpvaW4oWyciJXMiJyAlIGMgZm9yIGMgaW4gY2hvaWNlc10pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gJyJzdHJpbmciJwogICAgICAgIGVsaWYgYXJndW1lbnRfbW9kZWwudHlwZV9uYW1lID09ICdib29sZWFuJzoKICAgICAgICAgICAgcmV0dXJuICd0cnVlfGZhbHNlJwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAnJXMnICUgYXJndW1lbnRfbW9kZWwudHlwZV9uYW1lCgogICAgZGVmIF9qc29uX2V4YW1wbGUoc2VsZiwgZG9jLCBhcmd1bWVudF9tb2RlbCwgc3RhY2spOgogICAgICAgIGlmIGFyZ3VtZW50X21vZGVsLm5hbWUgaW4gc3RhY2s6CiAgICAgICAgICAgICMgRG9jdW1lbnQgdGhlIHJlY3Vyc2lvbiBvbmNlLCBvdGhlcndpc2UganVzdAogICAgICAgICAgICAjIG5vdGUgdGhlIGZhY3QgdGhhdCBpdCdzIHJlY3Vyc2l2ZSBhbmQgcmV0dXJuLgogICAgICAgICAgICBpZiBzdGFjay5jb3VudChhcmd1bWVudF9tb2RlbC5uYW1lKSA+IDE6CiAgICAgICAgICAgICAgICBpZiBhcmd1bWVudF9tb2RlbC50eXBlX25hbWUgPT0gJ3N0cnVjdHVyZSc6CiAgICAgICAgICAgICAgICAgICAgZG9jLndyaXRlKCd7IC4uLiByZWN1cnNpdmUgLi4uIH0nKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgc3RhY2suYXBwZW5kKGFyZ3VtZW50X21vZGVsLm5hbWUpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLl9kb19qc29uX2V4YW1wbGUoZG9jLCBhcmd1bWVudF9tb2RlbCwgc3RhY2spCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgc3RhY2sucG9wKCkKCiAgICBkZWYgX2RvX2pzb25fZXhhbXBsZShzZWxmLCBkb2MsIGFyZ3VtZW50X21vZGVsLCBzdGFjayk6CiAgICAgICAgaWYgYXJndW1lbnRfbW9kZWwudHlwZV9uYW1lID09ICdsaXN0JzoKICAgICAgICAgICAgZG9jLndyaXRlKCdbJykKICAgICAgICAgICAgaWYgYXJndW1lbnRfbW9kZWwubWVtYmVyLnR5cGVfbmFtZSBpbiBTQ0FMQVJfVFlQRVM6CiAgICAgICAgICAgICAgICBkb2Mud3JpdGUoJyVzLCAuLi4nICUgc2VsZi5fanNvbl9leGFtcGxlX3ZhbHVlX25hbWUoYXJndW1lbnRfbW9kZWwubWVtYmVyKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGRvYy5zdHlsZS5pbmRlbnQoKQogICAgICAgICAgICAgICAgZG9jLnN0eWxlLm5ld19saW5lKCkKICAgICAgICAgICAgICAgIHNlbGYuX2pzb25fZXhhbXBsZShkb2MsIGFyZ3VtZW50X21vZGVsLm1lbWJlciwgc3RhY2spCiAgICAgICAgICAgICAgICBkb2Muc3R5bGUubmV3X2xpbmUoKQogICAgICAgICAgICAgICAgZG9jLndyaXRlKCcuLi4nKQogICAgICAgICAgICAgICAgZG9jLnN0eWxlLmRlZGVudCgpCiAgICAgICAgICAgICAgICBkb2Muc3R5bGUubmV3X2xpbmUoKQogICAgICAgICAgICBkb2Mud3JpdGUoJ10nKQogICAgICAgIGVsaWYgYXJndW1lbnRfbW9kZWwudHlwZV9uYW1lID09ICdtYXAnOgogICAgICAgICAgICBkb2Mud3JpdGUoJ3snKQogICAgICAgICAgICBkb2Muc3R5bGUuaW5kZW50KCkKICAgICAgICAgICAga2V5X3N0cmluZyA9IHNlbGYuX2pzb25fZXhhbXBsZV92YWx1ZV9uYW1lKGFyZ3VtZW50X21vZGVsLmtleSkKICAgICAgICAgICAgZG9jLndyaXRlKCclczogJyAlIGtleV9zdHJpbmcpCiAgICAgICAgICAgIGlmIGFyZ3VtZW50X21vZGVsLnZhbHVlLnR5cGVfbmFtZSBpbiBTQ0FMQVJfVFlQRVM6CiAgICAgICAgICAgICAgICBkb2Mud3JpdGUoc2VsZi5fanNvbl9leGFtcGxlX3ZhbHVlX25hbWUoYXJndW1lbnRfbW9kZWwudmFsdWUpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZG9jLnN0eWxlLmluZGVudCgpCiAgICAgICAgICAgICAgICBzZWxmLl9qc29uX2V4YW1wbGUoZG9jLCBhcmd1bWVudF9tb2RlbC52YWx1ZSwgc3RhY2spCiAgICAgICAgICAgICAgICBkb2Muc3R5bGUuZGVkZW50KCkKICAgICAgICAgICAgZG9jLnN0eWxlLm5ld19saW5lKCkKICAgICAgICAgICAgZG9jLndyaXRlKCcuLi4nKQogICAgICAgICAgICBkb2Muc3R5bGUuZGVkZW50KCkKICAgICAgICAgICAgZG9jLndyaXRlKCd9JykKICAgICAgICBlbGlmIGFyZ3VtZW50X21vZGVsLnR5cGVfbmFtZSA9PSAnc3RydWN0dXJlJzoKICAgICAgICAgICAgaWYgYXJndW1lbnRfbW9kZWwuaXNfZG9jdW1lbnRfdHlwZToKICAgICAgICAgICAgICAgIHNlbGYuX2RvY19kb2N1bWVudF9tZW1iZXIoZG9jKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5fZG9jX2lucHV0X3N0cnVjdHVyZV9tZW1iZXJzKGRvYywgYXJndW1lbnRfbW9kZWwsIHN0YWNrKQoKICAgIGRlZiBfZG9jX2RvY3VtZW50X21lbWJlcihzZWxmLCBkb2MpOgogICAgICAgIGRvYy53cml0ZSgney4uLn0nKQoKICAgIGRlZiBfZG9jX2lucHV0X3N0cnVjdHVyZV9tZW1iZXJzKHNlbGYsIGRvYywgYXJndW1lbnRfbW9kZWwsIHN0YWNrKToKICAgICAgICBkb2Mud3JpdGUoJ3snKQogICAgICAgIGRvYy5zdHlsZS5pbmRlbnQoKQogICAgICAgIGRvYy5zdHlsZS5uZXdfbGluZSgpCiAgICAgICAgbWVtYmVycyA9IGFyZ3VtZW50X21vZGVsLm1lbWJlcnMKICAgICAgICBmb3IgaSwgbWVtYmVyX25hbWUgaW4gZW51bWVyYXRlKG1lbWJlcnMpOgogICAgICAgICAgICBtZW1iZXJfbW9kZWwgPSBtZW1iZXJzW21lbWJlcl9uYW1lXQogICAgICAgICAgICBtZW1iZXJfdHlwZV9uYW1lID0gbWVtYmVyX21vZGVsLnR5cGVfbmFtZQogICAgICAgICAgICBpZiBtZW1iZXJfdHlwZV9uYW1lIGluIFNDQUxBUl9UWVBFUzoKICAgICAgICAgICAgICAgIGRvYy53cml0ZSgnIiVzIjogJXMnICUgKG1lbWJlcl9uYW1lLAogICAgICAgICAgICAgICAgICAgIHNlbGYuX2pzb25fZXhhbXBsZV92YWx1ZV9uYW1lKG1lbWJlcl9tb2RlbCkpKQogICAgICAgICAgICBlbGlmIG1lbWJlcl90eXBlX25hbWUgPT0gJ3N0cnVjdHVyZSc6CiAgICAgICAgICAgICAgICBkb2Mud3JpdGUoJyIlcyI6ICcgJSBtZW1iZXJfbmFtZSkKICAgICAgICAgICAgICAgIHNlbGYuX2pzb25fZXhhbXBsZShkb2MsIG1lbWJlcl9tb2RlbCwgc3RhY2spCiAgICAgICAgICAgIGVsaWYgbWVtYmVyX3R5cGVfbmFtZSA9PSAnbWFwJzoKICAgICAgICAgICAgICAgIGRvYy53cml0ZSgnIiVzIjogJyAlIG1lbWJlcl9uYW1lKQogICAgICAgICAgICAgICAgc2VsZi5fanNvbl9leGFtcGxlKGRvYywgbWVtYmVyX21vZGVsLCBzdGFjaykKICAgICAgICAgICAgZWxpZiBtZW1iZXJfdHlwZV9uYW1lID09ICdsaXN0JzoKICAgICAgICAgICAgICAgIGRvYy53cml0ZSgnIiVzIjogJyAlIG1lbWJlcl9uYW1lKQogICAgICAgICAgICAgICAgc2VsZi5fanNvbl9leGFtcGxlKGRvYywgbWVtYmVyX21vZGVsLCBzdGFjaykKICAgICAgICAgICAgaWYgaSA8IGxlbihtZW1iZXJzKSAtIDE6CiAgICAgICAgICAgICAgICBkb2Mud3JpdGUoJywnKQogICAgICAgICAgICAgICAgZG9jLnN0eWxlLm5ld19saW5lKCkKICAgICAgICBkb2Muc3R5bGUuZGVkZW50KCkKICAgICAgICBkb2Muc3R5bGUubmV3X2xpbmUoKQogICAgICAgIGRvYy53cml0ZSgnfScpCgogICAgZGVmIGRvY19vcHRpb25fZXhhbXBsZShzZWxmLCBhcmdfbmFtZSwgaGVscF9jb21tYW5kLCBldmVudF9uYW1lLCAqKmt3YXJncyk6CiAgICAgICAgc2VydmljZV9pZCwgb3BlcmF0aW9uX25hbWUgPSBcCiAgICAgICAgICAgIGZpbmRfc2VydmljZV9hbmRfbWV0aG9kX2luX2V2ZW50X25hbWUoZXZlbnRfbmFtZSkKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgY2xpX2FyZ3VtZW50ID0gaGVscF9jb21tYW5kLmFyZ190YWJsZVthcmdfbmFtZV0KICAgICAgICBpZiBjbGlfYXJndW1lbnQuZ3JvdXBfbmFtZSBpbiBzZWxmLl9hcmdfZ3JvdXBzOgogICAgICAgICAgICBpZiBjbGlfYXJndW1lbnQuZ3JvdXBfbmFtZSBpbiBzZWxmLl9kb2N1bWVudGVkX2FyZ19ncm91cHM6CiAgICAgICAgICAgICAgICAjIEFyZ3Mgd2l0aCBncm91cF9uYW1lcyAoYm9vbGVhbiBhcmdzKSBkb24ndAogICAgICAgICAgICAgICAgIyBuZWVkIHRvIGdlbmVyYXRlIGV4YW1wbGUgc3ludGF4LgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgYXJndW1lbnRfbW9kZWwgPSBjbGlfYXJndW1lbnQuYXJndW1lbnRfbW9kZWwKICAgICAgICBkb2NnZW4gPSBQYXJhbVNob3J0aGFuZERvY0dlbigpCiAgICAgICAgaWYgZG9jZ2VuLnN1cHBvcnRzX3Nob3J0aGFuZChjbGlfYXJndW1lbnQuYXJndW1lbnRfbW9kZWwpOgogICAgICAgICAgICBleGFtcGxlX3Nob3J0aGFuZF9zeW50YXggPSBkb2NnZW4uZ2VuZXJhdGVfc2hvcnRoYW5kX2V4YW1wbGUoCiAgICAgICAgICAgICAgICBjbGlfYXJndW1lbnQsIHNlcnZpY2VfaWQsIG9wZXJhdGlvbl9uYW1lKQogICAgICAgICAgICBpZiBleGFtcGxlX3Nob3J0aGFuZF9zeW50YXggaXMgTm9uZToKICAgICAgICAgICAgICAgICMgSWYgdGhlIHNob3J0aGFuZCBzeW50YXggcmV0dXJucyBhIHZhbHVlIG9mIE5vbmUsCiAgICAgICAgICAgICAgICAjIHRoaXMgaW5kaWNhdGVzIHRvIHVzIHRoYXQgdGhlcmUgaXMgbm8gZXhhbXBsZQogICAgICAgICAgICAgICAgIyBuZWVkZWQgZm9yIHRoaXMgcGFyYW0gc28gd2UgY2FuIGltbWVkaWF0ZWx5CiAgICAgICAgICAgICAgICAjIHJldHVybi4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBpZiBleGFtcGxlX3Nob3J0aGFuZF9zeW50YXg6CiAgICAgICAgICAgICAgICBkb2Muc3R5bGUubmV3X3BhcmFncmFwaCgpCiAgICAgICAgICAgICAgICBkb2Mud3JpdGUoJ1Nob3J0aGFuZCBTeW50YXgnKQogICAgICAgICAgICAgICAgZG9jLnN0eWxlLnN0YXJ0X2NvZGVibG9jaygpCiAgICAgICAgICAgICAgICBmb3IgZXhhbXBsZV9saW5lIGluIGV4YW1wbGVfc2hvcnRoYW5kX3N5bnRheC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgICAgICAgICAgZG9jLndyaXRlbG4oZXhhbXBsZV9saW5lKQogICAgICAgICAgICAgICAgZG9jLnN0eWxlLmVuZF9jb2RlYmxvY2soKQogICAgICAgIGlmIGFyZ3VtZW50X21vZGVsIGlzIG5vdCBOb25lIGFuZCBhcmd1bWVudF9tb2RlbC50eXBlX25hbWUgPT0gJ2xpc3QnIGFuZCBcCiAgICAgICAgICAgICAgICBhcmd1bWVudF9tb2RlbC5tZW1iZXIudHlwZV9uYW1lIGluIFNDQUxBUl9UWVBFUzoKICAgICAgICAgICAgIyBBIGxpc3Qgb2Ygc2NhbGFycyBpcyBzcGVjaWFsLiAgV2hpbGUgeW91ICpjYW4qIHVzZQogICAgICAgICAgICAjIEpTT04gKCBbImZvbyIsICJiYXIiLCAiYmF6Il0gKSwgeW91IGNhbiBhbHNvIGp1c3QKICAgICAgICAgICAgIyB1c2UgdGhlIGFyZ3BhcnNlIGJlaGF2aW9yIG9mIHNwYWNlIHNlcGFyYXRlZCBsaXN0cy4KICAgICAgICAgICAgIyAiZm9vIiAiYmFyIiAiYmF6Ii4gIEluIGZhY3Qgd2UgZG9uJ3QgZXZlbiB3YW50IHRvCiAgICAgICAgICAgICMgZG9jdW1lbnQgdGhlIEpTT04gc3ludGF4IGluIHRoaXMgY2FzZS4KICAgICAgICAgICAgbWVtYmVyID0gYXJndW1lbnRfbW9kZWwubWVtYmVyCiAgICAgICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICAgICAgZG9jLndyaXRlKCdTeW50YXgnKQogICAgICAgICAgICBkb2Muc3R5bGUuc3RhcnRfY29kZWJsb2NrKCkKICAgICAgICAgICAgZXhhbXBsZV90eXBlID0gc2VsZi5fanNvbl9leGFtcGxlX3ZhbHVlX25hbWUoCiAgICAgICAgICAgICAgICBtZW1iZXIsIGluY2x1ZGVfZW51bV92YWx1ZXM9RmFsc2UpCiAgICAgICAgICAgIGRvYy53cml0ZSgnJXMgJXMgLi4uJyAlIChleGFtcGxlX3R5cGUsIGV4YW1wbGVfdHlwZSkpCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UobWVtYmVyLCBTdHJpbmdTaGFwZSkgYW5kIG1lbWJlci5lbnVtOgogICAgICAgICAgICAgICAgIyBJZiB3ZSBoYXZlIGVudW0gdmFsdWVzLCB3ZSBjYW4gdGVsbCB0aGUgdXNlcgogICAgICAgICAgICAgICAgIyBleGFjdGx5IHdoYXQgdmFsaWQgdmFsdWVzIHRoZXkgY2FuIHByb3ZpZGUuCiAgICAgICAgICAgICAgICBzZWxmLl93cml0ZV92YWxpZF9lbnVtcyhkb2MsIG1lbWJlci5lbnVtKQogICAgICAgICAgICBkb2Muc3R5bGUuZW5kX2NvZGVibG9jaygpCiAgICAgICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICBlbGlmIGNsaV9hcmd1bWVudC5jbGlfdHlwZV9uYW1lIG5vdCBpbiBTQ0FMQVJfVFlQRVM6CiAgICAgICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICAgICAgZG9jLndyaXRlKCdKU09OIFN5bnRheCcpCiAgICAgICAgICAgIGRvYy5zdHlsZS5zdGFydF9jb2RlYmxvY2soKQogICAgICAgICAgICBzZWxmLl9qc29uX2V4YW1wbGUoZG9jLCBhcmd1bWVudF9tb2RlbCwgc3RhY2s9W10pCiAgICAgICAgICAgIGRvYy5zdHlsZS5lbmRfY29kZWJsb2NrKCkKICAgICAgICAgICAgZG9jLnN0eWxlLm5ld19wYXJhZ3JhcGgoKQoKICAgIGRlZiBfd3JpdGVfdmFsaWRfZW51bXMoc2VsZiwgZG9jLCBlbnVtX3ZhbHVlcyk6CiAgICAgICAgZG9jLnN0eWxlLm5ld19wYXJhZ3JhcGgoKQogICAgICAgIGRvYy53cml0ZSgiV2hlcmUgdmFsaWQgdmFsdWVzIGFyZTpcbiIpCiAgICAgICAgZm9yIHZhbHVlIGluIGVudW1fdmFsdWVzOgogICAgICAgICAgICBkb2Mud3JpdGUoIiAgICAlc1xuIiAlIHZhbHVlKQogICAgICAgIGRvYy53cml0ZSgiXG4iKQoKICAgIGRlZiBkb2Nfb3V0cHV0KHNlbGYsIGhlbHBfY29tbWFuZCwgZXZlbnRfbmFtZSwgKiprd2FyZ3MpOgogICAgICAgIGRvYyA9IGhlbHBfY29tbWFuZC5kb2MKICAgICAgICBkb2Muc3R5bGUuaDIoJ091dHB1dCcpCiAgICAgICAgb3BlcmF0aW9uX21vZGVsID0gaGVscF9jb21tYW5kLm9iagogICAgICAgIG91dHB1dF9zaGFwZSA9IG9wZXJhdGlvbl9tb2RlbC5vdXRwdXRfc2hhcGUKICAgICAgICBpZiBvdXRwdXRfc2hhcGUgaXMgTm9uZSBvciBub3Qgb3V0cHV0X3NoYXBlLm1lbWJlcnM6CiAgICAgICAgICAgIGRvYy53cml0ZSgnTm9uZScpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZm9yIG1lbWJlcl9uYW1lLCBtZW1iZXJfc2hhcGUgaW4gb3V0cHV0X3NoYXBlLm1lbWJlcnMuaXRlbXMoKToKICAgICAgICAgICAgICAgIHNlbGYuX2RvY19tZW1iZXIoZG9jLCBtZW1iZXJfbmFtZSwgbWVtYmVyX3NoYXBlLCBzdGFjaz1bXSkKCgpjbGFzcyBUb3BpY0xpc3RlckRvY3VtZW50RXZlbnRIYW5kbGVyKENMSURvY3VtZW50RXZlbnRIYW5kbGVyKToKICAgIERFU0NSSVBUSU9OID0gKAogICAgICAgICdUaGlzIGlzIHRoZSBBV1MgQ0xJIFRvcGljIEd1aWRlLiBJdCBnaXZlcyBhY2Nlc3MgdG8gYSBzZXQgJwogICAgICAgICdvZiB0b3BpY3MgdGhhdCBwcm92aWRlIGEgZGVlcGVyIHVuZGVyc3RhbmRpbmcgb2YgdGhlIENMSS4gVG8gYWNjZXNzICcKICAgICAgICAndGhlIGxpc3Qgb2YgdG9waWNzIGZyb20gdGhlIGNvbW1hbmQgbGluZSwgcnVuIGBgYXdzIGhlbHAgdG9waWNzYGAuICcKICAgICAgICAnVG8gYWNjZXNzIGEgc3BlY2lmaWMgdG9waWMgZnJvbSB0aGUgY29tbWFuZCBsaW5lLCBydW4gJwogICAgICAgICdgYGF3cyBoZWxwIFt0b3BpY25hbWVdYGAsIHdoZXJlIGBgdG9waWNuYW1lYGAgaXMgdGhlIG5hbWUgb2YgdGhlICcKICAgICAgICAndG9waWMgYXMgaXQgYXBwZWFycyBpbiB0aGUgb3V0cHV0IGZyb20gYGBhd3MgaGVscCB0b3BpY3NgYC4nKQoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBoZWxwX2NvbW1hbmQpOgogICAgICAgIHNlbGYuaGVscF9jb21tYW5kID0gaGVscF9jb21tYW5kCiAgICAgICAgc2VsZi5yZWdpc3RlcihoZWxwX2NvbW1hbmQuc2Vzc2lvbiwgaGVscF9jb21tYW5kLmV2ZW50X2NsYXNzKQogICAgICAgIHNlbGYuX3RvcGljX3RhZ19kYiA9IFRvcGljVGFnREIoKQogICAgICAgIHNlbGYuX3RvcGljX3RhZ19kYi5sb2FkX2pzb25faW5kZXgoKQoKICAgIGRlZiBkb2NfYnJlYWRjcnVtYnMoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgIGlmIGRvYy50YXJnZXQgIT0gJ21hbic6CiAgICAgICAgICAgIGRvYy53cml0ZSgnWyAnKQogICAgICAgICAgICBkb2Muc3R5bGUuc3BoaW54X3JlZmVyZW5jZV9sYWJlbChsYWJlbD0nY2xpOmF3cycsIHRleHQ9J2F3cycpCiAgICAgICAgICAgIGRvYy53cml0ZSgnIF0nKQoKICAgIGRlZiBkb2NfdGl0bGUoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICBkb2Muc3R5bGUubGlua190YXJnZXRfZGVmaW5pdGlvbigKICAgICAgICAgICAgcmVmbmFtZT0nY2xpOmF3cyBoZWxwICVzJyAlIHNlbGYuaGVscF9jb21tYW5kLm5hbWUsCiAgICAgICAgICAgIGxpbms9JycpCiAgICAgICAgZG9jLnN0eWxlLmgxKCdBV1MgQ0xJIFRvcGljIEd1aWRlJykKCiAgICBkZWYgZG9jX2Rlc2NyaXB0aW9uKHNlbGYsIGhlbHBfY29tbWFuZCwgKiprd2FyZ3MpOgogICAgICAgIGRvYyA9IGhlbHBfY29tbWFuZC5kb2MKICAgICAgICBkb2Muc3R5bGUuaDIoJ0Rlc2NyaXB0aW9uJykKICAgICAgICBkb2MuaW5jbHVkZV9kb2Nfc3RyaW5nKHNlbGYuREVTQ1JJUFRJT04pCiAgICAgICAgZG9jLnN0eWxlLm5ld19wYXJhZ3JhcGgoKQoKICAgIGRlZiBkb2Nfc3lub3BzaXNfc3RhcnQoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBkb2Nfc3lub3BzaXNfZW5kKHNlbGYsIGhlbHBfY29tbWFuZCwgKiprd2FyZ3MpOgogICAgICAgIHBhc3MKCiAgICBkZWYgZG9jX29wdGlvbnNfc3RhcnQoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBkb2Nfb3B0aW9uc19lbmQoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBkb2NfZ2xvYmFsX29wdGlvbihzZWxmLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBwYXNzCgogICAgZGVmIGRvY19zdWJpdGVtc19zdGFydChzZWxmLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgZG9jLnN0eWxlLmgyKCdBdmFpbGFibGUgVG9waWNzJykKCiAgICAgICAgY2F0ZWdvcmllcyA9IHNlbGYuX3RvcGljX3RhZ19kYi5xdWVyeSgnY2F0ZWdvcnknKQogICAgICAgIHRvcGljX25hbWVzID0gc2VsZi5fdG9waWNfdGFnX2RiLmdldF9hbGxfdG9waWNfbmFtZXMoKQoKICAgICAgICAjIFNvcnQgdGhlIGNhdGVnb3JpZXMKICAgICAgICBjYXRlZ29yeV9uYW1lcyA9IHNvcnRlZChjYXRlZ29yaWVzLmtleXMoKSkKICAgICAgICBmb3IgY2F0ZWdvcnlfbmFtZSBpbiBjYXRlZ29yeV9uYW1lczoKICAgICAgICAgICAgZG9jLnN0eWxlLmgzKGNhdGVnb3J5X25hbWUpCiAgICAgICAgICAgIGRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICAgICAgIyBXcml0ZSBvdXQgdGhlIHRvcGljIGFuZCBhIGRlc2NyaXB0aW9uIGZvciBlYWNoIHRvcGljIHVuZGVyCiAgICAgICAgICAgICMgZWFjaCBjYXRlZ29yeS4KICAgICAgICAgICAgZm9yIHRvcGljX25hbWUgaW4gc29ydGVkKGNhdGVnb3JpZXNbY2F0ZWdvcnlfbmFtZV0pOgogICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBzZWxmLl90b3BpY190YWdfZGIuZ2V0X3RhZ19zaW5nbGVfdmFsdWUoCiAgICAgICAgICAgICAgICAgICAgdG9waWNfbmFtZSwgJ2Rlc2NyaXB0aW9uJykKICAgICAgICAgICAgICAgIGRvYy53cml0ZSgnKiAnKQogICAgICAgICAgICAgICAgZG9jLnN0eWxlLnNwaGlueF9yZWZlcmVuY2VfbGFiZWwoCiAgICAgICAgICAgICAgICAgICAgbGFiZWw9J2NsaTphd3MgaGVscCAlcycgJSB0b3BpY19uYW1lLAogICAgICAgICAgICAgICAgICAgIHRleHQ9dG9waWNfbmFtZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZG9jLndyaXRlKCc6ICVzXG4nICUgZGVzY3JpcHRpb24pCiAgICAgICAgIyBBZGQgYSBoaWRkZW4gdG9jdHJlZSB0byBtYWtlIHN1cmUgZXZlcnl0aGluZyBpcyBjb25uZWN0ZWQgaW4KICAgICAgICAjIHRoZSBkb2N1bWVudC4KICAgICAgICBkb2Muc3R5bGUuaGlkZGVuX3RvY3RyZWUoKQogICAgICAgIGZvciB0b3BpY19uYW1lIGluIHRvcGljX25hbWVzOgogICAgICAgICAgICBkb2Muc3R5bGUuaGlkZGVuX3RvY2l0ZW0odG9waWNfbmFtZSkKCgpjbGFzcyBUb3BpY0RvY3VtZW50RXZlbnRIYW5kbGVyKFRvcGljTGlzdGVyRG9jdW1lbnRFdmVudEhhbmRsZXIpOgoKICAgIGRlZiBkb2NfYnJlYWRjcnVtYnMoc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgIGlmIGRvYy50YXJnZXQgIT0gJ21hbic6CiAgICAgICAgICAgIGRvYy53cml0ZSgnWyAnKQogICAgICAgICAgICBkb2Muc3R5bGUuc3BoaW54X3JlZmVyZW5jZV9sYWJlbChsYWJlbD0nY2xpOmF3cycsIHRleHQ9J2F3cycpCiAgICAgICAgICAgIGRvYy53cml0ZSgnIC4gJykKICAgICAgICAgICAgZG9jLnN0eWxlLnNwaGlueF9yZWZlcmVuY2VfbGFiZWwoCiAgICAgICAgICAgICAgICBsYWJlbD0nY2xpOmF3cyBoZWxwIHRvcGljcycsCiAgICAgICAgICAgICAgICB0ZXh0PSd0b3BpY3MnCiAgICAgICAgICAgICkKICAgICAgICAgICAgZG9jLndyaXRlKCcgXScpCgogICAgZGVmIGRvY190aXRsZShzZWxmLCBoZWxwX2NvbW1hbmQsICoqa3dhcmdzKToKICAgICAgICBkb2MgPSBoZWxwX2NvbW1hbmQuZG9jCiAgICAgICAgZG9jLnN0eWxlLm5ld19wYXJhZ3JhcGgoKQogICAgICAgIGRvYy5zdHlsZS5saW5rX3RhcmdldF9kZWZpbml0aW9uKAogICAgICAgICAgICByZWZuYW1lPSdjbGk6YXdzIGhlbHAgJXMnICUgc2VsZi5oZWxwX2NvbW1hbmQubmFtZSwKICAgICAgICAgICAgbGluaz0nJykKICAgICAgICB0aXRsZSA9IHNlbGYuX3RvcGljX3RhZ19kYi5nZXRfdGFnX3NpbmdsZV92YWx1ZSgKICAgICAgICAgICAgaGVscF9jb21tYW5kLm5hbWUsICd0aXRsZScpCiAgICAgICAgZG9jLnN0eWxlLmgxKHRpdGxlKQoKICAgIGRlZiBkb2NfZGVzY3JpcHRpb24oc2VsZiwgaGVscF9jb21tYW5kLCAqKmt3YXJncyk6CiAgICAgICAgZG9jID0gaGVscF9jb21tYW5kLmRvYwogICAgICAgIHRvcGljX2ZpbGVuYW1lID0gb3MucGF0aC5qb2luKHNlbGYuX3RvcGljX3RhZ19kYi50b3BpY19kaXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVscF9jb21tYW5kLm5hbWUgKyAnLnJzdCcpCiAgICAgICAgY29udGVudHMgPSBzZWxmLl9yZW1vdmVfdGFnc19mcm9tX2NvbnRlbnQodG9waWNfZmlsZW5hbWUpCiAgICAgICAgZG9jLndyaXRlbG4oY29udGVudHMpCiAgICAgICAgZG9jLnN0eWxlLm5ld19wYXJhZ3JhcGgoKQoKICAgIGRlZiBfcmVtb3ZlX3RhZ3NfZnJvbV9jb250ZW50KHNlbGYsIGZpbGVuYW1lKToKICAgICAgICB3aXRoIG9wZW4oZmlsZW5hbWUsICdyJykgYXMgZjoKICAgICAgICAgICAgbGluZXMgPSBmLnJlYWRsaW5lcygpCgogICAgICAgIGNvbnRlbnRfYmVnaW5faW5kZXggPSAwCiAgICAgICAgZm9yIGksIGxpbmUgaW4gZW51bWVyYXRlKGxpbmVzKToKICAgICAgICAgICAgIyBJZiBhIGxpbmUgaXMgZW5jb3VudGVyZWQgdGhhdCBkb2VzIG5vdCBiZWdpbiB3aXRoIHRoZSB0YWcKICAgICAgICAgICAgIyBlbmQgdGhlIHNlYXJjaCBmb3IgdGFncyBhbmQgbWFyayB3aGVyZSB0YWdzIGVuZC4KICAgICAgICAgICAgaWYgbm90IHNlbGYuX2xpbmVfaGFzX3RhZyhsaW5lKToKICAgICAgICAgICAgICAgIGNvbnRlbnRfYmVnaW5faW5kZXggPSBpCiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAjIEpvaW4gYWxsIG9mIHRoZSBub24tdGFnZ2VkIGxpbmVzIGJhY2sgdG9nZXRoZXIuCiAgICAgICAgcmV0dXJuICcnLmpvaW4obGluZXNbY29udGVudF9iZWdpbl9pbmRleDpdKQoKICAgIGRlZiBfbGluZV9oYXNfdGFnKHNlbGYsIGxpbmUpOgogICAgICAgIGZvciB0YWcgaW4gc2VsZi5fdG9waWNfdGFnX2RiLnZhbGlkX3RhZ3M6CiAgICAgICAgICAgIGlmIGxpbmUuc3RhcnRzd2l0aCgnOicgKyB0YWcgKyAnOicpOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZG9jX3N1Yml0ZW1zX3N0YXJ0KHNlbGYsIGhlbHBfY29tbWFuZCwgKiprd2FyZ3MpOgogICAgICAgIHBhc3MKCgpjbGFzcyBHbG9iYWxPcHRpb25zRG9jdW1lbnRlcjoKICAgICIiIkRvY3VtZW50ZXIgdXNlZCB0byBwcmUtZ2VuZXJhdGUgZ2xvYmFsIG9wdGlvbnMgZG9jcy4iIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgaGVscF9jb21tYW5kKToKICAgICAgICBzZWxmLl9oZWxwX2NvbW1hbmQgPSBoZWxwX2NvbW1hbmQKCiAgICBkZWYgX3JlbW92ZV9tdWx0aWxpbmVzKHNlbGYsIHMpOgogICAgICAgIHJldHVybiByZS5zdWIocidcbisnLCAnXG4nLCBzKQoKICAgIGRlZiBkb2NfZ2xvYmFsX29wdGlvbnMoc2VsZik6CiAgICAgICAgaGVscF9jb21tYW5kID0gc2VsZi5faGVscF9jb21tYW5kCiAgICAgICAgZm9yIGFyZyBpbiBoZWxwX2NvbW1hbmQuYXJnX3RhYmxlOgogICAgICAgICAgICBhcmd1bWVudCA9IGhlbHBfY29tbWFuZC5hcmdfdGFibGUuZ2V0KGFyZykKICAgICAgICAgICAgaGVscF9jb21tYW5kLmRvYy53cml0ZWxuKAogICAgICAgICAgICAgICAgZiJgYHthcmd1bWVudC5jbGlfbmFtZX1gYCAoe2FyZ3VtZW50LmNsaV90eXBlX25hbWV9KSIpCiAgICAgICAgICAgIGhlbHBfY29tbWFuZC5kb2Muc3R5bGUuaW5kZW50KCkKICAgICAgICAgICAgaGVscF9jb21tYW5kLmRvYy5zdHlsZS5uZXdfcGFyYWdyYXBoKCkKICAgICAgICAgICAgaGVscF9jb21tYW5kLmRvYy5pbmNsdWRlX2RvY19zdHJpbmcoYXJndW1lbnQuZG9jdW1lbnRhdGlvbikKICAgICAgICAgICAgaWYgYXJndW1lbnQuY2hvaWNlczoKICAgICAgICAgICAgICAgIGhlbHBfY29tbWFuZC5kb2Muc3R5bGUuc3RhcnRfdWwoKQogICAgICAgICAgICAgICAgZm9yIGNob2ljZSBpbiBhcmd1bWVudC5jaG9pY2VzOgogICAgICAgICAgICAgICAgICAgIGhlbHBfY29tbWFuZC5kb2Muc3R5bGUubGkoY2hvaWNlKQogICAgICAgICAgICAgICAgaGVscF9jb21tYW5kLmRvYy5zdHlsZS5lbmRfdWwoKQogICAgICAgICAgICBoZWxwX2NvbW1hbmQuZG9jLnN0eWxlLmRlZGVudCgpCiAgICAgICAgICAgIGhlbHBfY29tbWFuZC5kb2Muc3R5bGUubmV3X3BhcmFncmFwaCgpCiAgICAgICAgZ2xvYmFsX29wdGlvbnMgPSBoZWxwX2NvbW1hbmQuZG9jLmdldHZhbHVlKCkuZGVjb2RlKCd1dGYtOCcpCiAgICAgICAgcmV0dXJuIHNlbGYuX3JlbW92ZV9tdWx0aWxpbmVzKGdsb2JhbF9vcHRpb25zKQoKICAgIGRlZiBkb2NfZ2xvYmFsX3N5bm9wc2lzKHNlbGYpOgogICAgICAgIGhlbHBfY29tbWFuZCA9IHNlbGYuX2hlbHBfY29tbWFuZAogICAgICAgIGZvciBhcmcgaW4gaGVscF9jb21tYW5kLmFyZ190YWJsZToKICAgICAgICAgICAgYXJndW1lbnQgPSBoZWxwX2NvbW1hbmQuYXJnX3RhYmxlLmdldChhcmcpCiAgICAgICAgICAgIGlmIGFyZ3VtZW50LmNsaV90eXBlX25hbWUgPT0gJ2Jvb2xlYW4nOgogICAgICAgICAgICAgICAgYXJnX3N5bm9wc2lzID0gZiJbe2FyZ3VtZW50LmNsaV9uYW1lfV0iCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhcmdfc3lub3BzaXMgPSBmIlt7YXJndW1lbnQuY2xpX25hbWV9IDx2YWx1ZT5dIgogICAgICAgICAgICBoZWxwX2NvbW1hbmQuZG9jLndyaXRlbG4oYXJnX3N5bm9wc2lzKQogICAgICAgIGdsb2JhbF9zeW5vcHNpcyA9IGhlbHBfY29tbWFuZC5kb2MuZ2V0dmFsdWUoKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICByZXR1cm4gc2VsZi5fcmVtb3ZlX211bHRpbGluZXMoZ2xvYmFsX3N5bm9wc2lzKQo=
