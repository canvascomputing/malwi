statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_mac/symmetric.py
  contents:
  - name: des_cbc_pkcs5_decrypt
    score: 0.0
    code: |-
      def des_cbc_pkcs5_decrypt(key, data, iv):
          """
          Decrypts DES ciphertext using a 56 bit key

          :param key:
              The encryption key - a byte string 8 bytes long (includes error correction bits)

          :param data:
              The ciphertext - a byte string

          :param iv:
              The initialization vector used for encryption - a byte string

          :raises:
              ValueError - when any of the parameters contain an invalid value
              TypeError - when any of the parameters are of the wrong type
              OSError - when an error is returned by the OS crypto library

          :return:
              A byte string of the plaintext
          """

          if len(key) != 8:
              raise ValueError(pretty_message(
                  '''
                  key must be 8 bytes (56 bits + 8 parity bits) long - is %s
                  ''',
                  len(key)
              ))

          if len(iv) != 8:
              raise ValueError(pretty_message(
                  '''
                  iv must be 8 bytes long - is %s
                  ''',
                  len(iv)
              ))

          return _decrypt(Security.kSecAttrKeyTypeDES, key, data, iv, Security.kSecPaddingPKCS5Key)
    tokens: resume load_global len load_fast key call load_const INTEGER compare_op != pop_jump_if_false TO_NUMBER load_global ValueError load_global pretty_message load_const STRING_LEN_S_ENT_HIGH load_global len load_fast key call call call raise_varargs load_global len load_fast iv call load_const INTEGER compare_op != pop_jump_if_false TO_NUMBER load_global ValueError load_global pretty_message load_const STRING_LEN_S_ENT_HIGH load_global len load_fast iv call call call raise_varargs load_global _decrypt load_global Security load_attr STRING_LEN_S_ENT_HIGH load_fast key load_fast data load_fast iv load_global Security load_attr STRING_LEN_S_ENT_HIGH call return_value
    hash: 666b02ad4792dd0df1ad31b77fe5567e25df7ca0893bdd8d1af66c49374b898d
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_mac/symmetric.py
  : IyBjb2Rpbmc6IHV0Zi04CmZyb20gX19mdXR1cmVfXyBpbXBvcnQgdW5pY29kZV9saXRlcmFscywgZGl2aXNpb24sIGFic29sdXRlX2ltcG9ydCwgcHJpbnRfZnVuY3Rpb24KCmZyb20gLi5fZXJyb3JzIGltcG9ydCBwcmV0dHlfbWVzc2FnZQpmcm9tIC4uX2ZmaSBpbXBvcnQgbmV3LCBudWxsCmZyb20gLl9jb3JlX2ZvdW5kYXRpb24gaW1wb3J0IENvcmVGb3VuZGF0aW9uLCBDRkhlbHBlcnMsIGhhbmRsZV9jZl9lcnJvcgpmcm9tIC5fc2VjdXJpdHkgaW1wb3J0IFNlY3VyaXR5CmZyb20gLnV0aWwgaW1wb3J0IHJhbmRfYnl0ZXMKZnJvbSAuLl90eXBlcyBpbXBvcnQgdHlwZV9uYW1lLCBieXRlX2NscwoKCl9fYWxsX18gPSBbCiAgICAnYWVzX2NiY19ub19wYWRkaW5nX2RlY3J5cHQnLAogICAgJ2Flc19jYmNfbm9fcGFkZGluZ19lbmNyeXB0JywKICAgICdhZXNfY2JjX3BrY3M3X2RlY3J5cHQnLAogICAgJ2Flc19jYmNfcGtjczdfZW5jcnlwdCcsCiAgICAnZGVzX2NiY19wa2NzNV9kZWNyeXB0JywKICAgICdkZXNfY2JjX3BrY3M1X2VuY3J5cHQnLAogICAgJ3JjMl9jYmNfcGtjczVfZGVjcnlwdCcsCiAgICAncmMyX2NiY19wa2NzNV9lbmNyeXB0JywKICAgICdyYzRfZGVjcnlwdCcsCiAgICAncmM0X2VuY3J5cHQnLAogICAgJ3RyaXBsZWRlc19jYmNfcGtjczVfZGVjcnlwdCcsCiAgICAndHJpcGxlZGVzX2NiY19wa2NzNV9lbmNyeXB0JywKXQoKCmRlZiBhZXNfY2JjX25vX3BhZGRpbmdfZW5jcnlwdChrZXksIGRhdGEsIGl2KToKICAgICIiIgogICAgRW5jcnlwdHMgcGxhaW50ZXh0IHVzaW5nIEFFUyBpbiBDQkMgbW9kZSB3aXRoIGEgMTI4LCAxOTIgb3IgMjU2IGJpdCBrZXkgYW5kCiAgICBubyBwYWRkaW5nLiBUaGlzIG1lYW5zIHRoZSBjaXBoZXJ0ZXh0IG11c3QgYmUgYW4gZXhhY3QgbXVsdGlwbGUgb2YgMTYgYnl0ZXMKICAgIGxvbmcuCgogICAgOnBhcmFtIGtleToKICAgICAgICBUaGUgZW5jcnlwdGlvbiBrZXkgLSBhIGJ5dGUgc3RyaW5nIGVpdGhlciAxNiwgMjQgb3IgMzIgYnl0ZXMgbG9uZwoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIFRoZSBwbGFpbnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgLSBlaXRoZXIgYSBieXRlIHN0cmluZyAxNi1ieXRlcyBsb25nIG9yIE5vbmUKICAgICAgICB0byBnZW5lcmF0ZSBhbiBJVgoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSB0dXBsZSBvZiB0d28gYnl0ZSBzdHJpbmdzIChpdiwgY2lwaGVydGV4dCkKICAgICIiIgoKICAgIGlmIGxlbihrZXkpIG5vdCBpbiBbMTYsIDI0LCAzMl06CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGtleSBtdXN0IGJlIGVpdGhlciAxNiwgMjQgb3IgMzIgYnl0ZXMgKDEyOCwgMTkyIG9yIDI1NiBiaXRzKSBsb25nIC0gaXMgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oa2V5KQogICAgICAgICkpCgogICAgaWYgbm90IGl2OgogICAgICAgIGl2ID0gcmFuZF9ieXRlcygxNikKICAgIGVsaWYgbGVuKGl2KSAhPSAxNjoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgaXYgbXVzdCBiZSAxNiBieXRlcyBsb25nIC0gaXMgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oaXYpCiAgICAgICAgKSkKCiAgICBpZiBsZW4oZGF0YSkgJSAxNiAhPSAwOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBkYXRhIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAxNiBieXRlcyBsb25nIC0gaXMgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oZGF0YSkKICAgICAgICApKQoKICAgIHJldHVybiAoaXYsIF9lbmNyeXB0KFNlY3VyaXR5LmtTZWNBdHRyS2V5VHlwZUFFUywga2V5LCBkYXRhLCBpdiwgU2VjdXJpdHkua1NlY1BhZGRpbmdOb25lS2V5KSkKCgpkZWYgYWVzX2NiY19ub19wYWRkaW5nX2RlY3J5cHQoa2V5LCBkYXRhLCBpdik6CiAgICAiIiIKICAgIERlY3J5cHRzIEFFUyBjaXBoZXJ0ZXh0IGluIENCQyBtb2RlIHVzaW5nIGEgMTI4LCAxOTIgb3IgMjU2IGJpdCBrZXkgYW5kIG5vCiAgICBwYWRkaW5nLgoKICAgIDpwYXJhbSBrZXk6CiAgICAgICAgVGhlIGVuY3J5cHRpb24ga2V5IC0gYSBieXRlIHN0cmluZyBlaXRoZXIgMTYsIDI0IG9yIDMyIGJ5dGVzIGxvbmcKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBUaGUgY2lwaGVydGV4dCAtIGEgYnl0ZSBzdHJpbmcKCiAgICA6cGFyYW0gaXY6CiAgICAgICAgVGhlIGluaXRpYWxpemF0aW9uIHZlY3RvciAtIGEgYnl0ZSBzdHJpbmcgMTYtYnl0ZXMgbG9uZwoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgcGxhaW50ZXh0CiAgICAiIiIKCiAgICBpZiBsZW4oa2V5KSBub3QgaW4gWzE2LCAyNCwgMzJdOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSBlaXRoZXIgMTYsIDI0IG9yIDMyIGJ5dGVzICgxMjgsIDE5MiBvciAyNTYgYml0cykgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGtleSkKICAgICAgICApKQoKICAgIGlmIGxlbihpdikgIT0gMTY6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGl2IG11c3QgYmUgMTYgYnl0ZXMgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGl2KQogICAgICAgICkpCgogICAgcmV0dXJuIF9kZWNyeXB0KFNlY3VyaXR5LmtTZWNBdHRyS2V5VHlwZUFFUywga2V5LCBkYXRhLCBpdiwgU2VjdXJpdHkua1NlY1BhZGRpbmdOb25lS2V5KQoKCmRlZiBhZXNfY2JjX3BrY3M3X2VuY3J5cHQoa2V5LCBkYXRhLCBpdik6CiAgICAiIiIKICAgIEVuY3J5cHRzIHBsYWludGV4dCB1c2luZyBBRVMgaW4gQ0JDIG1vZGUgd2l0aCBhIDEyOCwgMTkyIG9yIDI1NiBiaXQga2V5IGFuZAogICAgUEtDUyM3IHBhZGRpbmcuCgogICAgOnBhcmFtIGtleToKICAgICAgICBUaGUgZW5jcnlwdGlvbiBrZXkgLSBhIGJ5dGUgc3RyaW5nIGVpdGhlciAxNiwgMjQgb3IgMzIgYnl0ZXMgbG9uZwoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIFRoZSBwbGFpbnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgLSBlaXRoZXIgYSBieXRlIHN0cmluZyAxNi1ieXRlcyBsb25nIG9yIE5vbmUKICAgICAgICB0byBnZW5lcmF0ZSBhbiBJVgoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSB0dXBsZSBvZiB0d28gYnl0ZSBzdHJpbmdzIChpdiwgY2lwaGVydGV4dCkKICAgICIiIgoKICAgIGlmIGxlbihrZXkpIG5vdCBpbiBbMTYsIDI0LCAzMl06CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGtleSBtdXN0IGJlIGVpdGhlciAxNiwgMjQgb3IgMzIgYnl0ZXMgKDEyOCwgMTkyIG9yIDI1NiBiaXRzKSBsb25nIC0gaXMgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oa2V5KQogICAgICAgICkpCgogICAgaWYgbm90IGl2OgogICAgICAgIGl2ID0gcmFuZF9ieXRlcygxNikKICAgIGVsaWYgbGVuKGl2KSAhPSAxNjoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgaXYgbXVzdCBiZSAxNiBieXRlcyBsb25nIC0gaXMgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oaXYpCiAgICAgICAgKSkKCiAgICByZXR1cm4gKGl2LCBfZW5jcnlwdChTZWN1cml0eS5rU2VjQXR0cktleVR5cGVBRVMsIGtleSwgZGF0YSwgaXYsIFNlY3VyaXR5LmtTZWNQYWRkaW5nUEtDUzdLZXkpKQoKCmRlZiBhZXNfY2JjX3BrY3M3X2RlY3J5cHQoa2V5LCBkYXRhLCBpdik6CiAgICAiIiIKICAgIERlY3J5cHRzIEFFUyBjaXBoZXJ0ZXh0IGluIENCQyBtb2RlIHVzaW5nIGEgMTI4LCAxOTIgb3IgMjU2IGJpdCBrZXkKCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgZWl0aGVyIDE2LCAyNCBvciAzMiBieXRlcyBsb25nCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIGNpcGhlcnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgLSBhIGJ5dGUgc3RyaW5nIDE2LWJ5dGVzIGxvbmcKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHBsYWludGV4dAogICAgIiIiCgogICAgaWYgbGVuKGtleSkgbm90IGluIFsxNiwgMjQsIDMyXToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAga2V5IG11c3QgYmUgZWl0aGVyIDE2LCAyNCBvciAzMiBieXRlcyAoMTI4LCAxOTIgb3IgMjU2IGJpdHMpCiAgICAgICAgICAgIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihrZXkpCiAgICAgICAgKSkKCiAgICBpZiBsZW4oaXYpICE9IDE2OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBpdiBtdXN0IGJlIDE2IGJ5dGVzIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihpdikKICAgICAgICApKQoKICAgIHJldHVybiBfZGVjcnlwdChTZWN1cml0eS5rU2VjQXR0cktleVR5cGVBRVMsIGtleSwgZGF0YSwgaXYsIFNlY3VyaXR5LmtTZWNQYWRkaW5nUEtDUzdLZXkpCgoKZGVmIHJjNF9lbmNyeXB0KGtleSwgZGF0YSk6CiAgICAiIiIKICAgIEVuY3J5cHRzIHBsYWludGV4dCB1c2luZyBSQzQgd2l0aCBhIDQwLTEyOCBiaXQga2V5CgogICAgOnBhcmFtIGtleToKICAgICAgICBUaGUgZW5jcnlwdGlvbiBrZXkgLSBhIGJ5dGUgc3RyaW5nIDUtMTYgYnl0ZXMgbG9uZwoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIFRoZSBwbGFpbnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBjaXBoZXJ0ZXh0CiAgICAiIiIKCiAgICBpZiBsZW4oa2V5KSA8IDUgb3IgbGVuKGtleSkgPiAxNjoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAga2V5IG11c3QgYmUgNSB0byAxNiBieXRlcyAoNDAgdG8gMTI4IGJpdHMpIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihrZXkpCiAgICAgICAgKSkKCiAgICByZXR1cm4gX2VuY3J5cHQoU2VjdXJpdHkua1NlY0F0dHJLZXlUeXBlUkM0LCBrZXksIGRhdGEsIE5vbmUsIE5vbmUpCgoKZGVmIHJjNF9kZWNyeXB0KGtleSwgZGF0YSk6CiAgICAiIiIKICAgIERlY3J5cHRzIFJDNCBjaXBoZXJ0ZXh0IHVzaW5nIGEgNDAtMTI4IGJpdCBrZXkKCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgNS0xNiBieXRlcyBsb25nCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIGNpcGhlcnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBwbGFpbnRleHQKICAgICIiIgoKICAgIGlmIGxlbihrZXkpIDwgNSBvciBsZW4oa2V5KSA+IDE2OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSA1IHRvIDE2IGJ5dGVzICg0MCB0byAxMjggYml0cykgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGtleSkKICAgICAgICApKQoKICAgIHJldHVybiBfZGVjcnlwdChTZWN1cml0eS5rU2VjQXR0cktleVR5cGVSQzQsIGtleSwgZGF0YSwgTm9uZSwgTm9uZSkKCgpkZWYgcmMyX2NiY19wa2NzNV9lbmNyeXB0KGtleSwgZGF0YSwgaXYpOgogICAgIiIiCiAgICBFbmNyeXB0cyBwbGFpbnRleHQgdXNpbmcgUkMyIHdpdGggYSA2NCBiaXQga2V5CgogICAgOnBhcmFtIGtleToKICAgICAgICBUaGUgZW5jcnlwdGlvbiBrZXkgLSBhIGJ5dGUgc3RyaW5nIDggYnl0ZXMgbG9uZwoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIFRoZSBwbGFpbnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSA4LWJ5dGUgaW5pdGlhbGl6YXRpb24gdmVjdG9yIHRvIHVzZSAtIGEgYnl0ZSBzdHJpbmcgLSBzZXQgYXMgTm9uZQogICAgICAgIHRvIGdlbmVyYXRlIGFuIGFwcHJvcHJpYXRlIG9uZQoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSB0dXBsZSBvZiB0d28gYnl0ZSBzdHJpbmdzIChpdiwgY2lwaGVydGV4dCkKICAgICIiIgoKICAgIGlmIGxlbihrZXkpIDwgNSBvciBsZW4oa2V5KSA+IDE2OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSA1IHRvIDE2IGJ5dGVzICg0MCB0byAxMjggYml0cykgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGtleSkKICAgICAgICApKQoKICAgIGlmIG5vdCBpdjoKICAgICAgICBpdiA9IHJhbmRfYnl0ZXMoOCkKICAgIGVsaWYgbGVuKGl2KSAhPSA4OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBpdiBtdXN0IGJlIDggYnl0ZXMgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGl2KQogICAgICAgICkpCgogICAgcmV0dXJuIChpdiwgX2VuY3J5cHQoU2VjdXJpdHkua1NlY0F0dHJLZXlUeXBlUkMyLCBrZXksIGRhdGEsIGl2LCBTZWN1cml0eS5rU2VjUGFkZGluZ1BLQ1M1S2V5KSkKCgpkZWYgcmMyX2NiY19wa2NzNV9kZWNyeXB0KGtleSwgZGF0YSwgaXYpOgogICAgIiIiCiAgICBEZWNyeXB0cyBSQzIgY2lwaGVydGV4dCB1c2luZyBhIDY0IGJpdCBrZXkKCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgOCBieXRlcyBsb25nCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIGNpcGhlcnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgdXNlZCBmb3IgZW5jcnlwdGlvbiAtIGEgYnl0ZSBzdHJpbmcKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHBsYWludGV4dAogICAgIiIiCgogICAgaWYgbGVuKGtleSkgPCA1IG9yIGxlbihrZXkpID4gMTY6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGtleSBtdXN0IGJlIDUgdG8gMTYgYnl0ZXMgKDQwIHRvIDEyOCBiaXRzKSBsb25nIC0gaXMgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oa2V5KQogICAgICAgICkpCgogICAgaWYgbGVuKGl2KSAhPSA4OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBpdiBtdXN0IGJlIDggYnl0ZXMgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGl2KQogICAgICAgICkpCgogICAgcmV0dXJuIF9kZWNyeXB0KFNlY3VyaXR5LmtTZWNBdHRyS2V5VHlwZVJDMiwga2V5LCBkYXRhLCBpdiwgU2VjdXJpdHkua1NlY1BhZGRpbmdQS0NTNUtleSkKCgpkZWYgdHJpcGxlZGVzX2NiY19wa2NzNV9lbmNyeXB0KGtleSwgZGF0YSwgaXYpOgogICAgIiIiCiAgICBFbmNyeXB0cyBwbGFpbnRleHQgdXNpbmcgM0RFUyBpbiBlaXRoZXIgMiBvciAzIGtleSBtb2RlCgogICAgOnBhcmFtIGtleToKICAgICAgICBUaGUgZW5jcnlwdGlvbiBrZXkgLSBhIGJ5dGUgc3RyaW5nIDE2IG9yIDI0IGJ5dGVzIGxvbmcgKDIgb3IgMyBrZXkgbW9kZSkKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBUaGUgcGxhaW50ZXh0IC0gYSBieXRlIHN0cmluZwoKICAgIDpwYXJhbSBpdjoKICAgICAgICBUaGUgOC1ieXRlIGluaXRpYWxpemF0aW9uIHZlY3RvciB0byB1c2UgLSBhIGJ5dGUgc3RyaW5nIC0gc2V0IGFzIE5vbmUKICAgICAgICB0byBnZW5lcmF0ZSBhbiBhcHByb3ByaWF0ZSBvbmUKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKCiAgICA6cmV0dXJuOgogICAgICAgIEEgdHVwbGUgb2YgdHdvIGJ5dGUgc3RyaW5ncyAoaXYsIGNpcGhlcnRleHQpCiAgICAiIiIKCiAgICBpZiBsZW4oa2V5KSAhPSAxNiBhbmQgbGVuKGtleSkgIT0gMjQ6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGtleSBtdXN0IGJlIDE2IGJ5dGVzICgyIGtleSkgb3IgMjQgYnl0ZXMgKDMga2V5KSBsb25nIC0gJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oa2V5KQogICAgICAgICkpCgogICAgaWYgbm90IGl2OgogICAgICAgIGl2ID0gcmFuZF9ieXRlcyg4KQogICAgZWxpZiBsZW4oaXYpICE9IDg6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGl2IG11c3QgYmUgOCBieXRlcyBsb25nIC0gJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oaXYpCiAgICAgICAgKSkKCiAgICAjIEV4cGFuZCAyLWtleSB0byBhY3R1YWwgMjQgYnl0ZSBieXRlIHN0cmluZyB1c2VkIGJ5IGNpcGhlcgogICAgaWYgbGVuKGtleSkgPT0gMTY6CiAgICAgICAga2V5ID0ga2V5ICsga2V5WzA6OF0KCiAgICByZXR1cm4gKGl2LCBfZW5jcnlwdChTZWN1cml0eS5rU2VjQXR0cktleVR5cGUzREVTLCBrZXksIGRhdGEsIGl2LCBTZWN1cml0eS5rU2VjUGFkZGluZ1BLQ1M1S2V5KSkKCgpkZWYgdHJpcGxlZGVzX2NiY19wa2NzNV9kZWNyeXB0KGtleSwgZGF0YSwgaXYpOgogICAgIiIiCiAgICBEZWNyeXB0cyAzREVTIGNpcGhlcnRleHQgaW4gZWl0aGVyIDIgb3IgMyBrZXkgbW9kZQoKICAgIDpwYXJhbSBrZXk6CiAgICAgICAgVGhlIGVuY3J5cHRpb24ga2V5IC0gYSBieXRlIHN0cmluZyAxNiBvciAyNCBieXRlcyBsb25nICgyIG9yIDMga2V5IG1vZGUpCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIGNpcGhlcnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgdXNlZCBmb3IgZW5jcnlwdGlvbiAtIGEgYnl0ZSBzdHJpbmcKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHBsYWludGV4dAogICAgIiIiCgogICAgaWYgbGVuKGtleSkgIT0gMTYgYW5kIGxlbihrZXkpICE9IDI0OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSAxNiBieXRlcyAoMiBrZXkpIG9yIDI0IGJ5dGVzICgzIGtleSkgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGtleSkKICAgICAgICApKQoKICAgIGlmIGxlbihpdikgIT0gODoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgaXYgbXVzdCBiZSA4IGJ5dGVzIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihpdikKICAgICAgICApKQoKICAgICMgRXhwYW5kIDIta2V5IHRvIGFjdHVhbCAyNCBieXRlIGJ5dGUgc3RyaW5nIHVzZWQgYnkgY2lwaGVyCiAgICBpZiBsZW4oa2V5KSA9PSAxNjoKICAgICAgICBrZXkgPSBrZXkgKyBrZXlbMDo4XQoKICAgIHJldHVybiBfZGVjcnlwdChTZWN1cml0eS5rU2VjQXR0cktleVR5cGUzREVTLCBrZXksIGRhdGEsIGl2LCBTZWN1cml0eS5rU2VjUGFkZGluZ1BLQ1M1S2V5KQoKCmRlZiBkZXNfY2JjX3BrY3M1X2VuY3J5cHQoa2V5LCBkYXRhLCBpdik6CiAgICAiIiIKICAgIEVuY3J5cHRzIHBsYWludGV4dCB1c2luZyBERVMgd2l0aCBhIDU2IGJpdCBrZXkKCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgOCBieXRlcyBsb25nIChpbmNsdWRlcyBlcnJvciBjb3JyZWN0aW9uIGJpdHMpCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIHBsYWludGV4dCAtIGEgYnl0ZSBzdHJpbmcKCiAgICA6cGFyYW0gaXY6CiAgICAgICAgVGhlIDgtYnl0ZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgdG8gdXNlIC0gYSBieXRlIHN0cmluZyAtIHNldCBhcyBOb25lCiAgICAgICAgdG8gZ2VuZXJhdGUgYW4gYXBwcm9wcmlhdGUgb25lCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIHR1cGxlIG9mIHR3byBieXRlIHN0cmluZ3MgKGl2LCBjaXBoZXJ0ZXh0KQogICAgIiIiCgogICAgaWYgbGVuKGtleSkgIT0gODoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAga2V5IG11c3QgYmUgOCBieXRlcyAoNTYgYml0cyArIDggcGFyaXR5IGJpdHMpIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihrZXkpCiAgICAgICAgKSkKCiAgICBpZiBub3QgaXY6CiAgICAgICAgaXYgPSByYW5kX2J5dGVzKDgpCiAgICBlbGlmIGxlbihpdikgIT0gODoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgaXYgbXVzdCBiZSA4IGJ5dGVzIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihpdikKICAgICAgICApKQoKICAgIHJldHVybiAoaXYsIF9lbmNyeXB0KFNlY3VyaXR5LmtTZWNBdHRyS2V5VHlwZURFUywga2V5LCBkYXRhLCBpdiwgU2VjdXJpdHkua1NlY1BhZGRpbmdQS0NTNUtleSkpCgoKZGVmIGRlc19jYmNfcGtjczVfZGVjcnlwdChrZXksIGRhdGEsIGl2KToKICAgICIiIgogICAgRGVjcnlwdHMgREVTIGNpcGhlcnRleHQgdXNpbmcgYSA1NiBiaXQga2V5CgogICAgOnBhcmFtIGtleToKICAgICAgICBUaGUgZW5jcnlwdGlvbiBrZXkgLSBhIGJ5dGUgc3RyaW5nIDggYnl0ZXMgbG9uZyAoaW5jbHVkZXMgZXJyb3IgY29ycmVjdGlvbiBiaXRzKQoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIFRoZSBjaXBoZXJ0ZXh0IC0gYSBieXRlIHN0cmluZwoKICAgIDpwYXJhbSBpdjoKICAgICAgICBUaGUgaW5pdGlhbGl6YXRpb24gdmVjdG9yIHVzZWQgZm9yIGVuY3J5cHRpb24gLSBhIGJ5dGUgc3RyaW5nCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBwbGFpbnRleHQKICAgICIiIgoKICAgIGlmIGxlbihrZXkpICE9IDg6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGtleSBtdXN0IGJlIDggYnl0ZXMgKDU2IGJpdHMgKyA4IHBhcml0eSBiaXRzKSBsb25nIC0gaXMgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oa2V5KQogICAgICAgICkpCgogICAgaWYgbGVuKGl2KSAhPSA4OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBpdiBtdXN0IGJlIDggYnl0ZXMgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGl2KQogICAgICAgICkpCgogICAgcmV0dXJuIF9kZWNyeXB0KFNlY3VyaXR5LmtTZWNBdHRyS2V5VHlwZURFUywga2V5LCBkYXRhLCBpdiwgU2VjdXJpdHkua1NlY1BhZGRpbmdQS0NTNUtleSkKCgpkZWYgX2VuY3J5cHQoY2lwaGVyLCBrZXksIGRhdGEsIGl2LCBwYWRkaW5nKToKICAgICIiIgogICAgRW5jcnlwdHMgcGxhaW50ZXh0CgogICAgOnBhcmFtIGNpcGhlcjoKICAgICAgICBBIGtTZWNBdHRyS2V5VHlwZSogdmFsdWUgdGhhdCBzcGVjaWZpZXMgdGhlIGNpcGhlciB0byB1c2UKCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgNS0xNiBieXRlcyBsb25nCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIHBsYWludGV4dCAtIGEgYnl0ZSBzdHJpbmcKCiAgICA6cGFyYW0gaXY6CiAgICAgICAgVGhlIGluaXRpYWxpemF0aW9uIHZlY3RvciAtIGEgYnl0ZSBzdHJpbmcgLSB1bnVzZWQgZm9yIFJDNAoKICAgIDpwYXJhbSBwYWRkaW5nOgogICAgICAgIFRoZSBwYWRkaW5nIG1vZGUgdG8gdXNlLCBzcGVjaWZpZWQgYXMgYSBrU2VjUGFkZGluZypLZXkgdmFsdWUgLSB1bnVzZWQgZm9yIFJDNAoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgY2lwaGVydGV4dAogICAgIiIiCgogICAgaWYgbm90IGlzaW5zdGFuY2Uoa2V5LCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAga2V5IG11c3QgYmUgYSBieXRlIHN0cmluZywgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKGtleSkKICAgICAgICApKQoKICAgIGlmIG5vdCBpc2luc3RhbmNlKGRhdGEsIGJ5dGVfY2xzKToKICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBkYXRhIG11c3QgYmUgYSBieXRlIHN0cmluZywgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKGRhdGEpCiAgICAgICAgKSkKCiAgICBpZiBjaXBoZXIgIT0gU2VjdXJpdHkua1NlY0F0dHJLZXlUeXBlUkM0IGFuZCBub3QgaXNpbnN0YW5jZShpdiwgYnl0ZV9jbHMpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGl2IG11c3QgYmUgYSBieXRlIHN0cmluZywgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKGl2KQogICAgICAgICkpCgogICAgaWYgY2lwaGVyICE9IFNlY3VyaXR5LmtTZWNBdHRyS2V5VHlwZVJDNCBhbmQgbm90IHBhZGRpbmc6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigncGFkZGluZyBtdXN0IGJlIHNwZWNpZmllZCcpCgogICAgY2ZfZGljdCA9IE5vbmUKICAgIGNmX2tleSA9IE5vbmUKICAgIGNmX2RhdGEgPSBOb25lCiAgICBjZl9pdiA9IE5vbmUKICAgIHNlY19rZXkgPSBOb25lCiAgICBzZWNfdHJhbnNmb3JtID0gTm9uZQoKICAgIHRyeToKICAgICAgICBjZl9kaWN0ID0gQ0ZIZWxwZXJzLmNmX2RpY3Rpb25hcnlfZnJvbV9wYWlycyhbKFNlY3VyaXR5LmtTZWNBdHRyS2V5VHlwZSwgY2lwaGVyKV0pCiAgICAgICAgY2Zfa2V5ID0gQ0ZIZWxwZXJzLmNmX2RhdGFfZnJvbV9ieXRlcyhrZXkpCiAgICAgICAgY2ZfZGF0YSA9IENGSGVscGVycy5jZl9kYXRhX2Zyb21fYnl0ZXMoZGF0YSkKCiAgICAgICAgZXJyb3JfcG9pbnRlciA9IG5ldyhDb3JlRm91bmRhdGlvbiwgJ0NGRXJyb3JSZWYgKicpCiAgICAgICAgc2VjX2tleSA9IFNlY3VyaXR5LlNlY0tleUNyZWF0ZUZyb21EYXRhKGNmX2RpY3QsIGNmX2tleSwgZXJyb3JfcG9pbnRlcikKICAgICAgICBoYW5kbGVfY2ZfZXJyb3IoZXJyb3JfcG9pbnRlcikKCiAgICAgICAgc2VjX3RyYW5zZm9ybSA9IFNlY3VyaXR5LlNlY0VuY3J5cHRUcmFuc2Zvcm1DcmVhdGUoc2VjX2tleSwgZXJyb3JfcG9pbnRlcikKICAgICAgICBoYW5kbGVfY2ZfZXJyb3IoZXJyb3JfcG9pbnRlcikKCiAgICAgICAgaWYgY2lwaGVyICE9IFNlY3VyaXR5LmtTZWNBdHRyS2V5VHlwZVJDNDoKICAgICAgICAgICAgU2VjdXJpdHkuU2VjVHJhbnNmb3JtU2V0QXR0cmlidXRlKHNlY190cmFuc2Zvcm0sIFNlY3VyaXR5LmtTZWNNb2RlQ0JDS2V5LCBudWxsKCksIGVycm9yX3BvaW50ZXIpCiAgICAgICAgICAgIGhhbmRsZV9jZl9lcnJvcihlcnJvcl9wb2ludGVyKQoKICAgICAgICAgICAgU2VjdXJpdHkuU2VjVHJhbnNmb3JtU2V0QXR0cmlidXRlKHNlY190cmFuc2Zvcm0sIFNlY3VyaXR5LmtTZWNQYWRkaW5nS2V5LCBwYWRkaW5nLCBlcnJvcl9wb2ludGVyKQogICAgICAgICAgICBoYW5kbGVfY2ZfZXJyb3IoZXJyb3JfcG9pbnRlcikKCiAgICAgICAgICAgIGNmX2l2ID0gQ0ZIZWxwZXJzLmNmX2RhdGFfZnJvbV9ieXRlcyhpdikKICAgICAgICAgICAgU2VjdXJpdHkuU2VjVHJhbnNmb3JtU2V0QXR0cmlidXRlKHNlY190cmFuc2Zvcm0sIFNlY3VyaXR5LmtTZWNJVktleSwgY2ZfaXYsIGVycm9yX3BvaW50ZXIpCiAgICAgICAgICAgIGhhbmRsZV9jZl9lcnJvcihlcnJvcl9wb2ludGVyKQoKICAgICAgICBTZWN1cml0eS5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoCiAgICAgICAgICAgIHNlY190cmFuc2Zvcm0sCiAgICAgICAgICAgIFNlY3VyaXR5LmtTZWNUcmFuc2Zvcm1JbnB1dEF0dHJpYnV0ZU5hbWUsCiAgICAgICAgICAgIGNmX2RhdGEsCiAgICAgICAgICAgIGVycm9yX3BvaW50ZXIKICAgICAgICApCiAgICAgICAgaGFuZGxlX2NmX2Vycm9yKGVycm9yX3BvaW50ZXIpCgogICAgICAgIGNpcGhlcnRleHQgPSBTZWN1cml0eS5TZWNUcmFuc2Zvcm1FeGVjdXRlKHNlY190cmFuc2Zvcm0sIGVycm9yX3BvaW50ZXIpCiAgICAgICAgaGFuZGxlX2NmX2Vycm9yKGVycm9yX3BvaW50ZXIpCgogICAgICAgIHJldHVybiBDRkhlbHBlcnMuY2ZfZGF0YV90b19ieXRlcyhjaXBoZXJ0ZXh0KQoKICAgIGZpbmFsbHk6CiAgICAgICAgaWYgY2ZfZGljdDoKICAgICAgICAgICAgQ29yZUZvdW5kYXRpb24uQ0ZSZWxlYXNlKGNmX2RpY3QpCiAgICAgICAgaWYgY2Zfa2V5OgogICAgICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJlbGVhc2UoY2Zfa2V5KQogICAgICAgIGlmIGNmX2RhdGE6CiAgICAgICAgICAgIENvcmVGb3VuZGF0aW9uLkNGUmVsZWFzZShjZl9kYXRhKQogICAgICAgIGlmIGNmX2l2OgogICAgICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJlbGVhc2UoY2ZfaXYpCiAgICAgICAgaWYgc2VjX2tleToKICAgICAgICAgICAgQ29yZUZvdW5kYXRpb24uQ0ZSZWxlYXNlKHNlY19rZXkpCiAgICAgICAgaWYgc2VjX3RyYW5zZm9ybToKICAgICAgICAgICAgQ29yZUZvdW5kYXRpb24uQ0ZSZWxlYXNlKHNlY190cmFuc2Zvcm0pCgoKZGVmIF9kZWNyeXB0KGNpcGhlciwga2V5LCBkYXRhLCBpdiwgcGFkZGluZyk6CiAgICAiIiIKICAgIERlY3J5cHRzIEFFUy9SQzQvUkMyLzNERVMvREVTIGNpcGhlcnRleHQKCiAgICA6cGFyYW0gY2lwaGVyOgogICAgICAgIEEga1NlY0F0dHJLZXlUeXBlKiB2YWx1ZSB0aGF0IHNwZWNpZmllcyB0aGUgY2lwaGVyIHRvIHVzZQoKICAgIDpwYXJhbSBrZXk6CiAgICAgICAgVGhlIGVuY3J5cHRpb24ga2V5IC0gYSBieXRlIHN0cmluZyA1LTE2IGJ5dGVzIGxvbmcKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBUaGUgY2lwaGVydGV4dCAtIGEgYnl0ZSBzdHJpbmcKCiAgICA6cGFyYW0gaXY6CiAgICAgICAgVGhlIGluaXRpYWxpemF0aW9uIHZlY3RvciAtIGEgYnl0ZSBzdHJpbmcgLSB1bnVzZWQgZm9yIFJDNAoKICAgIDpwYXJhbSBwYWRkaW5nOgogICAgICAgIFRoZSBwYWRkaW5nIG1vZGUgdG8gdXNlLCBzcGVjaWZpZWQgYXMgYSBrU2VjUGFkZGluZypLZXkgdmFsdWUgLSB1bnVzZWQgZm9yIFJDNAoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgcGxhaW50ZXh0CiAgICAiIiIKCiAgICBpZiBub3QgaXNpbnN0YW5jZShrZXksIGJ5dGVfY2xzKToKICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSBhIGJ5dGUgc3RyaW5nLCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICB0eXBlX25hbWUoa2V5KQogICAgICAgICkpCgogICAgaWYgbm90IGlzaW5zdGFuY2UoZGF0YSwgYnl0ZV9jbHMpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGRhdGEgbXVzdCBiZSBhIGJ5dGUgc3RyaW5nLCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICB0eXBlX25hbWUoZGF0YSkKICAgICAgICApKQoKICAgIGlmIGNpcGhlciAhPSBTZWN1cml0eS5rU2VjQXR0cktleVR5cGVSQzQgYW5kIG5vdCBpc2luc3RhbmNlKGl2LCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgaXYgbXVzdCBiZSBhIGJ5dGUgc3RyaW5nLCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICB0eXBlX25hbWUoaXYpCiAgICAgICAgKSkKCiAgICBpZiBjaXBoZXIgIT0gU2VjdXJpdHkua1NlY0F0dHJLZXlUeXBlUkM0IGFuZCBub3QgcGFkZGluZzoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdwYWRkaW5nIG11c3QgYmUgc3BlY2lmaWVkJykKCiAgICBjZl9kaWN0ID0gTm9uZQogICAgY2Zfa2V5ID0gTm9uZQogICAgY2ZfZGF0YSA9IE5vbmUKICAgIGNmX2l2ID0gTm9uZQogICAgc2VjX2tleSA9IE5vbmUKICAgIHNlY190cmFuc2Zvcm0gPSBOb25lCgogICAgdHJ5OgogICAgICAgIGNmX2RpY3QgPSBDRkhlbHBlcnMuY2ZfZGljdGlvbmFyeV9mcm9tX3BhaXJzKFsoU2VjdXJpdHkua1NlY0F0dHJLZXlUeXBlLCBjaXBoZXIpXSkKICAgICAgICBjZl9rZXkgPSBDRkhlbHBlcnMuY2ZfZGF0YV9mcm9tX2J5dGVzKGtleSkKICAgICAgICBjZl9kYXRhID0gQ0ZIZWxwZXJzLmNmX2RhdGFfZnJvbV9ieXRlcyhkYXRhKQoKICAgICAgICBlcnJvcl9wb2ludGVyID0gbmV3KENvcmVGb3VuZGF0aW9uLCAnQ0ZFcnJvclJlZiAqJykKICAgICAgICBzZWNfa2V5ID0gU2VjdXJpdHkuU2VjS2V5Q3JlYXRlRnJvbURhdGEoY2ZfZGljdCwgY2Zfa2V5LCBlcnJvcl9wb2ludGVyKQogICAgICAgIGhhbmRsZV9jZl9lcnJvcihlcnJvcl9wb2ludGVyKQoKICAgICAgICBzZWNfdHJhbnNmb3JtID0gU2VjdXJpdHkuU2VjRGVjcnlwdFRyYW5zZm9ybUNyZWF0ZShzZWNfa2V5LCBlcnJvcl9wb2ludGVyKQogICAgICAgIGhhbmRsZV9jZl9lcnJvcihlcnJvcl9wb2ludGVyKQoKICAgICAgICBpZiBjaXBoZXIgIT0gU2VjdXJpdHkua1NlY0F0dHJLZXlUeXBlUkM0OgogICAgICAgICAgICBTZWN1cml0eS5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoc2VjX3RyYW5zZm9ybSwgU2VjdXJpdHkua1NlY01vZGVDQkNLZXksIG51bGwoKSwgZXJyb3JfcG9pbnRlcikKICAgICAgICAgICAgaGFuZGxlX2NmX2Vycm9yKGVycm9yX3BvaW50ZXIpCgogICAgICAgICAgICBTZWN1cml0eS5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoc2VjX3RyYW5zZm9ybSwgU2VjdXJpdHkua1NlY1BhZGRpbmdLZXksIHBhZGRpbmcsIGVycm9yX3BvaW50ZXIpCiAgICAgICAgICAgIGhhbmRsZV9jZl9lcnJvcihlcnJvcl9wb2ludGVyKQoKICAgICAgICAgICAgY2ZfaXYgPSBDRkhlbHBlcnMuY2ZfZGF0YV9mcm9tX2J5dGVzKGl2KQogICAgICAgICAgICBTZWN1cml0eS5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoc2VjX3RyYW5zZm9ybSwgU2VjdXJpdHkua1NlY0lWS2V5LCBjZl9pdiwgZXJyb3JfcG9pbnRlcikKICAgICAgICAgICAgaGFuZGxlX2NmX2Vycm9yKGVycm9yX3BvaW50ZXIpCgogICAgICAgIFNlY3VyaXR5LlNlY1RyYW5zZm9ybVNldEF0dHJpYnV0ZSgKICAgICAgICAgICAgc2VjX3RyYW5zZm9ybSwKICAgICAgICAgICAgU2VjdXJpdHkua1NlY1RyYW5zZm9ybUlucHV0QXR0cmlidXRlTmFtZSwKICAgICAgICAgICAgY2ZfZGF0YSwKICAgICAgICAgICAgZXJyb3JfcG9pbnRlcgogICAgICAgICkKICAgICAgICBoYW5kbGVfY2ZfZXJyb3IoZXJyb3JfcG9pbnRlcikKCiAgICAgICAgcGxhaW50ZXh0ID0gU2VjdXJpdHkuU2VjVHJhbnNmb3JtRXhlY3V0ZShzZWNfdHJhbnNmb3JtLCBlcnJvcl9wb2ludGVyKQogICAgICAgIGhhbmRsZV9jZl9lcnJvcihlcnJvcl9wb2ludGVyKQoKICAgICAgICByZXR1cm4gQ0ZIZWxwZXJzLmNmX2RhdGFfdG9fYnl0ZXMocGxhaW50ZXh0KQoKICAgIGZpbmFsbHk6CiAgICAgICAgaWYgY2ZfZGljdDoKICAgICAgICAgICAgQ29yZUZvdW5kYXRpb24uQ0ZSZWxlYXNlKGNmX2RpY3QpCiAgICAgICAgaWYgY2Zfa2V5OgogICAgICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJlbGVhc2UoY2Zfa2V5KQogICAgICAgIGlmIGNmX2RhdGE6CiAgICAgICAgICAgIENvcmVGb3VuZGF0aW9uLkNGUmVsZWFzZShjZl9kYXRhKQogICAgICAgIGlmIGNmX2l2OgogICAgICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJlbGVhc2UoY2ZfaXYpCiAgICAgICAgaWYgc2VjX2tleToKICAgICAgICAgICAgQ29yZUZvdW5kYXRpb24uQ0ZSZWxlYXNlKHNlY19rZXkpCiAgICAgICAgaWYgc2VjX3RyYW5zZm9ybToKICAgICAgICAgICAgQ29yZUZvdW5kYXRpb24uQ0ZSZWxlYXNlKHNlY190cmFuc2Zvcm0pCg==
