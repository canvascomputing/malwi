statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/customizations/s3/utils.py
  contents:
  - name: RequestParamsMapper._set_request_payer_param
    score: 0.0
    code: |-
      @classmethod
          def _set_request_payer_param(cls, request_params, cli_params):
              if cli_params.get('request_payer'):
                  request_params['RequestPayer'] = cli_params['request_payer']
    tokens: resume load_fast cli_params load_attr get load_const request_payer call pop_jump_if_false TO_NUMBER load_fast cli_params load_const request_payer binary_subscr load_fast request_params load_const RequestPayer store_subscr return_const None return_const None
    hash: 2c0ac42fd4746d33bbf25837b7237ec73db536963c29ad6adfd143c63dbc4a85
sources:
  .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/customizations/s3/utils.py: IyBDb3B5cmlnaHQgMjAxMyBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLgojCiMgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIikuIFlvdQojIG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YKIyB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0CiMKIyAgICAgaHR0cDovL2F3cy5hbWF6b24uY29tL2FwYWNoZTIuMC8KIwojIG9yIGluIHRoZSAibGljZW5zZSIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMKIyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRgojIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYwojIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCmltcG9ydCBhcmdwYXJzZQppbXBvcnQgbG9nZ2luZwpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQppbXBvcnQgbWltZXR5cGVzCmltcG9ydCBlcnJubwppbXBvcnQgb3MKaW1wb3J0IHJlCmltcG9ydCB0aW1lCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IG5hbWVkdHVwbGUsIGRlcXVlCgpmcm9tIGRhdGV1dGlsLnBhcnNlciBpbXBvcnQgcGFyc2UKZnJvbSBkYXRldXRpbC50eiBpbXBvcnQgdHpsb2NhbCwgdHp1dGMKZnJvbSBzM3RyYW5zZmVyLnN1YnNjcmliZXJzIGltcG9ydCBCYXNlU3Vic2NyaWJlcgoKZnJvbSBhd3NjbGkuY29tcGF0IGltcG9ydCBieXRlc19wcmludApmcm9tIGF3c2NsaS5jb21wYXQgaW1wb3J0IHF1ZXVlCgpMT0dHRVIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKSFVNQU5JWkVfU1VGRklYRVMgPSAoJ0tpQicsICdNaUInLCAnR2lCJywgJ1RpQicsICdQaUInLCAnRWlCJykKRVBPQ0hfVElNRSA9IGRhdGV0aW1lKDE5NzAsIDEsIDEsIHR6aW5mbz10enV0YygpKQojIE1heGltdW0gb2JqZWN0IHNpemUgYWxsb3dlZCBpbiBTMy4KIyBTZWU6IGh0dHA6Ly9kb2NzLmF3cy5hbWF6b24uY29tL0FtYXpvblMzL2xhdGVzdC9kZXYvcWZhY3RzLmh0bWwKTUFYX1VQTE9BRF9TSVpFID0gNSAqICgxMDI0ICoqIDQpClNJWkVfU1VGRklYID0gewogICAgJ2tiJzogMTAyNCwKICAgICdtYic6IDEwMjQgKiogMiwKICAgICdnYic6IDEwMjQgKiogMywKICAgICd0Yic6IDEwMjQgKiogNCwKICAgICdraWInOiAxMDI0LAogICAgJ21pYic6IDEwMjQgKiogMiwKICAgICdnaWInOiAxMDI0ICoqIDMsCiAgICAndGliJzogMTAyNCAqKiA0LAp9Cl9TM19BQ0NFU1NQT0lOVF9UT19CVUNLRVRfS0VZX1JFR0VYID0gcmUuY29tcGlsZSgKICAgIHInXig/UDxidWNrZXQ+YXJuOihhd3MpLio6czM6W2EtelwtMC05XSo6WzAtOV17MTJ9OmFjY2Vzc3BvaW50WzovXVteL10rKS8/JwogICAgcicoP1A8a2V5Pi4qKSQnCikKX1MzX09VVFBPU1RfVE9fQlVDS0VUX0tFWV9SRUdFWCA9IHJlLmNvbXBpbGUoCiAgICByJ14oP1A8YnVja2V0PmFybjooYXdzKS4qOnMzLW91dHBvc3RzOlthLXpcLTAtOV0rOlswLTldezEyfTpvdXRwb3N0Wy86XScKICAgIHInW2EtekEtWjAtOVwtXXsxLDYzfVsvOl1hY2Nlc3Nwb2ludFsvOl1bYS16QS1aMC05XC1dezEsNjN9KVsvOl0/KD9QPGtleT4uKikkJwopCgpfUzNfT1VUUE9TVF9CVUNLRVRfQVJOX1RPX0JVQ0tFVF9LRVlfUkVHRVggPSByZS5jb21waWxlKAogICAgcideKD9QPGJ1Y2tldD5hcm46KGF3cykuKjpzMy1vdXRwb3N0czpbYS16XC0wLTldKzpbMC05XXsxMn06b3V0cG9zdFsvOl0nCiAgICByJ1thLXpBLVowLTlcLV17MSw2M31bLzpdYnVja2V0Wy86XScKICAgIHInW2EtekEtWjAtOVwtXXsxLDYzfSlbLzpdPyg/UDxrZXk+LiopJCcKKQoKX1MzX09CSkVDVF9MQU1CREFfVE9fQlVDS0VUX0tFWV9SRUdFWCA9IHJlLmNvbXBpbGUoCiAgICByJ14oP1A8YnVja2V0PmFybjooYXdzKS4qOnMzLW9iamVjdC1sYW1iZGE6W2EtelwtMC05XSs6WzAtOV17MTJ9OicKICAgIHInYWNjZXNzcG9pbnRbLzpdW2EtekEtWjAtOVwtXXsxLDYzfSlbLzpdPyg/UDxrZXk+LiopJCcKKQoKCmRlZiBodW1hbl9yZWFkYWJsZV9zaXplKHZhbHVlKToKICAgICIiIkNvbnZlcnQgYSBzaXplIGluIGJ5dGVzIGludG8gYSBodW1hbiByZWFkYWJsZSBmb3JtYXQuCgogICAgRm9yIGV4YW1wbGU6OgoKICAgICAgICA+Pj4gaHVtYW5fcmVhZGFibGVfc2l6ZSgxKQogICAgICAgICcxIEJ5dGUnCiAgICAgICAgPj4+IGh1bWFuX3JlYWRhYmxlX3NpemUoMTApCiAgICAgICAgJzEwIEJ5dGVzJwogICAgICAgID4+PiBodW1hbl9yZWFkYWJsZV9zaXplKDEwMjQpCiAgICAgICAgJzEuMCBLaUInCiAgICAgICAgPj4+IGh1bWFuX3JlYWRhYmxlX3NpemUoMTAyNCAqIDEwMjQpCiAgICAgICAgJzEuMCBNaUInCgogICAgOnBhcmFtIHZhbHVlOiBUaGUgc2l6ZSBpbiBieXRlcy4KICAgIDpyZXR1cm46IFRoZSBzaXplIGluIGEgaHVtYW4gcmVhZGFibGUgZm9ybWF0IGJhc2VkIG9uIGJhc2UtMiB1bml0cy4KCiAgICAiIiIKICAgIGJhc2UgPSAxMDI0CiAgICBieXRlc19pbnQgPSBmbG9hdCh2YWx1ZSkKCiAgICBpZiBieXRlc19pbnQgPT0gMToKICAgICAgICByZXR1cm4gJzEgQnl0ZScKICAgIGVsaWYgYnl0ZXNfaW50IDwgYmFzZToKICAgICAgICByZXR1cm4gJyVkIEJ5dGVzJyAlIGJ5dGVzX2ludAoKICAgIGZvciBpLCBzdWZmaXggaW4gZW51bWVyYXRlKEhVTUFOSVpFX1NVRkZJWEVTKToKICAgICAgICB1bml0ID0gYmFzZSAqKiAoaSsyKQogICAgICAgIGlmIHJvdW5kKChieXRlc19pbnQgLyB1bml0KSAqIGJhc2UpIDwgYmFzZToKICAgICAgICAgICAgcmV0dXJuICclLjFmICVzJyAlICgoYmFzZSAqIGJ5dGVzX2ludCAvIHVuaXQpLCBzdWZmaXgpCgoKZGVmIGh1bWFuX3JlYWRhYmxlX3RvX2J5dGVzKHZhbHVlKToKICAgICIiIkNvbnZlcnRzIGEgaHVtYW4gcmVhZGFibGUgc2l6ZSB0byBieXRlcy4KCiAgICA6cGFyYW0gdmFsdWU6IEEgc3RyaW5nIHN1Y2ggYXMgIjEwTUIiLiAgSWYgYSBzdWZmaXggaXMgbm90IGluY2x1ZGVkLAogICAgICAgIHRoZW4gdGhlIHZhbHVlIGlzIGFzc3VtZWQgdG8gYmUgYW4gaW50ZWdlciByZXByZXNlbnRpbmcgdGhlIHNpemUKICAgICAgICBpbiBieXRlcy4KICAgIDpyZXR1cm5zOiBUaGUgY29udmVydGVkIHZhbHVlIGluIGJ5dGVzIGFzIGFuIGludGVnZXIKCiAgICAiIiIKICAgIHZhbHVlID0gdmFsdWUubG93ZXIoKQogICAgaWYgdmFsdWVbLTI6XSA9PSAnaWInOgogICAgICAgICMgQXNzdW1lIElFQyBzdWZmaXguCiAgICAgICAgc3VmZml4ID0gdmFsdWVbLTM6XS5sb3dlcigpCiAgICBlbHNlOgogICAgICAgIHN1ZmZpeCA9IHZhbHVlWy0yOl0ubG93ZXIoKQogICAgaGFzX3NpemVfaWRlbnRpZmllciA9ICgKICAgICAgICBsZW4odmFsdWUpID49IDIgYW5kIHN1ZmZpeCBpbiBTSVpFX1NVRkZJWCkKICAgIGlmIG5vdCBoYXNfc2l6ZV9pZGVudGlmaWVyOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIGludCh2YWx1ZSkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiSW52YWxpZCBzaXplIHZhbHVlOiAlcyIgJSB2YWx1ZSkKICAgIGVsc2U6CiAgICAgICAgbXVsdGlwbGllciA9IFNJWkVfU1VGRklYW3N1ZmZpeF0KICAgICAgICByZXR1cm4gaW50KHZhbHVlWzotbGVuKHN1ZmZpeCldKSAqIG11bHRpcGxpZXIKCgpjbGFzcyBBcHBlbmRGaWx0ZXIoYXJncGFyc2UuQWN0aW9uKToKICAgICIiIgogICAgVGhpcyBjbGFzcyBpcyB1c2VkIGFzIGFuIGFjdGlvbiB3aGVuIHBhcnNpbmcgdGhlIHBhcmFtZXRlcnMuCiAgICBTcGVjaWZpY2FsbHkgaXQgaXMgdXNlZCBmb3IgYWN0aW9ucyBjb3JyZXNwb25kaW5nIHRvIGV4Y2x1ZGUKICAgIGFuZCBpbmNsdWRlIGZpbHRlcnMuICBXaGF0IGl0IGRvZXMgaXMgdGhhdCBpdCBhcHBlbmRzIGEgbGlzdAogICAgY29uc2lzdGluZyBvZiB0aGUgbmFtZSBvZiB0aGUgcGFyYW1ldGVyIGFuZCBpdHMgdmFsdWUgb250bwogICAgYSBsaXN0IGNvbnRhaW5pbmcgdGhlc2UgW3BhcmFtZXRlciwgdmFsdWVdIGxpc3RzLiAgSW4gdGhpcwogICAgY2FzZSwgdGhlIG5hbWUgb2YgdGhlIHBhcmFtZXRlciB3aWxsIGVpdGhlciBiZSAtLWluY2x1ZGUgb3IKICAgIC0tZXhjbHVkZSBhbmQgdGhlIHZhbHVlIHdpbGwgYmUgdGhlIHJ1bGUgdG8gYXBwbHkuICBUaGlzIHdpbGwKICAgIGZvcm1hdCBhbGwgb2YgdGhlIHJ1bGVzIGlucHV0dGVkIGludG8gdGhlIGNvbW1hbmQgbGluZQogICAgaW4gYSB3YXkgY29tcGF0aWJsZSB3aXRoIHRoZSBGaWx0ZXIgY2xhc3MuICBOb3RlIHRoYXQgcnVsZXMgdGhhdAogICAgYXBwZWFyIGxhdGVyIGluIHRoZSBjb21tYW5kIGxpbmUgdGFrZSBwcmVmZXJlbmNlIG92ZXIgcnVsZXJzIHRoYXQKICAgIGFwcGVhciBlYXJsaWVyLgogICAgIiIiCiAgICBkZWYgX19jYWxsX18oc2VsZiwgcGFyc2VyLCBuYW1lc3BhY2UsIHZhbHVlcywgb3B0aW9uX3N0cmluZz1Ob25lKToKICAgICAgICBmaWx0ZXJfbGlzdCA9IGdldGF0dHIobmFtZXNwYWNlLCBzZWxmLmRlc3QpCiAgICAgICAgaWYgZmlsdGVyX2xpc3Q6CiAgICAgICAgICAgIGZpbHRlcl9saXN0LmFwcGVuZChbb3B0aW9uX3N0cmluZywgdmFsdWVzWzBdXSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBmaWx0ZXJfbGlzdCA9IFtbb3B0aW9uX3N0cmluZywgdmFsdWVzWzBdXV0KICAgICAgICBzZXRhdHRyKG5hbWVzcGFjZSwgc2VsZi5kZXN0LCBmaWx0ZXJfbGlzdCkKCgpjbGFzcyBDcmVhdGVEaXJlY3RvcnlFcnJvcihFeGNlcHRpb24pOgogICAgcGFzcwoKCmNsYXNzIFN0YWJsZVByaW9yaXR5UXVldWUocXVldWUuUXVldWUpOgogICAgIiIiUHJpb3JpdHkgcXVldWUgdGhhdCBtYWludGFpbnMgRklGTyBvcmRlciBmb3Igc2FtZSBwcmlvcml0eSBpdGVtcy4KCiAgICBUaGlzIGNsYXNzIHdhcyB3cml0dGVuIHRvIGhhbmRsZSB0aGUgdGFza3MgY3JlYXRlZCBpbgogICAgYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnRhc2tzLCBidXQgaXQncyBwb3NzaWJsZSB0byB1c2UgdGhpcwogICAgY2xhc3Mgb3V0c2lkZSBvZiB0aGF0IGNvbnRleHQuICBJbiBvcmRlciBmb3IgdGhpcyB0byBiZSB0aGUgY2FzZSwKICAgIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBzaG91bGQgYmUgbWV0OgoKICAgICAgICAqIE9iamVjdHMgdGhhdCBhcmUgcXVldWVkIHNob3VsZCBoYXZlIGEgUFJJT1JJVFkgYXR0cmlidXRlLgogICAgICAgICAgVGhpcyBzaG91bGQgYmUgYW4gaW50ZWdlciB2YWx1ZSBub3QgdG8gZXhjZWVkIHRoZSBtYXhfcHJpb3JpdHkKICAgICAgICAgIHZhbHVlIHBhc3NlZCBpbnRvIHRoZSBgYF9faW5pdF9fYGAuICBPYmplY3RzIHdpdGggbG93ZXIKICAgICAgICAgIHByaW9yaXR5IG51bWJlcnMgYXJlIHJldHJpZXZlZCBiZWZvcmUgb2JqZWN0cyB3aXRoIGhpZ2hlcgogICAgICAgICAgcHJpb3JpdHkgbnVtYmVycy4KICAgICAgICAqIEEgcmVsYXRpdmVseSBzbWFsbCBtYXhfcHJpb3JpdHkgc2hvdWxkIGJlIGNob3Nlbi4gIGBgZ2V0KClgYAogICAgICAgICAgY2FsbHMgYXJlIE8obWF4X3ByaW9yaXR5KS4KCiAgICBBbnkgb2JqZWN0IHRoYXQgZG9lcyBub3QgaGF2ZSBhIGBgUFJJT1JJVFlgYCBhdHRyaWJ1dGUgb3Igd2hvc2UKICAgIHByaW9yaXR5IGV4Y2VlZHMgYGBtYXhfcHJpb3JpdHlgYCB3aWxsIGJlIHF1ZXVlZCBhdCB0aGUgaGlnaGVzdAogICAgKGxlYXN0IGltcG9ydGFudCkgcHJpb3JpdHkgYXZhaWxhYmxlLgoKICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG1heHNpemU9MCwgbWF4X3ByaW9yaXR5PTIwKToKICAgICAgICBxdWV1ZS5RdWV1ZS5fX2luaXRfXyhzZWxmLCBtYXhzaXplPW1heHNpemUpCiAgICAgICAgc2VsZi5wcmlvcml0aWVzID0gW2RlcXVlKFtdKSBmb3IgaSBpbiByYW5nZShtYXhfcHJpb3JpdHkgKyAxKV0KICAgICAgICBzZWxmLmRlZmF1bHRfcHJpb3JpdHkgPSBtYXhfcHJpb3JpdHkKCiAgICBkZWYgX3FzaXplKHNlbGYpOgogICAgICAgIHNpemUgPSAwCiAgICAgICAgZm9yIGJ1Y2tldCBpbiBzZWxmLnByaW9yaXRpZXM6CiAgICAgICAgICAgIHNpemUgKz0gbGVuKGJ1Y2tldCkKICAgICAgICByZXR1cm4gc2l6ZQoKICAgIGRlZiBfcHV0KHNlbGYsIGl0ZW0pOgogICAgICAgIHByaW9yaXR5ID0gbWluKGdldGF0dHIoaXRlbSwgJ1BSSU9SSVRZJywgc2VsZi5kZWZhdWx0X3ByaW9yaXR5KSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kZWZhdWx0X3ByaW9yaXR5KQogICAgICAgIHNlbGYucHJpb3JpdGllc1twcmlvcml0eV0uYXBwZW5kKGl0ZW0pCgogICAgZGVmIF9nZXQoc2VsZik6CiAgICAgICAgZm9yIGJ1Y2tldCBpbiBzZWxmLnByaW9yaXRpZXM6CiAgICAgICAgICAgIGlmIG5vdCBidWNrZXQ6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICByZXR1cm4gYnVja2V0LnBvcGxlZnQoKQoKCmRlZiBibG9ja191bnN1cHBvcnRlZF9yZXNvdXJjZXMoczNfcGF0aCk6CiAgICAjIEFXUyBDTEkgczMgY29tbWFuZHMgZG9uJ3Qgc3VwcG9ydCBvYmplY3QgbGFtYmRhcyBvbmx5IGRpcmVjdCBBUEkgY2FsbHMKICAgICMgYXJlIGF2YWlsYWJsZSBmb3Igc3VjaCByZXNvdXJjZXMKICAgIGlmIF9TM19PQkpFQ1RfTEFNQkRBX1RPX0JVQ0tFVF9LRVlfUkVHRVgubWF0Y2goczNfcGF0aCk6CiAgICAgICAgIyBJbiBBV1MgQ0xJIHYyIHdlIHNob3VsZCB1c2UKICAgICAgICAjIGF3c2NsaS5jdXN0b21pemF0aW9ucy5leGNlcHRpb25zLlBhcmFtVmFsaWRhdGlvbkVycm9yCiAgICAgICAgIyBpbnN0ZWFkIG9mIFZhbHVlRXJyb3IKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKAogICAgICAgICAgICAnczMgY29tbWFuZHMgZG8gbm90IHN1cHBvcnQgUzMgT2JqZWN0IExhbWJkYSByZXNvdXJjZXMuICcKICAgICAgICAgICAgJ1VzZSBzM2FwaSBjb21tYW5kcyBpbnN0ZWFkLicKICAgICAgICApCiAgICAjIEFXUyBTMyBBUEkgYW5kIEFXUyBDTEkgczMgY29tbWFuZHMgZG9uJ3Qgc3VwcG9ydCBPdXRwb3N0IGJ1Y2tldCBBUk5zCiAgICAjIG9ubHkgczNjb250cm9sIEFQSSBzdXBwb3J0cyB0aGVtIHNvIGZhcgogICAgaWYgX1MzX09VVFBPU1RfQlVDS0VUX0FSTl9UT19CVUNLRVRfS0VZX1JFR0VYLm1hdGNoKHMzX3BhdGgpOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICdzMyBjb21tYW5kcyBkbyBub3Qgc3VwcG9ydCBPdXRwb3N0IEJ1Y2tldCBBUk5zLiAnCiAgICAgICAgICAgICdVc2UgczNjb250cm9sIGNvbW1hbmRzIGluc3RlYWQuJwogICAgICAgICkKCgpkZWYgZmluZF9idWNrZXRfa2V5KHMzX3BhdGgpOgogICAgIiIiCiAgICBUaGlzIGlzIGEgaGVscGVyIGZ1bmN0aW9uIHRoYXQgZ2l2ZW4gYW4gczMgcGF0aCBzdWNoIHRoYXQgdGhlIHBhdGggaXMgb2YKICAgIHRoZSBmb3JtOiBidWNrZXQva2V5CiAgICBJdCB3aWxsIHJldHVybiB0aGUgYnVja2V0IGFuZCB0aGUga2V5IHJlcHJlc2VudGVkIGJ5IHRoZSBzMyBwYXRoCiAgICAiIiIKICAgIGJsb2NrX3Vuc3VwcG9ydGVkX3Jlc291cmNlcyhzM19wYXRoKQogICAgbWF0Y2ggPSBfUzNfQUNDRVNTUE9JTlRfVE9fQlVDS0VUX0tFWV9SRUdFWC5tYXRjaChzM19wYXRoKQogICAgaWYgbWF0Y2g6CiAgICAgICAgcmV0dXJuIG1hdGNoLmdyb3VwKCdidWNrZXQnKSwgbWF0Y2guZ3JvdXAoJ2tleScpCiAgICBtYXRjaCA9IF9TM19PVVRQT1NUX1RPX0JVQ0tFVF9LRVlfUkVHRVgubWF0Y2goczNfcGF0aCkKICAgIGlmIG1hdGNoOgogICAgICAgIHJldHVybiBtYXRjaC5ncm91cCgnYnVja2V0JyksIG1hdGNoLmdyb3VwKCdrZXknKQogICAgczNfY29tcG9uZW50cyA9IHMzX3BhdGguc3BsaXQoJy8nLCAxKQogICAgYnVja2V0ID0gczNfY29tcG9uZW50c1swXQogICAgczNfa2V5ID0gJycKICAgIGlmIGxlbihzM19jb21wb25lbnRzKSA+IDE6CiAgICAgICAgczNfa2V5ID0gczNfY29tcG9uZW50c1sxXQogICAgcmV0dXJuIGJ1Y2tldCwgczNfa2V5CgoKZGVmIHNwbGl0X3MzX2J1Y2tldF9rZXkoczNfcGF0aCk6CiAgICAiIiJTcGxpdCBzMyBwYXRoIGludG8gYnVja2V0IGFuZCBrZXkgcHJlZml4LgoKICAgIFRoaXMgd2lsbCBhbHNvIGhhbmRsZSB0aGUgczM6Ly8gcHJlZml4LgoKICAgIDpyZXR1cm46IFR1cGxlIG9mICgnYnVja2V0bmFtZScsICdrZXluYW1lJykKCiAgICAiIiIKICAgIGlmIHMzX3BhdGguc3RhcnRzd2l0aCgnczM6Ly8nKToKICAgICAgICBzM19wYXRoID0gczNfcGF0aFs1Ol0KICAgIHJldHVybiBmaW5kX2J1Y2tldF9rZXkoczNfcGF0aCkKCgpkZWYgZ2V0X2ZpbGVfc3RhdChwYXRoKToKICAgICIiIgogICAgVGhpcyBpcyBhIGhlbHBlciBmdW5jdGlvbiB0aGF0IGdpdmVuIGEgbG9jYWwgcGF0aCByZXR1cm4gdGhlIHNpemUgb2YKICAgIHRoZSBmaWxlIGluIGJ5dGVzIGFuZCB0aW1lIG9mIGxhc3QgbW9kaWZpY2F0aW9uLgogICAgIiIiCiAgICB0cnk6CiAgICAgICAgc3RhdHMgPSBvcy5zdGF0KHBhdGgpCiAgICBleGNlcHQgSU9FcnJvciBhcyBlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ0NvdWxkIG5vdCByZXRyaWV2ZSBmaWxlIHN0YXQgb2YgIiVzIjogJXMnICUgKAogICAgICAgICAgICBwYXRoLCBlKSkKCiAgICB0cnk6CiAgICAgICAgdXBkYXRlX3RpbWUgPSBkYXRldGltZS5mcm9tdGltZXN0YW1wKHN0YXRzLnN0X210aW1lLCB0emxvY2FsKCkpCiAgICBleGNlcHQgKFZhbHVlRXJyb3IsIE9TRXJyb3IsIE92ZXJmbG93RXJyb3IpOgogICAgICAgICMgUHl0aG9uJ3MgZnJvbXRpbWVzdGFtcCByYWlzZXMgdmFsdWUgZXJyb3JzIHdoZW4gdGhlIHRpbWVzdGFtcCBpcyBvdXQKICAgICAgICAjIG9mIHJhbmdlIG9mIHRoZSBwbGF0Zm9ybSdzIEMgbG9jYWx0aW1lKCkgZnVuY3Rpb24uIFRoaXMgY2FuIGNhdXNlCiAgICAgICAgIyBpc3N1ZXMgd2hlbiBzeW5jaW5nIGZyb20gc3lzdGVtcyB3aXRoIGEgd2lkZSByYW5nZSBvZiB2YWxpZAogICAgICAgICMgdGltZXN0YW1wcyB0byBzeXN0ZW1zIHdpdGggYSBsb3dlciByYW5nZS4gU29tZSBzeXN0ZW1zIHN1cHBvcnQKICAgICAgICAjIDY0LWJpdCB0aW1lc3RhbXBzLCBmb3IgaW5zdGFuY2UsIHdoaWxlIG90aGVycyBvbmx5IHN1cHBvcnQgMzItYml0LgogICAgICAgICMgV2UgZG9uJ3Qgd2FudCB0byBmYWlsIGluIHRoZXNlIGNhc2VzLCBzbyBpbnN0ZWFkIHdlIHBhc3MgYWxvbmcgbm9uZS4KICAgICAgICB1cGRhdGVfdGltZSA9IE5vbmUKCiAgICByZXR1cm4gc3RhdHMuc3Rfc2l6ZSwgdXBkYXRlX3RpbWUKCgpkZWYgZmluZF9kZXN0X3BhdGhfY29tcF9rZXkoZmlsZXMsIHNyY19wYXRoPU5vbmUpOgogICAgIiIiCiAgICBUaGlzIGlzIGEgaGVscGVyIGZ1bmN0aW9uIHRoYXQgZGV0ZXJtaW5lcyB0aGUgZGVzdGluYXRpb24gcGF0aCBhbmQgY29tcGFyZQogICAga2V5IGdpdmVuIHBhcmFtZXRlcnMgcmVjZWl2ZWQgZnJvbSB0aGUgYGBGaWxlRm9ybWF0YGAgY2xhc3MuCiAgICAiIiIKICAgIHNyYyA9IGZpbGVzWydzcmMnXQogICAgZGVzdCA9IGZpbGVzWydkZXN0J10KICAgIHNyY190eXBlID0gc3JjWyd0eXBlJ10KICAgIGRlc3RfdHlwZSA9IGRlc3RbJ3R5cGUnXQogICAgaWYgc3JjX3BhdGggaXMgTm9uZToKICAgICAgICBzcmNfcGF0aCA9IHNyY1sncGF0aCddCgogICAgc2VwX3RhYmxlID0geydzMyc6ICcvJywgJ2xvY2FsJzogb3Muc2VwfQoKICAgIGlmIGZpbGVzWydkaXJfb3AnXToKICAgICAgICByZWxfcGF0aCA9IHNyY19wYXRoW2xlbihzcmNbJ3BhdGgnXSk6XQogICAgZWxzZToKICAgICAgICByZWxfcGF0aCA9IHNyY19wYXRoLnNwbGl0KHNlcF90YWJsZVtzcmNfdHlwZV0pWy0xXQogICAgY29tcGFyZV9rZXkgPSByZWxfcGF0aC5yZXBsYWNlKHNlcF90YWJsZVtzcmNfdHlwZV0sICcvJykKICAgIGlmIGZpbGVzWyd1c2Vfc3JjX25hbWUnXToKICAgICAgICBkZXN0X3BhdGggPSBkZXN0WydwYXRoJ10KICAgICAgICBkZXN0X3BhdGggKz0gcmVsX3BhdGgucmVwbGFjZShzZXBfdGFibGVbc3JjX3R5cGVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcF90YWJsZVtkZXN0X3R5cGVdKQogICAgZWxzZToKICAgICAgICBkZXN0X3BhdGggPSBkZXN0WydwYXRoJ10KICAgIHJldHVybiBkZXN0X3BhdGgsIGNvbXBhcmVfa2V5CgoKZGVmIGNyZWF0ZV93YXJuaW5nKHBhdGgsIGVycm9yX21lc3NhZ2UsIHNraXBfZmlsZT1UcnVlKToKICAgICIiIgogICAgVGhpcyBjcmVhdGVzIGEgYGBQcmludFRhc2tgYCBmb3Igd2hlbmV2ZXIgYSB3YXJuaW5nIGlzIHRvIGJlIHRocm93bi4KICAgICIiIgogICAgcHJpbnRfc3RyaW5nID0gIndhcm5pbmc6ICIKICAgIGlmIHNraXBfZmlsZToKICAgICAgICBwcmludF9zdHJpbmcgPSBwcmludF9zdHJpbmcgKyAiU2tpcHBpbmcgZmlsZSAiICsgcGF0aCArICIuICIKICAgIHByaW50X3N0cmluZyA9IHByaW50X3N0cmluZyArIGVycm9yX21lc3NhZ2UKICAgIHdhcm5pbmdfbWVzc2FnZSA9IFdhcm5pbmdSZXN1bHQobWVzc2FnZT1wcmludF9zdHJpbmcsIGVycm9yPUZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nPVRydWUpCiAgICByZXR1cm4gd2FybmluZ19tZXNzYWdlCgoKY2xhc3MgU3Rkb3V0Qnl0ZXNXcml0ZXIob2JqZWN0KToKICAgICIiIgogICAgVGhpcyBjbGFzcyBhY3RzIGFzIGEgZmlsZS1saWtlIG9iamVjdCB0aGF0IHBlcmZvcm1zIHRoZSBieXRlc19wcmludAogICAgZnVuY3Rpb24gb24gd3JpdGUuCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzdGRvdXQ9Tm9uZSk6CiAgICAgICAgc2VsZi5fc3Rkb3V0ID0gc3Rkb3V0CgogICAgZGVmIHdyaXRlKHNlbGYsIGIpOgogICAgICAgICIiIgogICAgICAgIFdyaXRlcyBkYXRhIHRvIHN0ZG91dCBhcyBieXRlcy4KCiAgICAgICAgOnBhcmFtIGI6IGRhdGEgdG8gd3JpdGUKICAgICAgICAiIiIKICAgICAgICBieXRlc19wcmludChiLCBzZWxmLl9zdGRvdXQpCgoKZGVmIGd1ZXNzX2NvbnRlbnRfdHlwZShmaWxlbmFtZSk6CiAgICAiIiJHaXZlbiBhIGZpbGVuYW1lLCBndWVzcyBpdCdzIGNvbnRlbnQgdHlwZS4KCiAgICBJZiB0aGUgdHlwZSBjYW5ub3QgYmUgZ3Vlc3NlZCwgYSB2YWx1ZSBvZiBOb25lIGlzIHJldHVybmVkLgogICAgIiIiCiAgICB0cnk6CiAgICAgICAgcmV0dXJuIG1pbWV0eXBlcy5ndWVzc190eXBlKGZpbGVuYW1lKVswXQogICAgIyBUaGlzIGNhdGNoZXMgYSBidWcgaW4gdGhlIG1pbWV0eXBlIGxpYnJhcnkgd2hlcmUgc29tZSBNSU1FIHR5cGVzCiAgICAjIHNwZWNpZmljYWxseSBvbiB3aW5kb3dzIG1hY2hpbmVzIGNhdXNlIGEgVW5pY29kZURlY29kZUVycm9yCiAgICAjIGJlY2F1c2UgdGhlIE1JTUUgdHlwZSBpbiB0aGUgV2luZG93cyByZWdpc3RyeSBoYXMgYW4gZW5jb2RpbmcKICAgICMgdGhhdCBjYW5ub3QgYmUgcHJvcGVybHkgZW5jb2RlZCB1c2luZyB0aGUgZGVmYXVsdCBzeXN0ZW0gZW5jb2RpbmcuCiAgICAjIGh0dHBzOi8vYnVncy5weXRob24ub3JnL2lzc3VlOTI5MQogICAgIwogICAgIyBTbyBpbnN0ZWFkIG9mIGhhcmQgZmFpbGluZywganVzdCBsb2cgdGhlIGlzc3VlIGFuZCBmYWxsIGJhY2sgdG8gdGhlCiAgICAjIGRlZmF1bHQgZ3Vlc3NlZCBjb250ZW50IHR5cGUgb2YgTm9uZS4KICAgIGV4Y2VwdCBVbmljb2RlRGVjb2RlRXJyb3I6CiAgICAgICAgTE9HR0VSLmRlYnVnKAogICAgICAgICAgICAnVW5hYmxlIHRvIGd1ZXNzIGNvbnRlbnQgdHlwZSBmb3IgJXMgZHVlIHRvICcKICAgICAgICAgICAgJ1VuaWNvZGVEZWNvZGVFcnJvcjogJywgZmlsZW5hbWUsIGV4Y19pbmZvPVRydWUKICAgICAgICApCgoKZGVmIHJlbGF0aXZlX3BhdGgoZmlsZW5hbWUsIHN0YXJ0PW9zLnBhdGguY3VyZGlyKToKICAgICIiIkNyb3NzIHBsYXRmb3JtIHJlbGF0aXZlIHBhdGggb2YgYSBmaWxlbmFtZS4KCiAgICBJZiBubyByZWxhdGl2ZSBwYXRoIGNhbiBiZSBjYWxjdWxhdGVkIChpLmUgZGlmZmVyZW50CiAgICBkcml2ZXMgb24gV2luZG93cyksIHRoZW4gaW5zdGVhZCBvZiByYWlzaW5nIGEgVmFsdWVFcnJvciwKICAgIHRoZSBhYnNvbHV0ZSBwYXRoIGlzIHJldHVybmVkLgoKICAgICIiIgogICAgdHJ5OgogICAgICAgIGRpcm5hbWUsIGJhc2VuYW1lID0gb3MucGF0aC5zcGxpdChmaWxlbmFtZSkKICAgICAgICByZWxhdGl2ZV9kaXIgPSBvcy5wYXRoLnJlbHBhdGgoZGlybmFtZSwgc3RhcnQpCiAgICAgICAgcmV0dXJuIG9zLnBhdGguam9pbihyZWxhdGl2ZV9kaXIsIGJhc2VuYW1lKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcmV0dXJuIG9zLnBhdGguYWJzcGF0aChmaWxlbmFtZSkKCgpkZWYgc2V0X2ZpbGVfdXRpbWUoZmlsZW5hbWUsIGRlc2lyZWRfdGltZSk6CiAgICAiIiIKICAgIFNldCB0aGUgdXRpbWUgb2YgYSBmaWxlLCBhbmQgaWYgaXQgZmFpbHMsIHJhaXNlIGEgbW9yZSBleHBsaWNpdCBlcnJvci4KCiAgICA6cGFyYW0gZmlsZW5hbWU6IHRoZSBmaWxlIHRvIG1vZGlmeQogICAgOnBhcmFtIGRlc2lyZWRfdGltZTogdGhlIGVwb2NoIHRpbWVzdGFtcCB0byBzZXQgZm9yIGF0aW1lIGFuZCBtdGltZS4KICAgIDpyYWlzZXM6IFNldEZpbGVVdGltZUVycm9yOiBpZiB5b3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbiAoZXJybm8gMSkKICAgIDpyYWlzZXM6IE9TRXJyb3I6IGZvciBhbGwgZXJyb3JzIG90aGVyIHRoYW4gZXJybm8gMQogICAgIiIiCiAgICB0cnk6CiAgICAgICAgb3MudXRpbWUoZmlsZW5hbWUsIChkZXNpcmVkX3RpbWUsIGRlc2lyZWRfdGltZSkpCiAgICBleGNlcHQgT1NFcnJvciBhcyBlOgogICAgICAgICMgT25seSByYWlzZSBhIG1vcmUgZXhwbGljaXQgZXhjZXB0aW9uIHdoZW4gaXQgaXMgYSBwZXJtaXNzaW9uIGlzc3VlLgogICAgICAgIGlmIGUuZXJybm8gIT0gZXJybm8uRVBFUk06CiAgICAgICAgICAgIHJhaXNlIGUKICAgICAgICByYWlzZSBTZXRGaWxlVXRpbWVFcnJvcigKICAgICAgICAgICAgKCJUaGUgZmlsZSB3YXMgZG93bmxvYWRlZCwgYnV0IGF0dGVtcHRpbmcgdG8gbW9kaWZ5IHRoZSAiCiAgICAgICAgICAgICAidXRpbWUgb2YgdGhlIGZpbGUgZmFpbGVkLiBJcyB0aGUgZmlsZSBvd25lZCBieSBhbm90aGVyIHVzZXI/IikpCgoKY2xhc3MgU2V0RmlsZVV0aW1lRXJyb3IoRXhjZXB0aW9uKToKICAgIHBhc3MKCgpkZWYgX2RhdGVfcGFyc2VyKGRhdGVfc3RyaW5nKToKICAgIHJldHVybiBwYXJzZShkYXRlX3N0cmluZykuYXN0aW1lem9uZSh0emxvY2FsKCkpCgoKY2xhc3MgQnVja2V0TGlzdGVyKG9iamVjdCk6CiAgICAiIiJMaXN0IGtleXMgaW4gYSBidWNrZXQuIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgY2xpZW50LCBkYXRlX3BhcnNlcj1fZGF0ZV9wYXJzZXIpOgogICAgICAgIHNlbGYuX2NsaWVudCA9IGNsaWVudAogICAgICAgIHNlbGYuX2RhdGVfcGFyc2VyID0gZGF0ZV9wYXJzZXIKCiAgICBkZWYgbGlzdF9vYmplY3RzKHNlbGYsIGJ1Y2tldCwgcHJlZml4PU5vbmUsIHBhZ2Vfc2l6ZT1Ob25lLAogICAgICAgICAgICAgICAgICAgICBleHRyYV9hcmdzPU5vbmUpOgogICAgICAgIGt3YXJncyA9IHsnQnVja2V0JzogYnVja2V0LCAnUGFnaW5hdGlvbkNvbmZpZyc6IHsnUGFnZVNpemUnOiBwYWdlX3NpemV9fQogICAgICAgIGlmIHByZWZpeCBpcyBub3QgTm9uZToKICAgICAgICAgICAga3dhcmdzWydQcmVmaXgnXSA9IHByZWZpeAogICAgICAgIGlmIGV4dHJhX2FyZ3MgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGt3YXJncy51cGRhdGUoZXh0cmFfYXJncykKCiAgICAgICAgcGFnaW5hdG9yID0gc2VsZi5fY2xpZW50LmdldF9wYWdpbmF0b3IoJ2xpc3Rfb2JqZWN0c192MicpCiAgICAgICAgcGFnZXMgPSBwYWdpbmF0b3IucGFnaW5hdGUoKiprd2FyZ3MpCiAgICAgICAgZm9yIHBhZ2UgaW4gcGFnZXM6CiAgICAgICAgICAgIGNvbnRlbnRzID0gcGFnZS5nZXQoJ0NvbnRlbnRzJywgW10pCiAgICAgICAgICAgIGZvciBjb250ZW50IGluIGNvbnRlbnRzOgogICAgICAgICAgICAgICAgc291cmNlX3BhdGggPSBidWNrZXQgKyAnLycgKyBjb250ZW50WydLZXknXQogICAgICAgICAgICAgICAgY29udGVudFsnTGFzdE1vZGlmaWVkJ10gPSBzZWxmLl9kYXRlX3BhcnNlcigKICAgICAgICAgICAgICAgICAgICBjb250ZW50WydMYXN0TW9kaWZpZWQnXSkKICAgICAgICAgICAgICAgIHlpZWxkIHNvdXJjZV9wYXRoLCBjb250ZW50CgoKY2xhc3MgUHJpbnRUYXNrKG5hbWVkdHVwbGUoJ1ByaW50VGFzaycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgWydtZXNzYWdlJywgJ2Vycm9yJywgJ3RvdGFsX3BhcnRzJywgJ3dhcm5pbmcnXSkpOgogICAgZGVmIF9fbmV3X18oY2xzLCBtZXNzYWdlLCBlcnJvcj1GYWxzZSwgdG90YWxfcGFydHM9Tm9uZSwgd2FybmluZz1Ob25lKToKICAgICAgICAiIiIKICAgICAgICA6cGFyYW0gbWVzc2FnZTogQW4gYXJiaXRyYXJ5IHN0cmluZyBhc3NvY2lhdGVkIHdpdGggdGhlIGVudHJ5LiAgIFRoaXMKICAgICAgICAgICAgY2FuIGJlIHVzZWQgdG8gY29tbXVuaWNhdGUgdGhlIHJlc3VsdCBvZiB0aGUgdGFzay4KICAgICAgICA6cGFyYW0gZXJyb3I6IEJvb2xlYW4gaW5kaWNhdGluZyBhIGZhaWx1cmUuCiAgICAgICAgOnBhcmFtIHRvdGFsX3BhcnRzOiBUaGUgdG90YWwgbnVtYmVyIG9mIHBhcnRzIGZvciBtdWx0aXBhcnQgdHJhbnNmZXJzLgogICAgICAgIDpwYXJhbSB3YXJuaW5nOiBCb29sZWFuIGluZGljYXRpbmcgYSB3YXJuaW5nCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHN1cGVyKFByaW50VGFzaywgY2xzKS5fX25ld19fKGNscywgbWVzc2FnZSwgZXJyb3IsIHRvdGFsX3BhcnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nKQoKV2FybmluZ1Jlc3VsdCA9IFByaW50VGFzawoKCmNsYXNzIFJlcXVlc3RQYXJhbXNNYXBwZXIob2JqZWN0KToKICAgICIiIkEgdXRpbGl0eSBjbGFzcyB0aGF0IG1hcHMgQ0xJIHBhcmFtcyB0byByZXF1ZXN0IHBhcmFtcwoKICAgIEVhY2ggbWV0aG9kIGluIHRoZSBjbGFzcyBtYXBzIHRvIGEgcGFydGljdWxhciBvcGVyYXRpb24gYW5kIHdpbGwgc2V0CiAgICB0aGUgcmVxdWVzdCBwYXJhbWV0ZXJzIGRlcGVuZGluZyBvbiB0aGUgb3BlcmF0aW9uIGFuZCBDTEkgcGFyYW1ldGVycwogICAgcHJvdmlkZWQuIEZvciBlYWNoIG9mIHRoZSBjbGFzcydzIG1ldGhvZHMgdGhlIHBhcmFtZXRlcnMgYXJlIGFzIGZvbGxvd3M6CgogICAgOnR5cGUgcmVxdWVzdF9wYXJhbXM6IGRpY3QKICAgIDpwYXJhbSByZXF1ZXN0X3BhcmFtczogQSBkaWN0aW9uYXJ5IHRvIGJlIGZpbGxlZCBvdXQgd2l0aCB0aGUgYXBwcm9wcmlhdGUKICAgICAgICBwYXJhbWV0ZXJzIGZvciB0aGUgc3BlY2lmaWVkIGNsaWVudCBvcGVyYXRpb24gdXNpbmcgdGhlIGN1cnJlbnQgQ0xJCiAgICAgICAgcGFyYW1ldGVycwoKICAgIDp0eXBlIGNsaV9wYXJhbXM6IGRpY3QKICAgIDpwYXJhbSBjbGlfcGFyYW1zOiBBIGRpY3Rpb25hcnkgb2YgdGhlIGN1cnJlbnQgQ0xJIHBhcmFtcyB0aGF0IHdpbGwgYmUKICAgICAgICB1c2VkIHRvIGdlbmVyYXRlIHRoZSByZXF1ZXN0IHBhcmFtZXRlcnMgZm9yIHRoZSBzcGVjaWZpZWQgb3BlcmF0aW9uCgogICAgRm9yIGV4YW1wbGUsIHRha2UgdGhlIG1hcHBpbmcgb2YgcmVxdWVzdCBwYXJhbWV0ZXJzIGZvciBQdXRPYmplY3Q6OgoKICAgICAgICA+Pj4gY2xpX3JlcXVlc3RfcGFyYW1zID0geydzc2UnOiAnQUVTMjU2JywgJ3N0b3JhZ2VfY2xhc3MnOiAnR0xBQ0lFUid9CiAgICAgICAgPj4+IHJlcXVlc3RfcGFyYW1zID0ge30KICAgICAgICA+Pj4gUmVxdWVzdFBhcmFtc01hcHBlci5tYXBfcHV0X29iamVjdF9wYXJhbXMoCiAgICAgICAgICAgICAgICByZXF1ZXN0X3BhcmFtcywgY2xpX3JlcXVlc3RfcGFyYW1zKQogICAgICAgID4+PiBwcmludChyZXF1ZXN0X3BhcmFtcykKICAgICAgICB7J1N0b3JhZ2VDbGFzcyc6ICdHTEFDSUVSJywgJ1NlcnZlclNpZGVFbmNyeXB0aW9uJzogJ0FFUzI1Nid9CgogICAgTm90ZSB0aGF0IGV4aXN0aW5nIHBhcmFtZXRlcnMgaW4gYGByZXF1ZXN0X3BhcmFtc2BgIHdpbGwgYmUgb3ZlcnJpZGRlbiBpZgogICAgYSBwYXJhbWV0ZXIgaW4gYGBjbGlfcGFyYW1zYGAgbWFwcyB0byB0aGUgZXhpc3RpbmcgcGFyYW1ldGVyLgogICAgIiIiCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBtYXBfcHV0X29iamVjdF9wYXJhbXMoY2xzLCByZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcyk6CiAgICAgICAgIiIiTWFwIENMSSBwYXJhbXMgdG8gUHV0T2JqZWN0IHJlcXVlc3QgcGFyYW1zIiIiCiAgICAgICAgY2xzLl9zZXRfZ2VuZXJhbF9vYmplY3RfcGFyYW1zKHJlcXVlc3RfcGFyYW1zLCBjbGlfcGFyYW1zKQogICAgICAgIGNscy5fc2V0X21ldGFkYXRhX3BhcmFtcyhyZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcykKICAgICAgICBjbHMuX3NldF9zc2VfcmVxdWVzdF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCiAgICAgICAgY2xzLl9zZXRfc3NlX2NfcmVxdWVzdF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCiAgICAgICAgY2xzLl9zZXRfcmVxdWVzdF9wYXllcl9wYXJhbShyZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcykKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBtYXBfZ2V0X29iamVjdF9wYXJhbXMoY2xzLCByZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcyk6CiAgICAgICAgIiIiTWFwIENMSSBwYXJhbXMgdG8gR2V0T2JqZWN0IHJlcXVlc3QgcGFyYW1zIiIiCiAgICAgICAgY2xzLl9zZXRfc3NlX2NfcmVxdWVzdF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCiAgICAgICAgY2xzLl9zZXRfcmVxdWVzdF9wYXllcl9wYXJhbShyZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcykKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBtYXBfY29weV9vYmplY3RfcGFyYW1zKGNscywgcmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpOgogICAgICAgICIiIk1hcCBDTEkgcGFyYW1zIHRvIENvcHlPYmplY3QgcmVxdWVzdCBwYXJhbXMiIiIKICAgICAgICBjbHMuX3NldF9nZW5lcmFsX29iamVjdF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCiAgICAgICAgY2xzLl9zZXRfbWV0YWRhdGFfZGlyZWN0aXZlX3BhcmFtKHJlcXVlc3RfcGFyYW1zLCBjbGlfcGFyYW1zKQogICAgICAgIGNscy5fc2V0X21ldGFkYXRhX3BhcmFtcyhyZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcykKICAgICAgICBjbHMuX2F1dG9fcG9wdWxhdGVfbWV0YWRhdGFfZGlyZWN0aXZlKHJlcXVlc3RfcGFyYW1zKQogICAgICAgIGNscy5fc2V0X3NzZV9yZXF1ZXN0X3BhcmFtcyhyZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcykKICAgICAgICBjbHMuX3NldF9zc2VfY19hbmRfY29weV9zb3VyY2VfcmVxdWVzdF9wYXJhbXMoCiAgICAgICAgICAgIHJlcXVlc3RfcGFyYW1zLCBjbGlfcGFyYW1zKQogICAgICAgIGNscy5fc2V0X3JlcXVlc3RfcGF5ZXJfcGFyYW0ocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgbWFwX2hlYWRfb2JqZWN0X3BhcmFtcyhjbHMsIHJlcXVlc3RfcGFyYW1zLCBjbGlfcGFyYW1zKToKICAgICAgICAiIiJNYXAgQ0xJIHBhcmFtcyB0byBIZWFkT2JqZWN0IHJlcXVlc3QgcGFyYW1zIiIiCiAgICAgICAgY2xzLl9zZXRfc3NlX2NfcmVxdWVzdF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCiAgICAgICAgY2xzLl9zZXRfcmVxdWVzdF9wYXllcl9wYXJhbShyZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcykKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBtYXBfY3JlYXRlX211bHRpcGFydF91cGxvYWRfcGFyYW1zKGNscywgcmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpOgogICAgICAgICIiIk1hcCBDTEkgcGFyYW1zIHRvIENyZWF0ZU11bHRpcGFydFVwbG9hZCByZXF1ZXN0IHBhcmFtcyIiIgogICAgICAgIGNscy5fc2V0X2dlbmVyYWxfb2JqZWN0X3BhcmFtcyhyZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcykKICAgICAgICBjbHMuX3NldF9zc2VfcmVxdWVzdF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCiAgICAgICAgY2xzLl9zZXRfc3NlX2NfcmVxdWVzdF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCiAgICAgICAgY2xzLl9zZXRfbWV0YWRhdGFfcGFyYW1zKHJlcXVlc3RfcGFyYW1zLCBjbGlfcGFyYW1zKQogICAgICAgIGNscy5fc2V0X3JlcXVlc3RfcGF5ZXJfcGFyYW0ocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgbWFwX3VwbG9hZF9wYXJ0X3BhcmFtcyhjbHMsIHJlcXVlc3RfcGFyYW1zLCBjbGlfcGFyYW1zKToKICAgICAgICAiIiJNYXAgQ0xJIHBhcmFtcyB0byBVcGxvYWRQYXJ0IHJlcXVlc3QgcGFyYW1zIiIiCiAgICAgICAgY2xzLl9zZXRfc3NlX2NfcmVxdWVzdF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCiAgICAgICAgY2xzLl9zZXRfcmVxdWVzdF9wYXllcl9wYXJhbShyZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcykKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBtYXBfdXBsb2FkX3BhcnRfY29weV9wYXJhbXMoY2xzLCByZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcyk6CiAgICAgICAgIiIiTWFwIENMSSBwYXJhbXMgdG8gVXBsb2FkUGFydENvcHkgcmVxdWVzdCBwYXJhbXMiIiIKICAgICAgICBjbHMuX3NldF9zc2VfY19hbmRfY29weV9zb3VyY2VfcmVxdWVzdF9wYXJhbXMoCiAgICAgICAgICAgIHJlcXVlc3RfcGFyYW1zLCBjbGlfcGFyYW1zKQogICAgICAgIGNscy5fc2V0X3JlcXVlc3RfcGF5ZXJfcGFyYW0ocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgbWFwX2RlbGV0ZV9vYmplY3RfcGFyYW1zKGNscywgcmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpOgogICAgICAgIGNscy5fc2V0X3JlcXVlc3RfcGF5ZXJfcGFyYW0ocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgbWFwX2xpc3Rfb2JqZWN0c192Ml9wYXJhbXMoY2xzLCByZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcyk6CiAgICAgICAgY2xzLl9zZXRfcmVxdWVzdF9wYXllcl9wYXJhbShyZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcykKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBfc2V0X3JlcXVlc3RfcGF5ZXJfcGFyYW0oY2xzLCByZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcyk6CiAgICAgICAgaWYgY2xpX3BhcmFtcy5nZXQoJ3JlcXVlc3RfcGF5ZXInKToKICAgICAgICAgICAgcmVxdWVzdF9wYXJhbXNbJ1JlcXVlc3RQYXllciddID0gY2xpX3BhcmFtc1sncmVxdWVzdF9wYXllciddCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgX3NldF9nZW5lcmFsX29iamVjdF9wYXJhbXMoY2xzLCByZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcyk6CiAgICAgICAgIyBQYXJhbWV0ZXJzIHNldCBpbiB0aGlzIG1ldGhvZCBzaG91bGQgYmUgYXBwbGljYWJsZSB0byB0aGUgZm9sbG93aW5nCiAgICAgICAgIyBvcGVyYXRpb25zIGludm9sdmluZyBvYmplY3RzOiBQdXRPYmplY3QsIENvcHlPYmplY3QsIGFuZAogICAgICAgICMgQ3JlYXRlTXVsdGlwYXJ0VXBsb2FkLgogICAgICAgIGdlbmVyYWxfcGFyYW1fdHJhbnNsYXRpb24gPSB7CiAgICAgICAgICAgICdhY2wnOiAnQUNMJywKICAgICAgICAgICAgJ3N0b3JhZ2VfY2xhc3MnOiAnU3RvcmFnZUNsYXNzJywKICAgICAgICAgICAgJ3dlYnNpdGVfcmVkaXJlY3QnOiAnV2Vic2l0ZVJlZGlyZWN0TG9jYXRpb24nLAogICAgICAgICAgICAnY29udGVudF90eXBlJzogJ0NvbnRlbnRUeXBlJywKICAgICAgICAgICAgJ2NhY2hlX2NvbnRyb2wnOiAnQ2FjaGVDb250cm9sJywKICAgICAgICAgICAgJ2NvbnRlbnRfZGlzcG9zaXRpb24nOiAnQ29udGVudERpc3Bvc2l0aW9uJywKICAgICAgICAgICAgJ2NvbnRlbnRfZW5jb2RpbmcnOiAnQ29udGVudEVuY29kaW5nJywKICAgICAgICAgICAgJ2NvbnRlbnRfbGFuZ3VhZ2UnOiAnQ29udGVudExhbmd1YWdlJywKICAgICAgICAgICAgJ2V4cGlyZXMnOiAnRXhwaXJlcycKICAgICAgICB9CiAgICAgICAgZm9yIGNsaV9wYXJhbV9uYW1lIGluIGdlbmVyYWxfcGFyYW1fdHJhbnNsYXRpb246CiAgICAgICAgICAgIGlmIGNsaV9wYXJhbXMuZ2V0KGNsaV9wYXJhbV9uYW1lKToKICAgICAgICAgICAgICAgIHJlcXVlc3RfcGFyYW1fbmFtZSA9IGdlbmVyYWxfcGFyYW1fdHJhbnNsYXRpb25bY2xpX3BhcmFtX25hbWVdCiAgICAgICAgICAgICAgICByZXF1ZXN0X3BhcmFtc1tyZXF1ZXN0X3BhcmFtX25hbWVdID0gY2xpX3BhcmFtc1tjbGlfcGFyYW1fbmFtZV0KICAgICAgICBjbHMuX3NldF9ncmFudF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgX3NldF9ncmFudF9wYXJhbXMoY2xzLCByZXF1ZXN0X3BhcmFtcywgY2xpX3BhcmFtcyk6CiAgICAgICAgaWYgY2xpX3BhcmFtcy5nZXQoJ2dyYW50cycpOgogICAgICAgICAgICBmb3IgZ3JhbnQgaW4gY2xpX3BhcmFtc1snZ3JhbnRzJ106CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbiwgZ3JhbnRlZSA9IGdyYW50LnNwbGl0KCc9JywgMSkKICAgICAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ2dyYW50cyBzaG91bGQgYmUgb2YgdGhlIGZvcm0gJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Blcm1pc3Npb249cHJpbmNpcGFsJykKICAgICAgICAgICAgICAgIHJlcXVlc3RfcGFyYW1zW2Nscy5fcGVybWlzc2lvbl90b19wYXJhbShwZXJtaXNzaW9uKV0gPSBncmFudGVlCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgX3Blcm1pc3Npb25fdG9fcGFyYW0oY2xzLCBwZXJtaXNzaW9uKToKICAgICAgICBpZiBwZXJtaXNzaW9uID09ICdyZWFkJzoKICAgICAgICAgICAgcmV0dXJuICdHcmFudFJlYWQnCiAgICAgICAgaWYgcGVybWlzc2lvbiA9PSAnZnVsbCc6CiAgICAgICAgICAgIHJldHVybiAnR3JhbnRGdWxsQ29udHJvbCcKICAgICAgICBpZiBwZXJtaXNzaW9uID09ICdyZWFkYWNsJzoKICAgICAgICAgICAgcmV0dXJuICdHcmFudFJlYWRBQ1AnCiAgICAgICAgaWYgcGVybWlzc2lvbiA9PSAnd3JpdGVhY2wnOgogICAgICAgICAgICByZXR1cm4gJ0dyYW50V3JpdGVBQ1AnCiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigncGVybWlzc2lvbiBtdXN0IGJlIG9uZSBvZjogJwogICAgICAgICAgICAgICAgICAgICAgICAgJ3JlYWR8cmVhZGFjbHx3cml0ZWFjbHxmdWxsJykKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBfc2V0X21ldGFkYXRhX3BhcmFtcyhjbHMsIHJlcXVlc3RfcGFyYW1zLCBjbGlfcGFyYW1zKToKICAgICAgICBpZiBjbGlfcGFyYW1zLmdldCgnbWV0YWRhdGEnKToKICAgICAgICAgICAgcmVxdWVzdF9wYXJhbXNbJ01ldGFkYXRhJ10gPSBjbGlfcGFyYW1zWydtZXRhZGF0YSddCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgX2F1dG9fcG9wdWxhdGVfbWV0YWRhdGFfZGlyZWN0aXZlKGNscywgcmVxdWVzdF9wYXJhbXMpOgogICAgICAgIGlmIHJlcXVlc3RfcGFyYW1zLmdldCgnTWV0YWRhdGEnKSBhbmQgXAogICAgICAgICAgICAgICAgbm90IHJlcXVlc3RfcGFyYW1zLmdldCgnTWV0YWRhdGFEaXJlY3RpdmUnKToKICAgICAgICAgICAgcmVxdWVzdF9wYXJhbXNbJ01ldGFkYXRhRGlyZWN0aXZlJ10gPSAnUkVQTEFDRScKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBfc2V0X21ldGFkYXRhX2RpcmVjdGl2ZV9wYXJhbShjbHMsIHJlcXVlc3RfcGFyYW1zLCBjbGlfcGFyYW1zKToKICAgICAgICBpZiBjbGlfcGFyYW1zLmdldCgnbWV0YWRhdGFfZGlyZWN0aXZlJyk6CiAgICAgICAgICAgIHJlcXVlc3RfcGFyYW1zWydNZXRhZGF0YURpcmVjdGl2ZSddID0gY2xpX3BhcmFtc1sKICAgICAgICAgICAgICAgICdtZXRhZGF0YV9kaXJlY3RpdmUnXQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIF9zZXRfc3NlX3JlcXVlc3RfcGFyYW1zKGNscywgcmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpOgogICAgICAgIGlmIGNsaV9wYXJhbXMuZ2V0KCdzc2UnKToKICAgICAgICAgICAgcmVxdWVzdF9wYXJhbXNbJ1NlcnZlclNpZGVFbmNyeXB0aW9uJ10gPSBjbGlfcGFyYW1zWydzc2UnXQogICAgICAgIGlmICBjbGlfcGFyYW1zLmdldCgnc3NlX2ttc19rZXlfaWQnKToKICAgICAgICAgICAgcmVxdWVzdF9wYXJhbXNbJ1NTRUtNU0tleUlkJ10gPSBjbGlfcGFyYW1zWydzc2Vfa21zX2tleV9pZCddCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgX3NldF9zc2VfY19yZXF1ZXN0X3BhcmFtcyhjbHMsIHJlcXVlc3RfcGFyYW1zLCBjbGlfcGFyYW1zKToKICAgICAgICBpZiBjbGlfcGFyYW1zLmdldCgnc3NlX2MnKToKICAgICAgICAgICAgcmVxdWVzdF9wYXJhbXNbJ1NTRUN1c3RvbWVyQWxnb3JpdGhtJ10gPSBjbGlfcGFyYW1zWydzc2VfYyddCiAgICAgICAgICAgIHJlcXVlc3RfcGFyYW1zWydTU0VDdXN0b21lcktleSddID0gY2xpX3BhcmFtc1snc3NlX2Nfa2V5J10KCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBfc2V0X3NzZV9jX2NvcHlfc291cmNlX3JlcXVlc3RfcGFyYW1zKGNscywgcmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpOgogICAgICAgIGlmIGNsaV9wYXJhbXMuZ2V0KCdzc2VfY19jb3B5X3NvdXJjZScpOgogICAgICAgICAgICByZXF1ZXN0X3BhcmFtc1snQ29weVNvdXJjZVNTRUN1c3RvbWVyQWxnb3JpdGhtJ10gPSBjbGlfcGFyYW1zWwogICAgICAgICAgICAgICAgJ3NzZV9jX2NvcHlfc291cmNlJ10KICAgICAgICAgICAgcmVxdWVzdF9wYXJhbXNbJ0NvcHlTb3VyY2VTU0VDdXN0b21lcktleSddID0gY2xpX3BhcmFtc1sKICAgICAgICAgICAgICAgICdzc2VfY19jb3B5X3NvdXJjZV9rZXknXQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIF9zZXRfc3NlX2NfYW5kX2NvcHlfc291cmNlX3JlcXVlc3RfcGFyYW1zKGNscywgcmVxdWVzdF9wYXJhbXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpX3BhcmFtcyk6CiAgICAgICAgY2xzLl9zZXRfc3NlX2NfcmVxdWVzdF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCiAgICAgICAgY2xzLl9zZXRfc3NlX2NfY29weV9zb3VyY2VfcmVxdWVzdF9wYXJhbXMocmVxdWVzdF9wYXJhbXMsIGNsaV9wYXJhbXMpCgoKY2xhc3MgUHJvdmlkZVNpemVTdWJzY3JpYmVyKEJhc2VTdWJzY3JpYmVyKToKICAgICIiIgogICAgQSBzdWJzY3JpYmVyIHdoaWNoIHByb3ZpZGVzIHRoZSB0cmFuc2ZlciBzaXplIGJlZm9yZSBpdCdzIHF1ZXVlZC4KICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNpemUpOgogICAgICAgIHNlbGYuc2l6ZSA9IHNpemUKCiAgICBkZWYgb25fcXVldWVkKHNlbGYsIGZ1dHVyZSwgKiprd2FyZ3MpOgogICAgICAgIGZ1dHVyZS5tZXRhLnByb3ZpZGVfdHJhbnNmZXJfc2l6ZShzZWxmLnNpemUpCgoKIyBUT0RPOiBFdmVudHVhbGx5IHBvcnQgdGhpcyBkb3duIHRvIHRoZSBCYXNlU3Vic2NyaWJlciBvciBhIG5ldyBzdWJzY3JpYmVyCiMgY2xhc3MgaW4gczN0cmFuc2Zlci4gVGhlIGZ1bmN0aW9uYWxpdHkgaXMgdmVyeSBjb252ZW5pZW50IGJ1dCBtYXkgbmVlZAojIHNvbWUgZnVydGhlciBkZXNpZ24gZGVjaXNpb25zIHRvIG1ha2UgaXQgYSBmZWF0dXJlIGluIHMzdHJhbnNmZXIuCmNsYXNzIE9uRG9uZUZpbHRlcmVkU3Vic2NyaWJlcihCYXNlU3Vic2NyaWJlcik6CiAgICAiIiJTdWJzY3JpYmVyIHRoYXQgZGlmZmVyZW50aWF0ZXMgYmV0d2VlbiBzdWNjZXNzZXMgYW5kIGZhaWx1cmVzCgogICAgSXQgaXMgcmVhbGx5IGEgY29udmVuaWVuY2UgY2xhc3Mgc28gZGV2ZWxvcGVycyBkbyBub3QgaGF2ZSB0byBoYXZlCiAgICB0byBjb25zdGFudGx5IHJlbWVtYmVyIHRvIGhhdmUgYSBnZW5lcmFsIHRyeS9leGNlcHQgYXJvdW5kIGZ1dHVyZS5yZXN1bHQoKQogICAgIiIiCiAgICBkZWYgb25fZG9uZShzZWxmLCBmdXR1cmUsICoqa3dhcmdzKToKICAgICAgICBmdXR1cmVfZXhjZXB0aW9uID0gTm9uZQogICAgICAgIHRyeToKCiAgICAgICAgICAgIGZ1dHVyZS5yZXN1bHQoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgZnV0dXJlX2V4Y2VwdGlvbiA9IGUKICAgICAgICAjIElmIHRoZSByZXN1bHQgcHJvcGFnYXRlcyBhbiBlcnJvciwgY2FsbCB0aGUgb25fZmFpbHVyZQogICAgICAgICMgbWV0aG9kIGluc3RlYWQuCiAgICAgICAgaWYgZnV0dXJlX2V4Y2VwdGlvbjoKICAgICAgICAgICAgc2VsZi5fb25fZmFpbHVyZShmdXR1cmUsIGZ1dHVyZV9leGNlcHRpb24pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5fb25fc3VjY2VzcyhmdXR1cmUpCgogICAgZGVmIF9vbl9zdWNjZXNzKHNlbGYsIGZ1dHVyZSk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBfb25fZmFpbHVyZShzZWxmLCBmdXR1cmUsIGUpOgogICAgICAgIHBhc3MKCgpjbGFzcyBEZWxldGVTb3VyY2VTdWJzY3JpYmVyKE9uRG9uZUZpbHRlcmVkU3Vic2NyaWJlcik6CiAgICAiIiJBIHN1YnNjcmliZXIgd2hpY2ggZGVsZXRlcyB0aGUgc291cmNlIG9mIHRoZSB0cmFuc2Zlci4iIiIKICAgIGRlZiBfb25fc3VjY2VzcyhzZWxmLCBmdXR1cmUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5fZGVsZXRlX3NvdXJjZShmdXR1cmUpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBmdXR1cmUuc2V0X2V4Y2VwdGlvbihlKQoKICAgIGRlZiBfZGVsZXRlX3NvdXJjZShzZWxmLCBmdXR1cmUpOgogICAgICAgIHJhaXNlIE5vdEltcGxlbWVudGVkRXJyb3IoJ19kZWxldGVfc291cmNlKCknKQoKCmNsYXNzIERlbGV0ZVNvdXJjZU9iamVjdFN1YnNjcmliZXIoRGVsZXRlU291cmNlU3Vic2NyaWJlcik6CiAgICAiIiJBIHN1YnNjcmliZXIgd2hpY2ggZGVsZXRlcyBhbiBvYmplY3QuIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgY2xpZW50KToKICAgICAgICBzZWxmLl9jbGllbnQgPSBjbGllbnQKCiAgICBkZWYgX2dldF9idWNrZXQoc2VsZiwgY2FsbF9hcmdzKToKICAgICAgICByZXR1cm4gY2FsbF9hcmdzLmJ1Y2tldAoKICAgIGRlZiBfZ2V0X2tleShzZWxmLCBjYWxsX2FyZ3MpOgogICAgICAgIHJldHVybiBjYWxsX2FyZ3Mua2V5CgogICAgZGVmIF9kZWxldGVfc291cmNlKHNlbGYsIGZ1dHVyZSk6CiAgICAgICAgY2FsbF9hcmdzID0gZnV0dXJlLm1ldGEuY2FsbF9hcmdzCiAgICAgICAgZGVsZXRlX29iamVjdF9rd2FyZ3MgPSB7CiAgICAgICAgICAgICdCdWNrZXQnOiBzZWxmLl9nZXRfYnVja2V0KGNhbGxfYXJncyksCiAgICAgICAgICAgICdLZXknOiBzZWxmLl9nZXRfa2V5KGNhbGxfYXJncykKICAgICAgICB9CiAgICAgICAgaWYgY2FsbF9hcmdzLmV4dHJhX2FyZ3MuZ2V0KCdSZXF1ZXN0UGF5ZXInKToKICAgICAgICAgICAgZGVsZXRlX29iamVjdF9rd2FyZ3NbJ1JlcXVlc3RQYXllciddID0gY2FsbF9hcmdzLmV4dHJhX2FyZ3NbCiAgICAgICAgICAgICAgICAnUmVxdWVzdFBheWVyJ10KICAgICAgICBzZWxmLl9jbGllbnQuZGVsZXRlX29iamVjdCgqKmRlbGV0ZV9vYmplY3Rfa3dhcmdzKQoKCmNsYXNzIERlbGV0ZUNvcHlTb3VyY2VPYmplY3RTdWJzY3JpYmVyKERlbGV0ZVNvdXJjZU9iamVjdFN1YnNjcmliZXIpOgogICAgIiIiQSBzdWJzY3JpYmVyIHdoaWNoIGRlbGV0ZXMgdGhlIGNvcHkgc291cmNlLiIiIgogICAgZGVmIF9nZXRfYnVja2V0KHNlbGYsIGNhbGxfYXJncyk6CiAgICAgICAgcmV0dXJuIGNhbGxfYXJncy5jb3B5X3NvdXJjZVsnQnVja2V0J10KCiAgICBkZWYgX2dldF9rZXkoc2VsZiwgY2FsbF9hcmdzKToKICAgICAgICByZXR1cm4gY2FsbF9hcmdzLmNvcHlfc291cmNlWydLZXknXQoKCmNsYXNzIERlbGV0ZVNvdXJjZUZpbGVTdWJzY3JpYmVyKERlbGV0ZVNvdXJjZVN1YnNjcmliZXIpOgogICAgIiIiQSBzdWJzY3JpYmVyIHdoaWNoIGRlbGV0ZXMgYSBmaWxlLiIiIgogICAgZGVmIF9kZWxldGVfc291cmNlKHNlbGYsIGZ1dHVyZSk6CiAgICAgICAgb3MucmVtb3ZlKGZ1dHVyZS5tZXRhLmNhbGxfYXJncy5maWxlb2JqKQoKCmNsYXNzIEJhc2VQcm92aWRlQ29udGVudFR5cGVTdWJzY3JpYmVyKEJhc2VTdWJzY3JpYmVyKToKICAgICIiIkEgc3Vic2NyaWJlciB0aGF0IHByb3ZpZGVzIGNvbnRlbnQgdHlwZSB3aGVuIGNyZWF0aW5nIHMzIG9iamVjdHMiIiIKCiAgICBkZWYgb25fcXVldWVkKHNlbGYsIGZ1dHVyZSwgKiprd2FyZ3MpOgogICAgICAgIGd1ZXNzZWRfdHlwZSA9IGd1ZXNzX2NvbnRlbnRfdHlwZShzZWxmLl9nZXRfZmlsZW5hbWUoZnV0dXJlKSkKICAgICAgICBpZiBndWVzc2VkX3R5cGUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGZ1dHVyZS5tZXRhLmNhbGxfYXJncy5leHRyYV9hcmdzWydDb250ZW50VHlwZSddID0gZ3Vlc3NlZF90eXBlCgogICAgZGVmIF9nZXRfZmlsZW5hbWUoc2VsZiwgZnV0dXJlKToKICAgICAgICByYWlzZSBOb3RJbXBsZW1lbnRlZEVycm9yKCdfZ2V0X2ZpbGVuYW1lKCknKQoKCmNsYXNzIFByb3ZpZGVVcGxvYWRDb250ZW50VHlwZVN1YnNjcmliZXIoQmFzZVByb3ZpZGVDb250ZW50VHlwZVN1YnNjcmliZXIpOgogICAgZGVmIF9nZXRfZmlsZW5hbWUoc2VsZiwgZnV0dXJlKToKICAgICAgICByZXR1cm4gZnV0dXJlLm1ldGEuY2FsbF9hcmdzLmZpbGVvYmoKCgpjbGFzcyBQcm92aWRlQ29weUNvbnRlbnRUeXBlU3Vic2NyaWJlcihCYXNlUHJvdmlkZUNvbnRlbnRUeXBlU3Vic2NyaWJlcik6CiAgICBkZWYgX2dldF9maWxlbmFtZShzZWxmLCBmdXR1cmUpOgogICAgICAgIHJldHVybiBmdXR1cmUubWV0YS5jYWxsX2FyZ3MuY29weV9zb3VyY2VbJ0tleSddCgoKY2xhc3MgUHJvdmlkZUxhc3RNb2RpZmllZFRpbWVTdWJzY3JpYmVyKE9uRG9uZUZpbHRlcmVkU3Vic2NyaWJlcik6CiAgICAiIiJTZXRzIHV0aW1lIGZvciBhIGRvd25sb2FkZWQgZmlsZSIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxhc3RfbW9kaWZpZWRfdGltZSwgcmVzdWx0X3F1ZXVlKToKICAgICAgICBzZWxmLl9sYXN0X21vZGlmaWVkX3RpbWUgPSBsYXN0X21vZGlmaWVkX3RpbWUKICAgICAgICBzZWxmLl9yZXN1bHRfcXVldWUgPSByZXN1bHRfcXVldWUKCiAgICBkZWYgX29uX3N1Y2Nlc3Moc2VsZiwgZnV0dXJlLCAqKmt3YXJncyk6CiAgICAgICAgZmlsZW5hbWUgPSBmdXR1cmUubWV0YS5jYWxsX2FyZ3MuZmlsZW9iagogICAgICAgIHRyeToKICAgICAgICAgICAgbGFzdF91cGRhdGVfdHVwbGUgPSBzZWxmLl9sYXN0X21vZGlmaWVkX3RpbWUudGltZXR1cGxlKCkKICAgICAgICAgICAgbW9kX3RpbWVzdGFtcCA9IHRpbWUubWt0aW1lKGxhc3RfdXBkYXRlX3R1cGxlKQogICAgICAgICAgICBzZXRfZmlsZV91dGltZShmaWxlbmFtZSwgaW50KG1vZF90aW1lc3RhbXApKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgd2FybmluZ19tZXNzYWdlID0gKAogICAgICAgICAgICAgICAgJ1N1Y2Nlc3NmdWxseSBEb3dubG9hZGVkICVzIGJ1dCB3YXMgdW5hYmxlIHRvIHVwZGF0ZSB0aGUgJwogICAgICAgICAgICAgICAgJ2xhc3QgbW9kaWZpZWQgdGltZS4gJXMnICUgKGZpbGVuYW1lLCBlKSkKICAgICAgICAgICAgc2VsZi5fcmVzdWx0X3F1ZXVlLnB1dChjcmVhdGVfd2FybmluZyhmaWxlbmFtZSwgd2FybmluZ19tZXNzYWdlKSkKCgpjbGFzcyBEaXJlY3RvcnlDcmVhdG9yU3Vic2NyaWJlcihCYXNlU3Vic2NyaWJlcik6CiAgICAiIiJDcmVhdGVzIGEgZGlyZWN0b3J5IHRvIGRvd25sb2FkIGlmIGl0IGRvZXMgbm90IGV4aXN0IiIiCiAgICBkZWYgb25fcXVldWVkKHNlbGYsIGZ1dHVyZSwgKiprd2FyZ3MpOgogICAgICAgIGQgPSBvcy5wYXRoLmRpcm5hbWUoZnV0dXJlLm1ldGEuY2FsbF9hcmdzLmZpbGVvYmopCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZCk6CiAgICAgICAgICAgICAgICBvcy5tYWtlZGlycyhkKQogICAgICAgIGV4Y2VwdCBPU0Vycm9yIGFzIGU6CiAgICAgICAgICAgIGlmIG5vdCBlLmVycm5vID09IGVycm5vLkVFWElTVDoKICAgICAgICAgICAgICAgIHJhaXNlIENyZWF0ZURpcmVjdG9yeUVycm9yKAogICAgICAgICAgICAgICAgICAgICJDb3VsZCBub3QgY3JlYXRlIGRpcmVjdG9yeSAlczogJXMiICUgKGQsIGUpKQoKCmNsYXNzIE5vblNlZWthYmxlU3RyZWFtKG9iamVjdCk6CiAgICAiIiJXcmFwIGEgZmlsZSBsaWtlIG9iamVjdCBhcyBhIG5vbiBzZWVrYWJsZSBzdHJlYW0uCgogICAgVGhpcyBjbGFzcyBpcyB1c2VkIHRvIHdyYXAgYW4gZXhpc3RpbmcgZmlsZSBsaWtlIG9iamVjdAogICAgc3VjaCB0aGF0IGl0IG9ubHkgaGFzIGEgYGAucmVhZCgpYGAgbWV0aG9kLgoKICAgIFRoZXJlIGFyZSBzb21lIGZpbGUgbGlrZSBvYmplY3RzIHRoYXQgYXJlbid0IHRydWx5IHNlZWthYmxlCiAgICBidXQgYXBwZWFyIHRvIGJlLiAgRm9yIGV4YW1wbGUsIG9uIHdpbmRvd3MsIHN5cy5zdGRpbiBoYXMKICAgIGEgYGBzZWVrKClgYCBtZXRob2QsIGFuZCBjYWxsaW5nIGBgc2VlaygwKWBgIGV2ZW4gYXBwZWFycwogICAgdG8gd29yay4gIEhvd2V2ZXIsIHN1YnNlcXVlbnQgYGAucmVhZCgpYGAgY2FsbHMgd2lsbCBqdXN0CiAgICByZXR1cm4gYW4gZW1wdHkgc3RyaW5nLgoKICAgIENvbnN1bWVycyBvZiB0aGVzZSBmaWxlIGxpa2Ugb2JqZWN0IGhhdmUgbm8gd2F5IG9mIGtub3dpbmcKICAgIGlmIHRoZXNlIGZpbGVzIGFyZSB0cnVseSBzZWVrYWJsZSBvciBub3QsIHNvIHRoaXMgY2xhc3MKICAgIGNhbiBiZSB1c2VkIHRvIGZvcmNlIG5vbi1zZWVrYWJsZSBiZWhhdmlvciB3aGVuIHlvdSBrbm93CiAgICBmb3IgY2VydGFpbiB0aGF0IGEgZmlsZW9iaiBpcyBub24gc2Vla2FibGUuCgogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgZmlsZW9iaik6CiAgICAgICAgc2VsZi5fZmlsZW9iaiA9IGZpbGVvYmoKCiAgICBkZWYgcmVhZChzZWxmLCBhbXQ9Tm9uZSk6CiAgICAgICAgaWYgYW10IGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9maWxlb2JqLnJlYWQoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9maWxlb2JqLnJlYWQoYW10KQo=
