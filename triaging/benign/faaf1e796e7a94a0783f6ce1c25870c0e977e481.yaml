statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_mac/util.py
  contents:
  - name: rand_bytes
    score: 0.0
    code: |-
      def rand_bytes(length):
          """
          Returns a number of random bytes suitable for cryptographic purposes

          :param length:
              The desired number of bytes

          :raises:
              ValueError - when any of the parameters contain an invalid value
              TypeError - when any of the parameters are of the wrong type
              OSError - when an error is returned by the OS crypto library

          :return:
              A byte string
          """

          if not isinstance(length, int_types):
              raise TypeError(pretty_message(
                  '''
                  length must be an integer, not %s
                  ''',
                  type_name(length)
              ))

          if length < 1:
              raise ValueError('length must be greater than 0')

          if length > 1024:
              raise ValueError('length must not be greater than 1024')

          buffer = buffer_from_bytes(length)
          result = Security.SecRandomCopyBytes(Security.kSecRandomDefault, length, buffer)
          if result != 0:
              raise OSError(_extract_error())

          return bytes_from_buffer(buffer)
    tokens: resume load_global isinstance load_fast length load_global int_types call pop_jump_if_true TO_NUMBER load_global TypeError load_global pretty_message load_const STRING_LEN_S_ENT_HIGH load_global type_name load_fast length call call call raise_varargs load_fast length load_const INTEGER compare_op < pop_jump_if_false TO_NUMBER load_global ValueError load_const STRING_LEN_S_ENT_HIGH call raise_varargs load_fast length load_const INTEGER compare_op > pop_jump_if_false TO_NUMBER load_global ValueError load_const STRING_LEN_S_ENT_HIGH call raise_varargs load_global STRING_LEN_S_ENT_HIGH load_fast length call store_fast buffer load_global Security load_attr STRING_LEN_S_ENT_HIGH load_global Security load_attr STRING_LEN_S_ENT_HIGH load_fast length load_fast buffer call store_fast result load_fast result load_const INTEGER compare_op != pop_jump_if_false TO_NUMBER load_global OSError load_global _extract_error call call raise_varargs load_global STRING_LEN_S_ENT_HIGH load_fast buffer call return_value
    hash: a7756a6a9544a6f0fa6de6acd326fb22b76c8a640936857c54c6da20b9866972
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_mac/util.py
  : IyBjb2Rpbmc6IHV0Zi04CmZyb20gX19mdXR1cmVfXyBpbXBvcnQgdW5pY29kZV9saXRlcmFscywgZGl2aXNpb24sIGFic29sdXRlX2ltcG9ydCwgcHJpbnRfZnVuY3Rpb24KCmltcG9ydCBvcwoKZnJvbSAuLl9lcnJvcnMgaW1wb3J0IHByZXR0eV9tZXNzYWdlCmZyb20gLi5fZmZpIGltcG9ydCBidWZmZXJfZnJvbV9ieXRlcywgYnl0ZXNfZnJvbV9idWZmZXIsIGVycm5vLCBieXRlX3N0cmluZ19mcm9tX2J1ZmZlcgpmcm9tIC4uX3R5cGVzIGltcG9ydCB0eXBlX25hbWUsIHN0cl9jbHMsIGJ5dGVfY2xzLCBpbnRfdHlwZXMKZnJvbSAuLmVycm9ycyBpbXBvcnQgTGlicmFyeU5vdEZvdW5kRXJyb3IKZnJvbSAuX2NvbW1vbl9jcnlwdG8gaW1wb3J0IENvbW1vbkNyeXB0bywgQ29tbW9uQ3J5cHRvQ29uc3QKZnJvbSAuX3NlY3VyaXR5IGltcG9ydCBTZWN1cml0eQoKCl9fYWxsX18gPSBbCiAgICAncGJrZGYyJywKICAgICdwa2NzMTJfa2RmJywKICAgICdyYW5kX2J5dGVzJywKXQoKCl9lbmNvZGluZyA9ICd1dGYtOCcKX2ZhbGxiYWNrX2VuY29kaW5ncyA9IFsndXRmLTgnLCAnY3AxMjUyJ10KCgpkZWYgX3RyeV9kZWNvZGUodmFsdWUpOgoKICAgIHRyeToKICAgICAgICByZXR1cm4gc3RyX2Nscyh2YWx1ZSwgX2VuY29kaW5nKQoKICAgICMgSWYgdGhlICJjb3JyZWN0IiBlbmNvZGluZyBkaWQgbm90IHdvcmssIHRyeSBzb21lIGRlZmF1bHRzLCBhbmQgdGhlbiBqdXN0CiAgICAjIG9ibGl0ZXJhdGUgY2hhcmFjdGVycyB0aGF0IHdlIGNhbid0IHNlZW4gdG8gZGVjb2RlIHByb3Blcmx5CiAgICBleGNlcHQgKFVuaWNvZGVEZWNvZGVFcnJvcik6CiAgICAgICAgZm9yIGVuY29kaW5nIGluIF9mYWxsYmFja19lbmNvZGluZ3M6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldHVybiBzdHJfY2xzKHZhbHVlLCBlbmNvZGluZywgZXJyb3JzPSdzdHJpY3QnKQogICAgICAgICAgICBleGNlcHQgKFVuaWNvZGVEZWNvZGVFcnJvcik6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgcmV0dXJuIHN0cl9jbHModmFsdWUsIGVycm9ycz0ncmVwbGFjZScpCgoKZGVmIF9leHRyYWN0X2Vycm9yKCk6CiAgICAiIiIKICAgIEV4dHJhY3RzIHRoZSBsYXN0IE9TIGVycm9yIG1lc3NhZ2UgaW50byBhIHB5dGhvbiB1bmljb2RlIHN0cmluZwoKICAgIDpyZXR1cm46CiAgICAgICAgQSB1bmljb2RlIHN0cmluZyBlcnJvciBtZXNzYWdlCiAgICAiIiIKCiAgICBlcnJvcl9udW0gPSBlcnJubygpCgogICAgdHJ5OgogICAgICAgIGVycm9yX3N0cmluZyA9IG9zLnN0cmVycm9yKGVycm9yX251bSkKICAgIGV4Y2VwdCAoVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuIHN0cl9jbHMoZXJyb3JfbnVtKQoKICAgIGlmIGlzaW5zdGFuY2UoZXJyb3Jfc3RyaW5nLCBzdHJfY2xzKToKICAgICAgICByZXR1cm4gZXJyb3Jfc3RyaW5nCgogICAgcmV0dXJuIF90cnlfZGVjb2RlKGVycm9yX3N0cmluZykKCgpkZWYgcGJrZGYyKGhhc2hfYWxnb3JpdGhtLCBwYXNzd29yZCwgc2FsdCwgaXRlcmF0aW9ucywga2V5X2xlbmd0aCk6CiAgICAiIiIKICAgIFBCS0RGMiBmcm9tIFBLQ1MjNQoKICAgIDpwYXJhbSBoYXNoX2FsZ29yaXRobToKICAgICAgICBUaGUgc3RyaW5nIG5hbWUgb2YgdGhlIGhhc2ggYWxnb3JpdGhtIHRvIHVzZTogInNoYTEiLCAic2hhMjI0IiwgInNoYTI1NiIsICJzaGEzODQiLCAic2hhNTEyIgoKICAgIDpwYXJhbSBwYXNzd29yZDoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBwYXNzd29yZCB0byB1c2UgYW4gaW5wdXQgdG8gdGhlIEtERgoKICAgIDpwYXJhbSBzYWx0OgogICAgICAgIEEgY3J5cHRvZ3JhcGhpYyByYW5kb20gYnl0ZSBzdHJpbmcKCiAgICA6cGFyYW0gaXRlcmF0aW9uczoKICAgICAgICBUaGUgbnVtYmVycyBvZiBpdGVyYXRpb25zIHRvIHVzZSB3aGVuIGRlcml2aW5nIHRoZSBrZXkKCiAgICA6cGFyYW0ga2V5X2xlbmd0aDoKICAgICAgICBUaGUgbGVuZ3RoIG9mIHRoZSBkZXNpcmVkIGtleSBpbiBieXRlcwoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgVGhlIGRlcml2ZWQga2V5IGFzIGEgYnl0ZSBzdHJpbmcKICAgICIiIgoKICAgIGlmIG5vdCBpc2luc3RhbmNlKHBhc3N3b3JkLCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgcGFzc3dvcmQgbXVzdCBiZSBhIGJ5dGUgc3RyaW5nLCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICB0eXBlX25hbWUocGFzc3dvcmQpCiAgICAgICAgKSkKCiAgICBpZiBub3QgaXNpbnN0YW5jZShzYWx0LCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgc2FsdCBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShzYWx0KQogICAgICAgICkpCgogICAgaWYgbm90IGlzaW5zdGFuY2UoaXRlcmF0aW9ucywgaW50X3R5cGVzKToKICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBpdGVyYXRpb25zIG11c3QgYmUgYW4gaW50ZWdlciwgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKGl0ZXJhdGlvbnMpCiAgICAgICAgKSkKCiAgICBpZiBpdGVyYXRpb25zIDwgMToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdpdGVyYXRpb25zIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKQoKICAgIGlmIG5vdCBpc2luc3RhbmNlKGtleV9sZW5ndGgsIGludF90eXBlcyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAga2V5X2xlbmd0aCBtdXN0IGJlIGFuIGludGVnZXIsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShrZXlfbGVuZ3RoKQogICAgICAgICkpCgogICAgaWYga2V5X2xlbmd0aCA8IDE6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigna2V5X2xlbmd0aCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJykKCiAgICBpZiBoYXNoX2FsZ29yaXRobSBub3QgaW4gc2V0KFsnc2hhMScsICdzaGEyMjQnLCAnc2hhMjU2JywgJ3NoYTM4NCcsICdzaGE1MTInXSk6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGhhc2hfYWxnb3JpdGhtIG11c3QgYmUgb25lIG9mICJzaGExIiwgInNoYTIyNCIsICJzaGEyNTYiLCAic2hhMzg0IiwKICAgICAgICAgICAgInNoYTUxMiIsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHJlcHIoaGFzaF9hbGdvcml0aG0pCiAgICAgICAgKSkKCiAgICBhbGdvID0gewogICAgICAgICdzaGExJzogQ29tbW9uQ3J5cHRvQ29uc3Qua0NDUFJGSG1hY0FsZ1NIQTEsCiAgICAgICAgJ3NoYTIyNCc6IENvbW1vbkNyeXB0b0NvbnN0LmtDQ1BSRkhtYWNBbGdTSEEyMjQsCiAgICAgICAgJ3NoYTI1Nic6IENvbW1vbkNyeXB0b0NvbnN0LmtDQ1BSRkhtYWNBbGdTSEEyNTYsCiAgICAgICAgJ3NoYTM4NCc6IENvbW1vbkNyeXB0b0NvbnN0LmtDQ1BSRkhtYWNBbGdTSEEzODQsCiAgICAgICAgJ3NoYTUxMic6IENvbW1vbkNyeXB0b0NvbnN0LmtDQ1BSRkhtYWNBbGdTSEE1MTIKICAgIH1baGFzaF9hbGdvcml0aG1dCgogICAgb3V0cHV0X2J1ZmZlciA9IGJ1ZmZlcl9mcm9tX2J5dGVzKGtleV9sZW5ndGgpCiAgICByZXN1bHQgPSBDb21tb25DcnlwdG8uQ0NLZXlEZXJpdmF0aW9uUEJLREYoCiAgICAgICAgQ29tbW9uQ3J5cHRvQ29uc3Qua0NDUEJLREYyLAogICAgICAgIHBhc3N3b3JkLAogICAgICAgIGxlbihwYXNzd29yZCksCiAgICAgICAgc2FsdCwKICAgICAgICBsZW4oc2FsdCksCiAgICAgICAgYWxnbywKICAgICAgICBpdGVyYXRpb25zLAogICAgICAgIG91dHB1dF9idWZmZXIsCiAgICAgICAga2V5X2xlbmd0aAogICAgKQogICAgaWYgcmVzdWx0ICE9IDA6CiAgICAgICAgcmFpc2UgT1NFcnJvcihfZXh0cmFjdF9lcnJvcigpKQoKICAgIHJldHVybiBieXRlc19mcm9tX2J1ZmZlcihvdXRwdXRfYnVmZmVyKQoKCnBia2RmMi5wdXJlX3B5dGhvbiA9IEZhbHNlCgoKZGVmIHJhbmRfYnl0ZXMobGVuZ3RoKToKICAgICIiIgogICAgUmV0dXJucyBhIG51bWJlciBvZiByYW5kb20gYnl0ZXMgc3VpdGFibGUgZm9yIGNyeXB0b2dyYXBoaWMgcHVycG9zZXMKCiAgICA6cGFyYW0gbGVuZ3RoOgogICAgICAgIFRoZSBkZXNpcmVkIG51bWJlciBvZiBieXRlcwoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBieXRlIHN0cmluZwogICAgIiIiCgogICAgaWYgbm90IGlzaW5zdGFuY2UobGVuZ3RoLCBpbnRfdHlwZXMpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGxlbmd0aCBtdXN0IGJlIGFuIGludGVnZXIsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShsZW5ndGgpCiAgICAgICAgKSkKCiAgICBpZiBsZW5ndGggPCAxOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ2xlbmd0aCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJykKCiAgICBpZiBsZW5ndGggPiAxMDI0OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ2xlbmd0aCBtdXN0IG5vdCBiZSBncmVhdGVyIHRoYW4gMTAyNCcpCgogICAgYnVmZmVyID0gYnVmZmVyX2Zyb21fYnl0ZXMobGVuZ3RoKQogICAgcmVzdWx0ID0gU2VjdXJpdHkuU2VjUmFuZG9tQ29weUJ5dGVzKFNlY3VyaXR5LmtTZWNSYW5kb21EZWZhdWx0LCBsZW5ndGgsIGJ1ZmZlcikKICAgIGlmIHJlc3VsdCAhPSAwOgogICAgICAgIHJhaXNlIE9TRXJyb3IoX2V4dHJhY3RfZXJyb3IoKSkKCiAgICByZXR1cm4gYnl0ZXNfZnJvbV9idWZmZXIoYnVmZmVyKQoKCiMgSWYgaW4gYSBmdXR1cmUgdmVyc2lvbiBvZiBPUyBYIHRoZXkgcmVtb3ZlIE9wZW5TU0wsIHRoaXMgdHJ5L2V4Y2VwdCBibG9jawojIHdpbGwgZmFsbCBiYWNrIHRvIHRoZSBwdXJlIFB5dGhvbiBpbXBsZW1lbnRhdGlvbiwgd2hpY2ggaXMganVzdCBzbG93ZXIKdHJ5OgogICAgZnJvbSAuLl9vcGVuc3NsLl9saWJjcnlwdG8gaW1wb3J0IGxpYmNyeXB0bwoKICAgIGRlZiBfZXh0cmFjdF9vcGVuc3NsX2Vycm9yKCk6CiAgICAgICAgIiIiCiAgICAgICAgRXh0cmFjdHMgdGhlIGxhc3QgT3BlblNTTCBlcnJvciBtZXNzYWdlIGludG8gYSBweXRob24gdW5pY29kZSBzdHJpbmcKCiAgICAgICAgOnJldHVybjoKICAgICAgICAgICAgQSB1bmljb2RlIHN0cmluZyBlcnJvciBtZXNzYWdlCiAgICAgICAgIiIiCgogICAgICAgIGVycm9yX251bSA9IGxpYmNyeXB0by5FUlJfZ2V0X2Vycm9yKCkKICAgICAgICBidWZmZXIgPSBidWZmZXJfZnJvbV9ieXRlcygxMjApCiAgICAgICAgbGliY3J5cHRvLkVSUl9lcnJvcl9zdHJpbmcoZXJyb3JfbnVtLCBidWZmZXIpCgogICAgICAgICMgU2luY2Ugd2UgYXJlIGRlYWxpbmcgd2l0aCBhIHN0cmluZywgaXQgaXMgTlVMTCB0ZXJtaW5hdGVkCiAgICAgICAgZXJyb3Jfc3RyaW5nID0gYnl0ZV9zdHJpbmdfZnJvbV9idWZmZXIoYnVmZmVyKQoKICAgICAgICByZXR1cm4gX3RyeV9kZWNvZGUoZXJyb3Jfc3RyaW5nKQoKICAgIGRlZiBwa2NzMTJfa2RmKGhhc2hfYWxnb3JpdGhtLCBwYXNzd29yZCwgc2FsdCwgaXRlcmF0aW9ucywga2V5X2xlbmd0aCwgaWRfKToKICAgICAgICAiIiIKICAgICAgICBLREYgZnJvbSBSRkM3MjkyIGFwcGVuZGl4IEIuMiAtIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmM3MjkyI3BhZ2UtMTkKCiAgICAgICAgOnBhcmFtIGhhc2hfYWxnb3JpdGhtOgogICAgICAgICAgICBUaGUgc3RyaW5nIG5hbWUgb2YgdGhlIGhhc2ggYWxnb3JpdGhtIHRvIHVzZTogIm1kNSIsICJzaGExIiwgInNoYTIyNCIsICJzaGEyNTYiLCAic2hhMzg0IiwgInNoYTUxMiIKCiAgICAgICAgOnBhcmFtIHBhc3N3b3JkOgogICAgICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBwYXNzd29yZCB0byB1c2UgYW4gaW5wdXQgdG8gdGhlIEtERgoKICAgICAgICA6cGFyYW0gc2FsdDoKICAgICAgICAgICAgQSBjcnlwdG9ncmFwaGljIHJhbmRvbSBieXRlIHN0cmluZwoKICAgICAgICA6cGFyYW0gaXRlcmF0aW9uczoKICAgICAgICAgICAgVGhlIG51bWJlcnMgb2YgaXRlcmF0aW9ucyB0byB1c2Ugd2hlbiBkZXJpdmluZyB0aGUga2V5CgogICAgICAgIDpwYXJhbSBrZXlfbGVuZ3RoOgogICAgICAgICAgICBUaGUgbGVuZ3RoIG9mIHRoZSBkZXNpcmVkIGtleSBpbiBieXRlcwoKICAgICAgICA6cGFyYW0gaWRfOgogICAgICAgICAgICBUaGUgSUQgb2YgdGhlIHVzYWdlIC0gMSBmb3Iga2V5LCAyIGZvciBpdiwgMyBmb3IgbWFjCgogICAgICAgIDpyYWlzZXM6CiAgICAgICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgICAgICA6cmV0dXJuOgogICAgICAgICAgICBUaGUgZGVyaXZlZCBrZXkgYXMgYSBieXRlIHN0cmluZwogICAgICAgICIiIgoKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShwYXNzd29yZCwgYnl0ZV9jbHMpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIHBhc3N3b3JkIG11c3QgYmUgYSBieXRlIHN0cmluZywgbm90ICVzCiAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICB0eXBlX25hbWUocGFzc3dvcmQpCiAgICAgICAgICAgICkpCgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHNhbHQsIGJ5dGVfY2xzKToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBzYWx0IG11c3QgYmUgYSBieXRlIHN0cmluZywgbm90ICVzCiAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICB0eXBlX25hbWUoc2FsdCkKICAgICAgICAgICAgKSkKCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UoaXRlcmF0aW9ucywgaW50X3R5cGVzKToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBpdGVyYXRpb25zIG11c3QgYmUgYW4gaW50ZWdlciwgbm90ICVzCiAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICB0eXBlX25hbWUoaXRlcmF0aW9ucykKICAgICAgICAgICAgKSkKCiAgICAgICAgaWYgaXRlcmF0aW9ucyA8IDE6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIGl0ZXJhdGlvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCAtIGlzICVzCiAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICByZXByKGl0ZXJhdGlvbnMpCiAgICAgICAgICAgICkpCgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGtleV9sZW5ndGgsIGludF90eXBlcyk6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICAgICAga2V5X2xlbmd0aCBtdXN0IGJlIGFuIGludGVnZXIsIG5vdCAlcwogICAgICAgICAgICAgICAgJycnLAogICAgICAgICAgICAgICAgdHlwZV9uYW1lKGtleV9sZW5ndGgpCiAgICAgICAgICAgICkpCgogICAgICAgIGlmIGtleV9sZW5ndGggPCAxOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBrZXlfbGVuZ3RoIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAgLSBpcyAlcwogICAgICAgICAgICAgICAgJycnLAogICAgICAgICAgICAgICAgcmVwcihrZXlfbGVuZ3RoKQogICAgICAgICAgICApKQoKICAgICAgICBpZiBoYXNoX2FsZ29yaXRobSBub3QgaW4gc2V0KFsnbWQ1JywgJ3NoYTEnLCAnc2hhMjI0JywgJ3NoYTI1NicsICdzaGEzODQnLCAnc2hhNTEyJ10pOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBoYXNoX2FsZ29yaXRobSBtdXN0IGJlIG9uZSBvZiAibWQ1IiwgInNoYTEiLCAic2hhMjI0IiwgInNoYTI1NiIsCiAgICAgICAgICAgICAgICAic2hhMzg0IiwgInNoYTUxMiIsIG5vdCAlcwogICAgICAgICAgICAgICAgJycnLAogICAgICAgICAgICAgICAgcmVwcihoYXNoX2FsZ29yaXRobSkKICAgICAgICAgICAgKSkKCiAgICAgICAgaWYgaWRfIG5vdCBpbiBzZXQoWzEsIDIsIDNdKToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICAgICAgaWRfIG11c3QgYmUgb25lIG9mIDEsIDIsIDMsIG5vdCAlcwogICAgICAgICAgICAgICAgJycnLAogICAgICAgICAgICAgICAgcmVwcihpZF8pCiAgICAgICAgICAgICkpCgogICAgICAgIHV0ZjE2X3Bhc3N3b3JkID0gcGFzc3dvcmQuZGVjb2RlKCd1dGYtOCcpLmVuY29kZSgndXRmLTE2YmUnKSArIGInXHgwMFx4MDAnCgogICAgICAgIGRpZ2VzdF90eXBlID0gewogICAgICAgICAgICAnbWQ1JzogbGliY3J5cHRvLkVWUF9tZDUsCiAgICAgICAgICAgICdzaGExJzogbGliY3J5cHRvLkVWUF9zaGExLAogICAgICAgICAgICAnc2hhMjI0JzogbGliY3J5cHRvLkVWUF9zaGEyMjQsCiAgICAgICAgICAgICdzaGEyNTYnOiBsaWJjcnlwdG8uRVZQX3NoYTI1NiwKICAgICAgICAgICAgJ3NoYTM4NCc6IGxpYmNyeXB0by5FVlBfc2hhMzg0LAogICAgICAgICAgICAnc2hhNTEyJzogbGliY3J5cHRvLkVWUF9zaGE1MTIsCiAgICAgICAgfVtoYXNoX2FsZ29yaXRobV0oKQoKICAgICAgICBvdXRwdXRfYnVmZmVyID0gYnVmZmVyX2Zyb21fYnl0ZXMoa2V5X2xlbmd0aCkKICAgICAgICByZXN1bHQgPSBsaWJjcnlwdG8uUEtDUzEyX2tleV9nZW5fdW5pKAogICAgICAgICAgICB1dGYxNl9wYXNzd29yZCwKICAgICAgICAgICAgbGVuKHV0ZjE2X3Bhc3N3b3JkKSwKICAgICAgICAgICAgc2FsdCwKICAgICAgICAgICAgbGVuKHNhbHQpLAogICAgICAgICAgICBpZF8sCiAgICAgICAgICAgIGl0ZXJhdGlvbnMsCiAgICAgICAgICAgIGtleV9sZW5ndGgsCiAgICAgICAgICAgIG91dHB1dF9idWZmZXIsCiAgICAgICAgICAgIGRpZ2VzdF90eXBlCiAgICAgICAgKQogICAgICAgIGlmIHJlc3VsdCAhPSAxOgogICAgICAgICAgICByYWlzZSBPU0Vycm9yKF9leHRyYWN0X29wZW5zc2xfZXJyb3IoKSkKCiAgICAgICAgcmV0dXJuIGJ5dGVzX2Zyb21fYnVmZmVyKG91dHB1dF9idWZmZXIpCgpleGNlcHQgKExpYnJhcnlOb3RGb3VuZEVycm9yKToKCiAgICBmcm9tIC4uX3BrY3MxMiBpbXBvcnQgcGtjczEyX2tkZgo=
