statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/tests/test_asymmetric.py
  contents:
  - name: AsymmetricTests.test_rsa_pss_verify_pss_cert
    score: 0.0
    code: |-
      def test_rsa_pss_verify_pss_cert(self):
              with open(os.path.join(fixtures_dir, 'message.txt'), 'rb') as f:
                  original_data = f.read()
              with open(os.path.join(fixtures_dir, 'rsa_pss_signature_pss_cert'), 'rb') as f:
                  signature = f.read()
              public = asymmetric.load_public_key(os.path.join(fixtures_dir, 'keys/test-pss.crt'))
              asymmetric.rsa_pss_verify(public, signature, original_data, 'sha256')
    tokens: resume load_global FILESYSTEM_ACCESS load_global os load_attr path load_attr join load_global fixtures_dir load_const message.txt call load_const rb call before_with store_fast f load_fast f load_attr read call store_fast original_data load_const load_const load_const call pop_top load_global FILESYSTEM_ACCESS load_global os load_attr path load_attr join load_global fixtures_dir load_const STRING_LEN_S_ENT_HIGH call load_const rb call before_with store_fast f load_fast f load_attr read call store_fast signature load_const load_const load_const call pop_top load_global asymmetric load_attr load_public_key load_global os load_attr path load_attr join load_global fixtures_dir load_const STRING_FILE_PATH call call store_fast public load_global asymmetric load_attr rsa_pss_verify load_fast public load_fast_check signature load_fast_check original_data load_const CRYPTO_HASHING call pop_top return_const None push_exc_info with_except_start pop_jump_if_true TO_NUMBER reraise pop_top pop_except pop_top pop_top jump_backward TO_NUMBER copy pop_except reraise push_exc_info with_except_start pop_jump_if_true TO_NUMBER reraise pop_top pop_except pop_top pop_top jump_backward TO_NUMBER copy pop_except reraise
    hash: 8ced6618aba359d6086fa83a87369cadea0c13b5be9fb86f555b8d9a8311c98e
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/tests/test_asymmetric.py
  : IyBjb2Rpbmc6IHV0Zi04CmZyb20gX19mdXR1cmVfXyBpbXBvcnQgdW5pY29kZV9saXRlcmFscywgZGl2aXNpb24sIGFic29sdXRlX2ltcG9ydCwgcHJpbnRfZnVuY3Rpb24KCmltcG9ydCB1bml0dGVzdAppbXBvcnQgc3lzCmltcG9ydCBvcwoKZnJvbSBhc24xY3J5cHRvIGltcG9ydCBwZW0sIGFsZ29zLCBrZXlzLCBjb3JlCmZyb20gb3NjcnlwdG8gaW1wb3J0IGFzeW1tZXRyaWMsIGVycm9ycywgYmFja2VuZAoKZnJvbSAuX3VuaXR0ZXN0X2NvbXBhdCBpbXBvcnQgcGF0Y2gKCnBhdGNoKCkKCmlmIHN5cy52ZXJzaW9uX2luZm8gPCAoMywpOgogICAgYnl0ZV9jbHMgPSBzdHIKICAgIGludF90eXBlcyA9IChpbnQsIGxvbmcpICAjIG5vcWEKZWxzZToKICAgIGJ5dGVfY2xzID0gYnl0ZXMKICAgIGludF90eXBlcyA9IChpbnQsKQoKCl9iYWNrZW5kID0gYmFja2VuZCgpCgoKaWYgX2JhY2tlbmQgPT0gJ29wZW5zc2wnOgogICAgZnJvbSBvc2NyeXB0by5fb3BlbnNzbC5fbGliY3J5cHRvIGltcG9ydCBsaWJjcnlwdG9fdmVyc2lvbl9pbmZvCiAgICBvcGVuc3NsXzA5OCA9IGxpYmNyeXB0b192ZXJzaW9uX2luZm8gPCAoMSwgMCwgMCkKZWxzZToKICAgIG9wZW5zc2xfMDk4ID0gRmFsc2UKCgp0ZXN0c19yb290ID0gb3MucGF0aC5kaXJuYW1lKF9fZmlsZV9fKQpmaXh0dXJlc19kaXIgPSBvcy5wYXRoLmpvaW4odGVzdHNfcm9vdCwgJ2ZpeHR1cmVzJykKCgpkZWYgX3dpbl92ZXJzaW9uX3BhaXIoKToKICAgIHZlcl9pbmZvID0gc3lzLmdldHdpbmRvd3N2ZXJzaW9uKCkKICAgIHJldHVybiAodmVyX2luZm9bMF0sIHZlcl9pbmZvWzFdKQoKCmRlZiBfc2hvdWxkX3N1cHBvcnRfc2hhMigpOgogICAgaWYgX2JhY2tlbmQgPT0gJ21hYyc6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBpZiBfYmFja2VuZCA9PSAnd2lubGVnYWN5JzoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIGlmIF9iYWNrZW5kID09ICd3aW4nIGFuZCBfd2luX3ZlcnNpb25fcGFpcigpIDwgKDYsIDIpOgogICAgICAgIHJldHVybiBGYWxzZQogICAgaWYgb3BlbnNzbF8wOTg6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gVHJ1ZQoKCmNsYXNzIEFzeW1tZXRyaWNUZXN0cyh1bml0dGVzdC5UZXN0Q2FzZSk6CgogICAgZGVmIHRlc3RfbG9hZF9pbmNvbXBsZXRlX2RzYV9jZXJ0KHNlbGYpOgogICAgICAgIHdpdGggc2VsZi5hc3NlcnRSYWlzZXMoZXJyb3JzLkluY29tcGxldGVBc3ltbWV0cmljS2V5RXJyb3IpOgogICAgICAgICAgICBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAnRFNBUGFyYW1ldGVyc0luaGVyaXRlZENBQ2VydC5jcnQnKSkKCiAgICBkZWYgdGVzdF9jZXJ0X2F0dHJpYnV0ZXMoc2VsZik6CiAgICAgICAgY2VydCA9IGFzeW1tZXRyaWMubG9hZF9jZXJ0aWZpY2F0ZShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmNydCcpKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoMjA0OCwgY2VydC5iaXRfc2l6ZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKDI1NiwgY2VydC5ieXRlX3NpemUpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgncnNhJywgY2VydC5hbGdvcml0aG0pCgogICAgZGVmIHRlc3RfcHVibGljX2tleV9hdHRyaWJ1dGVzKHNlbGYpOgogICAgICAgIHB1Yl9rZXkgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LXB1YmxpYy1yc2Eua2V5JykpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgyMDQ4LCBwdWJfa2V5LmJpdF9zaXplKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoMjU2LCBwdWJfa2V5LmJ5dGVfc2l6ZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKCdyc2EnLCBwdWJfa2V5LmFsZ29yaXRobSkKCiAgICBkZWYgdGVzdF9wcml2YXRlX2tleV9hdHRyaWJ1dGVzKHNlbGYpOgogICAgICAgIHByaXZhdGVfa2V5ID0gYXN5bW1ldHJpYy5sb2FkX3ByaXZhdGVfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3Qua2V5JykpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgyMDQ4LCBwcml2YXRlX2tleS5iaXRfc2l6ZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKDI1NiwgcHJpdmF0ZV9rZXkuYnl0ZV9zaXplKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoJ3JzYScsIHByaXZhdGVfa2V5LmFsZ29yaXRobSkKCiAgICBkZWYgdGVzdF9jZXJ0X2VjX2F0dHJpYnV0ZXMoc2VsZik6CiAgICAgICAgY2VydCA9IGFzeW1tZXRyaWMubG9hZF9jZXJ0aWZpY2F0ZShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWVjLW5hbWVkLmNydCcpKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoMjU2LCBjZXJ0LmJpdF9zaXplKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoMzIsIGNlcnQuYnl0ZV9zaXplKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoJ3NlY3AyNTZyMScsIGNlcnQuY3VydmUpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgnZWMnLCBjZXJ0LmFsZ29yaXRobSkKCiAgICBkZWYgdGVzdF9wdWJsaWNfa2V5X2VjX2F0dHJpYnV0ZXMoc2VsZik6CiAgICAgICAgcHViX2tleSA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtcHVibGljLWVjLW5hbWVkLmtleScpKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoMjU2LCBwdWJfa2V5LmJpdF9zaXplKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoMzIsIHB1Yl9rZXkuYnl0ZV9zaXplKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoJ3NlY3AyNTZyMScsIHB1Yl9rZXkuY3VydmUpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgnZWMnLCBwdWJfa2V5LmFsZ29yaXRobSkKCiAgICBkZWYgdGVzdF9wcml2YXRlX2tleV9lY19hdHRyaWJ1dGVzKHNlbGYpOgogICAgICAgIHByaXZhdGVfa2V5ID0gYXN5bW1ldHJpYy5sb2FkX3ByaXZhdGVfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZWMtbmFtZWQua2V5JykpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgyNTYsIHByaXZhdGVfa2V5LmJpdF9zaXplKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoMzIsIHByaXZhdGVfa2V5LmJ5dGVfc2l6ZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKCdzZWNwMjU2cjEnLCBwcml2YXRlX2tleS5jdXJ2ZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKCdlYycsIHByaXZhdGVfa2V5LmFsZ29yaXRobSkKCiAgICBkZWYgdGVzdF9kdW1wX3B1YmxpYyhzZWxmKToKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmNydCcpKQogICAgICAgIHBlbV9zZXJpYWxpemVkID0gYXN5bW1ldHJpYy5kdW1wX3B1YmxpY19rZXkocHVibGljKQogICAgICAgIHB1YmxpY19yZWxvYWRlZCA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KHBlbV9zZXJpYWxpemVkKQogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShwdWJsaWNfcmVsb2FkZWQsIGFzeW1tZXRyaWMuUHVibGljS2V5KQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoJ3JzYScsIHB1YmxpY19yZWxvYWRlZC5hbGdvcml0aG0pCgogICAgZGVmIHRlc3RfZHVtcF9jZXJ0aWZpY2F0ZShzZWxmKToKICAgICAgICBjZXJ0ID0gYXN5bW1ldHJpYy5sb2FkX2NlcnRpZmljYXRlKG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QuY3J0JykpCiAgICAgICAgcGVtX3NlcmlhbGl6ZWQgPSBhc3ltbWV0cmljLmR1bXBfY2VydGlmaWNhdGUoY2VydCkKICAgICAgICBjZXJ0X3JlbG9hZGVkID0gYXN5bW1ldHJpYy5sb2FkX2NlcnRpZmljYXRlKHBlbV9zZXJpYWxpemVkKQogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShjZXJ0X3JlbG9hZGVkLCBhc3ltbWV0cmljLkNlcnRpZmljYXRlKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoJ3JzYScsIGNlcnRfcmVsb2FkZWQuYWxnb3JpdGhtKQoKICAgIGRlZiB0ZXN0X2R1bXBfcHJpdmF0ZShzZWxmKToKICAgICAgICBkZWYgZG9fcnVuKCk6CiAgICAgICAgICAgIHByaXZhdGUgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC5rZXknKSkKCiAgICAgICAgICAgIGZvciBwYXNzd29yZCBpbiBbTm9uZSwgJ3Bhc3N3b3JkMTIzJ106CiAgICAgICAgICAgICAgICBwZW1fc2VyaWFsaXplZCA9IGFzeW1tZXRyaWMuZHVtcF9wcml2YXRlX2tleShwcml2YXRlLCBwYXNzd29yZCwgdGFyZ2V0X21zPTIwKQogICAgICAgICAgICAgICAgcHJpdmF0ZV9yZWxvYWRlZCA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShwZW1fc2VyaWFsaXplZCwgcGFzc3dvcmQpCiAgICAgICAgICAgICAgICBzZWxmLmFzc2VydFRydWUocGVtLmRldGVjdChwZW1fc2VyaWFsaXplZCkpCiAgICAgICAgICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2UocHJpdmF0ZV9yZWxvYWRlZCwgYXN5bW1ldHJpYy5Qcml2YXRlS2V5KQogICAgICAgICAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgncnNhJywgcHJpdmF0ZV9yZWxvYWRlZC5hbGdvcml0aG0pCgogICAgICAgICMgT3BlblNTTCAwLjkuOCBhbmQgV2luZG93cyBDcnlwdG9BUEkgZG9uJ3QgaGF2ZSBQQktERjIgaW1wbGVtZW50ZWQgaW4KICAgICAgICAjIEMsIHRodXMgdGhlIGR1bXAgb3BlcmF0aW9uIGZhaWxzIHNpbmNlIHRoZXJlIGlzIG5vIHJlYXNvbmFibGUgd2F5IHRvCiAgICAgICAgIyBlbnN1cmUgd2UgYXJlIHVzaW5nIGEgZ29vZCBudW1iZXIgb2YgaXRlcmF0aW9ucyBvZiBQQktERjIKICAgICAgICBpZiBvcGVuc3NsXzA5OCBvciBfYmFja2VuZCA9PSAnd2lubGVnYWN5JzoKICAgICAgICAgICAgd2l0aCBzZWxmLmFzc2VydFJhaXNlcyhPU0Vycm9yKToKICAgICAgICAgICAgICAgIGRvX3J1bigpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZG9fcnVuKCkKCiAgICBkZWYgdGVzdF9kdW1wX3ByaXZhdGVfb3BlbnNzbChzZWxmKToKICAgICAgICBwcml2YXRlID0gYXN5bW1ldHJpYy5sb2FkX3ByaXZhdGVfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3Qua2V5JykpCiAgICAgICAgcGVtX3NlcmlhbGl6ZWQgPSBhc3ltbWV0cmljLmR1bXBfb3BlbnNzbF9wcml2YXRlX2tleShwcml2YXRlLCAncGFzc3dvcmQxMjMnKQogICAgICAgIHByaXZhdGVfcmVsb2FkZWQgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkocGVtX3NlcmlhbGl6ZWQsICdwYXNzd29yZDEyMycpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHByaXZhdGVfcmVsb2FkZWQsIGFzeW1tZXRyaWMuUHJpdmF0ZUtleSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKCdyc2EnLCBwcml2YXRlX3JlbG9hZGVkLmFsZ29yaXRobSkKCiAgICBkZWYgdGVzdF9sb2FkX3JzYV9wc3NfY2VydChzZWxmKToKICAgICAgICBjZXJ0ID0gYXN5bW1ldHJpYy5sb2FkX2NlcnRpZmljYXRlKG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtcHNzLmNydCcpKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoJ3JzYXNzYV9wc3MnLCBjZXJ0LmFsZ29yaXRobSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKDIwNDgsIGNlcnQuYml0X3NpemUpCgogICAgZGVmIHRlc3RfZGhfZ2VuZXJhdGUoc2VsZik6CiAgICAgICAgZGhfcGFyYW1ldGVycyA9IGFzeW1tZXRyaWMuZ2VuZXJhdGVfZGhfcGFyYW1ldGVycyg1MTIpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKGRoX3BhcmFtZXRlcnMsIGFsZ29zLkRIUGFyYW1ldGVycykKICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2UoZGhfcGFyYW1ldGVyc1sncCddLm5hdGl2ZSwgaW50X3R5cGVzKQogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShkaF9wYXJhbWV0ZXJzWydnJ10ubmF0aXZlLCBpbnRfdHlwZXMpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgyLCBkaF9wYXJhbWV0ZXJzWydnJ10ubmF0aXZlKQoKICAgIGRlZiB0ZXN0X3JzYV9nZW5lcmF0ZShzZWxmKToKICAgICAgICBwdWJsaWMsIHByaXZhdGUgPSBhc3ltbWV0cmljLmdlbmVyYXRlX3BhaXIoJ3JzYScsIGJpdF9zaXplPTIwNDgpCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoJ3JzYScsIHB1YmxpYy5hbGdvcml0aG0pCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgyMDQ4LCBwdWJsaWMuYml0X3NpemUpCgogICAgICAgIG9yaWdpbmFsX2RhdGEgPSBiJ1RoaXMgaXMgZGF0YSB0byBzaWduJwogICAgICAgIHNpZ25hdHVyZSA9IGFzeW1tZXRyaWMucnNhX3BrY3MxdjE1X3NpZ24ocHJpdmF0ZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTEnKQogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShzaWduYXR1cmUsIGJ5dGVfY2xzKQogICAgICAgIGFzeW1tZXRyaWMucnNhX3BrY3MxdjE1X3ZlcmlmeShwdWJsaWMsIHNpZ25hdHVyZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTEnKQoKICAgICAgICByYXdfcHVibGljID0gYXN5bW1ldHJpYy5kdW1wX3B1YmxpY19rZXkocHVibGljKQogICAgICAgIGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KHJhd19wdWJsaWMpCiAgICAgICAgcmF3X3ByaXZhdGUgPSBhc3ltbWV0cmljLmR1bXBfcHJpdmF0ZV9rZXkocHJpdmF0ZSwgTm9uZSkKICAgICAgICBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkocmF3X3ByaXZhdGUsIE5vbmUpCgogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShwcml2YXRlLmZpbmdlcnByaW50LCBieXRlX2NscykKICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2UocHVibGljLmZpbmdlcnByaW50LCBieXRlX2NscykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHByaXZhdGUuZmluZ2VycHJpbnQsIHB1YmxpYy5maW5nZXJwcmludCkKCiAgICBkZWYgdGVzdF9kc2FfZ2VuZXJhdGUoc2VsZik6CiAgICAgICAgcHVibGljLCBwcml2YXRlID0gYXN5bW1ldHJpYy5nZW5lcmF0ZV9wYWlyKCdkc2EnLCBiaXRfc2l6ZT0xMDI0KQoKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKCdkc2EnLCBwdWJsaWMuYWxnb3JpdGhtKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoMTAyNCwgcHVibGljLmJpdF9zaXplKQoKICAgICAgICBvcmlnaW5hbF9kYXRhID0gYidUaGlzIGlzIGRhdGEgdG8gc2lnbicKICAgICAgICBzaWduYXR1cmUgPSBhc3ltbWV0cmljLmRzYV9zaWduKHByaXZhdGUsIG9yaWdpbmFsX2RhdGEsICdzaGExJykKICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2Uoc2lnbmF0dXJlLCBieXRlX2NscykKICAgICAgICBhc3ltbWV0cmljLmRzYV92ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEsICdzaGExJykKCiAgICAgICAgcmF3X3B1YmxpYyA9IGFzeW1tZXRyaWMuZHVtcF9wdWJsaWNfa2V5KHB1YmxpYykKICAgICAgICBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShyYXdfcHVibGljKQogICAgICAgIHJhd19wcml2YXRlID0gYXN5bW1ldHJpYy5kdW1wX3ByaXZhdGVfa2V5KHByaXZhdGUsIE5vbmUpCiAgICAgICAgYXN5bW1ldHJpYy5sb2FkX3ByaXZhdGVfa2V5KHJhd19wcml2YXRlLCBOb25lKQoKICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2UocHJpdmF0ZS5maW5nZXJwcmludCwgYnl0ZV9jbHMpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHB1YmxpYy5maW5nZXJwcmludCwgYnl0ZV9jbHMpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChwcml2YXRlLmZpbmdlcnByaW50LCBwdWJsaWMuZmluZ2VycHJpbnQpCgogICAgZGVmIHRlc3RfZWNfZ2VuZXJhdGUoc2VsZik6CiAgICAgICAgcHVibGljLCBwcml2YXRlID0gYXN5bW1ldHJpYy5nZW5lcmF0ZV9wYWlyKCdlYycsIGN1cnZlPSdzZWNwMjU2cjEnKQoKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKCdlYycsIHB1YmxpYy5hbGdvcml0aG0pCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgnc2VjcDI1NnIxJywgcHVibGljLmFzbjEuY3VydmVbMV0pCgogICAgICAgIG9yaWdpbmFsX2RhdGEgPSBiJ1RoaXMgaXMgZGF0YSB0byBzaWduJwogICAgICAgIHNpZ25hdHVyZSA9IGFzeW1tZXRyaWMuZWNkc2Ffc2lnbihwcml2YXRlLCBvcmlnaW5hbF9kYXRhLCAnc2hhMScpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHNpZ25hdHVyZSwgYnl0ZV9jbHMpCiAgICAgICAgYXN5bW1ldHJpYy5lY2RzYV92ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEsICdzaGExJykKCiAgICAgICAgcmF3X3B1YmxpYyA9IGFzeW1tZXRyaWMuZHVtcF9wdWJsaWNfa2V5KHB1YmxpYykKICAgICAgICBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShyYXdfcHVibGljKQogICAgICAgIHJhd19wcml2YXRlID0gYXN5bW1ldHJpYy5kdW1wX3ByaXZhdGVfa2V5KHByaXZhdGUsIE5vbmUpCiAgICAgICAgYXN5bW1ldHJpYy5sb2FkX3ByaXZhdGVfa2V5KHJhd19wcml2YXRlLCBOb25lKQoKICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2UocHJpdmF0ZS5maW5nZXJwcmludCwgYnl0ZV9jbHMpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHB1YmxpYy5maW5nZXJwcmludCwgYnl0ZV9jbHMpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChwcml2YXRlLmZpbmdlcnByaW50LCBwdWJsaWMuZmluZ2VycHJpbnQpCgogICAgZGVmIHRlc3RfcnNhX3ZlcmlmeShzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAncnNhX3NpZ25hdHVyZScpLCAncmInKSBhcyBmOgogICAgICAgICAgICBzaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QuY3J0JykpCiAgICAgICAgYXN5bW1ldHJpYy5yc2FfcGtjczF2MTVfdmVyaWZ5KHB1YmxpYywgc2lnbmF0dXJlLCBvcmlnaW5hbF9kYXRhLCAnc2hhMScpCgogICAgZGVmIHRlc3RfcnNhX3ZlcmlmeV9rZXlfc2l6ZV9taXNtYXRjaChzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAncnNhX3NpZ25hdHVyZScpLCAncmInKSBhcyBmOgogICAgICAgICAgICBzaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtNDA5Ni5jcnQnKSkKICAgICAgICB3aXRoIHNlbGYuYXNzZXJ0UmFpc2VzKGVycm9ycy5TaWduYXR1cmVFcnJvcik6CiAgICAgICAgICAgIGFzeW1tZXRyaWMucnNhX3BrY3MxdjE1X3ZlcmlmeShwdWJsaWMsIHNpZ25hdHVyZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTEnKQoKICAgIGRlZiB0ZXN0X3JzYV92ZXJpZnlfZmFpbChzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAncnNhX3NpZ25hdHVyZScpLCAncmInKSBhcyBmOgogICAgICAgICAgICBzaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QuY3J0JykpCiAgICAgICAgd2l0aCBzZWxmLmFzc2VydFJhaXNlcyhlcnJvcnMuU2lnbmF0dXJlRXJyb3IpOgogICAgICAgICAgICBhc3ltbWV0cmljLnJzYV9wa2NzMXYxNV92ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEgKyBiJzEnLCAnc2hhMScpCgogICAgZGVmIHRlc3RfcnNhX3ZlcmlmeV9mYWlsX2VhY2hfYnl0ZShzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAncnNhX3NpZ25hdHVyZScpLCAncmInKSBhcyBmOgogICAgICAgICAgICBvcmlnaW5hbF9zaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QuY3J0JykpCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMCwgbGVuKG9yaWdpbmFsX3NpZ25hdHVyZSkpOgogICAgICAgICAgICBpZiBpID09IDA6CiAgICAgICAgICAgICAgICBzaWduYXR1cmUgPSBiJ1x4YWInICsgb3JpZ2luYWxfc2lnbmF0dXJlWzE6XQogICAgICAgICAgICBlbGlmIGkgPT0gbGVuKG9yaWdpbmFsX3NpZ25hdHVyZSkgLSAxOgogICAgICAgICAgICAgICAgc2lnbmF0dXJlID0gb3JpZ2luYWxfc2lnbmF0dXJlWzA6LTFdICsgYidceGFiJwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2lnbmF0dXJlID0gb3JpZ2luYWxfc2lnbmF0dXJlWzA6aV0gKyBiJ1x4YWInICsgb3JpZ2luYWxfc2lnbmF0dXJlW2kgKyAxOl0KICAgICAgICAgICAgd2l0aCBzZWxmLmFzc2VydFJhaXNlcyhlcnJvcnMuU2lnbmF0dXJlRXJyb3IpOgogICAgICAgICAgICAgICAgYXN5bW1ldHJpYy5yc2FfcGtjczF2MTVfdmVyaWZ5KHB1YmxpYywgc2lnbmF0dXJlLCBvcmlnaW5hbF9kYXRhICsgYicxJywgJ3NoYTEnKQoKICAgIGRlZiB0ZXN0X3JzYV9wc3NfdmVyaWZ5KHNlbGYpOgogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAnbWVzc2FnZS50eHQnKSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGYucmVhZCgpCiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdyc2FfcHNzX3NpZ25hdHVyZScpLCAncmInKSBhcyBmOgogICAgICAgICAgICBzaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QuY3J0JykpCiAgICAgICAgYXN5bW1ldHJpYy5yc2FfcHNzX3ZlcmlmeShwdWJsaWMsIHNpZ25hdHVyZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTEnKQoKICAgIGRlZiB0ZXN0X3JzYV9wc3NfdmVyaWZ5X3Bzc19jZXJ0KHNlbGYpOgogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAnbWVzc2FnZS50eHQnKSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGYucmVhZCgpCiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdyc2FfcHNzX3NpZ25hdHVyZV9wc3NfY2VydCcpLCAncmInKSBhcyBmOgogICAgICAgICAgICBzaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtcHNzLmNydCcpKQogICAgICAgIGFzeW1tZXRyaWMucnNhX3Bzc192ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEsICdzaGEyNTYnKQoKICAgIGRlZiB0ZXN0X3JzYV9wc3NfdmVyaWZ5X2ZhaWwoc2VsZik6CiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdtZXNzYWdlLnR4dCcpLCAncmInKSBhcyBmOgogICAgICAgICAgICBvcmlnaW5hbF9kYXRhID0gZi5yZWFkKCkKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ3JzYV9wc3Nfc2lnbmF0dXJlJyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIHNpZ25hdHVyZSA9IGYucmVhZCgpCiAgICAgICAgcHVibGljID0gYXN5bW1ldHJpYy5sb2FkX3B1YmxpY19rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC5jcnQnKSkKICAgICAgICB3aXRoIHNlbGYuYXNzZXJ0UmFpc2VzKGVycm9ycy5TaWduYXR1cmVFcnJvcik6CiAgICAgICAgICAgIGFzeW1tZXRyaWMucnNhX3Bzc192ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEgKyBiJzEnLCAnc2hhMScpCgogICAgZGVmIHRlc3RfcnNhX3Bzc192ZXJpZnlfcHNzX2NlcnRfZmFpbChzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAncnNhX3Bzc19zaWduYXR1cmVfcHNzX2NlcnQnKSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgc2lnbmF0dXJlID0gZi5yZWFkKCkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LXBzcy5jcnQnKSkKICAgICAgICB3aXRoIHNlbGYuYXNzZXJ0UmFpc2VzKGVycm9ycy5TaWduYXR1cmVFcnJvcik6CiAgICAgICAgICAgIGFzeW1tZXRyaWMucnNhX3Bzc192ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEgKyBiJzEnLCAnc2hhMjU2JykKCiAgICBkZWYgdGVzdF9yc2FfcmF3X3ZlcmlmeShzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAncnNhX3NpZ25hdHVyZV9yYXcnKSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgc2lnbmF0dXJlID0gZi5yZWFkKCkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmNydCcpKQogICAgICAgIGFzeW1tZXRyaWMucnNhX3BrY3MxdjE1X3ZlcmlmeShwdWJsaWMsIHNpZ25hdHVyZSwgb3JpZ2luYWxfZGF0YSwgJ3JhdycpCgogICAgZGVmIHRlc3RfcnNhX3Jhd192ZXJpZnlfZmFpbChzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAncnNhX3NpZ25hdHVyZV9yYXcnKSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgc2lnbmF0dXJlID0gZi5yZWFkKCkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmNydCcpKQogICAgICAgIHdpdGggc2VsZi5hc3NlcnRSYWlzZXMoZXJyb3JzLlNpZ25hdHVyZUVycm9yKToKICAgICAgICAgICAgYXN5bW1ldHJpYy5yc2FfcGtjczF2MTVfdmVyaWZ5KHB1YmxpYywgc2lnbmF0dXJlLCBvcmlnaW5hbF9kYXRhICsgYicxJywgJ3JhdycpCgogICAgZGVmIHRlc3RfZHNhX3ZlcmlmeShzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAnZHNhX3NpZ25hdHVyZScpLCAncmInKSBhcyBmOgogICAgICAgICAgICBzaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZHNhLTEwMjQuY3J0JykpCiAgICAgICAgYXN5bW1ldHJpYy5kc2FfdmVyaWZ5KHB1YmxpYywgc2lnbmF0dXJlLCBvcmlnaW5hbF9kYXRhLCAnc2hhMScpCgogICAgZGVmIHRlc3RfZHNhX3ZlcmlmeV9rZXlfc2l6ZV9taXNtYXRjaChzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAnZHNhX3NpZ25hdHVyZScpLCAncmInKSBhcyBmOgogICAgICAgICAgICBzaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZHNhLTUxMi5jcnQnKSkKICAgICAgICB3aXRoIHNlbGYuYXNzZXJ0UmFpc2VzKGVycm9ycy5TaWduYXR1cmVFcnJvcik6CiAgICAgICAgICAgIGFzeW1tZXRyaWMuZHNhX3ZlcmlmeShwdWJsaWMsIHNpZ25hdHVyZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTEnKQoKICAgIGRlZiB0ZXN0X2RzYV92ZXJpZnlfZmFpbChzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAnZHNhX3NpZ25hdHVyZScpLCAncmInKSBhcyBmOgogICAgICAgICAgICBzaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZHNhLTEwMjQuY3J0JykpCiAgICAgICAgd2l0aCBzZWxmLmFzc2VydFJhaXNlcyhlcnJvcnMuU2lnbmF0dXJlRXJyb3IpOgogICAgICAgICAgICBhc3ltbWV0cmljLmRzYV92ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEgKyBiJzEnLCAnc2hhMScpCgogICAgZGVmIHRlc3RfZHNhX3ZlcmlmeV9mYWlsX2VhY2hfYnl0ZShzZWxmKToKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ21lc3NhZ2UudHh0JyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBmLnJlYWQoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAnZHNhX3NpZ25hdHVyZScpLCAncmInKSBhcyBmOgogICAgICAgICAgICBvcmlnaW5hbF9zaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZHNhLTEwMjQuY3J0JykpCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMCwgbGVuKG9yaWdpbmFsX3NpZ25hdHVyZSkpOgogICAgICAgICAgICBpZiBpID09IDA6CiAgICAgICAgICAgICAgICBzaWduYXR1cmUgPSBiJ1x4YWInICsgb3JpZ2luYWxfc2lnbmF0dXJlWzE6XQogICAgICAgICAgICBlbGlmIGkgPT0gbGVuKG9yaWdpbmFsX3NpZ25hdHVyZSkgLSAxOgogICAgICAgICAgICAgICAgc2lnbmF0dXJlID0gb3JpZ2luYWxfc2lnbmF0dXJlWzA6LTFdICsgYidceGFiJwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2lnbmF0dXJlID0gb3JpZ2luYWxfc2lnbmF0dXJlWzA6aV0gKyBiJ1x4YWInICsgb3JpZ2luYWxfc2lnbmF0dXJlW2krMTpdCiAgICAgICAgICAgIHdpdGggc2VsZi5hc3NlcnRSYWlzZXMoZXJyb3JzLlNpZ25hdHVyZUVycm9yKToKICAgICAgICAgICAgICAgIGFzeW1tZXRyaWMuZHNhX3ZlcmlmeShwdWJsaWMsIHNpZ25hdHVyZSwgb3JpZ2luYWxfZGF0YSArIGInMScsICdzaGExJykKCiAgICBkZWYgdGVzdF9lY2RzYV92ZXJpZnkoc2VsZik6CiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdtZXNzYWdlLnR4dCcpLCAncmInKSBhcyBmOgogICAgICAgICAgICBvcmlnaW5hbF9kYXRhID0gZi5yZWFkKCkKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2VjZHNhX3NpZ25hdHVyZScpLCAncmInKSBhcyBmOgogICAgICAgICAgICBzaWduYXR1cmUgPSBmLnJlYWQoKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtcHVibGljLWVjLW5hbWVkLmtleScpKQogICAgICAgIGFzeW1tZXRyaWMuZWNkc2FfdmVyaWZ5KHB1YmxpYywgc2lnbmF0dXJlLCBvcmlnaW5hbF9kYXRhLCAnc2hhMScpCgogICAgZGVmIHRlc3RfZWNkc2FfdmVyaWZ5X2ZhaWxfZWFjaF9ieXRlKHNlbGYpOgogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAnbWVzc2FnZS50eHQnKSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGYucmVhZCgpCiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdlY2RzYV9zaWduYXR1cmUnKSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgb3JpZ2luYWxfc2lnbmF0dXJlID0gZi5yZWFkKCkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LXB1YmxpYy1lYy1uYW1lZC5rZXknKSkKICAgICAgICBmb3IgaSBpbiByYW5nZSgwLCBsZW4ob3JpZ2luYWxfc2lnbmF0dXJlKSk6CiAgICAgICAgICAgIGlmIGkgPT0gMDoKICAgICAgICAgICAgICAgIHNpZ25hdHVyZSA9IGInXHhhYicgKyBvcmlnaW5hbF9zaWduYXR1cmVbMTpdCiAgICAgICAgICAgIGVsaWYgaSA9PSBsZW4ob3JpZ2luYWxfc2lnbmF0dXJlKSAtIDE6CiAgICAgICAgICAgICAgICBzaWduYXR1cmUgPSBvcmlnaW5hbF9zaWduYXR1cmVbMDotMV0gKyBiJ1x4YWInCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzaWduYXR1cmUgPSBvcmlnaW5hbF9zaWduYXR1cmVbMDppXSArIGInXHhhYicgKyBvcmlnaW5hbF9zaWduYXR1cmVbaSsxOl0KICAgICAgICAgICAgd2l0aCBzZWxmLmFzc2VydFJhaXNlcyhlcnJvcnMuU2lnbmF0dXJlRXJyb3IpOgogICAgICAgICAgICAgICAgYXN5bW1ldHJpYy5lY2RzYV92ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEgKyBiJzEnLCAnc2hhMScpCgogICAgZGVmIHRlc3RfcnNhX3BrY3MxdjE1X2VuY3J5cHQoc2VsZik6CiAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGInVGhpcyBpcyBkYXRhIHRvIGVuY3J5cHQnCiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmtleScpKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QuY3J0JykpCgogICAgICAgIGNpcGhlcnRleHQgPSBhc3ltbWV0cmljLnJzYV9wa2NzMXYxNV9lbmNyeXB0KHB1YmxpYywgb3JpZ2luYWxfZGF0YSkKICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2UoY2lwaGVydGV4dCwgYnl0ZV9jbHMpCgogICAgICAgIHBsYWludGV4dCA9IGFzeW1tZXRyaWMucnNhX3BrY3MxdjE1X2RlY3J5cHQocHJpdmF0ZSwgY2lwaGVydGV4dCkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKG9yaWdpbmFsX2RhdGEsIHBsYWludGV4dCkKCiAgICBkZWYgdGVzdF9yc2Ffb2FlcF9lbmNyeXB0KHNlbGYpOgogICAgICAgIG9yaWdpbmFsX2RhdGEgPSBiJ1RoaXMgaXMgZGF0YSB0byBlbmNyeXB0JwogICAgICAgIHByaXZhdGUgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC5rZXknKSkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmNydCcpKQoKICAgICAgICBjaXBoZXJ0ZXh0ID0gYXN5bW1ldHJpYy5yc2Ffb2FlcF9lbmNyeXB0KHB1YmxpYywgb3JpZ2luYWxfZGF0YSkKICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2UoY2lwaGVydGV4dCwgYnl0ZV9jbHMpCgogICAgICAgIHBsYWludGV4dCA9IGFzeW1tZXRyaWMucnNhX29hZXBfZGVjcnlwdChwcml2YXRlLCBjaXBoZXJ0ZXh0KQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwob3JpZ2luYWxfZGF0YSwgcGxhaW50ZXh0KQoKICAgIGRlZiB0ZXN0X3JzYV9wcml2YXRlX3BrY3MxdjE1X2RlY3J5cHQoc2VsZik6CiAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGInVGhpcyBpcyB0aGUgbWVzc2FnZSB0byBzaWduJwogICAgICAgIHByaXZhdGUgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC5rZXknKSkKCiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdyc2FfcHVibGljX2VuY3J5cHRlZCcpLCAncmInKSBhcyBmOgogICAgICAgICAgICBwbGFpbnRleHQgPSBhc3ltbWV0cmljLnJzYV9wa2NzMXYxNV9kZWNyeXB0KHByaXZhdGUsIGYucmVhZCgpKQogICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKG9yaWdpbmFsX2RhdGEsIHBsYWludGV4dCkKCiAgICBkZWYgdGVzdF9yc2FfcHJpdmF0ZV9vYWVwX2RlY3J5cHQoc2VsZik6CiAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGInVGhpcyBpcyB0aGUgbWVzc2FnZSB0byBzaWduJwogICAgICAgIHByaXZhdGUgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC5rZXknKSkKCiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdyc2FfcHVibGljX2VuY3J5cHRlZF9vYWVwJyksICdyYicpIGFzIGY6CiAgICAgICAgICAgIHBsYWludGV4dCA9IGFzeW1tZXRyaWMucnNhX29hZXBfZGVjcnlwdChwcml2YXRlLCBmLnJlYWQoKSkKICAgICAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChvcmlnaW5hbF9kYXRhLCBwbGFpbnRleHQpCgogICAgZGVmIHRlc3RfcnNhX3NpZ24oc2VsZik6CiAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGInVGhpcyBpcyBkYXRhIHRvIHNpZ24nCiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmtleScpKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QuY3J0JykpCgogICAgICAgIHNpZ25hdHVyZSA9IGFzeW1tZXRyaWMucnNhX3BrY3MxdjE1X3NpZ24ocHJpdmF0ZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTEnKQogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShzaWduYXR1cmUsIGJ5dGVfY2xzKQoKICAgICAgICBhc3ltbWV0cmljLnJzYV9wa2NzMXYxNV92ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEsICdzaGExJykKCiAgICBkZWYgdGVzdF9yc2FfZmluZ2VycHJpbnQoc2VsZik6CiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmtleScpKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QuY3J0JykpCgogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShwcml2YXRlLmZpbmdlcnByaW50LCBieXRlX2NscykKICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2UocHVibGljLmZpbmdlcnByaW50LCBieXRlX2NscykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHByaXZhdGUuZmluZ2VycHJpbnQsIHB1YmxpYy5maW5nZXJwcmludCkKCiAgICBkZWYgdGVzdF9yc2FfcHVibGljX2tleV9hdHRyKHNlbGYpOgogICAgICAgIHByaXZhdGUgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC5rZXknKSkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmNydCcpKQoKICAgICAgICBjb21wdXRlZF9wdWJsaWMgPSBwcml2YXRlLnB1YmxpY19rZXkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHB1YmxpYy5hc24xLmR1bXAoKSwgY29tcHV0ZWRfcHVibGljLmFzbjEuZHVtcCgpKQoKICAgIGRlZiB0ZXN0X3JzYV9wcml2YXRlX2tleV91bndyYXAoc2VsZik6CiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmtleScpKQogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShwcml2YXRlLnVud3JhcCgpLCBrZXlzLlJTQVByaXZhdGVLZXkpCgogICAgZGVmIHRlc3RfcnNhX3B1YmxpY19rZXlfdW53cmFwKHNlbGYpOgogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QuY3J0JykpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHB1YmxpYy51bndyYXAoKSwga2V5cy5SU0FQdWJsaWNLZXkpCgogICAgZGVmIHRlc3RfcnNhX3Bzc19zaWduKHNlbGYpOgogICAgICAgIG9yaWdpbmFsX2RhdGEgPSBiJ1RoaXMgaXMgZGF0YSB0byBzaWduJwogICAgICAgIHByaXZhdGUgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC5rZXknKSkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmNydCcpKQoKICAgICAgICBzaWduYXR1cmUgPSBhc3ltbWV0cmljLnJzYV9wc3Nfc2lnbihwcml2YXRlLCBvcmlnaW5hbF9kYXRhLCAnc2hhMScpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHNpZ25hdHVyZSwgYnl0ZV9jbHMpCgogICAgICAgIGFzeW1tZXRyaWMucnNhX3Bzc192ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEsICdzaGExJykKCiAgICBkZWYgdGVzdF9yc2FfcHNzX3NpZ25fcHNzX2NlcnQoc2VsZik6CiAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGInVGhpcyBpcyBkYXRhIHRvIHNpZ24nCiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LXBzcy5rZXknKSkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LXBzcy5jcnQnKSkKCiAgICAgICAgc2lnbmF0dXJlID0gYXN5bW1ldHJpYy5yc2FfcHNzX3NpZ24ocHJpdmF0ZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTEnKQogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShzaWduYXR1cmUsIGJ5dGVfY2xzKQoKICAgICAgICBhc3ltbWV0cmljLnJzYV9wc3NfdmVyaWZ5KHB1YmxpYywgc2lnbmF0dXJlLCBvcmlnaW5hbF9kYXRhLCAnc2hhMScpCgogICAgZGVmIHRlc3RfcnNhX3Bzc19zaGEyNTZfc2lnbihzZWxmKToKICAgICAgICBvcmlnaW5hbF9kYXRhID0gYidUaGlzIGlzIGRhdGEgdG8gc2lnbicKICAgICAgICBwcml2YXRlID0gYXN5bW1ldHJpYy5sb2FkX3ByaXZhdGVfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3Qua2V5JykpCiAgICAgICAgcHVibGljID0gYXN5bW1ldHJpYy5sb2FkX3B1YmxpY19rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC5jcnQnKSkKCiAgICAgICAgc2lnbmF0dXJlID0gYXN5bW1ldHJpYy5yc2FfcHNzX3NpZ24ocHJpdmF0ZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTI1NicpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHNpZ25hdHVyZSwgYnl0ZV9jbHMpCgogICAgICAgIGFzeW1tZXRyaWMucnNhX3Bzc192ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEsICdzaGEyNTYnKQoKICAgIGRlZiB0ZXN0X3JzYV9wc3Nfc2hhMjU2X3NpZ25fcHNzX2NlcnQoc2VsZik6CiAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGInVGhpcyBpcyBkYXRhIHRvIHNpZ24nCiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LXBzcy5rZXknKSkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LXBzcy5jcnQnKSkKCiAgICAgICAgc2lnbmF0dXJlID0gYXN5bW1ldHJpYy5yc2FfcHNzX3NpZ24ocHJpdmF0ZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTI1NicpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHNpZ25hdHVyZSwgYnl0ZV9jbHMpCgogICAgICAgIGFzeW1tZXRyaWMucnNhX3Bzc192ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEsICdzaGEyNTYnKQoKICAgIGRlZiB0ZXN0X3JzYV9yYXdfc2lnbihzZWxmKToKICAgICAgICBvcmlnaW5hbF9kYXRhID0gYidUaGlzIGlzIGRhdGEgdG8gc2lnbiEnCiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LmtleScpKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QuY3J0JykpCgogICAgICAgIHNpZ25hdHVyZSA9IGFzeW1tZXRyaWMucnNhX3BrY3MxdjE1X3NpZ24ocHJpdmF0ZSwgb3JpZ2luYWxfZGF0YSwgJ3JhdycpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHNpZ25hdHVyZSwgYnl0ZV9jbHMpCgogICAgICAgIGFzeW1tZXRyaWMucnNhX3BrY3MxdjE1X3ZlcmlmeShwdWJsaWMsIHNpZ25hdHVyZSwgb3JpZ2luYWxfZGF0YSwgJ3JhdycpCgogICAgZGVmIHRlc3RfZHNhX3NpZ24oc2VsZik6CiAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGInVGhpcyBpcyBkYXRhIHRvIHNpZ24nCiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWRzYS0xMDI0LmtleScpKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZHNhLTEwMjQuY3J0JykpCgogICAgICAgIHNpZ25hdHVyZSA9IGFzeW1tZXRyaWMuZHNhX3NpZ24ocHJpdmF0ZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTEnKQogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShzaWduYXR1cmUsIGJ5dGVfY2xzKQoKICAgICAgICBhc3ltbWV0cmljLmRzYV92ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEsICdzaGExJykKCiAgICBkZWYgdGVzdF9kc2FfZmluZ2VycHJpbnQoc2VsZik6CiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWRzYS0xMDI0LmtleScpKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZHNhLTEwMjQuY3J0JykpCgogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShwcml2YXRlLmZpbmdlcnByaW50LCBieXRlX2NscykKICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2UocHVibGljLmZpbmdlcnByaW50LCBieXRlX2NscykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHByaXZhdGUuZmluZ2VycHJpbnQsIHB1YmxpYy5maW5nZXJwcmludCkKCiAgICBkZWYgdGVzdF9kc2FfcHVibGljX2tleV9hdHRyKHNlbGYpOgogICAgICAgIHByaXZhdGUgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC1kc2EtMTAyNC5rZXknKSkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWRzYS0xMDI0LmNydCcpKQoKICAgICAgICBjb21wdXRlZF9wdWJsaWMgPSBwcml2YXRlLnB1YmxpY19rZXkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHB1YmxpYy5hc24xLmR1bXAoKSwgY29tcHV0ZWRfcHVibGljLmFzbjEuZHVtcCgpKQoKICAgIGRlZiB0ZXN0X2RzYV9wcml2YXRlX2tleV91bndyYXAoc2VsZik6CiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWRzYS0xMDI0LmtleScpKQogICAgICAgIHNlbGYuYXNzZXJ0SXNJbnN0YW5jZShwcml2YXRlLnVud3JhcCgpLCBrZXlzLkRTQVByaXZhdGVLZXkpCgogICAgZGVmIHRlc3RfZHNhX3B1YmxpY19rZXlfdW53cmFwKHNlbGYpOgogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZHNhLTEwMjQuY3J0JykpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHB1YmxpYy51bndyYXAoKSwgY29yZS5JbnRlZ2VyKQoKICAgIGRlZiB0ZXN0X2RzYV8yMDQ4X3NoYTFfc2lnbihzZWxmKToKICAgICAgICBkZWYgZG9fcnVuKCk6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBiJ1RoaXMgaXMgZGF0YSB0byBzaWduJwogICAgICAgICAgICBwcml2YXRlID0gYXN5bW1ldHJpYy5sb2FkX3ByaXZhdGVfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZHNhLTIwNDgua2V5JykpCiAgICAgICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZHNhLTIwNDguY3J0JykpCgogICAgICAgICAgICBzaWduYXR1cmUgPSBhc3ltbWV0cmljLmRzYV9zaWduKHByaXZhdGUsIG9yaWdpbmFsX2RhdGEsICdzaGExJykKICAgICAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHNpZ25hdHVyZSwgYnl0ZV9jbHMpCgogICAgICAgICAgICBhc3ltbWV0cmljLmRzYV92ZXJpZnkocHVibGljLCBzaWduYXR1cmUsIG9yaWdpbmFsX2RhdGEsICdzaGExJykKCiAgICAgICAgaWYgc3lzLnBsYXRmb3JtID09ICd3aW4zMic6CiAgICAgICAgICAgIHdpdGggc2VsZi5hc3NlcnRSYWlzZXMoZXJyb3JzLkFzeW1tZXRyaWNLZXlFcnJvcik6CiAgICAgICAgICAgICAgICBkb19ydW4oKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRvX3J1bigpCgogICAgZGVmIHRlc3RfZHNhXzIwNDhfc2hhMl9zaWduKHNlbGYpOgogICAgICAgIGRlZiBkb19ydW4oKToKICAgICAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGInVGhpcyBpcyBkYXRhIHRvIHNpZ24nCiAgICAgICAgICAgIHByaXZhdGUgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC1kc2EtMjA0OC1zaGEyLmtleScpKQogICAgICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWRzYS0yMDQ4LXNoYTIuY3J0JykpCgogICAgICAgICAgICBzaWduYXR1cmUgPSBhc3ltbWV0cmljLmRzYV9zaWduKHByaXZhdGUsIG9yaWdpbmFsX2RhdGEsICdzaGEyNTYnKQogICAgICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2Uoc2lnbmF0dXJlLCBieXRlX2NscykKCiAgICAgICAgICAgIGFzeW1tZXRyaWMuZHNhX3ZlcmlmeShwdWJsaWMsIHNpZ25hdHVyZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTI1NicpCgogICAgICAgIGlmIG5vdCBfc2hvdWxkX3N1cHBvcnRfc2hhMigpOgogICAgICAgICAgICB3aXRoIHNlbGYuYXNzZXJ0UmFpc2VzKGVycm9ycy5Bc3ltbWV0cmljS2V5RXJyb3IpOgogICAgICAgICAgICAgICAgZG9fcnVuKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBkb19ydW4oKQoKICAgIGRlZiB0ZXN0X2RzYV8zMDcyX3NpZ24oc2VsZik6CiAgICAgICAgZGVmIGRvX3J1bigpOgogICAgICAgICAgICBvcmlnaW5hbF9kYXRhID0gYidUaGlzIGlzIGRhdGEgdG8gc2lnbicKICAgICAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWRzYS5rZXknKSkKICAgICAgICAgICAgcHVibGljID0gYXN5bW1ldHJpYy5sb2FkX3B1YmxpY19rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC1kc2EuY3J0JykpCgogICAgICAgICAgICBzaWduYXR1cmUgPSBhc3ltbWV0cmljLmRzYV9zaWduKHByaXZhdGUsIG9yaWdpbmFsX2RhdGEsICdzaGEyNTYnKQogICAgICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2Uoc2lnbmF0dXJlLCBieXRlX2NscykKCiAgICAgICAgICAgIGFzeW1tZXRyaWMuZHNhX3ZlcmlmeShwdWJsaWMsIHNpZ25hdHVyZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTI1NicpCgogICAgICAgIGlmIG5vdCBfc2hvdWxkX3N1cHBvcnRfc2hhMigpOgogICAgICAgICAgICB3aXRoIHNlbGYuYXNzZXJ0UmFpc2VzKGVycm9ycy5Bc3ltbWV0cmljS2V5RXJyb3IpOgogICAgICAgICAgICAgICAgZG9fcnVuKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBkb19ydW4oKQoKICAgIGRlZiB0ZXN0X2RzYV8zMDcyX3NpZ25fc2hhMShzZWxmKToKICAgICAgICBkZWYgZG9fcnVuKCk6CiAgICAgICAgICAgIG9yaWdpbmFsX2RhdGEgPSBiJ1RoaXMgaXMgZGF0YSB0byBzaWduJwogICAgICAgICAgICBwcml2YXRlID0gYXN5bW1ldHJpYy5sb2FkX3ByaXZhdGVfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZHNhLmtleScpKQogICAgICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWRzYS5jcnQnKSkKCiAgICAgICAgICAgIHNpZ25hdHVyZSA9IGFzeW1tZXRyaWMuZHNhX3NpZ24ocHJpdmF0ZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTEnKQogICAgICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2Uoc2lnbmF0dXJlLCBieXRlX2NscykKCiAgICAgICAgICAgIGFzeW1tZXRyaWMuZHNhX3ZlcmlmeShwdWJsaWMsIHNpZ25hdHVyZSwgb3JpZ2luYWxfZGF0YSwgJ3NoYTEnKQoKICAgICAgICBpZiBfYmFja2VuZCA9PSAnbWFjJyBvciBvcGVuc3NsXzA5OCBvciBfYmFja2VuZCA9PSAnd2lubGVnYWN5JzoKICAgICAgICAgICAgd2l0aCBzZWxmLmFzc2VydFJhaXNlcyhlcnJvcnMuQXN5bW1ldHJpY0tleUVycm9yKToKICAgICAgICAgICAgICAgIGRvX3J1bigpCiAgICAgICAgZWxpZiBfYmFja2VuZCA9PSAnd2luJzoKICAgICAgICAgICAgaWYgX3dpbl92ZXJzaW9uX3BhaXIoKSA8ICg2LCAyKToKICAgICAgICAgICAgICAgIGV4Y2VwdGlvbl9jbGFzcyA9IGVycm9ycy5Bc3ltbWV0cmljS2V5RXJyb3IKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGV4Y2VwdGlvbl9jbGFzcyA9IFZhbHVlRXJyb3IKICAgICAgICAgICAgd2l0aCBzZWxmLmFzc2VydFJhaXNlcyhleGNlcHRpb25fY2xhc3MpOgogICAgICAgICAgICAgICAgZG9fcnVuKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBkb19ydW4oKQoKICAgIGRlZiB0ZXN0X2VjZHNhX3NpZ24oc2VsZik6CiAgICAgICAgb3JpZ2luYWxfZGF0YSA9IGInVGhpcyBpcyBkYXRhIHRvIHNpZ24nCiAgICAgICAgcHJpdmF0ZSA9IGFzeW1tZXRyaWMubG9hZF9wcml2YXRlX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWVjLW5hbWVkLmtleScpKQogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZWMtbmFtZWQuY3J0JykpCgogICAgICAgIHNpZ25hdHVyZSA9IGFzeW1tZXRyaWMuZWNkc2Ffc2lnbihwcml2YXRlLCBvcmlnaW5hbF9kYXRhLCAnc2hhMScpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHNpZ25hdHVyZSwgYnl0ZV9jbHMpCgogICAgICAgIGFzeW1tZXRyaWMuZWNkc2FfdmVyaWZ5KHB1YmxpYywgc2lnbmF0dXJlLCBvcmlnaW5hbF9kYXRhLCAnc2hhMScpCgogICAgZGVmIHRlc3RfZWNfZmluZ2VycHJpbnRzKHNlbGYpOgogICAgICAgIHByaXZhdGUgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC1lYy1uYW1lZC5rZXknKSkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWVjLW5hbWVkLmNydCcpKQoKICAgICAgICBzZWxmLmFzc2VydElzSW5zdGFuY2UocHJpdmF0ZS5maW5nZXJwcmludCwgYnl0ZV9jbHMpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHB1YmxpYy5maW5nZXJwcmludCwgYnl0ZV9jbHMpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChwcml2YXRlLmZpbmdlcnByaW50LCBwdWJsaWMuZmluZ2VycHJpbnQpCgogICAgZGVmIHRlc3RfZWNfcHVibGljX2tleV9hdHRyKHNlbGYpOgogICAgICAgIHByaXZhdGUgPSBhc3ltbWV0cmljLmxvYWRfcHJpdmF0ZV9rZXkob3MucGF0aC5qb2luKGZpeHR1cmVzX2RpciwgJ2tleXMvdGVzdC1lYy1uYW1lZC5rZXknKSkKICAgICAgICBwdWJsaWMgPSBhc3ltbWV0cmljLmxvYWRfcHVibGljX2tleShvcy5wYXRoLmpvaW4oZml4dHVyZXNfZGlyLCAna2V5cy90ZXN0LWVjLW5hbWVkLmNydCcpKQoKICAgICAgICBjb21wdXRlZF9wdWJsaWMgPSBwcml2YXRlLnB1YmxpY19rZXkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHB1YmxpYy5hc24xLmR1bXAoKSwgY29tcHV0ZWRfcHVibGljLmFzbjEuZHVtcCgpKQoKICAgIGRlZiB0ZXN0X2VjX3ByaXZhdGVfa2V5X3Vud3JhcChzZWxmKToKICAgICAgICBwcml2YXRlID0gYXN5bW1ldHJpYy5sb2FkX3ByaXZhdGVfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZWMtbmFtZWQua2V5JykpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHByaXZhdGUudW53cmFwKCksIGtleXMuRUNQcml2YXRlS2V5KQoKICAgIGRlZiB0ZXN0X2VjX3B1YmxpY19rZXlfdW53cmFwKHNlbGYpOgogICAgICAgIHB1YmxpYyA9IGFzeW1tZXRyaWMubG9hZF9wdWJsaWNfa2V5KG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdrZXlzL3Rlc3QtZWMtbmFtZWQuY3J0JykpCiAgICAgICAgc2VsZi5hc3NlcnRJc0luc3RhbmNlKHB1YmxpYy51bndyYXAoKSwga2V5cy5FQ1BvaW50Qml0U3RyaW5nKQoKICAgIGRlZiB0ZXN0X21hY29zX3B1YmxpY19rZXlfZXhwb3J0X2lzc3VlKHNlbGYpOgogICAgICAgICMgVGhpcyB3YXMgZmFpbGluZyBvbiBBcHBsZSBTaWxpY29uIE1hY3Mgd2l0aCBtYWNPUyAxMisKICAgICAgICBjZXJ0ID0gYXN5bW1ldHJpYy5sb2FkX2NlcnRpZmljYXRlKG9zLnBhdGguam9pbihmaXh0dXJlc19kaXIsICdtYWNvc18xMl9wdWJsaWNfa2V5X2V4cG9ydF9pc3N1ZS5jcnQnKSkKICAgICAgICBwdWJsaWMgPSBjZXJ0LnB1YmxpY19rZXkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKCdyc2EnLCBwdWJsaWMuYXNuMS5hbGdvcml0aG0pCg==
