statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/permissions.py
  contents:
  - name: Permissions
    score: 0.0
    code: |-
      @fill_with_flags()
      class Permissions(BaseFlags):
          """Wraps up the Discord permission value.

          The properties provided are two way. You can set and retrieve individual
          bits using the properties as if they were regular bools. This allows
          you to edit permissions.

          .. versionchanged:: 1.3
              You can now use keyword arguments to initialize :class:`Permissions`
              similar to :meth:`update`.

          .. container:: operations

              .. describe:: x == y

                  Checks if two permissions are equal.
              .. describe:: x != y

                  Checks if two permissions are not equal.
              .. describe:: x <= y

                  Checks if a permission is a subset of another permission.
              .. describe:: x >= y

                  Checks if a permission is a superset of another permission.
              .. describe:: x < y

                   Checks if a permission is a strict subset of another permission.
              .. describe:: x > y

                   Checks if a permission is a strict superset of another permission.
              .. describe:: hash(x)

                     Return the permission's hash.
              .. describe:: iter(x)

                     Returns an iterator of ``(perm, value)`` pairs. This allows it
                     to be, for example, constructed as a dict or a list of pairs.
                     Note that aliases are not shown.

          Attributes
          -----------
          value: :class:`int`
              The raw value. This value is a bit array field of a 53-bit integer
              representing the currently available permissions. You should query
              permissions via the properties rather than using this raw value.
          """

          __slots__ = ()

          def __init__(self, permissions=0, **kwargs):
              if not isinstance(permissions, int):
                  raise TypeError('Expected int parameter, received %s instead.' % permissions.__class__.__name__)

              self.value = permissions
              for key, value in kwargs.items():
                  if key not in self.VALID_FLAGS:
                      raise TypeError('%r is not a valid permission name.' % key)
                  setattr(self, key, value)

          def is_subset(self, other):
              """Returns ``True`` if self has the same or fewer permissions as other."""
              if isinstance(other, Permissions):
                  return (self.value & other.value) == self.value
              else:
                  raise TypeError("cannot compare {} with {}".format(self.__class__.__name__, other.__class__.__name__))

          def is_superset(self, other):
              """Returns ``True`` if self has the same or more permissions as other."""
              if isinstance(other, Permissions):
                  return (self.value | other.value) == self.value
              else:
                  raise TypeError("cannot compare {} with {}".format(self.__class__.__name__, other.__class__.__name__))

          def is_strict_subset(self, other):
              """Returns ``True`` if the permissions on other are a strict subset of those on self."""
              return self.is_subset(other) and self != other

          def is_strict_superset(self, other):
              """Returns ``True`` if the permissions on other are a strict superset of those on self."""
              return self.is_superset(other) and self != other

          __le__ = is_subset
          __ge__ = is_superset
          __lt__ = is_strict_subset
          __gt__ = is_strict_superset

          @classmethod
          def none(cls):
              """A factory method that creates a :class:`Permissions` with all
              permissions set to ``False``."""
              return cls(0)

          @classmethod
          def all(cls):
              """A factory method that creates a :class:`Permissions` with all
              permissions set to ``True``.
              """
              return cls(0b111111111111111111111111111111111)

          @classmethod
          def all_channel(cls):
              """A :class:`Permissions` with all channel-specific permissions set to
              ``True`` and the guild-specific ones set to ``False``. The guild-specific
              permissions are currently:

              - :attr:`manage_emojis`
              - :attr:`view_audit_log`
              - :attr:`view_guild_insights`
              - :attr:`manage_guild`
              - :attr:`change_nickname`
              - :attr:`manage_nicknames`
              - :attr:`kick_members`
              - :attr:`ban_members`
              - :attr:`administrator`

              .. versionchanged:: 1.7
                 Added :attr:`stream`, :attr:`priority_speaker` and :attr:`use_slash_commands` permissions.
              """
              return cls(0b10110011111101111111111101010001)

          @classmethod
          def general(cls):
              """A factory method that creates a :class:`Permissions` with all
              "General" permissions from the official Discord UI set to ``True``.

              .. versionchanged:: 1.7
                 Permission :attr:`read_messages` is now included in the general permissions, but
                 permissions :attr:`administrator`, :attr:`create_instant_invite`, :attr:`kick_members`,
                 :attr:`ban_members`, :attr:`change_nickname` and :attr:`manage_nicknames` are
                 no longer part of the general permissions.
              """
              return cls(0b01110000000010000000010010110000)

          @classmethod
          def membership(cls):
              """A factory method that creates a :class:`Permissions` with all
              "Membership" permissions from the official Discord UI set to ``True``.

              .. versionadded:: 1.7
              """
              return cls(0b00001100000000000000000000000111)

          @classmethod
          def text(cls):
              """A factory method that creates a :class:`Permissions` with all
              "Text" permissions from the official Discord UI set to ``True``.

              .. versionchanged:: 1.7
                 Permission :attr:`read_messages` is no longer part of the text permissions.
                 Added :attr:`use_slash_commands` permission.
              """
              return cls(0b10000000000001111111100001000000)

          @classmethod
          def voice(cls):
              """A factory method that creates a :class:`Permissions` with all
              "Voice" permissions from the official Discord UI set to ``True``."""
              return cls(0b00000011111100000000001100000000)

          @classmethod
          def stage(cls):
              """A factory method that creates a :class:`Permissions` with all
              "Stage Channel" permissions from the official Discord UI set to ``True``.

              .. versionadded:: 1.7
              """
              return cls(1 << 32)

          @classmethod
          def stage_moderator(cls):
              """A factory method that creates a :class:`Permissions` with all
              "Stage Moderator" permissions from the official Discord UI set to ``True``.

              .. versionadded:: 1.7
              """
              return cls(0b100000001010000000000000000000000)

          @classmethod
          def advanced(cls):
              """A factory method that creates a :class:`Permissions` with all
              "Advanced" permissions from the official Discord UI set to ``True``.

              .. versionadded:: 1.7
              """
              return cls(1 << 3)

          def update(self, **kwargs):
              r"""Bulk updates this permission object.

              Allows you to set multiple attributes by using keyword
              arguments. The names must be equivalent to the properties
              listed. Extraneous key/value pairs will be silently ignored.

              Parameters
              ------------
              \*\*kwargs
                  A list of key/value pairs to bulk update permissions with.
              """
              for key, value in kwargs.items():
                  if key in self.VALID_FLAGS:
                      setattr(self, key, value)

          def handle_overwrite(self, allow, deny):
              # Basically this is what's happening here.
              # We have an original bit array, e.g. 1010
              # Then we have another bit array that is 'denied', e.g. 1111
              # And then we have the last one which is 'allowed', e.g. 0101
              # We want original OP denied to end up resulting in
              # whatever is in denied to be set to 0.
              # So 1010 OP 1111 -> 0000
              # Then we take this value and look at the allowed values.
              # And whatever is allowed is set to 1.
              # So 0000 OP2 0101 -> 0101
              # The OP is base  & ~denied.
              # The OP2 is base | allowed.
              self.value = (self.value & ~deny) | allow

          @flag_value
          def create_instant_invite(self):
              """:class:`bool`: Returns ``True`` if the user can create instant invites."""
              return 1 << 0

          @flag_value
          def kick_members(self):
              """:class:`bool`: Returns ``True`` if the user can kick users from the guild."""
              return 1 << 1

          @flag_value
          def ban_members(self):
              """:class:`bool`: Returns ``True`` if a user can ban users from the guild."""
              return 1 << 2

          @flag_value
          def administrator(self):
              """:class:`bool`: Returns ``True`` if a user is an administrator. This role overrides all other permissions.

              This also bypasses all channel-specific overrides.
              """
              return 1 << 3

          @flag_value
          def manage_channels(self):
              """:class:`bool`: Returns ``True`` if a user can edit, delete, or create channels in the guild.

              This also corresponds to the "Manage Channel" channel-specific override."""
              return 1 << 4

          @flag_value
          def manage_guild(self):
              """:class:`bool`: Returns ``True`` if a user can edit guild properties."""
              return 1 << 5

          @flag_value
          def add_reactions(self):
              """:class:`bool`: Returns ``True`` if a user can add reactions to messages."""
              return 1 << 6

          @flag_value
          def view_audit_log(self):
              """:class:`bool`: Returns ``True`` if a user can view the guild's audit log."""
              return 1 << 7

          @flag_value
          def priority_speaker(self):
              """:class:`bool`: Returns ``True`` if a user can be more easily heard while talking."""
              return 1 << 8

          @flag_value
          def stream(self):
              """:class:`bool`: Returns ``True`` if a user can stream in a voice channel."""
              return 1 << 9

          @flag_value
          def read_messages(self):
              """:class:`bool`: Returns ``True`` if a user can read messages from all or specific text channels."""
              return 1 << 10

          @make_permission_alias('read_messages')
          def view_channel(self):
              """:class:`bool`: An alias for :attr:`read_messages`.

              .. versionadded:: 1.3
              """
              return 1 << 10

          @flag_value
          def send_messages(self):
              """:class:`bool`: Returns ``True`` if a user can send messages from all or specific text channels."""
              return 1 << 11

          @flag_value
          def send_tts_messages(self):
              """:class:`bool`: Returns ``True`` if a user can send TTS messages from all or specific text channels."""
              return 1 << 12

          @flag_value
          def manage_messages(self):
              """:class:`bool`: Returns ``True`` if a user can delete or pin messages in a text channel.

              .. note::

                  Note that there are currently no ways to edit other people's messages.
              """
              return 1 << 13

          @flag_value
          def embed_links(self):
              """:class:`bool`: Returns ``True`` if a user's messages will automatically be embedded by Discord."""
              return 1 << 14

          @flag_value
          def attach_files(self):
              """:class:`bool`: Returns ``True`` if a user can send files in their messages."""
              return 1 << 15

          @flag_value
          def read_message_history(self):
              """:class:`bool`: Returns ``True`` if a user can read a text channel's previous messages."""
              return 1 << 16

          @flag_value
          def mention_everyone(self):
              """:class:`bool`: Returns ``True`` if a user's @everyone or @here will mention everyone in the text channel."""
              return 1 << 17

          @flag_value
          def external_emojis(self):
              """:class:`bool`: Returns ``True`` if a user can use emojis from other guilds."""
              return 1 << 18

          @make_permission_alias('external_emojis')
          def use_external_emojis(self):
              """:class:`bool`: An alias for :attr:`external_emojis`.

              .. versionadded:: 1.3
              """
              return 1 << 18

          @flag_value
          def view_guild_insights(self):
              """:class:`bool`: Returns ``True`` if a user can view the guild's insights.

              .. versionadded:: 1.3
              """
              return 1 << 19

          @flag_value
          def connect(self):
              """:class:`bool`: Returns ``True`` if a user can connect to a voice channel."""
              return 1 << 20

          @flag_value
          def speak(self):
              """:class:`bool`: Returns ``True`` if a user can speak in a voice channel."""
              return 1 << 21

          @flag_value
          def mute_members(self):
              """:class:`bool`: Returns ``True`` if a user can mute other users."""
              return 1 << 22

          @flag_value
          def deafen_members(self):
              """:class:`bool`: Returns ``True`` if a user can deafen other users."""
              return 1 << 23

          @flag_value
          def move_members(self):
              """:class:`bool`: Returns ``True`` if a user can move users between other voice channels."""
              return 1 << 24

          @flag_value
          def use_voice_activation(self):
              """:class:`bool`: Returns ``True`` if a user can use voice activation in voice channels."""
              return 1 << 25

          @flag_value
          def change_nickname(self):
              """:class:`bool`: Returns ``True`` if a user can change their nickname in the guild."""
              return 1 << 26

          @flag_value
          def manage_nicknames(self):
              """:class:`bool`: Returns ``True`` if a user can change other user's nickname in the guild."""
              return 1 << 27

          @flag_value
          def manage_roles(self):
              """:class:`bool`: Returns ``True`` if a user can create or edit roles less than their role's position.

              This also corresponds to the "Manage Permissions" channel-specific override.
              """
              return 1 << 28

          @make_permission_alias('manage_roles')
          def manage_permissions(self):
              """:class:`bool`: An alias for :attr:`manage_roles`.

              .. versionadded:: 1.3
              """
              return 1 << 28

          @flag_value
          def manage_webhooks(self):
              """:class:`bool`: Returns ``True`` if a user can create, edit, or delete webhooks."""
              return 1 << 29

          @flag_value
          def manage_emojis(self):
              """:class:`bool`: Returns ``True`` if a user can create, edit, or delete emojis."""
              return 1 << 30

          @flag_value
          def use_slash_commands(self):
              """:class:`bool`: Returns ``True`` if a user can use slash commands.

              .. versionadded:: 1.7
              """
              return 1 << 31

          @flag_value
          def request_to_speak(self):
              """:class:`bool`: Returns ``True`` if a user can request to speak in a stage channel.

              .. versionadded:: 1.7
              """
              return 1 << 32
    tokens: resume load_name __name__ store_name __module__ load_const Permissions store_name __qualname__ load_const STRING_LEN_L_ENT_HIGH store_name __doc__ load_const store_name __slots__ load_const load_const OBJECT make_function defaults store_name __init__ load_const OBJECT make_function store_name is_subset load_const OBJECT make_function store_name is_superset load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_name is_subset store_name __le__ load_name is_superset store_name __ge__ load_name STRING_LEN_S_ENT_HIGH store_name __lt__ load_name STRING_LEN_S_ENT_HIGH store_name __gt__ load_name classmethod load_const OBJECT make_function call store_name none load_name classmethod load_const OBJECT make_function call store_name all load_name classmethod load_const OBJECT make_function call store_name all_channel load_name classmethod load_const OBJECT make_function call store_name general load_name classmethod load_const OBJECT make_function call store_name membership load_name classmethod load_const OBJECT make_function call store_name text load_name classmethod load_const OBJECT make_function call store_name voice load_name classmethod load_const OBJECT make_function call store_name stage load_name classmethod load_const OBJECT make_function call store_name stage_moderator load_name classmethod load_const OBJECT make_function call store_name advanced load_const OBJECT make_function store_name update load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name kick_members load_name flag_value load_const OBJECT make_function call store_name ban_members load_name flag_value load_const OBJECT make_function call store_name administrator load_name flag_value load_const OBJECT make_function call store_name manage_channels load_name flag_value load_const OBJECT make_function call store_name manage_guild load_name flag_value load_const OBJECT make_function call store_name add_reactions load_name flag_value load_const OBJECT make_function call store_name view_audit_log load_name flag_value load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name stream load_name flag_value load_const OBJECT make_function call store_name read_messages push_null load_name STRING_LEN_S_ENT_HIGH load_const read_messages call load_const OBJECT make_function call store_name view_channel load_name flag_value load_const OBJECT make_function call store_name send_messages load_name flag_value load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name manage_messages load_name flag_value load_const OBJECT make_function call store_name embed_links load_name flag_value load_const OBJECT make_function call store_name attach_files load_name flag_value load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name external_emojis push_null load_name STRING_LEN_S_ENT_HIGH load_const external_emojis call load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name connect load_name flag_value load_const OBJECT make_function call store_name speak load_name flag_value load_const OBJECT make_function call store_name mute_members load_name flag_value load_const OBJECT make_function call store_name deafen_members load_name flag_value load_const OBJECT make_function call store_name move_members load_name flag_value load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name change_nickname load_name flag_value load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name manage_roles push_null load_name STRING_LEN_S_ENT_HIGH load_const manage_roles call load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name manage_webhooks load_name flag_value load_const OBJECT make_function call store_name manage_emojis load_name flag_value load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_name flag_value load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH return_const None
    hash: de67170c2f639130d7e54858413883321af15ed68fcf1e47ef681e79407fee38
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/permissions.py
  : IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KCiIiIgpUaGUgTUlUIExpY2Vuc2UgKE1JVCkKCkNvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50IFJhcHB0egoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgp0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlClNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCk9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwpGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSCkRFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KIiIiCgpmcm9tIC5mbGFncyBpbXBvcnQgQmFzZUZsYWdzLCBmbGFnX3ZhbHVlLCBmaWxsX3dpdGhfZmxhZ3MsIGFsaWFzX2ZsYWdfdmFsdWUKCl9fYWxsX18gPSAoCiAgICAnUGVybWlzc2lvbnMnLAogICAgJ1Blcm1pc3Npb25PdmVyd3JpdGUnLAopCgojIEEgcGVybWlzc2lvbiBhbGlhcyB3b3JrcyBsaWtlIGEgcmVndWxhciBmbGFnIGJ1dCBpcyBtYXJrZWQKIyBTbyB0aGUgUGVybWlzc2lvbk92ZXJ3cml0ZSBrbm93cyB0byB3b3JrIHdpdGggaXQKY2xhc3MgcGVybWlzc2lvbl9hbGlhcyhhbGlhc19mbGFnX3ZhbHVlKToKICAgIHBhc3MKCmRlZiBtYWtlX3Blcm1pc3Npb25fYWxpYXMoYWxpYXMpOgogICAgZGVmIGRlY29yYXRvcihmdW5jKToKICAgICAgICByZXQgPSBwZXJtaXNzaW9uX2FsaWFzKGZ1bmMpCiAgICAgICAgcmV0LmFsaWFzID0gYWxpYXMKICAgICAgICByZXR1cm4gcmV0CiAgICByZXR1cm4gZGVjb3JhdG9yCgpAZmlsbF93aXRoX2ZsYWdzKCkKY2xhc3MgUGVybWlzc2lvbnMoQmFzZUZsYWdzKToKICAgICIiIldyYXBzIHVwIHRoZSBEaXNjb3JkIHBlcm1pc3Npb24gdmFsdWUuCgogICAgVGhlIHByb3BlcnRpZXMgcHJvdmlkZWQgYXJlIHR3byB3YXkuIFlvdSBjYW4gc2V0IGFuZCByZXRyaWV2ZSBpbmRpdmlkdWFsCiAgICBiaXRzIHVzaW5nIHRoZSBwcm9wZXJ0aWVzIGFzIGlmIHRoZXkgd2VyZSByZWd1bGFyIGJvb2xzLiBUaGlzIGFsbG93cwogICAgeW91IHRvIGVkaXQgcGVybWlzc2lvbnMuCgogICAgLi4gdmVyc2lvbmNoYW5nZWQ6OiAxLjMKICAgICAgICBZb3UgY2FuIG5vdyB1c2Uga2V5d29yZCBhcmd1bWVudHMgdG8gaW5pdGlhbGl6ZSA6Y2xhc3M6YFBlcm1pc3Npb25zYAogICAgICAgIHNpbWlsYXIgdG8gOm1ldGg6YHVwZGF0ZWAuCgogICAgLi4gY29udGFpbmVyOjogb3BlcmF0aW9ucwoKICAgICAgICAuLiBkZXNjcmliZTo6IHggPT0geQoKICAgICAgICAgICAgQ2hlY2tzIGlmIHR3byBwZXJtaXNzaW9ucyBhcmUgZXF1YWwuCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4ICE9IHkKCiAgICAgICAgICAgIENoZWNrcyBpZiB0d28gcGVybWlzc2lvbnMgYXJlIG5vdCBlcXVhbC4KICAgICAgICAuLiBkZXNjcmliZTo6IHggPD0geQoKICAgICAgICAgICAgQ2hlY2tzIGlmIGEgcGVybWlzc2lvbiBpcyBhIHN1YnNldCBvZiBhbm90aGVyIHBlcm1pc3Npb24uCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4ID49IHkKCiAgICAgICAgICAgIENoZWNrcyBpZiBhIHBlcm1pc3Npb24gaXMgYSBzdXBlcnNldCBvZiBhbm90aGVyIHBlcm1pc3Npb24uCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4IDwgeQoKICAgICAgICAgICAgIENoZWNrcyBpZiBhIHBlcm1pc3Npb24gaXMgYSBzdHJpY3Qgc3Vic2V0IG9mIGFub3RoZXIgcGVybWlzc2lvbi4KICAgICAgICAuLiBkZXNjcmliZTo6IHggPiB5CgogICAgICAgICAgICAgQ2hlY2tzIGlmIGEgcGVybWlzc2lvbiBpcyBhIHN0cmljdCBzdXBlcnNldCBvZiBhbm90aGVyIHBlcm1pc3Npb24uCiAgICAgICAgLi4gZGVzY3JpYmU6OiBoYXNoKHgpCgogICAgICAgICAgICAgICBSZXR1cm4gdGhlIHBlcm1pc3Npb24ncyBoYXNoLgogICAgICAgIC4uIGRlc2NyaWJlOjogaXRlcih4KQoKICAgICAgICAgICAgICAgUmV0dXJucyBhbiBpdGVyYXRvciBvZiBgYChwZXJtLCB2YWx1ZSlgYCBwYWlycy4gVGhpcyBhbGxvd3MgaXQKICAgICAgICAgICAgICAgdG8gYmUsIGZvciBleGFtcGxlLCBjb25zdHJ1Y3RlZCBhcyBhIGRpY3Qgb3IgYSBsaXN0IG9mIHBhaXJzLgogICAgICAgICAgICAgICBOb3RlIHRoYXQgYWxpYXNlcyBhcmUgbm90IHNob3duLgoKICAgIEF0dHJpYnV0ZXMKICAgIC0tLS0tLS0tLS0tCiAgICB2YWx1ZTogOmNsYXNzOmBpbnRgCiAgICAgICAgVGhlIHJhdyB2YWx1ZS4gVGhpcyB2YWx1ZSBpcyBhIGJpdCBhcnJheSBmaWVsZCBvZiBhIDUzLWJpdCBpbnRlZ2VyCiAgICAgICAgcmVwcmVzZW50aW5nIHRoZSBjdXJyZW50bHkgYXZhaWxhYmxlIHBlcm1pc3Npb25zLiBZb3Ugc2hvdWxkIHF1ZXJ5CiAgICAgICAgcGVybWlzc2lvbnMgdmlhIHRoZSBwcm9wZXJ0aWVzIHJhdGhlciB0aGFuIHVzaW5nIHRoaXMgcmF3IHZhbHVlLgogICAgIiIiCgogICAgX19zbG90c19fID0gKCkKCiAgICBkZWYgX19pbml0X18oc2VsZiwgcGVybWlzc2lvbnM9MCwgKiprd2FyZ3MpOgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHBlcm1pc3Npb25zLCBpbnQpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ0V4cGVjdGVkIGludCBwYXJhbWV0ZXIsIHJlY2VpdmVkICVzIGluc3RlYWQuJyAlIHBlcm1pc3Npb25zLl9fY2xhc3NfXy5fX25hbWVfXykKCiAgICAgICAgc2VsZi52YWx1ZSA9IHBlcm1pc3Npb25zCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4ga3dhcmdzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIGtleSBub3QgaW4gc2VsZi5WQUxJRF9GTEFHUzoKICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcignJXIgaXMgbm90IGEgdmFsaWQgcGVybWlzc2lvbiBuYW1lLicgJSBrZXkpCiAgICAgICAgICAgIHNldGF0dHIoc2VsZiwga2V5LCB2YWx1ZSkKCiAgICBkZWYgaXNfc3Vic2V0KHNlbGYsIG90aGVyKToKICAgICAgICAiIiJSZXR1cm5zIGBgVHJ1ZWBgIGlmIHNlbGYgaGFzIHRoZSBzYW1lIG9yIGZld2VyIHBlcm1pc3Npb25zIGFzIG90aGVyLiIiIgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFBlcm1pc3Npb25zKToKICAgICAgICAgICAgcmV0dXJuIChzZWxmLnZhbHVlICYgb3RoZXIudmFsdWUpID09IHNlbGYudmFsdWUKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoImNhbm5vdCBjb21wYXJlIHt9IHdpdGgge30iLmZvcm1hdChzZWxmLl9fY2xhc3NfXy5fX25hbWVfXywgb3RoZXIuX19jbGFzc19fLl9fbmFtZV9fKSkKCiAgICBkZWYgaXNfc3VwZXJzZXQoc2VsZiwgb3RoZXIpOgogICAgICAgICIiIlJldHVybnMgYGBUcnVlYGAgaWYgc2VsZiBoYXMgdGhlIHNhbWUgb3IgbW9yZSBwZXJtaXNzaW9ucyBhcyBvdGhlci4iIiIKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBQZXJtaXNzaW9ucyk6CiAgICAgICAgICAgIHJldHVybiAoc2VsZi52YWx1ZSB8IG90aGVyLnZhbHVlKSA9PSBzZWxmLnZhbHVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJjYW5ub3QgY29tcGFyZSB7fSB3aXRoIHt9Ii5mb3JtYXQoc2VsZi5fX2NsYXNzX18uX19uYW1lX18sIG90aGVyLl9fY2xhc3NfXy5fX25hbWVfXykpCgogICAgZGVmIGlzX3N0cmljdF9zdWJzZXQoc2VsZiwgb3RoZXIpOgogICAgICAgICIiIlJldHVybnMgYGBUcnVlYGAgaWYgdGhlIHBlcm1pc3Npb25zIG9uIG90aGVyIGFyZSBhIHN0cmljdCBzdWJzZXQgb2YgdGhvc2Ugb24gc2VsZi4iIiIKICAgICAgICByZXR1cm4gc2VsZi5pc19zdWJzZXQob3RoZXIpIGFuZCBzZWxmICE9IG90aGVyCgogICAgZGVmIGlzX3N0cmljdF9zdXBlcnNldChzZWxmLCBvdGhlcik6CiAgICAgICAgIiIiUmV0dXJucyBgYFRydWVgYCBpZiB0aGUgcGVybWlzc2lvbnMgb24gb3RoZXIgYXJlIGEgc3RyaWN0IHN1cGVyc2V0IG9mIHRob3NlIG9uIHNlbGYuIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuaXNfc3VwZXJzZXQob3RoZXIpIGFuZCBzZWxmICE9IG90aGVyCgogICAgX19sZV9fID0gaXNfc3Vic2V0CiAgICBfX2dlX18gPSBpc19zdXBlcnNldAogICAgX19sdF9fID0gaXNfc3RyaWN0X3N1YnNldAogICAgX19ndF9fID0gaXNfc3RyaWN0X3N1cGVyc2V0CgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgbm9uZShjbHMpOgogICAgICAgICIiIkEgZmFjdG9yeSBtZXRob2QgdGhhdCBjcmVhdGVzIGEgOmNsYXNzOmBQZXJtaXNzaW9uc2Agd2l0aCBhbGwKICAgICAgICBwZXJtaXNzaW9ucyBzZXQgdG8gYGBGYWxzZWBgLiIiIgogICAgICAgIHJldHVybiBjbHMoMCkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBhbGwoY2xzKToKICAgICAgICAiIiJBIGZhY3RvcnkgbWV0aG9kIHRoYXQgY3JlYXRlcyBhIDpjbGFzczpgUGVybWlzc2lvbnNgIHdpdGggYWxsCiAgICAgICAgcGVybWlzc2lvbnMgc2V0IHRvIGBgVHJ1ZWBgLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBjbHMoMGIxMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgYWxsX2NoYW5uZWwoY2xzKToKICAgICAgICAiIiJBIDpjbGFzczpgUGVybWlzc2lvbnNgIHdpdGggYWxsIGNoYW5uZWwtc3BlY2lmaWMgcGVybWlzc2lvbnMgc2V0IHRvCiAgICAgICAgYGBUcnVlYGAgYW5kIHRoZSBndWlsZC1zcGVjaWZpYyBvbmVzIHNldCB0byBgYEZhbHNlYGAuIFRoZSBndWlsZC1zcGVjaWZpYwogICAgICAgIHBlcm1pc3Npb25zIGFyZSBjdXJyZW50bHk6CgogICAgICAgIC0gOmF0dHI6YG1hbmFnZV9lbW9qaXNgCiAgICAgICAgLSA6YXR0cjpgdmlld19hdWRpdF9sb2dgCiAgICAgICAgLSA6YXR0cjpgdmlld19ndWlsZF9pbnNpZ2h0c2AKICAgICAgICAtIDphdHRyOmBtYW5hZ2VfZ3VpbGRgCiAgICAgICAgLSA6YXR0cjpgY2hhbmdlX25pY2tuYW1lYAogICAgICAgIC0gOmF0dHI6YG1hbmFnZV9uaWNrbmFtZXNgCiAgICAgICAgLSA6YXR0cjpga2lja19tZW1iZXJzYAogICAgICAgIC0gOmF0dHI6YGJhbl9tZW1iZXJzYAogICAgICAgIC0gOmF0dHI6YGFkbWluaXN0cmF0b3JgCgogICAgICAgIC4uIHZlcnNpb25jaGFuZ2VkOjogMS43CiAgICAgICAgICAgQWRkZWQgOmF0dHI6YHN0cmVhbWAsIDphdHRyOmBwcmlvcml0eV9zcGVha2VyYCBhbmQgOmF0dHI6YHVzZV9zbGFzaF9jb21tYW5kc2AgcGVybWlzc2lvbnMuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGNscygwYjEwMTEwMDExMTExMTAxMTExMTExMTExMTAxMDEwMDAxKQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIGdlbmVyYWwoY2xzKToKICAgICAgICAiIiJBIGZhY3RvcnkgbWV0aG9kIHRoYXQgY3JlYXRlcyBhIDpjbGFzczpgUGVybWlzc2lvbnNgIHdpdGggYWxsCiAgICAgICAgIkdlbmVyYWwiIHBlcm1pc3Npb25zIGZyb20gdGhlIG9mZmljaWFsIERpc2NvcmQgVUkgc2V0IHRvIGBgVHJ1ZWBgLgoKICAgICAgICAuLiB2ZXJzaW9uY2hhbmdlZDo6IDEuNwogICAgICAgICAgIFBlcm1pc3Npb24gOmF0dHI6YHJlYWRfbWVzc2FnZXNgIGlzIG5vdyBpbmNsdWRlZCBpbiB0aGUgZ2VuZXJhbCBwZXJtaXNzaW9ucywgYnV0CiAgICAgICAgICAgcGVybWlzc2lvbnMgOmF0dHI6YGFkbWluaXN0cmF0b3JgLCA6YXR0cjpgY3JlYXRlX2luc3RhbnRfaW52aXRlYCwgOmF0dHI6YGtpY2tfbWVtYmVyc2AsCiAgICAgICAgICAgOmF0dHI6YGJhbl9tZW1iZXJzYCwgOmF0dHI6YGNoYW5nZV9uaWNrbmFtZWAgYW5kIDphdHRyOmBtYW5hZ2Vfbmlja25hbWVzYCBhcmUKICAgICAgICAgICBubyBsb25nZXIgcGFydCBvZiB0aGUgZ2VuZXJhbCBwZXJtaXNzaW9ucy4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gY2xzKDBiMDExMTAwMDAwMDAwMTAwMDAwMDAwMTAwMTAxMTAwMDApCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgbWVtYmVyc2hpcChjbHMpOgogICAgICAgICIiIkEgZmFjdG9yeSBtZXRob2QgdGhhdCBjcmVhdGVzIGEgOmNsYXNzOmBQZXJtaXNzaW9uc2Agd2l0aCBhbGwKICAgICAgICAiTWVtYmVyc2hpcCIgcGVybWlzc2lvbnMgZnJvbSB0aGUgb2ZmaWNpYWwgRGlzY29yZCBVSSBzZXQgdG8gYGBUcnVlYGAuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNwogICAgICAgICIiIgogICAgICAgIHJldHVybiBjbHMoMGIwMDAwMTEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDExMSkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiB0ZXh0KGNscyk6CiAgICAgICAgIiIiQSBmYWN0b3J5IG1ldGhvZCB0aGF0IGNyZWF0ZXMgYSA6Y2xhc3M6YFBlcm1pc3Npb25zYCB3aXRoIGFsbAogICAgICAgICJUZXh0IiBwZXJtaXNzaW9ucyBmcm9tIHRoZSBvZmZpY2lhbCBEaXNjb3JkIFVJIHNldCB0byBgYFRydWVgYC4KCiAgICAgICAgLi4gdmVyc2lvbmNoYW5nZWQ6OiAxLjcKICAgICAgICAgICBQZXJtaXNzaW9uIDphdHRyOmByZWFkX21lc3NhZ2VzYCBpcyBubyBsb25nZXIgcGFydCBvZiB0aGUgdGV4dCBwZXJtaXNzaW9ucy4KICAgICAgICAgICBBZGRlZCA6YXR0cjpgdXNlX3NsYXNoX2NvbW1hbmRzYCBwZXJtaXNzaW9uLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBjbHMoMGIxMDAwMDAwMDAwMDAwMTExMTExMTEwMDAwMTAwMDAwMCkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiB2b2ljZShjbHMpOgogICAgICAgICIiIkEgZmFjdG9yeSBtZXRob2QgdGhhdCBjcmVhdGVzIGEgOmNsYXNzOmBQZXJtaXNzaW9uc2Agd2l0aCBhbGwKICAgICAgICAiVm9pY2UiIHBlcm1pc3Npb25zIGZyb20gdGhlIG9mZmljaWFsIERpc2NvcmQgVUkgc2V0IHRvIGBgVHJ1ZWBgLiIiIgogICAgICAgIHJldHVybiBjbHMoMGIwMDAwMDAxMTExMTEwMDAwMDAwMDAwMTEwMDAwMDAwMCkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBzdGFnZShjbHMpOgogICAgICAgICIiIkEgZmFjdG9yeSBtZXRob2QgdGhhdCBjcmVhdGVzIGEgOmNsYXNzOmBQZXJtaXNzaW9uc2Agd2l0aCBhbGwKICAgICAgICAiU3RhZ2UgQ2hhbm5lbCIgcGVybWlzc2lvbnMgZnJvbSB0aGUgb2ZmaWNpYWwgRGlzY29yZCBVSSBzZXQgdG8gYGBUcnVlYGAuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNwogICAgICAgICIiIgogICAgICAgIHJldHVybiBjbHMoMSA8PCAzMikKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBzdGFnZV9tb2RlcmF0b3IoY2xzKToKICAgICAgICAiIiJBIGZhY3RvcnkgbWV0aG9kIHRoYXQgY3JlYXRlcyBhIDpjbGFzczpgUGVybWlzc2lvbnNgIHdpdGggYWxsCiAgICAgICAgIlN0YWdlIE1vZGVyYXRvciIgcGVybWlzc2lvbnMgZnJvbSB0aGUgb2ZmaWNpYWwgRGlzY29yZCBVSSBzZXQgdG8gYGBUcnVlYGAuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNwogICAgICAgICIiIgogICAgICAgIHJldHVybiBjbHMoMGIxMDAwMDAwMDEwMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDApCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgYWR2YW5jZWQoY2xzKToKICAgICAgICAiIiJBIGZhY3RvcnkgbWV0aG9kIHRoYXQgY3JlYXRlcyBhIDpjbGFzczpgUGVybWlzc2lvbnNgIHdpdGggYWxsCiAgICAgICAgIkFkdmFuY2VkIiBwZXJtaXNzaW9ucyBmcm9tIHRoZSBvZmZpY2lhbCBEaXNjb3JkIFVJIHNldCB0byBgYFRydWVgYC4KCiAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS43CiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGNscygxIDw8IDMpCgogICAgZGVmIHVwZGF0ZShzZWxmLCAqKmt3YXJncyk6CiAgICAgICAgciIiIkJ1bGsgdXBkYXRlcyB0aGlzIHBlcm1pc3Npb24gb2JqZWN0LgoKICAgICAgICBBbGxvd3MgeW91IHRvIHNldCBtdWx0aXBsZSBhdHRyaWJ1dGVzIGJ5IHVzaW5nIGtleXdvcmQKICAgICAgICBhcmd1bWVudHMuIFRoZSBuYW1lcyBtdXN0IGJlIGVxdWl2YWxlbnQgdG8gdGhlIHByb3BlcnRpZXMKICAgICAgICBsaXN0ZWQuIEV4dHJhbmVvdXMga2V5L3ZhbHVlIHBhaXJzIHdpbGwgYmUgc2lsZW50bHkgaWdub3JlZC4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tLQogICAgICAgIFwqXCprd2FyZ3MKICAgICAgICAgICAgQSBsaXN0IG9mIGtleS92YWx1ZSBwYWlycyB0byBidWxrIHVwZGF0ZSBwZXJtaXNzaW9ucyB3aXRoLgogICAgICAgICIiIgogICAgICAgIGZvciBrZXksIHZhbHVlIGluIGt3YXJncy5pdGVtcygpOgogICAgICAgICAgICBpZiBrZXkgaW4gc2VsZi5WQUxJRF9GTEFHUzoKICAgICAgICAgICAgICAgIHNldGF0dHIoc2VsZiwga2V5LCB2YWx1ZSkKCiAgICBkZWYgaGFuZGxlX292ZXJ3cml0ZShzZWxmLCBhbGxvdywgZGVueSk6CiAgICAgICAgIyBCYXNpY2FsbHkgdGhpcyBpcyB3aGF0J3MgaGFwcGVuaW5nIGhlcmUuCiAgICAgICAgIyBXZSBoYXZlIGFuIG9yaWdpbmFsIGJpdCBhcnJheSwgZS5nLiAxMDEwCiAgICAgICAgIyBUaGVuIHdlIGhhdmUgYW5vdGhlciBiaXQgYXJyYXkgdGhhdCBpcyAnZGVuaWVkJywgZS5nLiAxMTExCiAgICAgICAgIyBBbmQgdGhlbiB3ZSBoYXZlIHRoZSBsYXN0IG9uZSB3aGljaCBpcyAnYWxsb3dlZCcsIGUuZy4gMDEwMQogICAgICAgICMgV2Ugd2FudCBvcmlnaW5hbCBPUCBkZW5pZWQgdG8gZW5kIHVwIHJlc3VsdGluZyBpbgogICAgICAgICMgd2hhdGV2ZXIgaXMgaW4gZGVuaWVkIHRvIGJlIHNldCB0byAwLgogICAgICAgICMgU28gMTAxMCBPUCAxMTExIC0+IDAwMDAKICAgICAgICAjIFRoZW4gd2UgdGFrZSB0aGlzIHZhbHVlIGFuZCBsb29rIGF0IHRoZSBhbGxvd2VkIHZhbHVlcy4KICAgICAgICAjIEFuZCB3aGF0ZXZlciBpcyBhbGxvd2VkIGlzIHNldCB0byAxLgogICAgICAgICMgU28gMDAwMCBPUDIgMDEwMSAtPiAwMTAxCiAgICAgICAgIyBUaGUgT1AgaXMgYmFzZSAgJiB+ZGVuaWVkLgogICAgICAgICMgVGhlIE9QMiBpcyBiYXNlIHwgYWxsb3dlZC4KICAgICAgICBzZWxmLnZhbHVlID0gKHNlbGYudmFsdWUgJiB+ZGVueSkgfCBhbGxvdwoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYgY3JlYXRlX2luc3RhbnRfaW52aXRlKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgdGhlIHVzZXIgY2FuIGNyZWF0ZSBpbnN0YW50IGludml0ZXMuIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMAoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYga2lja19tZW1iZXJzKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgdGhlIHVzZXIgY2FuIGtpY2sgdXNlcnMgZnJvbSB0aGUgZ3VpbGQuIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMQoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYgYmFuX21lbWJlcnMoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIGJhbiB1c2VycyBmcm9tIHRoZSBndWlsZC4iIiIKICAgICAgICByZXR1cm4gMSA8PCAyCgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiBhZG1pbmlzdHJhdG9yKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyIGlzIGFuIGFkbWluaXN0cmF0b3IuIFRoaXMgcm9sZSBvdmVycmlkZXMgYWxsIG90aGVyIHBlcm1pc3Npb25zLgoKICAgICAgICBUaGlzIGFsc28gYnlwYXNzZXMgYWxsIGNoYW5uZWwtc3BlY2lmaWMgb3ZlcnJpZGVzLgogICAgICAgICIiIgogICAgICAgIHJldHVybiAxIDw8IDMKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIG1hbmFnZV9jaGFubmVscyhzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGJvb2xgOiBSZXR1cm5zIGBgVHJ1ZWBgIGlmIGEgdXNlciBjYW4gZWRpdCwgZGVsZXRlLCBvciBjcmVhdGUgY2hhbm5lbHMgaW4gdGhlIGd1aWxkLgoKICAgICAgICBUaGlzIGFsc28gY29ycmVzcG9uZHMgdG8gdGhlICJNYW5hZ2UgQ2hhbm5lbCIgY2hhbm5lbC1zcGVjaWZpYyBvdmVycmlkZS4iIiIKICAgICAgICByZXR1cm4gMSA8PCA0CgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiBtYW5hZ2VfZ3VpbGQoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIGVkaXQgZ3VpbGQgcHJvcGVydGllcy4iIiIKICAgICAgICByZXR1cm4gMSA8PCA1CgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiBhZGRfcmVhY3Rpb25zKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyIGNhbiBhZGQgcmVhY3Rpb25zIHRvIG1lc3NhZ2VzLiIiIgogICAgICAgIHJldHVybiAxIDw8IDYKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIHZpZXdfYXVkaXRfbG9nKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyIGNhbiB2aWV3IHRoZSBndWlsZCdzIGF1ZGl0IGxvZy4iIiIKICAgICAgICByZXR1cm4gMSA8PCA3CgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiBwcmlvcml0eV9zcGVha2VyKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyIGNhbiBiZSBtb3JlIGVhc2lseSBoZWFyZCB3aGlsZSB0YWxraW5nLiIiIgogICAgICAgIHJldHVybiAxIDw8IDgKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIHN0cmVhbShzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGJvb2xgOiBSZXR1cm5zIGBgVHJ1ZWBgIGlmIGEgdXNlciBjYW4gc3RyZWFtIGluIGEgdm9pY2UgY2hhbm5lbC4iIiIKICAgICAgICByZXR1cm4gMSA8PCA5CgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiByZWFkX21lc3NhZ2VzKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyIGNhbiByZWFkIG1lc3NhZ2VzIGZyb20gYWxsIG9yIHNwZWNpZmljIHRleHQgY2hhbm5lbHMuIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMTAKCiAgICBAbWFrZV9wZXJtaXNzaW9uX2FsaWFzKCdyZWFkX21lc3NhZ2VzJykKICAgIGRlZiB2aWV3X2NoYW5uZWwoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogQW4gYWxpYXMgZm9yIDphdHRyOmByZWFkX21lc3NhZ2VzYC4KCiAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS4zCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMTAKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIHNlbmRfbWVzc2FnZXMoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIHNlbmQgbWVzc2FnZXMgZnJvbSBhbGwgb3Igc3BlY2lmaWMgdGV4dCBjaGFubmVscy4iIiIKICAgICAgICByZXR1cm4gMSA8PCAxMQoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYgc2VuZF90dHNfbWVzc2FnZXMoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIHNlbmQgVFRTIG1lc3NhZ2VzIGZyb20gYWxsIG9yIHNwZWNpZmljIHRleHQgY2hhbm5lbHMuIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMTIKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIG1hbmFnZV9tZXNzYWdlcyhzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGJvb2xgOiBSZXR1cm5zIGBgVHJ1ZWBgIGlmIGEgdXNlciBjYW4gZGVsZXRlIG9yIHBpbiBtZXNzYWdlcyBpbiBhIHRleHQgY2hhbm5lbC4KCiAgICAgICAgLi4gbm90ZTo6CgogICAgICAgICAgICBOb3RlIHRoYXQgdGhlcmUgYXJlIGN1cnJlbnRseSBubyB3YXlzIHRvIGVkaXQgb3RoZXIgcGVvcGxlJ3MgbWVzc2FnZXMuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMTMKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIGVtYmVkX2xpbmtzKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyJ3MgbWVzc2FnZXMgd2lsbCBhdXRvbWF0aWNhbGx5IGJlIGVtYmVkZGVkIGJ5IERpc2NvcmQuIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMTQKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIGF0dGFjaF9maWxlcyhzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGJvb2xgOiBSZXR1cm5zIGBgVHJ1ZWBgIGlmIGEgdXNlciBjYW4gc2VuZCBmaWxlcyBpbiB0aGVpciBtZXNzYWdlcy4iIiIKICAgICAgICByZXR1cm4gMSA8PCAxNQoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYgcmVhZF9tZXNzYWdlX2hpc3Rvcnkoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIHJlYWQgYSB0ZXh0IGNoYW5uZWwncyBwcmV2aW91cyBtZXNzYWdlcy4iIiIKICAgICAgICByZXR1cm4gMSA8PCAxNgoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYgbWVudGlvbl9ldmVyeW9uZShzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGJvb2xgOiBSZXR1cm5zIGBgVHJ1ZWBgIGlmIGEgdXNlcidzIEBldmVyeW9uZSBvciBAaGVyZSB3aWxsIG1lbnRpb24gZXZlcnlvbmUgaW4gdGhlIHRleHQgY2hhbm5lbC4iIiIKICAgICAgICByZXR1cm4gMSA8PCAxNwoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYgZXh0ZXJuYWxfZW1vamlzKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyIGNhbiB1c2UgZW1vamlzIGZyb20gb3RoZXIgZ3VpbGRzLiIiIgogICAgICAgIHJldHVybiAxIDw8IDE4CgogICAgQG1ha2VfcGVybWlzc2lvbl9hbGlhcygnZXh0ZXJuYWxfZW1vamlzJykKICAgIGRlZiB1c2VfZXh0ZXJuYWxfZW1vamlzKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IEFuIGFsaWFzIGZvciA6YXR0cjpgZXh0ZXJuYWxfZW1vamlzYC4KCiAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS4zCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMTgKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIHZpZXdfZ3VpbGRfaW5zaWdodHMoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIHZpZXcgdGhlIGd1aWxkJ3MgaW5zaWdodHMuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuMwogICAgICAgICIiIgogICAgICAgIHJldHVybiAxIDw8IDE5CgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiBjb25uZWN0KHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyIGNhbiBjb25uZWN0IHRvIGEgdm9pY2UgY2hhbm5lbC4iIiIKICAgICAgICByZXR1cm4gMSA8PCAyMAoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYgc3BlYWsoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIHNwZWFrIGluIGEgdm9pY2UgY2hhbm5lbC4iIiIKICAgICAgICByZXR1cm4gMSA8PCAyMQoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYgbXV0ZV9tZW1iZXJzKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyIGNhbiBtdXRlIG90aGVyIHVzZXJzLiIiIgogICAgICAgIHJldHVybiAxIDw8IDIyCgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiBkZWFmZW5fbWVtYmVycyhzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGJvb2xgOiBSZXR1cm5zIGBgVHJ1ZWBgIGlmIGEgdXNlciBjYW4gZGVhZmVuIG90aGVyIHVzZXJzLiIiIgogICAgICAgIHJldHVybiAxIDw8IDIzCgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiBtb3ZlX21lbWJlcnMoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIG1vdmUgdXNlcnMgYmV0d2VlbiBvdGhlciB2b2ljZSBjaGFubmVscy4iIiIKICAgICAgICByZXR1cm4gMSA8PCAyNAoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYgdXNlX3ZvaWNlX2FjdGl2YXRpb24oc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIHVzZSB2b2ljZSBhY3RpdmF0aW9uIGluIHZvaWNlIGNoYW5uZWxzLiIiIgogICAgICAgIHJldHVybiAxIDw8IDI1CgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiBjaGFuZ2Vfbmlja25hbWUoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIGNoYW5nZSB0aGVpciBuaWNrbmFtZSBpbiB0aGUgZ3VpbGQuIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMjYKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIG1hbmFnZV9uaWNrbmFtZXMoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIGNoYW5nZSBvdGhlciB1c2VyJ3Mgbmlja25hbWUgaW4gdGhlIGd1aWxkLiIiIgogICAgICAgIHJldHVybiAxIDw8IDI3CgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiBtYW5hZ2Vfcm9sZXMoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIGNyZWF0ZSBvciBlZGl0IHJvbGVzIGxlc3MgdGhhbiB0aGVpciByb2xlJ3MgcG9zaXRpb24uCgogICAgICAgIFRoaXMgYWxzbyBjb3JyZXNwb25kcyB0byB0aGUgIk1hbmFnZSBQZXJtaXNzaW9ucyIgY2hhbm5lbC1zcGVjaWZpYyBvdmVycmlkZS4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gMSA8PCAyOAoKICAgIEBtYWtlX3Blcm1pc3Npb25fYWxpYXMoJ21hbmFnZV9yb2xlcycpCiAgICBkZWYgbWFuYWdlX3Blcm1pc3Npb25zKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IEFuIGFsaWFzIGZvciA6YXR0cjpgbWFuYWdlX3JvbGVzYC4KCiAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS4zCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMjgKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIG1hbmFnZV93ZWJob29rcyhzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGJvb2xgOiBSZXR1cm5zIGBgVHJ1ZWBgIGlmIGEgdXNlciBjYW4gY3JlYXRlLCBlZGl0LCBvciBkZWxldGUgd2ViaG9va3MuIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMjkKCiAgICBAZmxhZ192YWx1ZQogICAgZGVmIG1hbmFnZV9lbW9qaXMoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogUmV0dXJucyBgYFRydWVgYCBpZiBhIHVzZXIgY2FuIGNyZWF0ZSwgZWRpdCwgb3IgZGVsZXRlIGVtb2ppcy4iIiIKICAgICAgICByZXR1cm4gMSA8PCAzMAoKICAgIEBmbGFnX3ZhbHVlCiAgICBkZWYgdXNlX3NsYXNoX2NvbW1hbmRzKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyIGNhbiB1c2Ugc2xhc2ggY29tbWFuZHMuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNwogICAgICAgICIiIgogICAgICAgIHJldHVybiAxIDw8IDMxCgogICAgQGZsYWdfdmFsdWUKICAgIGRlZiByZXF1ZXN0X3RvX3NwZWFrKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFJldHVybnMgYGBUcnVlYGAgaWYgYSB1c2VyIGNhbiByZXF1ZXN0IHRvIHNwZWFrIGluIGEgc3RhZ2UgY2hhbm5lbC4KCiAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS43CiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIDEgPDwgMzIKCmRlZiBhdWdtZW50X2Zyb21fcGVybWlzc2lvbnMoY2xzKToKICAgIGNscy5WQUxJRF9OQU1FUyA9IHNldChQZXJtaXNzaW9ucy5WQUxJRF9GTEFHUykKICAgIGFsaWFzZXMgPSBzZXQoKQoKICAgICMgbWFrZSBkZXNjcmlwdG9ycyBmb3IgYWxsIHRoZSB2YWxpZCBuYW1lcyBhbmQgYWxpYXNlcwogICAgZm9yIG5hbWUsIHZhbHVlIGluIFBlcm1pc3Npb25zLl9fZGljdF9fLml0ZW1zKCk6CiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgcGVybWlzc2lvbl9hbGlhcyk6CiAgICAgICAgICAgIGtleSA9IHZhbHVlLmFsaWFzCiAgICAgICAgICAgIGFsaWFzZXMuYWRkKG5hbWUpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKHZhbHVlLCBmbGFnX3ZhbHVlKToKICAgICAgICAgICAga2V5ID0gbmFtZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICMgZ29kIGJsZXNzIFB5dGhvbgogICAgICAgIGRlZiBnZXR0ZXIoc2VsZiwgeD1rZXkpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdmFsdWVzLmdldCh4KQogICAgICAgIGRlZiBzZXR0ZXIoc2VsZiwgdmFsdWUsIHg9a2V5KToKICAgICAgICAgICAgc2VsZi5fc2V0KHgsIHZhbHVlKQoKICAgICAgICBwcm9wID0gcHJvcGVydHkoZ2V0dGVyLCBzZXR0ZXIpCiAgICAgICAgc2V0YXR0cihjbHMsIG5hbWUsIHByb3ApCgogICAgY2xzLlBVUkVfRkxBR1MgPSBjbHMuVkFMSURfTkFNRVMgLSBhbGlhc2VzCiAgICByZXR1cm4gY2xzCgpAYXVnbWVudF9mcm9tX3Blcm1pc3Npb25zCmNsYXNzIFBlcm1pc3Npb25PdmVyd3JpdGU6CiAgICByIiIiQSB0eXBlIHRoYXQgaXMgdXNlZCB0byByZXByZXNlbnQgYSBjaGFubmVsIHNwZWNpZmljIHBlcm1pc3Npb24uCgogICAgVW5saWtlIGEgcmVndWxhciA6Y2xhc3M6YFBlcm1pc3Npb25zYFwsIHRoZSBkZWZhdWx0IHZhbHVlIG9mIGEKICAgIHBlcm1pc3Npb24gaXMgZXF1aXZhbGVudCB0byBgYE5vbmVgYCBhbmQgbm90IGBgRmFsc2VgYC4gU2V0dGluZwogICAgYSB2YWx1ZSB0byBgYEZhbHNlYGAgaXMgKipleHBsaWNpdGx5KiogZGVueWluZyB0aGF0IHBlcm1pc3Npb24sCiAgICB3aGlsZSBzZXR0aW5nIGEgdmFsdWUgdG8gYGBUcnVlYGAgaXMgKipleHBsaWNpdGx5KiogYWxsb3dpbmcKICAgIHRoYXQgcGVybWlzc2lvbi4KCiAgICBUaGUgdmFsdWVzIHN1cHBvcnRlZCBieSB0aGlzIGFyZSB0aGUgc2FtZSBhcyA6Y2xhc3M6YFBlcm1pc3Npb25zYAogICAgd2l0aCB0aGUgYWRkZWQgcG9zc2liaWxpdHkgb2YgaXQgYmVpbmcgc2V0IHRvIGBgTm9uZWBgLgoKICAgIC4uIGNvbnRhaW5lcjo6IG9wZXJhdGlvbnMKCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4ID09IHkKCiAgICAgICAgICAgIENoZWNrcyBpZiB0d28gb3ZlcndyaXRlcyBhcmUgZXF1YWwuCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4ICE9IHkKCiAgICAgICAgICAgIENoZWNrcyBpZiB0d28gb3ZlcndyaXRlcyBhcmUgbm90IGVxdWFsLgogICAgICAgIC4uIGRlc2NyaWJlOjogaXRlcih4KQoKICAgICAgICAgICBSZXR1cm5zIGFuIGl0ZXJhdG9yIG9mIGBgKHBlcm0sIHZhbHVlKWBgIHBhaXJzLiBUaGlzIGFsbG93cyBpdAogICAgICAgICAgIHRvIGJlLCBmb3IgZXhhbXBsZSwgY29uc3RydWN0ZWQgYXMgYSBkaWN0IG9yIGEgbGlzdCBvZiBwYWlycy4KICAgICAgICAgICBOb3RlIHRoYXQgYWxpYXNlcyBhcmUgbm90IHNob3duLgoKICAgIFBhcmFtZXRlcnMKICAgIC0tLS0tLS0tLS0tCiAgICBcKlwqa3dhcmdzCiAgICAgICAgU2V0IHRoZSB2YWx1ZSBvZiBwZXJtaXNzaW9ucyBieSB0aGVpciBuYW1lLgogICAgIiIiCgogICAgX19zbG90c19fID0gKCdfdmFsdWVzJywpCgogICAgZGVmIF9faW5pdF9fKHNlbGYsICoqa3dhcmdzKToKICAgICAgICBzZWxmLl92YWx1ZXMgPSB7fQoKICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBrd2FyZ3MuaXRlbXMoKToKICAgICAgICAgICAgaWYga2V5IG5vdCBpbiBzZWxmLlZBTElEX05BTUVTOgogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignbm8gcGVybWlzc2lvbiBjYWxsZWQgezB9LicuZm9ybWF0KGtleSkpCgogICAgICAgICAgICBzZXRhdHRyKHNlbGYsIGtleSwgdmFsdWUpCgogICAgZGVmIF9fZXFfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgcmV0dXJuIGlzaW5zdGFuY2Uob3RoZXIsIFBlcm1pc3Npb25PdmVyd3JpdGUpIGFuZCBzZWxmLl92YWx1ZXMgPT0gb3RoZXIuX3ZhbHVlcwoKICAgIGRlZiBfc2V0KHNlbGYsIGtleSwgdmFsdWUpOgogICAgICAgIGlmIHZhbHVlIG5vdCBpbiAoVHJ1ZSwgTm9uZSwgRmFsc2UpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ0V4cGVjdGVkIGJvb2wgb3IgTm9uZVR5cGUsIHJlY2VpdmVkIHswLl9fY2xhc3NfXy5fX25hbWVfX30nLmZvcm1hdCh2YWx1ZSkpCgogICAgICAgIGlmIHZhbHVlIGlzIE5vbmU6CiAgICAgICAgICAgIHNlbGYuX3ZhbHVlcy5wb3Aoa2V5LCBOb25lKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuX3ZhbHVlc1trZXldID0gdmFsdWUKCiAgICBkZWYgcGFpcihzZWxmKToKICAgICAgICAiIiJUdXBsZVs6Y2xhc3M6YFBlcm1pc3Npb25zYCwgOmNsYXNzOmBQZXJtaXNzaW9uc2BdOiBSZXR1cm5zIHRoZSAoYWxsb3csIGRlbnkpIHBhaXIgZnJvbSB0aGlzIG92ZXJ3cml0ZS4iIiIKCiAgICAgICAgYWxsb3cgPSBQZXJtaXNzaW9ucy5ub25lKCkKICAgICAgICBkZW55ID0gUGVybWlzc2lvbnMubm9uZSgpCgogICAgICAgIGZvciBrZXksIHZhbHVlIGluIHNlbGYuX3ZhbHVlcy5pdGVtcygpOgogICAgICAgICAgICBpZiB2YWx1ZSBpcyBUcnVlOgogICAgICAgICAgICAgICAgc2V0YXR0cihhbGxvdywga2V5LCBUcnVlKQogICAgICAgICAgICBlbGlmIHZhbHVlIGlzIEZhbHNlOgogICAgICAgICAgICAgICAgc2V0YXR0cihkZW55LCBrZXksIFRydWUpCgogICAgICAgIHJldHVybiBhbGxvdywgZGVueQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIGZyb21fcGFpcihjbHMsIGFsbG93LCBkZW55KToKICAgICAgICAiIiJDcmVhdGVzIGFuIG92ZXJ3cml0ZSBmcm9tIGFuIGFsbG93L2RlbnkgcGFpciBvZiA6Y2xhc3M6YFBlcm1pc3Npb25zYC4iIiIKICAgICAgICByZXQgPSBjbHMoKQogICAgICAgIGZvciBrZXksIHZhbHVlIGluIGFsbG93OgogICAgICAgICAgICBpZiB2YWx1ZSBpcyBUcnVlOgogICAgICAgICAgICAgICAgc2V0YXR0cihyZXQsIGtleSwgVHJ1ZSkKCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gZGVueToKICAgICAgICAgICAgaWYgdmFsdWUgaXMgVHJ1ZToKICAgICAgICAgICAgICAgIHNldGF0dHIocmV0LCBrZXksIEZhbHNlKQoKICAgICAgICByZXR1cm4gcmV0CgogICAgZGVmIGlzX2VtcHR5KHNlbGYpOgogICAgICAgICIiIkNoZWNrcyBpZiB0aGUgcGVybWlzc2lvbiBvdmVyd3JpdGUgaXMgY3VycmVudGx5IGVtcHR5LgoKICAgICAgICBBbiBlbXB0eSBwZXJtaXNzaW9uIG92ZXJ3cml0ZSBpcyBvbmUgdGhhdCBoYXMgbm8gb3ZlcndyaXRlcyBzZXQKICAgICAgICB0byBgYFRydWVgYCBvciBgYEZhbHNlYGAuCgogICAgICAgIFJldHVybnMKICAgICAgICAtLS0tLS0tCiAgICAgICAgOmNsYXNzOmBib29sYAogICAgICAgICAgICBJbmRpY2F0ZXMgaWYgdGhlIG92ZXJ3cml0ZSBpcyBlbXB0eS4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gbGVuKHNlbGYuX3ZhbHVlcykgPT0gMAoKICAgIGRlZiB1cGRhdGUoc2VsZiwgKiprd2FyZ3MpOgogICAgICAgIHIiIiJCdWxrIHVwZGF0ZXMgdGhpcyBwZXJtaXNzaW9uIG92ZXJ3cml0ZSBvYmplY3QuCgogICAgICAgIEFsbG93cyB5b3UgdG8gc2V0IG11bHRpcGxlIGF0dHJpYnV0ZXMgYnkgdXNpbmcga2V5d29yZAogICAgICAgIGFyZ3VtZW50cy4gVGhlIG5hbWVzIG11c3QgYmUgZXF1aXZhbGVudCB0byB0aGUgcHJvcGVydGllcwogICAgICAgIGxpc3RlZC4gRXh0cmFuZW91cyBrZXkvdmFsdWUgcGFpcnMgd2lsbCBiZSBzaWxlbnRseSBpZ25vcmVkLgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0tCiAgICAgICAgXCpcKmt3YXJncwogICAgICAgICAgICBBIGxpc3Qgb2Yga2V5L3ZhbHVlIHBhaXJzIHRvIGJ1bGsgdXBkYXRlIHdpdGguCiAgICAgICAgIiIiCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4ga3dhcmdzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIGtleSBub3QgaW4gc2VsZi5WQUxJRF9OQU1FUzoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBzZXRhdHRyKHNlbGYsIGtleSwgdmFsdWUpCgogICAgZGVmIF9faXRlcl9fKHNlbGYpOgogICAgICAgIGZvciBrZXkgaW4gc2VsZi5QVVJFX0ZMQUdTOgogICAgICAgICAgICB5aWVsZCBrZXksIHNlbGYuX3ZhbHVlcy5nZXQoa2V5KQo=
