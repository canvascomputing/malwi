statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/connectionpool.py
  contents:
  - name: HTTPConnectionPool.__init__
    score: 0.0
    code: |-
      def __init__(self, host, port=None, strict=False,
                       timeout=Timeout.DEFAULT_TIMEOUT, maxsize=1, block=False,
                       headers=None, retries=None,
                       _proxy=None, _proxy_headers=None,
                       **conn_kw):
              ConnectionPool.__init__(self, host, port)
              RequestMethods.__init__(self, headers)

              self.strict = strict

              if not isinstance(timeout, Timeout):
                  timeout = Timeout.from_float(timeout)

              if retries is None:
                  retries = Retry.DEFAULT

              self.timeout = timeout
              self.retries = retries

              self.pool = self.QueueCls(maxsize)
              self.block = block

              self.proxy = _proxy
              self.proxy_headers = _proxy_headers or {}

              # Fill the queue up so that doing get() on it will block properly
              for _ in xrange(maxsize):
                  self.pool.put(None)

              # These are mostly for testing and debugging purposes.
              self.num_connections = 0
              self.num_requests = 0
              self.conn_kw = conn_kw

              if self.proxy:
                  # Enable Nagle's algorithm for proxies, to avoid packet fragmentation.
                  # We cannot know if the user has added default socket options, so we cannot replace the
                  # list.
                  self.conn_kw.setdefault('socket_options', [])
    tokens: resume load_global ConnectionPool load_attr __init__ load_fast self load_fast host load_fast port call pop_top load_global RequestMethods load_attr __init__ load_fast self load_fast headers call pop_top load_fast strict load_fast self store_attr strict load_global isinstance load_fast timeout load_global Timeout call pop_jump_if_true TO_NUMBER load_global Timeout load_attr from_float load_fast timeout call store_fast timeout load_fast retries pop_jump_if_not_none TO_NUMBER load_global Retry load_attr DEFAULT store_fast retries load_fast timeout load_fast self store_attr timeout load_fast retries load_fast self store_attr retries load_fast self load_attr QueueCls load_fast maxsize call load_fast self store_attr pool load_fast block load_fast self store_attr block load_fast _proxy load_fast self store_attr proxy load_fast _proxy_headers copy pop_jump_if_true TO_NUMBER pop_top build_map load_fast self store_attr proxy_headers load_global xrange load_fast maxsize call get_iter for_iter TO_NUMBER store_fast _ load_fast self load_attr pool load_attr put load_const call pop_top jump_backward TO_NUMBER end_for load_const INTEGER load_fast self store_attr num_connections load_const INTEGER load_fast self store_attr num_requests load_fast conn_kw load_fast self store_attr conn_kw load_fast self load_attr proxy pop_jump_if_false TO_NUMBER load_fast self load_attr conn_kw load_attr setdefault load_const socket_options build_list call pop_top return_const None return_const None
    hash: 9e6bb83c3a334693655f82cc7b3b0367d57b0c1c55727153780df6dc1b6f389d
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/connectionpool.py
  : ZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBhYnNvbHV0ZV9pbXBvcnQKaW1wb3J0IGVycm5vCmltcG9ydCBsb2dnaW5nCmltcG9ydCBzeXMKaW1wb3J0IHdhcm5pbmdzCgpmcm9tIHNvY2tldCBpbXBvcnQgZXJyb3IgYXMgU29ja2V0RXJyb3IsIHRpbWVvdXQgYXMgU29ja2V0VGltZW91dAppbXBvcnQgc29ja2V0CgoKZnJvbSAuZXhjZXB0aW9ucyBpbXBvcnQgKAogICAgQ2xvc2VkUG9vbEVycm9yLAogICAgUHJvdG9jb2xFcnJvciwKICAgIEVtcHR5UG9vbEVycm9yLAogICAgSGVhZGVyUGFyc2luZ0Vycm9yLAogICAgSG9zdENoYW5nZWRFcnJvciwKICAgIExvY2F0aW9uVmFsdWVFcnJvciwKICAgIE1heFJldHJ5RXJyb3IsCiAgICBQcm94eUVycm9yLAogICAgUmVhZFRpbWVvdXRFcnJvciwKICAgIFNTTEVycm9yLAogICAgVGltZW91dEVycm9yLAogICAgSW5zZWN1cmVSZXF1ZXN0V2FybmluZywKICAgIE5ld0Nvbm5lY3Rpb25FcnJvciwKKQpmcm9tIC5wYWNrYWdlcy5zc2xfbWF0Y2hfaG9zdG5hbWUgaW1wb3J0IENlcnRpZmljYXRlRXJyb3IKZnJvbSAucGFja2FnZXMgaW1wb3J0IHNpeApmcm9tIC5wYWNrYWdlcy5zaXgubW92ZXMgaW1wb3J0IHF1ZXVlCmZyb20gLmNvbm5lY3Rpb24gaW1wb3J0ICgKICAgIHBvcnRfYnlfc2NoZW1lLAogICAgRHVtbXlDb25uZWN0aW9uLAogICAgSFRUUENvbm5lY3Rpb24sIEhUVFBTQ29ubmVjdGlvbiwgVmVyaWZpZWRIVFRQU0Nvbm5lY3Rpb24sCiAgICBIVFRQRXhjZXB0aW9uLCBCYXNlU1NMRXJyb3IsCikKZnJvbSAucmVxdWVzdCBpbXBvcnQgUmVxdWVzdE1ldGhvZHMKZnJvbSAucmVzcG9uc2UgaW1wb3J0IEhUVFBSZXNwb25zZQoKZnJvbSAudXRpbC5jb25uZWN0aW9uIGltcG9ydCBpc19jb25uZWN0aW9uX2Ryb3BwZWQKZnJvbSAudXRpbC5yZXF1ZXN0IGltcG9ydCBzZXRfZmlsZV9wb3NpdGlvbgpmcm9tIC51dGlsLnJlc3BvbnNlIGltcG9ydCBhc3NlcnRfaGVhZGVyX3BhcnNpbmcKZnJvbSAudXRpbC5yZXRyeSBpbXBvcnQgUmV0cnkKZnJvbSAudXRpbC50aW1lb3V0IGltcG9ydCBUaW1lb3V0CmZyb20gLnV0aWwudXJsIGltcG9ydCBnZXRfaG9zdCwgVXJsLCBOT1JNQUxJWkFCTEVfU0NIRU1FUwpmcm9tIC51dGlsLnF1ZXVlIGltcG9ydCBMaWZvUXVldWUKCgp4cmFuZ2UgPSBzaXgubW92ZXMueHJhbmdlCgpsb2cgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCl9EZWZhdWx0ID0gb2JqZWN0KCkKCgojIFBvb2wgb2JqZWN0cwpjbGFzcyBDb25uZWN0aW9uUG9vbChvYmplY3QpOgogICAgIiIiCiAgICBCYXNlIGNsYXNzIGZvciBhbGwgY29ubmVjdGlvbiBwb29scywgc3VjaCBhcwogICAgOmNsYXNzOmAuSFRUUENvbm5lY3Rpb25Qb29sYCBhbmQgOmNsYXNzOmAuSFRUUFNDb25uZWN0aW9uUG9vbGAuCiAgICAiIiIKCiAgICBzY2hlbWUgPSBOb25lCiAgICBRdWV1ZUNscyA9IExpZm9RdWV1ZQoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBob3N0LCBwb3J0PU5vbmUpOgogICAgICAgIGlmIG5vdCBob3N0OgogICAgICAgICAgICByYWlzZSBMb2NhdGlvblZhbHVlRXJyb3IoIk5vIGhvc3Qgc3BlY2lmaWVkLiIpCgogICAgICAgIHNlbGYuaG9zdCA9IF9pcHY2X2hvc3QoaG9zdCwgc2VsZi5zY2hlbWUpCiAgICAgICAgc2VsZi5fcHJveHlfaG9zdCA9IGhvc3QubG93ZXIoKQogICAgICAgIHNlbGYucG9ydCA9IHBvcnQKCiAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gJyVzKGhvc3Q9JXIsIHBvcnQ9JXIpJyAlICh0eXBlKHNlbGYpLl9fbmFtZV9fLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaG9zdCwgc2VsZi5wb3J0KQoKICAgIGRlZiBfX2VudGVyX18oc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBkZWYgX19leGl0X18oc2VsZiwgZXhjX3R5cGUsIGV4Y192YWwsIGV4Y190Yik6CiAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgIyBSZXR1cm4gRmFsc2UgdG8gcmUtcmFpc2UgYW55IHBvdGVudGlhbCBleGNlcHRpb25zCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGNsb3NlKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIENsb3NlIGFsbCBwb29sZWQgY29ubmVjdGlvbnMgYW5kIGRpc2FibGUgdGhlIHBvb2wuCiAgICAgICAgIiIiCiAgICAgICAgcGFzcwoKCiMgVGhpcyBpcyB0YWtlbiBmcm9tIGh0dHA6Ly9oZy5weXRob24ub3JnL2NweXRob24vZmlsZS83YWFiYTcyMWViYzAvTGliL3NvY2tldC5weSNsMjUyCl9ibG9ja2luZ19lcnJub3MgPSB7ZXJybm8uRUFHQUlOLCBlcnJuby5FV09VTERCTE9DS30KCgpjbGFzcyBIVFRQQ29ubmVjdGlvblBvb2woQ29ubmVjdGlvblBvb2wsIFJlcXVlc3RNZXRob2RzKToKICAgICIiIgogICAgVGhyZWFkLXNhZmUgY29ubmVjdGlvbiBwb29sIGZvciBvbmUgaG9zdC4KCiAgICA6cGFyYW0gaG9zdDoKICAgICAgICBIb3N0IHVzZWQgZm9yIHRoaXMgSFRUUCBDb25uZWN0aW9uIChlLmcuICJsb2NhbGhvc3QiKSwgcGFzc2VkIGludG8KICAgICAgICA6Y2xhc3M6YGh0dHBsaWIuSFRUUENvbm5lY3Rpb25gLgoKICAgIDpwYXJhbSBwb3J0OgogICAgICAgIFBvcnQgdXNlZCBmb3IgdGhpcyBIVFRQIENvbm5lY3Rpb24gKE5vbmUgaXMgZXF1aXZhbGVudCB0byA4MCksIHBhc3NlZAogICAgICAgIGludG8gOmNsYXNzOmBodHRwbGliLkhUVFBDb25uZWN0aW9uYC4KCiAgICA6cGFyYW0gc3RyaWN0OgogICAgICAgIENhdXNlcyBCYWRTdGF0dXNMaW5lIHRvIGJlIHJhaXNlZCBpZiB0aGUgc3RhdHVzIGxpbmUgY2FuJ3QgYmUgcGFyc2VkCiAgICAgICAgYXMgYSB2YWxpZCBIVFRQLzEuMCBvciAxLjEgc3RhdHVzIGxpbmUsIHBhc3NlZCBpbnRvCiAgICAgICAgOmNsYXNzOmBodHRwbGliLkhUVFBDb25uZWN0aW9uYC4KCiAgICAgICAgLi4gbm90ZTo6CiAgICAgICAgICAgT25seSB3b3JrcyBpbiBQeXRob24gMi4gVGhpcyBwYXJhbWV0ZXIgaXMgaWdub3JlZCBpbiBQeXRob24gMy4KCiAgICA6cGFyYW0gdGltZW91dDoKICAgICAgICBTb2NrZXQgdGltZW91dCBpbiBzZWNvbmRzIGZvciBlYWNoIGluZGl2aWR1YWwgY29ubmVjdGlvbi4gVGhpcyBjYW4KICAgICAgICBiZSBhIGZsb2F0IG9yIGludGVnZXIsIHdoaWNoIHNldHMgdGhlIHRpbWVvdXQgZm9yIHRoZSBIVFRQIHJlcXVlc3QsCiAgICAgICAgb3IgYW4gaW5zdGFuY2Ugb2YgOmNsYXNzOmB1cmxsaWIzLnV0aWwuVGltZW91dGAgd2hpY2ggZ2l2ZXMgeW91IG1vcmUKICAgICAgICBmaW5lLWdyYWluZWQgY29udHJvbCBvdmVyIHJlcXVlc3QgdGltZW91dHMuIEFmdGVyIHRoZSBjb25zdHJ1Y3RvciBoYXMKICAgICAgICBiZWVuIHBhcnNlZCwgdGhpcyBpcyBhbHdheXMgYSBgdXJsbGliMy51dGlsLlRpbWVvdXRgIG9iamVjdC4KCiAgICA6cGFyYW0gbWF4c2l6ZToKICAgICAgICBOdW1iZXIgb2YgY29ubmVjdGlvbnMgdG8gc2F2ZSB0aGF0IGNhbiBiZSByZXVzZWQuIE1vcmUgdGhhbiAxIGlzIHVzZWZ1bAogICAgICAgIGluIG11bHRpdGhyZWFkZWQgc2l0dWF0aW9ucy4gSWYgYGBibG9ja2BgIGlzIHNldCB0byBGYWxzZSwgbW9yZQogICAgICAgIGNvbm5lY3Rpb25zIHdpbGwgYmUgY3JlYXRlZCBidXQgdGhleSB3aWxsIG5vdCBiZSBzYXZlZCBvbmNlIHRoZXkndmUKICAgICAgICBiZWVuIHVzZWQuCgogICAgOnBhcmFtIGJsb2NrOgogICAgICAgIElmIHNldCB0byBUcnVlLCBubyBtb3JlIHRoYW4gYGBtYXhzaXplYGAgY29ubmVjdGlvbnMgd2lsbCBiZSB1c2VkIGF0CiAgICAgICAgYSB0aW1lLiBXaGVuIG5vIGZyZWUgY29ubmVjdGlvbnMgYXJlIGF2YWlsYWJsZSwgdGhlIGNhbGwgd2lsbCBibG9jawogICAgICAgIHVudGlsIGEgY29ubmVjdGlvbiBoYXMgYmVlbiByZWxlYXNlZC4gVGhpcyBpcyBhIHVzZWZ1bCBzaWRlIGVmZmVjdCBmb3IKICAgICAgICBwYXJ0aWN1bGFyIG11bHRpdGhyZWFkZWQgc2l0dWF0aW9ucyB3aGVyZSBvbmUgZG9lcyBub3Qgd2FudCB0byB1c2UgbW9yZQogICAgICAgIHRoYW4gbWF4c2l6ZSBjb25uZWN0aW9ucyBwZXIgaG9zdCB0byBwcmV2ZW50IGZsb29kaW5nLgoKICAgIDpwYXJhbSBoZWFkZXJzOgogICAgICAgIEhlYWRlcnMgdG8gaW5jbHVkZSB3aXRoIGFsbCByZXF1ZXN0cywgdW5sZXNzIG90aGVyIGhlYWRlcnMgYXJlIGdpdmVuCiAgICAgICAgZXhwbGljaXRseS4KCiAgICA6cGFyYW0gcmV0cmllczoKICAgICAgICBSZXRyeSBjb25maWd1cmF0aW9uIHRvIHVzZSBieSBkZWZhdWx0IHdpdGggcmVxdWVzdHMgaW4gdGhpcyBwb29sLgoKICAgIDpwYXJhbSBfcHJveHk6CiAgICAgICAgUGFyc2VkIHByb3h5IFVSTCwgc2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5LCBpbnN0ZWFkLCBzZWUKICAgICAgICA6Y2xhc3M6YHVybGxpYjMuY29ubmVjdGlvbnBvb2wuUHJveHlNYW5hZ2VyYCIKCiAgICA6cGFyYW0gX3Byb3h5X2hlYWRlcnM6CiAgICAgICAgQSBkaWN0aW9uYXJ5IHdpdGggcHJveHkgaGVhZGVycywgc2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5LAogICAgICAgIGluc3RlYWQsIHNlZSA6Y2xhc3M6YHVybGxpYjMuY29ubmVjdGlvbnBvb2wuUHJveHlNYW5hZ2VyYCIKCiAgICA6cGFyYW0gXFwqKmNvbm5fa3c6CiAgICAgICAgQWRkaXRpb25hbCBwYXJhbWV0ZXJzIGFyZSB1c2VkIHRvIGNyZWF0ZSBmcmVzaCA6Y2xhc3M6YHVybGxpYjMuY29ubmVjdGlvbi5IVFRQQ29ubmVjdGlvbmAsCiAgICAgICAgOmNsYXNzOmB1cmxsaWIzLmNvbm5lY3Rpb24uSFRUUFNDb25uZWN0aW9uYCBpbnN0YW5jZXMuCiAgICAiIiIKCiAgICBzY2hlbWUgPSAnaHR0cCcKICAgIENvbm5lY3Rpb25DbHMgPSBIVFRQQ29ubmVjdGlvbgogICAgUmVzcG9uc2VDbHMgPSBIVFRQUmVzcG9uc2UKCiAgICBkZWYgX19pbml0X18oc2VsZiwgaG9zdCwgcG9ydD1Ob25lLCBzdHJpY3Q9RmFsc2UsCiAgICAgICAgICAgICAgICAgdGltZW91dD1UaW1lb3V0LkRFRkFVTFRfVElNRU9VVCwgbWF4c2l6ZT0xLCBibG9jaz1GYWxzZSwKICAgICAgICAgICAgICAgICBoZWFkZXJzPU5vbmUsIHJldHJpZXM9Tm9uZSwKICAgICAgICAgICAgICAgICBfcHJveHk9Tm9uZSwgX3Byb3h5X2hlYWRlcnM9Tm9uZSwKICAgICAgICAgICAgICAgICAqKmNvbm5fa3cpOgogICAgICAgIENvbm5lY3Rpb25Qb29sLl9faW5pdF9fKHNlbGYsIGhvc3QsIHBvcnQpCiAgICAgICAgUmVxdWVzdE1ldGhvZHMuX19pbml0X18oc2VsZiwgaGVhZGVycykKCiAgICAgICAgc2VsZi5zdHJpY3QgPSBzdHJpY3QKCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UodGltZW91dCwgVGltZW91dCk6CiAgICAgICAgICAgIHRpbWVvdXQgPSBUaW1lb3V0LmZyb21fZmxvYXQodGltZW91dCkKCiAgICAgICAgaWYgcmV0cmllcyBpcyBOb25lOgogICAgICAgICAgICByZXRyaWVzID0gUmV0cnkuREVGQVVMVAoKICAgICAgICBzZWxmLnRpbWVvdXQgPSB0aW1lb3V0CiAgICAgICAgc2VsZi5yZXRyaWVzID0gcmV0cmllcwoKICAgICAgICBzZWxmLnBvb2wgPSBzZWxmLlF1ZXVlQ2xzKG1heHNpemUpCiAgICAgICAgc2VsZi5ibG9jayA9IGJsb2NrCgogICAgICAgIHNlbGYucHJveHkgPSBfcHJveHkKICAgICAgICBzZWxmLnByb3h5X2hlYWRlcnMgPSBfcHJveHlfaGVhZGVycyBvciB7fQoKICAgICAgICAjIEZpbGwgdGhlIHF1ZXVlIHVwIHNvIHRoYXQgZG9pbmcgZ2V0KCkgb24gaXQgd2lsbCBibG9jayBwcm9wZXJseQogICAgICAgIGZvciBfIGluIHhyYW5nZShtYXhzaXplKToKICAgICAgICAgICAgc2VsZi5wb29sLnB1dChOb25lKQoKICAgICAgICAjIFRoZXNlIGFyZSBtb3N0bHkgZm9yIHRlc3RpbmcgYW5kIGRlYnVnZ2luZyBwdXJwb3Nlcy4KICAgICAgICBzZWxmLm51bV9jb25uZWN0aW9ucyA9IDAKICAgICAgICBzZWxmLm51bV9yZXF1ZXN0cyA9IDAKICAgICAgICBzZWxmLmNvbm5fa3cgPSBjb25uX2t3CgogICAgICAgIGlmIHNlbGYucHJveHk6CiAgICAgICAgICAgICMgRW5hYmxlIE5hZ2xlJ3MgYWxnb3JpdGhtIGZvciBwcm94aWVzLCB0byBhdm9pZCBwYWNrZXQgZnJhZ21lbnRhdGlvbi4KICAgICAgICAgICAgIyBXZSBjYW5ub3Qga25vdyBpZiB0aGUgdXNlciBoYXMgYWRkZWQgZGVmYXVsdCBzb2NrZXQgb3B0aW9ucywgc28gd2UgY2Fubm90IHJlcGxhY2UgdGhlCiAgICAgICAgICAgICMgbGlzdC4KICAgICAgICAgICAgc2VsZi5jb25uX2t3LnNldGRlZmF1bHQoJ3NvY2tldF9vcHRpb25zJywgW10pCgogICAgZGVmIF9uZXdfY29ubihzZWxmKToKICAgICAgICAiIiIKICAgICAgICBSZXR1cm4gYSBmcmVzaCA6Y2xhc3M6YEhUVFBDb25uZWN0aW9uYC4KICAgICAgICAiIiIKICAgICAgICBzZWxmLm51bV9jb25uZWN0aW9ucyArPSAxCiAgICAgICAgbG9nLmRlYnVnKCJTdGFydGluZyBuZXcgSFRUUCBjb25uZWN0aW9uICglZCk6ICVzOiVzIiwKICAgICAgICAgICAgICAgICAgc2VsZi5udW1fY29ubmVjdGlvbnMsIHNlbGYuaG9zdCwgc2VsZi5wb3J0IG9yICI4MCIpCgogICAgICAgIGNvbm4gPSBzZWxmLkNvbm5lY3Rpb25DbHMoaG9zdD1zZWxmLmhvc3QsIHBvcnQ9c2VsZi5wb3J0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dD1zZWxmLnRpbWVvdXQuY29ubmVjdF90aW1lb3V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaWN0PXNlbGYuc3RyaWN0LCAqKnNlbGYuY29ubl9rdykKICAgICAgICByZXR1cm4gY29ubgoKICAgIGRlZiBfZ2V0X2Nvbm4oc2VsZiwgdGltZW91dD1Ob25lKToKICAgICAgICAiIiIKICAgICAgICBHZXQgYSBjb25uZWN0aW9uLiBXaWxsIHJldHVybiBhIHBvb2xlZCBjb25uZWN0aW9uIGlmIG9uZSBpcyBhdmFpbGFibGUuCgogICAgICAgIElmIG5vIGNvbm5lY3Rpb25zIGFyZSBhdmFpbGFibGUgYW5kIDpwcm9wOmAuYmxvY2tgIGlzIGBgRmFsc2VgYCwgdGhlbiBhCiAgICAgICAgZnJlc2ggY29ubmVjdGlvbiBpcyByZXR1cm5lZC4KCiAgICAgICAgOnBhcmFtIHRpbWVvdXQ6CiAgICAgICAgICAgIFNlY29uZHMgdG8gd2FpdCBiZWZvcmUgZ2l2aW5nIHVwIGFuZCByYWlzaW5nCiAgICAgICAgICAgIDpjbGFzczpgdXJsbGliMy5leGNlcHRpb25zLkVtcHR5UG9vbEVycm9yYCBpZiB0aGUgcG9vbCBpcyBlbXB0eSBhbmQKICAgICAgICAgICAgOnByb3A6YC5ibG9ja2AgaXMgYGBUcnVlYGAuCiAgICAgICAgIiIiCiAgICAgICAgY29ubiA9IE5vbmUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbm4gPSBzZWxmLnBvb2wuZ2V0KGJsb2NrPXNlbGYuYmxvY2ssIHRpbWVvdXQ9dGltZW91dCkKCiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOiAgIyBzZWxmLnBvb2wgaXMgTm9uZQogICAgICAgICAgICByYWlzZSBDbG9zZWRQb29sRXJyb3Ioc2VsZiwgIlBvb2wgaXMgY2xvc2VkLiIpCgogICAgICAgIGV4Y2VwdCBxdWV1ZS5FbXB0eToKICAgICAgICAgICAgaWYgc2VsZi5ibG9jazoKICAgICAgICAgICAgICAgIHJhaXNlIEVtcHR5UG9vbEVycm9yKHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUG9vbCByZWFjaGVkIG1heGltdW0gc2l6ZSBhbmQgbm8gbW9yZSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY29ubmVjdGlvbnMgYXJlIGFsbG93ZWQuIikKICAgICAgICAgICAgcGFzcyAgIyBPaCB3ZWxsLCB3ZSdsbCBjcmVhdGUgYSBuZXcgY29ubmVjdGlvbiB0aGVuCgogICAgICAgICMgSWYgdGhpcyBpcyBhIHBlcnNpc3RlbnQgY29ubmVjdGlvbiwgY2hlY2sgaWYgaXQgZ290IGRpc2Nvbm5lY3RlZAogICAgICAgIGlmIGNvbm4gYW5kIGlzX2Nvbm5lY3Rpb25fZHJvcHBlZChjb25uKToKICAgICAgICAgICAgbG9nLmRlYnVnKCJSZXNldHRpbmcgZHJvcHBlZCBjb25uZWN0aW9uOiAlcyIsIHNlbGYuaG9zdCkKICAgICAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgICAgIGlmIGdldGF0dHIoY29ubiwgJ2F1dG9fb3BlbicsIDEpID09IDA6CiAgICAgICAgICAgICAgICAjIFRoaXMgaXMgYSBwcm94aWVkIGNvbm5lY3Rpb24gdGhhdCBoYXMgYmVlbiBtdXRhdGVkIGJ5CiAgICAgICAgICAgICAgICAjIGh0dHBsaWIuX3R1bm5lbCgpIGFuZCBjYW5ub3QgYmUgcmV1c2VkIChzaW5jZSBpdCB3b3VsZAogICAgICAgICAgICAgICAgIyBhdHRlbXB0IHRvIGJ5cGFzcyB0aGUgcHJveHkpCiAgICAgICAgICAgICAgICBjb25uID0gTm9uZQoKICAgICAgICByZXR1cm4gY29ubiBvciBzZWxmLl9uZXdfY29ubigpCgogICAgZGVmIF9wdXRfY29ubihzZWxmLCBjb25uKToKICAgICAgICAiIiIKICAgICAgICBQdXQgYSBjb25uZWN0aW9uIGJhY2sgaW50byB0aGUgcG9vbC4KCiAgICAgICAgOnBhcmFtIGNvbm46CiAgICAgICAgICAgIENvbm5lY3Rpb24gb2JqZWN0IGZvciB0aGUgY3VycmVudCBob3N0IGFuZCBwb3J0IGFzIHJldHVybmVkIGJ5CiAgICAgICAgICAgIDptZXRoOmAuX25ld19jb25uYCBvciA6bWV0aDpgLl9nZXRfY29ubmAuCgogICAgICAgIElmIHRoZSBwb29sIGlzIGFscmVhZHkgZnVsbCwgdGhlIGNvbm5lY3Rpb24gaXMgY2xvc2VkIGFuZCBkaXNjYXJkZWQKICAgICAgICBiZWNhdXNlIHdlIGV4Y2VlZGVkIG1heHNpemUuIElmIGNvbm5lY3Rpb25zIGFyZSBkaXNjYXJkZWQgZnJlcXVlbnRseSwKICAgICAgICB0aGVuIG1heHNpemUgc2hvdWxkIGJlIGluY3JlYXNlZC4KCiAgICAgICAgSWYgdGhlIHBvb2wgaXMgY2xvc2VkLCB0aGVuIHRoZSBjb25uZWN0aW9uIHdpbGwgYmUgY2xvc2VkIGFuZCBkaXNjYXJkZWQuCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLnBvb2wucHV0KGNvbm4sIGJsb2NrPUZhbHNlKQogICAgICAgICAgICByZXR1cm4gICMgRXZlcnl0aGluZyBpcyBkYW5keSwgZG9uZS4KICAgICAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgICAgICMgc2VsZi5wb29sIGlzIE5vbmUuCiAgICAgICAgICAgIHBhc3MKICAgICAgICBleGNlcHQgcXVldWUuRnVsbDoKICAgICAgICAgICAgIyBUaGlzIHNob3VsZCBuZXZlciBoYXBwZW4gaWYgc2VsZi5ibG9jayA9PSBUcnVlCiAgICAgICAgICAgIGxvZy53YXJuaW5nKAogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb24gcG9vbCBpcyBmdWxsLCBkaXNjYXJkaW5nIGNvbm5lY3Rpb246ICVzIiwKICAgICAgICAgICAgICAgIHNlbGYuaG9zdCkKCiAgICAgICAgIyBDb25uZWN0aW9uIG5ldmVyIGdvdCBwdXQgYmFjayBpbnRvIHRoZSBwb29sLCBjbG9zZSBpdC4KICAgICAgICBpZiBjb25uOgogICAgICAgICAgICBjb25uLmNsb3NlKCkKCiAgICBkZWYgX3ZhbGlkYXRlX2Nvbm4oc2VsZiwgY29ubik6CiAgICAgICAgIiIiCiAgICAgICAgQ2FsbGVkIHJpZ2h0IGJlZm9yZSBhIHJlcXVlc3QgaXMgbWFkZSwgYWZ0ZXIgdGhlIHNvY2tldCBpcyBjcmVhdGVkLgogICAgICAgICIiIgogICAgICAgIHBhc3MKCiAgICBkZWYgX3ByZXBhcmVfcHJveHkoc2VsZiwgY29ubik6CiAgICAgICAgIyBOb3RoaW5nIHRvIGRvIGZvciBIVFRQIGNvbm5lY3Rpb25zLgogICAgICAgIHBhc3MKCiAgICBkZWYgX2dldF90aW1lb3V0KHNlbGYsIHRpbWVvdXQpOgogICAgICAgICIiIiBIZWxwZXIgdGhhdCBhbHdheXMgcmV0dXJucyBhIDpjbGFzczpgdXJsbGliMy51dGlsLlRpbWVvdXRgICIiIgogICAgICAgIGlmIHRpbWVvdXQgaXMgX0RlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnRpbWVvdXQuY2xvbmUoKQoKICAgICAgICBpZiBpc2luc3RhbmNlKHRpbWVvdXQsIFRpbWVvdXQpOgogICAgICAgICAgICByZXR1cm4gdGltZW91dC5jbG9uZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBVc2VyIHBhc3NlZCB1cyBhbiBpbnQvZmxvYXQuIFRoaXMgaXMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LAogICAgICAgICAgICAjIGNhbiBiZSByZW1vdmVkIGxhdGVyCiAgICAgICAgICAgIHJldHVybiBUaW1lb3V0LmZyb21fZmxvYXQodGltZW91dCkKCiAgICBkZWYgX3JhaXNlX3RpbWVvdXQoc2VsZiwgZXJyLCB1cmwsIHRpbWVvdXRfdmFsdWUpOgogICAgICAgICIiIklzIHRoZSBlcnJvciBhY3R1YWxseSBhIHRpbWVvdXQ/IFdpbGwgcmFpc2UgYSBSZWFkVGltZW91dCBvciBwYXNzIiIiCgogICAgICAgIGlmIGlzaW5zdGFuY2UoZXJyLCBTb2NrZXRUaW1lb3V0KToKICAgICAgICAgICAgcmFpc2UgUmVhZFRpbWVvdXRFcnJvcihzZWxmLCB1cmwsICJSZWFkIHRpbWVkIG91dC4gKHJlYWQgdGltZW91dD0lcykiICUgdGltZW91dF92YWx1ZSkKCiAgICAgICAgIyBTZWUgdGhlIGFib3ZlIGNvbW1lbnQgYWJvdXQgRUFHQUlOIGluIFB5dGhvbiAzLiBJbiBQeXRob24gMiB3ZSBoYXZlCiAgICAgICAgIyB0byBzcGVjaWZpY2FsbHkgY2F0Y2ggaXQgYW5kIHRocm93IHRoZSB0aW1lb3V0IGVycm9yCiAgICAgICAgaWYgaGFzYXR0cihlcnIsICdlcnJubycpIGFuZCBlcnIuZXJybm8gaW4gX2Jsb2NraW5nX2Vycm5vczoKICAgICAgICAgICAgcmFpc2UgUmVhZFRpbWVvdXRFcnJvcihzZWxmLCB1cmwsICJSZWFkIHRpbWVkIG91dC4gKHJlYWQgdGltZW91dD0lcykiICUgdGltZW91dF92YWx1ZSkKCiAgICAgICAgIyBDYXRjaCBwb3NzaWJsZSByZWFkIHRpbWVvdXRzIHRocm93biBhcyBTU0wgZXJyb3JzLiBJZiBub3QgdGhlCiAgICAgICAgIyBjYXNlLCByZXRocm93IHRoZSBvcmlnaW5hbC4gV2UgbmVlZCB0byBkbyB0aGlzIGJlY2F1c2Ugb2Y6CiAgICAgICAgIyBodHRwOi8vYnVncy5weXRob24ub3JnL2lzc3VlMTAyNzIKICAgICAgICBpZiAndGltZWQgb3V0JyBpbiBzdHIoZXJyKSBvciAnZGlkIG5vdCBjb21wbGV0ZSAocmVhZCknIGluIHN0cihlcnIpOiAgIyBQeXRob24gPCAyLjcuNAogICAgICAgICAgICByYWlzZSBSZWFkVGltZW91dEVycm9yKHNlbGYsIHVybCwgIlJlYWQgdGltZWQgb3V0LiAocmVhZCB0aW1lb3V0PSVzKSIgJSB0aW1lb3V0X3ZhbHVlKQoKICAgIGRlZiBfbWFrZV9yZXF1ZXN0KHNlbGYsIGNvbm4sIG1ldGhvZCwgdXJsLCB0aW1lb3V0PV9EZWZhdWx0LCBjaHVua2VkPUZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgKipodHRwbGliX3JlcXVlc3Rfa3cpOgogICAgICAgICIiIgogICAgICAgIFBlcmZvcm0gYSByZXF1ZXN0IG9uIGEgZ2l2ZW4gdXJsbGliIGNvbm5lY3Rpb24gb2JqZWN0IHRha2VuIGZyb20gb3VyCiAgICAgICAgcG9vbC4KCiAgICAgICAgOnBhcmFtIGNvbm46CiAgICAgICAgICAgIGEgY29ubmVjdGlvbiBmcm9tIG9uZSBvZiBvdXIgY29ubmVjdGlvbiBwb29scwoKICAgICAgICA6cGFyYW0gdGltZW91dDoKICAgICAgICAgICAgU29ja2V0IHRpbWVvdXQgaW4gc2Vjb25kcyBmb3IgdGhlIHJlcXVlc3QuIFRoaXMgY2FuIGJlIGEKICAgICAgICAgICAgZmxvYXQgb3IgaW50ZWdlciwgd2hpY2ggd2lsbCBzZXQgdGhlIHNhbWUgdGltZW91dCB2YWx1ZSBmb3IKICAgICAgICAgICAgdGhlIHNvY2tldCBjb25uZWN0IGFuZCB0aGUgc29ja2V0IHJlYWQsIG9yIGFuIGluc3RhbmNlIG9mCiAgICAgICAgICAgIDpjbGFzczpgdXJsbGliMy51dGlsLlRpbWVvdXRgLCB3aGljaCBnaXZlcyB5b3UgbW9yZSBmaW5lLWdyYWluZWQKICAgICAgICAgICAgY29udHJvbCBvdmVyIHlvdXIgdGltZW91dHMuCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5udW1fcmVxdWVzdHMgKz0gMQoKICAgICAgICB0aW1lb3V0X29iaiA9IHNlbGYuX2dldF90aW1lb3V0KHRpbWVvdXQpCiAgICAgICAgdGltZW91dF9vYmouc3RhcnRfY29ubmVjdCgpCiAgICAgICAgY29ubi50aW1lb3V0ID0gdGltZW91dF9vYmouY29ubmVjdF90aW1lb3V0CgogICAgICAgICMgVHJpZ2dlciBhbnkgZXh0cmEgdmFsaWRhdGlvbiB3ZSBuZWVkIHRvIGRvLgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5fdmFsaWRhdGVfY29ubihjb25uKQogICAgICAgIGV4Y2VwdCAoU29ja2V0VGltZW91dCwgQmFzZVNTTEVycm9yKSBhcyBlOgogICAgICAgICAgICAjIFB5MiByYWlzZXMgdGhpcyBhcyBhIEJhc2VTU0xFcnJvciwgUHkzIHJhaXNlcyBpdCBhcyBzb2NrZXQgdGltZW91dC4KICAgICAgICAgICAgc2VsZi5fcmFpc2VfdGltZW91dChlcnI9ZSwgdXJsPXVybCwgdGltZW91dF92YWx1ZT1jb25uLnRpbWVvdXQpCiAgICAgICAgICAgIHJhaXNlCgogICAgICAgICMgY29ubi5yZXF1ZXN0KCkgY2FsbHMgaHR0cGxpYi4qLnJlcXVlc3QsIG5vdCB0aGUgbWV0aG9kIGluCiAgICAgICAgIyB1cmxsaWIzLnJlcXVlc3QuIEl0IGFsc28gY2FsbHMgbWFrZWZpbGUgKHJlY3YpIG9uIHRoZSBzb2NrZXQuCiAgICAgICAgaWYgY2h1bmtlZDoKICAgICAgICAgICAgY29ubi5yZXF1ZXN0X2NodW5rZWQobWV0aG9kLCB1cmwsICoqaHR0cGxpYl9yZXF1ZXN0X2t3KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbm4ucmVxdWVzdChtZXRob2QsIHVybCwgKipodHRwbGliX3JlcXVlc3Rfa3cpCgogICAgICAgICMgUmVzZXQgdGhlIHRpbWVvdXQgZm9yIHRoZSByZWN2KCkgb24gdGhlIHNvY2tldAogICAgICAgIHJlYWRfdGltZW91dCA9IHRpbWVvdXRfb2JqLnJlYWRfdGltZW91dAoKICAgICAgICAjIEFwcCBFbmdpbmUgZG9lc24ndCBoYXZlIGEgc29jayBhdHRyCiAgICAgICAgaWYgZ2V0YXR0cihjb25uLCAnc29jaycsIE5vbmUpOgogICAgICAgICAgICAjIEluIFB5dGhvbiAzIHNvY2tldC5weSB3aWxsIGNhdGNoIEVBR0FJTiBhbmQgcmV0dXJuIE5vbmUgd2hlbiB5b3UKICAgICAgICAgICAgIyB0cnkgYW5kIHJlYWQgaW50byB0aGUgZmlsZSBwb2ludGVyIGNyZWF0ZWQgYnkgaHR0cC5jbGllbnQsIHdoaWNoCiAgICAgICAgICAgICMgaW5zdGVhZCByYWlzZXMgYSBCYWRTdGF0dXNMaW5lIGV4Y2VwdGlvbi4gSW5zdGVhZCBvZiBjYXRjaGluZwogICAgICAgICAgICAjIHRoZSBleGNlcHRpb24gYW5kIGFzc3VtaW5nIGFsbCBCYWRTdGF0dXNMaW5lIGV4Y2VwdGlvbnMgYXJlIHJlYWQKICAgICAgICAgICAgIyB0aW1lb3V0cywgY2hlY2sgZm9yIGEgemVybyB0aW1lb3V0IGJlZm9yZSBtYWtpbmcgdGhlIHJlcXVlc3QuCiAgICAgICAgICAgIGlmIHJlYWRfdGltZW91dCA9PSAwOgogICAgICAgICAgICAgICAgcmFpc2UgUmVhZFRpbWVvdXRFcnJvcigKICAgICAgICAgICAgICAgICAgICBzZWxmLCB1cmwsICJSZWFkIHRpbWVkIG91dC4gKHJlYWQgdGltZW91dD0lcykiICUgcmVhZF90aW1lb3V0KQogICAgICAgICAgICBpZiByZWFkX3RpbWVvdXQgaXMgVGltZW91dC5ERUZBVUxUX1RJTUVPVVQ6CiAgICAgICAgICAgICAgICBjb25uLnNvY2suc2V0dGltZW91dChzb2NrZXQuZ2V0ZGVmYXVsdHRpbWVvdXQoKSkKICAgICAgICAgICAgZWxzZTogICMgTm9uZSBvciBhIHZhbHVlCiAgICAgICAgICAgICAgICBjb25uLnNvY2suc2V0dGltZW91dChyZWFkX3RpbWVvdXQpCgogICAgICAgICMgUmVjZWl2ZSB0aGUgcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0cnk6ICAjIFB5dGhvbiAyLjcsIHVzZSBidWZmZXJpbmcgb2YgSFRUUCByZXNwb25zZXMKICAgICAgICAgICAgICAgIGh0dHBsaWJfcmVzcG9uc2UgPSBjb25uLmdldHJlc3BvbnNlKGJ1ZmZlcmluZz1UcnVlKQogICAgICAgICAgICBleGNlcHQgVHlwZUVycm9yOiAgIyBQeXRob24gMwogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGh0dHBsaWJfcmVzcG9uc2UgPSBjb25uLmdldHJlc3BvbnNlKCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAjIFJlbW92ZSB0aGUgVHlwZUVycm9yIGZyb20gdGhlIGV4Y2VwdGlvbiBjaGFpbiBpbiBQeXRob24gMzsKICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSBpdCBsb29rcyBsaWtlIGEgcHJvZ3JhbW1pbmcgZXJyb3Igd2FzIHRoZSBjYXVzZS4KICAgICAgICAgICAgICAgICAgICBzaXgucmFpc2VfZnJvbShlLCBOb25lKQogICAgICAgIGV4Y2VwdCAoU29ja2V0VGltZW91dCwgQmFzZVNTTEVycm9yLCBTb2NrZXRFcnJvcikgYXMgZToKICAgICAgICAgICAgc2VsZi5fcmFpc2VfdGltZW91dChlcnI9ZSwgdXJsPXVybCwgdGltZW91dF92YWx1ZT1yZWFkX3RpbWVvdXQpCiAgICAgICAgICAgIHJhaXNlCgogICAgICAgICMgQXBwRW5naW5lIGRvZXNuJ3QgaGF2ZSBhIHZlcnNpb24gYXR0ci4KICAgICAgICBodHRwX3ZlcnNpb24gPSBnZXRhdHRyKGNvbm4sICdfaHR0cF92c25fc3RyJywgJ0hUVFAvPycpCiAgICAgICAgbG9nLmRlYnVnKCIlczovLyVzOiVzIFwiJXMgJXMgJXNcIiAlcyAlcyIsIHNlbGYuc2NoZW1lLCBzZWxmLmhvc3QsIHNlbGYucG9ydCwKICAgICAgICAgICAgICAgICAgbWV0aG9kLCB1cmwsIGh0dHBfdmVyc2lvbiwgaHR0cGxpYl9yZXNwb25zZS5zdGF0dXMsCiAgICAgICAgICAgICAgICAgIGh0dHBsaWJfcmVzcG9uc2UubGVuZ3RoKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGFzc2VydF9oZWFkZXJfcGFyc2luZyhodHRwbGliX3Jlc3BvbnNlLm1zZykKICAgICAgICBleGNlcHQgKEhlYWRlclBhcnNpbmdFcnJvciwgVHlwZUVycm9yKSBhcyBocGU6ICAjIFBsYXRmb3JtLXNwZWNpZmljOiBQeXRob24gMwogICAgICAgICAgICBsb2cud2FybmluZygKICAgICAgICAgICAgICAgICdGYWlsZWQgdG8gcGFyc2UgaGVhZGVycyAodXJsPSVzKTogJXMnLAogICAgICAgICAgICAgICAgc2VsZi5fYWJzb2x1dGVfdXJsKHVybCksIGhwZSwgZXhjX2luZm89VHJ1ZSkKCiAgICAgICAgcmV0dXJuIGh0dHBsaWJfcmVzcG9uc2UKCiAgICBkZWYgX2Fic29sdXRlX3VybChzZWxmLCBwYXRoKToKICAgICAgICByZXR1cm4gVXJsKHNjaGVtZT1zZWxmLnNjaGVtZSwgaG9zdD1zZWxmLmhvc3QsIHBvcnQ9c2VsZi5wb3J0LCBwYXRoPXBhdGgpLnVybAoKICAgIGRlZiBjbG9zZShzZWxmKToKICAgICAgICAiIiIKICAgICAgICBDbG9zZSBhbGwgcG9vbGVkIGNvbm5lY3Rpb25zIGFuZCBkaXNhYmxlIHRoZSBwb29sLgogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYucG9vbCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KICAgICAgICAjIERpc2FibGUgYWNjZXNzIHRvIHRoZSBwb29sCiAgICAgICAgb2xkX3Bvb2wsIHNlbGYucG9vbCA9IHNlbGYucG9vbCwgTm9uZQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICBjb25uID0gb2xkX3Bvb2wuZ2V0KGJsb2NrPUZhbHNlKQogICAgICAgICAgICAgICAgaWYgY29ubjoKICAgICAgICAgICAgICAgICAgICBjb25uLmNsb3NlKCkKCiAgICAgICAgZXhjZXB0IHF1ZXVlLkVtcHR5OgogICAgICAgICAgICBwYXNzICAjIERvbmUuCgogICAgZGVmIGlzX3NhbWVfaG9zdChzZWxmLCB1cmwpOgogICAgICAgICIiIgogICAgICAgIENoZWNrIGlmIHRoZSBnaXZlbiBgYHVybGBgIGlzIGEgbWVtYmVyIG9mIHRoZSBzYW1lIGhvc3QgYXMgdGhpcwogICAgICAgIGNvbm5lY3Rpb24gcG9vbC4KICAgICAgICAiIiIKICAgICAgICBpZiB1cmwuc3RhcnRzd2l0aCgnLycpOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQoKICAgICAgICAjIFRPRE86IEFkZCBvcHRpb25hbCBzdXBwb3J0IGZvciBzb2NrZXQuZ2V0aG9zdGJ5bmFtZSBjaGVja2luZy4KICAgICAgICBzY2hlbWUsIGhvc3QsIHBvcnQgPSBnZXRfaG9zdCh1cmwpCgogICAgICAgIGhvc3QgPSBfaXB2Nl9ob3N0KGhvc3QsIHNlbGYuc2NoZW1lKQoKICAgICAgICAjIFVzZSBleHBsaWNpdCBkZWZhdWx0IHBvcnQgZm9yIGNvbXBhcmlzb24gd2hlbiBub25lIGlzIGdpdmVuCiAgICAgICAgaWYgc2VsZi5wb3J0IGFuZCBub3QgcG9ydDoKICAgICAgICAgICAgcG9ydCA9IHBvcnRfYnlfc2NoZW1lLmdldChzY2hlbWUpCiAgICAgICAgZWxpZiBub3Qgc2VsZi5wb3J0IGFuZCBwb3J0ID09IHBvcnRfYnlfc2NoZW1lLmdldChzY2hlbWUpOgogICAgICAgICAgICBwb3J0ID0gTm9uZQoKICAgICAgICByZXR1cm4gKHNjaGVtZSwgaG9zdCwgcG9ydCkgPT0gKHNlbGYuc2NoZW1lLCBzZWxmLmhvc3QsIHNlbGYucG9ydCkKCiAgICBkZWYgdXJsb3BlbihzZWxmLCBtZXRob2QsIHVybCwgYm9keT1Ob25lLCBoZWFkZXJzPU5vbmUsIHJldHJpZXM9Tm9uZSwKICAgICAgICAgICAgICAgIHJlZGlyZWN0PVRydWUsIGFzc2VydF9zYW1lX2hvc3Q9VHJ1ZSwgdGltZW91dD1fRGVmYXVsdCwKICAgICAgICAgICAgICAgIHBvb2xfdGltZW91dD1Ob25lLCByZWxlYXNlX2Nvbm49Tm9uZSwgY2h1bmtlZD1GYWxzZSwKICAgICAgICAgICAgICAgIGJvZHlfcG9zPU5vbmUsICoqcmVzcG9uc2Vfa3cpOgogICAgICAgICIiIgogICAgICAgIEdldCBhIGNvbm5lY3Rpb24gZnJvbSB0aGUgcG9vbCBhbmQgcGVyZm9ybSBhbiBIVFRQIHJlcXVlc3QuIFRoaXMgaXMgdGhlCiAgICAgICAgbG93ZXN0IGxldmVsIGNhbGwgZm9yIG1ha2luZyBhIHJlcXVlc3QsIHNvIHlvdSdsbCBuZWVkIHRvIHNwZWNpZnkgYWxsCiAgICAgICAgdGhlIHJhdyBkZXRhaWxzLgoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgTW9yZSBjb21tb25seSwgaXQncyBhcHByb3ByaWF0ZSB0byB1c2UgYSBjb252ZW5pZW5jZSBtZXRob2QgcHJvdmlkZWQKICAgICAgICAgICBieSA6Y2xhc3M6YC5SZXF1ZXN0TWV0aG9kc2AsIHN1Y2ggYXMgOm1ldGg6YHJlcXVlc3RgLgoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgYHJlbGVhc2VfY29ubmAgd2lsbCBvbmx5IGJlaGF2ZSBhcyBleHBlY3RlZCBpZgogICAgICAgICAgIGBwcmVsb2FkX2NvbnRlbnQ9RmFsc2VgIGJlY2F1c2Ugd2Ugd2FudCB0byBtYWtlCiAgICAgICAgICAgYHByZWxvYWRfY29udGVudD1GYWxzZWAgdGhlIGRlZmF1bHQgYmVoYXZpb3VyIHNvbWVkYXkgc29vbiB3aXRob3V0CiAgICAgICAgICAgYnJlYWtpbmcgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCgogICAgICAgIDpwYXJhbSBtZXRob2Q6CiAgICAgICAgICAgIEhUVFAgcmVxdWVzdCBtZXRob2QgKHN1Y2ggYXMgR0VULCBQT1NULCBQVVQsIGV0Yy4pCgogICAgICAgIDpwYXJhbSBib2R5OgogICAgICAgICAgICBEYXRhIHRvIHNlbmQgaW4gdGhlIHJlcXVlc3QgYm9keSAodXNlZnVsIGZvciBjcmVhdGluZwogICAgICAgICAgICBQT1NUIHJlcXVlc3RzLCBzZWUgSFRUUENvbm5lY3Rpb25Qb29sLnBvc3RfdXJsIGZvcgogICAgICAgICAgICBtb3JlIGNvbnZlbmllbmNlKS4KCiAgICAgICAgOnBhcmFtIGhlYWRlcnM6CiAgICAgICAgICAgIERpY3Rpb25hcnkgb2YgY3VzdG9tIGhlYWRlcnMgdG8gc2VuZCwgc3VjaCBhcyBVc2VyLUFnZW50LAogICAgICAgICAgICBJZi1Ob25lLU1hdGNoLCBldGMuIElmIE5vbmUsIHBvb2wgaGVhZGVycyBhcmUgdXNlZC4gSWYgcHJvdmlkZWQsCiAgICAgICAgICAgIHRoZXNlIGhlYWRlcnMgY29tcGxldGVseSByZXBsYWNlIGFueSBwb29sLXNwZWNpZmljIGhlYWRlcnMuCgogICAgICAgIDpwYXJhbSByZXRyaWVzOgogICAgICAgICAgICBDb25maWd1cmUgdGhlIG51bWJlciBvZiByZXRyaWVzIHRvIGFsbG93IGJlZm9yZSByYWlzaW5nIGEKICAgICAgICAgICAgOmNsYXNzOmB+dXJsbGliMy5leGNlcHRpb25zLk1heFJldHJ5RXJyb3JgIGV4Y2VwdGlvbi4KCiAgICAgICAgICAgIFBhc3MgYGBOb25lYGAgdG8gcmV0cnkgdW50aWwgeW91IHJlY2VpdmUgYSByZXNwb25zZS4gUGFzcyBhCiAgICAgICAgICAgIDpjbGFzczpgfnVybGxpYjMudXRpbC5yZXRyeS5SZXRyeWAgb2JqZWN0IGZvciBmaW5lLWdyYWluZWQgY29udHJvbAogICAgICAgICAgICBvdmVyIGRpZmZlcmVudCB0eXBlcyBvZiByZXRyaWVzLgogICAgICAgICAgICBQYXNzIGFuIGludGVnZXIgbnVtYmVyIHRvIHJldHJ5IGNvbm5lY3Rpb24gZXJyb3JzIHRoYXQgbWFueSB0aW1lcywKICAgICAgICAgICAgYnV0IG5vIG90aGVyIHR5cGVzIG9mIGVycm9ycy4gUGFzcyB6ZXJvIHRvIG5ldmVyIHJldHJ5LgoKICAgICAgICAgICAgSWYgYGBGYWxzZWBgLCB0aGVuIHJldHJpZXMgYXJlIGRpc2FibGVkIGFuZCBhbnkgZXhjZXB0aW9uIGlzIHJhaXNlZAogICAgICAgICAgICBpbW1lZGlhdGVseS4gQWxzbywgaW5zdGVhZCBvZiByYWlzaW5nIGEgTWF4UmV0cnlFcnJvciBvbiByZWRpcmVjdHMsCiAgICAgICAgICAgIHRoZSByZWRpcmVjdCByZXNwb25zZSB3aWxsIGJlIHJldHVybmVkLgoKICAgICAgICA6dHlwZSByZXRyaWVzOiA6Y2xhc3M6YH51cmxsaWIzLnV0aWwucmV0cnkuUmV0cnlgLCBGYWxzZSwgb3IgYW4gaW50LgoKICAgICAgICA6cGFyYW0gcmVkaXJlY3Q6CiAgICAgICAgICAgIElmIFRydWUsIGF1dG9tYXRpY2FsbHkgaGFuZGxlIHJlZGlyZWN0cyAoc3RhdHVzIGNvZGVzIDMwMSwgMzAyLAogICAgICAgICAgICAzMDMsIDMwNywgMzA4KS4gRWFjaCByZWRpcmVjdCBjb3VudHMgYXMgYSByZXRyeS4gRGlzYWJsaW5nIHJldHJpZXMKICAgICAgICAgICAgd2lsbCBkaXNhYmxlIHJlZGlyZWN0LCB0b28uCgogICAgICAgIDpwYXJhbSBhc3NlcnRfc2FtZV9ob3N0OgogICAgICAgICAgICBJZiBgYFRydWVgYCwgd2lsbCBtYWtlIHN1cmUgdGhhdCB0aGUgaG9zdCBvZiB0aGUgcG9vbCByZXF1ZXN0cyBpcwogICAgICAgICAgICBjb25zaXN0ZW50IGVsc2Ugd2lsbCByYWlzZSBIb3N0Q2hhbmdlZEVycm9yLiBXaGVuIEZhbHNlLCB5b3UgY2FuCiAgICAgICAgICAgIHVzZSB0aGUgcG9vbCBvbiBhbiBIVFRQIHByb3h5IGFuZCByZXF1ZXN0IGZvcmVpZ24gaG9zdHMuCgogICAgICAgIDpwYXJhbSB0aW1lb3V0OgogICAgICAgICAgICBJZiBzcGVjaWZpZWQsIG92ZXJyaWRlcyB0aGUgZGVmYXVsdCB0aW1lb3V0IGZvciB0aGlzIG9uZQogICAgICAgICAgICByZXF1ZXN0LiBJdCBtYXkgYmUgYSBmbG9hdCAoaW4gc2Vjb25kcykgb3IgYW4gaW5zdGFuY2Ugb2YKICAgICAgICAgICAgOmNsYXNzOmB1cmxsaWIzLnV0aWwuVGltZW91dGAuCgogICAgICAgIDpwYXJhbSBwb29sX3RpbWVvdXQ6CiAgICAgICAgICAgIElmIHNldCBhbmQgdGhlIHBvb2wgaXMgc2V0IHRvIGJsb2NrPVRydWUsIHRoZW4gdGhpcyBtZXRob2Qgd2lsbAogICAgICAgICAgICBibG9jayBmb3IgYGBwb29sX3RpbWVvdXRgYCBzZWNvbmRzIGFuZCByYWlzZSBFbXB0eVBvb2xFcnJvciBpZiBubwogICAgICAgICAgICBjb25uZWN0aW9uIGlzIGF2YWlsYWJsZSB3aXRoaW4gdGhlIHRpbWUgcGVyaW9kLgoKICAgICAgICA6cGFyYW0gcmVsZWFzZV9jb25uOgogICAgICAgICAgICBJZiBGYWxzZSwgdGhlbiB0aGUgdXJsb3BlbiBjYWxsIHdpbGwgbm90IHJlbGVhc2UgdGhlIGNvbm5lY3Rpb24KICAgICAgICAgICAgYmFjayBpbnRvIHRoZSBwb29sIG9uY2UgYSByZXNwb25zZSBpcyByZWNlaXZlZCAoYnV0IHdpbGwgcmVsZWFzZSBpZgogICAgICAgICAgICB5b3UgcmVhZCB0aGUgZW50aXJlIGNvbnRlbnRzIG9mIHRoZSByZXNwb25zZSBzdWNoIGFzIHdoZW4KICAgICAgICAgICAgYHByZWxvYWRfY29udGVudD1UcnVlYCkuIFRoaXMgaXMgdXNlZnVsIGlmIHlvdSdyZSBub3QgcHJlbG9hZGluZwogICAgICAgICAgICB0aGUgcmVzcG9uc2UncyBjb250ZW50IGltbWVkaWF0ZWx5LiBZb3Ugd2lsbCBuZWVkIHRvIGNhbGwKICAgICAgICAgICAgYGByLnJlbGVhc2VfY29ubigpYGAgb24gdGhlIHJlc3BvbnNlIGBgcmBgIHRvIHJldHVybiB0aGUgY29ubmVjdGlvbgogICAgICAgICAgICBiYWNrIGludG8gdGhlIHBvb2wuIElmIE5vbmUsIGl0IHRha2VzIHRoZSB2YWx1ZSBvZgogICAgICAgICAgICBgYHJlc3BvbnNlX2t3LmdldCgncHJlbG9hZF9jb250ZW50JywgVHJ1ZSlgYC4KCiAgICAgICAgOnBhcmFtIGNodW5rZWQ6CiAgICAgICAgICAgIElmIFRydWUsIHVybGxpYjMgd2lsbCBzZW5kIHRoZSBib2R5IHVzaW5nIGNodW5rZWQgdHJhbnNmZXIKICAgICAgICAgICAgZW5jb2RpbmcuIE90aGVyd2lzZSwgdXJsbGliMyB3aWxsIHNlbmQgdGhlIGJvZHkgdXNpbmcgdGhlIHN0YW5kYXJkCiAgICAgICAgICAgIGNvbnRlbnQtbGVuZ3RoIGZvcm0uIERlZmF1bHRzIHRvIEZhbHNlLgoKICAgICAgICA6cGFyYW0gaW50IGJvZHlfcG9zOgogICAgICAgICAgICBQb3NpdGlvbiB0byBzZWVrIHRvIGluIGZpbGUtbGlrZSBib2R5IGluIHRoZSBldmVudCBvZiBhIHJldHJ5IG9yCiAgICAgICAgICAgIHJlZGlyZWN0LiBUeXBpY2FsbHkgdGhpcyB3b24ndCBuZWVkIHRvIGJlIHNldCBiZWNhdXNlIHVybGxpYjMgd2lsbAogICAgICAgICAgICBhdXRvLXBvcHVsYXRlIHRoZSB2YWx1ZSB3aGVuIG5lZWRlZC4KCiAgICAgICAgOnBhcmFtIFxcKipyZXNwb25zZV9rdzoKICAgICAgICAgICAgQWRkaXRpb25hbCBwYXJhbWV0ZXJzIGFyZSBwYXNzZWQgdG8KICAgICAgICAgICAgOm1ldGg6YHVybGxpYjMucmVzcG9uc2UuSFRUUFJlc3BvbnNlLmZyb21faHR0cGxpYmAKICAgICAgICAiIiIKICAgICAgICBpZiBoZWFkZXJzIGlzIE5vbmU6CiAgICAgICAgICAgIGhlYWRlcnMgPSBzZWxmLmhlYWRlcnMKCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UocmV0cmllcywgUmV0cnkpOgogICAgICAgICAgICByZXRyaWVzID0gUmV0cnkuZnJvbV9pbnQocmV0cmllcywgcmVkaXJlY3Q9cmVkaXJlY3QsIGRlZmF1bHQ9c2VsZi5yZXRyaWVzKQoKICAgICAgICBpZiByZWxlYXNlX2Nvbm4gaXMgTm9uZToKICAgICAgICAgICAgcmVsZWFzZV9jb25uID0gcmVzcG9uc2Vfa3cuZ2V0KCdwcmVsb2FkX2NvbnRlbnQnLCBUcnVlKQoKICAgICAgICAjIENoZWNrIGhvc3QKICAgICAgICBpZiBhc3NlcnRfc2FtZV9ob3N0IGFuZCBub3Qgc2VsZi5pc19zYW1lX2hvc3QodXJsKToKICAgICAgICAgICAgcmFpc2UgSG9zdENoYW5nZWRFcnJvcihzZWxmLCB1cmwsIHJldHJpZXMpCgogICAgICAgIGNvbm4gPSBOb25lCgogICAgICAgICMgVHJhY2sgd2hldGhlciBgY29ubmAgbmVlZHMgdG8gYmUgcmVsZWFzZWQgYmVmb3JlCiAgICAgICAgIyByZXR1cm5pbmcvcmFpc2luZy9yZWN1cnNpbmcuIFVwZGF0ZSB0aGlzIHZhcmlhYmxlIGlmIG5lY2Vzc2FyeSwgYW5kCiAgICAgICAgIyBsZWF2ZSBgcmVsZWFzZV9jb25uYCBjb25zdGFudCB0aHJvdWdob3V0IHRoZSBmdW5jdGlvbi4gVGhhdCB3YXksIGlmCiAgICAgICAgIyB0aGUgZnVuY3Rpb24gcmVjdXJzZXMsIHRoZSBvcmlnaW5hbCB2YWx1ZSBvZiBgcmVsZWFzZV9jb25uYCB3aWxsIGJlCiAgICAgICAgIyBwYXNzZWQgZG93biBpbnRvIHRoZSByZWN1cnNpdmUgY2FsbCwgYW5kIGl0cyB2YWx1ZSB3aWxsIGJlIHJlc3BlY3RlZC4KICAgICAgICAjCiAgICAgICAgIyBTZWUgaXNzdWUgIzY1MSBbMV0gZm9yIGRldGFpbHMuCiAgICAgICAgIwogICAgICAgICMgWzFdIDxodHRwczovL2dpdGh1Yi5jb20vc2hhem93L3VybGxpYjMvaXNzdWVzLzY1MT4KICAgICAgICByZWxlYXNlX3RoaXNfY29ubiA9IHJlbGVhc2VfY29ubgoKICAgICAgICAjIE1lcmdlIHRoZSBwcm94eSBoZWFkZXJzLiBPbmx5IGRvIHRoaXMgaW4gSFRUUC4gV2UgaGF2ZSB0byBjb3B5IHRoZQogICAgICAgICMgaGVhZGVycyBkaWN0IHNvIHdlIGNhbiBzYWZlbHkgY2hhbmdlIGl0IHdpdGhvdXQgdGhvc2UgY2hhbmdlcyBiZWluZwogICAgICAgICMgcmVmbGVjdGVkIGluIGFueW9uZSBlbHNlJ3MgY29weS4KICAgICAgICBpZiBzZWxmLnNjaGVtZSA9PSAnaHR0cCc6CiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLmNvcHkoKQogICAgICAgICAgICBoZWFkZXJzLnVwZGF0ZShzZWxmLnByb3h5X2hlYWRlcnMpCgogICAgICAgICMgTXVzdCBrZWVwIHRoZSBleGNlcHRpb24gYm91bmQgdG8gYSBzZXBhcmF0ZSB2YXJpYWJsZSBvciBlbHNlIFB5dGhvbiAzCiAgICAgICAgIyBjb21wbGFpbnMgYWJvdXQgVW5ib3VuZExvY2FsRXJyb3IuCiAgICAgICAgZXJyID0gTm9uZQoKICAgICAgICAjIEtlZXAgdHJhY2sgb2Ygd2hldGhlciB3ZSBjbGVhbmx5IGV4aXRlZCB0aGUgZXhjZXB0IGJsb2NrLiBUaGlzCiAgICAgICAgIyBlbnN1cmVzIHdlIGRvIHByb3BlciBjbGVhbnVwIGluIGZpbmFsbHkuCiAgICAgICAgY2xlYW5fZXhpdCA9IEZhbHNlCgogICAgICAgICMgUmV3aW5kIGJvZHkgcG9zaXRpb24sIGlmIG5lZWRlZC4gUmVjb3JkIGN1cnJlbnQgcG9zaXRpb24KICAgICAgICAjIGZvciBmdXR1cmUgcmV3aW5kcyBpbiB0aGUgZXZlbnQgb2YgYSByZWRpcmVjdC9yZXRyeS4KICAgICAgICBib2R5X3BvcyA9IHNldF9maWxlX3Bvc2l0aW9uKGJvZHksIGJvZHlfcG9zKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgUmVxdWVzdCBhIGNvbm5lY3Rpb24gZnJvbSB0aGUgcXVldWUuCiAgICAgICAgICAgIHRpbWVvdXRfb2JqID0gc2VsZi5fZ2V0X3RpbWVvdXQodGltZW91dCkKICAgICAgICAgICAgY29ubiA9IHNlbGYuX2dldF9jb25uKHRpbWVvdXQ9cG9vbF90aW1lb3V0KQoKICAgICAgICAgICAgY29ubi50aW1lb3V0ID0gdGltZW91dF9vYmouY29ubmVjdF90aW1lb3V0CgogICAgICAgICAgICBpc19uZXdfcHJveHlfY29ubiA9IHNlbGYucHJveHkgaXMgbm90IE5vbmUgYW5kIG5vdCBnZXRhdHRyKGNvbm4sICdzb2NrJywgTm9uZSkKICAgICAgICAgICAgaWYgaXNfbmV3X3Byb3h5X2Nvbm46CiAgICAgICAgICAgICAgICBzZWxmLl9wcmVwYXJlX3Byb3h5KGNvbm4pCgogICAgICAgICAgICAjIE1ha2UgdGhlIHJlcXVlc3Qgb24gdGhlIGh0dHBsaWIgY29ubmVjdGlvbiBvYmplY3QuCiAgICAgICAgICAgIGh0dHBsaWJfcmVzcG9uc2UgPSBzZWxmLl9tYWtlX3JlcXVlc3QoY29ubiwgbWV0aG9kLCB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0X29iaiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5PWJvZHksIGhlYWRlcnM9aGVhZGVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua2VkPWNodW5rZWQpCgogICAgICAgICAgICAjIElmIHdlJ3JlIGdvaW5nIHRvIHJlbGVhc2UgdGhlIGNvbm5lY3Rpb24gaW4gYGBmaW5hbGx5OmBgLCB0aGVuCiAgICAgICAgICAgICMgdGhlIHJlc3BvbnNlIGRvZXNuJ3QgbmVlZCB0byBrbm93IGFib3V0IHRoZSBjb25uZWN0aW9uLiBPdGhlcndpc2UKICAgICAgICAgICAgIyBpdCB3aWxsIGFsc28gdHJ5IHRvIHJlbGVhc2UgaXQgYW5kIHdlJ2xsIGhhdmUgYSBkb3VibGUtcmVsZWFzZQogICAgICAgICAgICAjIG1lc3MuCiAgICAgICAgICAgIHJlc3BvbnNlX2Nvbm4gPSBjb25uIGlmIG5vdCByZWxlYXNlX2Nvbm4gZWxzZSBOb25lCgogICAgICAgICAgICAjIFBhc3MgbWV0aG9kIHRvIFJlc3BvbnNlIGZvciBsZW5ndGggY2hlY2tpbmcKICAgICAgICAgICAgcmVzcG9uc2Vfa3dbJ3JlcXVlc3RfbWV0aG9kJ10gPSBtZXRob2QKCiAgICAgICAgICAgICMgSW1wb3J0IGh0dHBsaWIncyByZXNwb25zZSBpbnRvIG91ciBvd24gd3JhcHBlciBvYmplY3QKICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLlJlc3BvbnNlQ2xzLmZyb21faHR0cGxpYihodHRwbGliX3Jlc3BvbnNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvb2w9c2VsZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uPXJlc3BvbnNlX2Nvbm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0cmllcz1yZXRyaWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoqcmVzcG9uc2Vfa3cpCgogICAgICAgICAgICAjIEV2ZXJ5dGhpbmcgd2VudCBncmVhdCEKICAgICAgICAgICAgY2xlYW5fZXhpdCA9IFRydWUKCiAgICAgICAgZXhjZXB0IHF1ZXVlLkVtcHR5OgogICAgICAgICAgICAjIFRpbWVkIG91dCBieSBxdWV1ZS4KICAgICAgICAgICAgcmFpc2UgRW1wdHlQb29sRXJyb3Ioc2VsZiwgIk5vIHBvb2wgY29ubmVjdGlvbnMgYXJlIGF2YWlsYWJsZS4iKQoKICAgICAgICBleGNlcHQgKFRpbWVvdXRFcnJvciwgSFRUUEV4Y2VwdGlvbiwgU29ja2V0RXJyb3IsIFByb3RvY29sRXJyb3IsCiAgICAgICAgICAgICAgICBCYXNlU1NMRXJyb3IsIFNTTEVycm9yLCBDZXJ0aWZpY2F0ZUVycm9yKSBhcyBlOgogICAgICAgICAgICAjIERpc2NhcmQgdGhlIGNvbm5lY3Rpb24gZm9yIHRoZXNlIGV4Y2VwdGlvbnMuIEl0IHdpbGwgYmUKICAgICAgICAgICAgIyByZXBsYWNlZCBkdXJpbmcgdGhlIG5leHQgX2dldF9jb25uKCkgY2FsbC4KICAgICAgICAgICAgY2xlYW5fZXhpdCA9IEZhbHNlCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZSwgKEJhc2VTU0xFcnJvciwgQ2VydGlmaWNhdGVFcnJvcikpOgogICAgICAgICAgICAgICAgZSA9IFNTTEVycm9yKGUpCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShlLCAoU29ja2V0RXJyb3IsIE5ld0Nvbm5lY3Rpb25FcnJvcikpIGFuZCBzZWxmLnByb3h5OgogICAgICAgICAgICAgICAgZSA9IFByb3h5RXJyb3IoJ0Nhbm5vdCBjb25uZWN0IHRvIHByb3h5LicsIGUpCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShlLCAoU29ja2V0RXJyb3IsIEhUVFBFeGNlcHRpb24pKToKICAgICAgICAgICAgICAgIGUgPSBQcm90b2NvbEVycm9yKCdDb25uZWN0aW9uIGFib3J0ZWQuJywgZSkKCiAgICAgICAgICAgIHJldHJpZXMgPSByZXRyaWVzLmluY3JlbWVudChtZXRob2QsIHVybCwgZXJyb3I9ZSwgX3Bvb2w9c2VsZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zdGFja3RyYWNlPXN5cy5leGNfaW5mbygpWzJdKQogICAgICAgICAgICByZXRyaWVzLnNsZWVwKCkKCiAgICAgICAgICAgICMgS2VlcCB0cmFjayBvZiB0aGUgZXJyb3IgZm9yIHRoZSByZXRyeSB3YXJuaW5nLgogICAgICAgICAgICBlcnIgPSBlCgogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIGlmIG5vdCBjbGVhbl9leGl0OgogICAgICAgICAgICAgICAgIyBXZSBoaXQgc29tZSBraW5kIG9mIGV4Y2VwdGlvbiwgaGFuZGxlZCBvciBvdGhlcndpc2UuIFdlIG5lZWQKICAgICAgICAgICAgICAgICMgdG8gdGhyb3cgdGhlIGNvbm5lY3Rpb24gYXdheSB1bmxlc3MgZXhwbGljaXRseSB0b2xkIG5vdCB0by4KICAgICAgICAgICAgICAgICMgQ2xvc2UgdGhlIGNvbm5lY3Rpb24sIHNldCB0aGUgdmFyaWFibGUgdG8gTm9uZSwgYW5kIG1ha2Ugc3VyZQogICAgICAgICAgICAgICAgIyB3ZSBwdXQgdGhlIE5vbmUgYmFjayBpbiB0aGUgcG9vbCB0byBhdm9pZCBsZWFraW5nIGl0LgogICAgICAgICAgICAgICAgY29ubiA9IGNvbm4gYW5kIGNvbm4uY2xvc2UoKQogICAgICAgICAgICAgICAgcmVsZWFzZV90aGlzX2Nvbm4gPSBUcnVlCgogICAgICAgICAgICBpZiByZWxlYXNlX3RoaXNfY29ubjoKICAgICAgICAgICAgICAgICMgUHV0IHRoZSBjb25uZWN0aW9uIGJhY2sgdG8gYmUgcmV1c2VkLiBJZiB0aGUgY29ubmVjdGlvbiBpcwogICAgICAgICAgICAgICAgIyBleHBpcmVkIHRoZW4gaXQgd2lsbCBiZSBOb25lLCB3aGljaCB3aWxsIGdldCByZXBsYWNlZCB3aXRoIGEKICAgICAgICAgICAgICAgICMgZnJlc2ggY29ubmVjdGlvbiBkdXJpbmcgX2dldF9jb25uLgogICAgICAgICAgICAgICAgc2VsZi5fcHV0X2Nvbm4oY29ubikKCiAgICAgICAgaWYgbm90IGNvbm46CiAgICAgICAgICAgICMgVHJ5IGFnYWluCiAgICAgICAgICAgIGxvZy53YXJuaW5nKCJSZXRyeWluZyAoJXIpIGFmdGVyIGNvbm5lY3Rpb24gIgogICAgICAgICAgICAgICAgICAgICAgICAiYnJva2VuIGJ5ICclcic6ICVzIiwgcmV0cmllcywgZXJyLCB1cmwpCiAgICAgICAgICAgIHJldHVybiBzZWxmLnVybG9wZW4obWV0aG9kLCB1cmwsIGJvZHksIGhlYWRlcnMsIHJldHJpZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3QsIGFzc2VydF9zYW1lX2hvc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0LCBwb29sX3RpbWVvdXQ9cG9vbF90aW1lb3V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGVhc2VfY29ubj1yZWxlYXNlX2Nvbm4sIGJvZHlfcG9zPWJvZHlfcG9zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoqcmVzcG9uc2Vfa3cpCgogICAgICAgIGRlZiBkcmFpbl9hbmRfcmVsZWFzZV9jb25uKHJlc3BvbnNlKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBkaXNjYXJkIGFueSByZW1haW5pbmcgcmVzcG9uc2UgYm9keSwgdGhlIGNvbm5lY3Rpb24gd2lsbCBiZQogICAgICAgICAgICAgICAgIyByZWxlYXNlZCBiYWNrIHRvIHRoZSBwb29sIG9uY2UgdGhlIGVudGlyZSByZXNwb25zZSBpcyByZWFkCiAgICAgICAgICAgICAgICByZXNwb25zZS5yZWFkKCkKICAgICAgICAgICAgZXhjZXB0IChUaW1lb3V0RXJyb3IsIEhUVFBFeGNlcHRpb24sIFNvY2tldEVycm9yLCBQcm90b2NvbEVycm9yLAogICAgICAgICAgICAgICAgICAgIEJhc2VTU0xFcnJvciwgU1NMRXJyb3IpOgogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICAjIEhhbmRsZSByZWRpcmVjdD8KICAgICAgICByZWRpcmVjdF9sb2NhdGlvbiA9IHJlZGlyZWN0IGFuZCByZXNwb25zZS5nZXRfcmVkaXJlY3RfbG9jYXRpb24oKQogICAgICAgIGlmIHJlZGlyZWN0X2xvY2F0aW9uOgogICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXMgPT0gMzAzOgogICAgICAgICAgICAgICAgbWV0aG9kID0gJ0dFVCcKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldHJpZXMgPSByZXRyaWVzLmluY3JlbWVudChtZXRob2QsIHVybCwgcmVzcG9uc2U9cmVzcG9uc2UsIF9wb29sPXNlbGYpCiAgICAgICAgICAgIGV4Y2VwdCBNYXhSZXRyeUVycm9yOgogICAgICAgICAgICAgICAgaWYgcmV0cmllcy5yYWlzZV9vbl9yZWRpcmVjdDoKICAgICAgICAgICAgICAgICAgICAjIERyYWluIGFuZCByZWxlYXNlIHRoZSBjb25uZWN0aW9uIGZvciB0aGlzIHJlc3BvbnNlLCBzaW5jZQogICAgICAgICAgICAgICAgICAgICMgd2UncmUgbm90IHJldHVybmluZyBpdCB0byBiZSByZWxlYXNlZCBtYW51YWxseS4KICAgICAgICAgICAgICAgICAgICBkcmFpbl9hbmRfcmVsZWFzZV9jb25uKHJlc3BvbnNlKQogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UKCiAgICAgICAgICAgICMgZHJhaW4gYW5kIHJldHVybiB0aGUgY29ubmVjdGlvbiB0byB0aGUgcG9vbCBiZWZvcmUgcmVjdXJzaW5nCiAgICAgICAgICAgIGRyYWluX2FuZF9yZWxlYXNlX2Nvbm4ocmVzcG9uc2UpCgogICAgICAgICAgICByZXRyaWVzLnNsZWVwX2Zvcl9yZXRyeShyZXNwb25zZSkKICAgICAgICAgICAgbG9nLmRlYnVnKCJSZWRpcmVjdGluZyAlcyAtPiAlcyIsIHVybCwgcmVkaXJlY3RfbG9jYXRpb24pCiAgICAgICAgICAgIHJldHVybiBzZWxmLnVybG9wZW4oCiAgICAgICAgICAgICAgICBtZXRob2QsIHJlZGlyZWN0X2xvY2F0aW9uLCBib2R5LCBoZWFkZXJzLAogICAgICAgICAgICAgICAgcmV0cmllcz1yZXRyaWVzLCByZWRpcmVjdD1yZWRpcmVjdCwKICAgICAgICAgICAgICAgIGFzc2VydF9zYW1lX2hvc3Q9YXNzZXJ0X3NhbWVfaG9zdCwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dCwgcG9vbF90aW1lb3V0PXBvb2xfdGltZW91dCwKICAgICAgICAgICAgICAgIHJlbGVhc2VfY29ubj1yZWxlYXNlX2Nvbm4sIGJvZHlfcG9zPWJvZHlfcG9zLAogICAgICAgICAgICAgICAgKipyZXNwb25zZV9rdykKCiAgICAgICAgIyBDaGVjayBpZiB3ZSBzaG91bGQgcmV0cnkgdGhlIEhUVFAgcmVzcG9uc2UuCiAgICAgICAgaGFzX3JldHJ5X2FmdGVyID0gYm9vbChyZXNwb25zZS5nZXRoZWFkZXIoJ1JldHJ5LUFmdGVyJykpCiAgICAgICAgaWYgcmV0cmllcy5pc19yZXRyeShtZXRob2QsIHJlc3BvbnNlLnN0YXR1cywgaGFzX3JldHJ5X2FmdGVyKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0cmllcyA9IHJldHJpZXMuaW5jcmVtZW50KG1ldGhvZCwgdXJsLCByZXNwb25zZT1yZXNwb25zZSwgX3Bvb2w9c2VsZikKICAgICAgICAgICAgZXhjZXB0IE1heFJldHJ5RXJyb3I6CiAgICAgICAgICAgICAgICBpZiByZXRyaWVzLnJhaXNlX29uX3N0YXR1czoKICAgICAgICAgICAgICAgICAgICAjIERyYWluIGFuZCByZWxlYXNlIHRoZSBjb25uZWN0aW9uIGZvciB0aGlzIHJlc3BvbnNlLCBzaW5jZQogICAgICAgICAgICAgICAgICAgICMgd2UncmUgbm90IHJldHVybmluZyBpdCB0byBiZSByZWxlYXNlZCBtYW51YWxseS4KICAgICAgICAgICAgICAgICAgICBkcmFpbl9hbmRfcmVsZWFzZV9jb25uKHJlc3BvbnNlKQogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UKCiAgICAgICAgICAgICMgZHJhaW4gYW5kIHJldHVybiB0aGUgY29ubmVjdGlvbiB0byB0aGUgcG9vbCBiZWZvcmUgcmVjdXJzaW5nCiAgICAgICAgICAgIGRyYWluX2FuZF9yZWxlYXNlX2Nvbm4ocmVzcG9uc2UpCgogICAgICAgICAgICByZXRyaWVzLnNsZWVwKHJlc3BvbnNlKQogICAgICAgICAgICBsb2cuZGVidWcoIlJldHJ5OiAlcyIsIHVybCkKICAgICAgICAgICAgcmV0dXJuIHNlbGYudXJsb3BlbigKICAgICAgICAgICAgICAgIG1ldGhvZCwgdXJsLCBib2R5LCBoZWFkZXJzLAogICAgICAgICAgICAgICAgcmV0cmllcz1yZXRyaWVzLCByZWRpcmVjdD1yZWRpcmVjdCwKICAgICAgICAgICAgICAgIGFzc2VydF9zYW1lX2hvc3Q9YXNzZXJ0X3NhbWVfaG9zdCwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dCwgcG9vbF90aW1lb3V0PXBvb2xfdGltZW91dCwKICAgICAgICAgICAgICAgIHJlbGVhc2VfY29ubj1yZWxlYXNlX2Nvbm4sCiAgICAgICAgICAgICAgICBib2R5X3Bvcz1ib2R5X3BvcywgKipyZXNwb25zZV9rdykKCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlCgoKY2xhc3MgSFRUUFNDb25uZWN0aW9uUG9vbChIVFRQQ29ubmVjdGlvblBvb2wpOgogICAgIiIiCiAgICBTYW1lIGFzIDpjbGFzczpgLkhUVFBDb25uZWN0aW9uUG9vbGAsIGJ1dCBIVFRQUy4KCiAgICBXaGVuIFB5dGhvbiBpcyBjb21waWxlZCB3aXRoIHRoZSA6bW9kOmBzc2xgIG1vZHVsZSwgdGhlbgogICAgOmNsYXNzOmAuVmVyaWZpZWRIVFRQU0Nvbm5lY3Rpb25gIGlzIHVzZWQsIHdoaWNoICpjYW4qIHZlcmlmeSBjZXJ0aWZpY2F0ZXMsCiAgICBpbnN0ZWFkIG9mIDpjbGFzczpgLkhUVFBTQ29ubmVjdGlvbmAuCgogICAgOmNsYXNzOmAuVmVyaWZpZWRIVFRQU0Nvbm5lY3Rpb25gIHVzZXMgb25lIG9mIGBgYXNzZXJ0X2ZpbmdlcnByaW50YGAsCiAgICBgYGFzc2VydF9ob3N0bmFtZWBgIGFuZCBgYGhvc3RgYCBpbiB0aGlzIG9yZGVyIHRvIHZlcmlmeSBjb25uZWN0aW9ucy4KICAgIElmIGBgYXNzZXJ0X2hvc3RuYW1lYGAgaXMgRmFsc2UsIG5vIHZlcmlmaWNhdGlvbiBpcyBkb25lLgoKICAgIFRoZSBgYGtleV9maWxlYGAsIGBgY2VydF9maWxlYGAsIGBgY2VydF9yZXFzYGAsIGBgY2FfY2VydHNgYCwKICAgIGBgY2FfY2VydF9kaXJgYCwgYW5kIGBgc3NsX3ZlcnNpb25gYCBhcmUgb25seSB1c2VkIGlmIDptb2Q6YHNzbGAgaXMKICAgIGF2YWlsYWJsZSBhbmQgYXJlIGZlZCBpbnRvIDptZXRoOmB1cmxsaWIzLnV0aWwuc3NsX3dyYXBfc29ja2V0YCB0byB1cGdyYWRlCiAgICB0aGUgY29ubmVjdGlvbiBzb2NrZXQgaW50byBhbiBTU0wgc29ja2V0LgogICAgIiIiCgogICAgc2NoZW1lID0gJ2h0dHBzJwogICAgQ29ubmVjdGlvbkNscyA9IEhUVFBTQ29ubmVjdGlvbgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBob3N0LCBwb3J0PU5vbmUsCiAgICAgICAgICAgICAgICAgc3RyaWN0PUZhbHNlLCB0aW1lb3V0PVRpbWVvdXQuREVGQVVMVF9USU1FT1VULCBtYXhzaXplPTEsCiAgICAgICAgICAgICAgICAgYmxvY2s9RmFsc2UsIGhlYWRlcnM9Tm9uZSwgcmV0cmllcz1Ob25lLAogICAgICAgICAgICAgICAgIF9wcm94eT1Ob25lLCBfcHJveHlfaGVhZGVycz1Ob25lLAogICAgICAgICAgICAgICAgIGtleV9maWxlPU5vbmUsIGNlcnRfZmlsZT1Ob25lLCBjZXJ0X3JlcXM9Tm9uZSwKICAgICAgICAgICAgICAgICBjYV9jZXJ0cz1Ob25lLCBzc2xfdmVyc2lvbj1Ob25lLAogICAgICAgICAgICAgICAgIGFzc2VydF9ob3N0bmFtZT1Ob25lLCBhc3NlcnRfZmluZ2VycHJpbnQ9Tm9uZSwKICAgICAgICAgICAgICAgICBjYV9jZXJ0X2Rpcj1Ob25lLCAqKmNvbm5fa3cpOgoKICAgICAgICBIVFRQQ29ubmVjdGlvblBvb2wuX19pbml0X18oc2VsZiwgaG9zdCwgcG9ydCwgc3RyaWN0LCB0aW1lb3V0LCBtYXhzaXplLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jaywgaGVhZGVycywgcmV0cmllcywgX3Byb3h5LCBfcHJveHlfaGVhZGVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKipjb25uX2t3KQoKICAgICAgICBpZiBjYV9jZXJ0cyBhbmQgY2VydF9yZXFzIGlzIE5vbmU6CiAgICAgICAgICAgIGNlcnRfcmVxcyA9ICdDRVJUX1JFUVVJUkVEJwoKICAgICAgICBzZWxmLmtleV9maWxlID0ga2V5X2ZpbGUKICAgICAgICBzZWxmLmNlcnRfZmlsZSA9IGNlcnRfZmlsZQogICAgICAgIHNlbGYuY2VydF9yZXFzID0gY2VydF9yZXFzCiAgICAgICAgc2VsZi5jYV9jZXJ0cyA9IGNhX2NlcnRzCiAgICAgICAgc2VsZi5jYV9jZXJ0X2RpciA9IGNhX2NlcnRfZGlyCiAgICAgICAgc2VsZi5zc2xfdmVyc2lvbiA9IHNzbF92ZXJzaW9uCiAgICAgICAgc2VsZi5hc3NlcnRfaG9zdG5hbWUgPSBhc3NlcnRfaG9zdG5hbWUKICAgICAgICBzZWxmLmFzc2VydF9maW5nZXJwcmludCA9IGFzc2VydF9maW5nZXJwcmludAoKICAgIGRlZiBfcHJlcGFyZV9jb25uKHNlbGYsIGNvbm4pOgogICAgICAgICIiIgogICAgICAgIFByZXBhcmUgdGhlIGBgY29ubmVjdGlvbmBgIGZvciA6bWV0aDpgdXJsbGliMy51dGlsLnNzbF93cmFwX3NvY2tldGAKICAgICAgICBhbmQgZXN0YWJsaXNoIHRoZSB0dW5uZWwgaWYgcHJveHkgaXMgdXNlZC4KICAgICAgICAiIiIKCiAgICAgICAgaWYgaXNpbnN0YW5jZShjb25uLCBWZXJpZmllZEhUVFBTQ29ubmVjdGlvbik6CiAgICAgICAgICAgIGNvbm4uc2V0X2NlcnQoa2V5X2ZpbGU9c2VsZi5rZXlfZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICBjZXJ0X2ZpbGU9c2VsZi5jZXJ0X2ZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2VydF9yZXFzPXNlbGYuY2VydF9yZXFzLAogICAgICAgICAgICAgICAgICAgICAgICAgIGNhX2NlcnRzPXNlbGYuY2FfY2VydHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FfY2VydF9kaXI9c2VsZi5jYV9jZXJ0X2RpciwKICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnRfaG9zdG5hbWU9c2VsZi5hc3NlcnRfaG9zdG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0X2ZpbmdlcnByaW50PXNlbGYuYXNzZXJ0X2ZpbmdlcnByaW50KQogICAgICAgICAgICBjb25uLnNzbF92ZXJzaW9uID0gc2VsZi5zc2xfdmVyc2lvbgogICAgICAgIHJldHVybiBjb25uCgogICAgZGVmIF9wcmVwYXJlX3Byb3h5KHNlbGYsIGNvbm4pOgogICAgICAgICIiIgogICAgICAgIEVzdGFibGlzaCB0dW5uZWwgY29ubmVjdGlvbiBlYXJseSwgYmVjYXVzZSBvdGhlcndpc2UgaHR0cGxpYgogICAgICAgIHdvdWxkIGltcHJvcGVybHkgc2V0IEhvc3Q6IGhlYWRlciB0byBwcm94eSdzIElQOnBvcnQuCiAgICAgICAgIiIiCiAgICAgICAgY29ubi5zZXRfdHVubmVsKHNlbGYuX3Byb3h5X2hvc3QsIHNlbGYucG9ydCwgc2VsZi5wcm94eV9oZWFkZXJzKQogICAgICAgIGNvbm4uY29ubmVjdCgpCgogICAgZGVmIF9uZXdfY29ubihzZWxmKToKICAgICAgICAiIiIKICAgICAgICBSZXR1cm4gYSBmcmVzaCA6Y2xhc3M6YGh0dHBsaWIuSFRUUFNDb25uZWN0aW9uYC4KICAgICAgICAiIiIKICAgICAgICBzZWxmLm51bV9jb25uZWN0aW9ucyArPSAxCiAgICAgICAgbG9nLmRlYnVnKCJTdGFydGluZyBuZXcgSFRUUFMgY29ubmVjdGlvbiAoJWQpOiAlczolcyIsCiAgICAgICAgICAgICAgICAgIHNlbGYubnVtX2Nvbm5lY3Rpb25zLCBzZWxmLmhvc3QsIHNlbGYucG9ydCBvciAiNDQzIikKCiAgICAgICAgaWYgbm90IHNlbGYuQ29ubmVjdGlvbkNscyBvciBzZWxmLkNvbm5lY3Rpb25DbHMgaXMgRHVtbXlDb25uZWN0aW9uOgogICAgICAgICAgICByYWlzZSBTU0xFcnJvcigiQ2FuJ3QgY29ubmVjdCB0byBIVFRQUyBVUkwgYmVjYXVzZSB0aGUgU1NMICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1vZHVsZSBpcyBub3QgYXZhaWxhYmxlLiIpCgogICAgICAgIGFjdHVhbF9ob3N0ID0gc2VsZi5ob3N0CiAgICAgICAgYWN0dWFsX3BvcnQgPSBzZWxmLnBvcnQKICAgICAgICBpZiBzZWxmLnByb3h5IGlzIG5vdCBOb25lOgogICAgICAgICAgICBhY3R1YWxfaG9zdCA9IHNlbGYucHJveHkuaG9zdAogICAgICAgICAgICBhY3R1YWxfcG9ydCA9IHNlbGYucHJveHkucG9ydAoKICAgICAgICBjb25uID0gc2VsZi5Db25uZWN0aW9uQ2xzKGhvc3Q9YWN0dWFsX2hvc3QsIHBvcnQ9YWN0dWFsX3BvcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PXNlbGYudGltZW91dC5jb25uZWN0X3RpbWVvdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpY3Q9c2VsZi5zdHJpY3QsICoqc2VsZi5jb25uX2t3KQoKICAgICAgICByZXR1cm4gc2VsZi5fcHJlcGFyZV9jb25uKGNvbm4pCgogICAgZGVmIF92YWxpZGF0ZV9jb25uKHNlbGYsIGNvbm4pOgogICAgICAgICIiIgogICAgICAgIENhbGxlZCByaWdodCBiZWZvcmUgYSByZXF1ZXN0IGlzIG1hZGUsIGFmdGVyIHRoZSBzb2NrZXQgaXMgY3JlYXRlZC4KICAgICAgICAiIiIKICAgICAgICBzdXBlcihIVFRQU0Nvbm5lY3Rpb25Qb29sLCBzZWxmKS5fdmFsaWRhdGVfY29ubihjb25uKQoKICAgICAgICAjIEZvcmNlIGNvbm5lY3QgZWFybHkgdG8gYWxsb3cgdXMgdG8gdmFsaWRhdGUgdGhlIGNvbm5lY3Rpb24uCiAgICAgICAgaWYgbm90IGdldGF0dHIoY29ubiwgJ3NvY2snLCBOb25lKTogICMgQXBwRW5naW5lIG1pZ2h0IG5vdCBoYXZlICBgLnNvY2tgCiAgICAgICAgICAgIGNvbm4uY29ubmVjdCgpCgogICAgICAgIGlmIG5vdCBjb25uLmlzX3ZlcmlmaWVkOgogICAgICAgICAgICB3YXJuaW5ncy53YXJuKCgKICAgICAgICAgICAgICAgICdVbnZlcmlmaWVkIEhUVFBTIHJlcXVlc3QgaXMgYmVpbmcgbWFkZS4gJwogICAgICAgICAgICAgICAgJ0FkZGluZyBjZXJ0aWZpY2F0ZSB2ZXJpZmljYXRpb24gaXMgc3Ryb25nbHkgYWR2aXNlZC4gU2VlOiAnCiAgICAgICAgICAgICAgICAnaHR0cHM6Ly91cmxsaWIzLnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC9hZHZhbmNlZC11c2FnZS5odG1sJwogICAgICAgICAgICAgICAgJyNzc2wtd2FybmluZ3MnKSwKICAgICAgICAgICAgICAgIEluc2VjdXJlUmVxdWVzdFdhcm5pbmcpCgoKZGVmIGNvbm5lY3Rpb25fZnJvbV91cmwodXJsLCAqKmt3KToKICAgICIiIgogICAgR2l2ZW4gYSB1cmwsIHJldHVybiBhbiA6Y2xhc3M6YC5Db25uZWN0aW9uUG9vbGAgaW5zdGFuY2Ugb2YgaXRzIGhvc3QuCgogICAgVGhpcyBpcyBhIHNob3J0Y3V0IGZvciBub3QgaGF2aW5nIHRvIHBhcnNlIG91dCB0aGUgc2NoZW1lLCBob3N0LCBhbmQgcG9ydAogICAgb2YgdGhlIHVybCBiZWZvcmUgY3JlYXRpbmcgYW4gOmNsYXNzOmAuQ29ubmVjdGlvblBvb2xgIGluc3RhbmNlLgoKICAgIDpwYXJhbSB1cmw6CiAgICAgICAgQWJzb2x1dGUgVVJMIHN0cmluZyB0aGF0IG11c3QgaW5jbHVkZSB0aGUgc2NoZW1lLiBQb3J0IGlzIG9wdGlvbmFsLgoKICAgIDpwYXJhbSBcXCoqa3c6CiAgICAgICAgUGFzc2VzIGFkZGl0aW9uYWwgcGFyYW1ldGVycyB0byB0aGUgY29uc3RydWN0b3Igb2YgdGhlIGFwcHJvcHJpYXRlCiAgICAgICAgOmNsYXNzOmAuQ29ubmVjdGlvblBvb2xgLiBVc2VmdWwgZm9yIHNwZWNpZnlpbmcgdGhpbmdzIGxpa2UKICAgICAgICB0aW1lb3V0LCBtYXhzaXplLCBoZWFkZXJzLCBldGMuCgogICAgRXhhbXBsZTo6CgogICAgICAgID4+PiBjb25uID0gY29ubmVjdGlvbl9mcm9tX3VybCgnaHR0cDovL2dvb2dsZS5jb20vJykKICAgICAgICA+Pj4gciA9IGNvbm4ucmVxdWVzdCgnR0VUJywgJy8nKQogICAgIiIiCiAgICBzY2hlbWUsIGhvc3QsIHBvcnQgPSBnZXRfaG9zdCh1cmwpCiAgICBwb3J0ID0gcG9ydCBvciBwb3J0X2J5X3NjaGVtZS5nZXQoc2NoZW1lLCA4MCkKICAgIGlmIHNjaGVtZSA9PSAnaHR0cHMnOgogICAgICAgIHJldHVybiBIVFRQU0Nvbm5lY3Rpb25Qb29sKGhvc3QsIHBvcnQ9cG9ydCwgKiprdykKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIEhUVFBDb25uZWN0aW9uUG9vbChob3N0LCBwb3J0PXBvcnQsICoqa3cpCgoKZGVmIF9pcHY2X2hvc3QoaG9zdCwgc2NoZW1lKToKICAgICIiIgogICAgUHJvY2VzcyBJUHY2IGFkZHJlc3MgbGl0ZXJhbHMKICAgICIiIgoKICAgICMgaHR0cGxpYiBkb2Vzbid0IGxpa2UgaXQgd2hlbiB3ZSBpbmNsdWRlIGJyYWNrZXRzIGluIElQdjYgYWRkcmVzc2VzCiAgICAjIFNwZWNpZmljYWxseSwgaWYgd2UgaW5jbHVkZSBicmFja2V0cyBidXQgYWxzbyBwYXNzIHRoZSBwb3J0IHRoZW4KICAgICMgaHR0cGxpYiBjcmF6aWx5IGRvdWJsZXMgdXAgdGhlIHNxdWFyZSBicmFja2V0cyBvbiB0aGUgSG9zdCBoZWFkZXIuCiAgICAjIEluc3RlYWQsIHdlIG5lZWQgdG8gbWFrZSBzdXJlIHdlIG5ldmVyIHBhc3MgYGBOb25lYGAgYXMgdGhlIHBvcnQuCiAgICAjIEhvd2V2ZXIsIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IHJlYXNvbnMgd2UgY2FuJ3QgYWN0dWFsbHkKICAgICMgKmFzc2VydCogdGhhdC4gIFNlZSBodHRwOi8vYnVncy5weXRob24ub3JnL2lzc3VlMjg1MzkKICAgICMKICAgICMgQWxzbyBpZiBhbiBJUHY2IGFkZHJlc3MgbGl0ZXJhbCBoYXMgYSB6b25lIGlkZW50aWZpZXIsIHRoZQogICAgIyBwZXJjZW50IHNpZ24gbWlnaHQgYmUgVVJJZW5jb2RlZCwgY29udmVydCBpdCBiYWNrIGludG8gQVNDSUkKICAgIGlmIGhvc3Quc3RhcnRzd2l0aCgnWycpIGFuZCBob3N0LmVuZHN3aXRoKCddJyk6CiAgICAgICAgaG9zdCA9IGhvc3QucmVwbGFjZSgnJTI1JywgJyUnKS5zdHJpcCgnW10nKQogICAgaWYgc2NoZW1lIGluIE5PUk1BTElaQUJMRV9TQ0hFTUVTOgogICAgICAgIGhvc3QgPSBob3N0Lmxvd2VyKCkKICAgIHJldHVybiBob3N0Cg==
