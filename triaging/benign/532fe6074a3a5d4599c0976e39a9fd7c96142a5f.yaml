statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/player.py
  contents:
  - name: AudioPlayer.resume
    score: 0.0
    code: |-
      def resume(self, *, update_speaking=True):
              self.loops = 0
              self._start = time.perf_counter()
              self._resumed.set()
              if update_speaking:
                  self._speak(True)
    tokens: resume load_const INTEGER load_fast self store_attr loops load_global time load_attr perf_counter call load_fast self store_attr _start load_fast self load_attr _resumed load_attr set call pop_top load_fast update_speaking pop_jump_if_false TO_NUMBER load_fast self load_attr _speak load_const INTEGER call pop_top return_const None return_const None
    hash: d00a816da10460c99c7277101f4b3a4207133992f9ddf6d45b259bce166cba75
sources:
  .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/player.py: IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KCiIiIgpUaGUgTUlUIExpY2Vuc2UgKE1JVCkKCkNvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50IFJhcHB0egoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgp0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlClNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCk9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwpGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSCkRFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KIiIiCgppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCB0cmFjZWJhY2sKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGF1ZGlvb3AKaW1wb3J0IGFzeW5jaW8KaW1wb3J0IGxvZ2dpbmcKaW1wb3J0IHNobGV4CmltcG9ydCB0aW1lCmltcG9ydCBqc29uCmltcG9ydCBzeXMKaW1wb3J0IHJlCgpmcm9tIC5lcnJvcnMgaW1wb3J0IENsaWVudEV4Y2VwdGlvbgpmcm9tIC5vcHVzIGltcG9ydCBFbmNvZGVyIGFzIE9wdXNFbmNvZGVyCmZyb20gLm9nZ3BhcnNlIGltcG9ydCBPZ2dTdHJlYW0KCmxvZyA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQoKX19hbGxfXyA9ICgKICAgICdBdWRpb1NvdXJjZScsCiAgICAnUENNQXVkaW8nLAogICAgJ0ZGbXBlZ0F1ZGlvJywKICAgICdGRm1wZWdQQ01BdWRpbycsCiAgICAnRkZtcGVnT3B1c0F1ZGlvJywKICAgICdQQ01Wb2x1bWVUcmFuc2Zvcm1lcicsCikKCmlmIHN5cy5wbGF0Zm9ybSAhPSAnd2luMzInOgogICAgQ1JFQVRFX05PX1dJTkRPVyA9IDAKZWxzZToKICAgIENSRUFURV9OT19XSU5ET1cgPSAweDA4MDAwMDAwCgpjbGFzcyBBdWRpb1NvdXJjZToKICAgICIiIlJlcHJlc2VudHMgYW4gYXVkaW8gc3RyZWFtLgoKICAgIFRoZSBhdWRpbyBzdHJlYW0gY2FuIGJlIE9wdXMgZW5jb2RlZCBvciBub3QsIGhvd2V2ZXIgaWYgdGhlIGF1ZGlvIHN0cmVhbQogICAgaXMgbm90IE9wdXMgZW5jb2RlZCB0aGVuIHRoZSBhdWRpbyBmb3JtYXQgbXVzdCBiZSAxNi1iaXQgNDhLSHogc3RlcmVvIFBDTS4KCiAgICAuLiB3YXJuaW5nOjoKCiAgICAgICAgVGhlIGF1ZGlvIHNvdXJjZSByZWFkcyBhcmUgZG9uZSBpbiBhIHNlcGFyYXRlIHRocmVhZC4KICAgICIiIgoKICAgIGRlZiByZWFkKHNlbGYpOgogICAgICAgICIiIlJlYWRzIDIwbXMgd29ydGggb2YgYXVkaW8uCgogICAgICAgIFN1YmNsYXNzZXMgbXVzdCBpbXBsZW1lbnQgdGhpcy4KCiAgICAgICAgSWYgdGhlIGF1ZGlvIGlzIGNvbXBsZXRlLCB0aGVuIHJldHVybmluZyBhbiBlbXB0eQogICAgICAgIDp0ZXJtOmBweTpieXRlcy1saWtlIG9iamVjdGAgdG8gc2lnbmFsIHRoaXMgaXMgdGhlIHdheSB0byBkbyBzby4KCiAgICAgICAgSWYgOm1ldGg6YGlzX29wdXNgIG1ldGhvZCByZXR1cm5zIGBgVHJ1ZWBgLCB0aGVuIGl0IG11c3QgcmV0dXJuCiAgICAgICAgMjBtcyB3b3J0aCBvZiBPcHVzIGVuY29kZWQgYXVkaW8uIE90aGVyd2lzZSwgaXQgbXVzdCBiZSAyMG1zCiAgICAgICAgd29ydGggb2YgMTYtYml0IDQ4S0h6IHN0ZXJlbyBQQ00sIHdoaWNoIGlzIGFib3V0IDMsODQwIGJ5dGVzCiAgICAgICAgcGVyIGZyYW1lICgyMG1zIHdvcnRoIG9mIGF1ZGlvKS4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgOmNsYXNzOmBieXRlc2AKICAgICAgICAgICAgQSBieXRlcyBsaWtlIG9iamVjdCB0aGF0IHJlcHJlc2VudHMgdGhlIFBDTSBvciBPcHVzIGRhdGEuCiAgICAgICAgIiIiCiAgICAgICAgcmFpc2UgTm90SW1wbGVtZW50ZWRFcnJvcgoKICAgIGRlZiBpc19vcHVzKHNlbGYpOgogICAgICAgICIiIkNoZWNrcyBpZiB0aGUgYXVkaW8gc291cmNlIGlzIGFscmVhZHkgZW5jb2RlZCBpbiBPcHVzLiIiIgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBjbGVhbnVwKHNlbGYpOgogICAgICAgICIiIkNhbGxlZCB3aGVuIGNsZWFuLXVwIGlzIG5lZWRlZCB0byBiZSBkb25lLgoKICAgICAgICBVc2VmdWwgZm9yIGNsZWFyaW5nIGJ1ZmZlciBkYXRhIG9yIHByb2Nlc3NlcyBhZnRlcgogICAgICAgIGl0IGlzIGRvbmUgcGxheWluZyBhdWRpby4KICAgICAgICAiIiIKICAgICAgICBwYXNzCgogICAgZGVmIF9fZGVsX18oc2VsZik6CiAgICAgICAgc2VsZi5jbGVhbnVwKCkKCmNsYXNzIFBDTUF1ZGlvKEF1ZGlvU291cmNlKToKICAgICIiIlJlcHJlc2VudHMgcmF3IDE2LWJpdCA0OEtIeiBzdGVyZW8gUENNIGF1ZGlvIHNvdXJjZS4KCiAgICBBdHRyaWJ1dGVzCiAgICAtLS0tLS0tLS0tLQogICAgc3RyZWFtOiA6dGVybTpgcHk6ZmlsZSBvYmplY3RgCiAgICAgICAgQSBmaWxlLWxpa2Ugb2JqZWN0IHRoYXQgcmVhZHMgYnl0ZSBkYXRhIHJlcHJlc2VudGluZyByYXcgUENNLgogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgc3RyZWFtKToKICAgICAgICBzZWxmLnN0cmVhbSA9IHN0cmVhbQoKICAgIGRlZiByZWFkKHNlbGYpOgogICAgICAgIHJldCA9IHNlbGYuc3RyZWFtLnJlYWQoT3B1c0VuY29kZXIuRlJBTUVfU0laRSkKICAgICAgICBpZiBsZW4ocmV0KSAhPSBPcHVzRW5jb2Rlci5GUkFNRV9TSVpFOgogICAgICAgICAgICByZXR1cm4gYicnCiAgICAgICAgcmV0dXJuIHJldAoKY2xhc3MgRkZtcGVnQXVkaW8oQXVkaW9Tb3VyY2UpOgogICAgIiIiUmVwcmVzZW50cyBhbiBGRm1wZWcgKG9yIEFWQ29udikgYmFzZWQgQXVkaW9Tb3VyY2UuCgogICAgVXNlciBjcmVhdGVkIEF1ZGlvU291cmNlcyB1c2luZyBGRm1wZWcgZGlmZmVyZW50bHkgZnJvbSBob3cgOmNsYXNzOmBGRm1wZWdQQ01BdWRpb2AgYW5kCiAgICA6Y2xhc3M6YEZGbXBlZ09wdXNBdWRpb2Agd29yayBzaG91bGQgc3ViY2xhc3MgdGhpcy4KCiAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjMKICAgICIiIgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzb3VyY2UsICosIGV4ZWN1dGFibGU9J2ZmbXBlZycsIGFyZ3MsICoqc3VicHJvY2Vzc19rd2FyZ3MpOgogICAgICAgIHNlbGYuX3Byb2Nlc3MgPSBzZWxmLl9zdGRvdXQgPSBOb25lCgogICAgICAgIGFyZ3MgPSBbZXhlY3V0YWJsZSwgKmFyZ3NdCiAgICAgICAga3dhcmdzID0geydzdGRvdXQnOiBzdWJwcm9jZXNzLlBJUEV9CiAgICAgICAga3dhcmdzLnVwZGF0ZShzdWJwcm9jZXNzX2t3YXJncykKCiAgICAgICAgc2VsZi5fcHJvY2VzcyA9IHNlbGYuX3NwYXduX3Byb2Nlc3MoYXJncywgKiprd2FyZ3MpCiAgICAgICAgc2VsZi5fc3Rkb3V0ID0gc2VsZi5fcHJvY2Vzcy5zdGRvdXQKCiAgICBkZWYgX3NwYXduX3Byb2Nlc3Moc2VsZiwgYXJncywgKipzdWJwcm9jZXNzX2t3YXJncyk6CiAgICAgICAgcHJvY2VzcyA9IE5vbmUKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByb2Nlc3MgPSBzdWJwcm9jZXNzLlBvcGVuKGFyZ3MsIGNyZWF0aW9uZmxhZ3M9Q1JFQVRFX05PX1dJTkRPVywgKipzdWJwcm9jZXNzX2t3YXJncykKICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgIGV4ZWN1dGFibGUgPSBhcmdzLnBhcnRpdGlvbignICcpWzBdIGlmIGlzaW5zdGFuY2UoYXJncywgc3RyKSBlbHNlIGFyZ3NbMF0KICAgICAgICAgICAgcmFpc2UgQ2xpZW50RXhjZXB0aW9uKGV4ZWN1dGFibGUgKyAnIHdhcyBub3QgZm91bmQuJykgZnJvbSBOb25lCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuU3VicHJvY2Vzc0Vycm9yIGFzIGV4YzoKICAgICAgICAgICAgcmFpc2UgQ2xpZW50RXhjZXB0aW9uKCdQb3BlbiBmYWlsZWQ6IHswLl9fY2xhc3NfXy5fX25hbWVfX306IHswfScuZm9ybWF0KGV4YykpIGZyb20gZXhjCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3MKCiAgICBkZWYgY2xlYW51cChzZWxmKToKICAgICAgICBwcm9jID0gc2VsZi5fcHJvY2VzcwogICAgICAgIGlmIHByb2MgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGxvZy5pbmZvKCdQcmVwYXJpbmcgdG8gdGVybWluYXRlIGZmbXBlZyBwcm9jZXNzICVzLicsIHByb2MucGlkKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByb2Mua2lsbCgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgbG9nLmV4Y2VwdGlvbigiSWdub3JpbmcgZXJyb3IgYXR0ZW1wdGluZyB0byBraWxsIGZmbXBlZyBwcm9jZXNzICVzIiwgcHJvYy5waWQpCgogICAgICAgIGlmIHByb2MucG9sbCgpIGlzIE5vbmU6CiAgICAgICAgICAgIGxvZy5pbmZvKCdmZm1wZWcgcHJvY2VzcyAlcyBoYXMgbm90IHRlcm1pbmF0ZWQuIFdhaXRpbmcgdG8gdGVybWluYXRlLi4uJywgcHJvYy5waWQpCiAgICAgICAgICAgIHByb2MuY29tbXVuaWNhdGUoKQogICAgICAgICAgICBsb2cuaW5mbygnZmZtcGVnIHByb2Nlc3MgJXMgc2hvdWxkIGhhdmUgdGVybWluYXRlZCB3aXRoIGEgcmV0dXJuIGNvZGUgb2YgJXMuJywgcHJvYy5waWQsIHByb2MucmV0dXJuY29kZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2cuaW5mbygnZmZtcGVnIHByb2Nlc3MgJXMgc3VjY2Vzc2Z1bGx5IHRlcm1pbmF0ZWQgd2l0aCByZXR1cm4gY29kZSBvZiAlcy4nLCBwcm9jLnBpZCwgcHJvYy5yZXR1cm5jb2RlKQoKICAgICAgICBzZWxmLl9wcm9jZXNzID0gc2VsZi5fc3Rkb3V0ID0gTm9uZQoKY2xhc3MgRkZtcGVnUENNQXVkaW8oRkZtcGVnQXVkaW8pOgogICAgIiIiQW4gYXVkaW8gc291cmNlIGZyb20gRkZtcGVnIChvciBBVkNvbnYpLgoKICAgIFRoaXMgbGF1bmNoZXMgYSBzdWItcHJvY2VzcyB0byBhIHNwZWNpZmljIGlucHV0IGZpbGUgZ2l2ZW4uCgogICAgLi4gd2FybmluZzo6CgogICAgICAgIFlvdSBtdXN0IGhhdmUgdGhlIGZmbXBlZyBvciBhdmNvbnYgZXhlY3V0YWJsZSBpbiB5b3VyIHBhdGggZW52aXJvbm1lbnQKICAgICAgICB2YXJpYWJsZSBpbiBvcmRlciBmb3IgdGhpcyB0byB3b3JrLgoKICAgIFBhcmFtZXRlcnMKICAgIC0tLS0tLS0tLS0tLQogICAgc291cmNlOiBVbmlvbls6Y2xhc3M6YHN0cmAsIDpjbGFzczpgaW8uQnVmZmVyZWRJT0Jhc2VgXQogICAgICAgIFRoZSBpbnB1dCB0aGF0IGZmbXBlZyB3aWxsIHRha2UgYW5kIGNvbnZlcnQgdG8gUENNIGJ5dGVzLgogICAgICAgIElmIGBgcGlwZWBgIGlzIGBgVHJ1ZWBgIHRoZW4gdGhpcyBpcyBhIGZpbGUtbGlrZSBvYmplY3QgdGhhdCBpcwogICAgICAgIHBhc3NlZCB0byB0aGUgc3RkaW4gb2YgZmZtcGVnLgogICAgZXhlY3V0YWJsZTogOmNsYXNzOmBzdHJgCiAgICAgICAgVGhlIGV4ZWN1dGFibGUgbmFtZSAoYW5kIHBhdGgpIHRvIHVzZS4gRGVmYXVsdHMgdG8gYGBmZm1wZWdgYC4KICAgIHBpcGU6IDpjbGFzczpgYm9vbGAKICAgICAgICBJZiBgYFRydWVgYCwgZGVub3RlcyB0aGF0IGBgc291cmNlYGAgcGFyYW1ldGVyIHdpbGwgYmUgcGFzc2VkCiAgICAgICAgdG8gdGhlIHN0ZGluIG9mIGZmbXBlZy4gRGVmYXVsdHMgdG8gYGBGYWxzZWBgLgogICAgc3RkZXJyOiBPcHRpb25hbFs6dGVybTpgcHk6ZmlsZSBvYmplY3RgXQogICAgICAgIEEgZmlsZS1saWtlIG9iamVjdCB0byBwYXNzIHRvIHRoZSBQb3BlbiBjb25zdHJ1Y3Rvci4KICAgICAgICBDb3VsZCBhbHNvIGJlIGFuIGluc3RhbmNlIG9mIGBgc3VicHJvY2Vzcy5QSVBFYGAuCiAgICBiZWZvcmVfb3B0aW9uczogT3B0aW9uYWxbOmNsYXNzOmBzdHJgXQogICAgICAgIEV4dHJhIGNvbW1hbmQgbGluZSBhcmd1bWVudHMgdG8gcGFzcyB0byBmZm1wZWcgYmVmb3JlIHRoZSBgYC1pYGAgZmxhZy4KICAgIG9wdGlvbnM6IE9wdGlvbmFsWzpjbGFzczpgc3RyYF0KICAgICAgICBFeHRyYSBjb21tYW5kIGxpbmUgYXJndW1lbnRzIHRvIHBhc3MgdG8gZmZtcGVnIGFmdGVyIHRoZSBgYC1pYGAgZmxhZy4KCiAgICBSYWlzZXMKICAgIC0tLS0tLS0tCiAgICBDbGllbnRFeGNlcHRpb24KICAgICAgICBUaGUgc3VicHJvY2VzcyBmYWlsZWQgdG8gYmUgY3JlYXRlZC4KICAgICIiIgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzb3VyY2UsICosIGV4ZWN1dGFibGU9J2ZmbXBlZycsIHBpcGU9RmFsc2UsIHN0ZGVycj1Ob25lLCBiZWZvcmVfb3B0aW9ucz1Ob25lLCBvcHRpb25zPU5vbmUpOgogICAgICAgIGFyZ3MgPSBbXQogICAgICAgIHN1YnByb2Nlc3Nfa3dhcmdzID0geydzdGRpbic6IHNvdXJjZSBpZiBwaXBlIGVsc2Ugc3VicHJvY2Vzcy5ERVZOVUxMLCAnc3RkZXJyJzogc3RkZXJyfQoKICAgICAgICBpZiBpc2luc3RhbmNlKGJlZm9yZV9vcHRpb25zLCBzdHIpOgogICAgICAgICAgICBhcmdzLmV4dGVuZChzaGxleC5zcGxpdChiZWZvcmVfb3B0aW9ucykpCgogICAgICAgIGFyZ3MuYXBwZW5kKCctaScpCiAgICAgICAgYXJncy5hcHBlbmQoJy0nIGlmIHBpcGUgZWxzZSBzb3VyY2UpCiAgICAgICAgYXJncy5leHRlbmQoKCctZicsICdzMTZsZScsICctYXInLCAnNDgwMDAnLCAnLWFjJywgJzInLCAnLWxvZ2xldmVsJywgJ3dhcm5pbmcnKSkKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvcHRpb25zLCBzdHIpOgogICAgICAgICAgICBhcmdzLmV4dGVuZChzaGxleC5zcGxpdChvcHRpb25zKSkKCiAgICAgICAgYXJncy5hcHBlbmQoJ3BpcGU6MScpCgogICAgICAgIHN1cGVyKCkuX19pbml0X18oc291cmNlLCBleGVjdXRhYmxlPWV4ZWN1dGFibGUsIGFyZ3M9YXJncywgKipzdWJwcm9jZXNzX2t3YXJncykKCiAgICBkZWYgcmVhZChzZWxmKToKICAgICAgICByZXQgPSBzZWxmLl9zdGRvdXQucmVhZChPcHVzRW5jb2Rlci5GUkFNRV9TSVpFKQogICAgICAgIGlmIGxlbihyZXQpICE9IE9wdXNFbmNvZGVyLkZSQU1FX1NJWkU6CiAgICAgICAgICAgIHJldHVybiBiJycKICAgICAgICByZXR1cm4gcmV0CgogICAgZGVmIGlzX29wdXMoc2VsZik6CiAgICAgICAgcmV0dXJuIEZhbHNlCgpjbGFzcyBGRm1wZWdPcHVzQXVkaW8oRkZtcGVnQXVkaW8pOgogICAgIiIiQW4gYXVkaW8gc291cmNlIGZyb20gRkZtcGVnIChvciBBVkNvbnYpLgoKICAgIFRoaXMgbGF1bmNoZXMgYSBzdWItcHJvY2VzcyB0byBhIHNwZWNpZmljIGlucHV0IGZpbGUgZ2l2ZW4uICBIb3dldmVyLCByYXRoZXIgdGhhbgogICAgcHJvZHVjaW5nIFBDTSBwYWNrZXRzIGxpa2UgOmNsYXNzOmBGRm1wZWdQQ01BdWRpb2AgZG9lcyB0aGF0IG5lZWQgdG8gYmUgZW5jb2RlZCB0bwogICAgT3B1cywgdGhpcyBjbGFzcyBwcm9kdWNlcyBPcHVzIHBhY2tldHMsIHNraXBwaW5nIHRoZSBlbmNvZGluZyBzdGVwIGRvbmUgYnkgdGhlIGxpYnJhcnkuCgogICAgQWx0ZXJuYXRpdmVseSwgaW5zdGVhZCBvZiBpbnN0YW50aWF0aW5nIHRoaXMgY2xhc3MgZGlyZWN0bHksIHlvdSBjYW4gdXNlCiAgICA6bWV0aDpgRkZtcGVnT3B1c0F1ZGlvLmZyb21fcHJvYmVgIHRvIHByb2JlIGZvciBiaXRyYXRlIGFuZCBjb2RlYyBpbmZvcm1hdGlvbi4gIFRoaXMKICAgIGNhbiBiZSB1c2VkIHRvIG9wcG9ydHVuaXN0aWNhbGx5IHNraXAgcG9pbnRsZXNzIHJlLWVuY29kaW5nIG9mIGV4aXN0aW5nIE9wdXMgYXVkaW8gZGF0YQogICAgZm9yIGEgYm9vc3QgaW4gcGVyZm9ybWFuY2UgYXQgdGhlIGNvc3Qgb2YgYSBzaG9ydCBpbml0aWFsIGRlbGF5IHRvIGdhdGhlciB0aGUgaW5mb3JtYXRpb24uCiAgICBUaGUgc2FtZSBjYW4gYmUgYWNoaWV2ZWQgYnkgcGFzc2luZyBgYGNvcHlgYCB0byB0aGUgYGBjb2RlY2BgIHBhcmFtZXRlciwgYnV0IG9ubHkgaWYgeW91CiAgICBrbm93IHRoYXQgdGhlIGlucHV0IHNvdXJjZSBpcyBPcHVzIGVuY29kZWQgYmVmb3JlaGFuZC4KCiAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjMKCiAgICAuLiB3YXJuaW5nOjoKCiAgICAgICAgWW91IG11c3QgaGF2ZSB0aGUgZmZtcGVnIG9yIGF2Y29udiBleGVjdXRhYmxlIGluIHlvdXIgcGF0aCBlbnZpcm9ubWVudAogICAgICAgIHZhcmlhYmxlIGluIG9yZGVyIGZvciB0aGlzIHRvIHdvcmsuCgogICAgUGFyYW1ldGVycwogICAgLS0tLS0tLS0tLS0tCiAgICBzb3VyY2U6IFVuaW9uWzpjbGFzczpgc3RyYCwgOmNsYXNzOmBpby5CdWZmZXJlZElPQmFzZWBdCiAgICAgICAgVGhlIGlucHV0IHRoYXQgZmZtcGVnIHdpbGwgdGFrZSBhbmQgY29udmVydCB0byBPcHVzIGJ5dGVzLgogICAgICAgIElmIGBgcGlwZWBgIGlzIGBgVHJ1ZWBgIHRoZW4gdGhpcyBpcyBhIGZpbGUtbGlrZSBvYmplY3QgdGhhdCBpcwogICAgICAgIHBhc3NlZCB0byB0aGUgc3RkaW4gb2YgZmZtcGVnLgogICAgYml0cmF0ZTogOmNsYXNzOmBpbnRgCiAgICAgICAgVGhlIGJpdHJhdGUgaW4ga2JwcyB0byBlbmNvZGUgdGhlIG91dHB1dCB0by4gIERlZmF1bHRzIHRvIGBgMTI4YGAuCiAgICBjb2RlYzogT3B0aW9uYWxbOmNsYXNzOmBzdHJgXQogICAgICAgIFRoZSBjb2RlYyB0byB1c2UgdG8gZW5jb2RlIHRoZSBhdWRpbyBkYXRhLiAgTm9ybWFsbHkgdGhpcyB3b3VsZCBiZQogICAgICAgIGp1c3QgYGBsaWJvcHVzYGAsIGJ1dCBpcyB1c2VkIGJ5IDptZXRoOmBGRm1wZWdPcHVzQXVkaW8uZnJvbV9wcm9iZWAgdG8KICAgICAgICBvcHBvcnR1bmlzdGljYWxseSBza2lwIHBvaW50bGVzc2x5IHJlLWVuY29kaW5nIE9wdXMgYXVkaW8gZGF0YSBieSBwYXNzaW5nCiAgICAgICAgYGBjb3B5YGAgYXMgdGhlIGNvZGVjIHZhbHVlLiAgQW55IHZhbHVlcyBvdGhlciB0aGFuIGBgY29weWBgLCBgYG9wdXNgYCwgb3IKICAgICAgICBgYGxpYm9wdXNgYCB3aWxsIGJlIGNvbnNpZGVyZWQgYGBsaWJvcHVzYGAuICBEZWZhdWx0cyB0byBgYGxpYm9wdXNgYC4KCiAgICAgICAgLi4gd2FybmluZzo6CgogICAgICAgICAgICBEbyBub3QgcHJvdmlkZSB0aGlzIHBhcmFtZXRlciB1bmxlc3MgeW91IGFyZSBjZXJ0YWluIHRoYXQgdGhlIGF1ZGlvIGlucHV0IGlzCiAgICAgICAgICAgIGFscmVhZHkgT3B1cyBlbmNvZGVkLiAgRm9yIHR5cGljYWwgdXNlIDptZXRoOmBGRm1wZWdPcHVzQXVkaW8uZnJvbV9wcm9iZWAKICAgICAgICAgICAgc2hvdWxkIGJlIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBwcm9wZXIgdmFsdWUgZm9yIHRoaXMgcGFyYW1ldGVyLgoKICAgIGV4ZWN1dGFibGU6IDpjbGFzczpgc3RyYAogICAgICAgIFRoZSBleGVjdXRhYmxlIG5hbWUgKGFuZCBwYXRoKSB0byB1c2UuIERlZmF1bHRzIHRvIGBgZmZtcGVnYGAuCiAgICBwaXBlOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgSWYgYGBUcnVlYGAsIGRlbm90ZXMgdGhhdCBgYHNvdXJjZWBgIHBhcmFtZXRlciB3aWxsIGJlIHBhc3NlZAogICAgICAgIHRvIHRoZSBzdGRpbiBvZiBmZm1wZWcuIERlZmF1bHRzIHRvIGBgRmFsc2VgYC4KICAgIHN0ZGVycjogT3B0aW9uYWxbOnRlcm06YHB5OmZpbGUgb2JqZWN0YF0KICAgICAgICBBIGZpbGUtbGlrZSBvYmplY3QgdG8gcGFzcyB0byB0aGUgUG9wZW4gY29uc3RydWN0b3IuCiAgICAgICAgQ291bGQgYWxzbyBiZSBhbiBpbnN0YW5jZSBvZiBgYHN1YnByb2Nlc3MuUElQRWBgLgogICAgYmVmb3JlX29wdGlvbnM6IE9wdGlvbmFsWzpjbGFzczpgc3RyYF0KICAgICAgICBFeHRyYSBjb21tYW5kIGxpbmUgYXJndW1lbnRzIHRvIHBhc3MgdG8gZmZtcGVnIGJlZm9yZSB0aGUgYGAtaWBgIGZsYWcuCiAgICBvcHRpb25zOiBPcHRpb25hbFs6Y2xhc3M6YHN0cmBdCiAgICAgICAgRXh0cmEgY29tbWFuZCBsaW5lIGFyZ3VtZW50cyB0byBwYXNzIHRvIGZmbXBlZyBhZnRlciB0aGUgYGAtaWBgIGZsYWcuCgogICAgUmFpc2VzCiAgICAtLS0tLS0tLQogICAgQ2xpZW50RXhjZXB0aW9uCiAgICAgICAgVGhlIHN1YnByb2Nlc3MgZmFpbGVkIHRvIGJlIGNyZWF0ZWQuCiAgICAiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgc291cmNlLCAqLCBiaXRyYXRlPTEyOCwgY29kZWM9Tm9uZSwgZXhlY3V0YWJsZT0nZmZtcGVnJywKICAgICAgICAgICAgICAgICBwaXBlPUZhbHNlLCBzdGRlcnI9Tm9uZSwgYmVmb3JlX29wdGlvbnM9Tm9uZSwgb3B0aW9ucz1Ob25lKToKCiAgICAgICAgYXJncyA9IFtdCiAgICAgICAgc3VicHJvY2Vzc19rd2FyZ3MgPSB7J3N0ZGluJzogc291cmNlIGlmIHBpcGUgZWxzZSBzdWJwcm9jZXNzLkRFVk5VTEwsICdzdGRlcnInOiBzdGRlcnJ9CgogICAgICAgIGlmIGlzaW5zdGFuY2UoYmVmb3JlX29wdGlvbnMsIHN0cik6CiAgICAgICAgICAgIGFyZ3MuZXh0ZW5kKHNobGV4LnNwbGl0KGJlZm9yZV9vcHRpb25zKSkKCiAgICAgICAgYXJncy5hcHBlbmQoJy1pJykKICAgICAgICBhcmdzLmFwcGVuZCgnLScgaWYgcGlwZSBlbHNlIHNvdXJjZSkKCiAgICAgICAgY29kZWMgPSAnY29weScgaWYgY29kZWMgaW4gKCdvcHVzJywgJ2xpYm9wdXMnKSBlbHNlICdsaWJvcHVzJwoKICAgICAgICBhcmdzLmV4dGVuZCgoJy1tYXBfbWV0YWRhdGEnLCAnLTEnLAogICAgICAgICAgICAgICAgICAgICAnLWYnLCAnb3B1cycsCiAgICAgICAgICAgICAgICAgICAgICctYzphJywgY29kZWMsCiAgICAgICAgICAgICAgICAgICAgICctYXInLCAnNDgwMDAnLAogICAgICAgICAgICAgICAgICAgICAnLWFjJywgJzInLAogICAgICAgICAgICAgICAgICAgICAnLWI6YScsICclc2snICUgYml0cmF0ZSwKICAgICAgICAgICAgICAgICAgICAgJy1sb2dsZXZlbCcsICd3YXJuaW5nJykpCgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3B0aW9ucywgc3RyKToKICAgICAgICAgICAgYXJncy5leHRlbmQoc2hsZXguc3BsaXQob3B0aW9ucykpCgogICAgICAgIGFyZ3MuYXBwZW5kKCdwaXBlOjEnKQoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKHNvdXJjZSwgZXhlY3V0YWJsZT1leGVjdXRhYmxlLCBhcmdzPWFyZ3MsICoqc3VicHJvY2Vzc19rd2FyZ3MpCiAgICAgICAgc2VsZi5fcGFja2V0X2l0ZXIgPSBPZ2dTdHJlYW0oc2VsZi5fc3Rkb3V0KS5pdGVyX3BhY2tldHMoKQoKICAgIEBjbGFzc21ldGhvZAogICAgYXN5bmMgZGVmIGZyb21fcHJvYmUoY2xzLCBzb3VyY2UsICosIG1ldGhvZD1Ob25lLCAqKmt3YXJncyk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIEEgZmFjdG9yeSBtZXRob2QgdGhhdCBjcmVhdGVzIGEgOmNsYXNzOmBGRm1wZWdPcHVzQXVkaW9gIGFmdGVyIHByb2JpbmcKICAgICAgICB0aGUgaW5wdXQgc291cmNlIGZvciBhdWRpbyBjb2RlYyBhbmQgYml0cmF0ZSBpbmZvcm1hdGlvbi4KCiAgICAgICAgRXhhbXBsZXMKICAgICAgICAtLS0tLS0tLS0tCgogICAgICAgIFVzZSB0aGlzIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhbiA6Y2xhc3M6YEZGbXBlZ09wdXNBdWRpb2AgaW5zdGFuY2UgaW5zdGVhZCBvZiB0aGUgY29uc3RydWN0b3I6IDo6CgogICAgICAgICAgICBzb3VyY2UgPSBhd2FpdCBkaXNjb3JkLkZGbXBlZ09wdXNBdWRpby5mcm9tX3Byb2JlKCJzb25nLndlYm0iKQogICAgICAgICAgICB2b2ljZV9jbGllbnQucGxheShzb3VyY2UpCgogICAgICAgIElmIHlvdSBhcmUgb24gV2luZG93cyBhbmQgZG9uJ3QgaGF2ZSBmZnByb2JlIGluc3RhbGxlZCwgdXNlIHRoZSBgYGZhbGxiYWNrYGAgbWV0aG9kCiAgICAgICAgdG8gcHJvYmUgdXNpbmcgZmZtcGVnIGluc3RlYWQ6IDo6CgogICAgICAgICAgICBzb3VyY2UgPSBhd2FpdCBkaXNjb3JkLkZGbXBlZ09wdXNBdWRpby5mcm9tX3Byb2JlKCJzb25nLndlYm0iLCBtZXRob2Q9J2ZhbGxiYWNrJykKICAgICAgICAgICAgdm9pY2VfY2xpZW50LnBsYXkoc291cmNlKQoKICAgICAgICBVc2luZyBhIGN1c3RvbSBtZXRob2Qgb2YgZGV0ZXJtaW5pbmcgY29kZWMgYW5kIGJpdHJhdGU6IDo6CgogICAgICAgICAgICBkZWYgY3VzdG9tX3Byb2JlKHNvdXJjZSwgZXhlY3V0YWJsZSk6CiAgICAgICAgICAgICAgICAjIHNvbWUgYW5hbHlzaXMgY29kZSBoZXJlCgogICAgICAgICAgICAgICAgcmV0dXJuIGNvZGVjLCBiaXRyYXRlCgogICAgICAgICAgICBzb3VyY2UgPSBhd2FpdCBkaXNjb3JkLkZGbXBlZ09wdXNBdWRpby5mcm9tX3Byb2JlKCJzb25nLndlYm0iLCBtZXRob2Q9Y3VzdG9tX3Byb2JlKQogICAgICAgICAgICB2b2ljZV9jbGllbnQucGxheShzb3VyY2UpCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLS0KICAgICAgICBzb3VyY2UKICAgICAgICAgICAgSWRlbnRpY2FsIHRvIHRoZSBgYHNvdXJjZWBgIHBhcmFtZXRlciBmb3IgdGhlIGNvbnN0cnVjdG9yLgogICAgICAgIG1ldGhvZDogT3B0aW9uYWxbVW5pb25bOmNsYXNzOmBzdHJgLCBDYWxsYWJsZVs6Y2xhc3M6YHN0cmAsIDpjbGFzczpgc3RyYF1dXQogICAgICAgICAgICBUaGUgcHJvYmluZyBtZXRob2QgdXNlZCB0byBkZXRlcm1pbmUgYml0cmF0ZSBhbmQgY29kZWMgaW5mb3JtYXRpb24uIEFzIGEgc3RyaW5nLCB2YWxpZAogICAgICAgICAgICB2YWx1ZXMgYXJlIGBgbmF0aXZlYGAgdG8gdXNlIGZmcHJvYmUgKG9yIGF2cHJvYmUpIGFuZCBgYGZhbGxiYWNrYGAgdG8gdXNlIGZmbXBlZwogICAgICAgICAgICAob3IgYXZjb252KS4gIEFzIGEgY2FsbGFibGUsIGl0IG11c3QgdGFrZSB0d28gc3RyaW5nIGFyZ3VtZW50cywgYGBzb3VyY2VgYCBhbmQKICAgICAgICAgICAgYGBleGVjdXRhYmxlYGAuICBCb3RoIHBhcmFtZXRlcnMgYXJlIHRoZSBzYW1lIHZhbHVlcyBwYXNzZWQgdG8gdGhpcyBmYWN0b3J5IGZ1bmN0aW9uLgogICAgICAgICAgICBgYGV4ZWN1dGFibGVgYCB3aWxsIGRlZmF1bHQgdG8gYGBmZm1wZWdgYCBpZiBub3QgcHJvdmlkZWQgYXMgYSBrZXl3b3JkIGFyZ3VtZW50LgogICAgICAgIGt3YXJncwogICAgICAgICAgICBUaGUgcmVtYWluaW5nIHBhcmFtZXRlcnMgdG8gYmUgcGFzc2VkIHRvIHRoZSA6Y2xhc3M6YEZGbXBlZ09wdXNBdWRpb2AgY29uc3RydWN0b3IsCiAgICAgICAgICAgIGV4Y2x1ZGluZyBgYGJpdHJhdGVgYCBhbmQgYGBjb2RlY2BgLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tLQogICAgICAgIEF0dHJpYnV0ZUVycm9yCiAgICAgICAgICAgIEludmFsaWQgcHJvYmUgbWV0aG9kLCBtdXN0IGJlIGBgJ25hdGl2ZSdgYCBvciBgYCdmYWxsYmFjaydgYC4KICAgICAgICBUeXBlRXJyb3IKICAgICAgICAgICAgSW52YWxpZCB2YWx1ZSBmb3IgYGBwcm9iZWBgIHBhcmFtZXRlciwgbXVzdCBiZSA6Y2xhc3M6YHN0cmAgb3IgYSBjYWxsYWJsZS4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgOmNsYXNzOmBGRm1wZWdPcHVzQXVkaW9gCiAgICAgICAgICAgIEFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MuCiAgICAgICAgIiIiCgogICAgICAgIGV4ZWN1dGFibGUgPSBrd2FyZ3MuZ2V0KCdleGVjdXRhYmxlJykKICAgICAgICBjb2RlYywgYml0cmF0ZSA9IGF3YWl0IGNscy5wcm9iZShzb3VyY2UsIG1ldGhvZD1tZXRob2QsIGV4ZWN1dGFibGU9ZXhlY3V0YWJsZSkKICAgICAgICByZXR1cm4gY2xzKHNvdXJjZSwgYml0cmF0ZT1iaXRyYXRlLCBjb2RlYz1jb2RlYywgKiprd2FyZ3MpCgogICAgQGNsYXNzbWV0aG9kCiAgICBhc3luYyBkZWYgcHJvYmUoY2xzLCBzb3VyY2UsICosIG1ldGhvZD1Ob25lLCBleGVjdXRhYmxlPU5vbmUpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBQcm9iZXMgdGhlIGlucHV0IHNvdXJjZSBmb3IgYml0cmF0ZSBhbmQgY29kZWMgaW5mb3JtYXRpb24uCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLS0KICAgICAgICBzb3VyY2UKICAgICAgICAgICAgSWRlbnRpY2FsIHRvIHRoZSBgYHNvdXJjZWBgIHBhcmFtZXRlciBmb3IgOmNsYXNzOmBGRm1wZWdPcHVzQXVkaW9gLgogICAgICAgIG1ldGhvZAogICAgICAgICAgICBJZGVudGljYWwgdG8gdGhlIGBgbWV0aG9kYGAgcGFyYW1ldGVyIGZvciA6bWV0aDpgRkZtcGVnT3B1c0F1ZGlvLmZyb21fcHJvYmVgLgogICAgICAgIGV4ZWN1dGFibGU6IDpjbGFzczpgc3RyYAogICAgICAgICAgICBJZGVudGljYWwgdG8gdGhlIGBgZXhlY3V0YWJsZWBgIHBhcmFtZXRlciBmb3IgOmNsYXNzOmBGRm1wZWdPcHVzQXVkaW9gLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tLQogICAgICAgIEF0dHJpYnV0ZUVycm9yCiAgICAgICAgICAgIEludmFsaWQgcHJvYmUgbWV0aG9kLCBtdXN0IGJlIGBgJ25hdGl2ZSdgYCBvciBgYCdmYWxsYmFjaydgYC4KICAgICAgICBUeXBlRXJyb3IKICAgICAgICAgICAgSW52YWxpZCB2YWx1ZSBmb3IgYGBwcm9iZWBgIHBhcmFtZXRlciwgbXVzdCBiZSA6Y2xhc3M6YHN0cmAgb3IgYSBjYWxsYWJsZS4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tLQogICAgICAgIFR1cGxlW09wdGlvbmFsWzpjbGFzczpgc3RyYF0sIE9wdGlvbmFsWzpjbGFzczpgaW50YF1dCiAgICAgICAgICAgIEEgMi10dXBsZSB3aXRoIHRoZSBjb2RlYyBhbmQgYml0cmF0ZSBvZiB0aGUgaW5wdXQgc291cmNlLgogICAgICAgICIiIgoKICAgICAgICBtZXRob2QgPSBtZXRob2Qgb3IgJ25hdGl2ZScKICAgICAgICBleGVjdXRhYmxlID0gZXhlY3V0YWJsZSBvciAnZmZtcGVnJwogICAgICAgIHByb2JlZnVuYyA9IGZhbGxiYWNrID0gTm9uZQoKICAgICAgICBpZiBpc2luc3RhbmNlKG1ldGhvZCwgc3RyKToKICAgICAgICAgICAgcHJvYmVmdW5jID0gZ2V0YXR0cihjbHMsICdfcHJvYmVfY29kZWNfJyArIG1ldGhvZCwgTm9uZSkKICAgICAgICAgICAgaWYgcHJvYmVmdW5jIGlzIE5vbmU6CiAgICAgICAgICAgICAgICByYWlzZSBBdHRyaWJ1dGVFcnJvcigiSW52YWxpZCBwcm9iZSBtZXRob2QgJyVzJyIgJSBtZXRob2QpCgogICAgICAgICAgICBpZiBwcm9iZWZ1bmMgaXMgY2xzLl9wcm9iZV9jb2RlY19uYXRpdmU6CiAgICAgICAgICAgICAgICBmYWxsYmFjayA9IGNscy5fcHJvYmVfY29kZWNfZmFsbGJhY2sKCiAgICAgICAgZWxpZiBjYWxsYWJsZShtZXRob2QpOgogICAgICAgICAgICBwcm9iZWZ1bmMgPSBtZXRob2QKICAgICAgICAgICAgZmFsbGJhY2sgPSBjbHMuX3Byb2JlX2NvZGVjX2ZhbGxiYWNrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJFeHBlY3RlZCBzdHIgb3IgY2FsbGFibGUgZm9yIHBhcmFtZXRlciAncHJvYmUnLCAiIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJub3QgJ3swLl9fY2xhc3NfXy5fX25hbWVfX30nIiAuZm9ybWF0KG1ldGhvZCkpCgogICAgICAgIGNvZGVjID0gYml0cmF0ZSA9IE5vbmUKICAgICAgICBsb29wID0gYXN5bmNpby5nZXRfZXZlbnRfbG9vcCgpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb2RlYywgYml0cmF0ZSA9IGF3YWl0IGxvb3AucnVuX2luX2V4ZWN1dG9yKE5vbmUsIGxhbWJkYTogcHJvYmVmdW5jKHNvdXJjZSwgZXhlY3V0YWJsZSkpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgaWYgbm90IGZhbGxiYWNrOgogICAgICAgICAgICAgICAgbG9nLmV4Y2VwdGlvbigiUHJvYmUgJyVzJyB1c2luZyAnJXMnIGZhaWxlZCIsIG1ldGhvZCwgZXhlY3V0YWJsZSkKICAgICAgICAgICAgICAgIHJldHVybgoKICAgICAgICAgICAgbG9nLmV4Y2VwdGlvbigiUHJvYmUgJyVzJyB1c2luZyAnJXMnIGZhaWxlZCwgdHJ5aW5nIGZhbGxiYWNrIiwgbWV0aG9kLCBleGVjdXRhYmxlKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjb2RlYywgYml0cmF0ZSA9IGF3YWl0IGxvb3AucnVuX2luX2V4ZWN1dG9yKE5vbmUsIGxhbWJkYTogZmFsbGJhY2soc291cmNlLCBleGVjdXRhYmxlKSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZy5leGNlcHRpb24oIkZhbGxiYWNrIHByb2JlIHVzaW5nICclcycgZmFpbGVkIiwgZXhlY3V0YWJsZSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZy5pbmZvKCJGYWxsYmFjayBwcm9iZSBmb3VuZCBjb2RlYz0lcywgYml0cmF0ZT0lcyIsIGNvZGVjLCBiaXRyYXRlKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZy5pbmZvKCJQcm9iZSBmb3VuZCBjb2RlYz0lcywgYml0cmF0ZT0lcyIsIGNvZGVjLCBiaXRyYXRlKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIHJldHVybiBjb2RlYywgYml0cmF0ZQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBfcHJvYmVfY29kZWNfbmF0aXZlKHNvdXJjZSwgZXhlY3V0YWJsZT0nZmZtcGVnJyk6CiAgICAgICAgZXhlID0gZXhlY3V0YWJsZVs6Ml0gKyAncHJvYmUnIGlmIGV4ZWN1dGFibGUgaW4gKCdmZm1wZWcnLCAnYXZjb252JykgZWxzZSBleGVjdXRhYmxlCiAgICAgICAgYXJncyA9IFtleGUsICctdicsICdxdWlldCcsICctcHJpbnRfZm9ybWF0JywgJ2pzb24nLCAnLXNob3dfc3RyZWFtcycsICctc2VsZWN0X3N0cmVhbXMnLCAnYTowJywgc291cmNlXQogICAgICAgIG91dHB1dCA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KGFyZ3MsIHRpbWVvdXQ9MjApCiAgICAgICAgY29kZWMgPSBiaXRyYXRlID0gTm9uZQoKICAgICAgICBpZiBvdXRwdXQ6CiAgICAgICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKG91dHB1dCkKICAgICAgICAgICAgc3RyZWFtZGF0YSA9IGRhdGFbJ3N0cmVhbXMnXVswXQoKICAgICAgICAgICAgY29kZWMgPSBzdHJlYW1kYXRhLmdldCgnY29kZWNfbmFtZScpCiAgICAgICAgICAgIGJpdHJhdGUgPSBpbnQoc3RyZWFtZGF0YS5nZXQoJ2JpdF9yYXRlJywgMCkpCiAgICAgICAgICAgIGJpdHJhdGUgPSBtYXgocm91bmQoYml0cmF0ZS8xMDAwLCAwKSwgNTEyKQoKICAgICAgICByZXR1cm4gY29kZWMsIGJpdHJhdGUKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgX3Byb2JlX2NvZGVjX2ZhbGxiYWNrKHNvdXJjZSwgZXhlY3V0YWJsZT0nZmZtcGVnJyk6CiAgICAgICAgYXJncyA9IFtleGVjdXRhYmxlLCAnLWhpZGVfYmFubmVyJywgJy1pJywgIHNvdXJjZV0KICAgICAgICBwcm9jID0gc3VicHJvY2Vzcy5Qb3BlbihhcmdzLCBjcmVhdGlvbmZsYWdzPUNSRUFURV9OT19XSU5ET1csIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlNURE9VVCkKICAgICAgICBvdXQsIF8gPSBwcm9jLmNvbW11bmljYXRlKHRpbWVvdXQ9MjApCiAgICAgICAgb3V0cHV0ID0gb3V0LmRlY29kZSgndXRmOCcpCiAgICAgICAgY29kZWMgPSBiaXRyYXRlID0gTm9uZQoKICAgICAgICBjb2RlY19tYXRjaCA9IHJlLnNlYXJjaChyIlN0cmVhbSAjMC4qP0F1ZGlvOiAoXHcrKSIsIG91dHB1dCkKICAgICAgICBpZiBjb2RlY19tYXRjaDoKICAgICAgICAgICAgY29kZWMgPSBjb2RlY19tYXRjaC5ncm91cCgxKQoKICAgICAgICBicl9tYXRjaCA9IHJlLnNlYXJjaChyIihcZCspIFtrS11iL3MiLCBvdXRwdXQpCiAgICAgICAgaWYgYnJfbWF0Y2g6CiAgICAgICAgICAgIGJpdHJhdGUgPSBtYXgoaW50KGJyX21hdGNoLmdyb3VwKDEpKSwgNTEyKQoKICAgICAgICByZXR1cm4gY29kZWMsIGJpdHJhdGUKCiAgICBkZWYgcmVhZChzZWxmKToKICAgICAgICByZXR1cm4gbmV4dChzZWxmLl9wYWNrZXRfaXRlciwgYicnKQoKICAgIGRlZiBpc19vcHVzKHNlbGYpOgogICAgICAgIHJldHVybiBUcnVlCgpjbGFzcyBQQ01Wb2x1bWVUcmFuc2Zvcm1lcihBdWRpb1NvdXJjZSk6CiAgICAiIiJUcmFuc2Zvcm1zIGEgcHJldmlvdXMgOmNsYXNzOmBBdWRpb1NvdXJjZWAgdG8gaGF2ZSB2b2x1bWUgY29udHJvbHMuCgogICAgVGhpcyBkb2VzIG5vdCB3b3JrIG9uIGF1ZGlvIHNvdXJjZXMgdGhhdCBoYXZlIDptZXRoOmBBdWRpb1NvdXJjZS5pc19vcHVzYAogICAgc2V0IHRvIGBgVHJ1ZWBgLgoKICAgIFBhcmFtZXRlcnMKICAgIC0tLS0tLS0tLS0tLQogICAgb3JpZ2luYWw6IDpjbGFzczpgQXVkaW9Tb3VyY2VgCiAgICAgICAgVGhlIG9yaWdpbmFsIEF1ZGlvU291cmNlIHRvIHRyYW5zZm9ybS4KICAgIHZvbHVtZTogOmNsYXNzOmBmbG9hdGAKICAgICAgICBUaGUgaW5pdGlhbCB2b2x1bWUgdG8gc2V0IGl0IHRvLgogICAgICAgIFNlZSA6YXR0cjpgdm9sdW1lYCBmb3IgbW9yZSBpbmZvLgoKICAgIFJhaXNlcwogICAgLS0tLS0tLQogICAgVHlwZUVycm9yCiAgICAgICAgTm90IGFuIGF1ZGlvIHNvdXJjZS4KICAgIENsaWVudEV4Y2VwdGlvbgogICAgICAgIFRoZSBhdWRpbyBzb3VyY2UgaXMgb3B1cyBlbmNvZGVkLgogICAgIiIiCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG9yaWdpbmFsLCB2b2x1bWU9MS4wKToKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvcmlnaW5hbCwgQXVkaW9Tb3VyY2UpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ2V4cGVjdGVkIEF1ZGlvU291cmNlIG5vdCB7MC5fX2NsYXNzX18uX19uYW1lX199LicuZm9ybWF0KG9yaWdpbmFsKSkKCiAgICAgICAgaWYgb3JpZ2luYWwuaXNfb3B1cygpOgogICAgICAgICAgICByYWlzZSBDbGllbnRFeGNlcHRpb24oJ0F1ZGlvU291cmNlIG11c3Qgbm90IGJlIE9wdXMgZW5jb2RlZC4nKQoKICAgICAgICBzZWxmLm9yaWdpbmFsID0gb3JpZ2luYWwKICAgICAgICBzZWxmLnZvbHVtZSA9IHZvbHVtZQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHZvbHVtZShzZWxmKToKICAgICAgICAiIiJSZXRyaWV2ZXMgb3Igc2V0cyB0aGUgdm9sdW1lIGFzIGEgZmxvYXRpbmcgcG9pbnQgcGVyY2VudGFnZSAoZS5nLiBgYDEuMGBgIGZvciAxMDAlKS4iIiIKICAgICAgICByZXR1cm4gc2VsZi5fdm9sdW1lCgogICAgQHZvbHVtZS5zZXR0ZXIKICAgIGRlZiB2b2x1bWUoc2VsZiwgdmFsdWUpOgogICAgICAgIHNlbGYuX3ZvbHVtZSA9IG1heCh2YWx1ZSwgMC4wKQoKICAgIGRlZiBjbGVhbnVwKHNlbGYpOgogICAgICAgIHNlbGYub3JpZ2luYWwuY2xlYW51cCgpCgogICAgZGVmIHJlYWQoc2VsZik6CiAgICAgICAgcmV0ID0gc2VsZi5vcmlnaW5hbC5yZWFkKCkKICAgICAgICByZXR1cm4gYXVkaW9vcC5tdWwocmV0LCAyLCBtaW4oc2VsZi5fdm9sdW1lLCAyLjApKQoKY2xhc3MgQXVkaW9QbGF5ZXIodGhyZWFkaW5nLlRocmVhZCk6CiAgICBERUxBWSA9IE9wdXNFbmNvZGVyLkZSQU1FX0xFTkdUSCAvIDEwMDAuMAoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzb3VyY2UsIGNsaWVudCwgKiwgYWZ0ZXI9Tm9uZSk6CiAgICAgICAgdGhyZWFkaW5nLlRocmVhZC5fX2luaXRfXyhzZWxmKQogICAgICAgIHNlbGYuZGFlbW9uID0gVHJ1ZQogICAgICAgIHNlbGYuc291cmNlID0gc291cmNlCiAgICAgICAgc2VsZi5jbGllbnQgPSBjbGllbnQKICAgICAgICBzZWxmLmFmdGVyID0gYWZ0ZXIKCiAgICAgICAgc2VsZi5fZW5kID0gdGhyZWFkaW5nLkV2ZW50KCkKICAgICAgICBzZWxmLl9yZXN1bWVkID0gdGhyZWFkaW5nLkV2ZW50KCkKICAgICAgICBzZWxmLl9yZXN1bWVkLnNldCgpICMgd2UgYXJlIG5vdCBwYXVzZWQKICAgICAgICBzZWxmLl9jdXJyZW50X2Vycm9yID0gTm9uZQogICAgICAgIHNlbGYuX2Nvbm5lY3RlZCA9IGNsaWVudC5fY29ubmVjdGVkCiAgICAgICAgc2VsZi5fbG9jayA9IHRocmVhZGluZy5Mb2NrKCkKCiAgICAgICAgaWYgYWZ0ZXIgaXMgbm90IE5vbmUgYW5kIG5vdCBjYWxsYWJsZShhZnRlcik6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcignRXhwZWN0ZWQgYSBjYWxsYWJsZSBmb3IgdGhlICJhZnRlciIgcGFyYW1ldGVyLicpCgogICAgZGVmIF9kb19ydW4oc2VsZik6CiAgICAgICAgc2VsZi5sb29wcyA9IDAKICAgICAgICBzZWxmLl9zdGFydCA9IHRpbWUucGVyZl9jb3VudGVyKCkKCiAgICAgICAgIyBnZXRhdHRyIGxvb2t1cCBzcGVlZCB1cHMKICAgICAgICBwbGF5X2F1ZGlvID0gc2VsZi5jbGllbnQuc2VuZF9hdWRpb19wYWNrZXQKICAgICAgICBzZWxmLl9zcGVhayhUcnVlKQoKICAgICAgICB3aGlsZSBub3Qgc2VsZi5fZW5kLmlzX3NldCgpOgogICAgICAgICAgICAjIGFyZSB3ZSBwYXVzZWQ/CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9yZXN1bWVkLmlzX3NldCgpOgogICAgICAgICAgICAgICAgIyB3YWl0IHVudGlsIHdlIGFyZW4ndAogICAgICAgICAgICAgICAgc2VsZi5fcmVzdW1lZC53YWl0KCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAjIGFyZSB3ZSBkaXNjb25uZWN0ZWQgZnJvbSB2b2ljZT8KICAgICAgICAgICAgaWYgbm90IHNlbGYuX2Nvbm5lY3RlZC5pc19zZXQoKToKICAgICAgICAgICAgICAgICMgd2FpdCB1bnRpbCB3ZSBhcmUgY29ubmVjdGVkCiAgICAgICAgICAgICAgICBzZWxmLl9jb25uZWN0ZWQud2FpdCgpCiAgICAgICAgICAgICAgICAjIHJlc2V0IG91ciBpbnRlcm5hbCBkYXRhCiAgICAgICAgICAgICAgICBzZWxmLmxvb3BzID0gMAogICAgICAgICAgICAgICAgc2VsZi5fc3RhcnQgPSB0aW1lLnBlcmZfY291bnRlcigpCgogICAgICAgICAgICBzZWxmLmxvb3BzICs9IDEKICAgICAgICAgICAgZGF0YSA9IHNlbGYuc291cmNlLnJlYWQoKQoKICAgICAgICAgICAgaWYgbm90IGRhdGE6CiAgICAgICAgICAgICAgICBzZWxmLnN0b3AoKQogICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIHBsYXlfYXVkaW8oZGF0YSwgZW5jb2RlPW5vdCBzZWxmLnNvdXJjZS5pc19vcHVzKCkpCiAgICAgICAgICAgIG5leHRfdGltZSA9IHNlbGYuX3N0YXJ0ICsgc2VsZi5ERUxBWSAqIHNlbGYubG9vcHMKICAgICAgICAgICAgZGVsYXkgPSBtYXgoMCwgc2VsZi5ERUxBWSArIChuZXh0X3RpbWUgLSB0aW1lLnBlcmZfY291bnRlcigpKSkKICAgICAgICAgICAgdGltZS5zbGVlcChkZWxheSkKCiAgICBkZWYgcnVuKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5fZG9fcnVuKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4YzoKICAgICAgICAgICAgc2VsZi5fY3VycmVudF9lcnJvciA9IGV4YwogICAgICAgICAgICBzZWxmLnN0b3AoKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIHNlbGYuc291cmNlLmNsZWFudXAoKQogICAgICAgICAgICBzZWxmLl9jYWxsX2FmdGVyKCkKCiAgICBkZWYgX2NhbGxfYWZ0ZXIoc2VsZik6CiAgICAgICAgZXJyb3IgPSBzZWxmLl9jdXJyZW50X2Vycm9yCgogICAgICAgIGlmIHNlbGYuYWZ0ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYuYWZ0ZXIoZXJyb3IpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXhjOgogICAgICAgICAgICAgICAgbG9nLmV4Y2VwdGlvbignQ2FsbGluZyB0aGUgYWZ0ZXIgZnVuY3Rpb24gZmFpbGVkLicpCiAgICAgICAgICAgICAgICBleGMuX19jb250ZXh0X18gPSBlcnJvcgogICAgICAgICAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4Y2VwdGlvbih0eXBlKGV4YyksIGV4YywgZXhjLl9fdHJhY2ViYWNrX18pCiAgICAgICAgZWxpZiBlcnJvcjoKICAgICAgICAgICAgbXNnID0gJ0V4Y2VwdGlvbiBpbiB2b2ljZSB0aHJlYWQge30nLmZvcm1hdChzZWxmLm5hbWUpCiAgICAgICAgICAgIGxvZy5leGNlcHRpb24obXNnLCBleGNfaW5mbz1lcnJvcikKICAgICAgICAgICAgcHJpbnQobXNnLCBmaWxlPXN5cy5zdGRlcnIpCiAgICAgICAgICAgIHRyYWNlYmFjay5wcmludF9leGNlcHRpb24odHlwZShlcnJvciksIGVycm9yLCBlcnJvci5fX3RyYWNlYmFja19fKQoKICAgIGRlZiBzdG9wKHNlbGYpOgogICAgICAgIHNlbGYuX2VuZC5zZXQoKQogICAgICAgIHNlbGYuX3Jlc3VtZWQuc2V0KCkKICAgICAgICBzZWxmLl9zcGVhayhGYWxzZSkKCiAgICBkZWYgcGF1c2Uoc2VsZiwgKiwgdXBkYXRlX3NwZWFraW5nPVRydWUpOgogICAgICAgIHNlbGYuX3Jlc3VtZWQuY2xlYXIoKQogICAgICAgIGlmIHVwZGF0ZV9zcGVha2luZzoKICAgICAgICAgICAgc2VsZi5fc3BlYWsoRmFsc2UpCgogICAgZGVmIHJlc3VtZShzZWxmLCAqLCB1cGRhdGVfc3BlYWtpbmc9VHJ1ZSk6CiAgICAgICAgc2VsZi5sb29wcyA9IDAKICAgICAgICBzZWxmLl9zdGFydCA9IHRpbWUucGVyZl9jb3VudGVyKCkKICAgICAgICBzZWxmLl9yZXN1bWVkLnNldCgpCiAgICAgICAgaWYgdXBkYXRlX3NwZWFraW5nOgogICAgICAgICAgICBzZWxmLl9zcGVhayhUcnVlKQoKICAgIGRlZiBpc19wbGF5aW5nKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9yZXN1bWVkLmlzX3NldCgpIGFuZCBub3Qgc2VsZi5fZW5kLmlzX3NldCgpCgogICAgZGVmIGlzX3BhdXNlZChzZWxmKToKICAgICAgICByZXR1cm4gbm90IHNlbGYuX2VuZC5pc19zZXQoKSBhbmQgbm90IHNlbGYuX3Jlc3VtZWQuaXNfc2V0KCkKCiAgICBkZWYgX3NldF9zb3VyY2Uoc2VsZiwgc291cmNlKToKICAgICAgICB3aXRoIHNlbGYuX2xvY2s6CiAgICAgICAgICAgIHNlbGYucGF1c2UodXBkYXRlX3NwZWFraW5nPUZhbHNlKQogICAgICAgICAgICBzZWxmLnNvdXJjZSA9IHNvdXJjZQogICAgICAgICAgICBzZWxmLnJlc3VtZSh1cGRhdGVfc3BlYWtpbmc9RmFsc2UpCgogICAgZGVmIF9zcGVhayhzZWxmLCBzcGVha2luZyk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBhc3luY2lvLnJ1bl9jb3JvdXRpbmVfdGhyZWFkc2FmZShzZWxmLmNsaWVudC53cy5zcGVhayhzcGVha2luZyksIHNlbGYuY2xpZW50Lmxvb3ApCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2cuaW5mbygiU3BlYWtpbmcgY2FsbCBpbiBwbGF5ZXIgZmFpbGVkOiAlcyIsIGUpCg==
