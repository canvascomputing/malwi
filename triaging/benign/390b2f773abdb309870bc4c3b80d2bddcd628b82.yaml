statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/formatter.py
  contents:
  - name: Formatter.__init__
    score: null
    code: |-
      def __init__(self, args):
              self._args = args
    tokens: resume load_fast args load_fast self store_attr _args return_const None
    hash: 2f24264b1b2192a508544682d66ee66c61ae15b2eff17a6c752a717a68b55b98
sources:
  .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/formatter.py: IyBDb3B5cmlnaHQgMjAxMi0yMDEzIEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCgojIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpLiBZb3UKIyBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mCiMgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdAoKIyAgICAgaHR0cDovL2F3cy5hbWF6b24uY29tL2FwYWNoZTIuMC8KCiMgb3IgaW4gdGhlICJsaWNlbnNlIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcwojIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GCiMgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljCiMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KaW1wb3J0IGxvZ2dpbmcKCmZyb20gYm90b2NvcmUuY29tcGF0IGltcG9ydCBqc29uCgpmcm9tIGJvdG9jb3JlLnV0aWxzIGltcG9ydCBzZXRfdmFsdWVfZnJvbV9qbWVzcGF0aApmcm9tIGJvdG9jb3JlLnBhZ2luYXRlIGltcG9ydCBQYWdlSXRlcmF0b3IKCmZyb20gYXdzY2xpLnRhYmxlIGltcG9ydCBNdWx0aVRhYmxlLCBTdHlsZXIsIENvbG9yaXplZFN0eWxlcgpmcm9tIGF3c2NsaSBpbXBvcnQgdGV4dApmcm9tIGF3c2NsaSBpbXBvcnQgY29tcGF0CmZyb20gYXdzY2xpLnV0aWxzIGltcG9ydCBqc29uX2VuY29kZXIKCgpMT0cgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCgpkZWYgaXNfcmVzcG9uc2VfcGFnaW5hdGVkKHJlc3BvbnNlKToKICAgIHJldHVybiBpc2luc3RhbmNlKHJlc3BvbnNlLCBQYWdlSXRlcmF0b3IpCgoKY2xhc3MgRm9ybWF0dGVyKG9iamVjdCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgYXJncyk6CiAgICAgICAgc2VsZi5fYXJncyA9IGFyZ3MKCiAgICBkZWYgX3JlbW92ZV9yZXF1ZXN0X2lkKHNlbGYsIHJlc3BvbnNlX2RhdGEpOgogICAgICAgICMgV2Ugb25seSB3YW50IHRvIGRpc3BsYXkgdGhlIFJlc3BvbnNlTWV0YWRhdGEgKHdoaWNoIGluY2x1ZGVzCiAgICAgICAgIyB0aGUgcmVxdWVzdCBpZCkgaWYgdGhlcmUgaXMgYW4gZXJyb3IgaW4gdGhlIHJlc3BvbnNlLgogICAgICAgICMgU2luY2UgYWxsIGVycm9ycyBoYXZlIGJlZW4gdW5pZmllZCB1bmRlciB0aGUgRXJyb3JzIGtleSwKICAgICAgICAjIHRoaXMgc2hvdWxkIGJlIGEgcmVhc29uYWJsZSB3YXkgdG8gZmlsdGVyLgogICAgICAgIGlmICdFcnJvcnMnIG5vdCBpbiByZXNwb25zZV9kYXRhOgogICAgICAgICAgICBpZiAnUmVzcG9uc2VNZXRhZGF0YScgaW4gcmVzcG9uc2VfZGF0YToKICAgICAgICAgICAgICAgIGlmICdSZXF1ZXN0SWQnIGluIHJlc3BvbnNlX2RhdGFbJ1Jlc3BvbnNlTWV0YWRhdGEnXToKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0X2lkID0gcmVzcG9uc2VfZGF0YVsnUmVzcG9uc2VNZXRhZGF0YSddWydSZXF1ZXN0SWQnXQogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygnUmVxdWVzdElkOiAlcycsIHJlcXVlc3RfaWQpCiAgICAgICAgICAgICAgICBkZWwgcmVzcG9uc2VfZGF0YVsnUmVzcG9uc2VNZXRhZGF0YSddCgogICAgZGVmIF9nZXRfZGVmYXVsdF9zdHJlYW0oc2VsZik6CiAgICAgICAgcmV0dXJuIGNvbXBhdC5nZXRfc3Rkb3V0X3RleHRfd3JpdGVyKCkKCiAgICBkZWYgX2ZsdXNoX3N0cmVhbShzZWxmLCBzdHJlYW0pOgogICAgICAgIHRyeToKICAgICAgICAgICAgc3RyZWFtLmZsdXNoKCkKICAgICAgICBleGNlcHQgSU9FcnJvcjoKICAgICAgICAgICAgcGFzcwoKCmNsYXNzIEZ1bGx5QnVmZmVyZWRGb3JtYXR0ZXIoRm9ybWF0dGVyKToKICAgIGRlZiBfX2NhbGxfXyhzZWxmLCBjb21tYW5kX25hbWUsIHJlc3BvbnNlLCBzdHJlYW09Tm9uZSk6CiAgICAgICAgaWYgc3RyZWFtIGlzIE5vbmU6CiAgICAgICAgICAgICMgUmV0cmlldmUgc3Rkb3V0IG9uIGludm9jYXRpb24gaW5zdGVhZCBvZiBhdCBpbXBvcnQgdGltZQogICAgICAgICAgICAjIHNvIHRoYXQgaWYgYW55dGhpbmcgd3JhcHMgc3Rkb3V0IHdlJ2xsIHBpY2sgdXAgdGhvc2UgY2hhbmdlcwogICAgICAgICAgICAjIChzcGVjaWZpY2FsbHkgY29sb3JhbWEgb24gd2luZG93cyB3cmFwcyBzdGRvdXQpLgogICAgICAgICAgICBzdHJlYW0gPSBzZWxmLl9nZXRfZGVmYXVsdF9zdHJlYW0oKQogICAgICAgICMgSSB0aGluayB0aGUgaW50ZXJmYWNlcyBiZXR3ZWVuIG5vbi1wYWdpbmF0ZWQKICAgICAgICAjIGFuZCBwYWdpbmF0ZWQgcmVzcG9uc2VzIGNhbiBzdGlsbCBiZSBjbGVhbmVkIHVwLgogICAgICAgIGlmIGlzX3Jlc3BvbnNlX3BhZ2luYXRlZChyZXNwb25zZSk6CiAgICAgICAgICAgIHJlc3BvbnNlX2RhdGEgPSByZXNwb25zZS5idWlsZF9mdWxsX3Jlc3VsdCgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmVzcG9uc2VfZGF0YSA9IHJlc3BvbnNlCiAgICAgICAgc2VsZi5fcmVtb3ZlX3JlcXVlc3RfaWQocmVzcG9uc2VfZGF0YSkKICAgICAgICBpZiBzZWxmLl9hcmdzLnF1ZXJ5IGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXNwb25zZV9kYXRhID0gc2VsZi5fYXJncy5xdWVyeS5zZWFyY2gocmVzcG9uc2VfZGF0YSkKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuX2Zvcm1hdF9yZXNwb25zZShjb21tYW5kX25hbWUsIHJlc3BvbnNlX2RhdGEsIHN0cmVhbSkKICAgICAgICBleGNlcHQgSU9FcnJvciBhcyBlOgogICAgICAgICAgICAjIElmIHRoZSByZWFkaW5nIGVuZCBvZiBvdXIgc3Rkb3V0IHN0cmVhbSBoYXMgY2xvc2VkIHRoZSBmaWxlCiAgICAgICAgICAgICMgd2UgY2FuIGp1c3QgZXhpdC4KICAgICAgICAgICAgcGFzcwogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICMgZmx1c2ggaXMgbmVlZGVkIHRvIGF2b2lkIHRoZSAiY2xvc2UgZmFpbGVkIGluIGZpbGUgb2JqZWN0CiAgICAgICAgICAgICMgZGVzdHJ1Y3RvciIgaW4gcHl0aG9uMi54IChzZWUgaHR0cDovL2J1Z3MucHl0aG9uLm9yZy9pc3N1ZTExMzgwKS4KICAgICAgICAgICAgc2VsZi5fZmx1c2hfc3RyZWFtKHN0cmVhbSkKCgpjbGFzcyBKU09ORm9ybWF0dGVyKEZ1bGx5QnVmZmVyZWRGb3JtYXR0ZXIpOgoKICAgIGRlZiBfZm9ybWF0X3Jlc3BvbnNlKHNlbGYsIGNvbW1hbmRfbmFtZSwgcmVzcG9uc2UsIHN0cmVhbSk6CiAgICAgICAgIyBGb3Igb3BlcmF0aW9ucyB0aGF0IGhhdmUgbm8gcmVzcG9uc2UgYm9keSAoZS5nLiBzMyBwdXQtb2JqZWN0KQogICAgICAgICMgdGhlIHJlc3BvbnNlIHdpbGwgYmUgYW4gZW1wdHkgc3RyaW5nLiAgV2UgZG9uJ3Qgd2FudCB0byBwcmludAogICAgICAgICMgdGhhdCBvdXQgdG8gdGhlIHVzZXIgYnV0IG90aGVyICJmYWxzZXkiIHZhbHVlcyBsaWtlIGFuIGVtcHR5CiAgICAgICAgIyBkaWN0aW9uYXJ5IHNob3VsZCBiZSBwcmludGVkLgogICAgICAgIGlmIHJlc3BvbnNlICE9IHt9OgogICAgICAgICAgICBqc29uLmR1bXAocmVzcG9uc2UsIHN0cmVhbSwgaW5kZW50PTQsIGRlZmF1bHQ9anNvbl9lbmNvZGVyLAogICAgICAgICAgICAgICAgICAgIGVuc3VyZV9hc2NpaT1GYWxzZSkKICAgICAgICAgICAgc3RyZWFtLndyaXRlKCdcbicpCgoKY2xhc3MgVGFibGVGb3JtYXR0ZXIoRnVsbHlCdWZmZXJlZEZvcm1hdHRlcik6CiAgICAiIiJQcmV0dHkgcHJpbnQgYSB0YWJsZSBmcm9tIGEgZ2l2ZW4gcmVzcG9uc2UuCgogICAgVGhlIHRhYmxlIGZvcm1hdHRlciBpcyBhYmxlIHRvIHRha2UgYW55IGdlbmVyaWMgcmVzcG9uc2UKICAgIGFuZCBnZW5lcmF0ZSBhIHByZXR0eSBwcmludGVkIHRhYmxlLiAgSXQgZG9lcyB0aGlzIHdpdGhvdXQKICAgIHVzaW5nIHRoZSBvdXRwdXQgZGVmaW5pdGlvbiBmcm9tIHRoZSBtb2RlbC4KCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBhcmdzLCB0YWJsZT1Ob25lKToKICAgICAgICBzdXBlcihUYWJsZUZvcm1hdHRlciwgc2VsZikuX19pbml0X18oYXJncykKICAgICAgICBpZiBhcmdzLmNvbG9yID09ICdhdXRvJzoKICAgICAgICAgICAgc2VsZi50YWJsZSA9IE11bHRpVGFibGUoaW5pdGlhbF9zZWN0aW9uPUZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fc2VwYXJhdG9yPSd8JykKICAgICAgICBlbGlmIGFyZ3MuY29sb3IgPT0gJ29mZic6CiAgICAgICAgICAgIHN0eWxlciA9IFN0eWxlcigpCiAgICAgICAgICAgIHNlbGYudGFibGUgPSBNdWx0aVRhYmxlKGluaXRpYWxfc2VjdGlvbj1GYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX3NlcGFyYXRvcj0nfCcsIHN0eWxlcj1zdHlsZXIpCiAgICAgICAgZWxpZiBhcmdzLmNvbG9yID09ICdvbic6CiAgICAgICAgICAgIHN0eWxlciA9IENvbG9yaXplZFN0eWxlcigpCiAgICAgICAgICAgIHNlbGYudGFibGUgPSBNdWx0aVRhYmxlKGluaXRpYWxfc2VjdGlvbj1GYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX3NlcGFyYXRvcj0nfCcsIHN0eWxlcj1zdHlsZXIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiVW5rbm93biBjb2xvciBvcHRpb246ICVzIiAlIGFyZ3MuY29sb3IpCgogICAgZGVmIF9mb3JtYXRfcmVzcG9uc2Uoc2VsZiwgY29tbWFuZF9uYW1lLCByZXNwb25zZSwgc3RyZWFtKToKICAgICAgICBpZiBzZWxmLl9idWlsZF90YWJsZShjb21tYW5kX25hbWUsIHJlc3BvbnNlKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi50YWJsZS5yZW5kZXIoc3RyZWFtKQogICAgICAgICAgICBleGNlcHQgSU9FcnJvcjoKICAgICAgICAgICAgICAgICMgSWYgdGhleSdyZSBwaXBpbmcgc3Rkb3V0IHRvIGFub3RoZXIgcHJvY2VzcyB3aGljaCBleGl0cyBiZWZvcmUKICAgICAgICAgICAgICAgICMgd2UncmUgZG9uZSB3cml0aW5nIGFsbCBvZiBvdXIgb3V0cHV0LCB3ZSdsbCBnZXQgYW4gZXJyb3IgYWJvdXQgYQogICAgICAgICAgICAgICAgIyBjbG9zZWQgcGlwZSB3aGljaCB3ZSBjYW4gc2FmZWx5IGlnbm9yZS4KICAgICAgICAgICAgICAgIHBhc3MKCiAgICBkZWYgX2J1aWxkX3RhYmxlKHNlbGYsIHRpdGxlLCBjdXJyZW50LCBpbmRlbnRfbGV2ZWw9MCk6CiAgICAgICAgaWYgbm90IGN1cnJlbnQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGlmIHRpdGxlIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLnRhYmxlLm5ld19zZWN0aW9uKHRpdGxlLCBpbmRlbnRfbGV2ZWw9aW5kZW50X2xldmVsKQogICAgICAgIGlmIGlzaW5zdGFuY2UoY3VycmVudCwgbGlzdCk6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoY3VycmVudFswXSwgZGljdCk6CiAgICAgICAgICAgICAgICBzZWxmLl9idWlsZF9zdWJfdGFibGVfZnJvbV9saXN0KGN1cnJlbnQsIGluZGVudF9sZXZlbCwgdGl0bGUpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBmb3IgaXRlbSBpbiBjdXJyZW50OgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX3NjYWxhcl90eXBlKGl0ZW0pOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRhYmxlLmFkZF9yb3coW2l0ZW1dKQogICAgICAgICAgICAgICAgICAgIGVsaWYgYWxsKHNlbGYuX3NjYWxhcl90eXBlKGVsKSBmb3IgZWwgaW4gaXRlbSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGFibGUuYWRkX3JvdyhpdGVtKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2J1aWxkX3RhYmxlKHRpdGxlPU5vbmUsIGN1cnJlbnQ9aXRlbSkKICAgICAgICBpZiBpc2luc3RhbmNlKGN1cnJlbnQsIGRpY3QpOgogICAgICAgICAgICAjIFJlbmRlciBhIHNpbmdsZSByb3cgc2VjdGlvbiB3aXRoIGtleXMgYXMgaGVhZGVyCiAgICAgICAgICAgICMgYW5kIHRoZSByb3cgYXMgdGhlIHZhbHVlcywgdW5sZXNzIHRoZSB2YWx1ZQogICAgICAgICAgICAjIGlzIGEgbGlzdC4KICAgICAgICAgICAgc2VsZi5fYnVpbGRfc3ViX3RhYmxlX2Zyb21fZGljdChjdXJyZW50LCBpbmRlbnRfbGV2ZWwpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgX2J1aWxkX3N1Yl90YWJsZV9mcm9tX2RpY3Qoc2VsZiwgY3VycmVudCwgaW5kZW50X2xldmVsKToKICAgICAgICAjIFJlbmRlciBhIHNpbmdsZSByb3cgc2VjdGlvbiB3aXRoIGtleXMgYXMgaGVhZGVyCiAgICAgICAgIyBhbmQgdGhlIHJvdyBhcyB0aGUgdmFsdWVzLCB1bmxlc3MgdGhlIHZhbHVlCiAgICAgICAgIyBpcyBhIGxpc3QuCiAgICAgICAgaGVhZGVycywgbW9yZSA9IHNlbGYuX2dyb3VwX3NjYWxhcl9rZXlzKGN1cnJlbnQpCiAgICAgICAgaWYgbGVuKGhlYWRlcnMpID09IDE6CiAgICAgICAgICAgICMgU3BlY2lhbCBjYXNpbmcgaWYgYSBkaWN0IGhhcyBhIHNpbmdsZSBzY2FsYXIga2V5L3ZhbHVlIHBhaXIuCiAgICAgICAgICAgIHNlbGYudGFibGUuYWRkX3JvdyhbaGVhZGVyc1swXSwgY3VycmVudFtoZWFkZXJzWzBdXV0pCiAgICAgICAgZWxpZiBoZWFkZXJzOgogICAgICAgICAgICBzZWxmLnRhYmxlLmFkZF9yb3dfaGVhZGVyKGhlYWRlcnMpCiAgICAgICAgICAgIHNlbGYudGFibGUuYWRkX3JvdyhbY3VycmVudFtrXSBmb3IgayBpbiBoZWFkZXJzXSkKICAgICAgICBmb3IgcmVtYWluaW5nIGluIG1vcmU6CiAgICAgICAgICAgIHNlbGYuX2J1aWxkX3RhYmxlKHJlbWFpbmluZywgY3VycmVudFtyZW1haW5pbmddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRlbnRfbGV2ZWw9aW5kZW50X2xldmVsICsgMSkKCiAgICBkZWYgX2J1aWxkX3N1Yl90YWJsZV9mcm9tX2xpc3Qoc2VsZiwgY3VycmVudCwgaW5kZW50X2xldmVsLCB0aXRsZSk6CiAgICAgICAgaGVhZGVycywgbW9yZSA9IHNlbGYuX2dyb3VwX3NjYWxhcl9rZXlzX2Zyb21fbGlzdChjdXJyZW50KQogICAgICAgIHNlbGYudGFibGUuYWRkX3Jvd19oZWFkZXIoaGVhZGVycykKICAgICAgICBmaXJzdCA9IFRydWUKICAgICAgICBmb3IgZWxlbWVudCBpbiBjdXJyZW50OgogICAgICAgICAgICBpZiBub3QgZmlyc3QgYW5kIG1vcmU6CiAgICAgICAgICAgICAgICBzZWxmLnRhYmxlLm5ld19zZWN0aW9uKHRpdGxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRlbnRfbGV2ZWw9aW5kZW50X2xldmVsKQogICAgICAgICAgICAgICAgc2VsZi50YWJsZS5hZGRfcm93X2hlYWRlcihoZWFkZXJzKQogICAgICAgICAgICBmaXJzdCA9IEZhbHNlCiAgICAgICAgICAgICMgVXNlIC5nZXQoKSB0byBhY2NvdW50IGZvciB0aGUgZmFjdCB0aGF0IHNvbWV0aW1lcyBhbiBlbGVtZW50CiAgICAgICAgICAgICMgbWF5IG5vdCBoYXZlIGFsbCB0aGUga2V5cyBmcm9tIHRoZSBoZWFkZXIuCiAgICAgICAgICAgIHNlbGYudGFibGUuYWRkX3JvdyhbZWxlbWVudC5nZXQoaGVhZGVyLCAnJykgZm9yIGhlYWRlciBpbiBoZWFkZXJzXSkKICAgICAgICAgICAgZm9yIHJlbWFpbmluZyBpbiBtb3JlOgogICAgICAgICAgICAgICAgIyBTb21lIG9mIHRoZSBub24gc2NhbGFyIGF0dHJpYnV0ZXMgbWF5IG5vdCBuZWNlc3NhcmlseQogICAgICAgICAgICAgICAgIyBiZSBpbiBldmVyeSBzaW5nbGUgZWxlbWVudCBvZiB0aGUgbGlzdCwgc28gd2UgbmVlZCB0bwogICAgICAgICAgICAgICAgIyBjaGVjayB0aGlzIGNvbmRpdGlvbiBiZWZvcmUgcmVjdXJzaW5nLgogICAgICAgICAgICAgICAgaWYgcmVtYWluaW5nIGluIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fYnVpbGRfdGFibGUocmVtYWluaW5nLCBlbGVtZW50W3JlbWFpbmluZ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGVudF9sZXZlbD1pbmRlbnRfbGV2ZWwgKyAxKQoKICAgIGRlZiBfc2NhbGFyX3R5cGUoc2VsZiwgZWxlbWVudCk6CiAgICAgICAgcmV0dXJuIG5vdCBpc2luc3RhbmNlKGVsZW1lbnQsIChsaXN0LCBkaWN0KSkKCiAgICBkZWYgX2dyb3VwX3NjYWxhcl9rZXlzX2Zyb21fbGlzdChzZWxmLCBsaXN0X29mX2RpY3RzKToKICAgICAgICAjIFdlIHdhbnQgdG8gbWFrZSBzdXJlIHdlIGNhdGNoIGFsbCB0aGUga2V5cyBpbiB0aGUgbGlzdCBvZiBkaWN0cy4KICAgICAgICAjIE1vc3Qgb2YgdGhlIHRpbWUgZWFjaCBsaXN0IGVsZW1lbnQgaGFzIHRoZSBzYW1lIGtleXMsIGJ1dCBzb21ldGltZXMKICAgICAgICAjIGEgbGlzdCBlbGVtZW50IHdpbGwgaGF2ZSBrZXlzIG5vdCBkZWZpbmVkIGluIG90aGVyIGVsZW1lbnRzLgogICAgICAgIGhlYWRlcnMgPSBzZXQoKQogICAgICAgIG1vcmUgPSBzZXQoKQogICAgICAgIGZvciBpdGVtIGluIGxpc3Rfb2ZfZGljdHM6CiAgICAgICAgICAgIGN1cnJlbnRfaGVhZGVycywgY3VycmVudF9tb3JlID0gc2VsZi5fZ3JvdXBfc2NhbGFyX2tleXMoaXRlbSkKICAgICAgICAgICAgaGVhZGVycy51cGRhdGUoY3VycmVudF9oZWFkZXJzKQogICAgICAgICAgICBtb3JlLnVwZGF0ZShjdXJyZW50X21vcmUpCiAgICAgICAgaGVhZGVycyA9IGxpc3Qoc29ydGVkKGhlYWRlcnMpKQogICAgICAgIG1vcmUgPSBsaXN0KHNvcnRlZChtb3JlKSkKICAgICAgICByZXR1cm4gaGVhZGVycywgbW9yZQoKICAgIGRlZiBfZ3JvdXBfc2NhbGFyX2tleXMoc2VsZiwgY3VycmVudCk6CiAgICAgICAgIyBHaXZlbiBhIGRpY3QsIHNlcGFyYXRlIHRoZSBrZXlzIGludG8gdGhvc2Ugd2hvc2UgdmFsdWVzIGFyZQogICAgICAgICMgc2NhbGFyLCBhbmQgdGhvc2Ugd2hvc2UgdmFsdWVzIGFyZW4ndC4gIFJldHVybiB0d28gbGlzdHMsCiAgICAgICAgIyBvbmUgaXMgdGhlIHNjYWxhciB2YWx1ZSBrZXlzLCB0aGUgc2Vjb25kIGlzIHRoZSByZW1haW5pbmcga2V5cy4KICAgICAgICBtb3JlID0gW10KICAgICAgICBoZWFkZXJzID0gW10KICAgICAgICBmb3IgZWxlbWVudCBpbiBjdXJyZW50OgogICAgICAgICAgICBpZiBzZWxmLl9zY2FsYXJfdHlwZShjdXJyZW50W2VsZW1lbnRdKToKICAgICAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKGVsZW1lbnQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBtb3JlLmFwcGVuZChlbGVtZW50KQogICAgICAgIGhlYWRlcnMuc29ydCgpCiAgICAgICAgbW9yZS5zb3J0KCkKICAgICAgICByZXR1cm4gaGVhZGVycywgbW9yZQoKCmNsYXNzIFRleHRGb3JtYXR0ZXIoRm9ybWF0dGVyKToKCiAgICBkZWYgX19jYWxsX18oc2VsZiwgY29tbWFuZF9uYW1lLCByZXNwb25zZSwgc3RyZWFtPU5vbmUpOgogICAgICAgIGlmIHN0cmVhbSBpcyBOb25lOgogICAgICAgICAgICBzdHJlYW0gPSBzZWxmLl9nZXRfZGVmYXVsdF9zdHJlYW0oKQogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgaXNfcmVzcG9uc2VfcGFnaW5hdGVkKHJlc3BvbnNlKToKICAgICAgICAgICAgICAgIHJlc3VsdF9rZXlzID0gcmVzcG9uc2UucmVzdWx0X2tleXMKICAgICAgICAgICAgICAgIGZvciBpLCBwYWdlIGluIGVudW1lcmF0ZShyZXNwb25zZSk6CiAgICAgICAgICAgICAgICAgICAgaWYgaSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSB7fQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSByZXNwb25zZS5ub25fYWdncmVnYXRlX3BhcnQKCiAgICAgICAgICAgICAgICAgICAgZm9yIHJlc3VsdF9rZXkgaW4gcmVzdWx0X2tleXM6CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSByZXN1bHRfa2V5LnNlYXJjaChwYWdlKQogICAgICAgICAgICAgICAgICAgICAgICBzZXRfdmFsdWVfZnJvbV9qbWVzcGF0aCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRfa2V5LmV4cHJlc3Npb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBzZWxmLl9mb3JtYXRfcmVzcG9uc2UoY3VycmVudCwgc3RyZWFtKQogICAgICAgICAgICAgICAgaWYgcmVzcG9uc2UucmVzdW1lX3Rva2VuOgogICAgICAgICAgICAgICAgICAgICMgVGVsbCB0aGUgdXNlciBhYm91dCB0aGUgbmV4dCB0b2tlbiBzbyB0aGV5IGNhbiBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICMgaWYgdGhleSB3YW50LgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2Zvcm1hdF9yZXNwb25zZSgKICAgICAgICAgICAgICAgICAgICAgICAgeydOZXh0VG9rZW4nOiB7J05leHRUb2tlbic6IHJlc3BvbnNlLnJlc3VtZV90b2tlbn19LAogICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLl9yZW1vdmVfcmVxdWVzdF9pZChyZXNwb25zZSkKICAgICAgICAgICAgICAgIHNlbGYuX2Zvcm1hdF9yZXNwb25zZShyZXNwb25zZSwgc3RyZWFtKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICMgZmx1c2ggaXMgbmVlZGVkIHRvIGF2b2lkIHRoZSAiY2xvc2UgZmFpbGVkIGluIGZpbGUgb2JqZWN0CiAgICAgICAgICAgICMgZGVzdHJ1Y3RvciIgaW4gcHl0aG9uMi54IChzZWUgaHR0cDovL2J1Z3MucHl0aG9uLm9yZy9pc3N1ZTExMzgwKS4KICAgICAgICAgICAgc2VsZi5fZmx1c2hfc3RyZWFtKHN0cmVhbSkKCiAgICBkZWYgX2Zvcm1hdF9yZXNwb25zZShzZWxmLCByZXNwb25zZSwgc3RyZWFtKToKICAgICAgICBpZiBzZWxmLl9hcmdzLnF1ZXJ5IGlzIG5vdCBOb25lOgogICAgICAgICAgICBleHByZXNzaW9uID0gc2VsZi5fYXJncy5xdWVyeQogICAgICAgICAgICByZXNwb25zZSA9IGV4cHJlc3Npb24uc2VhcmNoKHJlc3BvbnNlKQogICAgICAgIHRleHQuZm9ybWF0X3RleHQocmVzcG9uc2UsIHN0cmVhbSkKCgpkZWYgZ2V0X2Zvcm1hdHRlcihmb3JtYXRfdHlwZSwgYXJncyk6CiAgICBpZiBmb3JtYXRfdHlwZSA9PSAnanNvbic6CiAgICAgICAgcmV0dXJuIEpTT05Gb3JtYXR0ZXIoYXJncykKICAgIGVsaWYgZm9ybWF0X3R5cGUgPT0gJ3RleHQnOgogICAgICAgIHJldHVybiBUZXh0Rm9ybWF0dGVyKGFyZ3MpCiAgICBlbGlmIGZvcm1hdF90eXBlID09ICd0YWJsZSc6CiAgICAgICAgcmV0dXJuIFRhYmxlRm9ybWF0dGVyKGFyZ3MpCiAgICByYWlzZSBWYWx1ZUVycm9yKCJVbmtub3duIG91dHB1dCB0eXBlOiAlcyIgJSBmb3JtYXRfdHlwZSkK
