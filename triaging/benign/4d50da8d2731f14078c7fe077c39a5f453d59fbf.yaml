statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/contrib/_securetransport/low_level.py
  contents:
  - name: _is_identity
    score: 0.0
    code: |-
      def _is_identity(item):
          """
          Returns True if a given CFTypeRef is an identity.
          """
          expected = Security.SecIdentityGetTypeID()
          return CoreFoundation.CFGetTypeID(item) == expected
    tokens: resume load_global Security load_attr STRING_BASE64_LEN_S_ENT_HIGH call store_fast expected load_global CoreFoundation load_attr CFGetTypeID load_fast item call load_fast expected compare_op == return_value
    hash: 47149bf26761b057eb25bf01b4c64e0cdd28c6d4895b80e480cad78a178a627a
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/contrib/_securetransport/low_level.py
  : IiIiCkxvdy1sZXZlbCBoZWxwZXJzIGZvciB0aGUgU2VjdXJlVHJhbnNwb3J0IGJpbmRpbmdzLgoKVGhlc2UgYXJlIFB5dGhvbiBmdW5jdGlvbnMgdGhhdCBhcmUgbm90IGRpcmVjdGx5IHJlbGF0ZWQgdG8gdGhlIGhpZ2gtbGV2ZWwgQVBJcwpidXQgYXJlIG5lY2Vzc2FyeSB0byBnZXQgdGhlbSB0byB3b3JrLiBUaGV5IGluY2x1ZGUgYSB3aG9sZSBidW5jaCBvZiBsb3ctbGV2ZWwKQ29yZUZvdW5kYXRpb24gbWVzc2luZyBhYm91dCBhbmQgbWVtb3J5IG1hbmFnZW1lbnQuIFRoZSBjb25jZXJucyBpbiB0aGlzIG1vZHVsZQphcmUgYWxtb3N0IGVudGlyZWx5IGFib3V0IHRyeWluZyB0byBhdm9pZCBtZW1vcnkgbGVha3MgYW5kIHByb3ZpZGluZwphcHByb3ByaWF0ZSBhbmQgdXNlZnVsIGFzc2lzdGFuY2UgdG8gdGhlIGhpZ2hlci1sZXZlbCBjb2RlLgoiIiIKaW1wb3J0IGJhc2U2NAppbXBvcnQgY3R5cGVzCmltcG9ydCBpdGVydG9vbHMKaW1wb3J0IHJlCmltcG9ydCBvcwppbXBvcnQgc3NsCmltcG9ydCB0ZW1wZmlsZQoKZnJvbSAuYmluZGluZ3MgaW1wb3J0IFNlY3VyaXR5LCBDb3JlRm91bmRhdGlvbiwgQ0ZDb25zdAoKCiMgVGhpcyByZWd1bGFyIGV4cHJlc3Npb24gaXMgdXNlZCB0byBncmFiIFBFTSBkYXRhIG91dCBvZiBhIFBFTSBidW5kbGUuCl9QRU1fQ0VSVFNfUkUgPSByZS5jb21waWxlKAogICAgYiItLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS1cbiguKj8pXG4tLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tIiwgcmUuRE9UQUxMCikKCgpkZWYgX2NmX2RhdGFfZnJvbV9ieXRlcyhieXRlc3RyaW5nKToKICAgICIiIgogICAgR2l2ZW4gYSBieXRlc3RyaW5nLCBjcmVhdGUgYSBDRkRhdGEgb2JqZWN0IGZyb20gaXQuIFRoaXMgQ0ZEYXRhIG9iamVjdCBtdXN0CiAgICBiZSBDRlJlbGVhc2VkIGJ5IHRoZSBjYWxsZXIuCiAgICAiIiIKICAgIHJldHVybiBDb3JlRm91bmRhdGlvbi5DRkRhdGFDcmVhdGUoCiAgICAgICAgQ29yZUZvdW5kYXRpb24ua0NGQWxsb2NhdG9yRGVmYXVsdCwgYnl0ZXN0cmluZywgbGVuKGJ5dGVzdHJpbmcpCiAgICApCgoKZGVmIF9jZl9kaWN0aW9uYXJ5X2Zyb21fdHVwbGVzKHR1cGxlcyk6CiAgICAiIiIKICAgIEdpdmVuIGEgbGlzdCBvZiBQeXRob24gdHVwbGVzLCBjcmVhdGUgYW4gYXNzb2NpYXRlZCBDRkRpY3Rpb25hcnkuCiAgICAiIiIKICAgIGRpY3Rpb25hcnlfc2l6ZSA9IGxlbih0dXBsZXMpCgogICAgIyBXZSBuZWVkIHRvIGdldCB0aGUgZGljdGlvbmFyeSBrZXlzIGFuZCB2YWx1ZXMgb3V0IGluIHRoZSBzYW1lIG9yZGVyLgogICAga2V5cyA9ICh0WzBdIGZvciB0IGluIHR1cGxlcykKICAgIHZhbHVlcyA9ICh0WzFdIGZvciB0IGluIHR1cGxlcykKICAgIGNmX2tleXMgPSAoQ29yZUZvdW5kYXRpb24uQ0ZUeXBlUmVmICogZGljdGlvbmFyeV9zaXplKSgqa2V5cykKICAgIGNmX3ZhbHVlcyA9IChDb3JlRm91bmRhdGlvbi5DRlR5cGVSZWYgKiBkaWN0aW9uYXJ5X3NpemUpKCp2YWx1ZXMpCgogICAgcmV0dXJuIENvcmVGb3VuZGF0aW9uLkNGRGljdGlvbmFyeUNyZWF0ZSgKICAgICAgICBDb3JlRm91bmRhdGlvbi5rQ0ZBbGxvY2F0b3JEZWZhdWx0LAogICAgICAgIGNmX2tleXMsCiAgICAgICAgY2ZfdmFsdWVzLAogICAgICAgIGRpY3Rpb25hcnlfc2l6ZSwKICAgICAgICBDb3JlRm91bmRhdGlvbi5rQ0ZUeXBlRGljdGlvbmFyeUtleUNhbGxCYWNrcywKICAgICAgICBDb3JlRm91bmRhdGlvbi5rQ0ZUeXBlRGljdGlvbmFyeVZhbHVlQ2FsbEJhY2tzLAogICAgKQoKCmRlZiBfY2Zfc3RyaW5nX3RvX3VuaWNvZGUodmFsdWUpOgogICAgIiIiCiAgICBDcmVhdGVzIGEgVW5pY29kZSBzdHJpbmcgZnJvbSBhIENGU3RyaW5nIG9iamVjdC4gVXNlZCBlbnRpcmVseSBmb3IgZXJyb3IKICAgIHJlcG9ydGluZy4KCiAgICBZZXMsIGl0IGFubm95cyBtZSBxdWl0ZSBhIGxvdCB0aGF0IHRoaXMgZnVuY3Rpb24gaXMgdGhpcyBjb21wbGV4LgogICAgIiIiCiAgICB2YWx1ZV9hc192b2lkX3AgPSBjdHlwZXMuY2FzdCh2YWx1ZSwgY3R5cGVzLlBPSU5URVIoY3R5cGVzLmNfdm9pZF9wKSkKCiAgICBzdHJpbmcgPSBDb3JlRm91bmRhdGlvbi5DRlN0cmluZ0dldENTdHJpbmdQdHIoCiAgICAgICAgdmFsdWVfYXNfdm9pZF9wLAogICAgICAgIENGQ29uc3Qua0NGU3RyaW5nRW5jb2RpbmdVVEY4CiAgICApCiAgICBpZiBzdHJpbmcgaXMgTm9uZToKICAgICAgICBidWZmZXIgPSBjdHlwZXMuY3JlYXRlX3N0cmluZ19idWZmZXIoMTAyNCkKICAgICAgICByZXN1bHQgPSBDb3JlRm91bmRhdGlvbi5DRlN0cmluZ0dldENTdHJpbmcoCiAgICAgICAgICAgIHZhbHVlX2FzX3ZvaWRfcCwKICAgICAgICAgICAgYnVmZmVyLAogICAgICAgICAgICAxMDI0LAogICAgICAgICAgICBDRkNvbnN0LmtDRlN0cmluZ0VuY29kaW5nVVRGOAogICAgICAgICkKICAgICAgICBpZiBub3QgcmVzdWx0OgogICAgICAgICAgICByYWlzZSBPU0Vycm9yKCdFcnJvciBjb3B5aW5nIEMgc3RyaW5nIGZyb20gQ0ZTdHJpbmdSZWYnKQogICAgICAgIHN0cmluZyA9IGJ1ZmZlci52YWx1ZQogICAgaWYgc3RyaW5nIGlzIG5vdCBOb25lOgogICAgICAgIHN0cmluZyA9IHN0cmluZy5kZWNvZGUoJ3V0Zi04JykKICAgIHJldHVybiBzdHJpbmcKCgpkZWYgX2Fzc2VydF9ub19lcnJvcihlcnJvciwgZXhjZXB0aW9uX2NsYXNzPU5vbmUpOgogICAgIiIiCiAgICBDaGVja3MgdGhlIHJldHVybiBjb2RlIGFuZCB0aHJvd3MgYW4gZXhjZXB0aW9uIGlmIHRoZXJlIGlzIGFuIGVycm9yIHRvCiAgICByZXBvcnQKICAgICIiIgogICAgaWYgZXJyb3IgPT0gMDoKICAgICAgICByZXR1cm4KCiAgICBjZl9lcnJvcl9zdHJpbmcgPSBTZWN1cml0eS5TZWNDb3B5RXJyb3JNZXNzYWdlU3RyaW5nKGVycm9yLCBOb25lKQogICAgb3V0cHV0ID0gX2NmX3N0cmluZ190b191bmljb2RlKGNmX2Vycm9yX3N0cmluZykKICAgIENvcmVGb3VuZGF0aW9uLkNGUmVsZWFzZShjZl9lcnJvcl9zdHJpbmcpCgogICAgaWYgb3V0cHV0IGlzIE5vbmUgb3Igb3V0cHV0ID09IHUnJzoKICAgICAgICBvdXRwdXQgPSB1J09TU3RhdHVzICVzJyAlIGVycm9yCgogICAgaWYgZXhjZXB0aW9uX2NsYXNzIGlzIE5vbmU6CiAgICAgICAgZXhjZXB0aW9uX2NsYXNzID0gc3NsLlNTTEVycm9yCgogICAgcmFpc2UgZXhjZXB0aW9uX2NsYXNzKG91dHB1dCkKCgpkZWYgX2NlcnRfYXJyYXlfZnJvbV9wZW0ocGVtX2J1bmRsZSk6CiAgICAiIiIKICAgIEdpdmVuIGEgYnVuZGxlIG9mIGNlcnRzIGluIFBFTSBmb3JtYXQsIHR1cm5zIHRoZW0gaW50byBhIENGQXJyYXkgb2YgY2VydHMKICAgIHRoYXQgY2FuIGJlIHVzZWQgdG8gdmFsaWRhdGUgYSBjZXJ0IGNoYWluLgogICAgIiIiCiAgICAjIE5vcm1hbGl6ZSB0aGUgUEVNIGJ1bmRsZSdzIGxpbmUgZW5kaW5ncy4KICAgIHBlbV9idW5kbGUgPSBwZW1fYnVuZGxlLnJlcGxhY2UoYiJcclxuIiwgYiJcbiIpCgogICAgZGVyX2NlcnRzID0gWwogICAgICAgIGJhc2U2NC5iNjRkZWNvZGUobWF0Y2guZ3JvdXAoMSkpCiAgICAgICAgZm9yIG1hdGNoIGluIF9QRU1fQ0VSVFNfUkUuZmluZGl0ZXIocGVtX2J1bmRsZSkKICAgIF0KICAgIGlmIG5vdCBkZXJfY2VydHM6CiAgICAgICAgcmFpc2Ugc3NsLlNTTEVycm9yKCJObyByb290IGNlcnRpZmljYXRlcyBzcGVjaWZpZWQiKQoKICAgIGNlcnRfYXJyYXkgPSBDb3JlRm91bmRhdGlvbi5DRkFycmF5Q3JlYXRlTXV0YWJsZSgKICAgICAgICBDb3JlRm91bmRhdGlvbi5rQ0ZBbGxvY2F0b3JEZWZhdWx0LAogICAgICAgIDAsCiAgICAgICAgY3R5cGVzLmJ5cmVmKENvcmVGb3VuZGF0aW9uLmtDRlR5cGVBcnJheUNhbGxCYWNrcykKICAgICkKICAgIGlmIG5vdCBjZXJ0X2FycmF5OgogICAgICAgIHJhaXNlIHNzbC5TU0xFcnJvcigiVW5hYmxlIHRvIGFsbG9jYXRlIG1lbW9yeSEiKQoKICAgIHRyeToKICAgICAgICBmb3IgZGVyX2J5dGVzIGluIGRlcl9jZXJ0czoKICAgICAgICAgICAgY2VydGRhdGEgPSBfY2ZfZGF0YV9mcm9tX2J5dGVzKGRlcl9ieXRlcykKICAgICAgICAgICAgaWYgbm90IGNlcnRkYXRhOgogICAgICAgICAgICAgICAgcmFpc2Ugc3NsLlNTTEVycm9yKCJVbmFibGUgdG8gYWxsb2NhdGUgbWVtb3J5ISIpCiAgICAgICAgICAgIGNlcnQgPSBTZWN1cml0eS5TZWNDZXJ0aWZpY2F0ZUNyZWF0ZVdpdGhEYXRhKAogICAgICAgICAgICAgICAgQ29yZUZvdW5kYXRpb24ua0NGQWxsb2NhdG9yRGVmYXVsdCwgY2VydGRhdGEKICAgICAgICAgICAgKQogICAgICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJlbGVhc2UoY2VydGRhdGEpCiAgICAgICAgICAgIGlmIG5vdCBjZXJ0OgogICAgICAgICAgICAgICAgcmFpc2Ugc3NsLlNTTEVycm9yKCJVbmFibGUgdG8gYnVpbGQgY2VydCBvYmplY3QhIikKCiAgICAgICAgICAgIENvcmVGb3VuZGF0aW9uLkNGQXJyYXlBcHBlbmRWYWx1ZShjZXJ0X2FycmF5LCBjZXJ0KQogICAgICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJlbGVhc2UoY2VydCkKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgIyBXZSBuZWVkIHRvIGZyZWUgdGhlIGFycmF5IGJlZm9yZSB0aGUgZXhjZXB0aW9uIGJ1YmJsZXMgZnVydGhlci4KICAgICAgICAjIFdlIG9ubHkgd2FudCB0byBkbyB0aGF0IGlmIGFuIGVycm9yIG9jY3Vyczogb3RoZXJ3aXNlLCB0aGUgY2FsbGVyCiAgICAgICAgIyBzaG91bGQgZnJlZS4KICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJlbGVhc2UoY2VydF9hcnJheSkKCiAgICByZXR1cm4gY2VydF9hcnJheQoKCmRlZiBfaXNfY2VydChpdGVtKToKICAgICIiIgogICAgUmV0dXJucyBUcnVlIGlmIGEgZ2l2ZW4gQ0ZUeXBlUmVmIGlzIGEgY2VydGlmaWNhdGUuCiAgICAiIiIKICAgIGV4cGVjdGVkID0gU2VjdXJpdHkuU2VjQ2VydGlmaWNhdGVHZXRUeXBlSUQoKQogICAgcmV0dXJuIENvcmVGb3VuZGF0aW9uLkNGR2V0VHlwZUlEKGl0ZW0pID09IGV4cGVjdGVkCgoKZGVmIF9pc19pZGVudGl0eShpdGVtKToKICAgICIiIgogICAgUmV0dXJucyBUcnVlIGlmIGEgZ2l2ZW4gQ0ZUeXBlUmVmIGlzIGFuIGlkZW50aXR5LgogICAgIiIiCiAgICBleHBlY3RlZCA9IFNlY3VyaXR5LlNlY0lkZW50aXR5R2V0VHlwZUlEKCkKICAgIHJldHVybiBDb3JlRm91bmRhdGlvbi5DRkdldFR5cGVJRChpdGVtKSA9PSBleHBlY3RlZAoKCmRlZiBfdGVtcG9yYXJ5X2tleWNoYWluKCk6CiAgICAiIiIKICAgIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyBhIHRlbXBvcmFyeSBNYWMga2V5Y2hhaW4gdGhhdCB3ZSBjYW4gdXNlIHRvIHdvcmsgd2l0aAogICAgY3JlZGVudGlhbHMuIFRoaXMga2V5Y2hhaW4gdXNlcyBhIG9uZS10aW1lIHBhc3N3b3JkIGFuZCBhIHRlbXBvcmFyeSBmaWxlIHRvCiAgICBzdG9yZSB0aGUgZGF0YS4gV2UgZXhwZWN0IHRvIGhhdmUgb25lIGtleWNoYWluIHBlciBzb2NrZXQuIFRoZSByZXR1cm5lZAogICAgU2VjS2V5Y2hhaW5SZWYgbXVzdCBiZSBmcmVlZCBieSB0aGUgY2FsbGVyLCBpbmNsdWRpbmcgY2FsbGluZwogICAgU2VjS2V5Y2hhaW5EZWxldGUuCgogICAgUmV0dXJucyBhIHR1cGxlIG9mIHRoZSBTZWNLZXljaGFpblJlZiBhbmQgdGhlIHBhdGggdG8gdGhlIHRlbXBvcmFyeQogICAgZGlyZWN0b3J5IHRoYXQgY29udGFpbnMgaXQuCiAgICAiIiIKICAgICMgVW5mb3J0dW5hdGVseSwgU2VjS2V5Y2hhaW5DcmVhdGUgcmVxdWlyZXMgYSBwYXRoIHRvIGEga2V5Y2hhaW4uIFRoaXMKICAgICMgbWVhbnMgd2UgY2Fubm90IHVzZSBta3N0ZW1wIHRvIHVzZSBhIGdlbmVyaWMgdGVtcG9yYXJ5IGZpbGUuIEluc3RlYWQsCiAgICAjIHdlJ3JlIGdvaW5nIHRvIGNyZWF0ZSBhIHRlbXBvcmFyeSBkaXJlY3RvcnkgYW5kIGEgZmlsZW5hbWUgdG8gdXNlIHRoZXJlLgogICAgIyBUaGlzIGZpbGVuYW1lIHdpbGwgYmUgOCByYW5kb20gYnl0ZXMgZXhwYW5kZWQgaW50byBiYXNlNjQuIFdlIGFsc28gbmVlZAogICAgIyBzb21lIHJhbmRvbSBieXRlcyB0byBwYXNzd29yZC1wcm90ZWN0IHRoZSBrZXljaGFpbiB3ZSdyZSBjcmVhdGluZywgc28gd2UKICAgICMgYXNrIGZvciA0MCByYW5kb20gYnl0ZXMuCiAgICByYW5kb21fYnl0ZXMgPSBvcy51cmFuZG9tKDQwKQogICAgZmlsZW5hbWUgPSBiYXNlNjQuYjE2ZW5jb2RlKHJhbmRvbV9ieXRlc1s6OF0pLmRlY29kZSgndXRmLTgnKQogICAgcGFzc3dvcmQgPSBiYXNlNjQuYjE2ZW5jb2RlKHJhbmRvbV9ieXRlc1s4Ol0pICAjIE11c3QgYmUgdmFsaWQgVVRGLTgKICAgIHRlbXBkaXJlY3RvcnkgPSB0ZW1wZmlsZS5ta2R0ZW1wKCkKCiAgICBrZXljaGFpbl9wYXRoID0gb3MucGF0aC5qb2luKHRlbXBkaXJlY3RvcnksIGZpbGVuYW1lKS5lbmNvZGUoJ3V0Zi04JykKCiAgICAjIFdlIG5vdyB3YW50IHRvIGNyZWF0ZSB0aGUga2V5Y2hhaW4gaXRzZWxmLgogICAga2V5Y2hhaW4gPSBTZWN1cml0eS5TZWNLZXljaGFpblJlZigpCiAgICBzdGF0dXMgPSBTZWN1cml0eS5TZWNLZXljaGFpbkNyZWF0ZSgKICAgICAgICBrZXljaGFpbl9wYXRoLAogICAgICAgIGxlbihwYXNzd29yZCksCiAgICAgICAgcGFzc3dvcmQsCiAgICAgICAgRmFsc2UsCiAgICAgICAgTm9uZSwKICAgICAgICBjdHlwZXMuYnlyZWYoa2V5Y2hhaW4pCiAgICApCiAgICBfYXNzZXJ0X25vX2Vycm9yKHN0YXR1cykKCiAgICAjIEhhdmluZyBjcmVhdGVkIHRoZSBrZXljaGFpbiwgd2Ugd2FudCB0byBwYXNzIGl0IG9mZiB0byB0aGUgY2FsbGVyLgogICAgcmV0dXJuIGtleWNoYWluLCB0ZW1wZGlyZWN0b3J5CgoKZGVmIF9sb2FkX2l0ZW1zX2Zyb21fZmlsZShrZXljaGFpbiwgcGF0aCk6CiAgICAiIiIKICAgIEdpdmVuIGEgc2luZ2xlIGZpbGUsIGxvYWRzIGFsbCB0aGUgdHJ1c3Qgb2JqZWN0cyBmcm9tIGl0IGludG8gYXJyYXlzIGFuZAogICAgdGhlIGtleWNoYWluLgogICAgUmV0dXJucyBhIHR1cGxlIG9mIGxpc3RzOiB0aGUgZmlyc3QgbGlzdCBpcyBhIGxpc3Qgb2YgaWRlbnRpdGllcywgdGhlCiAgICBzZWNvbmQgYSBsaXN0IG9mIGNlcnRzLgogICAgIiIiCiAgICBjZXJ0aWZpY2F0ZXMgPSBbXQogICAgaWRlbnRpdGllcyA9IFtdCiAgICByZXN1bHRfYXJyYXkgPSBOb25lCgogICAgd2l0aCBvcGVuKHBhdGgsICdyYicpIGFzIGY6CiAgICAgICAgcmF3X2ZpbGVkYXRhID0gZi5yZWFkKCkKCiAgICB0cnk6CiAgICAgICAgZmlsZWRhdGEgPSBDb3JlRm91bmRhdGlvbi5DRkRhdGFDcmVhdGUoCiAgICAgICAgICAgIENvcmVGb3VuZGF0aW9uLmtDRkFsbG9jYXRvckRlZmF1bHQsCiAgICAgICAgICAgIHJhd19maWxlZGF0YSwKICAgICAgICAgICAgbGVuKHJhd19maWxlZGF0YSkKICAgICAgICApCiAgICAgICAgcmVzdWx0X2FycmF5ID0gQ29yZUZvdW5kYXRpb24uQ0ZBcnJheVJlZigpCiAgICAgICAgcmVzdWx0ID0gU2VjdXJpdHkuU2VjSXRlbUltcG9ydCgKICAgICAgICAgICAgZmlsZWRhdGEsICAjIGNlcnQgZGF0YQogICAgICAgICAgICBOb25lLCAgIyBGaWxlbmFtZSwgbGVhdmluZyBpdCBvdXQgZm9yIG5vdwogICAgICAgICAgICBOb25lLCAgIyBXaGF0IHRoZSB0eXBlIG9mIHRoZSBmaWxlIGlzLCB3ZSBkb24ndCBjYXJlCiAgICAgICAgICAgIE5vbmUsICAjIHdoYXQncyBpbiB0aGUgZmlsZSwgd2UgZG9uJ3QgY2FyZQogICAgICAgICAgICAwLCAgIyBpbXBvcnQgZmxhZ3MKICAgICAgICAgICAgTm9uZSwgICMga2V5IHBhcmFtcywgY2FuIGluY2x1ZGUgcGFzc3BocmFzZSBpbiB0aGUgZnV0dXJlCiAgICAgICAgICAgIGtleWNoYWluLCAgIyBUaGUga2V5Y2hhaW4gdG8gaW5zZXJ0IGludG8KICAgICAgICAgICAgY3R5cGVzLmJ5cmVmKHJlc3VsdF9hcnJheSkgICMgUmVzdWx0cwogICAgICAgICkKICAgICAgICBfYXNzZXJ0X25vX2Vycm9yKHJlc3VsdCkKCiAgICAgICAgIyBBIENGQXJyYXkgaXMgbm90IHZlcnkgdXNlZnVsIHRvIHVzIGFzIGFuIGludGVybWVkaWFyeQogICAgICAgICMgcmVwcmVzZW50YXRpb24sIHNvIHdlIGFyZSBnb2luZyB0byBleHRyYWN0IHRoZSBvYmplY3RzIHdlIHdhbnQKICAgICAgICAjIGFuZCB0aGVuIGZyZWUgdGhlIGFycmF5LiBXZSBkb24ndCBuZWVkIHRvIGtlZXAgaG9sZCBvZiBrZXlzOiB0aGUKICAgICAgICAjIGtleWNoYWluIGFscmVhZHkgaGFzIHRoZW0hCiAgICAgICAgcmVzdWx0X2NvdW50ID0gQ29yZUZvdW5kYXRpb24uQ0ZBcnJheUdldENvdW50KHJlc3VsdF9hcnJheSkKICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UocmVzdWx0X2NvdW50KToKICAgICAgICAgICAgaXRlbSA9IENvcmVGb3VuZGF0aW9uLkNGQXJyYXlHZXRWYWx1ZUF0SW5kZXgoCiAgICAgICAgICAgICAgICByZXN1bHRfYXJyYXksIGluZGV4CiAgICAgICAgICAgICkKICAgICAgICAgICAgaXRlbSA9IGN0eXBlcy5jYXN0KGl0ZW0sIENvcmVGb3VuZGF0aW9uLkNGVHlwZVJlZikKCiAgICAgICAgICAgIGlmIF9pc19jZXJ0KGl0ZW0pOgogICAgICAgICAgICAgICAgQ29yZUZvdW5kYXRpb24uQ0ZSZXRhaW4oaXRlbSkKICAgICAgICAgICAgICAgIGNlcnRpZmljYXRlcy5hcHBlbmQoaXRlbSkKICAgICAgICAgICAgZWxpZiBfaXNfaWRlbnRpdHkoaXRlbSk6CiAgICAgICAgICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJldGFpbihpdGVtKQogICAgICAgICAgICAgICAgaWRlbnRpdGllcy5hcHBlbmQoaXRlbSkKICAgIGZpbmFsbHk6CiAgICAgICAgaWYgcmVzdWx0X2FycmF5OgogICAgICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJlbGVhc2UocmVzdWx0X2FycmF5KQoKICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJlbGVhc2UoZmlsZWRhdGEpCgogICAgcmV0dXJuIChpZGVudGl0aWVzLCBjZXJ0aWZpY2F0ZXMpCgoKZGVmIF9sb2FkX2NsaWVudF9jZXJ0X2NoYWluKGtleWNoYWluLCAqcGF0aHMpOgogICAgIiIiCiAgICBMb2FkIGNlcnRpZmljYXRlcyBhbmQgbWF5YmUga2V5cyBmcm9tIGEgbnVtYmVyIG9mIGZpbGVzLiBIYXMgdGhlIGVuZCBnb2FsCiAgICBvZiByZXR1cm5pbmcgYSBDRkFycmF5IGNvbnRhaW5pbmcgb25lIFNlY0lkZW50aXR5UmVmLCBhbmQgdGhlbiB6ZXJvIG9yIG1vcmUKICAgIFNlY0NlcnRpZmljYXRlUmVmIG9iamVjdHMsIHN1aXRhYmxlIGZvciB1c2UgYXMgYSBjbGllbnQgY2VydGlmaWNhdGUgdHJ1c3QKICAgIGNoYWluLgogICAgIiIiCiAgICAjIE9rLCB0aGUgc3RyYXRlZ3kuCiAgICAjCiAgICAjIFRoaXMgcmVsaWVzIG9uIGtub3dpbmcgdGhhdCBtYWNPUyB3aWxsIG5vdCBnaXZlIHlvdSBhIFNlY0lkZW50aXR5UmVmCiAgICAjIHVubGVzcyB5b3UgaGF2ZSBpbXBvcnRlZCBhIGtleSBpbnRvIGEga2V5Y2hhaW4uIFRoaXMgaXMgYSBzb21ld2hhdAogICAgIyBhcnRpZmljaWFsIGxpbWl0YXRpb24gb2YgbWFjT1MgKGZvciBleGFtcGxlLCBpdCBkb2Vzbid0IG5lY2Vzc2FyaWx5CiAgICAjIGFmZmVjdCBpT1MpLCBidXQgdGhlcmUgaXMgbm90aGluZyBpbnNpZGUgU2VjdXJpdHkuZnJhbWV3b3JrIHRoYXQgbGV0cyB5b3UKICAgICMgZ2V0IGEgU2VjSWRlbnRpdHlSZWYgd2l0aG91dCBoYXZpbmcgYSBrZXkgaW4gYSBrZXljaGFpbi4KICAgICMKICAgICMgU28gdGhlIHBvbGljeSBoZXJlIGlzIHdlIHRha2UgYWxsIHRoZSBmaWxlcyBhbmQgaXRlcmF0ZSB0aGVtIGluIG9yZGVyLgogICAgIyBFYWNoIG9uZSB3aWxsIHVzZSBTZWNJdGVtSW1wb3J0IHRvIGhhdmUgb25lIG9yIG1vcmUgb2JqZWN0cyBsb2FkZWQgZnJvbQogICAgIyBpdC4gV2Ugd2lsbCBhbHNvIHBvaW50IGF0IGEga2V5Y2hhaW4gdGhhdCBtYWNPUyBjYW4gdXNlIHRvIHdvcmsgd2l0aCB0aGUKICAgICMgcHJpdmF0ZSBrZXkuCiAgICAjCiAgICAjIE9uY2Ugd2UgaGF2ZSBhbGwgdGhlIG9iamVjdHMsIHdlJ2xsIGNoZWNrIHdoYXQgd2UgYWN0dWFsbHkgaGF2ZS4gSWYgd2UKICAgICMgYWxyZWFkeSBoYXZlIGEgU2VjSWRlbnRpdHlSZWYgaW4gaGFuZCwgZmFiOiB3ZSdsbCB1c2UgdGhhdC4gT3RoZXJ3aXNlLAogICAgIyB3ZSdsbCB0YWtlIHRoZSBmaXJzdCBjZXJ0aWZpY2F0ZSAod2hpY2ggd2UgYXNzdW1lIHRvIGJlIG91ciBsZWFmKSBhbmQKICAgICMgYXNrIHRoZSBrZXljaGFpbiB0byBnaXZlIHVzIGEgU2VjSWRlbnRpdHlSZWYgd2l0aCB0aGF0IGNlcnQncyBhc3NvY2lhdGVkCiAgICAjIGtleS4KICAgICMKICAgICMgV2UnbGwgdGhlbiByZXR1cm4gYSBDRkFycmF5IGNvbnRhaW5pbmcgdGhlIHRydXN0IGNoYWluOiBvbmUKICAgICMgU2VjSWRlbnRpdHlSZWYgYW5kIHRoZW4gemVyby1vci1tb3JlIFNlY0NlcnRpZmljYXRlUmVmIG9iamVjdHMuIFRoZQogICAgIyByZXNwb25zaWJpbGl0eSBmb3IgZnJlZWluZyB0aGlzIENGQXJyYXkgd2lsbCBiZSB3aXRoIHRoZSBjYWxsZXIuIFRoaXMKICAgICMgQ0ZBcnJheSBtdXN0IHJlbWFpbiBhbGl2ZSBmb3IgdGhlIGVudGlyZSBjb25uZWN0aW9uLCBzbyBpbiBwcmFjdGljZSBpdAogICAgIyB3aWxsIGJlIHN0b3JlZCB3aXRoIGEgc2luZ2xlIFNTTFNvY2tldCwgYWxvbmcgd2l0aCB0aGUgcmVmZXJlbmNlIHRvIHRoZQogICAgIyBrZXljaGFpbi4KICAgIGNlcnRpZmljYXRlcyA9IFtdCiAgICBpZGVudGl0aWVzID0gW10KCiAgICAjIEZpbHRlciBvdXQgYmFkIHBhdGhzLgogICAgcGF0aHMgPSAocGF0aCBmb3IgcGF0aCBpbiBwYXRocyBpZiBwYXRoKQoKICAgIHRyeToKICAgICAgICBmb3IgZmlsZV9wYXRoIGluIHBhdGhzOgogICAgICAgICAgICBuZXdfaWRlbnRpdGllcywgbmV3X2NlcnRzID0gX2xvYWRfaXRlbXNfZnJvbV9maWxlKAogICAgICAgICAgICAgICAga2V5Y2hhaW4sIGZpbGVfcGF0aAogICAgICAgICAgICApCiAgICAgICAgICAgIGlkZW50aXRpZXMuZXh0ZW5kKG5ld19pZGVudGl0aWVzKQogICAgICAgICAgICBjZXJ0aWZpY2F0ZXMuZXh0ZW5kKG5ld19jZXJ0cykKCiAgICAgICAgIyBPaywgd2UgaGF2ZSBldmVyeXRoaW5nLiBUaGUgcXVlc3Rpb24gaXM6IGRvIHdlIGhhdmUgYW4gaWRlbnRpdHk/IElmCiAgICAgICAgIyBub3QsIHdlIHdhbnQgdG8gZ3JhYiBvbmUgZnJvbSB0aGUgZmlyc3QgY2VydCB3ZSBoYXZlLgogICAgICAgIGlmIG5vdCBpZGVudGl0aWVzOgogICAgICAgICAgICBuZXdfaWRlbnRpdHkgPSBTZWN1cml0eS5TZWNJZGVudGl0eVJlZigpCiAgICAgICAgICAgIHN0YXR1cyA9IFNlY3VyaXR5LlNlY0lkZW50aXR5Q3JlYXRlV2l0aENlcnRpZmljYXRlKAogICAgICAgICAgICAgICAga2V5Y2hhaW4sCiAgICAgICAgICAgICAgICBjZXJ0aWZpY2F0ZXNbMF0sCiAgICAgICAgICAgICAgICBjdHlwZXMuYnlyZWYobmV3X2lkZW50aXR5KQogICAgICAgICAgICApCiAgICAgICAgICAgIF9hc3NlcnRfbm9fZXJyb3Ioc3RhdHVzKQogICAgICAgICAgICBpZGVudGl0aWVzLmFwcGVuZChuZXdfaWRlbnRpdHkpCgogICAgICAgICAgICAjIFdlIG5vdyB3YW50IHRvIHJlbGVhc2UgdGhlIG9yaWdpbmFsIGNlcnRpZmljYXRlLCBhcyB3ZSBubyBsb25nZXIKICAgICAgICAgICAgIyBuZWVkIGl0LgogICAgICAgICAgICBDb3JlRm91bmRhdGlvbi5DRlJlbGVhc2UoY2VydGlmaWNhdGVzLnBvcCgwKSkKCiAgICAgICAgIyBXZSBub3cgbmVlZCB0byBidWlsZCBhIG5ldyBDRkFycmF5IHRoYXQgaG9sZHMgdGhlIHRydXN0IGNoYWluLgogICAgICAgIHRydXN0X2NoYWluID0gQ29yZUZvdW5kYXRpb24uQ0ZBcnJheUNyZWF0ZU11dGFibGUoCiAgICAgICAgICAgIENvcmVGb3VuZGF0aW9uLmtDRkFsbG9jYXRvckRlZmF1bHQsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGN0eXBlcy5ieXJlZihDb3JlRm91bmRhdGlvbi5rQ0ZUeXBlQXJyYXlDYWxsQmFja3MpLAogICAgICAgICkKICAgICAgICBmb3IgaXRlbSBpbiBpdGVydG9vbHMuY2hhaW4oaWRlbnRpdGllcywgY2VydGlmaWNhdGVzKToKICAgICAgICAgICAgIyBBcnJheUFwcGVuZFZhbHVlIGRvZXMgYSBDRlJldGFpbiBvbiB0aGUgaXRlbS4gVGhhdCdzIGZpbmUsCiAgICAgICAgICAgICMgYmVjYXVzZSB0aGUgZmluYWxseSBibG9jayB3aWxsIHJlbGVhc2Ugb3VyIG90aGVyIHJlZnMgdG8gdGhlbS4KICAgICAgICAgICAgQ29yZUZvdW5kYXRpb24uQ0ZBcnJheUFwcGVuZFZhbHVlKHRydXN0X2NoYWluLCBpdGVtKQoKICAgICAgICByZXR1cm4gdHJ1c3RfY2hhaW4KICAgIGZpbmFsbHk6CiAgICAgICAgZm9yIG9iaiBpbiBpdGVydG9vbHMuY2hhaW4oaWRlbnRpdGllcywgY2VydGlmaWNhdGVzKToKICAgICAgICAgICAgQ29yZUZvdW5kYXRpb24uQ0ZSZWxlYXNlKG9iaikK
