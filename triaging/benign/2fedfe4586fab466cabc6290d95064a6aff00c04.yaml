statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/requestsd/2.28.2/requestsd-2.28.2-py3-none-any/requests/utils.py
  contents:
  - name: rewind_body
    score: 0.0
    code: |-
      def rewind_body(prepared_request):
          """Move file pointer back to its recorded starting position
          so it can be read again on redirect.
          """
          body_seek = getattr(prepared_request.body, "seek", None)
          if body_seek is not None and isinstance(
              prepared_request._body_position, integer_types
          ):
              try:
                  body_seek(prepared_request._body_position)
              except OSError:
                  raise UnrewindableBodyError(
                      "An error occurred when rewinding request body for redirect."
                  )
          else:
              raise UnrewindableBodyError("Unable to rewind request body for redirect.")
    tokens: resume load_global REFLECTION_DYNAMIC_READ load_fast STRING_LEN_S_ENT_HIGH load_attr body load_const seek load_const call store_fast body_seek load_fast body_seek pop_jump_if_none TO_NUMBER load_global isinstance load_fast STRING_LEN_S_ENT_HIGH load_attr _body_position load_global integer_types call pop_jump_if_false TO_NUMBER nop push_null load_fast body_seek load_fast STRING_LEN_S_ENT_HIGH load_attr _body_position call pop_top return_const None load_global STRING_LEN_S_ENT_HIGH load_const STRING_LEN_S_ENT_HIGH call raise_varargs push_exc_info load_global OSError check_exc_match pop_jump_if_false TO_NUMBER pop_top load_global STRING_LEN_S_ENT_HIGH load_const STRING_LEN_S_ENT_HIGH call raise_varargs reraise copy pop_except reraise
    hash: 721b4be63b3fc48d78bc4b32e8781bc3dc478b048106ab26a5bd8c32d33d1bb6
sources:
  .repo_cache/malicious_repos/pypi_malregistry/requestsd/2.28.2/requestsd-2.28.2-py3-none-any/requests/utils.py: IiIiCnJlcXVlc3RzLnV0aWxzCn5+fn5+fn5+fn5+fn5+CgpUaGlzIG1vZHVsZSBwcm92aWRlcyB1dGlsaXR5IGZ1bmN0aW9ucyB0aGF0IGFyZSB1c2VkIHdpdGhpbiBSZXF1ZXN0cwp0aGF0IGFyZSBhbHNvIHVzZWZ1bCBmb3IgZXh0ZXJuYWwgY29uc3VtcHRpb24uCiIiIgoKaW1wb3J0IGNvZGVjcwppbXBvcnQgY29udGV4dGxpYgppbXBvcnQgaW8KaW1wb3J0IG9zCmltcG9ydCByZQppbXBvcnQgc29ja2V0CmltcG9ydCBzdHJ1Y3QKaW1wb3J0IHN5cwppbXBvcnQgdGVtcGZpbGUKaW1wb3J0IHdhcm5pbmdzCmltcG9ydCB6aXBmaWxlCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IE9yZGVyZWREaWN0Cgpmcm9tIHVybGxpYjMudXRpbCBpbXBvcnQgbWFrZV9oZWFkZXJzLCBwYXJzZV91cmwKCmZyb20gLiBpbXBvcnQgY2VydHMKZnJvbSAuX192ZXJzaW9uX18gaW1wb3J0IF9fdmVyc2lvbl9fCgojIHRvX25hdGl2ZV9zdHJpbmcgaXMgdW51c2VkIGhlcmUsIGJ1dCBpbXBvcnRlZCBoZXJlIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQpmcm9tIC5faW50ZXJuYWxfdXRpbHMgaW1wb3J0IEhFQURFUl9WQUxJREFUT1JTLCB0b19uYXRpdmVfc3RyaW5nICAjIG5vcWE6IEY0MDEKZnJvbSAuY29tcGF0IGltcG9ydCAoCiAgICBNYXBwaW5nLAogICAgYmFzZXN0cmluZywKICAgIGJ5dGVzLAogICAgZ2V0cHJveGllcywKICAgIGdldHByb3hpZXNfZW52aXJvbm1lbnQsCiAgICBpbnRlZ2VyX3R5cGVzLAopCmZyb20gLmNvbXBhdCBpbXBvcnQgcGFyc2VfaHR0cF9saXN0IGFzIF9wYXJzZV9saXN0X2hlYWRlcgpmcm9tIC5jb21wYXQgaW1wb3J0ICgKICAgIHByb3h5X2J5cGFzcywKICAgIHByb3h5X2J5cGFzc19lbnZpcm9ubWVudCwKICAgIHF1b3RlLAogICAgc3RyLAogICAgdW5xdW90ZSwKICAgIHVybHBhcnNlLAogICAgdXJsdW5wYXJzZSwKKQpmcm9tIC5jb29raWVzIGltcG9ydCBjb29raWVqYXJfZnJvbV9kaWN0CmZyb20gLmV4Y2VwdGlvbnMgaW1wb3J0ICgKICAgIEZpbGVNb2RlV2FybmluZywKICAgIEludmFsaWRIZWFkZXIsCiAgICBJbnZhbGlkVVJMLAogICAgVW5yZXdpbmRhYmxlQm9keUVycm9yLAopCmZyb20gLnN0cnVjdHVyZXMgaW1wb3J0IENhc2VJbnNlbnNpdGl2ZURpY3QKCk5FVFJDX0ZJTEVTID0gKCIubmV0cmMiLCAiX25ldHJjIikKCkRFRkFVTFRfQ0FfQlVORExFX1BBVEggPSBjZXJ0cy53aGVyZSgpCgpERUZBVUxUX1BPUlRTID0geyJodHRwIjogODAsICJodHRwcyI6IDQ0M30KCiMgRW5zdXJlIHRoYXQgJywgJyBpcyB1c2VkIHRvIHByZXNlcnZlIHByZXZpb3VzIGRlbGltaXRlciBiZWhhdmlvci4KREVGQVVMVF9BQ0NFUFRfRU5DT0RJTkcgPSAiLCAiLmpvaW4oCiAgICByZS5zcGxpdChyIixccyoiLCBtYWtlX2hlYWRlcnMoYWNjZXB0X2VuY29kaW5nPVRydWUpWyJhY2NlcHQtZW5jb2RpbmciXSkKKQoKCmlmIHN5cy5wbGF0Zm9ybSA9PSAid2luMzIiOgogICAgIyBwcm92aWRlIGEgcHJveHlfYnlwYXNzIHZlcnNpb24gb24gV2luZG93cyB3aXRob3V0IEROUyBsb29rdXBzCgogICAgZGVmIHByb3h5X2J5cGFzc19yZWdpc3RyeShob3N0KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGltcG9ydCB3aW5yZWcKICAgICAgICBleGNlcHQgSW1wb3J0RXJyb3I6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGludGVybmV0U2V0dGluZ3MgPSB3aW5yZWcuT3BlbktleSgKICAgICAgICAgICAgICAgIHdpbnJlZy5IS0VZX0NVUlJFTlRfVVNFUiwKICAgICAgICAgICAgICAgIHIiU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cSW50ZXJuZXQgU2V0dGluZ3MiLAogICAgICAgICAgICApCiAgICAgICAgICAgICMgUHJveHlFbmFibGUgY291bGQgYmUgUkVHX1NaIG9yIFJFR19EV09SRCwgbm9ybWFsaXppbmcgaXQKICAgICAgICAgICAgcHJveHlFbmFibGUgPSBpbnQod2lucmVnLlF1ZXJ5VmFsdWVFeChpbnRlcm5ldFNldHRpbmdzLCAiUHJveHlFbmFibGUiKVswXSkKICAgICAgICAgICAgIyBQcm94eU92ZXJyaWRlIGlzIGFsbW9zdCBhbHdheXMgYSBzdHJpbmcKICAgICAgICAgICAgcHJveHlPdmVycmlkZSA9IHdpbnJlZy5RdWVyeVZhbHVlRXgoaW50ZXJuZXRTZXR0aW5ncywgIlByb3h5T3ZlcnJpZGUiKVswXQogICAgICAgIGV4Y2VwdCAoT1NFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGlmIG5vdCBwcm94eUVuYWJsZSBvciBub3QgcHJveHlPdmVycmlkZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgICMgbWFrZSBhIGNoZWNrIHZhbHVlIGxpc3QgZnJvbSB0aGUgcmVnaXN0cnkgZW50cnk6IHJlcGxhY2UgdGhlCiAgICAgICAgIyAnPGxvY2FsPicgc3RyaW5nIGJ5IHRoZSBsb2NhbGhvc3QgZW50cnkgYW5kIHRoZSBjb3JyZXNwb25kaW5nCiAgICAgICAgIyBjYW5vbmljYWwgZW50cnkuCiAgICAgICAgcHJveHlPdmVycmlkZSA9IHByb3h5T3ZlcnJpZGUuc3BsaXQoIjsiKQogICAgICAgICMgbm93IGNoZWNrIGlmIHdlIG1hdGNoIG9uZSBvZiB0aGUgcmVnaXN0cnkgdmFsdWVzLgogICAgICAgIGZvciB0ZXN0IGluIHByb3h5T3ZlcnJpZGU6CiAgICAgICAgICAgIGlmIHRlc3QgPT0gIjxsb2NhbD4iOgogICAgICAgICAgICAgICAgaWYgIi4iIG5vdCBpbiBob3N0OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIHRlc3QgPSB0ZXN0LnJlcGxhY2UoIi4iLCByIlwuIikgICMgbWFzayBkb3RzCiAgICAgICAgICAgIHRlc3QgPSB0ZXN0LnJlcGxhY2UoIioiLCByIi4qIikgICMgY2hhbmdlIGdsb2Igc2VxdWVuY2UKICAgICAgICAgICAgdGVzdCA9IHRlc3QucmVwbGFjZSgiPyIsIHIiLiIpICAjIGNoYW5nZSBnbG9iIGNoYXIKICAgICAgICAgICAgaWYgcmUubWF0Y2godGVzdCwgaG9zdCwgcmUuSSk6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBwcm94eV9ieXBhc3MoaG9zdCk6ICAjIG5vcWEKICAgICAgICAiIiJSZXR1cm4gVHJ1ZSwgaWYgdGhlIGhvc3Qgc2hvdWxkIGJlIGJ5cGFzc2VkLgoKICAgICAgICBDaGVja3MgcHJveHkgc2V0dGluZ3MgZ2F0aGVyZWQgZnJvbSB0aGUgZW52aXJvbm1lbnQsIGlmIHNwZWNpZmllZCwKICAgICAgICBvciB0aGUgcmVnaXN0cnkuCiAgICAgICAgIiIiCiAgICAgICAgaWYgZ2V0cHJveGllc19lbnZpcm9ubWVudCgpOgogICAgICAgICAgICByZXR1cm4gcHJveHlfYnlwYXNzX2Vudmlyb25tZW50KGhvc3QpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHByb3h5X2J5cGFzc19yZWdpc3RyeShob3N0KQoKCmRlZiBkaWN0X3RvX3NlcXVlbmNlKGQpOgogICAgIiIiUmV0dXJucyBhbiBpbnRlcm5hbCBzZXF1ZW5jZSBkaWN0aW9uYXJ5IHVwZGF0ZS4iIiIKCiAgICBpZiBoYXNhdHRyKGQsICJpdGVtcyIpOgogICAgICAgIGQgPSBkLml0ZW1zKCkKCiAgICByZXR1cm4gZAoKCmRlZiBzdXBlcl9sZW4obyk6CiAgICB0b3RhbF9sZW5ndGggPSBOb25lCiAgICBjdXJyZW50X3Bvc2l0aW9uID0gMAoKICAgIGlmIGhhc2F0dHIobywgIl9fbGVuX18iKToKICAgICAgICB0b3RhbF9sZW5ndGggPSBsZW4obykKCiAgICBlbGlmIGhhc2F0dHIobywgImxlbiIpOgogICAgICAgIHRvdGFsX2xlbmd0aCA9IG8ubGVuCgogICAgZWxpZiBoYXNhdHRyKG8sICJmaWxlbm8iKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZpbGVubyA9IG8uZmlsZW5vKCkKICAgICAgICBleGNlcHQgKGlvLlVuc3VwcG9ydGVkT3BlcmF0aW9uLCBBdHRyaWJ1dGVFcnJvcik6CiAgICAgICAgICAgICMgQXR0cmlidXRlRXJyb3IgaXMgYSBzdXJwcmlzaW5nIGV4Y2VwdGlvbiwgc2VlaW5nIGFzIGhvdyB3ZSd2ZSBqdXN0IGNoZWNrZWQKICAgICAgICAgICAgIyB0aGF0IGBoYXNhdHRyKG8sICdmaWxlbm8nKWAuICBJdCBoYXBwZW5zIGZvciBvYmplY3RzIG9idGFpbmVkIHZpYQogICAgICAgICAgICAjIGBUYXJmaWxlLmV4dHJhY3RmaWxlKClgLCBwZXIgaXNzdWUgNTIyOS4KICAgICAgICAgICAgcGFzcwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRvdGFsX2xlbmd0aCA9IG9zLmZzdGF0KGZpbGVubykuc3Rfc2l6ZQoKICAgICAgICAgICAgIyBIYXZpbmcgdXNlZCBmc3RhdCB0byBkZXRlcm1pbmUgdGhlIGZpbGUgbGVuZ3RoLCB3ZSBuZWVkIHRvCiAgICAgICAgICAgICMgY29uZmlybSB0aGF0IHRoaXMgZmlsZSB3YXMgb3BlbmVkIHVwIGluIGJpbmFyeSBtb2RlLgogICAgICAgICAgICBpZiAiYiIgbm90IGluIG8ubW9kZToKICAgICAgICAgICAgICAgIHdhcm5pbmdzLndhcm4oCiAgICAgICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgICAgICAiUmVxdWVzdHMgaGFzIGRldGVybWluZWQgdGhlIGNvbnRlbnQtbGVuZ3RoIGZvciB0aGlzICIKICAgICAgICAgICAgICAgICAgICAgICAgInJlcXVlc3QgdXNpbmcgdGhlIGJpbmFyeSBzaXplIG9mIHRoZSBmaWxlOiBob3dldmVyLCB0aGUgIgogICAgICAgICAgICAgICAgICAgICAgICAiZmlsZSBoYXMgYmVlbiBvcGVuZWQgaW4gdGV4dCBtb2RlIChpLmUuIHdpdGhvdXQgdGhlICdiJyAiCiAgICAgICAgICAgICAgICAgICAgICAgICJmbGFnIGluIHRoZSBtb2RlKS4gVGhpcyBtYXkgbGVhZCB0byBhbiBpbmNvcnJlY3QgIgogICAgICAgICAgICAgICAgICAgICAgICAiY29udGVudC1sZW5ndGguIEluIFJlcXVlc3RzIDMuMCwgc3VwcG9ydCB3aWxsIGJlIHJlbW92ZWQgIgogICAgICAgICAgICAgICAgICAgICAgICAiZm9yIGZpbGVzIGluIHRleHQgbW9kZS4iCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBGaWxlTW9kZVdhcm5pbmcsCiAgICAgICAgICAgICAgICApCgogICAgaWYgaGFzYXR0cihvLCAidGVsbCIpOgogICAgICAgIHRyeToKICAgICAgICAgICAgY3VycmVudF9wb3NpdGlvbiA9IG8udGVsbCgpCiAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgICMgVGhpcyBjYW4gaGFwcGVuIGluIHNvbWUgd2VpcmQgc2l0dWF0aW9ucywgc3VjaCBhcyB3aGVuIHRoZSBmaWxlCiAgICAgICAgICAgICMgaXMgYWN0dWFsbHkgYSBzcGVjaWFsIGZpbGUgZGVzY3JpcHRvciBsaWtlIHN0ZGluLiBJbiB0aGlzCiAgICAgICAgICAgICMgaW5zdGFuY2UsIHdlIGRvbid0IGtub3cgd2hhdCB0aGUgbGVuZ3RoIGlzLCBzbyBzZXQgaXQgdG8gemVybyBhbmQKICAgICAgICAgICAgIyBsZXQgcmVxdWVzdHMgY2h1bmsgaXQgaW5zdGVhZC4KICAgICAgICAgICAgaWYgdG90YWxfbGVuZ3RoIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgY3VycmVudF9wb3NpdGlvbiA9IHRvdGFsX2xlbmd0aAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGhhc2F0dHIobywgInNlZWsiKSBhbmQgdG90YWxfbGVuZ3RoIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAjIFN0cmluZ0lPIGFuZCBCeXRlc0lPIGhhdmUgc2VlayBidXQgbm8gdXNhYmxlIGZpbGVubwogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgc2VlayB0byBlbmQgb2YgZmlsZQogICAgICAgICAgICAgICAgICAgIG8uc2VlaygwLCAyKQogICAgICAgICAgICAgICAgICAgIHRvdGFsX2xlbmd0aCA9IG8udGVsbCgpCgogICAgICAgICAgICAgICAgICAgICMgc2VlayBiYWNrIHRvIGN1cnJlbnQgcG9zaXRpb24gdG8gc3VwcG9ydAogICAgICAgICAgICAgICAgICAgICMgcGFydGlhbGx5IHJlYWQgZmlsZS1saWtlIG9iamVjdHMKICAgICAgICAgICAgICAgICAgICBvLnNlZWsoY3VycmVudF9wb3NpdGlvbiBvciAwKQogICAgICAgICAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgdG90YWxfbGVuZ3RoID0gMAoKICAgIGlmIHRvdGFsX2xlbmd0aCBpcyBOb25lOgogICAgICAgIHRvdGFsX2xlbmd0aCA9IDAKCiAgICByZXR1cm4gbWF4KDAsIHRvdGFsX2xlbmd0aCAtIGN1cnJlbnRfcG9zaXRpb24pCgoKZGVmIGdldF9uZXRyY19hdXRoKHVybCwgcmFpc2VfZXJyb3JzPUZhbHNlKToKICAgICIiIlJldHVybnMgdGhlIFJlcXVlc3RzIHR1cGxlIGF1dGggZm9yIGEgZ2l2ZW4gdXJsIGZyb20gbmV0cmMuIiIiCgogICAgbmV0cmNfZmlsZSA9IG9zLmVudmlyb24uZ2V0KCJORVRSQyIpCiAgICBpZiBuZXRyY19maWxlIGlzIG5vdCBOb25lOgogICAgICAgIG5ldHJjX2xvY2F0aW9ucyA9IChuZXRyY19maWxlLCkKICAgIGVsc2U6CiAgICAgICAgbmV0cmNfbG9jYXRpb25zID0gKGYifi97Zn0iIGZvciBmIGluIE5FVFJDX0ZJTEVTKQoKICAgIHRyeToKICAgICAgICBmcm9tIG5ldHJjIGltcG9ydCBOZXRyY1BhcnNlRXJyb3IsIG5ldHJjCgogICAgICAgIG5ldHJjX3BhdGggPSBOb25lCgogICAgICAgIGZvciBmIGluIG5ldHJjX2xvY2F0aW9uczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbG9jID0gb3MucGF0aC5leHBhbmR1c2VyKGYpCiAgICAgICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgICAgICMgb3MucGF0aC5leHBhbmR1c2VyIGNhbiBmYWlsIHdoZW4gJEhPTUUgaXMgdW5kZWZpbmVkIGFuZAogICAgICAgICAgICAgICAgIyBnZXRwd3VpZCBmYWlscy4gU2VlIGh0dHBzOi8vYnVncy5weXRob24ub3JnL2lzc3VlMjAxNjQgJgogICAgICAgICAgICAgICAgIyBodHRwczovL2dpdGh1Yi5jb20vcHNmL3JlcXVlc3RzL2lzc3Vlcy8xODQ2CiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGxvYyk6CiAgICAgICAgICAgICAgICBuZXRyY19wYXRoID0gbG9jCiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAjIEFib3J0IGVhcmx5IGlmIHRoZXJlIGlzbid0IG9uZS4KICAgICAgICBpZiBuZXRyY19wYXRoIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybgoKICAgICAgICByaSA9IHVybHBhcnNlKHVybCkKCiAgICAgICAgIyBTdHJpcCBwb3J0IG51bWJlcnMgZnJvbSBuZXRsb2MuIFRoaXMgd2VpcmQgYGlmLi4uZW5jb2RlYGAgZGFuY2UgaXMKICAgICAgICAjIHVzZWQgZm9yIFB5dGhvbiAzLjIsIHdoaWNoIGRvZXNuJ3Qgc3VwcG9ydCB1bmljb2RlIGxpdGVyYWxzLgogICAgICAgIHNwbGl0c3RyID0gYiI6IgogICAgICAgIGlmIGlzaW5zdGFuY2UodXJsLCBzdHIpOgogICAgICAgICAgICBzcGxpdHN0ciA9IHNwbGl0c3RyLmRlY29kZSgiYXNjaWkiKQogICAgICAgIGhvc3QgPSByaS5uZXRsb2Muc3BsaXQoc3BsaXRzdHIpWzBdCgogICAgICAgIHRyeToKICAgICAgICAgICAgX25ldHJjID0gbmV0cmMobmV0cmNfcGF0aCkuYXV0aGVudGljYXRvcnMoaG9zdCkKICAgICAgICAgICAgaWYgX25ldHJjOgogICAgICAgICAgICAgICAgIyBSZXR1cm4gd2l0aCBsb2dpbiAvIHBhc3N3b3JkCiAgICAgICAgICAgICAgICBsb2dpbl9pID0gMCBpZiBfbmV0cmNbMF0gZWxzZSAxCiAgICAgICAgICAgICAgICByZXR1cm4gKF9uZXRyY1tsb2dpbl9pXSwgX25ldHJjWzJdKQogICAgICAgIGV4Y2VwdCAoTmV0cmNQYXJzZUVycm9yLCBPU0Vycm9yKToKICAgICAgICAgICAgIyBJZiB0aGVyZSB3YXMgYSBwYXJzaW5nIGVycm9yIG9yIGEgcGVybWlzc2lvbnMgaXNzdWUgcmVhZGluZyB0aGUgZmlsZSwKICAgICAgICAgICAgIyB3ZSdsbCBqdXN0IHNraXAgbmV0cmMgYXV0aCB1bmxlc3MgZXhwbGljaXRseSBhc2tlZCB0byByYWlzZSBlcnJvcnMuCiAgICAgICAgICAgIGlmIHJhaXNlX2Vycm9yczoKICAgICAgICAgICAgICAgIHJhaXNlCgogICAgIyBBcHAgRW5naW5lIGhhY2tpbmVzcy4KICAgIGV4Y2VwdCAoSW1wb3J0RXJyb3IsIEF0dHJpYnV0ZUVycm9yKToKICAgICAgICBwYXNzCgoKZGVmIGd1ZXNzX2ZpbGVuYW1lKG9iaik6CiAgICAiIiJUcmllcyB0byBndWVzcyB0aGUgZmlsZW5hbWUgb2YgdGhlIGdpdmVuIG9iamVjdC4iIiIKICAgIG5hbWUgPSBnZXRhdHRyKG9iaiwgIm5hbWUiLCBOb25lKQogICAgaWYgbmFtZSBhbmQgaXNpbnN0YW5jZShuYW1lLCBiYXNlc3RyaW5nKSBhbmQgbmFtZVswXSAhPSAiPCIgYW5kIG5hbWVbLTFdICE9ICI+IjoKICAgICAgICByZXR1cm4gb3MucGF0aC5iYXNlbmFtZShuYW1lKQoKCmRlZiBleHRyYWN0X3ppcHBlZF9wYXRocyhwYXRoKToKICAgICIiIlJlcGxhY2Ugbm9uZXhpc3RlbnQgcGF0aHMgdGhhdCBsb29rIGxpa2UgdGhleSByZWZlciB0byBhIG1lbWJlciBvZiBhIHppcAogICAgYXJjaGl2ZSB3aXRoIHRoZSBsb2NhdGlvbiBvZiBhbiBleHRyYWN0ZWQgY29weSBvZiB0aGUgdGFyZ2V0LCBvciBlbHNlCiAgICBqdXN0IHJldHVybiB0aGUgcHJvdmlkZWQgcGF0aCB1bmNoYW5nZWQuCiAgICAiIiIKICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICMgdGhpcyBpcyBhbHJlYWR5IGEgdmFsaWQgcGF0aCwgbm8gbmVlZCB0byBkbyBhbnl0aGluZyBmdXJ0aGVyCiAgICAgICAgcmV0dXJuIHBhdGgKCiAgICAjIGZpbmQgdGhlIGZpcnN0IHZhbGlkIHBhcnQgb2YgdGhlIHByb3ZpZGVkIHBhdGggYW5kIHRyZWF0IHRoYXQgYXMgYSB6aXAgYXJjaGl2ZQogICAgIyBhc3N1bWUgdGhlIHJlc3Qgb2YgdGhlIHBhdGggaXMgdGhlIG5hbWUgb2YgYSBtZW1iZXIgaW4gdGhlIGFyY2hpdmUKICAgIGFyY2hpdmUsIG1lbWJlciA9IG9zLnBhdGguc3BsaXQocGF0aCkKICAgIHdoaWxlIGFyY2hpdmUgYW5kIG5vdCBvcy5wYXRoLmV4aXN0cyhhcmNoaXZlKToKICAgICAgICBhcmNoaXZlLCBwcmVmaXggPSBvcy5wYXRoLnNwbGl0KGFyY2hpdmUpCiAgICAgICAgaWYgbm90IHByZWZpeDoKICAgICAgICAgICAgIyBJZiB3ZSBkb24ndCBjaGVjayBmb3IgYW4gZW1wdHkgcHJlZml4IGFmdGVyIHRoZSBzcGxpdCAoaW4gb3RoZXIgd29yZHMsIGFyY2hpdmUgcmVtYWlucyB1bmNoYW5nZWQgYWZ0ZXIgdGhlIHNwbGl0KSwKICAgICAgICAgICAgIyB3ZSBfY2FuXyBlbmQgdXAgaW4gYW4gaW5maW5pdGUgbG9vcCBvbiBhIHJhcmUgY29ybmVyIGNhc2UgYWZmZWN0aW5nIGEgc21hbGwgbnVtYmVyIG9mIHVzZXJzCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgbWVtYmVyID0gIi8iLmpvaW4oW3ByZWZpeCwgbWVtYmVyXSkKCiAgICBpZiBub3QgemlwZmlsZS5pc196aXBmaWxlKGFyY2hpdmUpOgogICAgICAgIHJldHVybiBwYXRoCgogICAgemlwX2ZpbGUgPSB6aXBmaWxlLlppcEZpbGUoYXJjaGl2ZSkKICAgIGlmIG1lbWJlciBub3QgaW4gemlwX2ZpbGUubmFtZWxpc3QoKToKICAgICAgICByZXR1cm4gcGF0aAoKICAgICMgd2UgaGF2ZSBhIHZhbGlkIHppcCBhcmNoaXZlIGFuZCBhIHZhbGlkIG1lbWJlciBvZiB0aGF0IGFyY2hpdmUKICAgIHRtcCA9IHRlbXBmaWxlLmdldHRlbXBkaXIoKQogICAgZXh0cmFjdGVkX3BhdGggPSBvcy5wYXRoLmpvaW4odG1wLCBtZW1iZXIuc3BsaXQoIi8iKVstMV0pCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZXh0cmFjdGVkX3BhdGgpOgogICAgICAgICMgdXNlIHJlYWQgKyB3cml0ZSB0byBhdm9pZCB0aGUgY3JlYXRpbmcgbmVzdGVkIGZvbGRlcnMsIHdlIG9ubHkgd2FudCB0aGUgZmlsZSwgYXZvaWRzIG1rZGlyIHJhY2luZyBjb25kaXRpb24KICAgICAgICB3aXRoIGF0b21pY19vcGVuKGV4dHJhY3RlZF9wYXRoKSBhcyBmaWxlX2hhbmRsZXI6CiAgICAgICAgICAgIGZpbGVfaGFuZGxlci53cml0ZSh6aXBfZmlsZS5yZWFkKG1lbWJlcikpCiAgICByZXR1cm4gZXh0cmFjdGVkX3BhdGgKCgpAY29udGV4dGxpYi5jb250ZXh0bWFuYWdlcgpkZWYgYXRvbWljX29wZW4oZmlsZW5hbWUpOgogICAgIiIiV3JpdGUgYSBmaWxlIHRvIHRoZSBkaXNrIGluIGFuIGF0b21pYyBmYXNoaW9uIiIiCiAgICB0bXBfZGVzY3JpcHRvciwgdG1wX25hbWUgPSB0ZW1wZmlsZS5ta3N0ZW1wKGRpcj1vcy5wYXRoLmRpcm5hbWUoZmlsZW5hbWUpKQogICAgdHJ5OgogICAgICAgIHdpdGggb3MuZmRvcGVuKHRtcF9kZXNjcmlwdG9yLCAid2IiKSBhcyB0bXBfaGFuZGxlcjoKICAgICAgICAgICAgeWllbGQgdG1wX2hhbmRsZXIKICAgICAgICBvcy5yZXBsYWNlKHRtcF9uYW1lLCBmaWxlbmFtZSkKICAgIGV4Y2VwdCBCYXNlRXhjZXB0aW9uOgogICAgICAgIG9zLnJlbW92ZSh0bXBfbmFtZSkKICAgICAgICByYWlzZQoKCmRlZiBmcm9tX2tleV92YWxfbGlzdCh2YWx1ZSk6CiAgICAiIiJUYWtlIGFuIG9iamVjdCBhbmQgdGVzdCB0byBzZWUgaWYgaXQgY2FuIGJlIHJlcHJlc2VudGVkIGFzIGEKICAgIGRpY3Rpb25hcnkuIFVubGVzcyBpdCBjYW4gbm90IGJlIHJlcHJlc2VudGVkIGFzIHN1Y2gsIHJldHVybiBhbgogICAgT3JkZXJlZERpY3QsIGUuZy4sCgogICAgOjoKCiAgICAgICAgPj4+IGZyb21fa2V5X3ZhbF9saXN0KFsoJ2tleScsICd2YWwnKV0pCiAgICAgICAgT3JkZXJlZERpY3QoWygna2V5JywgJ3ZhbCcpXSkKICAgICAgICA+Pj4gZnJvbV9rZXlfdmFsX2xpc3QoJ3N0cmluZycpCiAgICAgICAgVHJhY2ViYWNrIChtb3N0IHJlY2VudCBjYWxsIGxhc3QpOgogICAgICAgIC4uLgogICAgICAgIFZhbHVlRXJyb3I6IGNhbm5vdCBlbmNvZGUgb2JqZWN0cyB0aGF0IGFyZSBub3QgMi10dXBsZXMKICAgICAgICA+Pj4gZnJvbV9rZXlfdmFsX2xpc3QoeydrZXknOiAndmFsJ30pCiAgICAgICAgT3JkZXJlZERpY3QoWygna2V5JywgJ3ZhbCcpXSkKCiAgICA6cnR5cGU6IE9yZGVyZWREaWN0CiAgICAiIiIKICAgIGlmIHZhbHVlIGlzIE5vbmU6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCAoc3RyLCBieXRlcywgYm9vbCwgaW50KSk6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiY2Fubm90IGVuY29kZSBvYmplY3RzIHRoYXQgYXJlIG5vdCAyLXR1cGxlcyIpCgogICAgcmV0dXJuIE9yZGVyZWREaWN0KHZhbHVlKQoKCmRlZiB0b19rZXlfdmFsX2xpc3QodmFsdWUpOgogICAgIiIiVGFrZSBhbiBvYmplY3QgYW5kIHRlc3QgdG8gc2VlIGlmIGl0IGNhbiBiZSByZXByZXNlbnRlZCBhcyBhCiAgICBkaWN0aW9uYXJ5LiBJZiBpdCBjYW4gYmUsIHJldHVybiBhIGxpc3Qgb2YgdHVwbGVzLCBlLmcuLAoKICAgIDo6CgogICAgICAgID4+PiB0b19rZXlfdmFsX2xpc3QoWygna2V5JywgJ3ZhbCcpXSkKICAgICAgICBbKCdrZXknLCAndmFsJyldCiAgICAgICAgPj4+IHRvX2tleV92YWxfbGlzdCh7J2tleSc6ICd2YWwnfSkKICAgICAgICBbKCdrZXknLCAndmFsJyldCiAgICAgICAgPj4+IHRvX2tleV92YWxfbGlzdCgnc3RyaW5nJykKICAgICAgICBUcmFjZWJhY2sgKG1vc3QgcmVjZW50IGNhbGwgbGFzdCk6CiAgICAgICAgLi4uCiAgICAgICAgVmFsdWVFcnJvcjogY2Fubm90IGVuY29kZSBvYmplY3RzIHRoYXQgYXJlIG5vdCAyLXR1cGxlcwoKICAgIDpydHlwZTogbGlzdAogICAgIiIiCiAgICBpZiB2YWx1ZSBpcyBOb25lOgogICAgICAgIHJldHVybiBOb25lCgogICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgKHN0ciwgYnl0ZXMsIGJvb2wsIGludCkpOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoImNhbm5vdCBlbmNvZGUgb2JqZWN0cyB0aGF0IGFyZSBub3QgMi10dXBsZXMiKQoKICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIE1hcHBpbmcpOgogICAgICAgIHZhbHVlID0gdmFsdWUuaXRlbXMoKQoKICAgIHJldHVybiBsaXN0KHZhbHVlKQoKCiMgRnJvbSBtaXRzdWhpa28vd2Vya3pldWcgKHVzZWQgd2l0aCBwZXJtaXNzaW9uKS4KZGVmIHBhcnNlX2xpc3RfaGVhZGVyKHZhbHVlKToKICAgICIiIlBhcnNlIGxpc3RzIGFzIGRlc2NyaWJlZCBieSBSRkMgMjA2OCBTZWN0aW9uIDIuCgogICAgSW4gcGFydGljdWxhciwgcGFyc2UgY29tbWEtc2VwYXJhdGVkIGxpc3RzIHdoZXJlIHRoZSBlbGVtZW50cyBvZgogICAgdGhlIGxpc3QgbWF5IGluY2x1ZGUgcXVvdGVkLXN0cmluZ3MuICBBIHF1b3RlZC1zdHJpbmcgY291bGQKICAgIGNvbnRhaW4gYSBjb21tYS4gIEEgbm9uLXF1b3RlZCBzdHJpbmcgY291bGQgaGF2ZSBxdW90ZXMgaW4gdGhlCiAgICBtaWRkbGUuICBRdW90ZXMgYXJlIHJlbW92ZWQgYXV0b21hdGljYWxseSBhZnRlciBwYXJzaW5nLgoKICAgIEl0IGJhc2ljYWxseSB3b3JrcyBsaWtlIDpmdW5jOmBwYXJzZV9zZXRfaGVhZGVyYCBqdXN0IHRoYXQgaXRlbXMKICAgIG1heSBhcHBlYXIgbXVsdGlwbGUgdGltZXMgYW5kIGNhc2Ugc2Vuc2l0aXZpdHkgaXMgcHJlc2VydmVkLgoKICAgIFRoZSByZXR1cm4gdmFsdWUgaXMgYSBzdGFuZGFyZCA6Y2xhc3M6YGxpc3RgOgoKICAgID4+PiBwYXJzZV9saXN0X2hlYWRlcigndG9rZW4sICJxdW90ZWQgdmFsdWUiJykKICAgIFsndG9rZW4nLCAncXVvdGVkIHZhbHVlJ10KCiAgICBUbyBjcmVhdGUgYSBoZWFkZXIgZnJvbSB0aGUgOmNsYXNzOmBsaXN0YCBhZ2FpbiwgdXNlIHRoZQogICAgOmZ1bmM6YGR1bXBfaGVhZGVyYCBmdW5jdGlvbi4KCiAgICA6cGFyYW0gdmFsdWU6IGEgc3RyaW5nIHdpdGggYSBsaXN0IGhlYWRlci4KICAgIDpyZXR1cm46IDpjbGFzczpgbGlzdGAKICAgIDpydHlwZTogbGlzdAogICAgIiIiCiAgICByZXN1bHQgPSBbXQogICAgZm9yIGl0ZW0gaW4gX3BhcnNlX2xpc3RfaGVhZGVyKHZhbHVlKToKICAgICAgICBpZiBpdGVtWzoxXSA9PSBpdGVtWy0xOl0gPT0gJyInOgogICAgICAgICAgICBpdGVtID0gdW5xdW90ZV9oZWFkZXJfdmFsdWUoaXRlbVsxOi0xXSkKICAgICAgICByZXN1bHQuYXBwZW5kKGl0ZW0pCiAgICByZXR1cm4gcmVzdWx0CgoKIyBGcm9tIG1pdHN1aGlrby93ZXJremV1ZyAodXNlZCB3aXRoIHBlcm1pc3Npb24pLgpkZWYgcGFyc2VfZGljdF9oZWFkZXIodmFsdWUpOgogICAgIiIiUGFyc2UgbGlzdHMgb2Yga2V5LCB2YWx1ZSBwYWlycyBhcyBkZXNjcmliZWQgYnkgUkZDIDIwNjggU2VjdGlvbiAyIGFuZAogICAgY29udmVydCB0aGVtIGludG8gYSBweXRob24gZGljdDoKCiAgICA+Pj4gZCA9IHBhcnNlX2RpY3RfaGVhZGVyKCdmb289ImlzIGEgZmlzaCIsIGJhcj0iYXMgd2VsbCInKQogICAgPj4+IHR5cGUoZCkgaXMgZGljdAogICAgVHJ1ZQogICAgPj4+IHNvcnRlZChkLml0ZW1zKCkpCiAgICBbKCdiYXInLCAnYXMgd2VsbCcpLCAoJ2ZvbycsICdpcyBhIGZpc2gnKV0KCiAgICBJZiB0aGVyZSBpcyBubyB2YWx1ZSBmb3IgYSBrZXkgaXQgd2lsbCBiZSBgTm9uZWA6CgogICAgPj4+IHBhcnNlX2RpY3RfaGVhZGVyKCdrZXlfd2l0aG91dF92YWx1ZScpCiAgICB7J2tleV93aXRob3V0X3ZhbHVlJzogTm9uZX0KCiAgICBUbyBjcmVhdGUgYSBoZWFkZXIgZnJvbSB0aGUgOmNsYXNzOmBkaWN0YCBhZ2FpbiwgdXNlIHRoZQogICAgOmZ1bmM6YGR1bXBfaGVhZGVyYCBmdW5jdGlvbi4KCiAgICA6cGFyYW0gdmFsdWU6IGEgc3RyaW5nIHdpdGggYSBkaWN0IGhlYWRlci4KICAgIDpyZXR1cm46IDpjbGFzczpgZGljdGAKICAgIDpydHlwZTogZGljdAogICAgIiIiCiAgICByZXN1bHQgPSB7fQogICAgZm9yIGl0ZW0gaW4gX3BhcnNlX2xpc3RfaGVhZGVyKHZhbHVlKToKICAgICAgICBpZiAiPSIgbm90IGluIGl0ZW06CiAgICAgICAgICAgIHJlc3VsdFtpdGVtXSA9IE5vbmUKICAgICAgICAgICAgY29udGludWUKICAgICAgICBuYW1lLCB2YWx1ZSA9IGl0ZW0uc3BsaXQoIj0iLCAxKQogICAgICAgIGlmIHZhbHVlWzoxXSA9PSB2YWx1ZVstMTpdID09ICciJzoKICAgICAgICAgICAgdmFsdWUgPSB1bnF1b3RlX2hlYWRlcl92YWx1ZSh2YWx1ZVsxOi0xXSkKICAgICAgICByZXN1bHRbbmFtZV0gPSB2YWx1ZQogICAgcmV0dXJuIHJlc3VsdAoKCiMgRnJvbSBtaXRzdWhpa28vd2Vya3pldWcgKHVzZWQgd2l0aCBwZXJtaXNzaW9uKS4KZGVmIHVucXVvdGVfaGVhZGVyX3ZhbHVlKHZhbHVlLCBpc19maWxlbmFtZT1GYWxzZSk6CiAgICByIiIiVW5xdW90ZXMgYSBoZWFkZXIgdmFsdWUuICAoUmV2ZXJzYWwgb2YgOmZ1bmM6YHF1b3RlX2hlYWRlcl92YWx1ZWApLgogICAgVGhpcyBkb2VzIG5vdCB1c2UgdGhlIHJlYWwgdW5xdW90aW5nIGJ1dCB3aGF0IGJyb3dzZXJzIGFyZSBhY3R1YWxseQogICAgdXNpbmcgZm9yIHF1b3RpbmcuCgogICAgOnBhcmFtIHZhbHVlOiB0aGUgaGVhZGVyIHZhbHVlIHRvIHVucXVvdGUuCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCiAgICBpZiB2YWx1ZSBhbmQgdmFsdWVbMF0gPT0gdmFsdWVbLTFdID09ICciJzoKICAgICAgICAjIHRoaXMgaXMgbm90IHRoZSByZWFsIHVucXVvdGluZywgYnV0IGZpeGluZyB0aGlzIHNvIHRoYXQgdGhlCiAgICAgICAgIyBSRkMgaXMgbWV0IHdpbGwgcmVzdWx0IGluIGJ1Z3Mgd2l0aCBpbnRlcm5ldCBleHBsb3JlciBhbmQKICAgICAgICAjIHByb2JhYmx5IHNvbWUgb3RoZXIgYnJvd3NlcnMgYXMgd2VsbC4gIElFIGZvciBleGFtcGxlIGlzCiAgICAgICAgIyB1cGxvYWRpbmcgZmlsZXMgd2l0aCAiQzpcZm9vXGJhci50eHQiIGFzIGZpbGVuYW1lCiAgICAgICAgdmFsdWUgPSB2YWx1ZVsxOi0xXQoKICAgICAgICAjIGlmIHRoaXMgaXMgYSBmaWxlbmFtZSBhbmQgdGhlIHN0YXJ0aW5nIGNoYXJhY3RlcnMgbG9vayBsaWtlCiAgICAgICAgIyBhIFVOQyBwYXRoLCB0aGVuIGp1c3QgcmV0dXJuIHRoZSB2YWx1ZSB3aXRob3V0IHF1b3Rlcy4gIFVzaW5nIHRoZQogICAgICAgICMgcmVwbGFjZSBzZXF1ZW5jZSBiZWxvdyBvbiBhIFVOQyBwYXRoIGhhcyB0aGUgZWZmZWN0IG9mIHR1cm5pbmcKICAgICAgICAjIHRoZSBsZWFkaW5nIGRvdWJsZSBzbGFzaCBpbnRvIGEgc2luZ2xlIHNsYXNoIGFuZCB0aGVuCiAgICAgICAgIyBfZml4X2llX2ZpbGVuYW1lKCkgZG9lc24ndCB3b3JrIGNvcnJlY3RseS4gIFNlZSAjNDU4LgogICAgICAgIGlmIG5vdCBpc19maWxlbmFtZSBvciB2YWx1ZVs6Ml0gIT0gIlxcXFwiOgogICAgICAgICAgICByZXR1cm4gdmFsdWUucmVwbGFjZSgiXFxcXCIsICJcXCIpLnJlcGxhY2UoJ1xcIicsICciJykKICAgIHJldHVybiB2YWx1ZQoKCmRlZiBkaWN0X2Zyb21fY29va2llamFyKGNqKToKICAgICIiIlJldHVybnMgYSBrZXkvdmFsdWUgZGljdGlvbmFyeSBmcm9tIGEgQ29va2llSmFyLgoKICAgIDpwYXJhbSBjajogQ29va2llSmFyIG9iamVjdCB0byBleHRyYWN0IGNvb2tpZXMgZnJvbS4KICAgIDpydHlwZTogZGljdAogICAgIiIiCgogICAgY29va2llX2RpY3QgPSB7fQoKICAgIGZvciBjb29raWUgaW4gY2o6CiAgICAgICAgY29va2llX2RpY3RbY29va2llLm5hbWVdID0gY29va2llLnZhbHVlCgogICAgcmV0dXJuIGNvb2tpZV9kaWN0CgoKZGVmIGFkZF9kaWN0X3RvX2Nvb2tpZWphcihjaiwgY29va2llX2RpY3QpOgogICAgIiIiUmV0dXJucyBhIENvb2tpZUphciBmcm9tIGEga2V5L3ZhbHVlIGRpY3Rpb25hcnkuCgogICAgOnBhcmFtIGNqOiBDb29raWVKYXIgdG8gaW5zZXJ0IGNvb2tpZXMgaW50by4KICAgIDpwYXJhbSBjb29raWVfZGljdDogRGljdCBvZiBrZXkvdmFsdWVzIHRvIGluc2VydCBpbnRvIENvb2tpZUphci4KICAgIDpydHlwZTogQ29va2llSmFyCiAgICAiIiIKCiAgICByZXR1cm4gY29va2llamFyX2Zyb21fZGljdChjb29raWVfZGljdCwgY2opCgoKZGVmIGdldF9lbmNvZGluZ3NfZnJvbV9jb250ZW50KGNvbnRlbnQpOgogICAgIiIiUmV0dXJucyBlbmNvZGluZ3MgZnJvbSBnaXZlbiBjb250ZW50IHN0cmluZy4KCiAgICA6cGFyYW0gY29udGVudDogYnl0ZXN0cmluZyB0byBleHRyYWN0IGVuY29kaW5ncyBmcm9tLgogICAgIiIiCiAgICB3YXJuaW5ncy53YXJuKAogICAgICAgICgKICAgICAgICAgICAgIkluIHJlcXVlc3RzIDMuMCwgZ2V0X2VuY29kaW5nc19mcm9tX2NvbnRlbnQgd2lsbCBiZSByZW1vdmVkLiBGb3IgIgogICAgICAgICAgICAibW9yZSBpbmZvcm1hdGlvbiwgcGxlYXNlIHNlZSB0aGUgZGlzY3Vzc2lvbiBvbiBpc3N1ZSAjMjI2Ni4gKFRoaXMiCiAgICAgICAgICAgICIgd2FybmluZyBzaG91bGQgb25seSBhcHBlYXIgb25jZS4pIgogICAgICAgICksCiAgICAgICAgRGVwcmVjYXRpb25XYXJuaW5nLAogICAgKQoKICAgIGNoYXJzZXRfcmUgPSByZS5jb21waWxlKHInPG1ldGEuKj9jaGFyc2V0PVsiXCddKiguKz8pWyJcJz5dJywgZmxhZ3M9cmUuSSkKICAgIHByYWdtYV9yZSA9IHJlLmNvbXBpbGUocic8bWV0YS4qP2NvbnRlbnQ9WyJcJ10qOz9jaGFyc2V0PSguKz8pWyJcJz5dJywgZmxhZ3M9cmUuSSkKICAgIHhtbF9yZSA9IHJlLmNvbXBpbGUocidePFw/eG1sLio/ZW5jb2Rpbmc9WyJcJ10qKC4rPylbIlwnPl0nKQoKICAgIHJldHVybiAoCiAgICAgICAgY2hhcnNldF9yZS5maW5kYWxsKGNvbnRlbnQpCiAgICAgICAgKyBwcmFnbWFfcmUuZmluZGFsbChjb250ZW50KQogICAgICAgICsgeG1sX3JlLmZpbmRhbGwoY29udGVudCkKICAgICkKCgpkZWYgX3BhcnNlX2NvbnRlbnRfdHlwZV9oZWFkZXIoaGVhZGVyKToKICAgICIiIlJldHVybnMgY29udGVudCB0eXBlIGFuZCBwYXJhbWV0ZXJzIGZyb20gZ2l2ZW4gaGVhZGVyCgogICAgOnBhcmFtIGhlYWRlcjogc3RyaW5nCiAgICA6cmV0dXJuOiB0dXBsZSBjb250YWluaW5nIGNvbnRlbnQgdHlwZSBhbmQgZGljdGlvbmFyeSBvZgogICAgICAgICBwYXJhbWV0ZXJzCiAgICAiIiIKCiAgICB0b2tlbnMgPSBoZWFkZXIuc3BsaXQoIjsiKQogICAgY29udGVudF90eXBlLCBwYXJhbXMgPSB0b2tlbnNbMF0uc3RyaXAoKSwgdG9rZW5zWzE6XQogICAgcGFyYW1zX2RpY3QgPSB7fQogICAgaXRlbXNfdG9fc3RyaXAgPSAiXCInICIKCiAgICBmb3IgcGFyYW0gaW4gcGFyYW1zOgogICAgICAgIHBhcmFtID0gcGFyYW0uc3RyaXAoKQogICAgICAgIGlmIHBhcmFtOgogICAgICAgICAgICBrZXksIHZhbHVlID0gcGFyYW0sIFRydWUKICAgICAgICAgICAgaW5kZXhfb2ZfZXF1YWxzID0gcGFyYW0uZmluZCgiPSIpCiAgICAgICAgICAgIGlmIGluZGV4X29mX2VxdWFscyAhPSAtMToKICAgICAgICAgICAgICAgIGtleSA9IHBhcmFtWzppbmRleF9vZl9lcXVhbHNdLnN0cmlwKGl0ZW1zX3RvX3N0cmlwKQogICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJhbVtpbmRleF9vZl9lcXVhbHMgKyAxIDpdLnN0cmlwKGl0ZW1zX3RvX3N0cmlwKQogICAgICAgICAgICBwYXJhbXNfZGljdFtrZXkubG93ZXIoKV0gPSB2YWx1ZQogICAgcmV0dXJuIGNvbnRlbnRfdHlwZSwgcGFyYW1zX2RpY3QKCgpkZWYgZ2V0X2VuY29kaW5nX2Zyb21faGVhZGVycyhoZWFkZXJzKToKICAgICIiIlJldHVybnMgZW5jb2RpbmdzIGZyb20gZ2l2ZW4gSFRUUCBIZWFkZXIgRGljdC4KCiAgICA6cGFyYW0gaGVhZGVyczogZGljdGlvbmFyeSB0byBleHRyYWN0IGVuY29kaW5nIGZyb20uCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCgogICAgY29udGVudF90eXBlID0gaGVhZGVycy5nZXQoImNvbnRlbnQtdHlwZSIpCgogICAgaWYgbm90IGNvbnRlbnRfdHlwZToKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGNvbnRlbnRfdHlwZSwgcGFyYW1zID0gX3BhcnNlX2NvbnRlbnRfdHlwZV9oZWFkZXIoY29udGVudF90eXBlKQoKICAgIGlmICJjaGFyc2V0IiBpbiBwYXJhbXM6CiAgICAgICAgcmV0dXJuIHBhcmFtc1siY2hhcnNldCJdLnN0cmlwKCInXCIiKQoKICAgIGlmICJ0ZXh0IiBpbiBjb250ZW50X3R5cGU6CiAgICAgICAgcmV0dXJuICJJU08tODg1OS0xIgoKICAgIGlmICJhcHBsaWNhdGlvbi9qc29uIiBpbiBjb250ZW50X3R5cGU6CiAgICAgICAgIyBBc3N1bWUgVVRGLTggYmFzZWQgb24gUkZDIDQ2Mjc6IGh0dHBzOi8vd3d3LmlldGYub3JnL3JmYy9yZmM0NjI3LnR4dCBzaW5jZSB0aGUgY2hhcnNldCB3YXMgdW5zZXQKICAgICAgICByZXR1cm4gInV0Zi04IgoKCmRlZiBzdHJlYW1fZGVjb2RlX3Jlc3BvbnNlX3VuaWNvZGUoaXRlcmF0b3IsIHIpOgogICAgIiIiU3RyZWFtIGRlY29kZXMgYW4gaXRlcmF0b3IuIiIiCgogICAgaWYgci5lbmNvZGluZyBpcyBOb25lOgogICAgICAgIHlpZWxkIGZyb20gaXRlcmF0b3IKICAgICAgICByZXR1cm4KCiAgICBkZWNvZGVyID0gY29kZWNzLmdldGluY3JlbWVudGFsZGVjb2RlcihyLmVuY29kaW5nKShlcnJvcnM9InJlcGxhY2UiKQogICAgZm9yIGNodW5rIGluIGl0ZXJhdG9yOgogICAgICAgIHJ2ID0gZGVjb2Rlci5kZWNvZGUoY2h1bmspCiAgICAgICAgaWYgcnY6CiAgICAgICAgICAgIHlpZWxkIHJ2CiAgICBydiA9IGRlY29kZXIuZGVjb2RlKGIiIiwgZmluYWw9VHJ1ZSkKICAgIGlmIHJ2OgogICAgICAgIHlpZWxkIHJ2CgoKZGVmIGl0ZXJfc2xpY2VzKHN0cmluZywgc2xpY2VfbGVuZ3RoKToKICAgICIiIkl0ZXJhdGUgb3ZlciBzbGljZXMgb2YgYSBzdHJpbmcuIiIiCiAgICBwb3MgPSAwCiAgICBpZiBzbGljZV9sZW5ndGggaXMgTm9uZSBvciBzbGljZV9sZW5ndGggPD0gMDoKICAgICAgICBzbGljZV9sZW5ndGggPSBsZW4oc3RyaW5nKQogICAgd2hpbGUgcG9zIDwgbGVuKHN0cmluZyk6CiAgICAgICAgeWllbGQgc3RyaW5nW3BvcyA6IHBvcyArIHNsaWNlX2xlbmd0aF0KICAgICAgICBwb3MgKz0gc2xpY2VfbGVuZ3RoCgoKZGVmIGdldF91bmljb2RlX2Zyb21fcmVzcG9uc2Uocik6CiAgICAiIiJSZXR1cm5zIHRoZSByZXF1ZXN0ZWQgY29udGVudCBiYWNrIGluIHVuaWNvZGUuCgogICAgOnBhcmFtIHI6IFJlc3BvbnNlIG9iamVjdCB0byBnZXQgdW5pY29kZSBjb250ZW50IGZyb20uCgogICAgVHJpZWQ6CgogICAgMS4gY2hhcnNldCBmcm9tIGNvbnRlbnQtdHlwZQogICAgMi4gZmFsbCBiYWNrIGFuZCByZXBsYWNlIGFsbCB1bmljb2RlIGNoYXJhY3RlcnMKCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCiAgICB3YXJuaW5ncy53YXJuKAogICAgICAgICgKICAgICAgICAgICAgIkluIHJlcXVlc3RzIDMuMCwgZ2V0X3VuaWNvZGVfZnJvbV9yZXNwb25zZSB3aWxsIGJlIHJlbW92ZWQuIEZvciAiCiAgICAgICAgICAgICJtb3JlIGluZm9ybWF0aW9uLCBwbGVhc2Ugc2VlIHRoZSBkaXNjdXNzaW9uIG9uIGlzc3VlICMyMjY2LiAoVGhpcyIKICAgICAgICAgICAgIiB3YXJuaW5nIHNob3VsZCBvbmx5IGFwcGVhciBvbmNlLikiCiAgICAgICAgKSwKICAgICAgICBEZXByZWNhdGlvbldhcm5pbmcsCiAgICApCgogICAgdHJpZWRfZW5jb2RpbmdzID0gW10KCiAgICAjIFRyeSBjaGFyc2V0IGZyb20gY29udGVudC10eXBlCiAgICBlbmNvZGluZyA9IGdldF9lbmNvZGluZ19mcm9tX2hlYWRlcnMoci5oZWFkZXJzKQoKICAgIGlmIGVuY29kaW5nOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIHN0cihyLmNvbnRlbnQsIGVuY29kaW5nKQogICAgICAgIGV4Y2VwdCBVbmljb2RlRXJyb3I6CiAgICAgICAgICAgIHRyaWVkX2VuY29kaW5ncy5hcHBlbmQoZW5jb2RpbmcpCgogICAgIyBGYWxsIGJhY2s6CiAgICB0cnk6CiAgICAgICAgcmV0dXJuIHN0cihyLmNvbnRlbnQsIGVuY29kaW5nLCBlcnJvcnM9InJlcGxhY2UiKQogICAgZXhjZXB0IFR5cGVFcnJvcjoKICAgICAgICByZXR1cm4gci5jb250ZW50CgoKIyBUaGUgdW5yZXNlcnZlZCBVUkkgY2hhcmFjdGVycyAoUkZDIDM5ODYpClVOUkVTRVJWRURfU0VUID0gZnJvemVuc2V0KAogICAgIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiICsgIjAxMjM0NTY3ODktLl9+IgopCgoKZGVmIHVucXVvdGVfdW5yZXNlcnZlZCh1cmkpOgogICAgIiIiVW4tZXNjYXBlIGFueSBwZXJjZW50LWVzY2FwZSBzZXF1ZW5jZXMgaW4gYSBVUkkgdGhhdCBhcmUgdW5yZXNlcnZlZAogICAgY2hhcmFjdGVycy4gVGhpcyBsZWF2ZXMgYWxsIHJlc2VydmVkLCBpbGxlZ2FsIGFuZCBub24tQVNDSUkgYnl0ZXMgZW5jb2RlZC4KCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCiAgICBwYXJ0cyA9IHVyaS5zcGxpdCgiJSIpCiAgICBmb3IgaSBpbiByYW5nZSgxLCBsZW4ocGFydHMpKToKICAgICAgICBoID0gcGFydHNbaV1bMDoyXQogICAgICAgIGlmIGxlbihoKSA9PSAyIGFuZCBoLmlzYWxudW0oKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYyA9IGNocihpbnQoaCwgMTYpKQogICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgIHJhaXNlIEludmFsaWRVUkwoZiJJbnZhbGlkIHBlcmNlbnQtZXNjYXBlIHNlcXVlbmNlOiAne2h9JyIpCgogICAgICAgICAgICBpZiBjIGluIFVOUkVTRVJWRURfU0VUOgogICAgICAgICAgICAgICAgcGFydHNbaV0gPSBjICsgcGFydHNbaV1bMjpdCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwYXJ0c1tpXSA9IGYiJXtwYXJ0c1tpXX0iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcGFydHNbaV0gPSBmIiV7cGFydHNbaV19IgogICAgcmV0dXJuICIiLmpvaW4ocGFydHMpCgoKZGVmIHJlcXVvdGVfdXJpKHVyaSk6CiAgICAiIiJSZS1xdW90ZSB0aGUgZ2l2ZW4gVVJJLgoKICAgIFRoaXMgZnVuY3Rpb24gcGFzc2VzIHRoZSBnaXZlbiBVUkkgdGhyb3VnaCBhbiB1bnF1b3RlL3F1b3RlIGN5Y2xlIHRvCiAgICBlbnN1cmUgdGhhdCBpdCBpcyBmdWxseSBhbmQgY29uc2lzdGVudGx5IHF1b3RlZC4KCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCiAgICBzYWZlX3dpdGhfcGVyY2VudCA9ICIhIyQlJicoKSorLC86Oz0/QFtdfiIKICAgIHNhZmVfd2l0aG91dF9wZXJjZW50ID0gIiEjJCYnKCkqKywvOjs9P0BbXX4iCiAgICB0cnk6CiAgICAgICAgIyBVbnF1b3RlIG9ubHkgdGhlIHVucmVzZXJ2ZWQgY2hhcmFjdGVycwogICAgICAgICMgVGhlbiBxdW90ZSBvbmx5IGlsbGVnYWwgY2hhcmFjdGVycyAoZG8gbm90IHF1b3RlIHJlc2VydmVkLAogICAgICAgICMgdW5yZXNlcnZlZCwgb3IgJyUnKQogICAgICAgIHJldHVybiBxdW90ZSh1bnF1b3RlX3VucmVzZXJ2ZWQodXJpKSwgc2FmZT1zYWZlX3dpdGhfcGVyY2VudCkKICAgIGV4Y2VwdCBJbnZhbGlkVVJMOgogICAgICAgICMgV2UgY291bGRuJ3QgdW5xdW90ZSB0aGUgZ2l2ZW4gVVJJLCBzbyBsZXQncyB0cnkgcXVvdGluZyBpdCwgYnV0CiAgICAgICAgIyB0aGVyZSBtYXkgYmUgdW5xdW90ZWQgJyUncyBpbiB0aGUgVVJJLiBXZSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGV5J3JlCiAgICAgICAgIyBwcm9wZXJseSBxdW90ZWQgc28gdGhleSBkbyBub3QgY2F1c2UgaXNzdWVzIGVsc2V3aGVyZS4KICAgICAgICByZXR1cm4gcXVvdGUodXJpLCBzYWZlPXNhZmVfd2l0aG91dF9wZXJjZW50KQoKCmRlZiBhZGRyZXNzX2luX25ldHdvcmsoaXAsIG5ldCk6CiAgICAiIiJUaGlzIGZ1bmN0aW9uIGFsbG93cyB5b3UgdG8gY2hlY2sgaWYgYW4gSVAgYmVsb25ncyB0byBhIG5ldHdvcmsgc3VibmV0CgogICAgRXhhbXBsZTogcmV0dXJucyBUcnVlIGlmIGlwID0gMTkyLjE2OC4xLjEgYW5kIG5ldCA9IDE5Mi4xNjguMS4wLzI0CiAgICAgICAgICAgICByZXR1cm5zIEZhbHNlIGlmIGlwID0gMTkyLjE2OC4xLjEgYW5kIG5ldCA9IDE5Mi4xNjguMTAwLjAvMjQKCiAgICA6cnR5cGU6IGJvb2wKICAgICIiIgogICAgaXBhZGRyID0gc3RydWN0LnVucGFjaygiPUwiLCBzb2NrZXQuaW5ldF9hdG9uKGlwKSlbMF0KICAgIG5ldGFkZHIsIGJpdHMgPSBuZXQuc3BsaXQoIi8iKQogICAgbmV0bWFzayA9IHN0cnVjdC51bnBhY2soIj1MIiwgc29ja2V0LmluZXRfYXRvbihkb3R0ZWRfbmV0bWFzayhpbnQoYml0cykpKSlbMF0KICAgIG5ldHdvcmsgPSBzdHJ1Y3QudW5wYWNrKCI9TCIsIHNvY2tldC5pbmV0X2F0b24obmV0YWRkcikpWzBdICYgbmV0bWFzawogICAgcmV0dXJuIChpcGFkZHIgJiBuZXRtYXNrKSA9PSAobmV0d29yayAmIG5ldG1hc2spCgoKZGVmIGRvdHRlZF9uZXRtYXNrKG1hc2spOgogICAgIiIiQ29udmVydHMgbWFzayBmcm9tIC94eCBmb3JtYXQgdG8geHh4Lnh4eC54eHgueHh4CgogICAgRXhhbXBsZTogaWYgbWFzayBpcyAyNCBmdW5jdGlvbiByZXR1cm5zIDI1NS4yNTUuMjU1LjAKCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCiAgICBiaXRzID0gMHhGRkZGRkZGRiBeICgxIDw8IDMyIC0gbWFzaykgLSAxCiAgICByZXR1cm4gc29ja2V0LmluZXRfbnRvYShzdHJ1Y3QucGFjaygiPkkiLCBiaXRzKSkKCgpkZWYgaXNfaXB2NF9hZGRyZXNzKHN0cmluZ19pcCk6CiAgICAiIiIKICAgIDpydHlwZTogYm9vbAogICAgIiIiCiAgICB0cnk6CiAgICAgICAgc29ja2V0LmluZXRfYXRvbihzdHJpbmdfaXApCiAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHJldHVybiBUcnVlCgoKZGVmIGlzX3ZhbGlkX2NpZHIoc3RyaW5nX25ldHdvcmspOgogICAgIiIiCiAgICBWZXJ5IHNpbXBsZSBjaGVjayBvZiB0aGUgY2lkciBmb3JtYXQgaW4gbm9fcHJveHkgdmFyaWFibGUuCgogICAgOnJ0eXBlOiBib29sCiAgICAiIiIKICAgIGlmIHN0cmluZ19uZXR3b3JrLmNvdW50KCIvIikgPT0gMToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG1hc2sgPSBpbnQoc3RyaW5nX25ldHdvcmsuc3BsaXQoIi8iKVsxXSkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIGlmIG1hc2sgPCAxIG9yIG1hc2sgPiAzMjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIHRyeToKICAgICAgICAgICAgc29ja2V0LmluZXRfYXRvbihzdHJpbmdfbmV0d29yay5zcGxpdCgiLyIpWzBdKQogICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gVHJ1ZQoKCkBjb250ZXh0bGliLmNvbnRleHRtYW5hZ2VyCmRlZiBzZXRfZW52aXJvbihlbnZfbmFtZSwgdmFsdWUpOgogICAgIiIiU2V0IHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSAnZW52X25hbWUnIHRvICd2YWx1ZScKCiAgICBTYXZlIHByZXZpb3VzIHZhbHVlLCB5aWVsZCwgYW5kIHRoZW4gcmVzdG9yZSB0aGUgcHJldmlvdXMgdmFsdWUgc3RvcmVkIGluCiAgICB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGUgJ2Vudl9uYW1lJy4KCiAgICBJZiAndmFsdWUnIGlzIE5vbmUsIGRvIG5vdGhpbmciIiIKICAgIHZhbHVlX2NoYW5nZWQgPSB2YWx1ZSBpcyBub3QgTm9uZQogICAgaWYgdmFsdWVfY2hhbmdlZDoKICAgICAgICBvbGRfdmFsdWUgPSBvcy5lbnZpcm9uLmdldChlbnZfbmFtZSkKICAgICAgICBvcy5lbnZpcm9uW2Vudl9uYW1lXSA9IHZhbHVlCiAgICB0cnk6CiAgICAgICAgeWllbGQKICAgIGZpbmFsbHk6CiAgICAgICAgaWYgdmFsdWVfY2hhbmdlZDoKICAgICAgICAgICAgaWYgb2xkX3ZhbHVlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBkZWwgb3MuZW52aXJvbltlbnZfbmFtZV0KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9zLmVudmlyb25bZW52X25hbWVdID0gb2xkX3ZhbHVlCgoKZGVmIHNob3VsZF9ieXBhc3NfcHJveGllcyh1cmwsIG5vX3Byb3h5KToKICAgICIiIgogICAgUmV0dXJucyB3aGV0aGVyIHdlIHNob3VsZCBieXBhc3MgcHJveGllcyBvciBub3QuCgogICAgOnJ0eXBlOiBib29sCiAgICAiIiIKICAgICMgUHJpb3JpdGl6ZSBsb3dlcmNhc2UgZW52aXJvbm1lbnQgdmFyaWFibGVzIG92ZXIgdXBwZXJjYXNlCiAgICAjIHRvIGtlZXAgYSBjb25zaXN0ZW50IGJlaGF2aW91ciB3aXRoIG90aGVyIGh0dHAgcHJvamVjdHMgKGN1cmwsIHdnZXQpLgogICAgZGVmIGdldF9wcm94eShrZXkpOgogICAgICAgIHJldHVybiBvcy5lbnZpcm9uLmdldChrZXkpIG9yIG9zLmVudmlyb24uZ2V0KGtleS51cHBlcigpKQoKICAgICMgRmlyc3QgY2hlY2sgd2hldGhlciBub19wcm94eSBpcyBkZWZpbmVkLiBJZiBpdCBpcywgY2hlY2sgdGhhdCB0aGUgVVJMCiAgICAjIHdlJ3JlIGdldHRpbmcgaXNuJ3QgaW4gdGhlIG5vX3Byb3h5IGxpc3QuCiAgICBub19wcm94eV9hcmcgPSBub19wcm94eQogICAgaWYgbm9fcHJveHkgaXMgTm9uZToKICAgICAgICBub19wcm94eSA9IGdldF9wcm94eSgibm9fcHJveHkiKQogICAgcGFyc2VkID0gdXJscGFyc2UodXJsKQoKICAgIGlmIHBhcnNlZC5ob3N0bmFtZSBpcyBOb25lOgogICAgICAgICMgVVJMcyBkb24ndCBhbHdheXMgaGF2ZSBob3N0bmFtZXMsIGUuZy4gZmlsZTovLy8gdXJscy4KICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGlmIG5vX3Byb3h5OgogICAgICAgICMgV2UgbmVlZCB0byBjaGVjayB3aGV0aGVyIHdlIG1hdGNoIGhlcmUuIFdlIG5lZWQgdG8gc2VlIGlmIHdlIG1hdGNoCiAgICAgICAgIyB0aGUgZW5kIG9mIHRoZSBob3N0bmFtZSwgYm90aCB3aXRoIGFuZCB3aXRob3V0IHRoZSBwb3J0LgogICAgICAgIG5vX3Byb3h5ID0gKGhvc3QgZm9yIGhvc3QgaW4gbm9fcHJveHkucmVwbGFjZSgiICIsICIiKS5zcGxpdCgiLCIpIGlmIGhvc3QpCgogICAgICAgIGlmIGlzX2lwdjRfYWRkcmVzcyhwYXJzZWQuaG9zdG5hbWUpOgogICAgICAgICAgICBmb3IgcHJveHlfaXAgaW4gbm9fcHJveHk6CiAgICAgICAgICAgICAgICBpZiBpc192YWxpZF9jaWRyKHByb3h5X2lwKToKICAgICAgICAgICAgICAgICAgICBpZiBhZGRyZXNzX2luX25ldHdvcmsocGFyc2VkLmhvc3RuYW1lLCBwcm94eV9pcCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBlbGlmIHBhcnNlZC5ob3N0bmFtZSA9PSBwcm94eV9pcDoKICAgICAgICAgICAgICAgICAgICAjIElmIG5vX3Byb3h5IGlwIHdhcyBkZWZpbmVkIGluIHBsYWluIElQIG5vdGF0aW9uIGluc3RlYWQgb2YgY2lkciBub3RhdGlvbiAmCiAgICAgICAgICAgICAgICAgICAgIyBtYXRjaGVzIHRoZSBJUCBvZiB0aGUgaW5kZXgKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhvc3Rfd2l0aF9wb3J0ID0gcGFyc2VkLmhvc3RuYW1lCiAgICAgICAgICAgIGlmIHBhcnNlZC5wb3J0OgogICAgICAgICAgICAgICAgaG9zdF93aXRoX3BvcnQgKz0gZiI6e3BhcnNlZC5wb3J0fSIKCiAgICAgICAgICAgIGZvciBob3N0IGluIG5vX3Byb3h5OgogICAgICAgICAgICAgICAgaWYgcGFyc2VkLmhvc3RuYW1lLmVuZHN3aXRoKGhvc3QpIG9yIGhvc3Rfd2l0aF9wb3J0LmVuZHN3aXRoKGhvc3QpOgogICAgICAgICAgICAgICAgICAgICMgVGhlIFVSTCBkb2VzIG1hdGNoIHNvbWV0aGluZyBpbiBub19wcm94eSwgc28gd2UgZG9uJ3Qgd2FudAogICAgICAgICAgICAgICAgICAgICMgdG8gYXBwbHkgdGhlIHByb3hpZXMgb24gdGhpcyBVUkwuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKCiAgICB3aXRoIHNldF9lbnZpcm9uKCJub19wcm94eSIsIG5vX3Byb3h5X2FyZyk6CiAgICAgICAgIyBwYXJzZWQuaG9zdG5hbWUgY2FuIGJlIGBOb25lYCBpbiBjYXNlcyBzdWNoIGFzIGEgZmlsZSBVUkkuCiAgICAgICAgdHJ5OgogICAgICAgICAgICBieXBhc3MgPSBwcm94eV9ieXBhc3MocGFyc2VkLmhvc3RuYW1lKQogICAgICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBzb2NrZXQuZ2FpZXJyb3IpOgogICAgICAgICAgICBieXBhc3MgPSBGYWxzZQoKICAgIGlmIGJ5cGFzczoKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIHJldHVybiBGYWxzZQoKCmRlZiBnZXRfZW52aXJvbl9wcm94aWVzKHVybCwgbm9fcHJveHk9Tm9uZSk6CiAgICAiIiIKICAgIFJldHVybiBhIGRpY3Qgb2YgZW52aXJvbm1lbnQgcHJveGllcy4KCiAgICA6cnR5cGU6IGRpY3QKICAgICIiIgogICAgaWYgc2hvdWxkX2J5cGFzc19wcm94aWVzKHVybCwgbm9fcHJveHk9bm9fcHJveHkpOgogICAgICAgIHJldHVybiB7fQogICAgZWxzZToKICAgICAgICByZXR1cm4gZ2V0cHJveGllcygpCgoKZGVmIHNlbGVjdF9wcm94eSh1cmwsIHByb3hpZXMpOgogICAgIiIiU2VsZWN0IGEgcHJveHkgZm9yIHRoZSB1cmwsIGlmIGFwcGxpY2FibGUuCgogICAgOnBhcmFtIHVybDogVGhlIHVybCBiZWluZyBmb3IgdGhlIHJlcXVlc3QKICAgIDpwYXJhbSBwcm94aWVzOiBBIGRpY3Rpb25hcnkgb2Ygc2NoZW1lcyBvciBzY2hlbWVzIGFuZCBob3N0cyB0byBwcm94eSBVUkxzCiAgICAiIiIKICAgIHByb3hpZXMgPSBwcm94aWVzIG9yIHt9CiAgICB1cmxwYXJ0cyA9IHVybHBhcnNlKHVybCkKICAgIGlmIHVybHBhcnRzLmhvc3RuYW1lIGlzIE5vbmU6CiAgICAgICAgcmV0dXJuIHByb3hpZXMuZ2V0KHVybHBhcnRzLnNjaGVtZSwgcHJveGllcy5nZXQoImFsbCIpKQoKICAgIHByb3h5X2tleXMgPSBbCiAgICAgICAgdXJscGFydHMuc2NoZW1lICsgIjovLyIgKyB1cmxwYXJ0cy5ob3N0bmFtZSwKICAgICAgICB1cmxwYXJ0cy5zY2hlbWUsCiAgICAgICAgImFsbDovLyIgKyB1cmxwYXJ0cy5ob3N0bmFtZSwKICAgICAgICAiYWxsIiwKICAgIF0KICAgIHByb3h5ID0gTm9uZQogICAgZm9yIHByb3h5X2tleSBpbiBwcm94eV9rZXlzOgogICAgICAgIGlmIHByb3h5X2tleSBpbiBwcm94aWVzOgogICAgICAgICAgICBwcm94eSA9IHByb3hpZXNbcHJveHlfa2V5XQogICAgICAgICAgICBicmVhawoKICAgIHJldHVybiBwcm94eQoKCmRlZiByZXNvbHZlX3Byb3hpZXMocmVxdWVzdCwgcHJveGllcywgdHJ1c3RfZW52PVRydWUpOgogICAgIiIiVGhpcyBtZXRob2QgdGFrZXMgcHJveHkgaW5mb3JtYXRpb24gZnJvbSBhIHJlcXVlc3QgYW5kIGNvbmZpZ3VyYXRpb24KICAgIGlucHV0IHRvIHJlc29sdmUgYSBtYXBwaW5nIG9mIHRhcmdldCBwcm94aWVzLiBUaGlzIHdpbGwgY29uc2lkZXIgc2V0dGluZ3MKICAgIHN1Y2ggYSBOT19QUk9YWSB0byBzdHJpcCBwcm94eSBjb25maWd1cmF0aW9ucy4KCiAgICA6cGFyYW0gcmVxdWVzdDogUmVxdWVzdCBvciBQcmVwYXJlZFJlcXVlc3QKICAgIDpwYXJhbSBwcm94aWVzOiBBIGRpY3Rpb25hcnkgb2Ygc2NoZW1lcyBvciBzY2hlbWVzIGFuZCBob3N0cyB0byBwcm94eSBVUkxzCiAgICA6cGFyYW0gdHJ1c3RfZW52OiBCb29sZWFuIGRlY2xhcmluZyB3aGV0aGVyIHRvIHRydXN0IGVudmlyb25tZW50IGNvbmZpZ3MKCiAgICA6cnR5cGU6IGRpY3QKICAgICIiIgogICAgcHJveGllcyA9IHByb3hpZXMgaWYgcHJveGllcyBpcyBub3QgTm9uZSBlbHNlIHt9CiAgICB1cmwgPSByZXF1ZXN0LnVybAogICAgc2NoZW1lID0gdXJscGFyc2UodXJsKS5zY2hlbWUKICAgIG5vX3Byb3h5ID0gcHJveGllcy5nZXQoIm5vX3Byb3h5IikKICAgIG5ld19wcm94aWVzID0gcHJveGllcy5jb3B5KCkKCiAgICBpZiB0cnVzdF9lbnYgYW5kIG5vdCBzaG91bGRfYnlwYXNzX3Byb3hpZXModXJsLCBub19wcm94eT1ub19wcm94eSk6CiAgICAgICAgZW52aXJvbl9wcm94aWVzID0gZ2V0X2Vudmlyb25fcHJveGllcyh1cmwsIG5vX3Byb3h5PW5vX3Byb3h5KQoKICAgICAgICBwcm94eSA9IGVudmlyb25fcHJveGllcy5nZXQoc2NoZW1lLCBlbnZpcm9uX3Byb3hpZXMuZ2V0KCJhbGwiKSkKCiAgICAgICAgaWYgcHJveHk6CiAgICAgICAgICAgIG5ld19wcm94aWVzLnNldGRlZmF1bHQoc2NoZW1lLCBwcm94eSkKICAgIHJldHVybiBuZXdfcHJveGllcwoKCmRlZiBkZWZhdWx0X3VzZXJfYWdlbnQobmFtZT0icHl0aG9uLXJlcXVlc3RzIik6CiAgICAiIiIKICAgIFJldHVybiBhIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGRlZmF1bHQgdXNlciBhZ2VudC4KCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCiAgICByZXR1cm4gZiJ7bmFtZX0ve19fdmVyc2lvbl9ffSIKCgpkZWYgZGVmYXVsdF9oZWFkZXJzKCk6CiAgICAiIiIKICAgIDpydHlwZTogcmVxdWVzdHMuc3RydWN0dXJlcy5DYXNlSW5zZW5zaXRpdmVEaWN0CiAgICAiIiIKICAgIHJldHVybiBDYXNlSW5zZW5zaXRpdmVEaWN0KAogICAgICAgIHsKICAgICAgICAgICAgIlVzZXItQWdlbnQiOiBkZWZhdWx0X3VzZXJfYWdlbnQoKSwKICAgICAgICAgICAgIkFjY2VwdC1FbmNvZGluZyI6IERFRkFVTFRfQUNDRVBUX0VOQ09ESU5HLAogICAgICAgICAgICAiQWNjZXB0IjogIiovKiIsCiAgICAgICAgICAgICJDb25uZWN0aW9uIjogImtlZXAtYWxpdmUiLAogICAgICAgIH0KICAgICkKCgpkZWYgcGFyc2VfaGVhZGVyX2xpbmtzKHZhbHVlKToKICAgICIiIlJldHVybiBhIGxpc3Qgb2YgcGFyc2VkIGxpbmsgaGVhZGVycyBwcm94aWVzLgoKICAgIGkuZS4gTGluazogPGh0dHA6Ly4uLi9mcm9udC5qcGVnPjsgcmVsPWZyb250OyB0eXBlPSJpbWFnZS9qcGVnIiw8aHR0cDovLy4uLi9iYWNrLmpwZWc+OyByZWw9YmFjazt0eXBlPSJpbWFnZS9qcGVnIgoKICAgIDpydHlwZTogbGlzdAogICAgIiIiCgogICAgbGlua3MgPSBbXQoKICAgIHJlcGxhY2VfY2hhcnMgPSAiICdcIiIKCiAgICB2YWx1ZSA9IHZhbHVlLnN0cmlwKHJlcGxhY2VfY2hhcnMpCiAgICBpZiBub3QgdmFsdWU6CiAgICAgICAgcmV0dXJuIGxpbmtzCgogICAgZm9yIHZhbCBpbiByZS5zcGxpdCgiLCAqPCIsIHZhbHVlKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVybCwgcGFyYW1zID0gdmFsLnNwbGl0KCI7IiwgMSkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgdXJsLCBwYXJhbXMgPSB2YWwsICIiCgogICAgICAgIGxpbmsgPSB7InVybCI6IHVybC5zdHJpcCgiPD4gJ1wiIil9CgogICAgICAgIGZvciBwYXJhbSBpbiBwYXJhbXMuc3BsaXQoIjsiKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAga2V5LCB2YWx1ZSA9IHBhcmFtLnNwbGl0KCI9IikKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgbGlua1trZXkuc3RyaXAocmVwbGFjZV9jaGFycyldID0gdmFsdWUuc3RyaXAocmVwbGFjZV9jaGFycykKCiAgICAgICAgbGlua3MuYXBwZW5kKGxpbmspCgogICAgcmV0dXJuIGxpbmtzCgoKIyBOdWxsIGJ5dGVzOyBubyBuZWVkIHRvIHJlY3JlYXRlIHRoZXNlIG9uIGVhY2ggY2FsbCB0byBndWVzc19qc29uX3V0ZgpfbnVsbCA9ICJceDAwIi5lbmNvZGUoImFzY2lpIikgICMgZW5jb2RpbmcgdG8gQVNDSUkgZm9yIFB5dGhvbiAzCl9udWxsMiA9IF9udWxsICogMgpfbnVsbDMgPSBfbnVsbCAqIDMKCgpkZWYgZ3Vlc3NfanNvbl91dGYoZGF0YSk6CiAgICAiIiIKICAgIDpydHlwZTogc3RyCiAgICAiIiIKICAgICMgSlNPTiBhbHdheXMgc3RhcnRzIHdpdGggdHdvIEFTQ0lJIGNoYXJhY3RlcnMsIHNvIGRldGVjdGlvbiBpcyBhcwogICAgIyBlYXN5IGFzIGNvdW50aW5nIHRoZSBudWxscyBhbmQgZnJvbSB0aGVpciBsb2NhdGlvbiBhbmQgY291bnQKICAgICMgZGV0ZXJtaW5lIHRoZSBlbmNvZGluZy4gQWxzbyBkZXRlY3QgYSBCT00sIGlmIHByZXNlbnQuCiAgICBzYW1wbGUgPSBkYXRhWzo0XQogICAgaWYgc2FtcGxlIGluIChjb2RlY3MuQk9NX1VURjMyX0xFLCBjb2RlY3MuQk9NX1VURjMyX0JFKToKICAgICAgICByZXR1cm4gInV0Zi0zMiIgICMgQk9NIGluY2x1ZGVkCiAgICBpZiBzYW1wbGVbOjNdID09IGNvZGVjcy5CT01fVVRGODoKICAgICAgICByZXR1cm4gInV0Zi04LXNpZyIgICMgQk9NIGluY2x1ZGVkLCBNUyBzdHlsZSAoZGlzY291cmFnZWQpCiAgICBpZiBzYW1wbGVbOjJdIGluIChjb2RlY3MuQk9NX1VURjE2X0xFLCBjb2RlY3MuQk9NX1VURjE2X0JFKToKICAgICAgICByZXR1cm4gInV0Zi0xNiIgICMgQk9NIGluY2x1ZGVkCiAgICBudWxsY291bnQgPSBzYW1wbGUuY291bnQoX251bGwpCiAgICBpZiBudWxsY291bnQgPT0gMDoKICAgICAgICByZXR1cm4gInV0Zi04IgogICAgaWYgbnVsbGNvdW50ID09IDI6CiAgICAgICAgaWYgc2FtcGxlWzo6Ml0gPT0gX251bGwyOiAgIyAxc3QgYW5kIDNyZCBhcmUgbnVsbAogICAgICAgICAgICByZXR1cm4gInV0Zi0xNi1iZSIKICAgICAgICBpZiBzYW1wbGVbMTo6Ml0gPT0gX251bGwyOiAgIyAybmQgYW5kIDR0aCBhcmUgbnVsbAogICAgICAgICAgICByZXR1cm4gInV0Zi0xNi1sZSIKICAgICAgICAjIERpZCBub3QgZGV0ZWN0IDIgdmFsaWQgVVRGLTE2IGFzY2lpLXJhbmdlIGNoYXJhY3RlcnMKICAgIGlmIG51bGxjb3VudCA9PSAzOgogICAgICAgIGlmIHNhbXBsZVs6M10gPT0gX251bGwzOgogICAgICAgICAgICByZXR1cm4gInV0Zi0zMi1iZSIKICAgICAgICBpZiBzYW1wbGVbMTpdID09IF9udWxsMzoKICAgICAgICAgICAgcmV0dXJuICJ1dGYtMzItbGUiCiAgICAgICAgIyBEaWQgbm90IGRldGVjdCBhIHZhbGlkIFVURi0zMiBhc2NpaS1yYW5nZSBjaGFyYWN0ZXIKICAgIHJldHVybiBOb25lCgoKZGVmIHByZXBlbmRfc2NoZW1lX2lmX25lZWRlZCh1cmwsIG5ld19zY2hlbWUpOgogICAgIiIiR2l2ZW4gYSBVUkwgdGhhdCBtYXkgb3IgbWF5IG5vdCBoYXZlIGEgc2NoZW1lLCBwcmVwZW5kIHRoZSBnaXZlbiBzY2hlbWUuCiAgICBEb2VzIG5vdCByZXBsYWNlIGEgcHJlc2VudCBzY2hlbWUgd2l0aCB0aGUgb25lIHByb3ZpZGVkIGFzIGFuIGFyZ3VtZW50LgoKICAgIDpydHlwZTogc3RyCiAgICAiIiIKICAgIHBhcnNlZCA9IHBhcnNlX3VybCh1cmwpCiAgICBzY2hlbWUsIGF1dGgsIGhvc3QsIHBvcnQsIHBhdGgsIHF1ZXJ5LCBmcmFnbWVudCA9IHBhcnNlZAoKICAgICMgQSBkZWZlY3QgaW4gdXJscGFyc2UgZGV0ZXJtaW5lcyB0aGF0IHRoZXJlIGlzbid0IGEgbmV0bG9jIHByZXNlbnQgaW4gc29tZQogICAgIyB1cmxzLiBXZSBwcmV2aW91c2x5IGFzc3VtZWQgcGFyc2luZyB3YXMgb3Zlcmx5IGNhdXRpb3VzLCBhbmQgc3dhcHBlZCB0aGUKICAgICMgbmV0bG9jIGFuZCBwYXRoLiBEdWUgdG8gYSBsYWNrIG9mIHRlc3RzIG9uIHRoZSBvcmlnaW5hbCBkZWZlY3QsIHRoaXMgaXMKICAgICMgbWFpbnRhaW5lZCB3aXRoIHBhcnNlX3VybCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAgICBuZXRsb2MgPSBwYXJzZWQubmV0bG9jCiAgICBpZiBub3QgbmV0bG9jOgogICAgICAgIG5ldGxvYywgcGF0aCA9IHBhdGgsIG5ldGxvYwoKICAgIGlmIGF1dGg6CiAgICAgICAgIyBwYXJzZV91cmwgZG9lc24ndCBwcm92aWRlIHRoZSBuZXRsb2Mgd2l0aCBhdXRoCiAgICAgICAgIyBzbyB3ZSdsbCBhZGQgaXQgb3Vyc2VsdmVzLgogICAgICAgIG5ldGxvYyA9ICJAIi5qb2luKFthdXRoLCBuZXRsb2NdKQogICAgaWYgc2NoZW1lIGlzIE5vbmU6CiAgICAgICAgc2NoZW1lID0gbmV3X3NjaGVtZQogICAgaWYgcGF0aCBpcyBOb25lOgogICAgICAgIHBhdGggPSAiIgoKICAgIHJldHVybiB1cmx1bnBhcnNlKChzY2hlbWUsIG5ldGxvYywgcGF0aCwgIiIsIHF1ZXJ5LCBmcmFnbWVudCkpCgoKZGVmIGdldF9hdXRoX2Zyb21fdXJsKHVybCk6CiAgICAiIiJHaXZlbiBhIHVybCB3aXRoIGF1dGhlbnRpY2F0aW9uIGNvbXBvbmVudHMsIGV4dHJhY3QgdGhlbSBpbnRvIGEgdHVwbGUgb2YKICAgIHVzZXJuYW1lLHBhc3N3b3JkLgoKICAgIDpydHlwZTogKHN0cixzdHIpCiAgICAiIiIKICAgIHBhcnNlZCA9IHVybHBhcnNlKHVybCkKCiAgICB0cnk6CiAgICAgICAgYXV0aCA9ICh1bnF1b3RlKHBhcnNlZC51c2VybmFtZSksIHVucXVvdGUocGFyc2VkLnBhc3N3b3JkKSkKICAgIGV4Y2VwdCAoQXR0cmlidXRlRXJyb3IsIFR5cGVFcnJvcik6CiAgICAgICAgYXV0aCA9ICgiIiwgIiIpCgogICAgcmV0dXJuIGF1dGgKCgpkZWYgY2hlY2tfaGVhZGVyX3ZhbGlkaXR5KGhlYWRlcik6CiAgICAiIiJWZXJpZmllcyB0aGF0IGhlYWRlciBwYXJ0cyBkb24ndCBjb250YWluIGxlYWRpbmcgd2hpdGVzcGFjZQogICAgcmVzZXJ2ZWQgY2hhcmFjdGVycywgb3IgcmV0dXJuIGNoYXJhY3RlcnMuCgogICAgOnBhcmFtIGhlYWRlcjogdHVwbGUsIGluIHRoZSBmb3JtYXQgKG5hbWUsIHZhbHVlKS4KICAgICIiIgogICAgbmFtZSwgdmFsdWUgPSBoZWFkZXIKCiAgICBmb3IgcGFydCBpbiBoZWFkZXI6CiAgICAgICAgaWYgdHlwZShwYXJ0KSBub3QgaW4gSEVBREVSX1ZBTElEQVRPUlM6CiAgICAgICAgICAgIHJhaXNlIEludmFsaWRIZWFkZXIoCiAgICAgICAgICAgICAgICBmIkhlYWRlciBwYXJ0ICh7cGFydCFyfSkgZnJvbSB7e3tuYW1lIXJ9OiB7dmFsdWUhcn19fSBtdXN0IGJlICIKICAgICAgICAgICAgICAgIGYib2YgdHlwZSBzdHIgb3IgYnl0ZXMsIG5vdCB7dHlwZShwYXJ0KX0iCiAgICAgICAgICAgICkKCiAgICBfdmFsaWRhdGVfaGVhZGVyX3BhcnQobmFtZSwgIm5hbWUiLCBIRUFERVJfVkFMSURBVE9SU1t0eXBlKG5hbWUpXVswXSkKICAgIF92YWxpZGF0ZV9oZWFkZXJfcGFydCh2YWx1ZSwgInZhbHVlIiwgSEVBREVSX1ZBTElEQVRPUlNbdHlwZSh2YWx1ZSldWzFdKQoKCmRlZiBfdmFsaWRhdGVfaGVhZGVyX3BhcnQoaGVhZGVyX3BhcnQsIGhlYWRlcl9raW5kLCB2YWxpZGF0b3IpOgogICAgaWYgbm90IHZhbGlkYXRvci5tYXRjaChoZWFkZXJfcGFydCk6CiAgICAgICAgcmFpc2UgSW52YWxpZEhlYWRlcigKICAgICAgICAgICAgZiJJbnZhbGlkIGxlYWRpbmcgd2hpdGVzcGFjZSwgcmVzZXJ2ZWQgY2hhcmFjdGVyKHMpLCBvciByZXR1cm4iCiAgICAgICAgICAgIGYiY2hhcmFjdGVyKHMpIGluIGhlYWRlciB7aGVhZGVyX2tpbmR9OiB7aGVhZGVyX3BhcnQhcn0iCiAgICAgICAgKQoKCmRlZiB1cmxkZWZyYWdhdXRoKHVybCk6CiAgICAiIiIKICAgIEdpdmVuIGEgdXJsIHJlbW92ZSB0aGUgZnJhZ21lbnQgYW5kIHRoZSBhdXRoZW50aWNhdGlvbiBwYXJ0LgoKICAgIDpydHlwZTogc3RyCiAgICAiIiIKICAgIHNjaGVtZSwgbmV0bG9jLCBwYXRoLCBwYXJhbXMsIHF1ZXJ5LCBmcmFnbWVudCA9IHVybHBhcnNlKHVybCkKCiAgICAjIHNlZSBmdW5jOmBwcmVwZW5kX3NjaGVtZV9pZl9uZWVkZWRgCiAgICBpZiBub3QgbmV0bG9jOgogICAgICAgIG5ldGxvYywgcGF0aCA9IHBhdGgsIG5ldGxvYwoKICAgIG5ldGxvYyA9IG5ldGxvYy5yc3BsaXQoIkAiLCAxKVstMV0KCiAgICByZXR1cm4gdXJsdW5wYXJzZSgoc2NoZW1lLCBuZXRsb2MsIHBhdGgsIHBhcmFtcywgcXVlcnksICIiKSkKCgpkZWYgcmV3aW5kX2JvZHkocHJlcGFyZWRfcmVxdWVzdCk6CiAgICAiIiJNb3ZlIGZpbGUgcG9pbnRlciBiYWNrIHRvIGl0cyByZWNvcmRlZCBzdGFydGluZyBwb3NpdGlvbgogICAgc28gaXQgY2FuIGJlIHJlYWQgYWdhaW4gb24gcmVkaXJlY3QuCiAgICAiIiIKICAgIGJvZHlfc2VlayA9IGdldGF0dHIocHJlcGFyZWRfcmVxdWVzdC5ib2R5LCAic2VlayIsIE5vbmUpCiAgICBpZiBib2R5X3NlZWsgaXMgbm90IE5vbmUgYW5kIGlzaW5zdGFuY2UoCiAgICAgICAgcHJlcGFyZWRfcmVxdWVzdC5fYm9keV9wb3NpdGlvbiwgaW50ZWdlcl90eXBlcwogICAgKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGJvZHlfc2VlayhwcmVwYXJlZF9yZXF1ZXN0Ll9ib2R5X3Bvc2l0aW9uKQogICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICByYWlzZSBVbnJld2luZGFibGVCb2R5RXJyb3IoCiAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hlbiByZXdpbmRpbmcgcmVxdWVzdCBib2R5IGZvciByZWRpcmVjdC4iCiAgICAgICAgICAgICkKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgVW5yZXdpbmRhYmxlQm9keUVycm9yKCJVbmFibGUgdG8gcmV3aW5kIHJlcXVlc3QgYm9keSBmb3IgcmVkaXJlY3QuIikK
