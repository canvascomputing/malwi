statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/response.py
  contents:
  - name: <module>
    score: 0.0
    code: |-
      from __future__ import absolute_import
      from contextlib import contextmanager
      import zlib
      import io
      import logging
      from socket import timeout as SocketTimeout
      from socket import error as SocketError

      from ._collections import HTTPHeaderDict
      from .exceptions import (
          BodyNotHttplibCompatible, ProtocolError, DecodeError, ReadTimeoutError,
          ResponseNotChunked, IncompleteRead, InvalidHeader
      )
      from .packages.six import string_types as basestring, PY3
      from .packages.six.moves import http_client as httplib
      from .connection import HTTPException, BaseSSLError
      from .util.response import is_fp_closed, is_response_to_head

      log = logging.getLogger(__name__)


      class DeflateDecoder(object):

          def __init__(self):
              self._first_try = True
              self._data = b''
              self._obj = zlib.decompressobj()

          def __getattr__(self, name):
              return getattr(self._obj, name)

          def decompress(self, data):
              if not data:
                  return data

              if not self._first_try:
                  return self._obj.decompress(data)

              self._data += data
              try:
                  decompressed = self._obj.decompress(data)
                  if decompressed:
                      self._first_try = False
                      self._data = None
                  return decompressed
              except zlib.error:
                  self._first_try = False
                  self._obj = zlib.decompressobj(-zlib.MAX_WBITS)
                  try:
                      return self.decompress(self._data)
                  finally:
                      self._data = None
    tokens: resume load_const INTEGER load_const import_name __future__ import_from absolute_import store_name absolute_import pop_top load_const INTEGER load_const import_name contextlib import_from contextmanager store_name contextmanager pop_top load_const INTEGER load_const import_name zlib store_name zlib load_const INTEGER load_const import_name io store_name io load_const INTEGER load_const import_name logging store_name logging load_const INTEGER load_const import_name socket import_from timeout store_name SocketTimeout pop_top load_const INTEGER load_const import_name socket import_from error store_name SocketError pop_top load_const INTEGER load_const import_name _collections import_from HTTPHeaderDict store_name HTTPHeaderDict pop_top load_const INTEGER load_const import_name exceptions import_from STRING_BASE64_LEN_S_ENT_HIGH store_name STRING_BASE64_LEN_S_ENT_HIGH import_from ProtocolError store_name ProtocolError import_from DecodeError store_name DecodeError import_from STRING_BASE64_LEN_S_ENT_HIGH store_name STRING_BASE64_LEN_S_ENT_HIGH import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH import_from IncompleteRead store_name IncompleteRead import_from InvalidHeader store_name InvalidHeader pop_top load_const INTEGER load_const import_name packages.six import_from string_types store_name basestring import_from PY3 store_name PY3 pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from http_client store_name httplib pop_top load_const INTEGER load_const import_name connection import_from HTTPException store_name HTTPException import_from BaseSSLError store_name BaseSSLError pop_top load_const INTEGER load_const import_name util.response import_from is_fp_closed store_name is_fp_closed import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top push_null load_name logging load_attr getLogger load_name __name__ call store_name log push_null load_build_class load_const OBJECT make_function load_const DeflateDecoder load_name object call store_name DeflateDecoder push_null load_build_class load_const OBJECT make_function load_const STRING_BASE64_LEN_S_ENT_HIGH load_name object call store_name STRING_BASE64_LEN_S_ENT_HIGH push_null load_build_class load_const OBJECT make_function load_const GzipDecoder load_name object call store_name GzipDecoder push_null load_build_class load_const OBJECT make_function load_const MultiDecoder load_name object call store_name MultiDecoder load_const OBJECT make_function store_name _get_decoder push_null load_build_class load_const OBJECT make_function load_const HTTPResponse load_name io load_attr IOBase call store_name HTTPResponse return_const None
    hash: 83c47be6696b1ae08a05f4b12514b2cb6848061a0439a5bdc662e916982813be
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/response.py
  : ZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBhYnNvbHV0ZV9pbXBvcnQKZnJvbSBjb250ZXh0bGliIGltcG9ydCBjb250ZXh0bWFuYWdlcgppbXBvcnQgemxpYgppbXBvcnQgaW8KaW1wb3J0IGxvZ2dpbmcKZnJvbSBzb2NrZXQgaW1wb3J0IHRpbWVvdXQgYXMgU29ja2V0VGltZW91dApmcm9tIHNvY2tldCBpbXBvcnQgZXJyb3IgYXMgU29ja2V0RXJyb3IKCmZyb20gLl9jb2xsZWN0aW9ucyBpbXBvcnQgSFRUUEhlYWRlckRpY3QKZnJvbSAuZXhjZXB0aW9ucyBpbXBvcnQgKAogICAgQm9keU5vdEh0dHBsaWJDb21wYXRpYmxlLCBQcm90b2NvbEVycm9yLCBEZWNvZGVFcnJvciwgUmVhZFRpbWVvdXRFcnJvciwKICAgIFJlc3BvbnNlTm90Q2h1bmtlZCwgSW5jb21wbGV0ZVJlYWQsIEludmFsaWRIZWFkZXIKKQpmcm9tIC5wYWNrYWdlcy5zaXggaW1wb3J0IHN0cmluZ190eXBlcyBhcyBiYXNlc3RyaW5nLCBQWTMKZnJvbSAucGFja2FnZXMuc2l4Lm1vdmVzIGltcG9ydCBodHRwX2NsaWVudCBhcyBodHRwbGliCmZyb20gLmNvbm5lY3Rpb24gaW1wb3J0IEhUVFBFeGNlcHRpb24sIEJhc2VTU0xFcnJvcgpmcm9tIC51dGlsLnJlc3BvbnNlIGltcG9ydCBpc19mcF9jbG9zZWQsIGlzX3Jlc3BvbnNlX3RvX2hlYWQKCmxvZyA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQoKCmNsYXNzIERlZmxhdGVEZWNvZGVyKG9iamVjdCk6CgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuX2ZpcnN0X3RyeSA9IFRydWUKICAgICAgICBzZWxmLl9kYXRhID0gYicnCiAgICAgICAgc2VsZi5fb2JqID0gemxpYi5kZWNvbXByZXNzb2JqKCkKCiAgICBkZWYgX19nZXRhdHRyX18oc2VsZiwgbmFtZSk6CiAgICAgICAgcmV0dXJuIGdldGF0dHIoc2VsZi5fb2JqLCBuYW1lKQoKICAgIGRlZiBkZWNvbXByZXNzKHNlbGYsIGRhdGEpOgogICAgICAgIGlmIG5vdCBkYXRhOgogICAgICAgICAgICByZXR1cm4gZGF0YQoKICAgICAgICBpZiBub3Qgc2VsZi5fZmlyc3RfdHJ5OgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb2JqLmRlY29tcHJlc3MoZGF0YSkKCiAgICAgICAgc2VsZi5fZGF0YSArPSBkYXRhCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkZWNvbXByZXNzZWQgPSBzZWxmLl9vYmouZGVjb21wcmVzcyhkYXRhKQogICAgICAgICAgICBpZiBkZWNvbXByZXNzZWQ6CiAgICAgICAgICAgICAgICBzZWxmLl9maXJzdF90cnkgPSBGYWxzZQogICAgICAgICAgICAgICAgc2VsZi5fZGF0YSA9IE5vbmUKICAgICAgICAgICAgcmV0dXJuIGRlY29tcHJlc3NlZAogICAgICAgIGV4Y2VwdCB6bGliLmVycm9yOgogICAgICAgICAgICBzZWxmLl9maXJzdF90cnkgPSBGYWxzZQogICAgICAgICAgICBzZWxmLl9vYmogPSB6bGliLmRlY29tcHJlc3NvYmooLXpsaWIuTUFYX1dCSVRTKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5kZWNvbXByZXNzKHNlbGYuX2RhdGEpCiAgICAgICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICAgICBzZWxmLl9kYXRhID0gTm9uZQoKCmNsYXNzIEd6aXBEZWNvZGVyU3RhdGUob2JqZWN0KToKCiAgICBGSVJTVF9NRU1CRVIgPSAwCiAgICBPVEhFUl9NRU1CRVJTID0gMQogICAgU1dBTExPV19EQVRBID0gMgoKCmNsYXNzIEd6aXBEZWNvZGVyKG9iamVjdCk6CgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuX29iaiA9IHpsaWIuZGVjb21wcmVzc29iaigxNiArIHpsaWIuTUFYX1dCSVRTKQogICAgICAgIHNlbGYuX3N0YXRlID0gR3ppcERlY29kZXJTdGF0ZS5GSVJTVF9NRU1CRVIKCiAgICBkZWYgX19nZXRhdHRyX18oc2VsZiwgbmFtZSk6CiAgICAgICAgcmV0dXJuIGdldGF0dHIoc2VsZi5fb2JqLCBuYW1lKQoKICAgIGRlZiBkZWNvbXByZXNzKHNlbGYsIGRhdGEpOgogICAgICAgIHJldCA9IGJ5dGVhcnJheSgpCiAgICAgICAgaWYgc2VsZi5fc3RhdGUgPT0gR3ppcERlY29kZXJTdGF0ZS5TV0FMTE9XX0RBVEEgb3Igbm90IGRhdGE6CiAgICAgICAgICAgIHJldHVybiBieXRlcyhyZXQpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0ICs9IHNlbGYuX29iai5kZWNvbXByZXNzKGRhdGEpCiAgICAgICAgICAgIGV4Y2VwdCB6bGliLmVycm9yOgogICAgICAgICAgICAgICAgcHJldmlvdXNfc3RhdGUgPSBzZWxmLl9zdGF0ZQogICAgICAgICAgICAgICAgIyBJZ25vcmUgZGF0YSBhZnRlciB0aGUgZmlyc3QgZXJyb3IKICAgICAgICAgICAgICAgIHNlbGYuX3N0YXRlID0gR3ppcERlY29kZXJTdGF0ZS5TV0FMTE9XX0RBVEEKICAgICAgICAgICAgICAgIGlmIHByZXZpb3VzX3N0YXRlID09IEd6aXBEZWNvZGVyU3RhdGUuT1RIRVJfTUVNQkVSUzoKICAgICAgICAgICAgICAgICAgICAjIEFsbG93IHRyYWlsaW5nIGdhcmJhZ2UgYWNjZXB0YWJsZSBpbiBvdGhlciBnemlwIGNsaWVudHMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnl0ZXMocmV0KQogICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZGF0YSA9IHNlbGYuX29iai51bnVzZWRfZGF0YQogICAgICAgICAgICBpZiBub3QgZGF0YToKICAgICAgICAgICAgICAgIHJldHVybiBieXRlcyhyZXQpCiAgICAgICAgICAgIHNlbGYuX3N0YXRlID0gR3ppcERlY29kZXJTdGF0ZS5PVEhFUl9NRU1CRVJTCiAgICAgICAgICAgIHNlbGYuX29iaiA9IHpsaWIuZGVjb21wcmVzc29iaigxNiArIHpsaWIuTUFYX1dCSVRTKQoKCmNsYXNzIE11bHRpRGVjb2RlcihvYmplY3QpOgogICAgIiIiCiAgICBGcm9tIFJGQzcyMzE6CiAgICAgICAgSWYgb25lIG9yIG1vcmUgZW5jb2RpbmdzIGhhdmUgYmVlbiBhcHBsaWVkIHRvIGEgcmVwcmVzZW50YXRpb24sIHRoZQogICAgICAgIHNlbmRlciB0aGF0IGFwcGxpZWQgdGhlIGVuY29kaW5ncyBNVVNUIGdlbmVyYXRlIGEgQ29udGVudC1FbmNvZGluZwogICAgICAgIGhlYWRlciBmaWVsZCB0aGF0IGxpc3RzIHRoZSBjb250ZW50IGNvZGluZ3MgaW4gdGhlIG9yZGVyIGluIHdoaWNoCiAgICAgICAgdGhleSB3ZXJlIGFwcGxpZWQuCiAgICAiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgbW9kZXMpOgogICAgICAgIHNlbGYuX2RlY29kZXJzID0gW19nZXRfZGVjb2RlcihtLnN0cmlwKCkpIGZvciBtIGluIG1vZGVzLnNwbGl0KCcsJyldCgogICAgZGVmIGZsdXNoKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9kZWNvZGVyc1swXS5mbHVzaCgpCgogICAgZGVmIGRlY29tcHJlc3Moc2VsZiwgZGF0YSk6CiAgICAgICAgZm9yIGQgaW4gcmV2ZXJzZWQoc2VsZi5fZGVjb2RlcnMpOgogICAgICAgICAgICBkYXRhID0gZC5kZWNvbXByZXNzKGRhdGEpCiAgICAgICAgcmV0dXJuIGRhdGEKCgpkZWYgX2dldF9kZWNvZGVyKG1vZGUpOgogICAgaWYgJywnIGluIG1vZGU6CiAgICAgICAgcmV0dXJuIE11bHRpRGVjb2Rlcihtb2RlKQoKICAgIGlmIG1vZGUgPT0gJ2d6aXAnOgogICAgICAgIHJldHVybiBHemlwRGVjb2RlcigpCgogICAgcmV0dXJuIERlZmxhdGVEZWNvZGVyKCkKCgpjbGFzcyBIVFRQUmVzcG9uc2UoaW8uSU9CYXNlKToKICAgICIiIgogICAgSFRUUCBSZXNwb25zZSBjb250YWluZXIuCgogICAgQmFja3dhcmRzLWNvbXBhdGlibGUgdG8gaHR0cGxpYidzIEhUVFBSZXNwb25zZSBidXQgdGhlIHJlc3BvbnNlIGBgYm9keWBgIGlzCiAgICBsb2FkZWQgYW5kIGRlY29kZWQgb24tZGVtYW5kIHdoZW4gdGhlIGBgZGF0YWBgIHByb3BlcnR5IGlzIGFjY2Vzc2VkLiAgVGhpcwogICAgY2xhc3MgaXMgYWxzbyBjb21wYXRpYmxlIHdpdGggdGhlIFB5dGhvbiBzdGFuZGFyZCBsaWJyYXJ5J3MgOm1vZDpgaW9gCiAgICBtb2R1bGUsIGFuZCBjYW4gaGVuY2UgYmUgdHJlYXRlZCBhcyBhIHJlYWRhYmxlIG9iamVjdCBpbiB0aGUgY29udGV4dCBvZiB0aGF0CiAgICBmcmFtZXdvcmsuCgogICAgRXh0cmEgcGFyYW1ldGVycyBmb3IgYmVoYXZpb3VyIG5vdCBwcmVzZW50IGluIGh0dHBsaWIuSFRUUFJlc3BvbnNlOgoKICAgIDpwYXJhbSBwcmVsb2FkX2NvbnRlbnQ6CiAgICAgICAgSWYgVHJ1ZSwgdGhlIHJlc3BvbnNlJ3MgYm9keSB3aWxsIGJlIHByZWxvYWRlZCBkdXJpbmcgY29uc3RydWN0aW9uLgoKICAgIDpwYXJhbSBkZWNvZGVfY29udGVudDoKICAgICAgICBJZiBUcnVlLCB3aWxsIGF0dGVtcHQgdG8gZGVjb2RlIHRoZSBib2R5IGJhc2VkIG9uIHRoZQogICAgICAgICdjb250ZW50LWVuY29kaW5nJyBoZWFkZXIuCgogICAgOnBhcmFtIG9yaWdpbmFsX3Jlc3BvbnNlOgogICAgICAgIFdoZW4gdGhpcyBIVFRQUmVzcG9uc2Ugd3JhcHBlciBpcyBnZW5lcmF0ZWQgZnJvbSBhbiBodHRwbGliLkhUVFBSZXNwb25zZQogICAgICAgIG9iamVjdCwgaXQncyBjb252ZW5pZW50IHRvIGluY2x1ZGUgdGhlIG9yaWdpbmFsIGZvciBkZWJ1ZyBwdXJwb3Nlcy4gSXQncwogICAgICAgIG90aGVyd2lzZSB1bnVzZWQuCgogICAgOnBhcmFtIHJldHJpZXM6CiAgICAgICAgVGhlIHJldHJpZXMgY29udGFpbnMgdGhlIGxhc3QgOmNsYXNzOmB+dXJsbGliMy51dGlsLnJldHJ5LlJldHJ5YCB0aGF0CiAgICAgICAgd2FzIHVzZWQgZHVyaW5nIHRoZSByZXF1ZXN0LgoKICAgIDpwYXJhbSBlbmZvcmNlX2NvbnRlbnRfbGVuZ3RoOgogICAgICAgIEVuZm9yY2UgY29udGVudCBsZW5ndGggY2hlY2tpbmcuIEJvZHkgcmV0dXJuZWQgYnkgc2VydmVyIG11c3QgbWF0Y2gKICAgICAgICB2YWx1ZSBvZiBDb250ZW50LUxlbmd0aCBoZWFkZXIsIGlmIHByZXNlbnQuIE90aGVyd2lzZSwgcmFpc2UgZXJyb3IuCiAgICAiIiIKCiAgICBDT05URU5UX0RFQ09ERVJTID0gWydnemlwJywgJ2RlZmxhdGUnXQogICAgUkVESVJFQ1RfU1RBVFVTRVMgPSBbMzAxLCAzMDIsIDMwMywgMzA3LCAzMDhdCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGJvZHk9JycsIGhlYWRlcnM9Tm9uZSwgc3RhdHVzPTAsIHZlcnNpb249MCwgcmVhc29uPU5vbmUsCiAgICAgICAgICAgICAgICAgc3RyaWN0PTAsIHByZWxvYWRfY29udGVudD1UcnVlLCBkZWNvZGVfY29udGVudD1UcnVlLAogICAgICAgICAgICAgICAgIG9yaWdpbmFsX3Jlc3BvbnNlPU5vbmUsIHBvb2w9Tm9uZSwgY29ubmVjdGlvbj1Ob25lLCBtc2c9Tm9uZSwKICAgICAgICAgICAgICAgICByZXRyaWVzPU5vbmUsIGVuZm9yY2VfY29udGVudF9sZW5ndGg9RmFsc2UsCiAgICAgICAgICAgICAgICAgcmVxdWVzdF9tZXRob2Q9Tm9uZSwgcmVxdWVzdF91cmw9Tm9uZSk6CgogICAgICAgIGlmIGlzaW5zdGFuY2UoaGVhZGVycywgSFRUUEhlYWRlckRpY3QpOgogICAgICAgICAgICBzZWxmLmhlYWRlcnMgPSBoZWFkZXJzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5oZWFkZXJzID0gSFRUUEhlYWRlckRpY3QoaGVhZGVycykKICAgICAgICBzZWxmLnN0YXR1cyA9IHN0YXR1cwogICAgICAgIHNlbGYudmVyc2lvbiA9IHZlcnNpb24KICAgICAgICBzZWxmLnJlYXNvbiA9IHJlYXNvbgogICAgICAgIHNlbGYuc3RyaWN0ID0gc3RyaWN0CiAgICAgICAgc2VsZi5kZWNvZGVfY29udGVudCA9IGRlY29kZV9jb250ZW50CiAgICAgICAgc2VsZi5yZXRyaWVzID0gcmV0cmllcwogICAgICAgIHNlbGYuZW5mb3JjZV9jb250ZW50X2xlbmd0aCA9IGVuZm9yY2VfY29udGVudF9sZW5ndGgKCiAgICAgICAgc2VsZi5fZGVjb2RlciA9IE5vbmUKICAgICAgICBzZWxmLl9ib2R5ID0gTm9uZQogICAgICAgIHNlbGYuX2ZwID0gTm9uZQogICAgICAgIHNlbGYuX29yaWdpbmFsX3Jlc3BvbnNlID0gb3JpZ2luYWxfcmVzcG9uc2UKICAgICAgICBzZWxmLl9mcF9ieXRlc19yZWFkID0gMAogICAgICAgIHNlbGYubXNnID0gbXNnCiAgICAgICAgc2VsZi5fcmVxdWVzdF91cmwgPSByZXF1ZXN0X3VybAoKICAgICAgICBpZiBib2R5IGFuZCBpc2luc3RhbmNlKGJvZHksIChiYXNlc3RyaW5nLCBieXRlcykpOgogICAgICAgICAgICBzZWxmLl9ib2R5ID0gYm9keQoKICAgICAgICBzZWxmLl9wb29sID0gcG9vbAogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBjb25uZWN0aW9uCgogICAgICAgIGlmIGhhc2F0dHIoYm9keSwgJ3JlYWQnKToKICAgICAgICAgICAgc2VsZi5fZnAgPSBib2R5CgogICAgICAgICMgQXJlIHdlIHVzaW5nIHRoZSBjaHVua2VkLXN0eWxlIG9mIHRyYW5zZmVyIGVuY29kaW5nPwogICAgICAgIHNlbGYuY2h1bmtlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5jaHVua19sZWZ0ID0gTm9uZQogICAgICAgIHRyX2VuYyA9IHNlbGYuaGVhZGVycy5nZXQoJ3RyYW5zZmVyLWVuY29kaW5nJywgJycpLmxvd2VyKCkKICAgICAgICAjIERvbid0IGluY3VyIHRoZSBwZW5hbHR5IG9mIGNyZWF0aW5nIGEgbGlzdCBhbmQgdGhlbiBkaXNjYXJkaW5nIGl0CiAgICAgICAgZW5jb2RpbmdzID0gKGVuYy5zdHJpcCgpIGZvciBlbmMgaW4gdHJfZW5jLnNwbGl0KCIsIikpCiAgICAgICAgaWYgImNodW5rZWQiIGluIGVuY29kaW5nczoKICAgICAgICAgICAgc2VsZi5jaHVua2VkID0gVHJ1ZQoKICAgICAgICAjIERldGVybWluZSBsZW5ndGggb2YgcmVzcG9uc2UKICAgICAgICBzZWxmLmxlbmd0aF9yZW1haW5pbmcgPSBzZWxmLl9pbml0X2xlbmd0aChyZXF1ZXN0X21ldGhvZCkKCiAgICAgICAgIyBJZiByZXF1ZXN0ZWQsIHByZWxvYWQgdGhlIGJvZHkuCiAgICAgICAgaWYgcHJlbG9hZF9jb250ZW50IGFuZCBub3Qgc2VsZi5fYm9keToKICAgICAgICAgICAgc2VsZi5fYm9keSA9IHNlbGYucmVhZChkZWNvZGVfY29udGVudD1kZWNvZGVfY29udGVudCkKCiAgICBkZWYgZ2V0X3JlZGlyZWN0X2xvY2F0aW9uKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIFNob3VsZCB3ZSByZWRpcmVjdCBhbmQgd2hlcmUgdG8/CgogICAgICAgIDpyZXR1cm5zOiBUcnV0aHkgcmVkaXJlY3QgbG9jYXRpb24gc3RyaW5nIGlmIHdlIGdvdCBhIHJlZGlyZWN0IHN0YXR1cwogICAgICAgICAgICBjb2RlIGFuZCB2YWxpZCBsb2NhdGlvbi4gYGBOb25lYGAgaWYgcmVkaXJlY3Qgc3RhdHVzIGFuZCBubwogICAgICAgICAgICBsb2NhdGlvbi4gYGBGYWxzZWBgIGlmIG5vdCBhIHJlZGlyZWN0IHN0YXR1cyBjb2RlLgogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuc3RhdHVzIGluIHNlbGYuUkVESVJFQ1RfU1RBVFVTRVM6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmhlYWRlcnMuZ2V0KCdsb2NhdGlvbicpCgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiByZWxlYXNlX2Nvbm4oc2VsZik6CiAgICAgICAgaWYgbm90IHNlbGYuX3Bvb2wgb3Igbm90IHNlbGYuX2Nvbm5lY3Rpb246CiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBzZWxmLl9wb29sLl9wdXRfY29ubihzZWxmLl9jb25uZWN0aW9uKQogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBOb25lCgogICAgQHByb3BlcnR5CiAgICBkZWYgZGF0YShzZWxmKToKICAgICAgICAjIEZvciBiYWNrd29yZHMtY29tcGF0IHdpdGggZWFybGllciB1cmxsaWIzIDAuNCBhbmQgZWFybGllci4KICAgICAgICBpZiBzZWxmLl9ib2R5OgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYm9keQoKICAgICAgICBpZiBzZWxmLl9mcDoKICAgICAgICAgICAgcmV0dXJuIHNlbGYucmVhZChjYWNoZV9jb250ZW50PVRydWUpCgogICAgQHByb3BlcnR5CiAgICBkZWYgY29ubmVjdGlvbihzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5fY29ubmVjdGlvbgoKICAgIGRlZiBpc2Nsb3NlZChzZWxmKToKICAgICAgICByZXR1cm4gaXNfZnBfY2xvc2VkKHNlbGYuX2ZwKQoKICAgIGRlZiB0ZWxsKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIE9idGFpbiB0aGUgbnVtYmVyIG9mIGJ5dGVzIHB1bGxlZCBvdmVyIHRoZSB3aXJlIHNvIGZhci4gTWF5IGRpZmZlciBmcm9tCiAgICAgICAgdGhlIGFtb3VudCBvZiBjb250ZW50IHJldHVybmVkIGJ5IDptZXRoOmBgSFRUUFJlc3BvbnNlLnJlYWRgYCBpZiBieXRlcwogICAgICAgIGFyZSBlbmNvZGVkIG9uIHRoZSB3aXJlIChlLmcsIGNvbXByZXNzZWQpLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9mcF9ieXRlc19yZWFkCgogICAgZGVmIF9pbml0X2xlbmd0aChzZWxmLCByZXF1ZXN0X21ldGhvZCk6CiAgICAgICAgIiIiCiAgICAgICAgU2V0IGluaXRpYWwgbGVuZ3RoIHZhbHVlIGZvciBSZXNwb25zZSBjb250ZW50IGlmIGF2YWlsYWJsZS4KICAgICAgICAiIiIKICAgICAgICBsZW5ndGggPSBzZWxmLmhlYWRlcnMuZ2V0KCdjb250ZW50LWxlbmd0aCcpCgogICAgICAgIGlmIGxlbmd0aCBpcyBub3QgTm9uZToKICAgICAgICAgICAgaWYgc2VsZi5jaHVua2VkOgogICAgICAgICAgICAgICAgIyBUaGlzIFJlc3BvbnNlIHdpbGwgZmFpbCB3aXRoIGFuIEluY29tcGxldGVSZWFkIGlmIGl0IGNhbid0IGJlCiAgICAgICAgICAgICAgICAjIHJlY2VpdmVkIGFzIGNodW5rZWQuIFRoaXMgbWV0aG9kIGZhbGxzIGJhY2sgdG8gYXR0ZW1wdCByZWFkaW5nCiAgICAgICAgICAgICAgICAjIHRoZSByZXNwb25zZSBiZWZvcmUgcmFpc2luZyBhbiBleGNlcHRpb24uCiAgICAgICAgICAgICAgICBsb2cud2FybmluZygiUmVjZWl2ZWQgcmVzcG9uc2Ugd2l0aCBib3RoIENvbnRlbnQtTGVuZ3RoIGFuZCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiVHJhbnNmZXItRW5jb2Rpbmcgc2V0LiBUaGlzIGlzIGV4cHJlc3NseSBmb3JiaWRkZW4gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgImJ5IFJGQyA3MjMwIHNlYyAzLjMuMi4gSWdub3JpbmcgQ29udGVudC1MZW5ndGggYW5kICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhdHRlbXB0aW5nIHRvIHByb2Nlc3MgcmVzcG9uc2UgYXMgVHJhbnNmZXItRW5jb2Rpbmc6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjaHVua2VkLiIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBSRkMgNzIzMCBzZWN0aW9uIDMuMy4yIHNwZWNpZmllcyBtdWx0aXBsZSBjb250ZW50IGxlbmd0aHMgY2FuCiAgICAgICAgICAgICAgICAjIGJlIHNlbnQgaW4gYSBzaW5nbGUgQ29udGVudC1MZW5ndGggaGVhZGVyCiAgICAgICAgICAgICAgICAjIChlLmcuIENvbnRlbnQtTGVuZ3RoOiA0MiwgNDIpLiBUaGlzIGxpbmUgZW5zdXJlcyB0aGUgdmFsdWVzCiAgICAgICAgICAgICAgICAjIGFyZSBhbGwgdmFsaWQgaW50cyBhbmQgdGhhdCBhcyBsb25nIGFzIHRoZSBgc2V0YCBsZW5ndGggaXMgMSwKICAgICAgICAgICAgICAgICMgYWxsIHZhbHVlcyBhcmUgdGhlIHNhbWUuIE90aGVyd2lzZSwgdGhlIGhlYWRlciBpcyBpbnZhbGlkLgogICAgICAgICAgICAgICAgbGVuZ3RocyA9IHNldChbaW50KHZhbCkgZm9yIHZhbCBpbiBsZW5ndGguc3BsaXQoJywnKV0pCiAgICAgICAgICAgICAgICBpZiBsZW4obGVuZ3RocykgPiAxOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIEludmFsaWRIZWFkZXIoIkNvbnRlbnQtTGVuZ3RoIGNvbnRhaW5lZCBtdWx0aXBsZSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidW5tYXRjaGluZyB2YWx1ZXMgKCVzKSIgJSBsZW5ndGgpCiAgICAgICAgICAgICAgICBsZW5ndGggPSBsZW5ndGhzLnBvcCgpCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgbGVuZ3RoID0gTm9uZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgbGVuZ3RoIDwgMDoKICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBOb25lCgogICAgICAgICMgQ29udmVydCBzdGF0dXMgdG8gaW50IGZvciBjb21wYXJpc29uCiAgICAgICAgIyBJbiBzb21lIGNhc2VzLCBodHRwbGliIHJldHVybnMgYSBzdGF0dXMgb2YgIl9VTktOT1dOIgogICAgICAgIHRyeToKICAgICAgICAgICAgc3RhdHVzID0gaW50KHNlbGYuc3RhdHVzKQogICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICBzdGF0dXMgPSAwCgogICAgICAgICMgQ2hlY2sgZm9yIHJlc3BvbnNlcyB0aGF0IHNob3VsZG4ndCBpbmNsdWRlIGEgYm9keQogICAgICAgIGlmIHN0YXR1cyBpbiAoMjA0LCAzMDQpIG9yIDEwMCA8PSBzdGF0dXMgPCAyMDAgb3IgcmVxdWVzdF9tZXRob2QgPT0gJ0hFQUQnOgogICAgICAgICAgICBsZW5ndGggPSAwCgogICAgICAgIHJldHVybiBsZW5ndGgKCiAgICBkZWYgX2luaXRfZGVjb2RlcihzZWxmKToKICAgICAgICAiIiIKICAgICAgICBTZXQtdXAgdGhlIF9kZWNvZGVyIGF0dHJpYnV0ZSBpZiBuZWNlc3NhcnkuCiAgICAgICAgIiIiCiAgICAgICAgIyBOb3RlOiBjb250ZW50LWVuY29kaW5nIHZhbHVlIHNob3VsZCBiZSBjYXNlLWluc2Vuc2l0aXZlLCBwZXIgUkZDIDcyMzAKICAgICAgICAjIFNlY3Rpb24gMy4yCiAgICAgICAgY29udGVudF9lbmNvZGluZyA9IHNlbGYuaGVhZGVycy5nZXQoJ2NvbnRlbnQtZW5jb2RpbmcnLCAnJykubG93ZXIoKQogICAgICAgIGlmIHNlbGYuX2RlY29kZXIgaXMgTm9uZToKICAgICAgICAgICAgaWYgY29udGVudF9lbmNvZGluZyBpbiBzZWxmLkNPTlRFTlRfREVDT0RFUlM6CiAgICAgICAgICAgICAgICBzZWxmLl9kZWNvZGVyID0gX2dldF9kZWNvZGVyKGNvbnRlbnRfZW5jb2RpbmcpCiAgICAgICAgICAgIGVsaWYgJywnIGluIGNvbnRlbnRfZW5jb2Rpbmc6CiAgICAgICAgICAgICAgICBlbmNvZGluZ3MgPSBbCiAgICAgICAgICAgICAgICAgICAgZS5zdHJpcCgpIGZvciBlIGluIGNvbnRlbnRfZW5jb2Rpbmcuc3BsaXQoJywnKQogICAgICAgICAgICAgICAgICAgIGlmIGUuc3RyaXAoKSBpbiBzZWxmLkNPTlRFTlRfREVDT0RFUlNdCiAgICAgICAgICAgICAgICBpZiBsZW4oZW5jb2RpbmdzKToKICAgICAgICAgICAgICAgICAgICBzZWxmLl9kZWNvZGVyID0gX2dldF9kZWNvZGVyKGNvbnRlbnRfZW5jb2RpbmcpCgogICAgZGVmIF9kZWNvZGUoc2VsZiwgZGF0YSwgZGVjb2RlX2NvbnRlbnQsIGZsdXNoX2RlY29kZXIpOgogICAgICAgICIiIgogICAgICAgIERlY29kZSB0aGUgZGF0YSBwYXNzZWQgaW4gYW5kIHBvdGVudGlhbGx5IGZsdXNoIHRoZSBkZWNvZGVyLgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgZGVjb2RlX2NvbnRlbnQgYW5kIHNlbGYuX2RlY29kZXI6CiAgICAgICAgICAgICAgICBkYXRhID0gc2VsZi5fZGVjb2Rlci5kZWNvbXByZXNzKGRhdGEpCiAgICAgICAgZXhjZXB0IChJT0Vycm9yLCB6bGliLmVycm9yKSBhcyBlOgogICAgICAgICAgICBjb250ZW50X2VuY29kaW5nID0gc2VsZi5oZWFkZXJzLmdldCgnY29udGVudC1lbmNvZGluZycsICcnKS5sb3dlcigpCiAgICAgICAgICAgIHJhaXNlIERlY29kZUVycm9yKAogICAgICAgICAgICAgICAgIlJlY2VpdmVkIHJlc3BvbnNlIHdpdGggY29udGVudC1lbmNvZGluZzogJXMsIGJ1dCAiCiAgICAgICAgICAgICAgICAiZmFpbGVkIHRvIGRlY29kZSBpdC4iICUgY29udGVudF9lbmNvZGluZywgZSkKCiAgICAgICAgaWYgZmx1c2hfZGVjb2RlciBhbmQgZGVjb2RlX2NvbnRlbnQ6CiAgICAgICAgICAgIGRhdGEgKz0gc2VsZi5fZmx1c2hfZGVjb2RlcigpCgogICAgICAgIHJldHVybiBkYXRhCgogICAgZGVmIF9mbHVzaF9kZWNvZGVyKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEZsdXNoZXMgdGhlIGRlY29kZXIuIFNob3VsZCBvbmx5IGJlIGNhbGxlZCBpZiB0aGUgZGVjb2RlciBpcyBhY3R1YWxseQogICAgICAgIGJlaW5nIHVzZWQuCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5fZGVjb2RlcjoKICAgICAgICAgICAgYnVmID0gc2VsZi5fZGVjb2Rlci5kZWNvbXByZXNzKGInJykKICAgICAgICAgICAgcmV0dXJuIGJ1ZiArIHNlbGYuX2RlY29kZXIuZmx1c2goKQoKICAgICAgICByZXR1cm4gYicnCgogICAgQGNvbnRleHRtYW5hZ2VyCiAgICBkZWYgX2Vycm9yX2NhdGNoZXIoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgQ2F0Y2ggbG93LWxldmVsIHB5dGhvbiBleGNlcHRpb25zLCBpbnN0ZWFkIHJlLXJhaXNpbmcgdXJsbGliMwogICAgICAgIHZhcmlhbnRzLCBzbyB0aGF0IGxvdy1sZXZlbCBleGNlcHRpb25zIGFyZSBub3QgbGVha2VkIGluIHRoZQogICAgICAgIGhpZ2gtbGV2ZWwgYXBpLgoKICAgICAgICBPbiBleGl0LCByZWxlYXNlIHRoZSBjb25uZWN0aW9uIGJhY2sgdG8gdGhlIHBvb2wuCiAgICAgICAgIiIiCiAgICAgICAgY2xlYW5fZXhpdCA9IEZhbHNlCgogICAgICAgIHRyeToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgeWllbGQKCiAgICAgICAgICAgIGV4Y2VwdCBTb2NrZXRUaW1lb3V0OgogICAgICAgICAgICAgICAgIyBGSVhNRTogSWRlYWxseSB3ZSdkIGxpa2UgdG8gaW5jbHVkZSB0aGUgdXJsIGluIHRoZSBSZWFkVGltZW91dEVycm9yIGJ1dAogICAgICAgICAgICAgICAgIyB0aGVyZSBpcyB5ZXQgbm8gY2xlYW4gd2F5IHRvIGdldCBhdCBpdCBmcm9tIHRoaXMgY29udGV4dC4KICAgICAgICAgICAgICAgIHJhaXNlIFJlYWRUaW1lb3V0RXJyb3Ioc2VsZi5fcG9vbCwgTm9uZSwgJ1JlYWQgdGltZWQgb3V0LicpCgogICAgICAgICAgICBleGNlcHQgQmFzZVNTTEVycm9yIGFzIGU6CiAgICAgICAgICAgICAgICAjIEZJWE1FOiBJcyB0aGVyZSBhIGJldHRlciB3YXkgdG8gZGlmZmVyZW50aWF0ZSBiZXR3ZWVuIFNTTEVycm9ycz8KICAgICAgICAgICAgICAgIGlmICdyZWFkIG9wZXJhdGlvbiB0aW1lZCBvdXQnIG5vdCBpbiBzdHIoZSk6ICAjIERlZmVuc2l2ZToKICAgICAgICAgICAgICAgICAgICAjIFRoaXMgc2hvdWxkbid0IGhhcHBlbiBidXQganVzdCBpbiBjYXNlIHdlJ3JlIG1pc3NpbmcgYW4gZWRnZQogICAgICAgICAgICAgICAgICAgICMgY2FzZSwgbGV0J3MgYXZvaWQgc3dhbGxvd2luZyBTU0wgZXJyb3JzLgogICAgICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgICAgICAgICAgcmFpc2UgUmVhZFRpbWVvdXRFcnJvcihzZWxmLl9wb29sLCBOb25lLCAnUmVhZCB0aW1lZCBvdXQuJykKCiAgICAgICAgICAgIGV4Y2VwdCAoSFRUUEV4Y2VwdGlvbiwgU29ja2V0RXJyb3IpIGFzIGU6CiAgICAgICAgICAgICAgICAjIFRoaXMgaW5jbHVkZXMgSW5jb21wbGV0ZVJlYWQuCiAgICAgICAgICAgICAgICByYWlzZSBQcm90b2NvbEVycm9yKCdDb25uZWN0aW9uIGJyb2tlbjogJXInICUgZSwgZSkKCiAgICAgICAgICAgICMgSWYgbm8gZXhjZXB0aW9uIGlzIHRocm93biwgd2Ugc2hvdWxkIGF2b2lkIGNsZWFuaW5nIHVwCiAgICAgICAgICAgICMgdW5uZWNlc3NhcmlseS4KICAgICAgICAgICAgY2xlYW5fZXhpdCA9IFRydWUKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICAjIElmIHdlIGRpZG4ndCB0ZXJtaW5hdGUgY2xlYW5seSwgd2UgbmVlZCB0byB0aHJvdyBhd2F5IG91cgogICAgICAgICAgICAjIGNvbm5lY3Rpb24uCiAgICAgICAgICAgIGlmIG5vdCBjbGVhbl9leGl0OgogICAgICAgICAgICAgICAgIyBUaGUgcmVzcG9uc2UgbWF5IG5vdCBiZSBjbG9zZWQgYnV0IHdlJ3JlIG5vdCBnb2luZyB0byB1c2UgaXQKICAgICAgICAgICAgICAgICMgYW55bW9yZSBzbyBjbG9zZSBpdCBub3cgdG8gZW5zdXJlIHRoYXQgdGhlIGNvbm5lY3Rpb24gaXMKICAgICAgICAgICAgICAgICMgcmVsZWFzZWQgYmFjayB0byB0aGUgcG9vbC4KICAgICAgICAgICAgICAgIGlmIHNlbGYuX29yaWdpbmFsX3Jlc3BvbnNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX29yaWdpbmFsX3Jlc3BvbnNlLmNsb3NlKCkKCiAgICAgICAgICAgICAgICAjIENsb3NpbmcgdGhlIHJlc3BvbnNlIG1heSBub3QgYWN0dWFsbHkgYmUgc3VmZmljaWVudCB0byBjbG9zZQogICAgICAgICAgICAgICAgIyBldmVyeXRoaW5nLCBzbyBpZiB3ZSBoYXZlIGEgaG9sZCBvZiB0aGUgY29ubmVjdGlvbiBjbG9zZSB0aGF0CiAgICAgICAgICAgICAgICAjIHRvby4KICAgICAgICAgICAgICAgIGlmIHNlbGYuX2Nvbm5lY3Rpb246CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fY29ubmVjdGlvbi5jbG9zZSgpCgogICAgICAgICAgICAjIElmIHdlIGhvbGQgdGhlIG9yaWdpbmFsIHJlc3BvbnNlIGJ1dCBpdCdzIGNsb3NlZCBub3csIHdlIHNob3VsZAogICAgICAgICAgICAjIHJldHVybiB0aGUgY29ubmVjdGlvbiBiYWNrIHRvIHRoZSBwb29sLgogICAgICAgICAgICBpZiBzZWxmLl9vcmlnaW5hbF9yZXNwb25zZSBhbmQgc2VsZi5fb3JpZ2luYWxfcmVzcG9uc2UuaXNjbG9zZWQoKToKICAgICAgICAgICAgICAgIHNlbGYucmVsZWFzZV9jb25uKCkKCiAgICBkZWYgcmVhZChzZWxmLCBhbXQ9Tm9uZSwgZGVjb2RlX2NvbnRlbnQ9Tm9uZSwgY2FjaGVfY29udGVudD1GYWxzZSk6CiAgICAgICAgIiIiCiAgICAgICAgU2ltaWxhciB0byA6bWV0aDpgaHR0cGxpYi5IVFRQUmVzcG9uc2UucmVhZGAsIGJ1dCB3aXRoIHR3byBhZGRpdGlvbmFsCiAgICAgICAgcGFyYW1ldGVyczogYGBkZWNvZGVfY29udGVudGBgIGFuZCBgYGNhY2hlX2NvbnRlbnRgYC4KCiAgICAgICAgOnBhcmFtIGFtdDoKICAgICAgICAgICAgSG93IG11Y2ggb2YgdGhlIGNvbnRlbnQgdG8gcmVhZC4gSWYgc3BlY2lmaWVkLCBjYWNoaW5nIGlzIHNraXBwZWQKICAgICAgICAgICAgYmVjYXVzZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgdG8gY2FjaGUgcGFydGlhbCBjb250ZW50IGFzIHRoZSBmdWxsCiAgICAgICAgICAgIHJlc3BvbnNlLgoKICAgICAgICA6cGFyYW0gZGVjb2RlX2NvbnRlbnQ6CiAgICAgICAgICAgIElmIFRydWUsIHdpbGwgYXR0ZW1wdCB0byBkZWNvZGUgdGhlIGJvZHkgYmFzZWQgb24gdGhlCiAgICAgICAgICAgICdjb250ZW50LWVuY29kaW5nJyBoZWFkZXIuCgogICAgICAgIDpwYXJhbSBjYWNoZV9jb250ZW50OgogICAgICAgICAgICBJZiBUcnVlLCB3aWxsIHNhdmUgdGhlIHJldHVybmVkIGRhdGEgc3VjaCB0aGF0IHRoZSBzYW1lIHJlc3VsdCBpcwogICAgICAgICAgICByZXR1cm5lZCBkZXNwaXRlIG9mIHRoZSBzdGF0ZSBvZiB0aGUgdW5kZXJseWluZyBmaWxlIG9iamVjdC4gVGhpcwogICAgICAgICAgICBpcyB1c2VmdWwgaWYgeW91IHdhbnQgdGhlIGBgLmRhdGFgYCBwcm9wZXJ0eSB0byBjb250aW51ZSB3b3JraW5nCiAgICAgICAgICAgIGFmdGVyIGhhdmluZyBgYC5yZWFkKClgYCB0aGUgZmlsZSBvYmplY3QuIChPdmVycmlkZGVuIGlmIGBgYW10YGAgaXMKICAgICAgICAgICAgc2V0LikKICAgICAgICAiIiIKICAgICAgICBzZWxmLl9pbml0X2RlY29kZXIoKQogICAgICAgIGlmIGRlY29kZV9jb250ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIGRlY29kZV9jb250ZW50ID0gc2VsZi5kZWNvZGVfY29udGVudAoKICAgICAgICBpZiBzZWxmLl9mcCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgZmx1c2hfZGVjb2RlciA9IEZhbHNlCiAgICAgICAgZGF0YSA9IE5vbmUKCiAgICAgICAgd2l0aCBzZWxmLl9lcnJvcl9jYXRjaGVyKCk6CiAgICAgICAgICAgIGlmIGFtdCBpcyBOb25lOgogICAgICAgICAgICAgICAgIyBjU3RyaW5nSU8gZG9lc24ndCBsaWtlIGFtdD1Ob25lCiAgICAgICAgICAgICAgICBkYXRhID0gc2VsZi5fZnAucmVhZCgpCiAgICAgICAgICAgICAgICBmbHVzaF9kZWNvZGVyID0gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY2FjaGVfY29udGVudCA9IEZhbHNlCiAgICAgICAgICAgICAgICBkYXRhID0gc2VsZi5fZnAucmVhZChhbXQpCiAgICAgICAgICAgICAgICBpZiBhbXQgIT0gMCBhbmQgbm90IGRhdGE6ICAjIFBsYXRmb3JtLXNwZWNpZmljOiBCdWdneSB2ZXJzaW9ucyBvZiBQeXRob24uCiAgICAgICAgICAgICAgICAgICAgIyBDbG9zZSB0aGUgY29ubmVjdGlvbiB3aGVuIG5vIGRhdGEgaXMgcmV0dXJuZWQKICAgICAgICAgICAgICAgICAgICAjCiAgICAgICAgICAgICAgICAgICAgIyBUaGlzIGlzIHJlZHVuZGFudCB0byB3aGF0IGh0dHBsaWIvaHR0cC5jbGllbnQgX3Nob3VsZF8KICAgICAgICAgICAgICAgICAgICAjIGFscmVhZHkgZG8uICBIb3dldmVyLCB2ZXJzaW9ucyBvZiBweXRob24gcmVsZWFzZWQgYmVmb3JlCiAgICAgICAgICAgICAgICAgICAgIyBEZWNlbWJlciAxNSwgMjAxMiAoaHR0cDovL2J1Z3MucHl0aG9uLm9yZy9pc3N1ZTE2Mjk4KSBkbwogICAgICAgICAgICAgICAgICAgICMgbm90IHByb3Blcmx5IGNsb3NlIHRoZSBjb25uZWN0aW9uIGluIGFsbCBjYXNlcy4gVGhlcmUgaXMKICAgICAgICAgICAgICAgICAgICAjIG5vIGhhcm0gaW4gcmVkdW5kYW50bHkgY2FsbGluZyBjbG9zZS4KICAgICAgICAgICAgICAgICAgICBzZWxmLl9mcC5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgZmx1c2hfZGVjb2RlciA9IFRydWUKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmVuZm9yY2VfY29udGVudF9sZW5ndGggYW5kIHNlbGYubGVuZ3RoX3JlbWFpbmluZyBub3QgaW4gKDAsIE5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAjIFRoaXMgaXMgYW4gZWRnZSBjYXNlIHRoYXQgaHR0cGxpYiBmYWlsZWQgdG8gY292ZXIgZHVlCiAgICAgICAgICAgICAgICAgICAgICAgICMgdG8gY29uY2VybnMgb2YgYmFja3dhcmQgY29tcGF0aWJpbGl0eS4gV2UncmUKICAgICAgICAgICAgICAgICAgICAgICAgIyBhZGRyZXNzaW5nIGl0IGhlcmUgdG8gbWFrZSBzdXJlIEluY29tcGxldGVSZWFkIGlzCiAgICAgICAgICAgICAgICAgICAgICAgICMgcmFpc2VkIGR1cmluZyBzdHJlYW1pbmcsIHNvIGFsbCBjYWxscyB3aXRoIGluY29ycmVjdAogICAgICAgICAgICAgICAgICAgICAgICAjIENvbnRlbnQtTGVuZ3RoIGFyZSBjYXVnaHQuCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIEluY29tcGxldGVSZWFkKHNlbGYuX2ZwX2J5dGVzX3JlYWQsIHNlbGYubGVuZ3RoX3JlbWFpbmluZykKCiAgICAgICAgaWYgZGF0YToKICAgICAgICAgICAgc2VsZi5fZnBfYnl0ZXNfcmVhZCArPSBsZW4oZGF0YSkKICAgICAgICAgICAgaWYgc2VsZi5sZW5ndGhfcmVtYWluaW5nIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5sZW5ndGhfcmVtYWluaW5nIC09IGxlbihkYXRhKQoKICAgICAgICAgICAgZGF0YSA9IHNlbGYuX2RlY29kZShkYXRhLCBkZWNvZGVfY29udGVudCwgZmx1c2hfZGVjb2RlcikKCiAgICAgICAgICAgIGlmIGNhY2hlX2NvbnRlbnQ6CiAgICAgICAgICAgICAgICBzZWxmLl9ib2R5ID0gZGF0YQoKICAgICAgICByZXR1cm4gZGF0YQoKICAgIGRlZiBzdHJlYW0oc2VsZiwgYW10PTIqKjE2LCBkZWNvZGVfY29udGVudD1Ob25lKToKICAgICAgICAiIiIKICAgICAgICBBIGdlbmVyYXRvciB3cmFwcGVyIGZvciB0aGUgcmVhZCgpIG1ldGhvZC4gQSBjYWxsIHdpbGwgYmxvY2sgdW50aWwKICAgICAgICBgYGFtdGBgIGJ5dGVzIGhhdmUgYmVlbiByZWFkIGZyb20gdGhlIGNvbm5lY3Rpb24gb3IgdW50aWwgdGhlCiAgICAgICAgY29ubmVjdGlvbiBpcyBjbG9zZWQuCgogICAgICAgIDpwYXJhbSBhbXQ6CiAgICAgICAgICAgIEhvdyBtdWNoIG9mIHRoZSBjb250ZW50IHRvIHJlYWQuIFRoZSBnZW5lcmF0b3Igd2lsbCByZXR1cm4gdXAgdG8KICAgICAgICAgICAgbXVjaCBkYXRhIHBlciBpdGVyYXRpb24sIGJ1dCBtYXkgcmV0dXJuIGxlc3MuIFRoaXMgaXMgcGFydGljdWxhcmx5CiAgICAgICAgICAgIGxpa2VseSB3aGVuIHVzaW5nIGNvbXByZXNzZWQgZGF0YS4gSG93ZXZlciwgdGhlIGVtcHR5IHN0cmluZyB3aWxsCiAgICAgICAgICAgIG5ldmVyIGJlIHJldHVybmVkLgoKICAgICAgICA6cGFyYW0gZGVjb2RlX2NvbnRlbnQ6CiAgICAgICAgICAgIElmIFRydWUsIHdpbGwgYXR0ZW1wdCB0byBkZWNvZGUgdGhlIGJvZHkgYmFzZWQgb24gdGhlCiAgICAgICAgICAgICdjb250ZW50LWVuY29kaW5nJyBoZWFkZXIuCiAgICAgICAgIiIiCiAgICAgICAgaWYgc2VsZi5jaHVua2VkIGFuZCBzZWxmLnN1cHBvcnRzX2NodW5rZWRfcmVhZHMoKToKICAgICAgICAgICAgZm9yIGxpbmUgaW4gc2VsZi5yZWFkX2NodW5rZWQoYW10LCBkZWNvZGVfY29udGVudD1kZWNvZGVfY29udGVudCk6CiAgICAgICAgICAgICAgICB5aWVsZCBsaW5lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgd2hpbGUgbm90IGlzX2ZwX2Nsb3NlZChzZWxmLl9mcCk6CiAgICAgICAgICAgICAgICBkYXRhID0gc2VsZi5yZWFkKGFtdD1hbXQsIGRlY29kZV9jb250ZW50PWRlY29kZV9jb250ZW50KQoKICAgICAgICAgICAgICAgIGlmIGRhdGE6CiAgICAgICAgICAgICAgICAgICAgeWllbGQgZGF0YQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIGZyb21faHR0cGxpYihSZXNwb25zZUNscywgciwgKipyZXNwb25zZV9rdyk6CiAgICAgICAgIiIiCiAgICAgICAgR2l2ZW4gYW4gOmNsYXNzOmBodHRwbGliLkhUVFBSZXNwb25zZWAgaW5zdGFuY2UgYGByYGAsIHJldHVybiBhCiAgICAgICAgY29ycmVzcG9uZGluZyA6Y2xhc3M6YHVybGxpYjMucmVzcG9uc2UuSFRUUFJlc3BvbnNlYCBvYmplY3QuCgogICAgICAgIFJlbWFpbmluZyBwYXJhbWV0ZXJzIGFyZSBwYXNzZWQgdG8gdGhlIEhUVFBSZXNwb25zZSBjb25zdHJ1Y3RvciwgYWxvbmcKICAgICAgICB3aXRoIGBgb3JpZ2luYWxfcmVzcG9uc2U9cmBgLgogICAgICAgICIiIgogICAgICAgIGhlYWRlcnMgPSByLm1zZwoKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShoZWFkZXJzLCBIVFRQSGVhZGVyRGljdCk6CiAgICAgICAgICAgIGlmIFBZMzogICMgUHl0aG9uIDMKICAgICAgICAgICAgICAgIGhlYWRlcnMgPSBIVFRQSGVhZGVyRGljdChoZWFkZXJzLml0ZW1zKCkpCiAgICAgICAgICAgIGVsc2U6ICAjIFB5dGhvbiAyCiAgICAgICAgICAgICAgICBoZWFkZXJzID0gSFRUUEhlYWRlckRpY3QuZnJvbV9odHRwbGliKGhlYWRlcnMpCgogICAgICAgICMgSFRUUFJlc3BvbnNlIG9iamVjdHMgaW4gUHl0aG9uIDMgZG9uJ3QgaGF2ZSBhIC5zdHJpY3QgYXR0cmlidXRlCiAgICAgICAgc3RyaWN0ID0gZ2V0YXR0cihyLCAnc3RyaWN0JywgMCkKICAgICAgICByZXNwID0gUmVzcG9uc2VDbHMoYm9keT1yLAogICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cz1yLnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbj1yLnZlcnNpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYXNvbj1yLnJlYXNvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaWN0PXN0cmljdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxfcmVzcG9uc2U9ciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgKipyZXNwb25zZV9rdykKICAgICAgICByZXR1cm4gcmVzcAoKICAgICMgQmFja3dhcmRzLWNvbXBhdGliaWxpdHkgbWV0aG9kcyBmb3IgaHR0cGxpYi5IVFRQUmVzcG9uc2UKICAgIGRlZiBnZXRoZWFkZXJzKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLmhlYWRlcnMKCiAgICBkZWYgZ2V0aGVhZGVyKHNlbGYsIG5hbWUsIGRlZmF1bHQ9Tm9uZSk6CiAgICAgICAgcmV0dXJuIHNlbGYuaGVhZGVycy5nZXQobmFtZSwgZGVmYXVsdCkKCiAgICAjIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZvciBodHRwLmNvb2tpZWphcgogICAgZGVmIGluZm8oc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuaGVhZGVycwoKICAgICMgT3ZlcnJpZGVzIGZyb20gaW8uSU9CYXNlCiAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgaWYgbm90IHNlbGYuY2xvc2VkOgogICAgICAgICAgICBzZWxmLl9mcC5jbG9zZSgpCgogICAgICAgIGlmIHNlbGYuX2Nvbm5lY3Rpb246CiAgICAgICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24uY2xvc2UoKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNsb3NlZChzZWxmKToKICAgICAgICBpZiBzZWxmLl9mcCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsaWYgaGFzYXR0cihzZWxmLl9mcCwgJ2lzY2xvc2VkJyk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9mcC5pc2Nsb3NlZCgpCiAgICAgICAgZWxpZiBoYXNhdHRyKHNlbGYuX2ZwLCAnY2xvc2VkJyk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9mcC5jbG9zZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBmaWxlbm8oc2VsZik6CiAgICAgICAgaWYgc2VsZi5fZnAgaXMgTm9uZToKICAgICAgICAgICAgcmFpc2UgSU9FcnJvcigiSFRUUFJlc3BvbnNlIGhhcyBubyBmaWxlIHRvIGdldCBhIGZpbGVubyBmcm9tIikKICAgICAgICBlbGlmIGhhc2F0dHIoc2VsZi5fZnAsICJmaWxlbm8iKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2ZwLmZpbGVubygpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgSU9FcnJvcigiVGhlIGZpbGUtbGlrZSBvYmplY3QgdGhpcyBIVFRQUmVzcG9uc2UgaXMgd3JhcHBlZCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgImFyb3VuZCBoYXMgbm8gZmlsZSBkZXNjcmlwdG9yIikKCiAgICBkZWYgZmx1c2goc2VsZik6CiAgICAgICAgaWYgc2VsZi5fZnAgaXMgbm90IE5vbmUgYW5kIGhhc2F0dHIoc2VsZi5fZnAsICdmbHVzaCcpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZnAuZmx1c2goKQoKICAgIGRlZiByZWFkYWJsZShzZWxmKToKICAgICAgICAjIFRoaXMgbWV0aG9kIGlzIHJlcXVpcmVkIGZvciBgaW9gIG1vZHVsZSBjb21wYXRpYmlsaXR5LgogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIHJlYWRpbnRvKHNlbGYsIGIpOgogICAgICAgICMgVGhpcyBtZXRob2QgaXMgcmVxdWlyZWQgZm9yIGBpb2AgbW9kdWxlIGNvbXBhdGliaWxpdHkuCiAgICAgICAgdGVtcCA9IHNlbGYucmVhZChsZW4oYikpCiAgICAgICAgaWYgbGVuKHRlbXApID09IDA6CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYls6bGVuKHRlbXApXSA9IHRlbXAKICAgICAgICAgICAgcmV0dXJuIGxlbih0ZW1wKQoKICAgIGRlZiBzdXBwb3J0c19jaHVua2VkX3JlYWRzKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIENoZWNrcyBpZiB0aGUgdW5kZXJseWluZyBmaWxlLWxpa2Ugb2JqZWN0IGxvb2tzIGxpa2UgYQogICAgICAgIGh0dHBsaWIuSFRUUFJlc3BvbnNlIG9iamVjdC4gV2UgZG8gdGhpcyBieSB0ZXN0aW5nIGZvciB0aGUgZnAKICAgICAgICBhdHRyaWJ1dGUuIElmIGl0IGlzIHByZXNlbnQgd2UgYXNzdW1lIGl0IHJldHVybnMgcmF3IGNodW5rcyBhcwogICAgICAgIHByb2Nlc3NlZCBieSByZWFkX2NodW5rZWQoKS4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gaGFzYXR0cihzZWxmLl9mcCwgJ2ZwJykKCiAgICBkZWYgX3VwZGF0ZV9jaHVua19sZW5ndGgoc2VsZik6CiAgICAgICAgIyBGaXJzdCwgd2UnbGwgZmlndXJlIG91dCBsZW5ndGggb2YgYSBjaHVuayBhbmQgdGhlbgogICAgICAgICMgd2UnbGwgdHJ5IHRvIHJlYWQgaXQgZnJvbSBzb2NrZXQuCiAgICAgICAgaWYgc2VsZi5jaHVua19sZWZ0IGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBsaW5lID0gc2VsZi5fZnAuZnAucmVhZGxpbmUoKQogICAgICAgIGxpbmUgPSBsaW5lLnNwbGl0KGInOycsIDEpWzBdCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmNodW5rX2xlZnQgPSBpbnQobGluZSwgMTYpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICMgSW52YWxpZCBjaHVua2VkIHByb3RvY29sIHJlc3BvbnNlLCBhYm9ydC4KICAgICAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgICAgIHJhaXNlIGh0dHBsaWIuSW5jb21wbGV0ZVJlYWQobGluZSkKCiAgICBkZWYgX2hhbmRsZV9jaHVuayhzZWxmLCBhbXQpOgogICAgICAgIHJldHVybmVkX2NodW5rID0gTm9uZQogICAgICAgIGlmIGFtdCBpcyBOb25lOgogICAgICAgICAgICBjaHVuayA9IHNlbGYuX2ZwLl9zYWZlX3JlYWQoc2VsZi5jaHVua19sZWZ0KQogICAgICAgICAgICByZXR1cm5lZF9jaHVuayA9IGNodW5rCiAgICAgICAgICAgIHNlbGYuX2ZwLl9zYWZlX3JlYWQoMikgICMgVG9zcyB0aGUgQ1JMRiBhdCB0aGUgZW5kIG9mIHRoZSBjaHVuay4KICAgICAgICAgICAgc2VsZi5jaHVua19sZWZ0ID0gTm9uZQogICAgICAgIGVsaWYgYW10IDwgc2VsZi5jaHVua19sZWZ0OgogICAgICAgICAgICB2YWx1ZSA9IHNlbGYuX2ZwLl9zYWZlX3JlYWQoYW10KQogICAgICAgICAgICBzZWxmLmNodW5rX2xlZnQgPSBzZWxmLmNodW5rX2xlZnQgLSBhbXQKICAgICAgICAgICAgcmV0dXJuZWRfY2h1bmsgPSB2YWx1ZQogICAgICAgIGVsaWYgYW10ID09IHNlbGYuY2h1bmtfbGVmdDoKICAgICAgICAgICAgdmFsdWUgPSBzZWxmLl9mcC5fc2FmZV9yZWFkKGFtdCkKICAgICAgICAgICAgc2VsZi5fZnAuX3NhZmVfcmVhZCgyKSAgIyBUb3NzIHRoZSBDUkxGIGF0IHRoZSBlbmQgb2YgdGhlIGNodW5rLgogICAgICAgICAgICBzZWxmLmNodW5rX2xlZnQgPSBOb25lCiAgICAgICAgICAgIHJldHVybmVkX2NodW5rID0gdmFsdWUKICAgICAgICBlbHNlOiAgIyBhbXQgPiBzZWxmLmNodW5rX2xlZnQKICAgICAgICAgICAgcmV0dXJuZWRfY2h1bmsgPSBzZWxmLl9mcC5fc2FmZV9yZWFkKHNlbGYuY2h1bmtfbGVmdCkKICAgICAgICAgICAgc2VsZi5fZnAuX3NhZmVfcmVhZCgyKSAgIyBUb3NzIHRoZSBDUkxGIGF0IHRoZSBlbmQgb2YgdGhlIGNodW5rLgogICAgICAgICAgICBzZWxmLmNodW5rX2xlZnQgPSBOb25lCiAgICAgICAgcmV0dXJuIHJldHVybmVkX2NodW5rCgogICAgZGVmIHJlYWRfY2h1bmtlZChzZWxmLCBhbXQ9Tm9uZSwgZGVjb2RlX2NvbnRlbnQ9Tm9uZSk6CiAgICAgICAgIiIiCiAgICAgICAgU2ltaWxhciB0byA6bWV0aDpgSFRUUFJlc3BvbnNlLnJlYWRgLCBidXQgd2l0aCBhbiBhZGRpdGlvbmFsCiAgICAgICAgcGFyYW1ldGVyOiBgYGRlY29kZV9jb250ZW50YGAuCgogICAgICAgIDpwYXJhbSBhbXQ6CiAgICAgICAgICAgIEhvdyBtdWNoIG9mIHRoZSBjb250ZW50IHRvIHJlYWQuIElmIHNwZWNpZmllZCwgY2FjaGluZyBpcyBza2lwcGVkCiAgICAgICAgICAgIGJlY2F1c2UgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNhY2hlIHBhcnRpYWwgY29udGVudCBhcyB0aGUgZnVsbAogICAgICAgICAgICByZXNwb25zZS4KCiAgICAgICAgOnBhcmFtIGRlY29kZV9jb250ZW50OgogICAgICAgICAgICBJZiBUcnVlLCB3aWxsIGF0dGVtcHQgdG8gZGVjb2RlIHRoZSBib2R5IGJhc2VkIG9uIHRoZQogICAgICAgICAgICAnY29udGVudC1lbmNvZGluZycgaGVhZGVyLgogICAgICAgICIiIgogICAgICAgIHNlbGYuX2luaXRfZGVjb2RlcigpCiAgICAgICAgIyBGSVhNRTogUmV3cml0ZSB0aGlzIG1ldGhvZCBhbmQgbWFrZSBpdCBhIGNsYXNzIHdpdGggYSBiZXR0ZXIgc3RydWN0dXJlZCBsb2dpYy4KICAgICAgICBpZiBub3Qgc2VsZi5jaHVua2VkOgogICAgICAgICAgICByYWlzZSBSZXNwb25zZU5vdENodW5rZWQoCiAgICAgICAgICAgICAgICAiUmVzcG9uc2UgaXMgbm90IGNodW5rZWQuICIKICAgICAgICAgICAgICAgICJIZWFkZXIgJ3RyYW5zZmVyLWVuY29kaW5nOiBjaHVua2VkJyBpcyBtaXNzaW5nLiIpCiAgICAgICAgaWYgbm90IHNlbGYuc3VwcG9ydHNfY2h1bmtlZF9yZWFkcygpOgogICAgICAgICAgICByYWlzZSBCb2R5Tm90SHR0cGxpYkNvbXBhdGlibGUoCiAgICAgICAgICAgICAgICAiQm9keSBzaG91bGQgYmUgaHR0cGxpYi5IVFRQUmVzcG9uc2UgbGlrZS4gIgogICAgICAgICAgICAgICAgIkl0IHNob3VsZCBoYXZlIGhhdmUgYW4gZnAgYXR0cmlidXRlIHdoaWNoIHJldHVybnMgcmF3IGNodW5rcy4iKQoKICAgICAgICB3aXRoIHNlbGYuX2Vycm9yX2NhdGNoZXIoKToKICAgICAgICAgICAgIyBEb24ndCBib3RoZXIgcmVhZGluZyB0aGUgYm9keSBvZiBhIEhFQUQgcmVxdWVzdC4KICAgICAgICAgICAgaWYgc2VsZi5fb3JpZ2luYWxfcmVzcG9uc2UgYW5kIGlzX3Jlc3BvbnNlX3RvX2hlYWQoc2VsZi5fb3JpZ2luYWxfcmVzcG9uc2UpOgogICAgICAgICAgICAgICAgc2VsZi5fb3JpZ2luYWxfcmVzcG9uc2UuY2xvc2UoKQogICAgICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICAgICAjIElmIGEgcmVzcG9uc2UgaXMgYWxyZWFkeSByZWFkIGFuZCBjbG9zZWQKICAgICAgICAgICAgIyB0aGVuIHJldHVybiBpbW1lZGlhdGVseS4KICAgICAgICAgICAgaWYgc2VsZi5fZnAuZnAgaXMgTm9uZToKICAgICAgICAgICAgICAgIHJldHVybgoKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgIHNlbGYuX3VwZGF0ZV9jaHVua19sZW5ndGgoKQogICAgICAgICAgICAgICAgaWYgc2VsZi5jaHVua19sZWZ0ID09IDA6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGNodW5rID0gc2VsZi5faGFuZGxlX2NodW5rKGFtdCkKICAgICAgICAgICAgICAgIGRlY29kZWQgPSBzZWxmLl9kZWNvZGUoY2h1bmssIGRlY29kZV9jb250ZW50PWRlY29kZV9jb250ZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbHVzaF9kZWNvZGVyPUZhbHNlKQogICAgICAgICAgICAgICAgaWYgZGVjb2RlZDoKICAgICAgICAgICAgICAgICAgICB5aWVsZCBkZWNvZGVkCgogICAgICAgICAgICBpZiBkZWNvZGVfY29udGVudDoKICAgICAgICAgICAgICAgICMgT24gQ1B5dGhvbiBhbmQgUHlQeSwgd2Ugc2hvdWxkIG5ldmVyIG5lZWQgdG8gZmx1c2ggdGhlCiAgICAgICAgICAgICAgICAjIGRlY29kZXIuIEhvd2V2ZXIsIG9uIEp5dGhvbiB3ZSAqbWlnaHQqIG5lZWQgdG8sIHNvCiAgICAgICAgICAgICAgICAjIGxldHMgZGVmZW5zaXZlbHkgZG8gaXQgYW55d2F5LgogICAgICAgICAgICAgICAgZGVjb2RlZCA9IHNlbGYuX2ZsdXNoX2RlY29kZXIoKQogICAgICAgICAgICAgICAgaWYgZGVjb2RlZDogICMgUGxhdGZvcm0tc3BlY2lmaWM6IEp5dGhvbi4KICAgICAgICAgICAgICAgICAgICB5aWVsZCBkZWNvZGVkCgogICAgICAgICAgICAjIENodW5rIGNvbnRlbnQgZW5kcyB3aXRoIFxyXG46IGRpc2NhcmQgaXQuCiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICBsaW5lID0gc2VsZi5fZnAuZnAucmVhZGxpbmUoKQogICAgICAgICAgICAgICAgaWYgbm90IGxpbmU6CiAgICAgICAgICAgICAgICAgICAgIyBTb21lIHNpdGVzIG1heSBub3QgZW5kIHdpdGggJ1xyXG4nLgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBpZiBsaW5lID09IGInXHJcbic6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgICMgV2UgcmVhZCBldmVyeXRoaW5nOyBjbG9zZSB0aGUgImZpbGUiLgogICAgICAgICAgICBpZiBzZWxmLl9vcmlnaW5hbF9yZXNwb25zZToKICAgICAgICAgICAgICAgIHNlbGYuX29yaWdpbmFsX3Jlc3BvbnNlLmNsb3NlKCkKCiAgICBkZWYgZ2V0dXJsKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIFJldHVybnMgdGhlIFVSTCB0aGF0IHdhcyB0aGUgc291cmNlIG9mIHRoaXMgcmVzcG9uc2UuCiAgICAgICAgSWYgdGhlIHJlcXVlc3QgdGhhdCBnZW5lcmF0ZWQgdGhpcyByZXNwb25zZSByZWRpcmVjdGVkLCB0aGlzIG1ldGhvZAogICAgICAgIHdpbGwgcmV0dXJuIHRoZSBmaW5hbCByZWRpcmVjdCBsb2NhdGlvbi4KICAgICAgICAiIiIKICAgICAgICBpZiBzZWxmLnJldHJpZXMgaXMgbm90IE5vbmUgYW5kIGxlbihzZWxmLnJldHJpZXMuaGlzdG9yeSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnJldHJpZXMuaGlzdG9yeVstMV0ucmVkaXJlY3RfbG9jYXRpb24KICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVxdWVzdF91cmwK
