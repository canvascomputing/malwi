statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_tls.py
  contents:
  - name: get_dh_params_length
    score: 0.0
    code: |-
      def get_dh_params_length(server_handshake_bytes):
          """
          Determines the length of the DH params from the ServerKeyExchange

          :param server_handshake_bytes:
              A byte string of the handshake data received from the server

          :return:
              None or an integer of the bit size of the DH parameters
          """

          output = None

          dh_params_bytes = None

          for record_type, _, record_data in parse_tls_records(server_handshake_bytes):
              if record_type != b'\x16':
                  continue
              for message_type, message_data in parse_handshake_messages(record_data):
                  if message_type == b'\x0c':
                      dh_params_bytes = message_data
                      break
              if dh_params_bytes:
                  break

          if dh_params_bytes:
              output = int_from_bytes(dh_params_bytes[0:2]) * 8

          return output
    tokens: resume load_const store_fast output load_const store_fast dh_params_bytes load_global STRING_LEN_S_ENT_HIGH load_fast STRING_LEN_S_ENT_HIGH call get_iter for_iter TO_NUMBER unpack_sequence store_fast record_type store_fast _ store_fast record_data load_fast record_type load_const compare_op != pop_jump_if_false TO_NUMBER jump_backward TO_NUMBER load_global STRING_LEN_S_ENT_HIGH load_fast record_data call get_iter for_iter TO_NUMBER unpack_sequence store_fast message_type store_fast message_data load_fast message_type load_const compare_op == pop_jump_if_true TO_NUMBER jump_backward TO_NUMBER load_fast message_data store_fast dh_params_bytes pop_top jump_forward TO_NUMBER end_for load_fast dh_params_bytes pop_jump_if_true TO_NUMBER jump_backward TO_NUMBER pop_top jump_forward TO_NUMBER end_for load_fast dh_params_bytes pop_jump_if_false TO_NUMBER load_global int_from_bytes load_fast dh_params_bytes load_const INTEGER load_const INTEGER binary_slice call load_const INTEGER binary_op * store_fast output load_fast output return_value
    hash: 228069cd2416982fb74657159ee47d8ed6046de448acf4d0a4fd6117ccbcd076
sources:
  .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_tls.py: IyBjb2Rpbmc6IHV0Zi04CmZyb20gX19mdXR1cmVfXyBpbXBvcnQgdW5pY29kZV9saXRlcmFscywgZGl2aXNpb24sIGFic29sdXRlX2ltcG9ydCwgcHJpbnRfZnVuY3Rpb24KCmltcG9ydCByZQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQoKZnJvbSAuX2FzbjEgaW1wb3J0IENlcnRpZmljYXRlLCBpbnRfZnJvbV9ieXRlcywgdGltZXpvbmUKZnJvbSAuX2NpcGhlcl9zdWl0ZXMgaW1wb3J0IENJUEhFUl9TVUlURV9NQVAKZnJvbSAuZXJyb3JzIGltcG9ydCBUTFNWZXJpZmljYXRpb25FcnJvciwgVExTRGlzY29ubmVjdEVycm9yLCBUTFNFcnJvcgoKCl9fYWxsX18gPSBbCiAgICAnZGV0ZWN0X2NsaWVudF9hdXRoX3JlcXVlc3QnLAogICAgJ2V4dHJhY3RfY2hhaW4nLAogICAgJ2dldF9kaF9wYXJhbXNfbGVuZ3RoJywKICAgICdwYXJzZV9hbGVydCcsCiAgICAncGFyc2VfaGFuZHNoYWtlX21lc3NhZ2VzJywKICAgICdwYXJzZV9zZXNzaW9uX2luZm8nLAogICAgJ3BhcnNlX3Rsc19yZWNvcmRzJywKICAgICdyYWlzZV9jbGllbnRfYXV0aCcsCiAgICAncmFpc2VfZGhfcGFyYW1zJywKICAgICdyYWlzZV9kaXNjb25uZWN0aW9uJywKICAgICdyYWlzZV9leHBpcmVkX25vdF95ZXRfdmFsaWQnLAogICAgJ3JhaXNlX2hhbmRzaGFrZScsCiAgICAncmFpc2VfaG9zdG5hbWUnLAogICAgJ3JhaXNlX25vX2lzc3VlcicsCiAgICAncmFpc2VfcHJvdG9jb2xfZXJyb3InLAogICAgJ3JhaXNlX3Jldm9rZWQnLAogICAgJ3JhaXNlX3NlbGZfc2lnbmVkJywKICAgICdyYWlzZV92ZXJpZmljYXRpb24nLAogICAgJ3JhaXNlX3dlYWtfc2lnbmF0dXJlJywKXQoKCmRlZiBleHRyYWN0X2NoYWluKHNlcnZlcl9oYW5kc2hha2VfYnl0ZXMpOgogICAgIiIiCiAgICBFeHRyYWN0cyB0aGUgWC41MDkgY2VydGlmaWNhdGVzIGZyb20gdGhlIHNlcnZlciBoYW5kc2hha2UgYnl0ZXMgZm9yIHVzZQogICAgd2hlbiBkZWJ1Z2dpbmcKCiAgICA6cGFyYW0gc2VydmVyX2hhbmRzaGFrZV9ieXRlczoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBoYW5kc2hha2UgZGF0YSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIKCiAgICA6cmV0dXJuOgogICAgICAgIEEgbGlzdCBvZiBhc24xY3J5cHRvLng1MDkuQ2VydGlmaWNhdGUgb2JqZWN0cwogICAgIiIiCgogICAgb3V0cHV0ID0gW10KCiAgICBjaGFpbl9ieXRlcyA9IE5vbmUKCiAgICBmb3IgcmVjb3JkX3R5cGUsIF8sIHJlY29yZF9kYXRhIGluIHBhcnNlX3Rsc19yZWNvcmRzKHNlcnZlcl9oYW5kc2hha2VfYnl0ZXMpOgogICAgICAgIGlmIHJlY29yZF90eXBlICE9IGInXHgxNic6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZm9yIG1lc3NhZ2VfdHlwZSwgbWVzc2FnZV9kYXRhIGluIHBhcnNlX2hhbmRzaGFrZV9tZXNzYWdlcyhyZWNvcmRfZGF0YSk6CiAgICAgICAgICAgIGlmIG1lc3NhZ2VfdHlwZSA9PSBiJ1x4MGInOgogICAgICAgICAgICAgICAgY2hhaW5fYnl0ZXMgPSBtZXNzYWdlX2RhdGEKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYgY2hhaW5fYnl0ZXM6CiAgICAgICAgICAgIGJyZWFrCgogICAgaWYgY2hhaW5fYnl0ZXM6CiAgICAgICAgIyBUaGUgZmlyc3QgMyBieXRlcyBhcmUgdGhlIGNlcnQgY2hhaW4gbGVuZ3RoCiAgICAgICAgcG9pbnRlciA9IDMKICAgICAgICB3aGlsZSBwb2ludGVyIDwgbGVuKGNoYWluX2J5dGVzKToKICAgICAgICAgICAgY2VydF9sZW5ndGggPSBpbnRfZnJvbV9ieXRlcyhjaGFpbl9ieXRlc1twb2ludGVyOnBvaW50ZXIgKyAzXSkKICAgICAgICAgICAgY2VydF9zdGFydCA9IHBvaW50ZXIgKyAzCiAgICAgICAgICAgIGNlcnRfZW5kID0gY2VydF9zdGFydCArIGNlcnRfbGVuZ3RoCiAgICAgICAgICAgIHBvaW50ZXIgPSBjZXJ0X2VuZAogICAgICAgICAgICBjZXJ0X2J5dGVzID0gY2hhaW5fYnl0ZXNbY2VydF9zdGFydDpjZXJ0X2VuZF0KICAgICAgICAgICAgb3V0cHV0LmFwcGVuZChDZXJ0aWZpY2F0ZS5sb2FkKGNlcnRfYnl0ZXMpKQoKICAgIHJldHVybiBvdXRwdXQKCgpkZWYgZGV0ZWN0X2NsaWVudF9hdXRoX3JlcXVlc3Qoc2VydmVyX2hhbmRzaGFrZV9ieXRlcyk6CiAgICAiIiIKICAgIERldGVybWluZXMgaWYgYSBDZXJ0aWZpY2F0ZVJlcXVlc3QgbWVzc2FnZSBpcyBzZW50IGZyb20gdGhlIHNlcnZlciBhc2tpbmcKICAgIHRoZSBjbGllbnQgZm9yIGEgY2VydGlmaWNhdGUKCiAgICA6cGFyYW0gc2VydmVyX2hhbmRzaGFrZV9ieXRlczoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBoYW5kc2hha2UgZGF0YSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYm9vbGVhbiAtIGlmIGEgY2xpZW50IGNlcnRpZmljYXRlIHJlcXVlc3Qgd2FzIGZvdW5kCiAgICAiIiIKCiAgICBmb3IgcmVjb3JkX3R5cGUsIF8sIHJlY29yZF9kYXRhIGluIHBhcnNlX3Rsc19yZWNvcmRzKHNlcnZlcl9oYW5kc2hha2VfYnl0ZXMpOgogICAgICAgIGlmIHJlY29yZF90eXBlICE9IGInXHgxNic6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZm9yIG1lc3NhZ2VfdHlwZSwgbWVzc2FnZV9kYXRhIGluIHBhcnNlX2hhbmRzaGFrZV9tZXNzYWdlcyhyZWNvcmRfZGF0YSk6CiAgICAgICAgICAgIGlmIG1lc3NhZ2VfdHlwZSA9PSBiJ1x4MGQnOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgIHJldHVybiBGYWxzZQoKCmRlZiBnZXRfZGhfcGFyYW1zX2xlbmd0aChzZXJ2ZXJfaGFuZHNoYWtlX2J5dGVzKToKICAgICIiIgogICAgRGV0ZXJtaW5lcyB0aGUgbGVuZ3RoIG9mIHRoZSBESCBwYXJhbXMgZnJvbSB0aGUgU2VydmVyS2V5RXhjaGFuZ2UKCiAgICA6cGFyYW0gc2VydmVyX2hhbmRzaGFrZV9ieXRlczoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBoYW5kc2hha2UgZGF0YSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIKCiAgICA6cmV0dXJuOgogICAgICAgIE5vbmUgb3IgYW4gaW50ZWdlciBvZiB0aGUgYml0IHNpemUgb2YgdGhlIERIIHBhcmFtZXRlcnMKICAgICIiIgoKICAgIG91dHB1dCA9IE5vbmUKCiAgICBkaF9wYXJhbXNfYnl0ZXMgPSBOb25lCgogICAgZm9yIHJlY29yZF90eXBlLCBfLCByZWNvcmRfZGF0YSBpbiBwYXJzZV90bHNfcmVjb3JkcyhzZXJ2ZXJfaGFuZHNoYWtlX2J5dGVzKToKICAgICAgICBpZiByZWNvcmRfdHlwZSAhPSBiJ1x4MTYnOgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGZvciBtZXNzYWdlX3R5cGUsIG1lc3NhZ2VfZGF0YSBpbiBwYXJzZV9oYW5kc2hha2VfbWVzc2FnZXMocmVjb3JkX2RhdGEpOgogICAgICAgICAgICBpZiBtZXNzYWdlX3R5cGUgPT0gYidceDBjJzoKICAgICAgICAgICAgICAgIGRoX3BhcmFtc19ieXRlcyA9IG1lc3NhZ2VfZGF0YQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBpZiBkaF9wYXJhbXNfYnl0ZXM6CiAgICAgICAgICAgIGJyZWFrCgogICAgaWYgZGhfcGFyYW1zX2J5dGVzOgogICAgICAgIG91dHB1dCA9IGludF9mcm9tX2J5dGVzKGRoX3BhcmFtc19ieXRlc1swOjJdKSAqIDgKCiAgICByZXR1cm4gb3V0cHV0CgoKZGVmIHBhcnNlX2FsZXJ0KHNlcnZlcl9oYW5kc2hha2VfYnl0ZXMpOgogICAgIiIiCiAgICBQYXJzZXMgdGhlIGhhbmRzaGFrZSBmb3IgcHJvdG9jb2wgYWxlcnRzCgogICAgOnBhcmFtIHNlcnZlcl9oYW5kc2hha2VfYnl0ZXM6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgaGFuZHNoYWtlIGRhdGEgcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyCgogICAgOnJldHVybjoKICAgICAgICBOb25lIG9yIGFuIDItZWxlbWVudCB0dXBsZSBvZiBpbnRlZ2VyczoKICAgICAgICAgMDogMSAod2FybmluZykgb3IgMiAoZmF0YWwpCiAgICAgICAgIDE6IFRoZSBhbGVydCBkZXNjcmlwdGlvbiAoc2VlIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmM1MjQ2I3NlY3Rpb24tNy4yKQogICAgIiIiCgogICAgZm9yIHJlY29yZF90eXBlLCBfLCByZWNvcmRfZGF0YSBpbiBwYXJzZV90bHNfcmVjb3JkcyhzZXJ2ZXJfaGFuZHNoYWtlX2J5dGVzKToKICAgICAgICBpZiByZWNvcmRfdHlwZSAhPSBiJ1x4MTUnOgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGlmIGxlbihyZWNvcmRfZGF0YSkgIT0gMjoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICByZXR1cm4gKGludF9mcm9tX2J5dGVzKHJlY29yZF9kYXRhWzA6MV0pLCBpbnRfZnJvbV9ieXRlcyhyZWNvcmRfZGF0YVsxOjJdKSkKICAgIHJldHVybiBOb25lCgoKZGVmIHBhcnNlX3Nlc3Npb25faW5mbyhzZXJ2ZXJfaGFuZHNoYWtlX2J5dGVzLCBjbGllbnRfaGFuZHNoYWtlX2J5dGVzKToKICAgICIiIgogICAgUGFyc2UgdGhlIFRMUyBoYW5kc2hha2UgZnJvbSB0aGUgY2xpZW50IHRvIHRoZSBzZXJ2ZXIgdG8gZXh0cmFjdCBpbmZvcm1hdGlvbgogICAgaW5jbHVkaW5nIHRoZSBjaXBoZXIgc3VpdGUgc2VsZWN0ZWQsIGlmIGNvbXByZXNzaW9uIGlzIGVuYWJsZWQsIHRoZQogICAgc2Vzc2lvbiBpZCBhbmQgaWYgYSBuZXcgb3IgcmV1c2VkIHNlc3Npb24gdGlja2V0IGV4aXN0cy4KCiAgICA6cGFyYW0gc2VydmVyX2hhbmRzaGFrZV9ieXRlczoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBoYW5kc2hha2UgZGF0YSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIKCiAgICA6cGFyYW0gY2xpZW50X2hhbmRzaGFrZV9ieXRlczoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBoYW5kc2hha2UgZGF0YSBzZW50IHRvIHRoZSBzZXJ2ZXIKCiAgICA6cmV0dXJuOgogICAgICAgIEEgZGljdCB3aXRoIHRoZSBmb2xsb3dpbmcga2V5czoKICAgICAgICAgLSAicHJvdG9jb2wiOiB1bmljb2RlIHN0cmluZwogICAgICAgICAtICJjaXBoZXJfc3VpdGUiOiB1bmljb2RlIHN0cmluZwogICAgICAgICAtICJjb21wcmVzc2lvbiI6IGJvb2xlYW4KICAgICAgICAgLSAic2Vzc2lvbl9pZCI6ICJuZXciLCAicmV1c2VkIiBvciBOb25lCiAgICAgICAgIC0gInNlc3Npb25fdGlja2V0OiAibmV3IiwgInJldXNlZCIgb3IgTm9uZQogICAgIiIiCgogICAgcHJvdG9jb2wgPSBOb25lCiAgICBjaXBoZXJfc3VpdGUgPSBOb25lCiAgICBjb21wcmVzc2lvbiA9IEZhbHNlCiAgICBzZXNzaW9uX2lkID0gTm9uZQogICAgc2Vzc2lvbl90aWNrZXQgPSBOb25lCgogICAgc2VydmVyX3Nlc3Npb25faWQgPSBOb25lCiAgICBjbGllbnRfc2Vzc2lvbl9pZCA9IE5vbmUKCiAgICBmb3IgcmVjb3JkX3R5cGUsIF8sIHJlY29yZF9kYXRhIGluIHBhcnNlX3Rsc19yZWNvcmRzKHNlcnZlcl9oYW5kc2hha2VfYnl0ZXMpOgogICAgICAgIGlmIHJlY29yZF90eXBlICE9IGInXHgxNic6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZm9yIG1lc3NhZ2VfdHlwZSwgbWVzc2FnZV9kYXRhIGluIHBhcnNlX2hhbmRzaGFrZV9tZXNzYWdlcyhyZWNvcmRfZGF0YSk6CiAgICAgICAgICAgICMgRW5zdXJlIHdlIGFyZSB3b3JraW5nIHdpdGggYSBTZXJ2ZXJIZWxsbyBtZXNzYWdlCiAgICAgICAgICAgIGlmIG1lc3NhZ2VfdHlwZSAhPSBiJ1x4MDInOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgcHJvdG9jb2wgPSB7CiAgICAgICAgICAgICAgICBiJ1x4MDNceDAwJzogIlNTTHYzIiwKICAgICAgICAgICAgICAgIGInXHgwM1x4MDEnOiAiVExTdjEiLAogICAgICAgICAgICAgICAgYidceDAzXHgwMic6ICJUTFN2MS4xIiwKICAgICAgICAgICAgICAgIGInXHgwM1x4MDMnOiAiVExTdjEuMiIsCiAgICAgICAgICAgICAgICBiJ1x4MDNceDA0JzogIlRMU3YxLjMiLAogICAgICAgICAgICB9W21lc3NhZ2VfZGF0YVswOjJdXQoKICAgICAgICAgICAgc2Vzc2lvbl9pZF9sZW5ndGggPSBpbnRfZnJvbV9ieXRlcyhtZXNzYWdlX2RhdGFbMzQ6MzVdKQogICAgICAgICAgICBpZiBzZXNzaW9uX2lkX2xlbmd0aCA+IDA6CiAgICAgICAgICAgICAgICBzZXJ2ZXJfc2Vzc2lvbl9pZCA9IG1lc3NhZ2VfZGF0YVszNTozNSArIHNlc3Npb25faWRfbGVuZ3RoXQoKICAgICAgICAgICAgY2lwaGVyX3N1aXRlX3N0YXJ0ID0gMzUgKyBzZXNzaW9uX2lkX2xlbmd0aAogICAgICAgICAgICBjaXBoZXJfc3VpdGVfYnl0ZXMgPSBtZXNzYWdlX2RhdGFbY2lwaGVyX3N1aXRlX3N0YXJ0OmNpcGhlcl9zdWl0ZV9zdGFydCArIDJdCiAgICAgICAgICAgIGNpcGhlcl9zdWl0ZSA9IENJUEhFUl9TVUlURV9NQVBbY2lwaGVyX3N1aXRlX2J5dGVzXQoKICAgICAgICAgICAgY29tcHJlc3Npb25fc3RhcnQgPSBjaXBoZXJfc3VpdGVfc3RhcnQgKyAyCiAgICAgICAgICAgIGNvbXByZXNzaW9uID0gbWVzc2FnZV9kYXRhW2NvbXByZXNzaW9uX3N0YXJ0OmNvbXByZXNzaW9uX3N0YXJ0ICsgMV0gIT0gYidceDAwJwoKICAgICAgICAgICAgZXh0ZW5zaW9uc19sZW5ndGhfc3RhcnQgPSBjb21wcmVzc2lvbl9zdGFydCArIDEKICAgICAgICAgICAgZXh0ZW5zaW9uc19kYXRhID0gbWVzc2FnZV9kYXRhW2V4dGVuc2lvbnNfbGVuZ3RoX3N0YXJ0Ol0KICAgICAgICAgICAgZm9yIGV4dGVuc2lvbl90eXBlLCBleHRlbnNpb25fZGF0YSBpbiBfcGFyc2VfaGVsbG9fZXh0ZW5zaW9ucyhleHRlbnNpb25zX2RhdGEpOgogICAgICAgICAgICAgICAgaWYgZXh0ZW5zaW9uX3R5cGUgPT0gMzU6CiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl90aWNrZXQgPSAibmV3IgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGJyZWFrCgogICAgZm9yIHJlY29yZF90eXBlLCBfLCByZWNvcmRfZGF0YSBpbiBwYXJzZV90bHNfcmVjb3JkcyhjbGllbnRfaGFuZHNoYWtlX2J5dGVzKToKICAgICAgICBpZiByZWNvcmRfdHlwZSAhPSBiJ1x4MTYnOgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGZvciBtZXNzYWdlX3R5cGUsIG1lc3NhZ2VfZGF0YSBpbiBwYXJzZV9oYW5kc2hha2VfbWVzc2FnZXMocmVjb3JkX2RhdGEpOgogICAgICAgICAgICAjIEVuc3VyZSB3ZSBhcmUgd29ya2luZyB3aXRoIGEgQ2xpZW50SGVsbG8gbWVzc2FnZQogICAgICAgICAgICBpZiBtZXNzYWdlX3R5cGUgIT0gYidceDAxJzoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBzZXNzaW9uX2lkX2xlbmd0aCA9IGludF9mcm9tX2J5dGVzKG1lc3NhZ2VfZGF0YVszNDozNV0pCiAgICAgICAgICAgIGlmIHNlc3Npb25faWRfbGVuZ3RoID4gMDoKICAgICAgICAgICAgICAgIGNsaWVudF9zZXNzaW9uX2lkID0gbWVzc2FnZV9kYXRhWzM1OjM1ICsgc2Vzc2lvbl9pZF9sZW5ndGhdCgogICAgICAgICAgICBjaXBoZXJfc3VpdGVfc3RhcnQgPSAzNSArIHNlc3Npb25faWRfbGVuZ3RoCiAgICAgICAgICAgIGNpcGhlcl9zdWl0ZV9sZW5ndGggPSBpbnRfZnJvbV9ieXRlcyhtZXNzYWdlX2RhdGFbY2lwaGVyX3N1aXRlX3N0YXJ0OmNpcGhlcl9zdWl0ZV9zdGFydCArIDJdKQoKICAgICAgICAgICAgY29tcHJlc3Npb25fc3RhcnQgPSBjaXBoZXJfc3VpdGVfc3RhcnQgKyAyICsgY2lwaGVyX3N1aXRlX2xlbmd0aAogICAgICAgICAgICBjb21wcmVzc2lvbl9sZW5ndGggPSBpbnRfZnJvbV9ieXRlcyhtZXNzYWdlX2RhdGFbY29tcHJlc3Npb25fc3RhcnQ6Y29tcHJlc3Npb25fc3RhcnQgKyAxXSkKCiAgICAgICAgICAgICMgT24gc3Vic2VxdWVudCByZXF1ZXN0cywgdGhlIHNlc3Npb24gdGlja2V0IHdpbGwgb25seSBiZSBzZWVuCiAgICAgICAgICAgICMgaW4gdGhlIENsaWVudEhlbGxvIG1lc3NhZ2UKICAgICAgICAgICAgaWYgc2VydmVyX3Nlc3Npb25faWQgaXMgTm9uZSBhbmQgc2Vzc2lvbl90aWNrZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgIGV4dGVuc2lvbnNfbGVuZ3RoX3N0YXJ0ID0gY29tcHJlc3Npb25fc3RhcnQgKyAxICsgY29tcHJlc3Npb25fbGVuZ3RoCiAgICAgICAgICAgICAgICBleHRlbnNpb25zX2RhdGEgPSBtZXNzYWdlX2RhdGFbZXh0ZW5zaW9uc19sZW5ndGhfc3RhcnQ6XQogICAgICAgICAgICAgICAgZm9yIGV4dGVuc2lvbl90eXBlLCBleHRlbnNpb25fZGF0YSBpbiBfcGFyc2VfaGVsbG9fZXh0ZW5zaW9ucyhleHRlbnNpb25zX2RhdGEpOgogICAgICAgICAgICAgICAgICAgIGlmIGV4dGVuc2lvbl90eXBlID09IDM1OgogICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX3RpY2tldCA9ICJyZXVzZWQiCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGJyZWFrCgogICAgaWYgc2VydmVyX3Nlc3Npb25faWQgaXMgbm90IE5vbmU6CiAgICAgICAgaWYgY2xpZW50X3Nlc3Npb25faWQgaXMgTm9uZToKICAgICAgICAgICAgc2Vzc2lvbl9pZCA9ICJuZXciCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgY2xpZW50X3Nlc3Npb25faWQgIT0gc2VydmVyX3Nlc3Npb25faWQ6CiAgICAgICAgICAgICAgICBzZXNzaW9uX2lkID0gIm5ldyIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlc3Npb25faWQgPSAicmV1c2VkIgoKICAgIHJldHVybiB7CiAgICAgICAgInByb3RvY29sIjogcHJvdG9jb2wsCiAgICAgICAgImNpcGhlcl9zdWl0ZSI6IGNpcGhlcl9zdWl0ZSwKICAgICAgICAiY29tcHJlc3Npb24iOiBjb21wcmVzc2lvbiwKICAgICAgICAic2Vzc2lvbl9pZCI6IHNlc3Npb25faWQsCiAgICAgICAgInNlc3Npb25fdGlja2V0Ijogc2Vzc2lvbl90aWNrZXQsCiAgICB9CgoKZGVmIHBhcnNlX3Rsc19yZWNvcmRzKGRhdGEpOgogICAgIiIiCiAgICBDcmVhdGVzIGEgZ2VuZXJhdG9yIHJldHVybmluZyB0dXBsZXMgb2YgaW5mb3JtYXRpb24gYWJvdXQgZWFjaCByZWNvcmQKICAgIGluIGEgYnl0ZSBzdHJpbmcgb2YgZGF0YSBmcm9tIGEgVExTIGNsaWVudCBvciBzZXJ2ZXIuIFN0b3BzIGFzIHNvb24gYXMgaXQKICAgIGZpbmQgYSBDaGFuZ2VDaXBoZXJTcGVjIG1lc3NhZ2Ugc2luY2UgYWxsIGRhdGEgZnJvbSB0aGVuIG9uIGlzIGVuY3J5cHRlZC4KCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIFRMUyByZWNvcmRzCgogICAgOnJldHVybjoKICAgICAgICBBIGdlbmVyYXRvciB0aGF0IHlpZWxkcyAzLWVsZW1lbnQgdHVwbGVzOgogICAgICAgIFswXSBCeXRlIHN0cmluZyBvZiByZWNvcmQgdHlwZQogICAgICAgIFsxXSBCeXRlIHN0cmluZyBvZiBwcm90b2NvbCB2ZXJzaW9uCiAgICAgICAgWzJdIEJ5dGUgc3RyaW5nIG9mIHJlY29yZCBkYXRhCiAgICAiIiIKCiAgICBwb2ludGVyID0gMAogICAgZGF0YV9sZW4gPSBsZW4oZGF0YSkKICAgIHdoaWxlIHBvaW50ZXIgPCBkYXRhX2xlbjoKICAgICAgICAjIERvbid0IHRyeSB0byBwYXJzZSBhbnkgbW9yZSBvbmNlIHRoZSBDaGFuZ2VDaXBoZXJTcGVjIGlzIGZvdW5kCiAgICAgICAgaWYgZGF0YVtwb2ludGVyOnBvaW50ZXIgKyAxXSA9PSBiJ1x4MTQnOgogICAgICAgICAgICBicmVhawogICAgICAgIGxlbmd0aCA9IGludF9mcm9tX2J5dGVzKGRhdGFbcG9pbnRlciArIDM6cG9pbnRlciArIDVdKQogICAgICAgIHlpZWxkICgKICAgICAgICAgICAgZGF0YVtwb2ludGVyOnBvaW50ZXIgKyAxXSwKICAgICAgICAgICAgZGF0YVtwb2ludGVyICsgMTpwb2ludGVyICsgM10sCiAgICAgICAgICAgIGRhdGFbcG9pbnRlciArIDU6cG9pbnRlciArIDUgKyBsZW5ndGhdCiAgICAgICAgKQogICAgICAgIHBvaW50ZXIgKz0gNSArIGxlbmd0aAoKCmRlZiBwYXJzZV9oYW5kc2hha2VfbWVzc2FnZXMoZGF0YSk6CiAgICAiIiIKICAgIENyZWF0ZXMgYSBnZW5lcmF0b3IgcmV0dXJuaW5nIHR1cGxlcyBvZiBpbmZvcm1hdGlvbiBhYm91dCBlYWNoIG1lc3NhZ2UgaW4KICAgIGEgYnl0ZSBzdHJpbmcgb2YgZGF0YSBmcm9tIGEgVExTIGhhbmRzaGFrZSByZWNvcmQKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIGEgVExTIGhhbmRzaGFrZSByZWNvcmQgZGF0YQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBnZW5lcmF0b3IgdGhhdCB5aWVsZHMgMi1lbGVtZW50IHR1cGxlczoKICAgICAgICBbMF0gQnl0ZSBzdHJpbmcgb2YgbWVzc2FnZSB0eXBlCiAgICAgICAgWzFdIEJ5dGUgc3RyaW5nIG9mIG1lc3NhZ2UgZGF0YQogICAgIiIiCgogICAgcG9pbnRlciA9IDAKICAgIGRhdGFfbGVuID0gbGVuKGRhdGEpCiAgICB3aGlsZSBwb2ludGVyIDwgZGF0YV9sZW46CiAgICAgICAgbGVuZ3RoID0gaW50X2Zyb21fYnl0ZXMoZGF0YVtwb2ludGVyICsgMTpwb2ludGVyICsgNF0pCiAgICAgICAgeWllbGQgKAogICAgICAgICAgICBkYXRhW3BvaW50ZXI6cG9pbnRlciArIDFdLAogICAgICAgICAgICBkYXRhW3BvaW50ZXIgKyA0OnBvaW50ZXIgKyA0ICsgbGVuZ3RoXQogICAgICAgICkKICAgICAgICBwb2ludGVyICs9IDQgKyBsZW5ndGgKCgpkZWYgX3BhcnNlX2hlbGxvX2V4dGVuc2lvbnMoZGF0YSk6CiAgICAiIiIKICAgIENyZWF0ZXMgYSBnZW5lcmF0b3IgcmV0dXJuaW5nIHR1cGxlcyBvZiBpbmZvcm1hdGlvbiBhYm91dCBlYWNoIGV4dGVuc2lvbgogICAgZnJvbSBhIGJ5dGUgc3RyaW5nIG9mIGV4dGVuc2lvbiBkYXRhIGNvbnRhaW5lZCBpbiBhIFNlcnZlckhlbGxvIG9yZXMKICAgIENsaWVudEhlbGxvIG1lc3NhZ2UKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIGEgZXh0ZW5zaW9uIGRhdGEgZnJvbSBhIFRMUyBTZXJ2ZXJIZWxsbyBvciBDbGllbnRIZWxsbwogICAgICAgIG1lc3NhZ2UKCiAgICA6cmV0dXJuOgogICAgICAgIEEgZ2VuZXJhdG9yIHRoYXQgeWllbGRzIDItZWxlbWVudCB0dXBsZXM6CiAgICAgICAgWzBdIEJ5dGUgc3RyaW5nIG9mIGV4dGVuc2lvbiB0eXBlCiAgICAgICAgWzFdIEJ5dGUgc3RyaW5nIG9mIGV4dGVuc2lvbiBkYXRhCiAgICAiIiIKCiAgICBpZiBkYXRhID09IGInJzoKICAgICAgICByZXR1cm4KCiAgICBleHRlbnRpb25zX2xlbmd0aCA9IGludF9mcm9tX2J5dGVzKGRhdGFbMDoyXSkKICAgIGV4dGVuc2lvbnNfc3RhcnQgPSAyCiAgICBleHRlbnNpb25zX2VuZCA9IDIgKyBleHRlbnRpb25zX2xlbmd0aAoKICAgIHBvaW50ZXIgPSBleHRlbnNpb25zX3N0YXJ0CiAgICB3aGlsZSBwb2ludGVyIDwgZXh0ZW5zaW9uc19lbmQ6CiAgICAgICAgZXh0ZW5zaW9uX3R5cGUgPSBpbnRfZnJvbV9ieXRlcyhkYXRhW3BvaW50ZXI6cG9pbnRlciArIDJdKQogICAgICAgIGV4dGVuc2lvbl9sZW5ndGggPSBpbnRfZnJvbV9ieXRlcyhkYXRhW3BvaW50ZXIgKyAyOnBvaW50ZXIgKyA0XSkKICAgICAgICB5aWVsZCAoCiAgICAgICAgICAgIGV4dGVuc2lvbl90eXBlLAogICAgICAgICAgICBkYXRhW3BvaW50ZXIgKyA0OnBvaW50ZXIgKyA0ICsgZXh0ZW5zaW9uX2xlbmd0aF0KICAgICAgICApCiAgICAgICAgcG9pbnRlciArPSA0ICsgZXh0ZW5zaW9uX2xlbmd0aAoKCmRlZiByYWlzZV9ob3N0bmFtZShjZXJ0aWZpY2F0ZSwgaG9zdG5hbWUpOgogICAgIiIiCiAgICBSYWlzZXMgYSBUTFNWZXJpZmljYXRpb25FcnJvciBkdWUgdG8gYSBob3N0bmFtZSBtaXNtYXRjaAoKICAgIDpwYXJhbSBjZXJ0aWZpY2F0ZToKICAgICAgICBBbiBhc24xY3J5cHRvLng1MDkuQ2VydGlmaWNhdGUgb2JqZWN0CgogICAgOnJhaXNlczoKICAgICAgICBUTFNWZXJpZmljYXRpb25FcnJvcgogICAgIiIiCgogICAgaXNfaXAgPSByZS5tYXRjaCgnXlxcZCtcXC5cXGQrXFwuXFxkK1xcLlxcZCskJywgaG9zdG5hbWUpIG9yIGhvc3RuYW1lLmZpbmQoJzonKSAhPSAtMQogICAgaWYgaXNfaXA6CiAgICAgICAgaG9zdG5hbWVfdHlwZSA9ICdJUCBhZGRyZXNzICVzJyAlIGhvc3RuYW1lCiAgICBlbHNlOgogICAgICAgIGhvc3RuYW1lX3R5cGUgPSAnZG9tYWluIG5hbWUgJXMnICUgaG9zdG5hbWUKICAgIG1lc3NhZ2UgPSAnU2VydmVyIGNlcnRpZmljYXRlIHZlcmlmaWNhdGlvbiBmYWlsZWQgLSAlcyBkb2VzIG5vdCBtYXRjaCcgJSBob3N0bmFtZV90eXBlCiAgICB2YWxpZF9pcHMgPSAnLCAnLmpvaW4oY2VydGlmaWNhdGUudmFsaWRfaXBzKQogICAgdmFsaWRfZG9tYWlucyA9ICcsICcuam9pbihjZXJ0aWZpY2F0ZS52YWxpZF9kb21haW5zKQogICAgaWYgdmFsaWRfZG9tYWluczoKICAgICAgICBtZXNzYWdlICs9ICcgdmFsaWQgZG9tYWluczogJXMnICUgdmFsaWRfZG9tYWlucwogICAgaWYgdmFsaWRfZG9tYWlucyBhbmQgdmFsaWRfaXBzOgogICAgICAgIG1lc3NhZ2UgKz0gJyBvcicKICAgIGlmIHZhbGlkX2lwczoKICAgICAgICBtZXNzYWdlICs9ICcgdmFsaWQgSVAgYWRkcmVzc2VzOiAlcycgJSB2YWxpZF9pcHMKICAgIHJhaXNlIFRMU1ZlcmlmaWNhdGlvbkVycm9yKG1lc3NhZ2UsIGNlcnRpZmljYXRlKQoKCmRlZiByYWlzZV92ZXJpZmljYXRpb24oY2VydGlmaWNhdGUpOgogICAgIiIiCiAgICBSYWlzZXMgYSBnZW5lcmljIFRMU1ZlcmlmaWNhdGlvbkVycm9yCgogICAgOnBhcmFtIGNlcnRpZmljYXRlOgogICAgICAgIEFuIGFzbjFjcnlwdG8ueDUwOS5DZXJ0aWZpY2F0ZSBvYmplY3QKCiAgICA6cmFpc2VzOgogICAgICAgIFRMU1ZlcmlmaWNhdGlvbkVycm9yCiAgICAiIiIKCiAgICBtZXNzYWdlID0gJ1NlcnZlciBjZXJ0aWZpY2F0ZSB2ZXJpZmljYXRpb24gZmFpbGVkJwogICAgcmFpc2UgVExTVmVyaWZpY2F0aW9uRXJyb3IobWVzc2FnZSwgY2VydGlmaWNhdGUpCgoKZGVmIHJhaXNlX3dlYWtfc2lnbmF0dXJlKGNlcnRpZmljYXRlKToKICAgICIiIgogICAgUmFpc2VzIGEgVExTVmVyaWZpY2F0aW9uRXJyb3Igd2hlbiBhIGNlcnRpZmljYXRlIHVzZXMgYSB3ZWFrIHNpZ25hdHVyZQogICAgYWxnb3JpdGhtCgogICAgOnBhcmFtIGNlcnRpZmljYXRlOgogICAgICAgIEFuIGFzbjFjcnlwdG8ueDUwOS5DZXJ0aWZpY2F0ZSBvYmplY3QKCiAgICA6cmFpc2VzOgogICAgICAgIFRMU1ZlcmlmaWNhdGlvbkVycm9yCiAgICAiIiIKCiAgICBtZXNzYWdlID0gJ1NlcnZlciBjZXJ0aWZpY2F0ZSB2ZXJpZmljYXRpb24gZmFpbGVkIC0gd2VhayBjZXJ0aWZpY2F0ZSBzaWduYXR1cmUgYWxnb3JpdGhtJwogICAgcmFpc2UgVExTVmVyaWZpY2F0aW9uRXJyb3IobWVzc2FnZSwgY2VydGlmaWNhdGUpCgoKZGVmIHJhaXNlX2NsaWVudF9hdXRoKCk6CiAgICAiIiIKICAgIFJhaXNlcyBhIFRMU0Vycm9yIGluZGljYXRpbmcgY2xpZW50IGF1dGhlbnRpY2F0aW9uIGlzIHJlcXVpcmVkCgogICAgOnJhaXNlczoKICAgICAgICBUTFNFcnJvcgogICAgIiIiCgogICAgbWVzc2FnZSA9ICdUTFMgaGFuZHNoYWtlIGZhaWxlZCAtIGNsaWVudCBhdXRoZW50aWNhdGlvbiByZXF1aXJlZCcKICAgIHJhaXNlIFRMU0Vycm9yKG1lc3NhZ2UpCgoKZGVmIHJhaXNlX3Jldm9rZWQoY2VydGlmaWNhdGUpOgogICAgIiIiCiAgICBSYWlzZXMgYSBUTFNWZXJpZmljYXRpb25FcnJvciBkdWUgdG8gdGhlIGNlcnRpZmljYXRlIGJlaW5nIHJldm9rZWQKCiAgICA6cGFyYW0gY2VydGlmaWNhdGU6CiAgICAgICAgQW4gYXNuMWNyeXB0by54NTA5LkNlcnRpZmljYXRlIG9iamVjdAoKICAgIDpyYWlzZXM6CiAgICAgICAgVExTVmVyaWZpY2F0aW9uRXJyb3IKICAgICIiIgoKICAgIG1lc3NhZ2UgPSAnU2VydmVyIGNlcnRpZmljYXRlIHZlcmlmaWNhdGlvbiBmYWlsZWQgLSBjZXJ0aWZpY2F0ZSBoYXMgYmVlbiByZXZva2VkJwogICAgcmFpc2UgVExTVmVyaWZpY2F0aW9uRXJyb3IobWVzc2FnZSwgY2VydGlmaWNhdGUpCgoKZGVmIHJhaXNlX25vX2lzc3VlcihjZXJ0aWZpY2F0ZSk6CiAgICAiIiIKICAgIFJhaXNlcyBhIFRMU1ZlcmlmaWNhdGlvbkVycm9yIGR1ZSB0byBubyBpc3N1ZXIgY2VydGlmaWNhdGUgZm91bmQgaW4gdHJ1c3QKICAgIHJvb3RzCgogICAgOnBhcmFtIGNlcnRpZmljYXRlOgogICAgICAgIEFuIGFzbjFjcnlwdG8ueDUwOS5DZXJ0aWZpY2F0ZSBvYmplY3QKCiAgICA6cmFpc2VzOgogICAgICAgIFRMU1ZlcmlmaWNhdGlvbkVycm9yCiAgICAiIiIKCiAgICBtZXNzYWdlID0gJ1NlcnZlciBjZXJ0aWZpY2F0ZSB2ZXJpZmljYXRpb24gZmFpbGVkIC0gY2VydGlmaWNhdGUgaXNzdWVyIG5vdCBmb3VuZCBpbiB0cnVzdGVkIHJvb3QgY2VydGlmaWNhdGUgc3RvcmUnCiAgICByYWlzZSBUTFNWZXJpZmljYXRpb25FcnJvcihtZXNzYWdlLCBjZXJ0aWZpY2F0ZSkKCgpkZWYgcmFpc2Vfc2VsZl9zaWduZWQoY2VydGlmaWNhdGUpOgogICAgIiIiCiAgICBSYWlzZXMgYSBUTFNWZXJpZmljYXRpb25FcnJvciBkdWUgdG8gYSBzZWxmLXNpZ25lZCBjZXJ0aWZpY2F0ZQogICAgcm9vdHMKCiAgICA6cGFyYW0gY2VydGlmaWNhdGU6CiAgICAgICAgQW4gYXNuMWNyeXB0by54NTA5LkNlcnRpZmljYXRlIG9iamVjdAoKICAgIDpyYWlzZXM6CiAgICAgICAgVExTVmVyaWZpY2F0aW9uRXJyb3IKICAgICIiIgoKICAgIG1lc3NhZ2UgPSAnU2VydmVyIGNlcnRpZmljYXRlIHZlcmlmaWNhdGlvbiBmYWlsZWQgLSBjZXJ0aWZpY2F0ZSBpcyBzZWxmLXNpZ25lZCcKICAgIHJhaXNlIFRMU1ZlcmlmaWNhdGlvbkVycm9yKG1lc3NhZ2UsIGNlcnRpZmljYXRlKQoKCmRlZiByYWlzZV9saWZldGltZV90b29fbG9uZyhjZXJ0aWZpY2F0ZSk6CiAgICAiIiIKICAgIFJhaXNlcyBhIFRMU1ZlcmlmaWNhdGlvbkVycm9yIGR1ZSB0byBhIGNlcnRpZmljYXRlIGxpZmV0aW1lIGV4Y2VlZGluZwogICAgdGhlIENBQiBmb3J1bSBjZXJ0aWZpY2F0ZSBsaWZldGltZSBsaW1pdAoKICAgIDpwYXJhbSBjZXJ0aWZpY2F0ZToKICAgICAgICBBbiBhc24xY3J5cHRvLng1MDkuQ2VydGlmaWNhdGUgb2JqZWN0CgogICAgOnJhaXNlczoKICAgICAgICBUTFNWZXJpZmljYXRpb25FcnJvcgogICAgIiIiCgogICAgbWVzc2FnZSA9ICdTZXJ2ZXIgY2VydGlmaWNhdGUgdmVyaWZpY2F0aW9uIGZhaWxlZCAtIGNlcnRpZmljYXRlIGxpZmV0aW1lIGlzIHRvbyBsb25nJwogICAgcmFpc2UgVExTVmVyaWZpY2F0aW9uRXJyb3IobWVzc2FnZSwgY2VydGlmaWNhdGUpCgoKZGVmIHJhaXNlX2V4cGlyZWRfbm90X3lldF92YWxpZChjZXJ0aWZpY2F0ZSk6CiAgICAiIiIKICAgIFJhaXNlcyBhIFRMU1ZlcmlmaWNhdGlvbkVycm9yIGR1ZSB0byBjZXJ0aWZpY2F0ZSBiZWluZyBleHBpcmVkLCBvciBub3QgeWV0CiAgICBiZWluZyB2YWxpZAoKICAgIDpwYXJhbSBjZXJ0aWZpY2F0ZToKICAgICAgICBBbiBhc24xY3J5cHRvLng1MDkuQ2VydGlmaWNhdGUgb2JqZWN0CgogICAgOnJhaXNlczoKICAgICAgICBUTFNWZXJpZmljYXRpb25FcnJvcgogICAgIiIiCgogICAgdmFsaWRpdHkgPSBjZXJ0aWZpY2F0ZVsndGJzX2NlcnRpZmljYXRlJ11bJ3ZhbGlkaXR5J10KICAgIG5vdF9hZnRlciA9IHZhbGlkaXR5Wydub3RfYWZ0ZXInXS5uYXRpdmUKICAgIG5vdF9iZWZvcmUgPSB2YWxpZGl0eVsnbm90X2JlZm9yZSddLm5hdGl2ZQoKICAgIG5vdyA9IGRhdGV0aW1lLm5vdyh0aW1lem9uZS51dGMpCgogICAgaWYgbm90X2JlZm9yZSA+IG5vdzoKICAgICAgICBmb3JtYXR0ZWRfYmVmb3JlID0gbm90X2JlZm9yZS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVNaJykKICAgICAgICBtZXNzYWdlID0gJ1NlcnZlciBjZXJ0aWZpY2F0ZSB2ZXJpZmljYXRpb24gZmFpbGVkIC0gY2VydGlmaWNhdGUgbm90IHZhbGlkIHVudGlsICVzJyAlIGZvcm1hdHRlZF9iZWZvcmUKICAgIGVsaWYgbm90X2FmdGVyIDwgbm93OgogICAgICAgIGZvcm1hdHRlZF9hZnRlciA9IG5vdF9hZnRlci5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVNaJykKICAgICAgICBtZXNzYWdlID0gJ1NlcnZlciBjZXJ0aWZpY2F0ZSB2ZXJpZmljYXRpb24gZmFpbGVkIC0gY2VydGlmaWNhdGUgZXhwaXJlZCAlcycgJSBmb3JtYXR0ZWRfYWZ0ZXIKCiAgICByYWlzZSBUTFNWZXJpZmljYXRpb25FcnJvcihtZXNzYWdlLCBjZXJ0aWZpY2F0ZSkKCgpkZWYgcmFpc2VfZGlzY29ubmVjdGlvbigpOgogICAgIiIiCiAgICBSYWlzZXMgYSBUTFNEaXNjb25uZWN0RXJyb3IgZHVlIHRvIGEgZGlzY29ubmVjdGlvbgoKICAgIDpyYWlzZXM6CiAgICAgICAgVExTRGlzY29ubmVjdEVycm9yCiAgICAiIiIKCiAgICByYWlzZSBUTFNEaXNjb25uZWN0RXJyb3IoJ1RoZSByZW1vdGUgZW5kIGNsb3NlZCB0aGUgY29ubmVjdGlvbicpCgoKZGVmIHJhaXNlX3Byb3RvY29sX2Vycm9yKHNlcnZlcl9oYW5kc2hha2VfYnl0ZXMpOgogICAgIiIiCiAgICBSYWlzZXMgYSBUTFNFcnJvciBkdWUgdG8gYSBwcm90b2NvbCBlcnJvcgoKICAgIDpwYXJhbSBzZXJ2ZXJfaGFuZHNoYWtlX2J5dGVzOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGhhbmRzaGFrZSBkYXRhIHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlcgoKICAgIDpyYWlzZXM6CiAgICAgICAgVExTRXJyb3IKICAgICIiIgoKICAgIG90aGVyX3Byb3RvY29sID0gZGV0ZWN0X290aGVyX3Byb3RvY29sKHNlcnZlcl9oYW5kc2hha2VfYnl0ZXMpCgogICAgaWYgb3RoZXJfcHJvdG9jb2w6CiAgICAgICAgcmFpc2UgVExTRXJyb3IoJ1RMUyBwcm90b2NvbCBlcnJvciAtIHNlcnZlciByZXNwb25kZWQgdXNpbmcgJXMnICUgb3RoZXJfcHJvdG9jb2wpCgogICAgcmFpc2UgVExTRXJyb3IoJ1RMUyBwcm90b2NvbCBlcnJvciAtIHNlcnZlciByZXNwb25kZWQgdXNpbmcgYSBkaWZmZXJlbnQgcHJvdG9jb2wnKQoKCmRlZiByYWlzZV9oYW5kc2hha2UoKToKICAgICIiIgogICAgUmFpc2VzIGEgVExTRXJyb3IgZHVlIHRvIGEgaGFuZHNoYWtlIGVycm9yCgogICAgOnJhaXNlczoKICAgICAgICBUTFNFcnJvcgogICAgIiIiCgogICAgcmFpc2UgVExTRXJyb3IoJ1RMUyBoYW5kc2hha2UgZmFpbGVkJykKCgpkZWYgcmFpc2VfcHJvdG9jb2xfdmVyc2lvbigpOgogICAgIiIiCiAgICBSYWlzZXMgYSBUTFNFcnJvciBkdWUgdG8gYSBUTFMgdmVyc2lvbiBpbmNvbXBhdGliaWxpdHkKCiAgICA6cmFpc2VzOgogICAgICAgIFRMU0Vycm9yCiAgICAiIiIKCiAgICByYWlzZSBUTFNFcnJvcignVExTIGhhbmRzaGFrZSBmYWlsZWQgLSBwcm90b2NvbCB2ZXJzaW9uIGVycm9yJykKCgpkZWYgcmFpc2VfZGhfcGFyYW1zKCk6CiAgICAiIiIKICAgIFJhaXNlcyBhIFRMU0Vycm9yIGR1ZSB0byB3ZWFrIERIIHBhcmFtcwoKICAgIDpyYWlzZXM6CiAgICAgICAgVExTRXJyb3IKICAgICIiIgoKICAgIHJhaXNlIFRMU0Vycm9yKCdUTFMgaGFuZHNoYWtlIGZhaWxlZCAtIHdlYWsgREggcGFyYW1ldGVycycpCgoKZGVmIGRldGVjdF9vdGhlcl9wcm90b2NvbChzZXJ2ZXJfaGFuZHNoYWtlX2J5dGVzKToKICAgICIiIgogICAgTG9va3MgYXQgdGhlIHNlcnZlciBoYW5kc2hha2UgYnl0ZXMgdG8gdHJ5IGFuZCBkZXRlY3QgYSBkaWZmZXJlbnQgcHJvdG9jb2wKCiAgICA6cGFyYW0gc2VydmVyX2hhbmRzaGFrZV9ieXRlczoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBoYW5kc2hha2UgZGF0YSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIKCiAgICA6cmV0dXJuOgogICAgICAgIE5vbmUsIG9yIGEgdW5pY29kZSBzdHJpbmcgb2YgImZ0cCIsICJodHRwIiwgImltYXAiLCAicG9wMyIsICJzbXRwIgogICAgIiIiCgogICAgaWYgc2VydmVyX2hhbmRzaGFrZV9ieXRlc1swOjVdID09IGInSFRUUC8nOgogICAgICAgIHJldHVybiAnSFRUUCcKCiAgICBpZiBzZXJ2ZXJfaGFuZHNoYWtlX2J5dGVzWzA6NF0gPT0gYicyMjAgJzoKICAgICAgICBpZiByZS5tYXRjaChiJ15bXlxyXG5dKmZ0cCcsIHNlcnZlcl9oYW5kc2hha2VfYnl0ZXMsIHJlLkkpOgogICAgICAgICAgICByZXR1cm4gJ0ZUUCcKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gJ1NNVFAnCgogICAgaWYgc2VydmVyX2hhbmRzaGFrZV9ieXRlc1swOjRdID09IGInMjIwLSc6CiAgICAgICAgcmV0dXJuICdGVFAnCgogICAgaWYgc2VydmVyX2hhbmRzaGFrZV9ieXRlc1swOjRdID09IGInK09LICc6CiAgICAgICAgcmV0dXJuICdQT1AzJwoKICAgIGlmIHNlcnZlcl9oYW5kc2hha2VfYnl0ZXNbMDo0XSA9PSBiJyogT0snIG9yIHNlcnZlcl9oYW5kc2hha2VfYnl0ZXNbMDo5XSA9PSBiJyogUFJFQVVUSCc6CiAgICAgICAgcmV0dXJuICdJTUFQJwoKICAgIHJldHVybiBOb25lCg==
