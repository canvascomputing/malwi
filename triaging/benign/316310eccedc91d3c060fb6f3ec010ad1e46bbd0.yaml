statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/quantiumbase/0.8.1/quantiumbase-0.8.1/quantiumbase-0.8.1/quantiumbase/backends/asyncmy.py
  contents:
  - name: AsyncMyConnection.execute
    score: 0.0
    code: |-
      async def execute(self, query: ClauseElement) -> typing.Any:
              assert self._connection is not None, "Connection is not acquired"
              query_str, args, context = self._compile(query)
              async with self._connection.cursor() as cursor:
                  try:
                      await cursor.execute(query_str, args)
                      if cursor.lastrowid == 0:
                          return cursor.rowcount
                      return cursor.lastrowid
                  finally:
                      await cursor.close()
    tokens: return_generator pop_top resume load_fast self load_attr _connection pop_jump_if_not_none TO_NUMBER load_assertion_error load_const STRING_LEN_S_ENT_HIGH call raise_varargs load_fast self load_attr _compile load_fast query call unpack_sequence store_fast query_str store_fast args store_fast context load_fast self load_attr _connection load_attr cursor call before_async_with get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send store_fast cursor nop load_fast cursor load_attr execute load_fast query_str load_fast args call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top load_fast cursor load_attr lastrowid load_const INTEGER compare_op == pop_jump_if_false TO_NUMBER load_fast cursor load_attr rowcount load_fast cursor load_attr close call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top swap load_const load_const load_const call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top return_value load_fast cursor load_attr lastrowid load_fast cursor load_attr close call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top swap load_const load_const load_const call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top return_value cleanup_throw jump_backward TO_NUMBER cleanup_throw jump_backward TO_NUMBER cleanup_throw jump_backward TO_NUMBER cleanup_throw jump_backward TO_NUMBER cleanup_throw jump_backward TO_NUMBER cleanup_throw jump_backward TO_NUMBER push_exc_info load_fast cursor load_attr close call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER cleanup_throw end_send pop_top reraise copy pop_except reraise push_exc_info with_except_start get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER cleanup_throw end_send pop_jump_if_true TO_NUMBER reraise pop_top pop_except pop_top pop_top return_const None copy pop_except reraise call_intrinsic_1 INTRINSIC_STOPITERATION_ERROR reraise
    hash: a413d6aba8937cdce0b4e304fc08ce3645834f9415c74f3384c01242fb0259b8
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/quantiumbase/0.8.1/quantiumbase-0.8.1/quantiumbase-0.8.1/quantiumbase/backends/asyncmy.py
  : aW1wb3J0IGdldHBhc3MKaW1wb3J0IGxvZ2dpbmcKaW1wb3J0IHR5cGluZwppbXBvcnQgdXVpZAoKaW1wb3J0IGFzeW5jbXkKZnJvbSBzcWxhbGNoZW15LmRpYWxlY3RzLm15c3FsIGltcG9ydCBweW15c3FsCmZyb20gc3FsYWxjaGVteS5lbmdpbmUuY3Vyc29yIGltcG9ydCBDdXJzb3JSZXN1bHRNZXRhRGF0YQpmcm9tIHNxbGFsY2hlbXkuZW5naW5lLmludGVyZmFjZXMgaW1wb3J0IERpYWxlY3QsIEV4ZWN1dGlvbkNvbnRleHQKZnJvbSBzcWxhbGNoZW15LmVuZ2luZS5yb3cgaW1wb3J0IFJvdwpmcm9tIHNxbGFsY2hlbXkuc3FsIGltcG9ydCBDbGF1c2VFbGVtZW50CmZyb20gc3FsYWxjaGVteS5zcWwuZGRsIGltcG9ydCBERExFbGVtZW50Cgpmcm9tIHF1YW50aXVtYmFzZS5jb3JlIGltcG9ydCBMT0dfRVhUUkEsIERhdGFiYXNlVVJMCmZyb20gcXVhbnRpdW1iYXNlLmludGVyZmFjZXMgaW1wb3J0ICgKICAgIENvbm5lY3Rpb25CYWNrZW5kLAogICAgRGF0YWJhc2VCYWNrZW5kLAogICAgUmVjb3JkLAogICAgVHJhbnNhY3Rpb25CYWNrZW5kLAopCgpsb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcigicXVhbnRpdW1iYXNlIikKCgpjbGFzcyBBc3luY015QmFja2VuZChEYXRhYmFzZUJhY2tlbmQpOgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsIGRhdGFiYXNlX3VybDogdHlwaW5nLlVuaW9uW0RhdGFiYXNlVVJMLCBzdHJdLCAqKm9wdGlvbnM6IHR5cGluZy5BbnkKICAgICkgLT4gTm9uZToKICAgICAgICBzZWxmLl9kYXRhYmFzZV91cmwgPSBEYXRhYmFzZVVSTChkYXRhYmFzZV91cmwpCiAgICAgICAgc2VsZi5fb3B0aW9ucyA9IG9wdGlvbnMKICAgICAgICBzZWxmLl9kaWFsZWN0ID0gcHlteXNxbC5kaWFsZWN0KHBhcmFtc3R5bGU9InB5Zm9ybWF0IikKICAgICAgICBzZWxmLl9kaWFsZWN0LnN1cHBvcnRzX25hdGl2ZV9kZWNpbWFsID0gVHJ1ZQogICAgICAgIHNlbGYuX3Bvb2wgPSBOb25lCgogICAgZGVmIF9nZXRfY29ubmVjdGlvbl9rd2FyZ3Moc2VsZikgLT4gZGljdDoKICAgICAgICB1cmxfb3B0aW9ucyA9IHNlbGYuX2RhdGFiYXNlX3VybC5vcHRpb25zCgogICAgICAgIGt3YXJncyA9IHt9CiAgICAgICAgbWluX3NpemUgPSB1cmxfb3B0aW9ucy5nZXQoIm1pbl9zaXplIikKICAgICAgICBtYXhfc2l6ZSA9IHVybF9vcHRpb25zLmdldCgibWF4X3NpemUiKQogICAgICAgIHBvb2xfcmVjeWNsZSA9IHVybF9vcHRpb25zLmdldCgicG9vbF9yZWN5Y2xlIikKICAgICAgICBzc2wgPSB1cmxfb3B0aW9ucy5nZXQoInNzbCIpCgogICAgICAgIGlmIG1pbl9zaXplIGlzIG5vdCBOb25lOgogICAgICAgICAgICBrd2FyZ3NbIm1pbnNpemUiXSA9IGludChtaW5fc2l6ZSkKICAgICAgICBpZiBtYXhfc2l6ZSBpcyBub3QgTm9uZToKICAgICAgICAgICAga3dhcmdzWyJtYXhzaXplIl0gPSBpbnQobWF4X3NpemUpCiAgICAgICAgaWYgcG9vbF9yZWN5Y2xlIGlzIG5vdCBOb25lOgogICAgICAgICAgICBrd2FyZ3NbInBvb2xfcmVjeWNsZSJdID0gaW50KHBvb2xfcmVjeWNsZSkKICAgICAgICBpZiBzc2wgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGt3YXJnc1sic3NsIl0gPSB7InRydWUiOiBUcnVlLCAiZmFsc2UiOiBGYWxzZX1bc3NsLmxvd2VyKCldCgogICAgICAgIGZvciBrZXksIHZhbHVlIGluIHNlbGYuX29wdGlvbnMuaXRlbXMoKToKICAgICAgICAgICAgIyBDb2VyY2UgJ21pbl9zaXplJyBhbmQgJ21heF9zaXplJyBmb3IgY29uc2lzdGVuY3kuCiAgICAgICAgICAgIGlmIGtleSA9PSAibWluX3NpemUiOgogICAgICAgICAgICAgICAga2V5ID0gIm1pbnNpemUiCiAgICAgICAgICAgIGVsaWYga2V5ID09ICJtYXhfc2l6ZSI6CiAgICAgICAgICAgICAgICBrZXkgPSAibWF4c2l6ZSIKICAgICAgICAgICAga3dhcmdzW2tleV0gPSB2YWx1ZQoKICAgICAgICByZXR1cm4ga3dhcmdzCgogICAgYXN5bmMgZGVmIGNvbm5lY3Qoc2VsZikgLT4gTm9uZToKICAgICAgICBhc3NlcnQgc2VsZi5fcG9vbCBpcyBOb25lLCAiRGF0YWJhc2VCYWNrZW5kIGlzIGFscmVhZHkgcnVubmluZyIKICAgICAgICBrd2FyZ3MgPSBzZWxmLl9nZXRfY29ubmVjdGlvbl9rd2FyZ3MoKQogICAgICAgIHNlbGYuX3Bvb2wgPSBhd2FpdCBhc3luY215LmNyZWF0ZV9wb29sKAogICAgICAgICAgICBob3N0PXNlbGYuX2RhdGFiYXNlX3VybC5ob3N0bmFtZSwKICAgICAgICAgICAgcG9ydD1zZWxmLl9kYXRhYmFzZV91cmwucG9ydCBvciAzMzA2LAogICAgICAgICAgICB1c2VyPXNlbGYuX2RhdGFiYXNlX3VybC51c2VybmFtZSBvciBnZXRwYXNzLmdldHVzZXIoKSwKICAgICAgICAgICAgcGFzc3dvcmQ9c2VsZi5fZGF0YWJhc2VfdXJsLnBhc3N3b3JkLAogICAgICAgICAgICBkYj1zZWxmLl9kYXRhYmFzZV91cmwuZGF0YWJhc2UsCiAgICAgICAgICAgIGF1dG9jb21taXQ9VHJ1ZSwKICAgICAgICAgICAgKiprd2FyZ3MsCiAgICAgICAgKQoKICAgIGFzeW5jIGRlZiBkaXNjb25uZWN0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgYXNzZXJ0IHNlbGYuX3Bvb2wgaXMgbm90IE5vbmUsICJEYXRhYmFzZUJhY2tlbmQgaXMgbm90IHJ1bm5pbmciCiAgICAgICAgc2VsZi5fcG9vbC5jbG9zZSgpCiAgICAgICAgYXdhaXQgc2VsZi5fcG9vbC53YWl0X2Nsb3NlZCgpCiAgICAgICAgc2VsZi5fcG9vbCA9IE5vbmUKCiAgICBkZWYgY29ubmVjdGlvbihzZWxmKSAtPiAiQXN5bmNNeUNvbm5lY3Rpb24iOgogICAgICAgIHJldHVybiBBc3luY015Q29ubmVjdGlvbihzZWxmLCBzZWxmLl9kaWFsZWN0KQoKCmNsYXNzIENvbXBpbGF0aW9uQ29udGV4dDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb250ZXh0OiBFeGVjdXRpb25Db250ZXh0KToKICAgICAgICBzZWxmLmNvbnRleHQgPSBjb250ZXh0CgoKY2xhc3MgQXN5bmNNeUNvbm5lY3Rpb24oQ29ubmVjdGlvbkJhY2tlbmQpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRhdGFiYXNlOiBBc3luY015QmFja2VuZCwgZGlhbGVjdDogRGlhbGVjdCk6CiAgICAgICAgc2VsZi5fZGF0YWJhc2UgPSBkYXRhYmFzZQogICAgICAgIHNlbGYuX2RpYWxlY3QgPSBkaWFsZWN0CiAgICAgICAgc2VsZi5fY29ubmVjdGlvbiA9IE5vbmUgICMgdHlwZTogdHlwaW5nLk9wdGlvbmFsW2FzeW5jbXkuQ29ubmVjdGlvbl0KCiAgICBhc3luYyBkZWYgYWNxdWlyZShzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIE5vbmUsICJDb25uZWN0aW9uIGlzIGFscmVhZHkgYWNxdWlyZWQiCiAgICAgICAgYXNzZXJ0IHNlbGYuX2RhdGFiYXNlLl9wb29sIGlzIG5vdCBOb25lLCAiRGF0YWJhc2VCYWNrZW5kIGlzIG5vdCBydW5uaW5nIgogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBhd2FpdCBzZWxmLl9kYXRhYmFzZS5fcG9vbC5hY3F1aXJlKCkKCiAgICBhc3luYyBkZWYgcmVsZWFzZShzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgYXNzZXJ0IHNlbGYuX2RhdGFiYXNlLl9wb29sIGlzIG5vdCBOb25lLCAiRGF0YWJhc2VCYWNrZW5kIGlzIG5vdCBydW5uaW5nIgogICAgICAgIGF3YWl0IHNlbGYuX2RhdGFiYXNlLl9wb29sLnJlbGVhc2Uoc2VsZi5fY29ubmVjdGlvbikKICAgICAgICBzZWxmLl9jb25uZWN0aW9uID0gTm9uZQoKICAgIGFzeW5jIGRlZiBmZXRjaF9hbGwoc2VsZiwgcXVlcnk6IENsYXVzZUVsZW1lbnQpIC0+IHR5cGluZy5MaXN0W1JlY29yZF06CiAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUsICJDb25uZWN0aW9uIGlzIG5vdCBhY3F1aXJlZCIKICAgICAgICBxdWVyeV9zdHIsIGFyZ3MsIGNvbnRleHQgPSBzZWxmLl9jb21waWxlKHF1ZXJ5KQogICAgICAgIGFzeW5jIHdpdGggc2VsZi5fY29ubmVjdGlvbi5jdXJzb3IoKSBhcyBjdXJzb3I6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGF3YWl0IGN1cnNvci5leGVjdXRlKHF1ZXJ5X3N0ciwgYXJncykKICAgICAgICAgICAgICAgIHJvd3MgPSBhd2FpdCBjdXJzb3IuZmV0Y2hhbGwoKQogICAgICAgICAgICAgICAgbWV0YWRhdGEgPSBDdXJzb3JSZXN1bHRNZXRhRGF0YShjb250ZXh0LCBjdXJzb3IuZGVzY3JpcHRpb24pCiAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgIFJvdygKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLl9wcm9jZXNzb3JzLAogICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5fa2V5bWFwLAogICAgICAgICAgICAgICAgICAgICAgICBSb3cuX2RlZmF1bHRfa2V5X3N0eWxlLAogICAgICAgICAgICAgICAgICAgICAgICByb3csCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGZvciByb3cgaW4gcm93cwogICAgICAgICAgICAgICAgXQogICAgICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmNsb3NlKCkKCiAgICBhc3luYyBkZWYgZmV0Y2hfb25lKHNlbGYsIHF1ZXJ5OiBDbGF1c2VFbGVtZW50KSAtPiB0eXBpbmcuT3B0aW9uYWxbUmVjb3JkXToKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbiBpcyBub3QgTm9uZSwgIkNvbm5lY3Rpb24gaXMgbm90IGFjcXVpcmVkIgogICAgICAgIHF1ZXJ5X3N0ciwgYXJncywgY29udGV4dCA9IHNlbGYuX2NvbXBpbGUocXVlcnkpCiAgICAgICAgYXN5bmMgd2l0aCBzZWxmLl9jb25uZWN0aW9uLmN1cnNvcigpIGFzIGN1cnNvcjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmV4ZWN1dGUocXVlcnlfc3RyLCBhcmdzKQogICAgICAgICAgICAgICAgcm93ID0gYXdhaXQgY3Vyc29yLmZldGNob25lKCkKICAgICAgICAgICAgICAgIGlmIHJvdyBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICBtZXRhZGF0YSA9IEN1cnNvclJlc3VsdE1ldGFEYXRhKGNvbnRleHQsIGN1cnNvci5kZXNjcmlwdGlvbikKICAgICAgICAgICAgICAgIHJldHVybiBSb3coCiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEsCiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuX3Byb2Nlc3NvcnMsCiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuX2tleW1hcCwKICAgICAgICAgICAgICAgICAgICBSb3cuX2RlZmF1bHRfa2V5X3N0eWxlLAogICAgICAgICAgICAgICAgICAgIHJvdywKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZmluYWxseToKICAgICAgICAgICAgICAgIGF3YWl0IGN1cnNvci5jbG9zZSgpCgogICAgYXN5bmMgZGVmIGV4ZWN1dGUoc2VsZiwgcXVlcnk6IENsYXVzZUVsZW1lbnQpIC0+IHR5cGluZy5Bbnk6CiAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUsICJDb25uZWN0aW9uIGlzIG5vdCBhY3F1aXJlZCIKICAgICAgICBxdWVyeV9zdHIsIGFyZ3MsIGNvbnRleHQgPSBzZWxmLl9jb21waWxlKHF1ZXJ5KQogICAgICAgIGFzeW5jIHdpdGggc2VsZi5fY29ubmVjdGlvbi5jdXJzb3IoKSBhcyBjdXJzb3I6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGF3YWl0IGN1cnNvci5leGVjdXRlKHF1ZXJ5X3N0ciwgYXJncykKICAgICAgICAgICAgICAgIGlmIGN1cnNvci5sYXN0cm93aWQgPT0gMDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3Vyc29yLnJvd2NvdW50CiAgICAgICAgICAgICAgICByZXR1cm4gY3Vyc29yLmxhc3Ryb3dpZAogICAgICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmNsb3NlKCkKCiAgICBhc3luYyBkZWYgZXhlY3V0ZV9tYW55KHNlbGYsIHF1ZXJpZXM6IHR5cGluZy5MaXN0W0NsYXVzZUVsZW1lbnRdKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgYXN5bmMgd2l0aCBzZWxmLl9jb25uZWN0aW9uLmN1cnNvcigpIGFzIGN1cnNvcjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZm9yIHNpbmdsZV9xdWVyeSBpbiBxdWVyaWVzOgogICAgICAgICAgICAgICAgICAgIHNpbmdsZV9xdWVyeSwgYXJncywgY29udGV4dCA9IHNlbGYuX2NvbXBpbGUoc2luZ2xlX3F1ZXJ5KQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGN1cnNvci5leGVjdXRlKHNpbmdsZV9xdWVyeSwgYXJncykKICAgICAgICAgICAgZmluYWxseToKICAgICAgICAgICAgICAgIGF3YWl0IGN1cnNvci5jbG9zZSgpCgogICAgYXN5bmMgZGVmIGl0ZXJhdGUoCiAgICAgICAgc2VsZiwgcXVlcnk6IENsYXVzZUVsZW1lbnQKICAgICkgLT4gdHlwaW5nLkFzeW5jR2VuZXJhdG9yW3R5cGluZy5BbnksIE5vbmVdOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgcXVlcnlfc3RyLCBhcmdzLCBjb250ZXh0ID0gc2VsZi5fY29tcGlsZShxdWVyeSkKICAgICAgICBhc3luYyB3aXRoIHNlbGYuX2Nvbm5lY3Rpb24uY3Vyc29yKCkgYXMgY3Vyc29yOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhd2FpdCBjdXJzb3IuZXhlY3V0ZShxdWVyeV9zdHIsIGFyZ3MpCiAgICAgICAgICAgICAgICBtZXRhZGF0YSA9IEN1cnNvclJlc3VsdE1ldGFEYXRhKGNvbnRleHQsIGN1cnNvci5kZXNjcmlwdGlvbikKICAgICAgICAgICAgICAgIGFzeW5jIGZvciByb3cgaW4gY3Vyc29yOgogICAgICAgICAgICAgICAgICAgIHlpZWxkIFJvdygKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLl9wcm9jZXNzb3JzLAogICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5fa2V5bWFwLAogICAgICAgICAgICAgICAgICAgICAgICBSb3cuX2RlZmF1bHRfa2V5X3N0eWxlLAogICAgICAgICAgICAgICAgICAgICAgICByb3csCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmNsb3NlKCkKCiAgICBkZWYgdHJhbnNhY3Rpb24oc2VsZikgLT4gVHJhbnNhY3Rpb25CYWNrZW5kOgogICAgICAgIHJldHVybiBBc3luY015VHJhbnNhY3Rpb24oc2VsZikKCiAgICBkZWYgX2NvbXBpbGUoCiAgICAgICAgc2VsZiwgcXVlcnk6IENsYXVzZUVsZW1lbnQKICAgICkgLT4gdHlwaW5nLlR1cGxlW3N0ciwgZGljdCwgQ29tcGlsYXRpb25Db250ZXh0XToKICAgICAgICBjb21waWxlZCA9IHF1ZXJ5LmNvbXBpbGUoCiAgICAgICAgICAgIGRpYWxlY3Q9c2VsZi5fZGlhbGVjdCwgY29tcGlsZV9rd2FyZ3M9eyJyZW5kZXJfcG9zdGNvbXBpbGUiOiBUcnVlfQogICAgICAgICkKCiAgICAgICAgZXhlY3V0aW9uX2NvbnRleHQgPSBzZWxmLl9kaWFsZWN0LmV4ZWN1dGlvbl9jdHhfY2xzKCkKICAgICAgICBleGVjdXRpb25fY29udGV4dC5kaWFsZWN0ID0gc2VsZi5fZGlhbGVjdAoKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShxdWVyeSwgRERMRWxlbWVudCk6CiAgICAgICAgICAgIGFyZ3MgPSBjb21waWxlZC5jb25zdHJ1Y3RfcGFyYW1zKCkKICAgICAgICAgICAgZm9yIGtleSwgdmFsIGluIGFyZ3MuaXRlbXMoKToKICAgICAgICAgICAgICAgIGlmIGtleSBpbiBjb21waWxlZC5fYmluZF9wcm9jZXNzb3JzOgogICAgICAgICAgICAgICAgICAgIGFyZ3Nba2V5XSA9IGNvbXBpbGVkLl9iaW5kX3Byb2Nlc3NvcnNba2V5XSh2YWwpCgogICAgICAgICAgICBleGVjdXRpb25fY29udGV4dC5yZXN1bHRfY29sdW1uX3N0cnVjdCA9ICgKICAgICAgICAgICAgICAgIGNvbXBpbGVkLl9yZXN1bHRfY29sdW1ucywKICAgICAgICAgICAgICAgIGNvbXBpbGVkLl9vcmRlcmVkX2NvbHVtbnMsCiAgICAgICAgICAgICAgICBjb21waWxlZC5fdGV4dHVhbF9vcmRlcmVkX2NvbHVtbnMsCiAgICAgICAgICAgICAgICBjb21waWxlZC5fYWRfaG9jX3RleHR1YWwsCiAgICAgICAgICAgICAgICBjb21waWxlZC5fbG9vc2VfY29sdW1uX25hbWVfbWF0Y2hpbmcsCiAgICAgICAgICAgICkKICAgICAgICBlbHNlOgogICAgICAgICAgICBhcmdzID0ge30KCiAgICAgICAgcXVlcnlfbWVzc2FnZSA9IGNvbXBpbGVkLnN0cmluZy5yZXBsYWNlKCIgXG4iLCAiICIpLnJlcGxhY2UoIlxuIiwgIiAiKQogICAgICAgIGxvZ2dlci5kZWJ1ZygiUXVlcnk6ICVzIEFyZ3M6ICVzIiwgcXVlcnlfbWVzc2FnZSwgcmVwcihhcmdzKSwgZXh0cmE9TE9HX0VYVFJBKQogICAgICAgIHJldHVybiBjb21waWxlZC5zdHJpbmcsIGFyZ3MsIENvbXBpbGF0aW9uQ29udGV4dChleGVjdXRpb25fY29udGV4dCkKCiAgICBAcHJvcGVydHkKICAgIGRlZiByYXdfY29ubmVjdGlvbihzZWxmKSAtPiBhc3luY215LmNvbm5lY3Rpb24uQ29ubmVjdGlvbjoKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbiBpcyBub3QgTm9uZSwgIkNvbm5lY3Rpb24gaXMgbm90IGFjcXVpcmVkIgogICAgICAgIHJldHVybiBzZWxmLl9jb25uZWN0aW9uCgoKY2xhc3MgQXN5bmNNeVRyYW5zYWN0aW9uKFRyYW5zYWN0aW9uQmFja2VuZCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgY29ubmVjdGlvbjogQXN5bmNNeUNvbm5lY3Rpb24pOgogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBjb25uZWN0aW9uCiAgICAgICAgc2VsZi5faXNfcm9vdCA9IEZhbHNlCiAgICAgICAgc2VsZi5fc2F2ZXBvaW50X25hbWUgPSAiIgoKICAgIGFzeW5jIGRlZiBzdGFydCgKICAgICAgICBzZWxmLCBpc19yb290OiBib29sLCBleHRyYV9vcHRpb25zOiB0eXBpbmcuRGljdFt0eXBpbmcuQW55LCB0eXBpbmcuQW55XQogICAgKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgc2VsZi5faXNfcm9vdCA9IGlzX3Jvb3QKICAgICAgICBpZiBzZWxmLl9pc19yb290OgogICAgICAgICAgICBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLl9jb25uZWN0aW9uLmJlZ2luKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZCA9IHN0cih1dWlkLnV1aWQ0KCkpLnJlcGxhY2UoIi0iLCAiXyIpCiAgICAgICAgICAgIHNlbGYuX3NhdmVwb2ludF9uYW1lID0gZiJTVEFSTEVUVEVfU0FWRVBPSU5UX3tpZH0iCiAgICAgICAgICAgIGFzeW5jIHdpdGggc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbi5jdXJzb3IoKSBhcyBjdXJzb3I6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmV4ZWN1dGUoZiJTQVZFUE9JTlQge3NlbGYuX3NhdmVwb2ludF9uYW1lfSIpCiAgICAgICAgICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICAgICAgICAgIGF3YWl0IGN1cnNvci5jbG9zZSgpCgogICAgYXN5bmMgZGVmIGNvbW1pdChzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgaWYgc2VsZi5faXNfcm9vdDoKICAgICAgICAgICAgYXdhaXQgc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbi5jb21taXQoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFzeW5jIHdpdGggc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbi5jdXJzb3IoKSBhcyBjdXJzb3I6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmV4ZWN1dGUoZiJSRUxFQVNFIFNBVkVQT0lOVCB7c2VsZi5fc2F2ZXBvaW50X25hbWV9IikKICAgICAgICAgICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmNsb3NlKCkKCiAgICBhc3luYyBkZWYgcm9sbGJhY2soc2VsZikgLT4gTm9uZToKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbiBpcyBub3QgTm9uZSwgIkNvbm5lY3Rpb24gaXMgbm90IGFjcXVpcmVkIgogICAgICAgIGlmIHNlbGYuX2lzX3Jvb3Q6CiAgICAgICAgICAgIGF3YWl0IHNlbGYuX2Nvbm5lY3Rpb24uX2Nvbm5lY3Rpb24ucm9sbGJhY2soKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFzeW5jIHdpdGggc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbi5jdXJzb3IoKSBhcyBjdXJzb3I6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGYiUk9MTEJBQ0sgVE8gU0FWRVBPSU5UIHtzZWxmLl9zYXZlcG9pbnRfbmFtZX0iCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZmluYWxseToKICAgICAgICAgICAgICAgICAgICBhd2FpdCBjdXJzb3IuY2xvc2UoKQo=
