statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/adapters.py
  contents:
  - name: <module>
    score: 0.0
    code: |-
      # -*- coding: utf-8 -*-

      """
      requests.adapters
      ~~~~~~~~~~~~~~~~~

      This module contains the transport adapters that Requests uses to define
      and maintain connections.
      """

      import os.path
      import socket

      from .packages.urllib3.poolmanager import PoolManager, proxy_from_url
      from .packages.urllib3.response import HTTPResponse
      from .packages.urllib3.util import Timeout as TimeoutSauce
      from .packages.urllib3.util.retry import Retry
      from .packages.urllib3.exceptions import ClosedPoolError
      from .packages.urllib3.exceptions import ConnectTimeoutError
      from .packages.urllib3.exceptions import HTTPError as _HTTPError
      from .packages.urllib3.exceptions import MaxRetryError
      from .packages.urllib3.exceptions import NewConnectionError
      from .packages.urllib3.exceptions import ProxyError as _ProxyError
      from .packages.urllib3.exceptions import ProtocolError
      from .packages.urllib3.exceptions import ReadTimeoutError
      from .packages.urllib3.exceptions import SSLError as _SSLError
      from .packages.urllib3.exceptions import ResponseError

      from .models import Response
      from .compat import urlparse, basestring
      from .utils import (DEFAULT_CA_BUNDLE_PATH, get_encoding_from_headers,
                          prepend_scheme_if_needed, get_auth_from_url, urldefragauth,
                          select_proxy)
      from .structures import CaseInsensitiveDict
      from .cookies import extract_cookies_to_jar
      from .exceptions import (ConnectionError, ConnectTimeout, ReadTimeout, SSLError,
                               ProxyError, RetryError, InvalidSchema)
      from .auth import _basic_auth_str

      try:
          from .packages.urllib3.contrib.socks import SOCKSProxyManager
      except ImportError:
          def SOCKSProxyManager(*args, **kwargs):
              raise InvalidSchema("Missing dependencies for SOCKS support.")
    tokens: resume load_const STRING_LEN_M_ENT_HIGH store_name __doc__ load_const INTEGER load_const import_name os.path store_name os load_const INTEGER load_const import_name socket store_name socket load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from PoolManager store_name PoolManager import_from proxy_from_url store_name proxy_from_url pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from HTTPResponse store_name HTTPResponse pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from Timeout store_name TimeoutSauce pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from Retry store_name Retry pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from ClosedPoolError store_name ClosedPoolError pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from HTTPError store_name _HTTPError pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from MaxRetryError store_name MaxRetryError pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from ProxyError store_name _ProxyError pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from ProtocolError store_name ProtocolError pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from STRING_BASE64_LEN_S_ENT_HIGH store_name STRING_BASE64_LEN_S_ENT_HIGH pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from SSLError store_name _SSLError pop_top load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from ResponseError store_name ResponseError pop_top load_const INTEGER load_const import_name models import_from Response store_name Response pop_top load_const INTEGER load_const import_name compat import_from urlparse store_name urlparse import_from basestring store_name basestring pop_top load_const INTEGER load_const import_name utils import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH import_from urldefragauth store_name urldefragauth import_from select_proxy store_name select_proxy pop_top load_const INTEGER load_const import_name structures import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top load_const INTEGER load_const import_name cookies import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top load_const INTEGER load_const import_name exceptions import_from ConnectionError store_name ConnectionError import_from ConnectTimeout store_name ConnectTimeout import_from ReadTimeout store_name ReadTimeout import_from SSLError store_name SSLError import_from ProxyError store_name ProxyError import_from RetryError store_name RetryError import_from InvalidSchema store_name InvalidSchema pop_top load_const INTEGER load_const import_name auth import_from _basic_auth_str store_name _basic_auth_str pop_top nop load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top load_const INTEGER store_name STRING_LEN_S_ENT_HIGH load_const INTEGER store_name STRING_LEN_S_ENT_HIGH load_const INTEGER store_name DEFAULT_RETRIES load_const store_name STRING_LEN_S_ENT_HIGH push_null load_build_class load_const OBJECT make_function load_const BaseAdapter load_name object call store_name BaseAdapter push_null load_build_class load_const OBJECT make_function load_const HTTPAdapter load_name BaseAdapter call store_name HTTPAdapter return_const None push_exc_info load_name ImportError check_exc_match pop_jump_if_false TO_NUMBER pop_top load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH pop_except jump_backward TO_NUMBER reraise copy pop_except reraise
    hash: f9bc89a0f66af60d957900953a5e1b21664ff5033cba537c4263c10cecfb5f70
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/adapters.py
  : IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KCiIiIgpyZXF1ZXN0cy5hZGFwdGVycwp+fn5+fn5+fn5+fn5+fn5+fgoKVGhpcyBtb2R1bGUgY29udGFpbnMgdGhlIHRyYW5zcG9ydCBhZGFwdGVycyB0aGF0IFJlcXVlc3RzIHVzZXMgdG8gZGVmaW5lCmFuZCBtYWludGFpbiBjb25uZWN0aW9ucy4KIiIiCgppbXBvcnQgb3MucGF0aAppbXBvcnQgc29ja2V0Cgpmcm9tIC5wYWNrYWdlcy51cmxsaWIzLnBvb2xtYW5hZ2VyIGltcG9ydCBQb29sTWFuYWdlciwgcHJveHlfZnJvbV91cmwKZnJvbSAucGFja2FnZXMudXJsbGliMy5yZXNwb25zZSBpbXBvcnQgSFRUUFJlc3BvbnNlCmZyb20gLnBhY2thZ2VzLnVybGxpYjMudXRpbCBpbXBvcnQgVGltZW91dCBhcyBUaW1lb3V0U2F1Y2UKZnJvbSAucGFja2FnZXMudXJsbGliMy51dGlsLnJldHJ5IGltcG9ydCBSZXRyeQpmcm9tIC5wYWNrYWdlcy51cmxsaWIzLmV4Y2VwdGlvbnMgaW1wb3J0IENsb3NlZFBvb2xFcnJvcgpmcm9tIC5wYWNrYWdlcy51cmxsaWIzLmV4Y2VwdGlvbnMgaW1wb3J0IENvbm5lY3RUaW1lb3V0RXJyb3IKZnJvbSAucGFja2FnZXMudXJsbGliMy5leGNlcHRpb25zIGltcG9ydCBIVFRQRXJyb3IgYXMgX0hUVFBFcnJvcgpmcm9tIC5wYWNrYWdlcy51cmxsaWIzLmV4Y2VwdGlvbnMgaW1wb3J0IE1heFJldHJ5RXJyb3IKZnJvbSAucGFja2FnZXMudXJsbGliMy5leGNlcHRpb25zIGltcG9ydCBOZXdDb25uZWN0aW9uRXJyb3IKZnJvbSAucGFja2FnZXMudXJsbGliMy5leGNlcHRpb25zIGltcG9ydCBQcm94eUVycm9yIGFzIF9Qcm94eUVycm9yCmZyb20gLnBhY2thZ2VzLnVybGxpYjMuZXhjZXB0aW9ucyBpbXBvcnQgUHJvdG9jb2xFcnJvcgpmcm9tIC5wYWNrYWdlcy51cmxsaWIzLmV4Y2VwdGlvbnMgaW1wb3J0IFJlYWRUaW1lb3V0RXJyb3IKZnJvbSAucGFja2FnZXMudXJsbGliMy5leGNlcHRpb25zIGltcG9ydCBTU0xFcnJvciBhcyBfU1NMRXJyb3IKZnJvbSAucGFja2FnZXMudXJsbGliMy5leGNlcHRpb25zIGltcG9ydCBSZXNwb25zZUVycm9yCgpmcm9tIC5tb2RlbHMgaW1wb3J0IFJlc3BvbnNlCmZyb20gLmNvbXBhdCBpbXBvcnQgdXJscGFyc2UsIGJhc2VzdHJpbmcKZnJvbSAudXRpbHMgaW1wb3J0IChERUZBVUxUX0NBX0JVTkRMRV9QQVRILCBnZXRfZW5jb2RpbmdfZnJvbV9oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgIHByZXBlbmRfc2NoZW1lX2lmX25lZWRlZCwgZ2V0X2F1dGhfZnJvbV91cmwsIHVybGRlZnJhZ2F1dGgsCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0X3Byb3h5KQpmcm9tIC5zdHJ1Y3R1cmVzIGltcG9ydCBDYXNlSW5zZW5zaXRpdmVEaWN0CmZyb20gLmNvb2tpZXMgaW1wb3J0IGV4dHJhY3RfY29va2llc190b19qYXIKZnJvbSAuZXhjZXB0aW9ucyBpbXBvcnQgKENvbm5lY3Rpb25FcnJvciwgQ29ubmVjdFRpbWVvdXQsIFJlYWRUaW1lb3V0LCBTU0xFcnJvciwKICAgICAgICAgICAgICAgICAgICAgICAgIFByb3h5RXJyb3IsIFJldHJ5RXJyb3IsIEludmFsaWRTY2hlbWEpCmZyb20gLmF1dGggaW1wb3J0IF9iYXNpY19hdXRoX3N0cgoKdHJ5OgogICAgZnJvbSAucGFja2FnZXMudXJsbGliMy5jb250cmliLnNvY2tzIGltcG9ydCBTT0NLU1Byb3h5TWFuYWdlcgpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBkZWYgU09DS1NQcm94eU1hbmFnZXIoKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICByYWlzZSBJbnZhbGlkU2NoZW1hKCJNaXNzaW5nIGRlcGVuZGVuY2llcyBmb3IgU09DS1Mgc3VwcG9ydC4iKQoKREVGQVVMVF9QT09MQkxPQ0sgPSBGYWxzZQpERUZBVUxUX1BPT0xTSVpFID0gMTAKREVGQVVMVF9SRVRSSUVTID0gMApERUZBVUxUX1BPT0xfVElNRU9VVCA9IE5vbmUKCgpjbGFzcyBCYXNlQWRhcHRlcihvYmplY3QpOgogICAgIiIiVGhlIEJhc2UgVHJhbnNwb3J0IEFkYXB0ZXIiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc3VwZXIoQmFzZUFkYXB0ZXIsIHNlbGYpLl9faW5pdF9fKCkKCiAgICBkZWYgc2VuZChzZWxmLCByZXF1ZXN0LCBzdHJlYW09RmFsc2UsIHRpbWVvdXQ9Tm9uZSwgdmVyaWZ5PVRydWUsCiAgICAgICAgICAgICBjZXJ0PU5vbmUsIHByb3hpZXM9Tm9uZSk6CiAgICAgICAgIiIiU2VuZHMgUHJlcGFyZWRSZXF1ZXN0IG9iamVjdC4gUmV0dXJucyBSZXNwb25zZSBvYmplY3QuCgogICAgICAgIDpwYXJhbSByZXF1ZXN0OiBUaGUgOmNsYXNzOmBQcmVwYXJlZFJlcXVlc3QgPFByZXBhcmVkUmVxdWVzdD5gIGJlaW5nIHNlbnQuCiAgICAgICAgOnBhcmFtIHN0cmVhbTogKG9wdGlvbmFsKSBXaGV0aGVyIHRvIHN0cmVhbSB0aGUgcmVxdWVzdCBjb250ZW50LgogICAgICAgIDpwYXJhbSB0aW1lb3V0OiAob3B0aW9uYWwpIEhvdyBsb25nIHRvIHdhaXQgZm9yIHRoZSBzZXJ2ZXIgdG8gc2VuZAogICAgICAgICAgICBkYXRhIGJlZm9yZSBnaXZpbmcgdXAsIGFzIGEgZmxvYXQsIG9yIGEgOnJlZjpgKGNvbm5lY3QgdGltZW91dCwKICAgICAgICAgICAgcmVhZCB0aW1lb3V0KSA8dGltZW91dHM+YCB0dXBsZS4KICAgICAgICA6dHlwZSB0aW1lb3V0OiBmbG9hdCBvciB0dXBsZQogICAgICAgIDpwYXJhbSB2ZXJpZnk6IChvcHRpb25hbCkgRWl0aGVyIGEgYm9vbGVhbiwgaW4gd2hpY2ggY2FzZSBpdCBjb250cm9scyB3aGV0aGVyIHdlIHZlcmlmeQogICAgICAgICAgICB0aGUgc2VydmVyJ3MgVExTIGNlcnRpZmljYXRlLCBvciBhIHN0cmluZywgaW4gd2hpY2ggY2FzZSBpdCBtdXN0IGJlIGEgcGF0aAogICAgICAgICAgICB0byBhIENBIGJ1bmRsZSB0byB1c2UKICAgICAgICA6cGFyYW0gY2VydDogKG9wdGlvbmFsKSBBbnkgdXNlci1wcm92aWRlZCBTU0wgY2VydGlmaWNhdGUgdG8gYmUgdHJ1c3RlZC4KICAgICAgICA6cGFyYW0gcHJveGllczogKG9wdGlvbmFsKSBUaGUgcHJveGllcyBkaWN0aW9uYXJ5IHRvIGFwcGx5IHRvIHRoZSByZXF1ZXN0LgogICAgICAgICIiIgogICAgICAgIHJhaXNlIE5vdEltcGxlbWVudGVkRXJyb3IKCiAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgIiIiQ2xlYW5zIHVwIGFkYXB0ZXIgc3BlY2lmaWMgaXRlbXMuIiIiCiAgICAgICAgcmFpc2UgTm90SW1wbGVtZW50ZWRFcnJvcgoKCmNsYXNzIEhUVFBBZGFwdGVyKEJhc2VBZGFwdGVyKToKICAgICIiIlRoZSBidWlsdC1pbiBIVFRQIEFkYXB0ZXIgZm9yIHVybGxpYjMuCgogICAgUHJvdmlkZXMgYSBnZW5lcmFsLWNhc2UgaW50ZXJmYWNlIGZvciBSZXF1ZXN0cyBzZXNzaW9ucyB0byBjb250YWN0IEhUVFAgYW5kCiAgICBIVFRQUyB1cmxzIGJ5IGltcGxlbWVudGluZyB0aGUgVHJhbnNwb3J0IEFkYXB0ZXIgaW50ZXJmYWNlLiBUaGlzIGNsYXNzIHdpbGwKICAgIHVzdWFsbHkgYmUgY3JlYXRlZCBieSB0aGUgOmNsYXNzOmBTZXNzaW9uIDxTZXNzaW9uPmAgY2xhc3MgdW5kZXIgdGhlCiAgICBjb3ZlcnMuCgogICAgOnBhcmFtIHBvb2xfY29ubmVjdGlvbnM6IFRoZSBudW1iZXIgb2YgdXJsbGliMyBjb25uZWN0aW9uIHBvb2xzIHRvIGNhY2hlLgogICAgOnBhcmFtIHBvb2xfbWF4c2l6ZTogVGhlIG1heGltdW0gbnVtYmVyIG9mIGNvbm5lY3Rpb25zIHRvIHNhdmUgaW4gdGhlIHBvb2wuCiAgICA6cGFyYW0gbWF4X3JldHJpZXM6IFRoZSBtYXhpbXVtIG51bWJlciBvZiByZXRyaWVzIGVhY2ggY29ubmVjdGlvbgogICAgICAgIHNob3VsZCBhdHRlbXB0LiBOb3RlLCB0aGlzIGFwcGxpZXMgb25seSB0byBmYWlsZWQgRE5TIGxvb2t1cHMsIHNvY2tldAogICAgICAgIGNvbm5lY3Rpb25zIGFuZCBjb25uZWN0aW9uIHRpbWVvdXRzLCBuZXZlciB0byByZXF1ZXN0cyB3aGVyZSBkYXRhIGhhcwogICAgICAgIG1hZGUgaXQgdG8gdGhlIHNlcnZlci4gQnkgZGVmYXVsdCwgUmVxdWVzdHMgZG9lcyBub3QgcmV0cnkgZmFpbGVkCiAgICAgICAgY29ubmVjdGlvbnMuIElmIHlvdSBuZWVkIGdyYW51bGFyIGNvbnRyb2wgb3ZlciB0aGUgY29uZGl0aW9ucyB1bmRlcgogICAgICAgIHdoaWNoIHdlIHJldHJ5IGEgcmVxdWVzdCwgaW1wb3J0IHVybGxpYjMncyBgYFJldHJ5YGAgY2xhc3MgYW5kIHBhc3MKICAgICAgICB0aGF0IGluc3RlYWQuCiAgICA6cGFyYW0gcG9vbF9ibG9jazogV2hldGhlciB0aGUgY29ubmVjdGlvbiBwb29sIHNob3VsZCBibG9jayBmb3IgY29ubmVjdGlvbnMuCgogICAgVXNhZ2U6OgoKICAgICAgPj4+IGltcG9ydCByZXF1ZXN0cwogICAgICA+Pj4gcyA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgICA+Pj4gYSA9IHJlcXVlc3RzLmFkYXB0ZXJzLkhUVFBBZGFwdGVyKG1heF9yZXRyaWVzPTMpCiAgICAgID4+PiBzLm1vdW50KCdodHRwOi8vJywgYSkKICAgICIiIgogICAgX19hdHRyc19fID0gWydtYXhfcmV0cmllcycsICdjb25maWcnLCAnX3Bvb2xfY29ubmVjdGlvbnMnLCAnX3Bvb2xfbWF4c2l6ZScsCiAgICAgICAgICAgICAgICAgJ19wb29sX2Jsb2NrJ10KCiAgICBkZWYgX19pbml0X18oc2VsZiwgcG9vbF9jb25uZWN0aW9ucz1ERUZBVUxUX1BPT0xTSVpFLAogICAgICAgICAgICAgICAgIHBvb2xfbWF4c2l6ZT1ERUZBVUxUX1BPT0xTSVpFLCBtYXhfcmV0cmllcz1ERUZBVUxUX1JFVFJJRVMsCiAgICAgICAgICAgICAgICAgcG9vbF9ibG9jaz1ERUZBVUxUX1BPT0xCTE9DSyk6CiAgICAgICAgaWYgbWF4X3JldHJpZXMgPT0gREVGQVVMVF9SRVRSSUVTOgogICAgICAgICAgICBzZWxmLm1heF9yZXRyaWVzID0gUmV0cnkoMCwgcmVhZD1GYWxzZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLm1heF9yZXRyaWVzID0gUmV0cnkuZnJvbV9pbnQobWF4X3JldHJpZXMpCiAgICAgICAgc2VsZi5jb25maWcgPSB7fQogICAgICAgIHNlbGYucHJveHlfbWFuYWdlciA9IHt9CgogICAgICAgIHN1cGVyKEhUVFBBZGFwdGVyLCBzZWxmKS5fX2luaXRfXygpCgogICAgICAgIHNlbGYuX3Bvb2xfY29ubmVjdGlvbnMgPSBwb29sX2Nvbm5lY3Rpb25zCiAgICAgICAgc2VsZi5fcG9vbF9tYXhzaXplID0gcG9vbF9tYXhzaXplCiAgICAgICAgc2VsZi5fcG9vbF9ibG9jayA9IHBvb2xfYmxvY2sKCiAgICAgICAgc2VsZi5pbml0X3Bvb2xtYW5hZ2VyKHBvb2xfY29ubmVjdGlvbnMsIHBvb2xfbWF4c2l6ZSwgYmxvY2s9cG9vbF9ibG9jaykKCiAgICBkZWYgX19nZXRzdGF0ZV9fKHNlbGYpOgogICAgICAgIHJldHVybiBkaWN0KChhdHRyLCBnZXRhdHRyKHNlbGYsIGF0dHIsIE5vbmUpKSBmb3IgYXR0ciBpbgogICAgICAgICAgICAgICAgICAgIHNlbGYuX19hdHRyc19fKQoKICAgIGRlZiBfX3NldHN0YXRlX18oc2VsZiwgc3RhdGUpOgogICAgICAgICMgQ2FuJ3QgaGFuZGxlIGJ5IGFkZGluZyAncHJveHlfbWFuYWdlcicgdG8gc2VsZi5fX2F0dHJzX18gYmVjYXVzZQogICAgICAgICMgc2VsZi5wb29sbWFuYWdlciB1c2VzIGEgbGFtYmRhIGZ1bmN0aW9uLCB3aGljaCBpc24ndCBwaWNrbGVhYmxlLgogICAgICAgIHNlbGYucHJveHlfbWFuYWdlciA9IHt9CiAgICAgICAgc2VsZi5jb25maWcgPSB7fQoKICAgICAgICBmb3IgYXR0ciwgdmFsdWUgaW4gc3RhdGUuaXRlbXMoKToKICAgICAgICAgICAgc2V0YXR0cihzZWxmLCBhdHRyLCB2YWx1ZSkKCiAgICAgICAgc2VsZi5pbml0X3Bvb2xtYW5hZ2VyKHNlbGYuX3Bvb2xfY29ubmVjdGlvbnMsIHNlbGYuX3Bvb2xfbWF4c2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2s9c2VsZi5fcG9vbF9ibG9jaykKCiAgICBkZWYgaW5pdF9wb29sbWFuYWdlcihzZWxmLCBjb25uZWN0aW9ucywgbWF4c2l6ZSwgYmxvY2s9REVGQVVMVF9QT09MQkxPQ0ssICoqcG9vbF9rd2FyZ3MpOgogICAgICAgICIiIkluaXRpYWxpemVzIGEgdXJsbGliMyBQb29sTWFuYWdlci4KCiAgICAgICAgVGhpcyBtZXRob2Qgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyIGNvZGUsIGFuZCBpcyBvbmx5CiAgICAgICAgZXhwb3NlZCBmb3IgdXNlIHdoZW4gc3ViY2xhc3NpbmcgdGhlCiAgICAgICAgOmNsYXNzOmBIVFRQQWRhcHRlciA8cmVxdWVzdHMuYWRhcHRlcnMuSFRUUEFkYXB0ZXI+YC4KCiAgICAgICAgOnBhcmFtIGNvbm5lY3Rpb25zOiBUaGUgbnVtYmVyIG9mIHVybGxpYjMgY29ubmVjdGlvbiBwb29scyB0byBjYWNoZS4KICAgICAgICA6cGFyYW0gbWF4c2l6ZTogVGhlIG1heGltdW0gbnVtYmVyIG9mIGNvbm5lY3Rpb25zIHRvIHNhdmUgaW4gdGhlIHBvb2wuCiAgICAgICAgOnBhcmFtIGJsb2NrOiBCbG9jayB3aGVuIG5vIGZyZWUgY29ubmVjdGlvbnMgYXJlIGF2YWlsYWJsZS4KICAgICAgICA6cGFyYW0gcG9vbF9rd2FyZ3M6IEV4dHJhIGtleXdvcmQgYXJndW1lbnRzIHVzZWQgdG8gaW5pdGlhbGl6ZSB0aGUgUG9vbCBNYW5hZ2VyLgogICAgICAgICIiIgogICAgICAgICMgc2F2ZSB0aGVzZSB2YWx1ZXMgZm9yIHBpY2tsaW5nCiAgICAgICAgc2VsZi5fcG9vbF9jb25uZWN0aW9ucyA9IGNvbm5lY3Rpb25zCiAgICAgICAgc2VsZi5fcG9vbF9tYXhzaXplID0gbWF4c2l6ZQogICAgICAgIHNlbGYuX3Bvb2xfYmxvY2sgPSBibG9jawoKICAgICAgICBzZWxmLnBvb2xtYW5hZ2VyID0gUG9vbE1hbmFnZXIobnVtX3Bvb2xzPWNvbm5lY3Rpb25zLCBtYXhzaXplPW1heHNpemUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrPWJsb2NrLCBzdHJpY3Q9VHJ1ZSwgKipwb29sX2t3YXJncykKCiAgICBkZWYgcHJveHlfbWFuYWdlcl9mb3Ioc2VsZiwgcHJveHksICoqcHJveHlfa3dhcmdzKToKICAgICAgICAiIiJSZXR1cm4gdXJsbGliMyBQcm94eU1hbmFnZXIgZm9yIHRoZSBnaXZlbiBwcm94eS4KCiAgICAgICAgVGhpcyBtZXRob2Qgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyIGNvZGUsIGFuZCBpcyBvbmx5CiAgICAgICAgZXhwb3NlZCBmb3IgdXNlIHdoZW4gc3ViY2xhc3NpbmcgdGhlCiAgICAgICAgOmNsYXNzOmBIVFRQQWRhcHRlciA8cmVxdWVzdHMuYWRhcHRlcnMuSFRUUEFkYXB0ZXI+YC4KCiAgICAgICAgOnBhcmFtIHByb3h5OiBUaGUgcHJveHkgdG8gcmV0dXJuIGEgdXJsbGliMyBQcm94eU1hbmFnZXIgZm9yLgogICAgICAgIDpwYXJhbSBwcm94eV9rd2FyZ3M6IEV4dHJhIGtleXdvcmQgYXJndW1lbnRzIHVzZWQgdG8gY29uZmlndXJlIHRoZSBQcm94eSBNYW5hZ2VyLgogICAgICAgIDpyZXR1cm5zOiBQcm94eU1hbmFnZXIKICAgICAgICA6cnR5cGU6IHVybGxpYjMuUHJveHlNYW5hZ2VyCiAgICAgICAgIiIiCiAgICAgICAgaWYgcHJveHkgaW4gc2VsZi5wcm94eV9tYW5hZ2VyOgogICAgICAgICAgICBtYW5hZ2VyID0gc2VsZi5wcm94eV9tYW5hZ2VyW3Byb3h5XQogICAgICAgIGVsaWYgcHJveHkubG93ZXIoKS5zdGFydHN3aXRoKCdzb2NrcycpOgogICAgICAgICAgICB1c2VybmFtZSwgcGFzc3dvcmQgPSBnZXRfYXV0aF9mcm9tX3VybChwcm94eSkKICAgICAgICAgICAgbWFuYWdlciA9IHNlbGYucHJveHlfbWFuYWdlcltwcm94eV0gPSBTT0NLU1Byb3h5TWFuYWdlcigKICAgICAgICAgICAgICAgIHByb3h5LAogICAgICAgICAgICAgICAgdXNlcm5hbWU9dXNlcm5hbWUsCiAgICAgICAgICAgICAgICBwYXNzd29yZD1wYXNzd29yZCwKICAgICAgICAgICAgICAgIG51bV9wb29scz1zZWxmLl9wb29sX2Nvbm5lY3Rpb25zLAogICAgICAgICAgICAgICAgbWF4c2l6ZT1zZWxmLl9wb29sX21heHNpemUsCiAgICAgICAgICAgICAgICBibG9jaz1zZWxmLl9wb29sX2Jsb2NrLAogICAgICAgICAgICAgICAgKipwcm94eV9rd2FyZ3MKICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByb3h5X2hlYWRlcnMgPSBzZWxmLnByb3h5X2hlYWRlcnMocHJveHkpCiAgICAgICAgICAgIG1hbmFnZXIgPSBzZWxmLnByb3h5X21hbmFnZXJbcHJveHldID0gcHJveHlfZnJvbV91cmwoCiAgICAgICAgICAgICAgICBwcm94eSwKICAgICAgICAgICAgICAgIHByb3h5X2hlYWRlcnM9cHJveHlfaGVhZGVycywKICAgICAgICAgICAgICAgIG51bV9wb29scz1zZWxmLl9wb29sX2Nvbm5lY3Rpb25zLAogICAgICAgICAgICAgICAgbWF4c2l6ZT1zZWxmLl9wb29sX21heHNpemUsCiAgICAgICAgICAgICAgICBibG9jaz1zZWxmLl9wb29sX2Jsb2NrLAogICAgICAgICAgICAgICAgKipwcm94eV9rd2FyZ3MpCgogICAgICAgIHJldHVybiBtYW5hZ2VyCgogICAgZGVmIGNlcnRfdmVyaWZ5KHNlbGYsIGNvbm4sIHVybCwgdmVyaWZ5LCBjZXJ0KToKICAgICAgICAiIiJWZXJpZnkgYSBTU0wgY2VydGlmaWNhdGUuIFRoaXMgbWV0aG9kIHNob3VsZCBub3QgYmUgY2FsbGVkIGZyb20gdXNlcgogICAgICAgIGNvZGUsIGFuZCBpcyBvbmx5IGV4cG9zZWQgZm9yIHVzZSB3aGVuIHN1YmNsYXNzaW5nIHRoZQogICAgICAgIDpjbGFzczpgSFRUUEFkYXB0ZXIgPHJlcXVlc3RzLmFkYXB0ZXJzLkhUVFBBZGFwdGVyPmAuCgogICAgICAgIDpwYXJhbSBjb25uOiBUaGUgdXJsbGliMyBjb25uZWN0aW9uIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggdGhlIGNlcnQuCiAgICAgICAgOnBhcmFtIHVybDogVGhlIHJlcXVlc3RlZCBVUkwuCiAgICAgICAgOnBhcmFtIHZlcmlmeTogRWl0aGVyIGEgYm9vbGVhbiwgaW4gd2hpY2ggY2FzZSBpdCBjb250cm9scyB3aGV0aGVyIHdlIHZlcmlmeQogICAgICAgICAgICB0aGUgc2VydmVyJ3MgVExTIGNlcnRpZmljYXRlLCBvciBhIHN0cmluZywgaW4gd2hpY2ggY2FzZSBpdCBtdXN0IGJlIGEgcGF0aAogICAgICAgICAgICB0byBhIENBIGJ1bmRsZSB0byB1c2UKICAgICAgICA6cGFyYW0gY2VydDogVGhlIFNTTCBjZXJ0aWZpY2F0ZSB0byB2ZXJpZnkuCiAgICAgICAgIiIiCiAgICAgICAgaWYgdXJsLmxvd2VyKCkuc3RhcnRzd2l0aCgnaHR0cHMnKSBhbmQgdmVyaWZ5OgoKICAgICAgICAgICAgY2VydF9sb2MgPSBOb25lCgogICAgICAgICAgICAjIEFsbG93IHNlbGYtc3BlY2lmaWVkIGNlcnQgbG9jYXRpb24uCiAgICAgICAgICAgIGlmIHZlcmlmeSBpcyBub3QgVHJ1ZToKICAgICAgICAgICAgICAgIGNlcnRfbG9jID0gdmVyaWZ5CgogICAgICAgICAgICBpZiBub3QgY2VydF9sb2M6CiAgICAgICAgICAgICAgICBjZXJ0X2xvYyA9IERFRkFVTFRfQ0FfQlVORExFX1BBVEgKCiAgICAgICAgICAgIGlmIG5vdCBjZXJ0X2xvYyBvciBub3Qgb3MucGF0aC5leGlzdHMoY2VydF9sb2MpOgogICAgICAgICAgICAgICAgcmFpc2UgSU9FcnJvcigiQ291bGQgbm90IGZpbmQgYSBzdWl0YWJsZSBUTFMgQ0EgY2VydGlmaWNhdGUgYnVuZGxlLCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbnZhbGlkIHBhdGg6IHswfSIuZm9ybWF0KGNlcnRfbG9jKSkKCiAgICAgICAgICAgIGNvbm4uY2VydF9yZXFzID0gJ0NFUlRfUkVRVUlSRUQnCgogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2RpcihjZXJ0X2xvYyk6CiAgICAgICAgICAgICAgICBjb25uLmNhX2NlcnRzID0gY2VydF9sb2MKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNvbm4uY2FfY2VydF9kaXIgPSBjZXJ0X2xvYwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbm4uY2VydF9yZXFzID0gJ0NFUlRfTk9ORScKICAgICAgICAgICAgY29ubi5jYV9jZXJ0cyA9IE5vbmUKICAgICAgICAgICAgY29ubi5jYV9jZXJ0X2RpciA9IE5vbmUKCiAgICAgICAgaWYgY2VydDoKICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UoY2VydCwgYmFzZXN0cmluZyk6CiAgICAgICAgICAgICAgICBjb25uLmNlcnRfZmlsZSA9IGNlcnRbMF0KICAgICAgICAgICAgICAgIGNvbm4ua2V5X2ZpbGUgPSBjZXJ0WzFdCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb25uLmNlcnRfZmlsZSA9IGNlcnQKICAgICAgICAgICAgICAgIGNvbm4ua2V5X2ZpbGUgPSBOb25lCiAgICAgICAgICAgIGlmIGNvbm4uY2VydF9maWxlIGFuZCBub3Qgb3MucGF0aC5leGlzdHMoY29ubi5jZXJ0X2ZpbGUpOgogICAgICAgICAgICAgICAgcmFpc2UgSU9FcnJvcigiQ291bGQgbm90IGZpbmQgdGhlIFRMUyBjZXJ0aWZpY2F0ZSBmaWxlLCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbnZhbGlkIHBhdGg6IHswfSIuZm9ybWF0KGNvbm4uY2VydF9maWxlKSkKICAgICAgICAgICAgaWYgY29ubi5rZXlfZmlsZSBhbmQgbm90IG9zLnBhdGguZXhpc3RzKGNvbm4ua2V5X2ZpbGUpOgogICAgICAgICAgICAgICAgcmFpc2UgSU9FcnJvcigiQ291bGQgbm90IGZpbmQgdGhlIFRMUyBrZXkgZmlsZSwgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW52YWxpZCBwYXRoOiB7MH0iLmZvcm1hdChjb25uLmtleV9maWxlKSkKCiAgICBkZWYgYnVpbGRfcmVzcG9uc2Uoc2VsZiwgcmVxLCByZXNwKToKICAgICAgICAiIiJCdWlsZHMgYSA6Y2xhc3M6YFJlc3BvbnNlIDxyZXF1ZXN0cy5SZXNwb25zZT5gIG9iamVjdCBmcm9tIGEgdXJsbGliMwogICAgICAgIHJlc3BvbnNlLiBUaGlzIHNob3VsZCBub3QgYmUgY2FsbGVkIGZyb20gdXNlciBjb2RlLCBhbmQgaXMgb25seSBleHBvc2VkCiAgICAgICAgZm9yIHVzZSB3aGVuIHN1YmNsYXNzaW5nIHRoZQogICAgICAgIDpjbGFzczpgSFRUUEFkYXB0ZXIgPHJlcXVlc3RzLmFkYXB0ZXJzLkhUVFBBZGFwdGVyPmAKCiAgICAgICAgOnBhcmFtIHJlcTogVGhlIDpjbGFzczpgUHJlcGFyZWRSZXF1ZXN0IDxQcmVwYXJlZFJlcXVlc3Q+YCB1c2VkIHRvIGdlbmVyYXRlIHRoZSByZXNwb25zZS4KICAgICAgICA6cGFyYW0gcmVzcDogVGhlIHVybGxpYjMgcmVzcG9uc2Ugb2JqZWN0LgogICAgICAgIDpydHlwZTogcmVxdWVzdHMuUmVzcG9uc2UKICAgICAgICAiIiIKICAgICAgICByZXNwb25zZSA9IFJlc3BvbnNlKCkKCiAgICAgICAgIyBGYWxsYmFjayB0byBOb25lIGlmIHRoZXJlJ3Mgbm8gc3RhdHVzX2NvZGUsIGZvciB3aGF0ZXZlciByZWFzb24uCiAgICAgICAgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPSBnZXRhdHRyKHJlc3AsICdzdGF0dXMnLCBOb25lKQoKICAgICAgICAjIE1ha2UgaGVhZGVycyBjYXNlLWluc2Vuc2l0aXZlLgogICAgICAgIHJlc3BvbnNlLmhlYWRlcnMgPSBDYXNlSW5zZW5zaXRpdmVEaWN0KGdldGF0dHIocmVzcCwgJ2hlYWRlcnMnLCB7fSkpCgogICAgICAgICMgU2V0IGVuY29kaW5nLgogICAgICAgIHJlc3BvbnNlLmVuY29kaW5nID0gZ2V0X2VuY29kaW5nX2Zyb21faGVhZGVycyhyZXNwb25zZS5oZWFkZXJzKQogICAgICAgIHJlc3BvbnNlLnJhdyA9IHJlc3AKICAgICAgICByZXNwb25zZS5yZWFzb24gPSByZXNwb25zZS5yYXcucmVhc29uCgogICAgICAgIGlmIGlzaW5zdGFuY2UocmVxLnVybCwgYnl0ZXMpOgogICAgICAgICAgICByZXNwb25zZS51cmwgPSByZXEudXJsLmRlY29kZSgndXRmLTgnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJlc3BvbnNlLnVybCA9IHJlcS51cmwKCiAgICAgICAgIyBBZGQgbmV3IGNvb2tpZXMgZnJvbSB0aGUgc2VydmVyLgogICAgICAgIGV4dHJhY3RfY29va2llc190b19qYXIocmVzcG9uc2UuY29va2llcywgcmVxLCByZXNwKQoKICAgICAgICAjIEdpdmUgdGhlIFJlc3BvbnNlIHNvbWUgY29udGV4dC4KICAgICAgICByZXNwb25zZS5yZXF1ZXN0ID0gcmVxCiAgICAgICAgcmVzcG9uc2UuY29ubmVjdGlvbiA9IHNlbGYKCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlCgogICAgZGVmIGdldF9jb25uZWN0aW9uKHNlbGYsIHVybCwgcHJveGllcz1Ob25lKToKICAgICAgICAiIiJSZXR1cm5zIGEgdXJsbGliMyBjb25uZWN0aW9uIGZvciB0aGUgZ2l2ZW4gVVJMLiBUaGlzIHNob3VsZCBub3QgYmUKICAgICAgICBjYWxsZWQgZnJvbSB1c2VyIGNvZGUsIGFuZCBpcyBvbmx5IGV4cG9zZWQgZm9yIHVzZSB3aGVuIHN1YmNsYXNzaW5nIHRoZQogICAgICAgIDpjbGFzczpgSFRUUEFkYXB0ZXIgPHJlcXVlc3RzLmFkYXB0ZXJzLkhUVFBBZGFwdGVyPmAuCgogICAgICAgIDpwYXJhbSB1cmw6IFRoZSBVUkwgdG8gY29ubmVjdCB0by4KICAgICAgICA6cGFyYW0gcHJveGllczogKG9wdGlvbmFsKSBBIFJlcXVlc3RzLXN0eWxlIGRpY3Rpb25hcnkgb2YgcHJveGllcyB1c2VkIG9uIHRoaXMgcmVxdWVzdC4KICAgICAgICA6cnR5cGU6IHVybGxpYjMuQ29ubmVjdGlvblBvb2wKICAgICAgICAiIiIKICAgICAgICBwcm94eSA9IHNlbGVjdF9wcm94eSh1cmwsIHByb3hpZXMpCgogICAgICAgIGlmIHByb3h5OgogICAgICAgICAgICBwcm94eSA9IHByZXBlbmRfc2NoZW1lX2lmX25lZWRlZChwcm94eSwgJ2h0dHAnKQogICAgICAgICAgICBwcm94eV9tYW5hZ2VyID0gc2VsZi5wcm94eV9tYW5hZ2VyX2Zvcihwcm94eSkKICAgICAgICAgICAgY29ubiA9IHByb3h5X21hbmFnZXIuY29ubmVjdGlvbl9mcm9tX3VybCh1cmwpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBPbmx5IHNjaGVtZSBzaG91bGQgYmUgbG93ZXIgY2FzZQogICAgICAgICAgICBwYXJzZWQgPSB1cmxwYXJzZSh1cmwpCiAgICAgICAgICAgIHVybCA9IHBhcnNlZC5nZXR1cmwoKQogICAgICAgICAgICBjb25uID0gc2VsZi5wb29sbWFuYWdlci5jb25uZWN0aW9uX2Zyb21fdXJsKHVybCkKCiAgICAgICAgcmV0dXJuIGNvbm4KCiAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgIiIiRGlzcG9zZXMgb2YgYW55IGludGVybmFsIHN0YXRlLgoKICAgICAgICBDdXJyZW50bHksIHRoaXMgY2xvc2VzIHRoZSBQb29sTWFuYWdlciBhbmQgYW55IGFjdGl2ZSBQcm94eU1hbmFnZXIsCiAgICAgICAgd2hpY2ggY2xvc2VzIGFueSBwb29sZWQgY29ubmVjdGlvbnMuCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5wb29sbWFuYWdlci5jbGVhcigpCiAgICAgICAgZm9yIHByb3h5IGluIHNlbGYucHJveHlfbWFuYWdlci52YWx1ZXMoKToKICAgICAgICAgICAgcHJveHkuY2xlYXIoKQoKICAgIGRlZiByZXF1ZXN0X3VybChzZWxmLCByZXF1ZXN0LCBwcm94aWVzKToKICAgICAgICAiIiJPYnRhaW4gdGhlIHVybCB0byB1c2Ugd2hlbiBtYWtpbmcgdGhlIGZpbmFsIHJlcXVlc3QuCgogICAgICAgIElmIHRoZSBtZXNzYWdlIGlzIGJlaW5nIHNlbnQgdGhyb3VnaCBhIEhUVFAgcHJveHksIHRoZSBmdWxsIFVSTCBoYXMgdG8KICAgICAgICBiZSB1c2VkLiBPdGhlcndpc2UsIHdlIHNob3VsZCBvbmx5IHVzZSB0aGUgcGF0aCBwb3J0aW9uIG9mIHRoZSBVUkwuCgogICAgICAgIFRoaXMgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyIGNvZGUsIGFuZCBpcyBvbmx5IGV4cG9zZWQgZm9yIHVzZQogICAgICAgIHdoZW4gc3ViY2xhc3NpbmcgdGhlCiAgICAgICAgOmNsYXNzOmBIVFRQQWRhcHRlciA8cmVxdWVzdHMuYWRhcHRlcnMuSFRUUEFkYXB0ZXI+YC4KCiAgICAgICAgOnBhcmFtIHJlcXVlc3Q6IFRoZSA6Y2xhc3M6YFByZXBhcmVkUmVxdWVzdCA8UHJlcGFyZWRSZXF1ZXN0PmAgYmVpbmcgc2VudC4KICAgICAgICA6cGFyYW0gcHJveGllczogQSBkaWN0aW9uYXJ5IG9mIHNjaGVtZXMgb3Igc2NoZW1lcyBhbmQgaG9zdHMgdG8gcHJveHkgVVJMcy4KICAgICAgICA6cnR5cGU6IHN0cgogICAgICAgICIiIgogICAgICAgIHByb3h5ID0gc2VsZWN0X3Byb3h5KHJlcXVlc3QudXJsLCBwcm94aWVzKQogICAgICAgIHNjaGVtZSA9IHVybHBhcnNlKHJlcXVlc3QudXJsKS5zY2hlbWUKCiAgICAgICAgaXNfcHJveGllZF9odHRwX3JlcXVlc3QgPSAocHJveHkgYW5kIHNjaGVtZSAhPSAnaHR0cHMnKQogICAgICAgIHVzaW5nX3NvY2tzX3Byb3h5ID0gRmFsc2UKICAgICAgICBpZiBwcm94eToKICAgICAgICAgICAgcHJveHlfc2NoZW1lID0gdXJscGFyc2UocHJveHkpLnNjaGVtZS5sb3dlcigpCiAgICAgICAgICAgIHVzaW5nX3NvY2tzX3Byb3h5ID0gcHJveHlfc2NoZW1lLnN0YXJ0c3dpdGgoJ3NvY2tzJykKCiAgICAgICAgdXJsID0gcmVxdWVzdC5wYXRoX3VybAogICAgICAgIGlmIGlzX3Byb3hpZWRfaHR0cF9yZXF1ZXN0IGFuZCBub3QgdXNpbmdfc29ja3NfcHJveHk6CiAgICAgICAgICAgIHVybCA9IHVybGRlZnJhZ2F1dGgocmVxdWVzdC51cmwpCgogICAgICAgIHJldHVybiB1cmwKCiAgICBkZWYgYWRkX2hlYWRlcnMoc2VsZiwgcmVxdWVzdCwgKiprd2FyZ3MpOgogICAgICAgICIiIkFkZCBhbnkgaGVhZGVycyBuZWVkZWQgYnkgdGhlIGNvbm5lY3Rpb24uIEFzIG9mIHYyLjAgdGhpcyBkb2VzCiAgICAgICAgbm90aGluZyBieSBkZWZhdWx0LCBidXQgaXMgbGVmdCBmb3Igb3ZlcnJpZGluZyBieSB1c2VycyB0aGF0IHN1YmNsYXNzCiAgICAgICAgdGhlIDpjbGFzczpgSFRUUEFkYXB0ZXIgPHJlcXVlc3RzLmFkYXB0ZXJzLkhUVFBBZGFwdGVyPmAuCgogICAgICAgIFRoaXMgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZnJvbSB1c2VyIGNvZGUsIGFuZCBpcyBvbmx5IGV4cG9zZWQgZm9yIHVzZQogICAgICAgIHdoZW4gc3ViY2xhc3NpbmcgdGhlCiAgICAgICAgOmNsYXNzOmBIVFRQQWRhcHRlciA8cmVxdWVzdHMuYWRhcHRlcnMuSFRUUEFkYXB0ZXI+YC4KCiAgICAgICAgOnBhcmFtIHJlcXVlc3Q6IFRoZSA6Y2xhc3M6YFByZXBhcmVkUmVxdWVzdCA8UHJlcGFyZWRSZXF1ZXN0PmAgdG8gYWRkIGhlYWRlcnMgdG8uCiAgICAgICAgOnBhcmFtIGt3YXJnczogVGhlIGtleXdvcmQgYXJndW1lbnRzIGZyb20gdGhlIGNhbGwgdG8gc2VuZCgpLgogICAgICAgICIiIgogICAgICAgIHBhc3MKCiAgICBkZWYgcHJveHlfaGVhZGVycyhzZWxmLCBwcm94eSk6CiAgICAgICAgIiIiUmV0dXJucyBhIGRpY3Rpb25hcnkgb2YgdGhlIGhlYWRlcnMgdG8gYWRkIHRvIGFueSByZXF1ZXN0IHNlbnQKICAgICAgICB0aHJvdWdoIGEgcHJveHkuIFRoaXMgd29ya3Mgd2l0aCB1cmxsaWIzIG1hZ2ljIHRvIGVuc3VyZSB0aGF0IHRoZXkgYXJlCiAgICAgICAgY29ycmVjdGx5IHNlbnQgdG8gdGhlIHByb3h5LCByYXRoZXIgdGhhbiBpbiBhIHR1bm5lbGxlZCByZXF1ZXN0IGlmCiAgICAgICAgQ09OTkVDVCBpcyBiZWluZyB1c2VkLgoKICAgICAgICBUaGlzIHNob3VsZCBub3QgYmUgY2FsbGVkIGZyb20gdXNlciBjb2RlLCBhbmQgaXMgb25seSBleHBvc2VkIGZvciB1c2UKICAgICAgICB3aGVuIHN1YmNsYXNzaW5nIHRoZQogICAgICAgIDpjbGFzczpgSFRUUEFkYXB0ZXIgPHJlcXVlc3RzLmFkYXB0ZXJzLkhUVFBBZGFwdGVyPmAuCgogICAgICAgIDpwYXJhbSBwcm94aWVzOiBUaGUgdXJsIG9mIHRoZSBwcm94eSBiZWluZyB1c2VkIGZvciB0aGlzIHJlcXVlc3QuCiAgICAgICAgOnJ0eXBlOiBkaWN0CiAgICAgICAgIiIiCiAgICAgICAgaGVhZGVycyA9IHt9CiAgICAgICAgdXNlcm5hbWUsIHBhc3N3b3JkID0gZ2V0X2F1dGhfZnJvbV91cmwocHJveHkpCgogICAgICAgIGlmIHVzZXJuYW1lOgogICAgICAgICAgICBoZWFkZXJzWydQcm94eS1BdXRob3JpemF0aW9uJ10gPSBfYmFzaWNfYXV0aF9zdHIodXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZCkKCiAgICAgICAgcmV0dXJuIGhlYWRlcnMKCiAgICBkZWYgc2VuZChzZWxmLCByZXF1ZXN0LCBzdHJlYW09RmFsc2UsIHRpbWVvdXQ9Tm9uZSwgdmVyaWZ5PVRydWUsIGNlcnQ9Tm9uZSwgcHJveGllcz1Ob25lKToKICAgICAgICAiIiJTZW5kcyBQcmVwYXJlZFJlcXVlc3Qgb2JqZWN0LiBSZXR1cm5zIFJlc3BvbnNlIG9iamVjdC4KCiAgICAgICAgOnBhcmFtIHJlcXVlc3Q6IFRoZSA6Y2xhc3M6YFByZXBhcmVkUmVxdWVzdCA8UHJlcGFyZWRSZXF1ZXN0PmAgYmVpbmcgc2VudC4KICAgICAgICA6cGFyYW0gc3RyZWFtOiAob3B0aW9uYWwpIFdoZXRoZXIgdG8gc3RyZWFtIHRoZSByZXF1ZXN0IGNvbnRlbnQuCiAgICAgICAgOnBhcmFtIHRpbWVvdXQ6IChvcHRpb25hbCkgSG93IGxvbmcgdG8gd2FpdCBmb3IgdGhlIHNlcnZlciB0byBzZW5kCiAgICAgICAgICAgIGRhdGEgYmVmb3JlIGdpdmluZyB1cCwgYXMgYSBmbG9hdCwgb3IgYSA6cmVmOmAoY29ubmVjdCB0aW1lb3V0LAogICAgICAgICAgICByZWFkIHRpbWVvdXQpIDx0aW1lb3V0cz5gIHR1cGxlLgogICAgICAgIDp0eXBlIHRpbWVvdXQ6IGZsb2F0IG9yIHR1cGxlIG9yIHVybGxpYjMgVGltZW91dCBvYmplY3QKICAgICAgICA6cGFyYW0gdmVyaWZ5OiAob3B0aW9uYWwpIEVpdGhlciBhIGJvb2xlYW4sIGluIHdoaWNoIGNhc2UgaXQgY29udHJvbHMgd2hldGhlcgogICAgICAgICAgICB3ZSB2ZXJpZnkgdGhlIHNlcnZlcidzIFRMUyBjZXJ0aWZpY2F0ZSwgb3IgYSBzdHJpbmcsIGluIHdoaWNoIGNhc2UgaXQKICAgICAgICAgICAgbXVzdCBiZSBhIHBhdGggdG8gYSBDQSBidW5kbGUgdG8gdXNlCiAgICAgICAgOnBhcmFtIGNlcnQ6IChvcHRpb25hbCkgQW55IHVzZXItcHJvdmlkZWQgU1NMIGNlcnRpZmljYXRlIHRvIGJlIHRydXN0ZWQuCiAgICAgICAgOnBhcmFtIHByb3hpZXM6IChvcHRpb25hbCkgVGhlIHByb3hpZXMgZGljdGlvbmFyeSB0byBhcHBseSB0byB0aGUgcmVxdWVzdC4KICAgICAgICA6cnR5cGU6IHJlcXVlc3RzLlJlc3BvbnNlCiAgICAgICAgIiIiCgogICAgICAgIGNvbm4gPSBzZWxmLmdldF9jb25uZWN0aW9uKHJlcXVlc3QudXJsLCBwcm94aWVzKQoKICAgICAgICBzZWxmLmNlcnRfdmVyaWZ5KGNvbm4sIHJlcXVlc3QudXJsLCB2ZXJpZnksIGNlcnQpCiAgICAgICAgdXJsID0gc2VsZi5yZXF1ZXN0X3VybChyZXF1ZXN0LCBwcm94aWVzKQogICAgICAgIHNlbGYuYWRkX2hlYWRlcnMocmVxdWVzdCkKCiAgICAgICAgY2h1bmtlZCA9IG5vdCAocmVxdWVzdC5ib2R5IGlzIE5vbmUgb3IgJ0NvbnRlbnQtTGVuZ3RoJyBpbiByZXF1ZXN0LmhlYWRlcnMpCgogICAgICAgIGlmIGlzaW5zdGFuY2UodGltZW91dCwgdHVwbGUpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjb25uZWN0LCByZWFkID0gdGltZW91dAogICAgICAgICAgICAgICAgdGltZW91dCA9IFRpbWVvdXRTYXVjZShjb25uZWN0PWNvbm5lY3QsIHJlYWQ9cmVhZCkKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3IgYXMgZToKICAgICAgICAgICAgICAgICMgdGhpcyBtYXkgcmFpc2UgYSBzdHJpbmcgZm9ybWF0dGluZyBlcnJvci4KICAgICAgICAgICAgICAgIGVyciA9ICgiSW52YWxpZCB0aW1lb3V0IHswfS4gUGFzcyBhIChjb25uZWN0LCByZWFkKSAiCiAgICAgICAgICAgICAgICAgICAgICAgInRpbWVvdXQgdHVwbGUsIG9yIGEgc2luZ2xlIGZsb2F0IHRvIHNldCAiCiAgICAgICAgICAgICAgICAgICAgICAgImJvdGggdGltZW91dHMgdG8gdGhlIHNhbWUgdmFsdWUiLmZvcm1hdCh0aW1lb3V0KSkKICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZXJyKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZSh0aW1lb3V0LCBUaW1lb3V0U2F1Y2UpOgogICAgICAgICAgICBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdGltZW91dCA9IFRpbWVvdXRTYXVjZShjb25uZWN0PXRpbWVvdXQsIHJlYWQ9dGltZW91dCkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3QgY2h1bmtlZDoKICAgICAgICAgICAgICAgIHJlc3AgPSBjb25uLnVybG9wZW4oCiAgICAgICAgICAgICAgICAgICAgbWV0aG9kPXJlcXVlc3QubWV0aG9kLAogICAgICAgICAgICAgICAgICAgIHVybD11cmwsCiAgICAgICAgICAgICAgICAgICAgYm9keT1yZXF1ZXN0LmJvZHksCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1yZXF1ZXN0LmhlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3Q9RmFsc2UsCiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0X3NhbWVfaG9zdD1GYWxzZSwKICAgICAgICAgICAgICAgICAgICBwcmVsb2FkX2NvbnRlbnQ9RmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZGVjb2RlX2NvbnRlbnQ9RmFsc2UsCiAgICAgICAgICAgICAgICAgICAgcmV0cmllcz1zZWxmLm1heF9yZXRyaWVzLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgIyBTZW5kIHRoZSByZXF1ZXN0LgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgaGFzYXR0cihjb25uLCAncHJveHlfcG9vbCcpOgogICAgICAgICAgICAgICAgICAgIGNvbm4gPSBjb25uLnByb3h5X3Bvb2wKCiAgICAgICAgICAgICAgICBsb3dfY29ubiA9IGNvbm4uX2dldF9jb25uKHRpbWVvdXQ9REVGQVVMVF9QT09MX1RJTUVPVVQpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGxvd19jb25uLnB1dHJlcXVlc3QocmVxdWVzdC5tZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwX2FjY2VwdF9lbmNvZGluZz1UcnVlKQoKICAgICAgICAgICAgICAgICAgICBmb3IgaGVhZGVyLCB2YWx1ZSBpbiByZXF1ZXN0LmhlYWRlcnMuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgbG93X2Nvbm4ucHV0aGVhZGVyKGhlYWRlciwgdmFsdWUpCgogICAgICAgICAgICAgICAgICAgIGxvd19jb25uLmVuZGhlYWRlcnMoKQoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByZXF1ZXN0LmJvZHk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvd19jb25uLnNlbmQoaGV4KGxlbihpKSlbMjpdLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG93X2Nvbm4uc2VuZChiJ1xyXG4nKQogICAgICAgICAgICAgICAgICAgICAgICBsb3dfY29ubi5zZW5kKGkpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvd19jb25uLnNlbmQoYidcclxuJykKICAgICAgICAgICAgICAgICAgICBsb3dfY29ubi5zZW5kKGInMFxyXG5cclxuJykKCiAgICAgICAgICAgICAgICAgICAgIyBSZWNlaXZlIHRoZSByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgRm9yIFB5dGhvbiAyLjcrIHZlcnNpb25zLCB1c2UgYnVmZmVyaW5nIG9mIEhUVFAKICAgICAgICAgICAgICAgICAgICAgICAgIyByZXNwb25zZXMKICAgICAgICAgICAgICAgICAgICAgICAgciA9IGxvd19jb25uLmdldHJlc3BvbnNlKGJ1ZmZlcmluZz1UcnVlKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBUeXBlRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgICMgRm9yIGNvbXBhdGliaWxpdHkgd2l0aCBQeXRob24gMi42IHZlcnNpb25zIGFuZCBiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBsb3dfY29ubi5nZXRyZXNwb25zZSgpCgogICAgICAgICAgICAgICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UuZnJvbV9odHRwbGliKAogICAgICAgICAgICAgICAgICAgICAgICByLAogICAgICAgICAgICAgICAgICAgICAgICBwb29sPWNvbm4sCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb249bG93X2Nvbm4sCiAgICAgICAgICAgICAgICAgICAgICAgIHByZWxvYWRfY29udGVudD1GYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVjb2RlX2NvbnRlbnQ9RmFsc2UKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgIyBJZiB3ZSBoaXQgYW55IHByb2JsZW1zIGhlcmUsIGNsZWFuIHVwIHRoZSBjb25uZWN0aW9uLgogICAgICAgICAgICAgICAgICAgICMgVGhlbiwgcmVyYWlzZSBzbyB0aGF0IHdlIGNhbiBoYW5kbGUgdGhlIGFjdHVhbCBleGNlcHRpb24uCiAgICAgICAgICAgICAgICAgICAgbG93X2Nvbm4uY2xvc2UoKQogICAgICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgIGV4Y2VwdCAoUHJvdG9jb2xFcnJvciwgc29ja2V0LmVycm9yKSBhcyBlcnI6CiAgICAgICAgICAgIHJhaXNlIENvbm5lY3Rpb25FcnJvcihlcnIsIHJlcXVlc3Q9cmVxdWVzdCkKCiAgICAgICAgZXhjZXB0IE1heFJldHJ5RXJyb3IgYXMgZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLnJlYXNvbiwgQ29ubmVjdFRpbWVvdXRFcnJvcik6CiAgICAgICAgICAgICAgICAjIFRPRE86IFJlbW92ZSB0aGlzIGluIDMuMC4wOiBzZWUgIzI4MTEKICAgICAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGUucmVhc29uLCBOZXdDb25uZWN0aW9uRXJyb3IpOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIENvbm5lY3RUaW1lb3V0KGUsIHJlcXVlc3Q9cmVxdWVzdCkKCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZS5yZWFzb24sIFJlc3BvbnNlRXJyb3IpOgogICAgICAgICAgICAgICAgcmFpc2UgUmV0cnlFcnJvcihlLCByZXF1ZXN0PXJlcXVlc3QpCgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGUucmVhc29uLCBfUHJveHlFcnJvcik6CiAgICAgICAgICAgICAgICByYWlzZSBQcm94eUVycm9yKGUsIHJlcXVlc3Q9cmVxdWVzdCkKCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZS5yZWFzb24sIF9TU0xFcnJvcik6CiAgICAgICAgICAgICAgICAjIFRoaXMgYnJhbmNoIGlzIGZvciB1cmxsaWIzIHYxLjIyIGFuZCBsYXRlci4KICAgICAgICAgICAgICAgIHJhaXNlIFNTTEVycm9yKGUsIHJlcXVlc3Q9cmVxdWVzdCkKCiAgICAgICAgICAgIHJhaXNlIENvbm5lY3Rpb25FcnJvcihlLCByZXF1ZXN0PXJlcXVlc3QpCgogICAgICAgIGV4Y2VwdCBDbG9zZWRQb29sRXJyb3IgYXMgZToKICAgICAgICAgICAgcmFpc2UgQ29ubmVjdGlvbkVycm9yKGUsIHJlcXVlc3Q9cmVxdWVzdCkKCiAgICAgICAgZXhjZXB0IF9Qcm94eUVycm9yIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIFByb3h5RXJyb3IoZSkKCiAgICAgICAgZXhjZXB0IChfU1NMRXJyb3IsIF9IVFRQRXJyb3IpIGFzIGU6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZSwgX1NTTEVycm9yKToKICAgICAgICAgICAgICAgICMgVGhpcyBicmFuY2ggaXMgZm9yIHVybGxpYjMgdmVyc2lvbnMgZWFybGllciB0aGFuIHYxLjIyCiAgICAgICAgICAgICAgICByYWlzZSBTU0xFcnJvcihlLCByZXF1ZXN0PXJlcXVlc3QpCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShlLCBSZWFkVGltZW91dEVycm9yKToKICAgICAgICAgICAgICAgIHJhaXNlIFJlYWRUaW1lb3V0KGUsIHJlcXVlc3Q9cmVxdWVzdCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgIHJldHVybiBzZWxmLmJ1aWxkX3Jlc3BvbnNlKHJlcXVlc3QsIHJlc3ApCg==
