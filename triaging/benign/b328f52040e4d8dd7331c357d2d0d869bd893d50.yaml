statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_win/asymmetric.py
  contents:
  - name: Certificate.self_signed
    score: 0.0
    code: |-
      @property
          def self_signed(self):
              """
              :return:
                  A boolean - if the certificate is self-signed
              """

              if self._self_signed is None:
                  self._self_signed = False
                  if self.asn1.self_signed in set(['yes', 'maybe']):

                      signature_algo = self.asn1['signature_algorithm'].signature_algo
                      hash_algo = self.asn1['signature_algorithm'].hash_algo

                      if signature_algo == 'rsassa_pkcs1v15':
                          verify_func = rsa_pkcs1v15_verify
                      elif signature_algo == 'rsassa_pss':
                          verify_func = rsa_pss_verify
                      elif signature_algo == 'dsa':
                          verify_func = dsa_verify
                      elif signature_algo == 'ecdsa':
                          verify_func = ecdsa_verify
                      else:
                          raise OSError(pretty_message(
                              '''
                              Unable to verify the signature of the certificate since
                              it uses the unsupported algorithm %s
                              ''',
                              signature_algo
                          ))

                      try:
                          verify_func(
                              self,
                              self.asn1['signature_value'].native,
                              self.asn1['tbs_certificate'].dump(),
                              hash_algo
                          )
                          self._self_signed = True
                      except (SignatureError):
                          pass

              return self._self_signed
    tokens: resume load_fast self load_attr _self_signed pop_jump_if_not_none TO_NUMBER load_const INTEGER load_fast self store_attr _self_signed load_fast self load_attr asn1 load_attr self_signed load_global set load_const yes load_const maybe build_list call contains_op pop_jump_if_false TO_NUMBER load_fast self load_attr asn1 load_const STRING_LEN_S_ENT_HIGH binary_subscr load_attr signature_algo store_fast signature_algo load_fast self load_attr asn1 load_const STRING_LEN_S_ENT_HIGH binary_subscr load_attr hash_algo store_fast hash_algo load_fast signature_algo load_const rsassa_pkcs1v15 compare_op == pop_jump_if_false TO_NUMBER load_global STRING_LEN_S_ENT_HIGH store_fast verify_func jump_forward TO_NUMBER load_fast signature_algo load_const rsassa_pss compare_op == pop_jump_if_false TO_NUMBER load_global rsa_pss_verify store_fast verify_func jump_forward TO_NUMBER load_fast signature_algo load_const dsa compare_op == pop_jump_if_false TO_NUMBER load_global dsa_verify store_fast verify_func jump_forward TO_NUMBER load_fast signature_algo load_const ecdsa compare_op == pop_jump_if_false TO_NUMBER load_global ecdsa_verify store_fast verify_func jump_forward TO_NUMBER load_global OSError load_global pretty_message load_const STRING_LEN_S_ENT_HIGH load_fast signature_algo call call raise_varargs nop push_null load_fast verify_func load_fast self load_fast self load_attr asn1 load_const signature_value binary_subscr load_attr native load_fast self load_attr asn1 load_const tbs_certificate binary_subscr load_attr dump call load_fast hash_algo call pop_top load_const INTEGER load_fast self store_attr _self_signed load_fast self load_attr _self_signed return_value load_fast self load_attr _self_signed return_value push_exc_info load_global SignatureError check_exc_match pop_jump_if_false TO_NUMBER pop_top pop_except load_fast self load_attr _self_signed return_value reraise copy pop_except reraise
    hash: 1be558e000c73e6c68b84d995c778fac31270556e2eb465a453f0340fb4058dd
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_win/asymmetric.py
  : IyBjb2Rpbmc6IHV0Zi04CmZyb20gX19mdXR1cmVfXyBpbXBvcnQgdW5pY29kZV9saXRlcmFscywgZGl2aXNpb24sIGFic29sdXRlX2ltcG9ydCwgcHJpbnRfZnVuY3Rpb24KCmltcG9ydCBvcwppbXBvcnQgc3lzCmltcG9ydCBoYXNobGliCmltcG9ydCByYW5kb20KCmZyb20gLi5fYXNuMSBpbXBvcnQgKAogICAgQ2VydGlmaWNhdGUgYXMgQXNuMUNlcnRpZmljYXRlLAogICAgREhQYXJhbWV0ZXJzLAogICAgRFNBUGFyYW1zLAogICAgRFNBU2lnbmF0dXJlLAogICAgRUNEb21haW5QYXJhbWV0ZXJzLAogICAgRUNQcml2YXRlS2V5LAogICAgSW50ZWdlciwKICAgIGludF9mcm9tX2J5dGVzLAogICAgaW50X3RvX2J5dGVzLAogICAgUHJpdmF0ZUtleUFsZ29yaXRobSwKICAgIFByaXZhdGVLZXlJbmZvLAogICAgUHVibGljS2V5QWxnb3JpdGhtLAogICAgUHVibGljS2V5SW5mbywKICAgIFJTQVByaXZhdGVLZXksCiAgICBSU0FQdWJsaWNLZXksCikKZnJvbSAuLl9hc3ltbWV0cmljIGltcG9ydCAoCiAgICBfQ2VydGlmaWNhdGVCYXNlLAogICAgX2ZpbmdlcnByaW50LAogICAgX3BhcnNlX3BrY3MxMiwKICAgIF9Qcml2YXRlS2V5QmFzZSwKICAgIF9QdWJsaWNLZXlCYXNlLAogICAgX3Vud3JhcF9wcml2YXRlX2tleV9pbmZvLAogICAgcGFyc2VfY2VydGlmaWNhdGUsCiAgICBwYXJzZV9wcml2YXRlLAogICAgcGFyc2VfcHVibGljLAopCmZyb20gLi5fZXJyb3JzIGltcG9ydCBwcmV0dHlfbWVzc2FnZQpmcm9tIC4uX2ZmaSBpbXBvcnQgKAogICAgYnVmZmVyX2Zyb21fYnl0ZXMsCiAgICBidWZmZXJfZnJvbV91bmljb2RlLAogICAgYnl0ZV9hcnJheSwKICAgIGJ5dGVzX2Zyb21fYnVmZmVyLAogICAgY2FzdCwKICAgIGRlcmVmLAogICAgbmF0aXZlLAogICAgbmV3LAogICAgbnVsbCwKICAgIHBvaW50ZXJfc2V0LAogICAgc2l6ZW9mLAogICAgc3RydWN0LAogICAgc3RydWN0X2J5dGVzLAogICAgc3RydWN0X2Zyb21fYnVmZmVyLAogICAgdW53cmFwLAogICAgd3JpdGVfdG9fYnVmZmVyLAopCmZyb20gLi4gaW1wb3J0IGJhY2tlbmQKZnJvbSAuLl9pbnQgaW1wb3J0IGZpbGxfd2lkdGgKZnJvbSAuLmVycm9ycyBpbXBvcnQgQXN5bW1ldHJpY0tleUVycm9yLCBJbmNvbXBsZXRlQXN5bW1ldHJpY0tleUVycm9yLCBTaWduYXR1cmVFcnJvcgpmcm9tIC4uX3R5cGVzIGltcG9ydCB0eXBlX25hbWUsIHN0cl9jbHMsIGJ5dGVfY2xzLCBpbnRfdHlwZXMKZnJvbSAuLl9wa2NzMSBpbXBvcnQgKAogICAgYWRkX3BrY3MxdjE1X3NpZ25hdHVyZV9wYWRkaW5nLAogICAgYWRkX3Bzc19wYWRkaW5nLAogICAgcmF3X3JzYV9wcml2YXRlX2NyeXB0LAogICAgcmF3X3JzYV9wdWJsaWNfY3J5cHQsCiAgICByZW1vdmVfcGtjczF2MTVfc2lnbmF0dXJlX3BhZGRpbmcsCiAgICB2ZXJpZnlfcHNzX3BhZGRpbmcsCikKZnJvbSAuLnV0aWwgaW1wb3J0IGNvbnN0YW50X2NvbXBhcmUKCl9nd3YgPSBzeXMuZ2V0d2luZG93c3ZlcnNpb24oKQpfd2luX3ZlcnNpb25faW5mbyA9IChfZ3d2WzBdLCBfZ3d2WzFdKQpfYmFja2VuZCA9IGJhY2tlbmQoKQoKaWYgX2JhY2tlbmQgPT0gJ3dpbmxlZ2FjeSc6CiAgICBmcm9tIC5fYWR2YXBpMzIgaW1wb3J0IGFkdmFwaTMyLCBBZHZhcGkzMkNvbnN0LCBoYW5kbGVfZXJyb3IsIG9wZW5fY29udGV4dF9oYW5kbGUsIGNsb3NlX2NvbnRleHRfaGFuZGxlCiAgICBmcm9tIC4uX2VjZHNhIGltcG9ydCAoCiAgICAgICAgZWNfZ2VuZXJhdGVfcGFpciBhcyBfcHVyZV9weXRob25fZWNfZ2VuZXJhdGVfcGFpciwKICAgICAgICBlY19jb21wdXRlX3B1YmxpY19rZXlfcG9pbnQgYXMgX3B1cmVfcHl0aG9uX2VjX2NvbXB1dGVfcHVibGljX2tleV9wb2ludCwKICAgICAgICBlY19wdWJsaWNfa2V5X2luZm8sCiAgICAgICAgZWNkc2Ffc2lnbiBhcyBfcHVyZV9weXRob25fZWNkc2Ffc2lnbiwKICAgICAgICBlY2RzYV92ZXJpZnkgYXMgX3B1cmVfcHl0aG9uX2VjZHNhX3ZlcmlmeSwKICAgICkKZWxzZToKICAgIGZyb20gLl9jbmcgaW1wb3J0IGJjcnlwdCwgQmNyeXB0Q29uc3QsIGhhbmRsZV9lcnJvciwgb3Blbl9hbGdfaGFuZGxlLCBjbG9zZV9hbGdfaGFuZGxlCgoKX19hbGxfXyA9IFsKICAgICdDZXJ0aWZpY2F0ZScsCiAgICAnZHNhX3NpZ24nLAogICAgJ2RzYV92ZXJpZnknLAogICAgJ2VjZHNhX3NpZ24nLAogICAgJ2VjZHNhX3ZlcmlmeScsCiAgICAnZ2VuZXJhdGVfcGFpcicsCiAgICAnbG9hZF9jZXJ0aWZpY2F0ZScsCiAgICAnbG9hZF9wa2NzMTInLAogICAgJ2xvYWRfcHJpdmF0ZV9rZXknLAogICAgJ2xvYWRfcHVibGljX2tleScsCiAgICAncGFyc2VfcGtjczEyJywKICAgICdQcml2YXRlS2V5JywKICAgICdQdWJsaWNLZXknLAogICAgJ3JzYV9vYWVwX2RlY3J5cHQnLAogICAgJ3JzYV9vYWVwX2VuY3J5cHQnLAogICAgJ3JzYV9wa2NzMXYxNV9kZWNyeXB0JywKICAgICdyc2FfcGtjczF2MTVfZW5jcnlwdCcsCiAgICAncnNhX3BrY3MxdjE1X3NpZ24nLAogICAgJ3JzYV9wa2NzMXYxNV92ZXJpZnknLAogICAgJ3JzYV9wc3Nfc2lnbicsCiAgICAncnNhX3Bzc192ZXJpZnknLApdCgoKIyBBIGxpc3Qgb2YgcHJpbWVzIGZyb20gT3BlblNTTCdzIGJuX3ByaW1lLmggdG8gdXNlIHdoZW4gdGVzdGluZyBwcmltYWxpdHkgb2YgYQojIGxhcmdlIGludGVnZXIKX1NNQUxMX1BSSU1FUyA9IFsKICAgIDIsIDMsIDUsIDcsIDExLCAxMywgMTcsIDE5LAogICAgMjMsIDI5LCAzMSwgMzcsIDQxLCA0MywgNDcsIDUzLAogICAgNTksIDYxLCA2NywgNzEsIDczLCA3OSwgODMsIDg5LAogICAgOTcsIDEwMSwgMTAzLCAxMDcsIDEwOSwgMTEzLCAxMjcsIDEzMSwKICAgIDEzNywgMTM5LCAxNDksIDE1MSwgMTU3LCAxNjMsIDE2NywgMTczLAogICAgMTc5LCAxODEsIDE5MSwgMTkzLCAxOTcsIDE5OSwgMjExLCAyMjMsCiAgICAyMjcsIDIyOSwgMjMzLCAyMzksIDI0MSwgMjUxLCAyNTcsIDI2MywKICAgIDI2OSwgMjcxLCAyNzcsIDI4MSwgMjgzLCAyOTMsIDMwNywgMzExLAogICAgMzEzLCAzMTcsIDMzMSwgMzM3LCAzNDcsIDM0OSwgMzUzLCAzNTksCiAgICAzNjcsIDM3MywgMzc5LCAzODMsIDM4OSwgMzk3LCA0MDEsIDQwOSwKICAgIDQxOSwgNDIxLCA0MzEsIDQzMywgNDM5LCA0NDMsIDQ0OSwgNDU3LAogICAgNDYxLCA0NjMsIDQ2NywgNDc5LCA0ODcsIDQ5MSwgNDk5LCA1MDMsCiAgICA1MDksIDUyMSwgNTIzLCA1NDEsIDU0NywgNTU3LCA1NjMsIDU2OSwKICAgIDU3MSwgNTc3LCA1ODcsIDU5MywgNTk5LCA2MDEsIDYwNywgNjEzLAogICAgNjE3LCA2MTksIDYzMSwgNjQxLCA2NDMsIDY0NywgNjUzLCA2NTksCiAgICA2NjEsIDY3MywgNjc3LCA2ODMsIDY5MSwgNzAxLCA3MDksIDcxOSwKICAgIDcyNywgNzMzLCA3MzksIDc0MywgNzUxLCA3NTcsIDc2MSwgNzY5LAogICAgNzczLCA3ODcsIDc5NywgODA5LCA4MTEsIDgyMSwgODIzLCA4MjcsCiAgICA4MjksIDgzOSwgODUzLCA4NTcsIDg1OSwgODYzLCA4NzcsIDg4MSwKICAgIDg4MywgODg3LCA5MDcsIDkxMSwgOTE5LCA5MjksIDkzNywgOTQxLAogICAgOTQ3LCA5NTMsIDk2NywgOTcxLCA5NzcsIDk4MywgOTkxLCA5OTcsCiAgICAxMDA5LCAxMDEzLCAxMDE5LCAxMDIxLCAxMDMxLCAxMDMzLCAxMDM5LCAxMDQ5LAogICAgMTA1MSwgMTA2MSwgMTA2MywgMTA2OSwgMTA4NywgMTA5MSwgMTA5MywgMTA5NywKICAgIDExMDMsIDExMDksIDExMTcsIDExMjMsIDExMjksIDExNTEsIDExNTMsIDExNjMsCiAgICAxMTcxLCAxMTgxLCAxMTg3LCAxMTkzLCAxMjAxLCAxMjEzLCAxMjE3LCAxMjIzLAogICAgMTIyOSwgMTIzMSwgMTIzNywgMTI0OSwgMTI1OSwgMTI3NywgMTI3OSwgMTI4MywKICAgIDEyODksIDEyOTEsIDEyOTcsIDEzMDEsIDEzMDMsIDEzMDcsIDEzMTksIDEzMjEsCiAgICAxMzI3LCAxMzYxLCAxMzY3LCAxMzczLCAxMzgxLCAxMzk5LCAxNDA5LCAxNDIzLAogICAgMTQyNywgMTQyOSwgMTQzMywgMTQzOSwgMTQ0NywgMTQ1MSwgMTQ1MywgMTQ1OSwKICAgIDE0NzEsIDE0ODEsIDE0ODMsIDE0ODcsIDE0ODksIDE0OTMsIDE0OTksIDE1MTEsCiAgICAxNTIzLCAxNTMxLCAxNTQzLCAxNTQ5LCAxNTUzLCAxNTU5LCAxNTY3LCAxNTcxLAogICAgMTU3OSwgMTU4MywgMTU5NywgMTYwMSwgMTYwNywgMTYwOSwgMTYxMywgMTYxOSwKICAgIDE2MjEsIDE2MjcsIDE2MzcsIDE2NTcsIDE2NjMsIDE2NjcsIDE2NjksIDE2OTMsCiAgICAxNjk3LCAxNjk5LCAxNzA5LCAxNzIxLCAxNzIzLCAxNzMzLCAxNzQxLCAxNzQ3LAogICAgMTc1MywgMTc1OSwgMTc3NywgMTc4MywgMTc4NywgMTc4OSwgMTgwMSwgMTgxMSwKICAgIDE4MjMsIDE4MzEsIDE4NDcsIDE4NjEsIDE4NjcsIDE4NzEsIDE4NzMsIDE4NzcsCiAgICAxODc5LCAxODg5LCAxOTAxLCAxOTA3LCAxOTEzLCAxOTMxLCAxOTMzLCAxOTQ5LAogICAgMTk1MSwgMTk3MywgMTk3OSwgMTk4NywgMTk5MywgMTk5NywgMTk5OSwgMjAwMywKICAgIDIwMTEsIDIwMTcsIDIwMjcsIDIwMjksIDIwMzksIDIwNTMsIDIwNjMsIDIwNjksCiAgICAyMDgxLCAyMDgzLCAyMDg3LCAyMDg5LCAyMDk5LCAyMTExLCAyMTEzLCAyMTI5LAogICAgMjEzMSwgMjEzNywgMjE0MSwgMjE0MywgMjE1MywgMjE2MSwgMjE3OSwgMjIwMywKICAgIDIyMDcsIDIyMTMsIDIyMjEsIDIyMzcsIDIyMzksIDIyNDMsIDIyNTEsIDIyNjcsCiAgICAyMjY5LCAyMjczLCAyMjgxLCAyMjg3LCAyMjkzLCAyMjk3LCAyMzA5LCAyMzExLAogICAgMjMzMywgMjMzOSwgMjM0MSwgMjM0NywgMjM1MSwgMjM1NywgMjM3MSwgMjM3NywKICAgIDIzODEsIDIzODMsIDIzODksIDIzOTMsIDIzOTksIDI0MTEsIDI0MTcsIDI0MjMsCiAgICAyNDM3LCAyNDQxLCAyNDQ3LCAyNDU5LCAyNDY3LCAyNDczLCAyNDc3LCAyNTAzLAogICAgMjUyMSwgMjUzMSwgMjUzOSwgMjU0MywgMjU0OSwgMjU1MSwgMjU1NywgMjU3OSwKICAgIDI1OTEsIDI1OTMsIDI2MDksIDI2MTcsIDI2MjEsIDI2MzMsIDI2NDcsIDI2NTcsCiAgICAyNjU5LCAyNjYzLCAyNjcxLCAyNjc3LCAyNjgzLCAyNjg3LCAyNjg5LCAyNjkzLAogICAgMjY5OSwgMjcwNywgMjcxMSwgMjcxMywgMjcxOSwgMjcyOSwgMjczMSwgMjc0MSwKICAgIDI3NDksIDI3NTMsIDI3NjcsIDI3NzcsIDI3ODksIDI3OTEsIDI3OTcsIDI4MDEsCiAgICAyODAzLCAyODE5LCAyODMzLCAyODM3LCAyODQzLCAyODUxLCAyODU3LCAyODYxLAogICAgMjg3OSwgMjg4NywgMjg5NywgMjkwMywgMjkwOSwgMjkxNywgMjkyNywgMjkzOSwKICAgIDI5NTMsIDI5NTcsIDI5NjMsIDI5NjksIDI5NzEsIDI5OTksIDMwMDEsIDMwMTEsCiAgICAzMDE5LCAzMDIzLCAzMDM3LCAzMDQxLCAzMDQ5LCAzMDYxLCAzMDY3LCAzMDc5LAogICAgMzA4MywgMzA4OSwgMzEwOSwgMzExOSwgMzEyMSwgMzEzNywgMzE2MywgMzE2NywKICAgIDMxNjksIDMxODEsIDMxODcsIDMxOTEsIDMyMDMsIDMyMDksIDMyMTcsIDMyMjEsCiAgICAzMjI5LCAzMjUxLCAzMjUzLCAzMjU3LCAzMjU5LCAzMjcxLCAzMjk5LCAzMzAxLAogICAgMzMwNywgMzMxMywgMzMxOSwgMzMyMywgMzMyOSwgMzMzMSwgMzM0MywgMzM0NywKICAgIDMzNTksIDMzNjEsIDMzNzEsIDMzNzMsIDMzODksIDMzOTEsIDM0MDcsIDM0MTMsCiAgICAzNDMzLCAzNDQ5LCAzNDU3LCAzNDYxLCAzNDYzLCAzNDY3LCAzNDY5LCAzNDkxLAogICAgMzQ5OSwgMzUxMSwgMzUxNywgMzUyNywgMzUyOSwgMzUzMywgMzUzOSwgMzU0MSwKICAgIDM1NDcsIDM1NTcsIDM1NTksIDM1NzEsIDM1ODEsIDM1ODMsIDM1OTMsIDM2MDcsCiAgICAzNjEzLCAzNjE3LCAzNjIzLCAzNjMxLCAzNjM3LCAzNjQzLCAzNjU5LCAzNjcxLAogICAgMzY3MywgMzY3NywgMzY5MSwgMzY5NywgMzcwMSwgMzcwOSwgMzcxOSwgMzcyNywKICAgIDM3MzMsIDM3MzksIDM3NjEsIDM3NjcsIDM3NjksIDM3NzksIDM3OTMsIDM3OTcsCiAgICAzODAzLCAzODIxLCAzODIzLCAzODMzLCAzODQ3LCAzODUxLCAzODUzLCAzODYzLAogICAgMzg3NywgMzg4MSwgMzg4OSwgMzkwNywgMzkxMSwgMzkxNywgMzkxOSwgMzkyMywKICAgIDM5MjksIDM5MzEsIDM5NDMsIDM5NDcsIDM5NjcsIDM5ODksIDQwMDEsIDQwMDMsCiAgICA0MDA3LCA0MDEzLCA0MDE5LCA0MDIxLCA0MDI3LCA0MDQ5LCA0MDUxLCA0MDU3LAogICAgNDA3MywgNDA3OSwgNDA5MSwgNDA5MywgNDA5OSwgNDExMSwgNDEyNywgNDEyOSwKICAgIDQxMzMsIDQxMzksIDQxNTMsIDQxNTcsIDQxNTksIDQxNzcsIDQyMDEsIDQyMTEsCiAgICA0MjE3LCA0MjE5LCA0MjI5LCA0MjMxLCA0MjQxLCA0MjQzLCA0MjUzLCA0MjU5LAogICAgNDI2MSwgNDI3MSwgNDI3MywgNDI4MywgNDI4OSwgNDI5NywgNDMyNywgNDMzNywKICAgIDQzMzksIDQzNDksIDQzNTcsIDQzNjMsIDQzNzMsIDQzOTEsIDQzOTcsIDQ0MDksCiAgICA0NDIxLCA0NDIzLCA0NDQxLCA0NDQ3LCA0NDUxLCA0NDU3LCA0NDYzLCA0NDgxLAogICAgNDQ4MywgNDQ5MywgNDUwNywgNDUxMywgNDUxNywgNDUxOSwgNDUyMywgNDU0NywKICAgIDQ1NDksIDQ1NjEsIDQ1NjcsIDQ1ODMsIDQ1OTEsIDQ1OTcsIDQ2MDMsIDQ2MjEsCiAgICA0NjM3LCA0NjM5LCA0NjQzLCA0NjQ5LCA0NjUxLCA0NjU3LCA0NjYzLCA0NjczLAogICAgNDY3OSwgNDY5MSwgNDcwMywgNDcyMSwgNDcyMywgNDcyOSwgNDczMywgNDc1MSwKICAgIDQ3NTksIDQ3ODMsIDQ3ODcsIDQ3ODksIDQ3OTMsIDQ3OTksIDQ4MDEsIDQ4MTMsCiAgICA0ODE3LCA0ODMxLCA0ODYxLCA0ODcxLCA0ODc3LCA0ODg5LCA0OTAzLCA0OTA5LAogICAgNDkxOSwgNDkzMSwgNDkzMywgNDkzNywgNDk0MywgNDk1MSwgNDk1NywgNDk2NywKICAgIDQ5NjksIDQ5NzMsIDQ5ODcsIDQ5OTMsIDQ5OTksIDUwMDMsIDUwMDksIDUwMTEsCiAgICA1MDIxLCA1MDIzLCA1MDM5LCA1MDUxLCA1MDU5LCA1MDc3LCA1MDgxLCA1MDg3LAogICAgNTA5OSwgNTEwMSwgNTEwNywgNTExMywgNTExOSwgNTE0NywgNTE1MywgNTE2NywKICAgIDUxNzEsIDUxNzksIDUxODksIDUxOTcsIDUyMDksIDUyMjcsIDUyMzEsIDUyMzMsCiAgICA1MjM3LCA1MjYxLCA1MjczLCA1Mjc5LCA1MjgxLCA1Mjk3LCA1MzAzLCA1MzA5LAogICAgNTMyMywgNTMzMywgNTM0NywgNTM1MSwgNTM4MSwgNTM4NywgNTM5MywgNTM5OSwKICAgIDU0MDcsIDU0MTMsIDU0MTcsIDU0MTksIDU0MzEsIDU0MzcsIDU0NDEsIDU0NDMsCiAgICA1NDQ5LCA1NDcxLCA1NDc3LCA1NDc5LCA1NDgzLCA1NTAxLCA1NTAzLCA1NTA3LAogICAgNTUxOSwgNTUyMSwgNTUyNywgNTUzMSwgNTU1NywgNTU2MywgNTU2OSwgNTU3MywKICAgIDU1ODEsIDU1OTEsIDU2MjMsIDU2MzksIDU2NDEsIDU2NDcsIDU2NTEsIDU2NTMsCiAgICA1NjU3LCA1NjU5LCA1NjY5LCA1NjgzLCA1Njg5LCA1NjkzLCA1NzAxLCA1NzExLAogICAgNTcxNywgNTczNywgNTc0MSwgNTc0MywgNTc0OSwgNTc3OSwgNTc4MywgNTc5MSwKICAgIDU4MDEsIDU4MDcsIDU4MTMsIDU4MjEsIDU4MjcsIDU4MzksIDU4NDMsIDU4NDksCiAgICA1ODUxLCA1ODU3LCA1ODYxLCA1ODY3LCA1ODY5LCA1ODc5LCA1ODgxLCA1ODk3LAogICAgNTkwMywgNTkyMywgNTkyNywgNTkzOSwgNTk1MywgNTk4MSwgNTk4NywgNjAwNywKICAgIDYwMTEsIDYwMjksIDYwMzcsIDYwNDMsIDYwNDcsIDYwNTMsIDYwNjcsIDYwNzMsCiAgICA2MDc5LCA2MDg5LCA2MDkxLCA2MTAxLCA2MTEzLCA2MTIxLCA2MTMxLCA2MTMzLAogICAgNjE0MywgNjE1MSwgNjE2MywgNjE3MywgNjE5NywgNjE5OSwgNjIwMywgNjIxMSwKICAgIDYyMTcsIDYyMjEsIDYyMjksIDYyNDcsIDYyNTcsIDYyNjMsIDYyNjksIDYyNzEsCiAgICA2Mjc3LCA2Mjg3LCA2Mjk5LCA2MzAxLCA2MzExLCA2MzE3LCA2MzIzLCA2MzI5LAogICAgNjMzNywgNjM0MywgNjM1MywgNjM1OSwgNjM2MSwgNjM2NywgNjM3MywgNjM3OSwKICAgIDYzODksIDYzOTcsIDY0MjEsIDY0MjcsIDY0NDksIDY0NTEsIDY0NjksIDY0NzMsCiAgICA2NDgxLCA2NDkxLCA2NTIxLCA2NTI5LCA2NTQ3LCA2NTUxLCA2NTUzLCA2NTYzLAogICAgNjU2OSwgNjU3MSwgNjU3NywgNjU4MSwgNjU5OSwgNjYwNywgNjYxOSwgNjYzNywKICAgIDY2NTMsIDY2NTksIDY2NjEsIDY2NzMsIDY2NzksIDY2ODksIDY2OTEsIDY3MDEsCiAgICA2NzAzLCA2NzA5LCA2NzE5LCA2NzMzLCA2NzM3LCA2NzYxLCA2NzYzLCA2Nzc5LAogICAgNjc4MSwgNjc5MSwgNjc5MywgNjgwMywgNjgyMywgNjgyNywgNjgyOSwgNjgzMywKICAgIDY4NDEsIDY4NTcsIDY4NjMsIDY4NjksIDY4NzEsIDY4ODMsIDY4OTksIDY5MDcsCiAgICA2OTExLCA2OTE3LCA2OTQ3LCA2OTQ5LCA2OTU5LCA2OTYxLCA2OTY3LCA2OTcxLAogICAgNjk3NywgNjk4MywgNjk5MSwgNjk5NywgNzAwMSwgNzAxMywgNzAxOSwgNzAyNywKICAgIDcwMzksIDcwNDMsIDcwNTcsIDcwNjksIDcwNzksIDcxMDMsIDcxMDksIDcxMjEsCiAgICA3MTI3LCA3MTI5LCA3MTUxLCA3MTU5LCA3MTc3LCA3MTg3LCA3MTkzLCA3MjA3LAogICAgNzIxMSwgNzIxMywgNzIxOSwgNzIyOSwgNzIzNywgNzI0MywgNzI0NywgNzI1MywKICAgIDcyODMsIDcyOTcsIDczMDcsIDczMDksIDczMjEsIDczMzEsIDczMzMsIDczNDksCiAgICA3MzUxLCA3MzY5LCA3MzkzLCA3NDExLCA3NDE3LCA3NDMzLCA3NDUxLCA3NDU3LAogICAgNzQ1OSwgNzQ3NywgNzQ4MSwgNzQ4NywgNzQ4OSwgNzQ5OSwgNzUwNywgNzUxNywKICAgIDc1MjMsIDc1MjksIDc1MzcsIDc1NDEsIDc1NDcsIDc1NDksIDc1NTksIDc1NjEsCiAgICA3NTczLCA3NTc3LCA3NTgzLCA3NTg5LCA3NTkxLCA3NjAzLCA3NjA3LCA3NjIxLAogICAgNzYzOSwgNzY0MywgNzY0OSwgNzY2OSwgNzY3MywgNzY4MSwgNzY4NywgNzY5MSwKICAgIDc2OTksIDc3MDMsIDc3MTcsIDc3MjMsIDc3MjcsIDc3NDEsIDc3NTMsIDc3NTcsCiAgICA3NzU5LCA3Nzg5LCA3NzkzLCA3ODE3LCA3ODIzLCA3ODI5LCA3ODQxLCA3ODUzLAogICAgNzg2NywgNzg3MywgNzg3NywgNzg3OSwgNzg4MywgNzkwMSwgNzkwNywgNzkxOSwKICAgIDc5MjcsIDc5MzMsIDc5MzcsIDc5NDksIDc5NTEsIDc5NjMsIDc5OTMsIDgwMDksCiAgICA4MDExLCA4MDE3LCA4MDM5LCA4MDUzLCA4MDU5LCA4MDY5LCA4MDgxLCA4MDg3LAogICAgODA4OSwgODA5MywgODEwMSwgODExMSwgODExNywgODEyMywgODE0NywgODE2MSwKICAgIDgxNjcsIDgxNzEsIDgxNzksIDgxOTEsIDgyMDksIDgyMTksIDgyMjEsIDgyMzEsCiAgICA4MjMzLCA4MjM3LCA4MjQzLCA4MjYzLCA4MjY5LCA4MjczLCA4Mjg3LCA4MjkxLAogICAgODI5MywgODI5NywgODMxMSwgODMxNywgODMyOSwgODM1MywgODM2MywgODM2OSwKICAgIDgzNzcsIDgzODcsIDgzODksIDg0MTksIDg0MjMsIDg0MjksIDg0MzEsIDg0NDMsCiAgICA4NDQ3LCA4NDYxLCA4NDY3LCA4NTAxLCA4NTEzLCA4NTIxLCA4NTI3LCA4NTM3LAogICAgODUzOSwgODU0MywgODU2MywgODU3MywgODU4MSwgODU5NywgODU5OSwgODYwOSwKICAgIDg2MjMsIDg2MjcsIDg2MjksIDg2NDEsIDg2NDcsIDg2NjMsIDg2NjksIDg2NzcsCiAgICA4NjgxLCA4Njg5LCA4NjkzLCA4Njk5LCA4NzA3LCA4NzEzLCA4NzE5LCA4NzMxLAogICAgODczNywgODc0MSwgODc0NywgODc1MywgODc2MSwgODc3OSwgODc4MywgODgwMywKICAgIDg4MDcsIDg4MTksIDg4MjEsIDg4MzEsIDg4MzcsIDg4MzksIDg4NDksIDg4NjEsCiAgICA4ODYzLCA4ODY3LCA4ODg3LCA4ODkzLCA4OTIzLCA4OTI5LCA4OTMzLCA4OTQxLAogICAgODk1MSwgODk2MywgODk2OSwgODk3MSwgODk5OSwgOTAwMSwgOTAwNywgOTAxMSwKICAgIDkwMTMsIDkwMjksIDkwNDEsIDkwNDMsIDkwNDksIDkwNTksIDkwNjcsIDkwOTEsCiAgICA5MTAzLCA5MTA5LCA5MTI3LCA5MTMzLCA5MTM3LCA5MTUxLCA5MTU3LCA5MTYxLAogICAgOTE3MywgOTE4MSwgOTE4NywgOTE5OSwgOTIwMywgOTIwOSwgOTIyMSwgOTIyNywKICAgIDkyMzksIDkyNDEsIDkyNTcsIDkyNzcsIDkyODEsIDkyODMsIDkyOTMsIDkzMTEsCiAgICA5MzE5LCA5MzIzLCA5MzM3LCA5MzQxLCA5MzQzLCA5MzQ5LCA5MzcxLCA5Mzc3LAogICAgOTM5MSwgOTM5NywgOTQwMywgOTQxMywgOTQxOSwgOTQyMSwgOTQzMSwgOTQzMywKICAgIDk0MzcsIDk0MzksIDk0NjEsIDk0NjMsIDk0NjcsIDk0NzMsIDk0NzksIDk0OTEsCiAgICA5NDk3LCA5NTExLCA5NTIxLCA5NTMzLCA5NTM5LCA5NTQ3LCA5NTUxLCA5NTg3LAogICAgOTYwMSwgOTYxMywgOTYxOSwgOTYyMywgOTYyOSwgOTYzMSwgOTY0MywgOTY0OSwKICAgIDk2NjEsIDk2NzcsIDk2NzksIDk2ODksIDk2OTcsIDk3MTksIDk3MjEsIDk3MzMsCiAgICA5NzM5LCA5NzQzLCA5NzQ5LCA5NzY3LCA5NzY5LCA5NzgxLCA5Nzg3LCA5NzkxLAogICAgOTgwMywgOTgxMSwgOTgxNywgOTgyOSwgOTgzMywgOTgzOSwgOTg1MSwgOTg1NywKICAgIDk4NTksIDk4NzEsIDk4ODMsIDk4ODcsIDk5MDEsIDk5MDcsIDk5MjMsIDk5MjksCiAgICA5OTMxLCA5OTQxLCA5OTQ5LCA5OTY3LCA5OTczLCAxMDAwNywgMTAwMDksIDEwMDM3LAogICAgMTAwMzksIDEwMDYxLCAxMDA2NywgMTAwNjksIDEwMDc5LCAxMDA5MSwgMTAwOTMsIDEwMDk5LAogICAgMTAxMDMsIDEwMTExLCAxMDEzMywgMTAxMzksIDEwMTQxLCAxMDE1MSwgMTAxNTksIDEwMTYzLAogICAgMTAxNjksIDEwMTc3LCAxMDE4MSwgMTAxOTMsIDEwMjExLCAxMDIyMywgMTAyNDMsIDEwMjQ3LAogICAgMTAyNTMsIDEwMjU5LCAxMDI2NywgMTAyNzEsIDEwMjczLCAxMDI4OSwgMTAzMDEsIDEwMzAzLAogICAgMTAzMTMsIDEwMzIxLCAxMDMzMSwgMTAzMzMsIDEwMzM3LCAxMDM0MywgMTAzNTcsIDEwMzY5LAogICAgMTAzOTEsIDEwMzk5LCAxMDQyNywgMTA0MjksIDEwNDMzLCAxMDQ1MywgMTA0NTcsIDEwNDU5LAogICAgMTA0NjMsIDEwNDc3LCAxMDQ4NywgMTA0OTksIDEwNTAxLCAxMDUxMywgMTA1MjksIDEwNTMxLAogICAgMTA1NTksIDEwNTY3LCAxMDU4OSwgMTA1OTcsIDEwNjAxLCAxMDYwNywgMTA2MTMsIDEwNjI3LAogICAgMTA2MzEsIDEwNjM5LCAxMDY1MSwgMTA2NTcsIDEwNjYzLCAxMDY2NywgMTA2ODcsIDEwNjkxLAogICAgMTA3MDksIDEwNzExLCAxMDcyMywgMTA3MjksIDEwNzMzLCAxMDczOSwgMTA3NTMsIDEwNzcxLAogICAgMTA3ODEsIDEwNzg5LCAxMDc5OSwgMTA4MzEsIDEwODM3LCAxMDg0NywgMTA4NTMsIDEwODU5LAogICAgMTA4NjEsIDEwODY3LCAxMDg4MywgMTA4ODksIDEwODkxLCAxMDkwMywgMTA5MDksIDEwOTM3LAogICAgMTA5MzksIDEwOTQ5LCAxMDk1NywgMTA5NzMsIDEwOTc5LCAxMDk4NywgMTA5OTMsIDExMDAzLAogICAgMTEwMjcsIDExMDQ3LCAxMTA1NywgMTEwNTksIDExMDY5LCAxMTA3MSwgMTEwODMsIDExMDg3LAogICAgMTEwOTMsIDExMTEzLCAxMTExNywgMTExMTksIDExMTMxLCAxMTE0OSwgMTExNTksIDExMTYxLAogICAgMTExNzEsIDExMTczLCAxMTE3NywgMTExOTcsIDExMjEzLCAxMTIzOSwgMTEyNDMsIDExMjUxLAogICAgMTEyNTcsIDExMjYxLCAxMTI3MywgMTEyNzksIDExMjg3LCAxMTI5OSwgMTEzMTEsIDExMzE3LAogICAgMTEzMjEsIDExMzI5LCAxMTM1MSwgMTEzNTMsIDExMzY5LCAxMTM4MywgMTEzOTMsIDExMzk5LAogICAgMTE0MTEsIDExNDIzLCAxMTQzNywgMTE0NDMsIDExNDQ3LCAxMTQ2NywgMTE0NzEsIDExNDgzLAogICAgMTE0ODksIDExNDkxLCAxMTQ5NywgMTE1MDMsIDExNTE5LCAxMTUyNywgMTE1NDksIDExNTUxLAogICAgMTE1NzksIDExNTg3LCAxMTU5MywgMTE1OTcsIDExNjE3LCAxMTYyMSwgMTE2MzMsIDExNjU3LAogICAgMTE2NzcsIDExNjgxLCAxMTY4OSwgMTE2OTksIDExNzAxLCAxMTcxNywgMTE3MTksIDExNzMxLAogICAgMTE3NDMsIDExNzc3LCAxMTc3OSwgMTE3ODMsIDExNzg5LCAxMTgwMSwgMTE4MDcsIDExODEzLAogICAgMTE4MjEsIDExODI3LCAxMTgzMSwgMTE4MzMsIDExODM5LCAxMTg2MywgMTE4NjcsIDExODg3LAogICAgMTE4OTcsIDExOTAzLCAxMTkwOSwgMTE5MjMsIDExOTI3LCAxMTkzMywgMTE5MzksIDExOTQxLAogICAgMTE5NTMsIDExOTU5LCAxMTk2OSwgMTE5NzEsIDExOTgxLCAxMTk4NywgMTIwMDcsIDEyMDExLAogICAgMTIwMzcsIDEyMDQxLCAxMjA0MywgMTIwNDksIDEyMDcxLCAxMjA3MywgMTIwOTcsIDEyMTAxLAogICAgMTIxMDcsIDEyMTA5LCAxMjExMywgMTIxMTksIDEyMTQzLCAxMjE0OSwgMTIxNTcsIDEyMTYxLAogICAgMTIxNjMsIDEyMTk3LCAxMjIwMywgMTIyMTEsIDEyMjI3LCAxMjIzOSwgMTIyNDEsIDEyMjUxLAogICAgMTIyNTMsIDEyMjYzLCAxMjI2OSwgMTIyNzcsIDEyMjgxLCAxMjI4OSwgMTIzMDEsIDEyMzIzLAogICAgMTIzMjksIDEyMzQzLCAxMjM0NywgMTIzNzMsIDEyMzc3LCAxMjM3OSwgMTIzOTEsIDEyNDAxLAogICAgMTI0MDksIDEyNDEzLCAxMjQyMSwgMTI0MzMsIDEyNDM3LCAxMjQ1MSwgMTI0NTcsIDEyNDczLAogICAgMTI0NzksIDEyNDg3LCAxMjQ5MSwgMTI0OTcsIDEyNTAzLCAxMjUxMSwgMTI1MTcsIDEyNTI3LAogICAgMTI1MzksIDEyNTQxLCAxMjU0NywgMTI1NTMsIDEyNTY5LCAxMjU3NywgMTI1ODMsIDEyNTg5LAogICAgMTI2MDEsIDEyNjExLCAxMjYxMywgMTI2MTksIDEyNjM3LCAxMjY0MSwgMTI2NDcsIDEyNjUzLAogICAgMTI2NTksIDEyNjcxLCAxMjY4OSwgMTI2OTcsIDEyNzAzLCAxMjcxMywgMTI3MjEsIDEyNzM5LAogICAgMTI3NDMsIDEyNzU3LCAxMjc2MywgMTI3ODEsIDEyNzkxLCAxMjc5OSwgMTI4MDksIDEyODIxLAogICAgMTI4MjMsIDEyODI5LCAxMjg0MSwgMTI4NTMsIDEyODg5LCAxMjg5MywgMTI4OTksIDEyOTA3LAogICAgMTI5MTEsIDEyOTE3LCAxMjkxOSwgMTI5MjMsIDEyOTQxLCAxMjk1MywgMTI5NTksIDEyOTY3LAogICAgMTI5NzMsIDEyOTc5LCAxMjk4MywgMTMwMDEsIDEzMDAzLCAxMzAwNywgMTMwMDksIDEzMDMzLAogICAgMTMwMzcsIDEzMDQzLCAxMzA0OSwgMTMwNjMsIDEzMDkzLCAxMzA5OSwgMTMxMDMsIDEzMTA5LAogICAgMTMxMjEsIDEzMTI3LCAxMzE0NywgMTMxNTEsIDEzMTU5LCAxMzE2MywgMTMxNzEsIDEzMTc3LAogICAgMTMxODMsIDEzMTg3LCAxMzIxNywgMTMyMTksIDEzMjI5LCAxMzI0MSwgMTMyNDksIDEzMjU5LAogICAgMTMyNjcsIDEzMjkxLCAxMzI5NywgMTMzMDksIDEzMzEzLCAxMzMyNywgMTMzMzEsIDEzMzM3LAogICAgMTMzMzksIDEzMzY3LCAxMzM4MSwgMTMzOTcsIDEzMzk5LCAxMzQxMSwgMTM0MTcsIDEzNDIxLAogICAgMTM0NDEsIDEzNDUxLCAxMzQ1NywgMTM0NjMsIDEzNDY5LCAxMzQ3NywgMTM0ODcsIDEzNDk5LAogICAgMTM1MTMsIDEzNTIzLCAxMzUzNywgMTM1NTMsIDEzNTY3LCAxMzU3NywgMTM1OTEsIDEzNTk3LAogICAgMTM2MTMsIDEzNjE5LCAxMzYyNywgMTM2MzMsIDEzNjQ5LCAxMzY2OSwgMTM2NzksIDEzNjgxLAogICAgMTM2ODcsIDEzNjkxLCAxMzY5MywgMTM2OTcsIDEzNzA5LCAxMzcxMSwgMTM3MjEsIDEzNzIzLAogICAgMTM3MjksIDEzNzUxLCAxMzc1NywgMTM3NTksIDEzNzYzLCAxMzc4MSwgMTM3ODksIDEzNzk5LAogICAgMTM4MDcsIDEzODI5LCAxMzgzMSwgMTM4NDEsIDEzODU5LCAxMzg3MywgMTM4NzcsIDEzODc5LAogICAgMTM4ODMsIDEzOTAxLCAxMzkwMywgMTM5MDcsIDEzOTEzLCAxMzkyMSwgMTM5MzEsIDEzOTMzLAogICAgMTM5NjMsIDEzOTY3LCAxMzk5NywgMTM5OTksIDE0MDA5LCAxNDAxMSwgMTQwMjksIDE0MDMzLAogICAgMTQwNTEsIDE0MDU3LCAxNDA3MSwgMTQwODEsIDE0MDgzLCAxNDA4NywgMTQxMDcsIDE0MTQzLAogICAgMTQxNDksIDE0MTUzLCAxNDE1OSwgMTQxNzMsIDE0MTc3LCAxNDE5NywgMTQyMDcsIDE0MjIxLAogICAgMTQyNDMsIDE0MjQ5LCAxNDI1MSwgMTQyODEsIDE0MjkzLCAxNDMwMywgMTQzMjEsIDE0MzIzLAogICAgMTQzMjcsIDE0MzQxLCAxNDM0NywgMTQzNjksIDE0Mzg3LCAxNDM4OSwgMTQ0MDEsIDE0NDA3LAogICAgMTQ0MTEsIDE0NDE5LCAxNDQyMywgMTQ0MzEsIDE0NDM3LCAxNDQ0NywgMTQ0NDksIDE0NDYxLAogICAgMTQ0NzksIDE0NDg5LCAxNDUwMywgMTQ1MTksIDE0NTMzLCAxNDUzNywgMTQ1NDMsIDE0NTQ5LAogICAgMTQ1NTEsIDE0NTU3LCAxNDU2MSwgMTQ1NjMsIDE0NTkxLCAxNDU5MywgMTQ2MjEsIDE0NjI3LAogICAgMTQ2MjksIDE0NjMzLCAxNDYzOSwgMTQ2NTMsIDE0NjU3LCAxNDY2OSwgMTQ2ODMsIDE0Njk5LAogICAgMTQ3MTMsIDE0NzE3LCAxNDcyMywgMTQ3MzEsIDE0NzM3LCAxNDc0MSwgMTQ3NDcsIDE0NzUzLAogICAgMTQ3NTksIDE0NzY3LCAxNDc3MSwgMTQ3NzksIDE0NzgzLCAxNDc5NywgMTQ4MTMsIDE0ODIxLAogICAgMTQ4MjcsIDE0ODMxLCAxNDg0MywgMTQ4NTEsIDE0ODY3LCAxNDg2OSwgMTQ4NzksIDE0ODg3LAogICAgMTQ4OTEsIDE0ODk3LCAxNDkyMywgMTQ5MjksIDE0OTM5LCAxNDk0NywgMTQ5NTEsIDE0OTU3LAogICAgMTQ5NjksIDE0OTgzLCAxNTAxMywgMTUwMTcsIDE1MDMxLCAxNTA1MywgMTUwNjEsIDE1MDczLAogICAgMTUwNzcsIDE1MDgzLCAxNTA5MSwgMTUxMDEsIDE1MTA3LCAxNTEyMSwgMTUxMzEsIDE1MTM3LAogICAgMTUxMzksIDE1MTQ5LCAxNTE2MSwgMTUxNzMsIDE1MTg3LCAxNTE5MywgMTUxOTksIDE1MjE3LAogICAgMTUyMjcsIDE1MjMzLCAxNTI0MSwgMTUyNTksIDE1MjYzLCAxNTI2OSwgMTUyNzEsIDE1Mjc3LAogICAgMTUyODcsIDE1Mjg5LCAxNTI5OSwgMTUzMDcsIDE1MzEzLCAxNTMxOSwgMTUzMjksIDE1MzMxLAogICAgMTUzNDksIDE1MzU5LCAxNTM2MSwgMTUzNzMsIDE1Mzc3LCAxNTM4MywgMTUzOTEsIDE1NDAxLAogICAgMTU0MTMsIDE1NDI3LCAxNTQzOSwgMTU0NDMsIDE1NDUxLCAxNTQ2MSwgMTU0NjcsIDE1NDczLAogICAgMTU0OTMsIDE1NDk3LCAxNTUxMSwgMTU1MjcsIDE1NTQxLCAxNTU1MSwgMTU1NTksIDE1NTY5LAogICAgMTU1ODEsIDE1NTgzLCAxNTYwMSwgMTU2MDcsIDE1NjE5LCAxNTYyOSwgMTU2NDEsIDE1NjQzLAogICAgMTU2NDcsIDE1NjQ5LCAxNTY2MSwgMTU2NjcsIDE1NjcxLCAxNTY3OSwgMTU2ODMsIDE1NzI3LAogICAgMTU3MzEsIDE1NzMzLCAxNTczNywgMTU3MzksIDE1NzQ5LCAxNTc2MSwgMTU3NjcsIDE1NzczLAogICAgMTU3ODcsIDE1NzkxLCAxNTc5NywgMTU4MDMsIDE1ODA5LCAxNTgxNywgMTU4MjMsIDE1ODU5LAogICAgMTU4NzcsIDE1ODgxLCAxNTg4NywgMTU4ODksIDE1OTAxLCAxNTkwNywgMTU5MTMsIDE1OTE5LAogICAgMTU5MjMsIDE1OTM3LCAxNTk1OSwgMTU5NzEsIDE1OTczLCAxNTk5MSwgMTYwMDEsIDE2MDA3LAogICAgMTYwMzMsIDE2MDU3LCAxNjA2MSwgMTYwNjMsIDE2MDY3LCAxNjA2OSwgMTYwNzMsIDE2MDg3LAogICAgMTYwOTEsIDE2MDk3LCAxNjEwMywgMTYxMTEsIDE2MTI3LCAxNjEzOSwgMTYxNDEsIDE2MTgzLAogICAgMTYxODcsIDE2MTg5LCAxNjE5MywgMTYyMTcsIDE2MjIzLCAxNjIyOSwgMTYyMzEsIDE2MjQ5LAogICAgMTYyNTMsIDE2MjY3LCAxNjI3MywgMTYzMDEsIDE2MzE5LCAxNjMzMywgMTYzMzksIDE2MzQ5LAogICAgMTYzNjEsIDE2MzYzLCAxNjM2OSwgMTYzODEsIDE2NDExLCAxNjQxNywgMTY0MjEsIDE2NDI3LAogICAgMTY0MzMsIDE2NDQ3LCAxNjQ1MSwgMTY0NTMsIDE2NDc3LCAxNjQ4MSwgMTY0ODcsIDE2NDkzLAogICAgMTY1MTksIDE2NTI5LCAxNjU0NywgMTY1NTMsIDE2NTYxLCAxNjU2NywgMTY1NzMsIDE2NjAzLAogICAgMTY2MDcsIDE2NjE5LCAxNjYzMSwgMTY2MzMsIDE2NjQ5LCAxNjY1MSwgMTY2NTcsIDE2NjYxLAogICAgMTY2NzMsIDE2NjkxLCAxNjY5MywgMTY2OTksIDE2NzAzLCAxNjcyOSwgMTY3NDEsIDE2NzQ3LAogICAgMTY3NTksIDE2NzYzLCAxNjc4NywgMTY4MTEsIDE2ODIzLCAxNjgyOSwgMTY4MzEsIDE2ODQzLAogICAgMTY4NzEsIDE2ODc5LCAxNjg4MywgMTY4ODksIDE2OTAxLCAxNjkwMywgMTY5MjEsIDE2OTI3LAogICAgMTY5MzEsIDE2OTM3LCAxNjk0MywgMTY5NjMsIDE2OTc5LCAxNjk4MSwgMTY5ODcsIDE2OTkzLAogICAgMTcwMTEsIDE3MDIxLCAxNzAyNywgMTcwMjksIDE3MDMzLCAxNzA0MSwgMTcwNDcsIDE3MDUzLAogICAgMTcwNzcsIDE3MDkzLCAxNzA5OSwgMTcxMDcsIDE3MTE3LCAxNzEyMywgMTcxMzcsIDE3MTU5LAogICAgMTcxNjcsIDE3MTgzLCAxNzE4OSwgMTcxOTEsIDE3MjAzLCAxNzIwNywgMTcyMDksIDE3MjMxLAogICAgMTcyMzksIDE3MjU3LCAxNzI5MSwgMTcyOTMsIDE3Mjk5LCAxNzMxNywgMTczMjEsIDE3MzI3LAogICAgMTczMzMsIDE3MzQxLCAxNzM1MSwgMTczNTksIDE3Mzc3LCAxNzM4MywgMTczODcsIDE3Mzg5LAogICAgMTczOTMsIDE3NDAxLCAxNzQxNywgMTc0MTksIDE3NDMxLCAxNzQ0MywgMTc0NDksIDE3NDY3LAogICAgMTc0NzEsIDE3NDc3LCAxNzQ4MywgMTc0ODksIDE3NDkxLCAxNzQ5NywgMTc1MDksIDE3NTE5LAogICAgMTc1MzksIDE3NTUxLCAxNzU2OSwgMTc1NzMsIDE3NTc5LCAxNzU4MSwgMTc1OTcsIDE3NTk5LAogICAgMTc2MDksIDE3NjIzLCAxNzYyNywgMTc2NTcsIDE3NjU5LCAxNzY2OSwgMTc2ODEsIDE3NjgzLAogICAgMTc3MDcsIDE3NzEzLCAxNzcyOSwgMTc3MzcsIDE3NzQ3LCAxNzc0OSwgMTc3NjEsIDE3NzgzLAogICAgMTc3ODksIDE3NzkxLCAxNzgwNywgMTc4MjcsIDE3ODM3LCAxNzgzOSwgMTc4NTEsIDE3ODYzLApdCgoKY2xhc3MgX1dpbktleSgpOgoKICAgICMgQSBDTkcgQkNSWVBUX0tFWV9IQU5ETEUgb24gVmlzdGEgYW5kIG5ld2VyLCBhbiBIQ1JZUFRLRVkgb24gWFAgYW5kIDIwMDMKICAgIGtleV9oYW5kbGUgPSBOb25lCiAgICAjIE9uIFhQIGFuZCAyMDAzLCB3ZSBoYXZlIHRvIGNhcnJ5IGFyb3VuZCBtb3JlIGluZm8KICAgIGNvbnRleHRfaGFuZGxlID0gTm9uZQogICAgZXhfa2V5X2hhbmRsZSA9IE5vbmUKCiAgICAjIEEgcmVmZXJlbmNlIHRvIHRoZSBsaWJyYXJ5IHVzZWQgaW4gdGhlIGRlc3RydWN0b3IgdG8gbWFrZSBzdXJlIGl0IGhhc24ndAogICAgIyBiZWVuIGdhcmJhZ2UgY29sbGVjdGVkIGJ5IHRoZSB0aW1lIHRoaXMgb2JqZWN0IGlzIGdhcmJhZ2UgY29sbGVjdGVkCiAgICBfbGliID0gTm9uZQoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBrZXlfaGFuZGxlLCBhc24xKToKICAgICAgICAiIiIKICAgICAgICA6cGFyYW0ga2V5X2hhbmRsZToKICAgICAgICAgICAgQSBDTkcgQkNSWVBUX0tFWV9IQU5ETEUgdmFsdWUgKFZpc3RhIGFuZCBuZXdlcikgb3IgYW4gSENSWVBUS0VZCiAgICAgICAgICAgIChYUCBhbmQgMjAwMykgZnJvbSBsb2FkaW5nL2ltcG9ydGluZyB0aGUga2V5CgogICAgICAgIDpwYXJhbSBhc24xOgogICAgICAgICAgICBBbiBhc24xY3J5cHRvIG9iamVjdCBmb3IgdGhlIGNvbmNyZXRlIHR5cGUKICAgICAgICAiIiIKCiAgICAgICAgc2VsZi5rZXlfaGFuZGxlID0ga2V5X2hhbmRsZQogICAgICAgIHNlbGYuYXNuMSA9IGFzbjEKCiAgICAgICAgaWYgX2JhY2tlbmQgPT0gJ3dpbmxlZ2FjeSc6CiAgICAgICAgICAgIHNlbGYuX2xpYiA9IGFkdmFwaTMyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5fbGliID0gYmNyeXB0CgogICAgZGVmIF9fZGVsX18oc2VsZik6CiAgICAgICAgaWYgc2VsZi5rZXlfaGFuZGxlOgogICAgICAgICAgICBpZiBfYmFja2VuZCA9PSAnd2lubGVnYWN5JzoKICAgICAgICAgICAgICAgIHJlcyA9IHNlbGYuX2xpYi5DcnlwdERlc3Ryb3lLZXkoc2VsZi5rZXlfaGFuZGxlKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmVzID0gc2VsZi5fbGliLkJDcnlwdERlc3Ryb3lLZXkoc2VsZi5rZXlfaGFuZGxlKQogICAgICAgICAgICBoYW5kbGVfZXJyb3IocmVzKQogICAgICAgICAgICBzZWxmLmtleV9oYW5kbGUgPSBOb25lCiAgICAgICAgaWYgc2VsZi5jb250ZXh0X2hhbmRsZSBhbmQgX2JhY2tlbmQgPT0gJ3dpbmxlZ2FjeSc6CiAgICAgICAgICAgIGNsb3NlX2NvbnRleHRfaGFuZGxlKHNlbGYuY29udGV4dF9oYW5kbGUpCiAgICAgICAgICAgIHNlbGYuY29udGV4dF9oYW5kbGUgPSBOb25lCiAgICAgICAgc2VsZi5fbGliID0gTm9uZQoKCmNsYXNzIFByaXZhdGVLZXkoX1dpbktleSwgX1ByaXZhdGVLZXlCYXNlKToKICAgICIiIgogICAgQ29udGFpbmVyIGZvciB0aGUgT1MgY3J5cHRvIGxpYnJhcnkgcmVwcmVzZW50YXRpb24gb2YgYSBwcml2YXRlIGtleQogICAgIiIiCgogICAgX3B1YmxpY19rZXkgPSBOb25lCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGtleV9oYW5kbGUsIGFzbjEpOgogICAgICAgICIiIgogICAgICAgIDpwYXJhbSBrZXlfaGFuZGxlOgogICAgICAgICAgICBBIENORyBCQ1JZUFRfS0VZX0hBTkRMRSB2YWx1ZSAoVmlzdGEgYW5kIG5ld2VyKSBvciBhbiBIQ1JZUFRLRVkKICAgICAgICAgICAgKFhQIGFuZCAyMDAzKSBmcm9tIGxvYWRpbmcvaW1wb3J0aW5nIHRoZSBrZXkKCiAgICAgICAgOnBhcmFtIGFzbjE6CiAgICAgICAgICAgIEFuIGFzbjFjcnlwdG8ua2V5cy5Qcml2YXRlS2V5SW5mbyBvYmplY3QKICAgICAgICAiIiIKCiAgICAgICAgX1dpbktleS5fX2luaXRfXyhzZWxmLCBrZXlfaGFuZGxlLCBhc24xKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHB1YmxpY19rZXkoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgOnJldHVybjoKICAgICAgICAgICAgQSBQdWJsaWNLZXkgb2JqZWN0IGNvcnJlc3BvbmRpbmcgdG8gdGhpcyBwcml2YXRlIGtleS4KICAgICAgICAiIiIKCiAgICAgICAgaWYgX2JhY2tlbmQgPT0gJ3dpbmxlZ2FjeSc6CiAgICAgICAgICAgIGlmIHNlbGYuYWxnb3JpdGhtID09ICdlYyc6CiAgICAgICAgICAgICAgICBwdWJfcG9pbnQgPSBfcHVyZV9weXRob25fZWNfY29tcHV0ZV9wdWJsaWNfa2V5X3BvaW50KHNlbGYuYXNuMSkKICAgICAgICAgICAgICAgIHNlbGYuX3B1YmxpY19rZXkgPSBQdWJsaWNLZXkoTm9uZSwgZWNfcHVibGljX2tleV9pbmZvKHB1Yl9wb2ludCwgc2VsZi5jdXJ2ZSkpCiAgICAgICAgICAgIGVsaWYgc2VsZi5hbGdvcml0aG0gPT0gJ2RzYSc6CiAgICAgICAgICAgICAgICAjIFRoZSBEU0EgcHJvdmlkZXIgd29uJ3QgYWxsb3cgZXhwb3J0aW5nIHRoZSBwcml2YXRlIGtleSB3aXRoCiAgICAgICAgICAgICAgICAjIENyeXB0b0ltcG9ydEtleSBmbGFncyBzZXQgdG8gMCBhbmQgd29uJ3QgYWxsb3cgZmxhZ3MgdG8gYmUgc2V0CiAgICAgICAgICAgICAgICAjIHRvIENSWVBUX0VYUE9SVEFCTEUsIHNvIHdlIG1hbnVhbGx5IHJlY3JlYXRlZCB0aGUgcHVibGljIGtleQogICAgICAgICAgICAgICAgIyBBU04uMQogICAgICAgICAgICAgICAgcGFyYW1zID0gc2VsZi5hc24xWydwcml2YXRlX2tleV9hbGdvcml0aG0nXVsncGFyYW1ldGVycyddCiAgICAgICAgICAgICAgICBwdWJfYXNuMSA9IFB1YmxpY0tleUluZm8oewogICAgICAgICAgICAgICAgICAgICdhbGdvcml0aG0nOiBQdWJsaWNLZXlBbGdvcml0aG0oewogICAgICAgICAgICAgICAgICAgICAgICAnYWxnb3JpdGhtJzogJ2RzYScsCiAgICAgICAgICAgICAgICAgICAgICAgICdwYXJhbWV0ZXJzJzogcGFyYW1zCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgJ3B1YmxpY19rZXknOiBJbnRlZ2VyKHBvdygKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zWydnJ10ubmF0aXZlLAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFzbjFbJ3ByaXZhdGVfa2V5J10ucGFyc2VkLm5hdGl2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zWydwJ10ubmF0aXZlCiAgICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBzZWxmLl9wdWJsaWNfa2V5ID0gbG9hZF9wdWJsaWNfa2V5KHB1Yl9hc24xKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUaGlzIHN1ZmZlcnMgZnJvbSBzaW1pbGFyIHByb2JsZW1zIGFzIGFib3ZlLCBhbHRob3VnaCBub3QKICAgICAgICAgICAgICAgICMgYXMgaW5zdXJtb3VudGFibGUuIFRoaXMgaXMganVzdCBhIHNpbXBsZXIvZmFzdGVyIHNvbHV0aW9uCiAgICAgICAgICAgICAgICAjIHNpbmNlIHRoZSBwcml2YXRlIGtleSBoYXMgYWxsIG9mIHRoZSBkYXRhIHdlIG5lZWQgYW55d2F5CiAgICAgICAgICAgICAgICBwYXJzZWQgPSBzZWxmLmFzbjFbJ3ByaXZhdGVfa2V5J10ucGFyc2VkCiAgICAgICAgICAgICAgICBwdWJfYXNuMSA9IFB1YmxpY0tleUluZm8oewogICAgICAgICAgICAgICAgICAgICdhbGdvcml0aG0nOiBQdWJsaWNLZXlBbGdvcml0aG0oewogICAgICAgICAgICAgICAgICAgICAgICAnYWxnb3JpdGhtJzogJ3JzYScKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAncHVibGljX2tleSc6IFJTQVB1YmxpY0tleSh7CiAgICAgICAgICAgICAgICAgICAgICAgICdtb2R1bHVzJzogcGFyc2VkWydtb2R1bHVzJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdwdWJsaWNfZXhwb25lbnQnOiBwYXJzZWRbJ3B1YmxpY19leHBvbmVudCddCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBzZWxmLl9wdWJsaWNfa2V5ID0gbG9hZF9wdWJsaWNfa2V5KHB1Yl9hc24xKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHB1Yl9hc24xLCBfID0gX2JjcnlwdF9rZXlfaGFuZGxlX3RvX2FzbjEoc2VsZi5hbGdvcml0aG0sIHNlbGYuYml0X3NpemUsIHNlbGYua2V5X2hhbmRsZSkKICAgICAgICAgICAgc2VsZi5fcHVibGljX2tleSA9IGxvYWRfcHVibGljX2tleShwdWJfYXNuMSkKICAgICAgICByZXR1cm4gc2VsZi5fcHVibGljX2tleQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGZpbmdlcnByaW50KHNlbGYpOgogICAgICAgICIiIgogICAgICAgIENyZWF0ZXMgYSBmaW5nZXJwcmludCB0aGF0IGNhbiBiZSBjb21wYXJlZCB3aXRoIGEgcHVibGljIGtleSB0byBzZWUgaWYKICAgICAgICB0aGUgdHdvIGZvcm0gYSBwYWlyLgoKICAgICAgICBUaGlzIGZpbmdlcnByaW50IGlzIG5vdCBjb21wYXRpYmxlIHdpdGggZmluZ2VycHJpbnRzIGdlbmVyYXRlZCBieSBhbnkKICAgICAgICBvdGhlciBzb2Z0d2FyZS4KCiAgICAgICAgOnJldHVybjoKICAgICAgICAgICAgQSBieXRlIHN0cmluZyB0aGF0IGlzIGEgc2hhMjU2IGhhc2ggb2Ygc2VsZWN0ZWQgY29tcG9uZW50cyAoYmFzZWQKICAgICAgICAgICAgb24gdGhlIGtleSB0eXBlKQogICAgICAgICIiIgoKICAgICAgICBpZiBzZWxmLl9maW5nZXJwcmludCBpcyBOb25lOgogICAgICAgICAgICBzZWxmLl9maW5nZXJwcmludCA9IF9maW5nZXJwcmludChzZWxmLmFzbjEsIGxvYWRfcHJpdmF0ZV9rZXkpCiAgICAgICAgcmV0dXJuIHNlbGYuX2ZpbmdlcnByaW50CgoKY2xhc3MgUHVibGljS2V5KF9XaW5LZXksIF9QdWJsaWNLZXlCYXNlKToKICAgICIiIgogICAgQ29udGFpbmVyIGZvciB0aGUgT1MgY3J5cHRvIGxpYnJhcnkgcmVwcmVzZW50YXRpb24gb2YgYSBwdWJsaWMga2V5CiAgICAiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwga2V5X2hhbmRsZSwgYXNuMSk6CiAgICAgICAgIiIiCiAgICAgICAgOnBhcmFtIGtleV9oYW5kbGU6CiAgICAgICAgICAgIEEgQ05HIEJDUllQVF9LRVlfSEFORExFIHZhbHVlIChWaXN0YSBhbmQgbmV3ZXIpIG9yIGFuIEhDUllQVEtFWQogICAgICAgICAgICAoWFAgYW5kIDIwMDMpIGZyb20gbG9hZGluZy9pbXBvcnRpbmcgdGhlIGtleQoKICAgICAgICA6cGFyYW0gYXNuMToKICAgICAgICAgICAgQW4gYXNuMWNyeXB0by5rZXlzLlB1YmxpY0tleUluZm8gb2JqZWN0CiAgICAgICAgIiIiCgogICAgICAgIF9XaW5LZXkuX19pbml0X18oc2VsZiwga2V5X2hhbmRsZSwgYXNuMSkKCgpjbGFzcyBDZXJ0aWZpY2F0ZShfV2luS2V5LCBfQ2VydGlmaWNhdGVCYXNlKToKICAgICIiIgogICAgQ29udGFpbmVyIGZvciB0aGUgT1MgY3J5cHRvIGxpYnJhcnkgcmVwcmVzZW50YXRpb24gb2YgYSBjZXJ0aWZpY2F0ZQogICAgIiIiCgogICAgX3B1YmxpY19rZXkgPSBOb25lCiAgICBfc2VsZl9zaWduZWQgPSBOb25lCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGtleV9oYW5kbGUsIGFzbjEpOgogICAgICAgICIiIgogICAgICAgIDpwYXJhbSBrZXlfaGFuZGxlOgogICAgICAgICAgICBBIENORyBCQ1JZUFRfS0VZX0hBTkRMRSB2YWx1ZSAoVmlzdGEgYW5kIG5ld2VyKSBvciBhbiBIQ1JZUFRLRVkKICAgICAgICAgICAgKFhQIGFuZCAyMDAzKSBmcm9tIGxvYWRpbmcvaW1wb3J0aW5nIHRoZSBjZXJ0aWZpY2F0ZQoKICAgICAgICA6cGFyYW0gYXNuMToKICAgICAgICAgICAgQW4gYXNuMWNyeXB0by54NTA5LkNlcnRpZmljYXRlIG9iamVjdAogICAgICAgICIiIgoKICAgICAgICBfV2luS2V5Ll9faW5pdF9fKHNlbGYsIGtleV9oYW5kbGUsIGFzbjEpCgogICAgQHByb3BlcnR5CiAgICBkZWYgcHVibGljX2tleShzZWxmKToKICAgICAgICAiIiIKICAgICAgICA6cmV0dXJuOgogICAgICAgICAgICBUaGUgUHVibGljS2V5IG9iamVjdCBmb3IgdGhlIHB1YmxpYyBrZXkgdGhpcyBjZXJ0aWZpY2F0ZSBjb250YWlucwogICAgICAgICIiIgoKICAgICAgICBpZiBzZWxmLl9wdWJsaWNfa2V5IGlzIE5vbmU6CiAgICAgICAgICAgIHNlbGYuX3B1YmxpY19rZXkgPSBsb2FkX3B1YmxpY19rZXkoc2VsZi5hc24xWyd0YnNfY2VydGlmaWNhdGUnXVsnc3ViamVjdF9wdWJsaWNfa2V5X2luZm8nXSkKICAgICAgICByZXR1cm4gc2VsZi5fcHVibGljX2tleQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHNlbGZfc2lnbmVkKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIDpyZXR1cm46CiAgICAgICAgICAgIEEgYm9vbGVhbiAtIGlmIHRoZSBjZXJ0aWZpY2F0ZSBpcyBzZWxmLXNpZ25lZAogICAgICAgICIiIgoKICAgICAgICBpZiBzZWxmLl9zZWxmX3NpZ25lZCBpcyBOb25lOgogICAgICAgICAgICBzZWxmLl9zZWxmX3NpZ25lZCA9IEZhbHNlCiAgICAgICAgICAgIGlmIHNlbGYuYXNuMS5zZWxmX3NpZ25lZCBpbiBzZXQoWyd5ZXMnLCAnbWF5YmUnXSk6CgogICAgICAgICAgICAgICAgc2lnbmF0dXJlX2FsZ28gPSBzZWxmLmFzbjFbJ3NpZ25hdHVyZV9hbGdvcml0aG0nXS5zaWduYXR1cmVfYWxnbwogICAgICAgICAgICAgICAgaGFzaF9hbGdvID0gc2VsZi5hc24xWydzaWduYXR1cmVfYWxnb3JpdGhtJ10uaGFzaF9hbGdvCgogICAgICAgICAgICAgICAgaWYgc2lnbmF0dXJlX2FsZ28gPT0gJ3JzYXNzYV9wa2NzMXYxNSc6CiAgICAgICAgICAgICAgICAgICAgdmVyaWZ5X2Z1bmMgPSByc2FfcGtjczF2MTVfdmVyaWZ5CiAgICAgICAgICAgICAgICBlbGlmIHNpZ25hdHVyZV9hbGdvID09ICdyc2Fzc2FfcHNzJzoKICAgICAgICAgICAgICAgICAgICB2ZXJpZnlfZnVuYyA9IHJzYV9wc3NfdmVyaWZ5CiAgICAgICAgICAgICAgICBlbGlmIHNpZ25hdHVyZV9hbGdvID09ICdkc2EnOgogICAgICAgICAgICAgICAgICAgIHZlcmlmeV9mdW5jID0gZHNhX3ZlcmlmeQogICAgICAgICAgICAgICAgZWxpZiBzaWduYXR1cmVfYWxnbyA9PSAnZWNkc2EnOgogICAgICAgICAgICAgICAgICAgIHZlcmlmeV9mdW5jID0gZWNkc2FfdmVyaWZ5CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIE9TRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICAgICAgICAgICAgICBVbmFibGUgdG8gdmVyaWZ5IHRoZSBzaWduYXR1cmUgb2YgdGhlIGNlcnRpZmljYXRlIHNpbmNlCiAgICAgICAgICAgICAgICAgICAgICAgIGl0IHVzZXMgdGhlIHVuc3VwcG9ydGVkIGFsZ29yaXRobSAlcwogICAgICAgICAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hdHVyZV9hbGdvCiAgICAgICAgICAgICAgICAgICAgKSkKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgdmVyaWZ5X2Z1bmMoCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYXNuMVsnc2lnbmF0dXJlX3ZhbHVlJ10ubmF0aXZlLAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFzbjFbJ3Ric19jZXJ0aWZpY2F0ZSddLmR1bXAoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGFzaF9hbGdvCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbGZfc2lnbmVkID0gVHJ1ZQogICAgICAgICAgICAgICAgZXhjZXB0IChTaWduYXR1cmVFcnJvcik6CiAgICAgICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICByZXR1cm4gc2VsZi5fc2VsZl9zaWduZWQKCgpkZWYgZ2VuZXJhdGVfcGFpcihhbGdvcml0aG0sIGJpdF9zaXplPU5vbmUsIGN1cnZlPU5vbmUpOgogICAgIiIiCiAgICBHZW5lcmF0ZXMgYSBwdWJsaWMvcHJpdmF0ZSBrZXkgcGFpcgoKICAgIDpwYXJhbSBhbGdvcml0aG06CiAgICAgICAgVGhlIGtleSBhbGdvcml0aG0gLSAicnNhIiwgImRzYSIgb3IgImVjIgoKICAgIDpwYXJhbSBiaXRfc2l6ZToKICAgICAgICBBbiBpbnRlZ2VyIC0gdXNlZCBmb3IgInJzYSIgYW5kICJkc2EiLiBGb3IgInJzYSIgdGhlIHZhbHVlIG1heWUgYmUgMTAyNCwKICAgICAgICAyMDQ4LCAzMDcyIG9yIDQwOTYuIEZvciAiZHNhIiB0aGUgdmFsdWUgbWF5IGJlIDEwMjQsIHBsdXMgMjA0OCBvciAzMDcyCiAgICAgICAgaWYgb24gV2luZG93cyA4IG9yIG5ld2VyLgoKICAgIDpwYXJhbSBjdXJ2ZToKICAgICAgICBBIHVuaWNvZGUgc3RyaW5nIC0gdXNlZCBmb3IgImVjIiBrZXlzLiBWYWxpZCB2YWx1ZXMgaW5jbHVkZSAic2VjcDI1NnIxIiwKICAgICAgICAic2VjcDM4NHIxIiBhbmQgInNlY3A1MjFyMSIuCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIDItZWxlbWVudCB0dXBsZSBvZiAoUHVibGljS2V5LCBQcml2YXRlS2V5KS4gVGhlIGNvbnRlbnRzIG9mIGVhY2gga2V5CiAgICAgICAgbWF5IGJlIHNhdmVkIGJ5IGNhbGxpbmcgLmFzbjEuZHVtcCgpLgogICAgIiIiCgogICAgaWYgYWxnb3JpdGhtIG5vdCBpbiBzZXQoWydyc2EnLCAnZHNhJywgJ2VjJ10pOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBhbGdvcml0aG0gbXVzdCBiZSBvbmUgb2YgInJzYSIsICJkc2EiLCAiZWMiLCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICByZXByKGFsZ29yaXRobSkKICAgICAgICApKQoKICAgIGlmIGFsZ29yaXRobSA9PSAncnNhJzoKICAgICAgICBpZiBiaXRfc2l6ZSBub3QgaW4gc2V0KFsxMDI0LCAyMDQ4LCAzMDcyLCA0MDk2XSk6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIGJpdF9zaXplIG11c3QgYmUgb25lIG9mIDEwMjQsIDIwNDgsIDMwNzIsIDQwOTYsIG5vdCAlcwogICAgICAgICAgICAgICAgJycnLAogICAgICAgICAgICAgICAgcmVwcihiaXRfc2l6ZSkKICAgICAgICAgICAgKSkKCiAgICBlbGlmIGFsZ29yaXRobSA9PSAnZHNhJzoKICAgICAgICAjIFdpbmRvd3MgVmlzdGEgYW5kIDcgb25seSBzdXBwb3J0IFNIQTEtYmFzZWQgRFNBIGtleXMKICAgICAgICBpZiBfd2luX3ZlcnNpb25faW5mbyA8ICg2LCAyKSBvciBfYmFja2VuZCA9PSAnd2lubGVnYWN5JzoKICAgICAgICAgICAgaWYgYml0X3NpemUgIT0gMTAyNDoKICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICAgICAgYml0X3NpemUgbXVzdCBiZSAxMDI0LCBub3QgJXMKICAgICAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICAgICAgcmVwcihiaXRfc2l6ZSkKICAgICAgICAgICAgICAgICkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgYml0X3NpemUgbm90IGluIHNldChbMTAyNCwgMjA0OCwgMzA3Ml0pOgogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgICAgICBiaXRfc2l6ZSBtdXN0IGJlIG9uZSBvZiAxMDI0LCAyMDQ4LCAzMDcyLCBub3QgJXMKICAgICAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICAgICAgcmVwcihiaXRfc2l6ZSkKICAgICAgICAgICAgICAgICkpCgogICAgZWxpZiBhbGdvcml0aG0gPT0gJ2VjJzoKICAgICAgICBpZiBjdXJ2ZSBub3QgaW4gc2V0KFsnc2VjcDI1NnIxJywgJ3NlY3AzODRyMScsICdzZWNwNTIxcjEnXSk6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIGN1cnZlIG11c3QgYmUgb25lIG9mICJzZWNwMjU2cjEiLCAic2VjcDM4NHIxIiwgInNlY3A1MjFyMSIsIG5vdCAlcwogICAgICAgICAgICAgICAgJycnLAogICAgICAgICAgICAgICAgcmVwcihjdXJ2ZSkKICAgICAgICAgICAgKSkKCiAgICBpZiBfYmFja2VuZCA9PSAnd2lubGVnYWN5JzoKICAgICAgICBpZiBhbGdvcml0aG0gPT0gJ2VjJzoKICAgICAgICAgICAgcHViX2luZm8sIHByaXZfaW5mbyA9IF9wdXJlX3B5dGhvbl9lY19nZW5lcmF0ZV9wYWlyKGN1cnZlKQogICAgICAgICAgICByZXR1cm4gKFB1YmxpY0tleShOb25lLCBwdWJfaW5mbyksIFByaXZhdGVLZXkoTm9uZSwgcHJpdl9pbmZvKSkKICAgICAgICByZXR1cm4gX2FkdmFwaTMyX2dlbmVyYXRlX3BhaXIoYWxnb3JpdGhtLCBiaXRfc2l6ZSkKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIF9iY3J5cHRfZ2VuZXJhdGVfcGFpcihhbGdvcml0aG0sIGJpdF9zaXplLCBjdXJ2ZSkKCgpkZWYgX2FkdmFwaTMyX2tleV9oYW5kbGVfdG9fYXNuMShhbGdvcml0aG0sIGJpdF9zaXplLCBrZXlfaGFuZGxlKToKICAgICIiIgogICAgQWNjZXB0cyBhbiBrZXkgaGFuZGxlIGFuZCBleHBvcnRzIGl0IHRvIEFTTi4xCgogICAgOnBhcmFtIGFsZ29yaXRobToKICAgICAgICBUaGUga2V5IGFsZ29yaXRobSAtICJyc2EiIG9yICJkc2EiCgogICAgOnBhcmFtIGJpdF9zaXplOgogICAgICAgIEFuIGludGVnZXIgLSBvbmx5IHVzZWQgd2hlbiBhbGdvcml0aG0gaXMgInJzYSIKCiAgICA6cGFyYW0ga2V5X2hhbmRsZToKICAgICAgICBUaGUgaGFuZGxlIHRvIGV4cG9ydAoKICAgIDpyZXR1cm46CiAgICAgICAgQSAyLWVsZW1lbnQgdHVwbGUgb2YgYXNuMWNyeXB0by5rZXlzLlByaXZhdGVLZXlJbmZvIGFuZAogICAgICAgIGFzbjFjcnlwdG8ua2V5cy5QdWJsaWNLZXlJbmZvCiAgICAiIiIKCiAgICBpZiBhbGdvcml0aG0gPT0gJ3JzYSc6CiAgICAgICAgc3RydWN0X3R5cGUgPSAnUlNBQkxPQkhFQURFUicKICAgIGVsc2U6CiAgICAgICAgc3RydWN0X3R5cGUgPSAnRFNTQkxPQkhFQURFUicKCiAgICBvdXRfbGVuID0gbmV3KGFkdmFwaTMyLCAnRFdPUkQgKicpCiAgICByZXMgPSBhZHZhcGkzMi5DcnlwdEV4cG9ydEtleSgKICAgICAgICBrZXlfaGFuZGxlLAogICAgICAgIG51bGwoKSwKICAgICAgICBBZHZhcGkzMkNvbnN0LlBSSVZBVEVLRVlCTE9CLAogICAgICAgIDAsCiAgICAgICAgbnVsbCgpLAogICAgICAgIG91dF9sZW4KICAgICkKICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgYnVmZmVyX2xlbmd0aCA9IGRlcmVmKG91dF9sZW4pCiAgICBidWZmZXJfID0gYnVmZmVyX2Zyb21fYnl0ZXMoYnVmZmVyX2xlbmd0aCkKICAgIHJlcyA9IGFkdmFwaTMyLkNyeXB0RXhwb3J0S2V5KAogICAgICAgIGtleV9oYW5kbGUsCiAgICAgICAgbnVsbCgpLAogICAgICAgIEFkdmFwaTMyQ29uc3QuUFJJVkFURUtFWUJMT0IsCiAgICAgICAgMCwKICAgICAgICBidWZmZXJfLAogICAgICAgIG91dF9sZW4KICAgICkKICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgYmxvYl9zdHJ1Y3RfcG9pbnRlciA9IHN0cnVjdF9mcm9tX2J1ZmZlcihhZHZhcGkzMiwgc3RydWN0X3R5cGUsIGJ1ZmZlcl8pCiAgICBibG9iX3N0cnVjdCA9IHVud3JhcChibG9iX3N0cnVjdF9wb2ludGVyKQogICAgc3RydWN0X3NpemUgPSBzaXplb2YoYWR2YXBpMzIsIGJsb2Jfc3RydWN0KQoKICAgIHByaXZhdGVfYmxvYiA9IGJ5dGVzX2Zyb21fYnVmZmVyKGJ1ZmZlcl8sIGJ1ZmZlcl9sZW5ndGgpW3N0cnVjdF9zaXplOl0KCiAgICBpZiBhbGdvcml0aG0gPT0gJ3JzYSc6CiAgICAgICAgcHVibGljX2luZm8sIHByaXZhdGVfaW5mbyA9IF9hZHZhcGkzMl9pbnRlcnByZXRfcnNhX2tleV9ibG9iKGJpdF9zaXplLCBibG9iX3N0cnVjdCwgcHJpdmF0ZV9ibG9iKQoKICAgIGVsc2U6CiAgICAgICAgIyBUaGUgcHVibGljIGtleSBmb3IgYSBEU0Ega2V5IGlzIG5vdCBhdmFpbGFibGUgaW4gZnJvbSB0aGUgcHJpdmF0ZQogICAgICAgICMga2V5IGJsb2IsIHNvIHdlIGhhdmUgdG8gc2VwYXJhdGVseSBleHBvcnQgdGhlIHB1YmxpYyBrZXkKICAgICAgICBwdWJsaWNfb3V0X2xlbiA9IG5ldyhhZHZhcGkzMiwgJ0RXT1JEIConKQogICAgICAgIHJlcyA9IGFkdmFwaTMyLkNyeXB0RXhwb3J0S2V5KAogICAgICAgICAgICBrZXlfaGFuZGxlLAogICAgICAgICAgICBudWxsKCksCiAgICAgICAgICAgIEFkdmFwaTMyQ29uc3QuUFVCTElDS0VZQkxPQiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgbnVsbCgpLAogICAgICAgICAgICBwdWJsaWNfb3V0X2xlbgogICAgICAgICkKICAgICAgICBoYW5kbGVfZXJyb3IocmVzKQoKICAgICAgICBwdWJsaWNfYnVmZmVyX2xlbmd0aCA9IGRlcmVmKHB1YmxpY19vdXRfbGVuKQogICAgICAgIHB1YmxpY19idWZmZXIgPSBidWZmZXJfZnJvbV9ieXRlcyhwdWJsaWNfYnVmZmVyX2xlbmd0aCkKICAgICAgICByZXMgPSBhZHZhcGkzMi5DcnlwdEV4cG9ydEtleSgKICAgICAgICAgICAga2V5X2hhbmRsZSwKICAgICAgICAgICAgbnVsbCgpLAogICAgICAgICAgICBBZHZhcGkzMkNvbnN0LlBVQkxJQ0tFWUJMT0IsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIHB1YmxpY19idWZmZXIsCiAgICAgICAgICAgIHB1YmxpY19vdXRfbGVuCiAgICAgICAgKQogICAgICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgICAgIHB1YmxpY19ibG9iID0gYnl0ZXNfZnJvbV9idWZmZXIocHVibGljX2J1ZmZlciwgcHVibGljX2J1ZmZlcl9sZW5ndGgpW3N0cnVjdF9zaXplOl0KCiAgICAgICAgcHVibGljX2luZm8sIHByaXZhdGVfaW5mbyA9IF9hZHZhcGkzMl9pbnRlcnByZXRfZHNhX2tleV9ibG9iKGJpdF9zaXplLCBwdWJsaWNfYmxvYiwgcHJpdmF0ZV9ibG9iKQoKICAgIHJldHVybiAocHVibGljX2luZm8sIHByaXZhdGVfaW5mbykKCgpkZWYgX2FkdmFwaTMyX2dlbmVyYXRlX3BhaXIoYWxnb3JpdGhtLCBiaXRfc2l6ZT1Ob25lKToKICAgICIiIgogICAgR2VuZXJhdGVzIGEgcHVibGljL3ByaXZhdGUga2V5IHBhaXIgdXNpbmcgQ3J5cHRvQVBJCgogICAgOnBhcmFtIGFsZ29yaXRobToKICAgICAgICBUaGUga2V5IGFsZ29yaXRobSAtICJyc2EiIG9yICJkc2EiCgogICAgOnBhcmFtIGJpdF9zaXplOgogICAgICAgIEFuIGludGVnZXIgLSB1c2VkIGZvciAicnNhIiBhbmQgImRzYSIuIEZvciAicnNhIiB0aGUgdmFsdWUgbWF5ZSBiZSAxMDI0LAogICAgICAgIDIwNDgsIDMwNzIgb3IgNDA5Ni4gRm9yICJkc2EiIHRoZSB2YWx1ZSBtYXkgYmUgMTAyNC4KCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKCiAgICA6cmV0dXJuOgogICAgICAgIEEgMi1lbGVtZW50IHR1cGxlIG9mIChQdWJsaWNLZXksIFByaXZhdGVLZXkpLiBUaGUgY29udGVudHMgb2YgZWFjaCBrZXkKICAgICAgICBtYXkgYmUgc2F2ZWQgYnkgY2FsbGluZyAuYXNuMS5kdW1wKCkuCiAgICAiIiIKCiAgICBpZiBhbGdvcml0aG0gPT0gJ3JzYSc6CiAgICAgICAgcHJvdmlkZXIgPSBBZHZhcGkzMkNvbnN0Lk1TX0VOSF9SU0FfQUVTX1BST1YKICAgICAgICBhbGdvcml0aG1faWQgPSBBZHZhcGkzMkNvbnN0LkNBTEdfUlNBX1NJR04KICAgIGVsc2U6CiAgICAgICAgcHJvdmlkZXIgPSBBZHZhcGkzMkNvbnN0Lk1TX0VOSF9EU1NfREhfUFJPVgogICAgICAgIGFsZ29yaXRobV9pZCA9IEFkdmFwaTMyQ29uc3QuQ0FMR19EU1NfU0lHTgoKICAgIGNvbnRleHRfaGFuZGxlID0gTm9uZQogICAga2V5X2hhbmRsZSA9IE5vbmUKCiAgICB0cnk6CiAgICAgICAgY29udGV4dF9oYW5kbGUgPSBvcGVuX2NvbnRleHRfaGFuZGxlKHByb3ZpZGVyLCB2ZXJpZnlfb25seT1GYWxzZSkKCiAgICAgICAga2V5X2hhbmRsZV9wb2ludGVyID0gbmV3KGFkdmFwaTMyLCAnSENSWVBUS0VZIConKQogICAgICAgIGZsYWdzID0gKGJpdF9zaXplIDw8IDE2KSB8IEFkdmFwaTMyQ29uc3QuQ1JZUFRfRVhQT1JUQUJMRQogICAgICAgIHJlcyA9IGFkdmFwaTMyLkNyeXB0R2VuS2V5KGNvbnRleHRfaGFuZGxlLCBhbGdvcml0aG1faWQsIGZsYWdzLCBrZXlfaGFuZGxlX3BvaW50ZXIpCiAgICAgICAgaGFuZGxlX2Vycm9yKHJlcykKCiAgICAgICAga2V5X2hhbmRsZSA9IHVud3JhcChrZXlfaGFuZGxlX3BvaW50ZXIpCgogICAgICAgIHB1YmxpY19pbmZvLCBwcml2YXRlX2luZm8gPSBfYWR2YXBpMzJfa2V5X2hhbmRsZV90b19hc24xKGFsZ29yaXRobSwgYml0X3NpemUsIGtleV9oYW5kbGUpCgogICAgICAgIHJldHVybiAobG9hZF9wdWJsaWNfa2V5KHB1YmxpY19pbmZvKSwgbG9hZF9wcml2YXRlX2tleShwcml2YXRlX2luZm8pKQoKICAgIGZpbmFsbHk6CiAgICAgICAgaWYgY29udGV4dF9oYW5kbGU6CiAgICAgICAgICAgIGNsb3NlX2NvbnRleHRfaGFuZGxlKGNvbnRleHRfaGFuZGxlKQogICAgICAgIGlmIGtleV9oYW5kbGU6CiAgICAgICAgICAgIGFkdmFwaTMyLkNyeXB0RGVzdHJveUtleShrZXlfaGFuZGxlKQoKCmRlZiBfYmNyeXB0X2tleV9oYW5kbGVfdG9fYXNuMShhbGdvcml0aG0sIGJpdF9zaXplLCBrZXlfaGFuZGxlKToKICAgICIiIgogICAgQWNjZXB0cyBhbiBrZXkgaGFuZGxlIGFuZCBleHBvcnRzIGl0IHRvIEFTTi4xCgogICAgOnBhcmFtIGFsZ29yaXRobToKICAgICAgICBUaGUga2V5IGFsZ29yaXRobSAtICJyc2EiLCAiZHNhIiBvciAiZWMiCgogICAgOnBhcmFtIGJpdF9zaXplOgogICAgICAgIEFuIGludGVnZXIgLSBvbmx5IHVzZWQgd2hlbiBhbGdvcml0aG0gaXMgImRzYSIKCiAgICA6cGFyYW0ga2V5X2hhbmRsZToKICAgICAgICBUaGUgaGFuZGxlIHRvIGV4cG9ydAoKICAgIDpyZXR1cm46CiAgICAgICAgQSAyLWVsZW1lbnQgdHVwbGUgb2YgYXNuMWNyeXB0by5rZXlzLlByaXZhdGVLZXlJbmZvIGFuZAogICAgICAgIGFzbjFjcnlwdG8ua2V5cy5QdWJsaWNLZXlJbmZvCiAgICAiIiIKCiAgICBpZiBhbGdvcml0aG0gPT0gJ3JzYSc6CiAgICAgICAgc3RydWN0X3R5cGUgPSAnQkNSWVBUX1JTQUtFWV9CTE9CJwogICAgICAgIHByaXZhdGVfYmxvYl90eXBlID0gQmNyeXB0Q29uc3QuQkNSWVBUX1JTQUZVTExQUklWQVRFX0JMT0IKICAgICAgICBwdWJsaWNfYmxvYl90eXBlID0gQmNyeXB0Q29uc3QuQkNSWVBUX1JTQVBVQkxJQ19CTE9CCgogICAgZWxpZiBhbGdvcml0aG0gPT0gJ2RzYSc6CiAgICAgICAgaWYgYml0X3NpemUgPiAxMDI0OgogICAgICAgICAgICBzdHJ1Y3RfdHlwZSA9ICdCQ1JZUFRfRFNBX0tFWV9CTE9CX1YyJwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHN0cnVjdF90eXBlID0gJ0JDUllQVF9EU0FfS0VZX0JMT0InCiAgICAgICAgcHJpdmF0ZV9ibG9iX3R5cGUgPSBCY3J5cHRDb25zdC5CQ1JZUFRfRFNBX1BSSVZBVEVfQkxPQgogICAgICAgIHB1YmxpY19ibG9iX3R5cGUgPSBCY3J5cHRDb25zdC5CQ1JZUFRfRFNBX1BVQkxJQ19CTE9CCgogICAgZWxzZToKICAgICAgICBzdHJ1Y3RfdHlwZSA9ICdCQ1JZUFRfRUNDS0VZX0JMT0InCiAgICAgICAgcHJpdmF0ZV9ibG9iX3R5cGUgPSBCY3J5cHRDb25zdC5CQ1JZUFRfRUNDUFJJVkFURV9CTE9CCiAgICAgICAgcHVibGljX2Jsb2JfdHlwZSA9IEJjcnlwdENvbnN0LkJDUllQVF9FQ0NQVUJMSUNfQkxPQgoKICAgIHByaXZhdGVfb3V0X2xlbiA9IG5ldyhiY3J5cHQsICdVTE9ORyAqJykKICAgIHJlcyA9IGJjcnlwdC5CQ3J5cHRFeHBvcnRLZXkoa2V5X2hhbmRsZSwgbnVsbCgpLCBwcml2YXRlX2Jsb2JfdHlwZSwgbnVsbCgpLCAwLCBwcml2YXRlX291dF9sZW4sIDApCiAgICBoYW5kbGVfZXJyb3IocmVzKQoKICAgIHByaXZhdGVfYnVmZmVyX2xlbmd0aCA9IGRlcmVmKHByaXZhdGVfb3V0X2xlbikKICAgIHByaXZhdGVfYnVmZmVyID0gYnVmZmVyX2Zyb21fYnl0ZXMocHJpdmF0ZV9idWZmZXJfbGVuZ3RoKQogICAgcmVzID0gYmNyeXB0LkJDcnlwdEV4cG9ydEtleSgKICAgICAgICBrZXlfaGFuZGxlLAogICAgICAgIG51bGwoKSwKICAgICAgICBwcml2YXRlX2Jsb2JfdHlwZSwKICAgICAgICBwcml2YXRlX2J1ZmZlciwKICAgICAgICBwcml2YXRlX2J1ZmZlcl9sZW5ndGgsCiAgICAgICAgcHJpdmF0ZV9vdXRfbGVuLAogICAgICAgIDAKICAgICkKICAgIGhhbmRsZV9lcnJvcihyZXMpCiAgICBwcml2YXRlX2Jsb2Jfc3RydWN0X3BvaW50ZXIgPSBzdHJ1Y3RfZnJvbV9idWZmZXIoYmNyeXB0LCBzdHJ1Y3RfdHlwZSwgcHJpdmF0ZV9idWZmZXIpCiAgICBwcml2YXRlX2Jsb2Jfc3RydWN0ID0gdW53cmFwKHByaXZhdGVfYmxvYl9zdHJ1Y3RfcG9pbnRlcikKICAgIHN0cnVjdF9zaXplID0gc2l6ZW9mKGJjcnlwdCwgcHJpdmF0ZV9ibG9iX3N0cnVjdCkKICAgIHByaXZhdGVfYmxvYiA9IGJ5dGVzX2Zyb21fYnVmZmVyKHByaXZhdGVfYnVmZmVyLCBwcml2YXRlX2J1ZmZlcl9sZW5ndGgpW3N0cnVjdF9zaXplOl0KCiAgICBpZiBhbGdvcml0aG0gPT0gJ3JzYSc6CiAgICAgICAgcHJpdmF0ZV9rZXkgPSBfYmNyeXB0X2ludGVycHJldF9yc2Ffa2V5X2Jsb2IoJ3ByaXZhdGUnLCBwcml2YXRlX2Jsb2Jfc3RydWN0LCBwcml2YXRlX2Jsb2IpCiAgICBlbGlmIGFsZ29yaXRobSA9PSAnZHNhJzoKICAgICAgICBpZiBiaXRfc2l6ZSA+IDEwMjQ6CiAgICAgICAgICAgIHByaXZhdGVfa2V5ID0gX2JjcnlwdF9pbnRlcnByZXRfZHNhX2tleV9ibG9iKCdwcml2YXRlJywgMiwgcHJpdmF0ZV9ibG9iX3N0cnVjdCwgcHJpdmF0ZV9ibG9iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaXZhdGVfa2V5ID0gX2JjcnlwdF9pbnRlcnByZXRfZHNhX2tleV9ibG9iKCdwcml2YXRlJywgMSwgcHJpdmF0ZV9ibG9iX3N0cnVjdCwgcHJpdmF0ZV9ibG9iKQogICAgZWxzZToKICAgICAgICBwcml2YXRlX2tleSA9IF9iY3J5cHRfaW50ZXJwcmV0X2VjX2tleV9ibG9iKCdwcml2YXRlJywgcHJpdmF0ZV9ibG9iX3N0cnVjdCwgcHJpdmF0ZV9ibG9iKQoKICAgIHB1YmxpY19vdXRfbGVuID0gbmV3KGJjcnlwdCwgJ1VMT05HIConKQogICAgcmVzID0gYmNyeXB0LkJDcnlwdEV4cG9ydEtleShrZXlfaGFuZGxlLCBudWxsKCksIHB1YmxpY19ibG9iX3R5cGUsIG51bGwoKSwgMCwgcHVibGljX291dF9sZW4sIDApCiAgICBoYW5kbGVfZXJyb3IocmVzKQoKICAgIHB1YmxpY19idWZmZXJfbGVuZ3RoID0gZGVyZWYocHVibGljX291dF9sZW4pCiAgICBwdWJsaWNfYnVmZmVyID0gYnVmZmVyX2Zyb21fYnl0ZXMocHVibGljX2J1ZmZlcl9sZW5ndGgpCiAgICByZXMgPSBiY3J5cHQuQkNyeXB0RXhwb3J0S2V5KAogICAgICAgIGtleV9oYW5kbGUsCiAgICAgICAgbnVsbCgpLAogICAgICAgIHB1YmxpY19ibG9iX3R5cGUsCiAgICAgICAgcHVibGljX2J1ZmZlciwKICAgICAgICBwdWJsaWNfYnVmZmVyX2xlbmd0aCwKICAgICAgICBwdWJsaWNfb3V0X2xlbiwKICAgICAgICAwCiAgICApCiAgICBoYW5kbGVfZXJyb3IocmVzKQogICAgcHVibGljX2Jsb2Jfc3RydWN0X3BvaW50ZXIgPSBzdHJ1Y3RfZnJvbV9idWZmZXIoYmNyeXB0LCBzdHJ1Y3RfdHlwZSwgcHVibGljX2J1ZmZlcikKICAgIHB1YmxpY19ibG9iX3N0cnVjdCA9IHVud3JhcChwdWJsaWNfYmxvYl9zdHJ1Y3RfcG9pbnRlcikKICAgIHN0cnVjdF9zaXplID0gc2l6ZW9mKGJjcnlwdCwgcHVibGljX2Jsb2Jfc3RydWN0KQogICAgcHVibGljX2Jsb2IgPSBieXRlc19mcm9tX2J1ZmZlcihwdWJsaWNfYnVmZmVyLCBwdWJsaWNfYnVmZmVyX2xlbmd0aClbc3RydWN0X3NpemU6XQoKICAgIGlmIGFsZ29yaXRobSA9PSAncnNhJzoKICAgICAgICBwdWJsaWNfa2V5ID0gX2JjcnlwdF9pbnRlcnByZXRfcnNhX2tleV9ibG9iKCdwdWJsaWMnLCBwdWJsaWNfYmxvYl9zdHJ1Y3QsIHB1YmxpY19ibG9iKQogICAgZWxpZiBhbGdvcml0aG0gPT0gJ2RzYSc6CiAgICAgICAgaWYgYml0X3NpemUgPiAxMDI0OgogICAgICAgICAgICBwdWJsaWNfa2V5ID0gX2JjcnlwdF9pbnRlcnByZXRfZHNhX2tleV9ibG9iKCdwdWJsaWMnLCAyLCBwdWJsaWNfYmxvYl9zdHJ1Y3QsIHB1YmxpY19ibG9iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHB1YmxpY19rZXkgPSBfYmNyeXB0X2ludGVycHJldF9kc2Ffa2V5X2Jsb2IoJ3B1YmxpYycsIDEsIHB1YmxpY19ibG9iX3N0cnVjdCwgcHVibGljX2Jsb2IpCiAgICBlbHNlOgogICAgICAgIHB1YmxpY19rZXkgPSBfYmNyeXB0X2ludGVycHJldF9lY19rZXlfYmxvYigncHVibGljJywgcHVibGljX2Jsb2Jfc3RydWN0LCBwdWJsaWNfYmxvYikKCiAgICByZXR1cm4gKHB1YmxpY19rZXksIHByaXZhdGVfa2V5KQoKCmRlZiBfYmNyeXB0X2dlbmVyYXRlX3BhaXIoYWxnb3JpdGhtLCBiaXRfc2l6ZT1Ob25lLCBjdXJ2ZT1Ob25lKToKICAgICIiIgogICAgR2VuZXJhdGVzIGEgcHVibGljL3ByaXZhdGUga2V5IHBhaXIgdXNpbmcgQ05HCgogICAgOnBhcmFtIGFsZ29yaXRobToKICAgICAgICBUaGUga2V5IGFsZ29yaXRobSAtICJyc2EiLCAiZHNhIiBvciAiZWMiCgogICAgOnBhcmFtIGJpdF9zaXplOgogICAgICAgIEFuIGludGVnZXIgLSB1c2VkIGZvciAicnNhIiBhbmQgImRzYSIuIEZvciAicnNhIiB0aGUgdmFsdWUgbWF5ZSBiZSAxMDI0LAogICAgICAgIDIwNDgsIDMwNzIgb3IgNDA5Ni4gRm9yICJkc2EiIHRoZSB2YWx1ZSBtYXkgYmUgMTAyNCwgcGx1cyAyMDQ4IG9yIDMwNzIKICAgICAgICBpZiBvbiBXaW5kb3dzIDggb3IgbmV3ZXIuCgogICAgOnBhcmFtIGN1cnZlOgogICAgICAgIEEgdW5pY29kZSBzdHJpbmcgLSB1c2VkIGZvciAiZWMiIGtleXMuIFZhbGlkIHZhbHVlcyBpbmNsdWRlICJzZWNwMjU2cjEiLAogICAgICAgICJzZWNwMzg0cjEiIGFuZCAic2VjcDUyMXIxIi4KCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKCiAgICA6cmV0dXJuOgogICAgICAgIEEgMi1lbGVtZW50IHR1cGxlIG9mIChQdWJsaWNLZXksIFByaXZhdGVLZXkpLiBUaGUgY29udGVudHMgb2YgZWFjaCBrZXkKICAgICAgICBtYXkgYmUgc2F2ZWQgYnkgY2FsbGluZyAuYXNuMS5kdW1wKCkuCiAgICAiIiIKCiAgICBpZiBhbGdvcml0aG0gPT0gJ3JzYSc6CiAgICAgICAgYWxnX2NvbnN0YW50ID0gQmNyeXB0Q29uc3QuQkNSWVBUX1JTQV9BTEdPUklUSE0KCiAgICBlbGlmIGFsZ29yaXRobSA9PSAnZHNhJzoKICAgICAgICBhbGdfY29uc3RhbnQgPSBCY3J5cHRDb25zdC5CQ1JZUFRfRFNBX0FMR09SSVRITQoKICAgIGVsc2U6CiAgICAgICAgYWxnX2NvbnN0YW50ID0gewogICAgICAgICAgICAnc2VjcDI1NnIxJzogQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1AyNTZfQUxHT1JJVEhNLAogICAgICAgICAgICAnc2VjcDM4NHIxJzogQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1AzODRfQUxHT1JJVEhNLAogICAgICAgICAgICAnc2VjcDUyMXIxJzogQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1A1MjFfQUxHT1JJVEhNLAogICAgICAgIH1bY3VydmVdCiAgICAgICAgYml0X3NpemUgPSB7CiAgICAgICAgICAgICdzZWNwMjU2cjEnOiAyNTYsCiAgICAgICAgICAgICdzZWNwMzg0cjEnOiAzODQsCiAgICAgICAgICAgICdzZWNwNTIxcjEnOiA1MjEsCiAgICAgICAgfVtjdXJ2ZV0KCiAgICBrZXlfaGFuZGxlID0gTm9uZQogICAgdHJ5OgogICAgICAgIGFsZ19oYW5kbGUgPSBvcGVuX2FsZ19oYW5kbGUoYWxnX2NvbnN0YW50KQogICAgICAgIGtleV9oYW5kbGVfcG9pbnRlciA9IG5ldyhiY3J5cHQsICdCQ1JZUFRfS0VZX0hBTkRMRSAqJykKICAgICAgICByZXMgPSBiY3J5cHQuQkNyeXB0R2VuZXJhdGVLZXlQYWlyKGFsZ19oYW5kbGUsIGtleV9oYW5kbGVfcG9pbnRlciwgYml0X3NpemUsIDApCiAgICAgICAgaGFuZGxlX2Vycm9yKHJlcykKICAgICAgICBrZXlfaGFuZGxlID0gdW53cmFwKGtleV9oYW5kbGVfcG9pbnRlcikKCiAgICAgICAgcmVzID0gYmNyeXB0LkJDcnlwdEZpbmFsaXplS2V5UGFpcihrZXlfaGFuZGxlLCAwKQogICAgICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgICAgIHB1YmxpY19rZXksIHByaXZhdGVfa2V5ID0gX2JjcnlwdF9rZXlfaGFuZGxlX3RvX2FzbjEoYWxnb3JpdGhtLCBiaXRfc2l6ZSwga2V5X2hhbmRsZSkKCiAgICBmaW5hbGx5OgogICAgICAgIGlmIGtleV9oYW5kbGU6CiAgICAgICAgICAgIGJjcnlwdC5CQ3J5cHREZXN0cm95S2V5KGtleV9oYW5kbGUpCgogICAgcmV0dXJuIChsb2FkX3B1YmxpY19rZXkocHVibGljX2tleSksIGxvYWRfcHJpdmF0ZV9rZXkocHJpdmF0ZV9rZXkpKQoKCmRlZiBnZW5lcmF0ZV9kaF9wYXJhbWV0ZXJzKGJpdF9zaXplKToKICAgICIiIgogICAgR2VuZXJhdGVzIERIIHBhcmFtZXRlcnMgZm9yIHVzZSB3aXRoIERpZmZpZS1IZWxsbWFuIGtleSBleGNoYW5nZS4gUmV0dXJucwogICAgYSBzdHJ1Y3R1cmUgaW4gdGhlIGZvcm1hdCBvZiBESFBhcmFtZXRlciBkZWZpbmVkIGluIFBLQ1MjMywgd2hpY2ggaXMgYWxzbwogICAgdXNlZCBieSB0aGUgT3BlblNTTCBkaHBhcmFtIHRvb2wuCgogICAgVEhJUyBDQU4gQkUgVkVSWSBUSU1FIENPTlNVTUlORyEKCiAgICA6cGFyYW0gYml0X3NpemU6CiAgICAgICAgVGhlIGludGVnZXIgYml0IHNpemUgb2YgdGhlIHBhcmFtZXRlcnMgdG8gZ2VuZXJhdGUuIE11c3QgYmUgYmV0d2VlbiA1MTIKICAgICAgICBhbmQgNDA5NiwgYW5kIGRpdmlzaWJsZSBieSA2NC4gUmVjb21tZW5kZWQgc2VjdXJlIHZhbHVlIGFzIG9mIGVhcmx5IDIwMTYKICAgICAgICBpcyAyMDQ4LCB3aXRoIGFuIGFic29sdXRlIG1pbmltdW0gb2YgMTAyNC4KCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKCiAgICA6cmV0dXJuOgogICAgICAgIEFuIGFzbjFjcnlwdG8uYWxnb3MuREhQYXJhbWV0ZXJzIG9iamVjdC4gVXNlCiAgICAgICAgb3NjcnlwdG8uYXN5bW1ldHJpYy5kdW1wX2RoX3BhcmFtZXRlcnMoKSB0byBzYXZlIHRvIGRpc2sgZm9yIHVzYWdlIHdpdGgKICAgICAgICB3ZWIgc2VydmVycy4KICAgICIiIgoKICAgIGlmIG5vdCBpc2luc3RhbmNlKGJpdF9zaXplLCBpbnRfdHlwZXMpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGJpdF9zaXplIG11c3QgYmUgYW4gaW50ZWdlciwgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKGJpdF9zaXplKQogICAgICAgICkpCgogICAgaWYgYml0X3NpemUgPCA1MTI6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignYml0X3NpemUgbXVzdCBiZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gNTEyJykKCiAgICBpZiBiaXRfc2l6ZSA+IDQwOTY6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignYml0X3NpemUgbXVzdCBiZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gNDA5NicpCgogICAgaWYgYml0X3NpemUgJSA2NCAhPSAwOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ2JpdF9zaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA2NCcpCgogICAgYWxnX2hhbmRsZSA9IE5vbmUKCiAgICAjIFRoZSBmb2xsb3dpbmcgYWxnb3JpdGhtIGhhcyBlbGVtZW50cyB0YWtlbiBmcm9tIE9wZW5TU0wuIEluIHNob3J0LCBpdAogICAgIyBnZW5lcmF0ZXMgcmFuZG9tIG51bWJlcnMgYW5kIHRoZW4gZW5zdXJlcyB0aGF0IHRoZXkgYXJlIHZhbGlkIGZvciB0aGUKICAgICMgaGFyZGNvZGVkIGdlbmVyYXRvciBvZiAyLCBhbmQgdGhlbiBlbnN1cmVzIHRoZSBudW1iZXIgaXMgYSAic2FmZSIgcHJpbWUKICAgICMgYnkgZW5zdXJpbmcgcC8vMiBpcyBwcmltZSBhbHNvLgoKICAgICMgT3BlblNTTCBhbGxvd3MgdXNlIG9mIGdlbmVyYXRvciAyIG9yIDUsIGJ1dCB3ZSBoYXJkY29kZSAyIHNpbmNlIGl0IGlzCiAgICAjIHRoZSBkZWZhdWx0LCBhbmQgd2hhdCBpcyB1c2VkIGJ5IFNlY3VyaXR5LmZyYW1ld29yayBvbiBPUyBYIGFsc28uCiAgICBnID0gMgoKICAgIHRyeToKICAgICAgICBieXRlX3NpemUgPSBiaXRfc2l6ZSAvLyA4CiAgICAgICAgaWYgX2JhY2tlbmQgPT0gJ3dpbic6CiAgICAgICAgICAgIGFsZ19oYW5kbGUgPSBvcGVuX2FsZ19oYW5kbGUoQmNyeXB0Q29uc3QuQkNSWVBUX1JOR19BTEdPUklUSE0pCiAgICAgICAgICAgIGJ1ZmZlciA9IGJ1ZmZlcl9mcm9tX2J5dGVzKGJ5dGVfc2l6ZSkKCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgaWYgX2JhY2tlbmQgPT0gJ3dpbmxlZ2FjeSc6CiAgICAgICAgICAgICAgICByYiA9IG9zLnVyYW5kb20oYnl0ZV9zaXplKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmVzID0gYmNyeXB0LkJDcnlwdEdlblJhbmRvbShhbGdfaGFuZGxlLCBidWZmZXIsIGJ5dGVfc2l6ZSwgMCkKICAgICAgICAgICAgICAgIGhhbmRsZV9lcnJvcihyZXMpCiAgICAgICAgICAgICAgICByYiA9IGJ5dGVzX2Zyb21fYnVmZmVyKGJ1ZmZlcikKCiAgICAgICAgICAgIHAgPSBpbnRfZnJvbV9ieXRlcyhyYikKCiAgICAgICAgICAgICMgSWYgYSBudW1iZXIgaXMgZXZlbiwgaXQgY2FuJ3QgYmUgcHJpbWUKICAgICAgICAgICAgaWYgcCAlIDIgPT0gMDoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAjIFBlcmZvcm0gdGhlIGdlbmVyYXRvciBjaGVja3Mgb3V0bGluZWQgaW4gT3BlblNTTCdzCiAgICAgICAgICAgICMgZGhfYnVpbHRpbl9nZW5wYXJhbXMoKSBsb2NhdGVkIGluIGRoX2dlbi5jCiAgICAgICAgICAgIGlmIGcgPT0gMjoKICAgICAgICAgICAgICAgIGlmIHAgJSAyNCAhPSAxMToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbGlmIGcgPT0gNToKICAgICAgICAgICAgICAgIHJlbSA9IHAgJSAxMAogICAgICAgICAgICAgICAgaWYgcmVtICE9IDMgYW5kIHJlbSAhPSA3OgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBkaXZpc2libGUgPSBGYWxzZQogICAgICAgICAgICBmb3IgcHJpbWUgaW4gX1NNQUxMX1BSSU1FUzoKICAgICAgICAgICAgICAgIGlmIHAgJSBwcmltZSA9PSAwOgogICAgICAgICAgICAgICAgICAgIGRpdmlzaWJsZSA9IFRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgIyBJZiB0aGUgbnVtYmVyIGlzIG5vdCBkaXZpc2libGUgYnkgYW55IG9mIHRoZSBzbWFsbCBwcmltZXMsIHRoZW4KICAgICAgICAgICAgIyBtb3ZlIG9uIHRvIHRoZSBmdWxsIE1pbGxlci1SYWJpbiB0ZXN0LgogICAgICAgICAgICBpZiBub3QgZGl2aXNpYmxlIGFuZCBfaXNfcHJpbWUoYml0X3NpemUsIHApOgogICAgICAgICAgICAgICAgcSA9IHAgLy8gMgogICAgICAgICAgICAgICAgaWYgX2lzX3ByaW1lKGJpdF9zaXplLCBxKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gREhQYXJhbWV0ZXJzKHsncCc6IHAsICdnJzogZ30pCgogICAgZmluYWxseToKICAgICAgICBpZiBhbGdfaGFuZGxlOgogICAgICAgICAgICBjbG9zZV9hbGdfaGFuZGxlKGFsZ19oYW5kbGUpCgoKZGVmIF9pc19wcmltZShiaXRfc2l6ZSwgbik6CiAgICAiIiIKICAgIEFuIGltcGxlbWVudGF0aW9uIG9mIE1pbGxlcuKAk1JhYmluIGZvciBjaGVja2luZyBpZiBhIG51bWJlciBpcyBwcmltZS4KCiAgICA6cGFyYW0gYml0X3NpemU6CiAgICAgICAgQW4gaW50ZWdlciBvZiB0aGUgbnVtYmVyIG9mIGJpdHMgaW4gdGhlIHByaW1lIG51bWJlcgoKICAgIDpwYXJhbSBuOgogICAgICAgIEFuIGludGVnZXIsIHRoZSBwcmltZSBudW1iZXIKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYm9vbGVhbgogICAgIiIiCgogICAgciA9IDAKICAgIHMgPSBuIC0gMQogICAgd2hpbGUgcyAlIDIgPT0gMDoKICAgICAgICByICs9IDEKICAgICAgICBzIC8vPSAyCgogICAgaWYgYml0X3NpemUgPj0gMTMwMDoKICAgICAgICBrID0gMgogICAgZWxpZiBiaXRfc2l6ZSA+PSA4NTA6CiAgICAgICAgayA9IDMKICAgIGVsaWYgYml0X3NpemUgPj0gNjUwOgogICAgICAgIGsgPSA0CiAgICBlbGlmIGJpdF9zaXplID49IDU1MDoKICAgICAgICBrID0gNQogICAgZWxpZiBiaXRfc2l6ZSA+PSA0NTA6CiAgICAgICAgayA9IDYKCiAgICBmb3IgXyBpbiByYW5nZShrKToKICAgICAgICBhID0gcmFuZG9tLnJhbmRyYW5nZSgyLCBuIC0gMSkKICAgICAgICB4ID0gcG93KGEsIHMsIG4pCiAgICAgICAgaWYgeCA9PSAxIG9yIHggPT0gbiAtIDE6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZm9yIF8gaW4gcmFuZ2UociAtIDEpOgogICAgICAgICAgICB4ID0gcG93KHgsIDIsIG4pCiAgICAgICAgICAgIGlmIHggPT0gbiAtIDE6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIHJldHVybiBUcnVlCgoKZGVmIF9hZHZhcGkzMl9pbnRlcnByZXRfcnNhX2tleV9ibG9iKGJpdF9zaXplLCBibG9iX3N0cnVjdCwgYmxvYik6CiAgICAiIiIKICAgIFRha2VzIGEgQ3J5cHRvQVBJIFJTQSBwcml2YXRlIGtleSBibG9iIGFuZCBjb252ZXJ0cyBpdCBpbnRvIHRoZSBBU04uMQogICAgc3RydWN0dXJlcyBmb3IgdGhlIHB1YmxpYyBhbmQgcHJpdmF0ZSBrZXlzCgogICAgOnBhcmFtIGJpdF9zaXplOgogICAgICAgIFRoZSBpbnRlZ2VyIGJpdCBzaXplIG9mIHRoZSBrZXkKCiAgICA6cGFyYW0gYmxvYl9zdHJ1Y3Q6CiAgICAgICAgQW4gaW5zdGFuY2Ugb2YgdGhlIGFkdmFwaTMyLlJTQVBVQktFWSBzdHJ1Y3QKCiAgICA6cGFyYW0gYmxvYjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBiaW5hcnkgZGF0YSBhZnRlciB0aGUgaGVhZGVyCgogICAgOnJldHVybjoKICAgICAgICBBIDItZWxlbWVudCB0dXBsZSBvZiAoYXNuMWNyeXB0by5rZXlzLlB1YmxpY0tleUluZm8sCiAgICAgICAgYXNuMWNyeXB0by5rZXlzLlByaXZhdGVLZXlJbmZvKQogICAgIiIiCgogICAgbGVuMSA9IGJpdF9zaXplIC8vIDgKICAgIGxlbjIgPSBiaXRfc2l6ZSAvLyAxNgoKICAgIHByaW1lMV9vZmZzZXQgPSBsZW4xCiAgICBwcmltZTJfb2Zmc2V0ID0gcHJpbWUxX29mZnNldCArIGxlbjIKICAgIGV4cG9uZW50MV9vZmZzZXQgPSBwcmltZTJfb2Zmc2V0ICsgbGVuMgogICAgZXhwb25lbnQyX29mZnNldCA9IGV4cG9uZW50MV9vZmZzZXQgKyBsZW4yCiAgICBjb2VmZmljaWVudF9vZmZzZXQgPSBleHBvbmVudDJfb2Zmc2V0ICsgbGVuMgogICAgcHJpdmF0ZV9leHBvbmVudF9vZmZzZXQgPSBjb2VmZmljaWVudF9vZmZzZXQgKyBsZW4yCgogICAgcHVibGljX2V4cG9uZW50ID0gYmxvYl9zdHJ1Y3QucnNhcHVia2V5LnB1YmV4cAogICAgbW9kdWx1cyA9IGludF9mcm9tX2J5dGVzKGJsb2JbMDpwcmltZTFfb2Zmc2V0XVs6Oi0xXSkKICAgIHByaW1lMSA9IGludF9mcm9tX2J5dGVzKGJsb2JbcHJpbWUxX29mZnNldDpwcmltZTJfb2Zmc2V0XVs6Oi0xXSkKICAgIHByaW1lMiA9IGludF9mcm9tX2J5dGVzKGJsb2JbcHJpbWUyX29mZnNldDpleHBvbmVudDFfb2Zmc2V0XVs6Oi0xXSkKICAgIGV4cG9uZW50MSA9IGludF9mcm9tX2J5dGVzKGJsb2JbZXhwb25lbnQxX29mZnNldDpleHBvbmVudDJfb2Zmc2V0XVs6Oi0xXSkKICAgIGV4cG9uZW50MiA9IGludF9mcm9tX2J5dGVzKGJsb2JbZXhwb25lbnQyX29mZnNldDpjb2VmZmljaWVudF9vZmZzZXRdWzo6LTFdKQogICAgY29lZmZpY2llbnQgPSBpbnRfZnJvbV9ieXRlcyhibG9iW2NvZWZmaWNpZW50X29mZnNldDpwcml2YXRlX2V4cG9uZW50X29mZnNldF1bOjotMV0pCiAgICBwcml2YXRlX2V4cG9uZW50ID0gaW50X2Zyb21fYnl0ZXMoYmxvYltwcml2YXRlX2V4cG9uZW50X29mZnNldDpwcml2YXRlX2V4cG9uZW50X29mZnNldCArIGxlbjFdWzo6LTFdKQoKICAgIHB1YmxpY19rZXlfaW5mbyA9IFB1YmxpY0tleUluZm8oewogICAgICAgICdhbGdvcml0aG0nOiBQdWJsaWNLZXlBbGdvcml0aG0oewogICAgICAgICAgICAnYWxnb3JpdGhtJzogJ3JzYScsCiAgICAgICAgfSksCiAgICAgICAgJ3B1YmxpY19rZXknOiBSU0FQdWJsaWNLZXkoewogICAgICAgICAgICAnbW9kdWx1cyc6IG1vZHVsdXMsCiAgICAgICAgICAgICdwdWJsaWNfZXhwb25lbnQnOiBwdWJsaWNfZXhwb25lbnQsCiAgICAgICAgfSksCiAgICB9KQoKICAgIHJzYV9wcml2YXRlX2tleSA9IFJTQVByaXZhdGVLZXkoewogICAgICAgICd2ZXJzaW9uJzogJ3R3by1wcmltZScsCiAgICAgICAgJ21vZHVsdXMnOiBtb2R1bHVzLAogICAgICAgICdwdWJsaWNfZXhwb25lbnQnOiBwdWJsaWNfZXhwb25lbnQsCiAgICAgICAgJ3ByaXZhdGVfZXhwb25lbnQnOiBwcml2YXRlX2V4cG9uZW50LAogICAgICAgICdwcmltZTEnOiBwcmltZTEsCiAgICAgICAgJ3ByaW1lMic6IHByaW1lMiwKICAgICAgICAnZXhwb25lbnQxJzogZXhwb25lbnQxLAogICAgICAgICdleHBvbmVudDInOiBleHBvbmVudDIsCiAgICAgICAgJ2NvZWZmaWNpZW50JzogY29lZmZpY2llbnQsCiAgICB9KQoKICAgIHByaXZhdGVfa2V5X2luZm8gPSBQcml2YXRlS2V5SW5mbyh7CiAgICAgICAgJ3ZlcnNpb24nOiAwLAogICAgICAgICdwcml2YXRlX2tleV9hbGdvcml0aG0nOiBQcml2YXRlS2V5QWxnb3JpdGhtKHsKICAgICAgICAgICAgJ2FsZ29yaXRobSc6ICdyc2EnLAogICAgICAgIH0pLAogICAgICAgICdwcml2YXRlX2tleSc6IHJzYV9wcml2YXRlX2tleSwKICAgIH0pCgogICAgcmV0dXJuIChwdWJsaWNfa2V5X2luZm8sIHByaXZhdGVfa2V5X2luZm8pCgoKZGVmIF9hZHZhcGkzMl9pbnRlcnByZXRfZHNhX2tleV9ibG9iKGJpdF9zaXplLCBwdWJsaWNfYmxvYiwgcHJpdmF0ZV9ibG9iKToKICAgICIiIgogICAgVGFrZXMgYSBDcnlwdG9BUEkgRFNTIHByaXZhdGUga2V5IGJsb2IgYW5kIGNvbnZlcnRzIGl0IGludG8gdGhlIEFTTi4xCiAgICBzdHJ1Y3R1cmVzIGZvciB0aGUgcHVibGljIGFuZCBwcml2YXRlIGtleXMKCiAgICA6cGFyYW0gYml0X3NpemU6CiAgICAgICAgVGhlIGludGVnZXIgYml0IHNpemUgb2YgdGhlIGtleQoKICAgIDpwYXJhbSBwdWJsaWNfYmxvYjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBiaW5hcnkgZGF0YSBhZnRlciB0aGUgcHVibGljIGtleSBoZWFkZXIKCiAgICA6cGFyYW0gcHJpdmF0ZV9ibG9iOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGJpbmFyeSBkYXRhIGFmdGVyIHRoZSBwcml2YXRlIGtleSBoZWFkZXIKCiAgICA6cmV0dXJuOgogICAgICAgIEEgMi1lbGVtZW50IHR1cGxlIG9mIChhc24xY3J5cHRvLmtleXMuUHVibGljS2V5SW5mbywKICAgICAgICBhc24xY3J5cHRvLmtleXMuUHJpdmF0ZUtleUluZm8pCiAgICAiIiIKCiAgICBsZW4xID0gMjAKICAgIGxlbjIgPSBiaXRfc2l6ZSAvLyA4CgogICAgcV9vZmZzZXQgPSBsZW4yCiAgICBnX29mZnNldCA9IHFfb2Zmc2V0ICsgbGVuMQogICAgeF9vZmZzZXQgPSBnX29mZnNldCArIGxlbjIKICAgIHlfb2Zmc2V0ID0geF9vZmZzZXQKCiAgICBwID0gaW50X2Zyb21fYnl0ZXMocHJpdmF0ZV9ibG9iWzA6cV9vZmZzZXRdWzo6LTFdKQogICAgcSA9IGludF9mcm9tX2J5dGVzKHByaXZhdGVfYmxvYltxX29mZnNldDpnX29mZnNldF1bOjotMV0pCiAgICBnID0gaW50X2Zyb21fYnl0ZXMocHJpdmF0ZV9ibG9iW2dfb2Zmc2V0Onhfb2Zmc2V0XVs6Oi0xXSkKICAgIHggPSBpbnRfZnJvbV9ieXRlcyhwcml2YXRlX2Jsb2JbeF9vZmZzZXQ6eF9vZmZzZXQgKyBsZW4xXVs6Oi0xXSkKICAgIHkgPSBpbnRfZnJvbV9ieXRlcyhwdWJsaWNfYmxvYlt5X29mZnNldDp5X29mZnNldCArIGxlbjJdWzo6LTFdKQoKICAgIHB1YmxpY19rZXlfaW5mbyA9IFB1YmxpY0tleUluZm8oewogICAgICAgICdhbGdvcml0aG0nOiBQdWJsaWNLZXlBbGdvcml0aG0oewogICAgICAgICAgICAnYWxnb3JpdGhtJzogJ2RzYScsCiAgICAgICAgICAgICdwYXJhbWV0ZXJzJzogRFNBUGFyYW1zKHsKICAgICAgICAgICAgICAgICdwJzogcCwKICAgICAgICAgICAgICAgICdxJzogcSwKICAgICAgICAgICAgICAgICdnJzogZywKICAgICAgICAgICAgfSkKICAgICAgICB9KSwKICAgICAgICAncHVibGljX2tleSc6IEludGVnZXIoeSksCiAgICB9KQoKICAgIHByaXZhdGVfa2V5X2luZm8gPSBQcml2YXRlS2V5SW5mbyh7CiAgICAgICAgJ3ZlcnNpb24nOiAwLAogICAgICAgICdwcml2YXRlX2tleV9hbGdvcml0aG0nOiBQcml2YXRlS2V5QWxnb3JpdGhtKHsKICAgICAgICAgICAgJ2FsZ29yaXRobSc6ICdkc2EnLAogICAgICAgICAgICAncGFyYW1ldGVycyc6IERTQVBhcmFtcyh7CiAgICAgICAgICAgICAgICAncCc6IHAsCiAgICAgICAgICAgICAgICAncSc6IHEsCiAgICAgICAgICAgICAgICAnZyc6IGcsCiAgICAgICAgICAgIH0pCiAgICAgICAgfSksCiAgICAgICAgJ3ByaXZhdGVfa2V5JzogSW50ZWdlcih4KSwKICAgIH0pCgogICAgcmV0dXJuIChwdWJsaWNfa2V5X2luZm8sIHByaXZhdGVfa2V5X2luZm8pCgoKZGVmIF9iY3J5cHRfaW50ZXJwcmV0X3JzYV9rZXlfYmxvYihrZXlfdHlwZSwgYmxvYl9zdHJ1Y3QsIGJsb2IpOgogICAgIiIiCiAgICBUYWtlIGEgQ05HIEJDUllQVF9SU0FGVUxMUFJJVkFURV9CTE9CIGFuZCBjb252ZXJ0cyBpdCBpbnRvIGFuIEFTTi4xCiAgICBzdHJ1Y3R1cmUKCiAgICA6cGFyYW0ga2V5X3R5cGU6CiAgICAgICAgQSB1bmljb2RlIHN0cmluZyBvZiAicHJpdmF0ZSIgb3IgInB1YmxpYyIKCiAgICA6cGFyYW0gYmxvYl9zdHJ1Y3Q6CiAgICAgICAgQW4gaW5zdGFuY2Ugb2YgQkNSWVBUX1JTQUtFWV9CTE9CCgogICAgOnBhcmFtIGJsb2I6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgYmluYXJ5IGRhdGEgY29udGFpbmVkIGFmdGVyIHRoZSBzdHJ1Y3QKCiAgICA6cmV0dXJuOgogICAgICAgIEFuIGFzbjFjcnlwdG8ua2V5cy5Qcml2YXRlS2V5SW5mbyBvciBhc24xY3J5cHRvLmtleXMuUHVibGljS2V5SW5mbwogICAgICAgIG9iamVjdCwgYmFzZWQgb24gdGhlIGtleV90eXBlIHBhcmFtCiAgICAiIiIKCiAgICBwdWJsaWNfZXhwb25lbnRfYnl0ZV9sZW5ndGggPSBuYXRpdmUoaW50LCBibG9iX3N0cnVjdC5jYlB1YmxpY0V4cCkKICAgIG1vZHVsdXNfYnl0ZV9sZW5ndGggPSBuYXRpdmUoaW50LCBibG9iX3N0cnVjdC5jYk1vZHVsdXMpCgogICAgbW9kdWx1c19vZmZzZXQgPSBwdWJsaWNfZXhwb25lbnRfYnl0ZV9sZW5ndGgKCiAgICBwdWJsaWNfZXhwb25lbnQgPSBpbnRfZnJvbV9ieXRlcyhibG9iWzA6bW9kdWx1c19vZmZzZXRdKQogICAgbW9kdWx1cyA9IGludF9mcm9tX2J5dGVzKGJsb2JbbW9kdWx1c19vZmZzZXQ6bW9kdWx1c19vZmZzZXQgKyBtb2R1bHVzX2J5dGVfbGVuZ3RoXSkKCiAgICBpZiBrZXlfdHlwZSA9PSAncHVibGljJzoKICAgICAgICByZXR1cm4gUHVibGljS2V5SW5mbyh7CiAgICAgICAgICAgICdhbGdvcml0aG0nOiBQdWJsaWNLZXlBbGdvcml0aG0oewogICAgICAgICAgICAgICAgJ2FsZ29yaXRobSc6ICdyc2EnLAogICAgICAgICAgICB9KSwKICAgICAgICAgICAgJ3B1YmxpY19rZXknOiBSU0FQdWJsaWNLZXkoewogICAgICAgICAgICAgICAgJ21vZHVsdXMnOiBtb2R1bHVzLAogICAgICAgICAgICAgICAgJ3B1YmxpY19leHBvbmVudCc6IHB1YmxpY19leHBvbmVudCwKICAgICAgICAgICAgfSksCiAgICAgICAgfSkKCiAgICBlbGlmIGtleV90eXBlID09ICdwcml2YXRlJzoKICAgICAgICBwcmltZTFfYnl0ZV9sZW5ndGggPSBuYXRpdmUoaW50LCBibG9iX3N0cnVjdC5jYlByaW1lMSkKICAgICAgICBwcmltZTJfYnl0ZV9sZW5ndGggPSBuYXRpdmUoaW50LCBibG9iX3N0cnVjdC5jYlByaW1lMikKCiAgICAgICAgcHJpbWUxX29mZnNldCA9IG1vZHVsdXNfb2Zmc2V0ICsgbW9kdWx1c19ieXRlX2xlbmd0aAogICAgICAgIHByaW1lMl9vZmZzZXQgPSBwcmltZTFfb2Zmc2V0ICsgcHJpbWUxX2J5dGVfbGVuZ3RoCiAgICAgICAgZXhwb25lbnQxX29mZnNldCA9IHByaW1lMl9vZmZzZXQgKyBwcmltZTJfYnl0ZV9sZW5ndGgKICAgICAgICBleHBvbmVudDJfb2Zmc2V0ID0gZXhwb25lbnQxX29mZnNldCArIHByaW1lMl9ieXRlX2xlbmd0aAogICAgICAgIGNvZWZmaWNpZW50X29mZnNldCA9IGV4cG9uZW50Ml9vZmZzZXQgKyBwcmltZTJfYnl0ZV9sZW5ndGgKICAgICAgICBwcml2YXRlX2V4cG9uZW50X29mZnNldCA9IGNvZWZmaWNpZW50X29mZnNldCArIHByaW1lMV9ieXRlX2xlbmd0aAoKICAgICAgICBwcmltZTEgPSBpbnRfZnJvbV9ieXRlcyhibG9iW3ByaW1lMV9vZmZzZXQ6cHJpbWUyX29mZnNldF0pCiAgICAgICAgcHJpbWUyID0gaW50X2Zyb21fYnl0ZXMoYmxvYltwcmltZTJfb2Zmc2V0OmV4cG9uZW50MV9vZmZzZXRdKQogICAgICAgIGV4cG9uZW50MSA9IGludF9mcm9tX2J5dGVzKGJsb2JbZXhwb25lbnQxX29mZnNldDpleHBvbmVudDJfb2Zmc2V0XSkKICAgICAgICBleHBvbmVudDIgPSBpbnRfZnJvbV9ieXRlcyhibG9iW2V4cG9uZW50Ml9vZmZzZXQ6Y29lZmZpY2llbnRfb2Zmc2V0XSkKICAgICAgICBjb2VmZmljaWVudCA9IGludF9mcm9tX2J5dGVzKGJsb2JbY29lZmZpY2llbnRfb2Zmc2V0OnByaXZhdGVfZXhwb25lbnRfb2Zmc2V0XSkKICAgICAgICBwcml2YXRlX2V4cG9uZW50ID0gaW50X2Zyb21fYnl0ZXMoYmxvYltwcml2YXRlX2V4cG9uZW50X29mZnNldDpwcml2YXRlX2V4cG9uZW50X29mZnNldCArIG1vZHVsdXNfYnl0ZV9sZW5ndGhdKQoKICAgICAgICByc2FfcHJpdmF0ZV9rZXkgPSBSU0FQcml2YXRlS2V5KHsKICAgICAgICAgICAgJ3ZlcnNpb24nOiAndHdvLXByaW1lJywKICAgICAgICAgICAgJ21vZHVsdXMnOiBtb2R1bHVzLAogICAgICAgICAgICAncHVibGljX2V4cG9uZW50JzogcHVibGljX2V4cG9uZW50LAogICAgICAgICAgICAncHJpdmF0ZV9leHBvbmVudCc6IHByaXZhdGVfZXhwb25lbnQsCiAgICAgICAgICAgICdwcmltZTEnOiBwcmltZTEsCiAgICAgICAgICAgICdwcmltZTInOiBwcmltZTIsCiAgICAgICAgICAgICdleHBvbmVudDEnOiBleHBvbmVudDEsCiAgICAgICAgICAgICdleHBvbmVudDInOiBleHBvbmVudDIsCiAgICAgICAgICAgICdjb2VmZmljaWVudCc6IGNvZWZmaWNpZW50LAogICAgICAgIH0pCgogICAgICAgIHJldHVybiBQcml2YXRlS2V5SW5mbyh7CiAgICAgICAgICAgICd2ZXJzaW9uJzogMCwKICAgICAgICAgICAgJ3ByaXZhdGVfa2V5X2FsZ29yaXRobSc6IFByaXZhdGVLZXlBbGdvcml0aG0oewogICAgICAgICAgICAgICAgJ2FsZ29yaXRobSc6ICdyc2EnLAogICAgICAgICAgICB9KSwKICAgICAgICAgICAgJ3ByaXZhdGVfa2V5JzogcnNhX3ByaXZhdGVfa2V5LAogICAgICAgIH0pCgogICAgZWxzZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAga2V5X3R5cGUgbXVzdCBiZSBvbmUgb2YgInB1YmxpYyIsICJwcml2YXRlIiwgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgcmVwcihrZXlfdHlwZSkKICAgICAgICApKQoKCmRlZiBfYmNyeXB0X2ludGVycHJldF9kc2Ffa2V5X2Jsb2Ioa2V5X3R5cGUsIHZlcnNpb24sIGJsb2Jfc3RydWN0LCBibG9iKToKICAgICIiIgogICAgVGFrZSBhIENORyBCQ1JZUFRfRFNBX0tFWV9CTE9CIG9yIEJDUllQVF9EU0FfS0VZX0JMT0JfVjIgYW5kIGNvbnZlcnRzIGl0CiAgICBpbnRvIGFuIEFTTi4xIHN0cnVjdHVyZQoKICAgIDpwYXJhbSBrZXlfdHlwZToKICAgICAgICBBIHVuaWNvZGUgc3RyaW5nIG9mICJwcml2YXRlIiBvciAicHVibGljIgoKICAgIDpwYXJhbSB2ZXJzaW9uOgogICAgICAgIEFuIGludGVnZXIgLSAxIG9yIDIsIGluZGljYXRpbmcgdGhlIGJsb2IgaXMgQkNSWVBUX0RTQV9LRVlfQkxPQiBvcgogICAgICAgIEJDUllQVF9EU0FfS0VZX0JMT0JfVjIKCiAgICA6cGFyYW0gYmxvYl9zdHJ1Y3Q6CiAgICAgICAgQW4gaW5zdGFuY2Ugb2YgQkNSWVBUX0RTQV9LRVlfQkxPQiBvciBCQ1JZUFRfRFNBX0tFWV9CTE9CX1YyCgogICAgOnBhcmFtIGJsb2I6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgYmluYXJ5IGRhdGEgY29udGFpbmVkIGFmdGVyIHRoZSBzdHJ1Y3QKCiAgICA6cmV0dXJuOgogICAgICAgIEFuIGFzbjFjcnlwdG8ua2V5cy5Qcml2YXRlS2V5SW5mbyBvciBhc24xY3J5cHRvLmtleXMuUHVibGljS2V5SW5mbwogICAgICAgIG9iamVjdCwgYmFzZWQgb24gdGhlIGtleV90eXBlIHBhcmFtCiAgICAiIiIKCiAgICBrZXlfYnl0ZV9sZW5ndGggPSBuYXRpdmUoaW50LCBibG9iX3N0cnVjdC5jYktleSkKCiAgICBpZiB2ZXJzaW9uID09IDE6CiAgICAgICAgcSA9IGludF9mcm9tX2J5dGVzKG5hdGl2ZShieXRlX2NscywgYmxvYl9zdHJ1Y3QucSkpCgogICAgICAgIGdfb2Zmc2V0ID0ga2V5X2J5dGVfbGVuZ3RoCiAgICAgICAgcHVibGljX29mZnNldCA9IGdfb2Zmc2V0ICsga2V5X2J5dGVfbGVuZ3RoCiAgICAgICAgcHJpdmF0ZV9vZmZzZXQgPSBwdWJsaWNfb2Zmc2V0ICsga2V5X2J5dGVfbGVuZ3RoCgogICAgICAgIHAgPSBpbnRfZnJvbV9ieXRlcyhibG9iWzA6Z19vZmZzZXRdKQogICAgICAgIGcgPSBpbnRfZnJvbV9ieXRlcyhibG9iW2dfb2Zmc2V0OnB1YmxpY19vZmZzZXRdKQoKICAgIGVsaWYgdmVyc2lvbiA9PSAyOgogICAgICAgIHNlZWRfYnl0ZV9sZW5ndGggPSBuYXRpdmUoaW50LCBibG9iX3N0cnVjdC5jYlNlZWRMZW5ndGgpCiAgICAgICAgZ3JvdXBfYnl0ZV9sZW5ndGggPSBuYXRpdmUoaW50LCBibG9iX3N0cnVjdC5jYkdyb3VwU2l6ZSkKCiAgICAgICAgcV9vZmZzZXQgPSBzZWVkX2J5dGVfbGVuZ3RoCiAgICAgICAgcF9vZmZzZXQgPSBxX29mZnNldCArIGdyb3VwX2J5dGVfbGVuZ3RoCiAgICAgICAgZ19vZmZzZXQgPSBwX29mZnNldCArIGtleV9ieXRlX2xlbmd0aAogICAgICAgIHB1YmxpY19vZmZzZXQgPSBnX29mZnNldCArIGtleV9ieXRlX2xlbmd0aAogICAgICAgIHByaXZhdGVfb2Zmc2V0ID0gcHVibGljX29mZnNldCArIGtleV9ieXRlX2xlbmd0aAoKICAgICAgICAjIFRoZSBzZWVkIGlzIHNraXBwZWQgc2luY2UgaXQgaXMgbm90IHBhcnQgb2YgdGhlIEFTTi4xIHN0cnVjdHVyZQogICAgICAgIHEgPSBpbnRfZnJvbV9ieXRlcyhibG9iW3Ffb2Zmc2V0OnBfb2Zmc2V0XSkKICAgICAgICBwID0gaW50X2Zyb21fYnl0ZXMoYmxvYltwX29mZnNldDpnX29mZnNldF0pCiAgICAgICAgZyA9IGludF9mcm9tX2J5dGVzKGJsb2JbZ19vZmZzZXQ6cHVibGljX29mZnNldF0pCgogICAgZWxzZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCd2ZXJzaW9uIG11c3QgYmUgMSBvciAyLCBub3QgJXMnICUgcmVwcih2ZXJzaW9uKSkKCiAgICBpZiBrZXlfdHlwZSA9PSAncHVibGljJzoKICAgICAgICBwdWJsaWMgPSBpbnRfZnJvbV9ieXRlcyhibG9iW3B1YmxpY19vZmZzZXQ6cHJpdmF0ZV9vZmZzZXRdKQogICAgICAgIHJldHVybiBQdWJsaWNLZXlJbmZvKHsKICAgICAgICAgICAgJ2FsZ29yaXRobSc6IFB1YmxpY0tleUFsZ29yaXRobSh7CiAgICAgICAgICAgICAgICAnYWxnb3JpdGhtJzogJ2RzYScsCiAgICAgICAgICAgICAgICAncGFyYW1ldGVycyc6IERTQVBhcmFtcyh7CiAgICAgICAgICAgICAgICAgICAgJ3AnOiBwLAogICAgICAgICAgICAgICAgICAgICdxJzogcSwKICAgICAgICAgICAgICAgICAgICAnZyc6IGcsCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgJ3B1YmxpY19rZXknOiBJbnRlZ2VyKHB1YmxpYyksCiAgICAgICAgfSkKCiAgICBlbGlmIGtleV90eXBlID09ICdwcml2YXRlJzoKICAgICAgICBwcml2YXRlID0gaW50X2Zyb21fYnl0ZXMoYmxvYltwcml2YXRlX29mZnNldDpwcml2YXRlX29mZnNldCArIGtleV9ieXRlX2xlbmd0aF0pCiAgICAgICAgcmV0dXJuIFByaXZhdGVLZXlJbmZvKHsKICAgICAgICAgICAgJ3ZlcnNpb24nOiAwLAogICAgICAgICAgICAncHJpdmF0ZV9rZXlfYWxnb3JpdGhtJzogUHJpdmF0ZUtleUFsZ29yaXRobSh7CiAgICAgICAgICAgICAgICAnYWxnb3JpdGhtJzogJ2RzYScsCiAgICAgICAgICAgICAgICAncGFyYW1ldGVycyc6IERTQVBhcmFtcyh7CiAgICAgICAgICAgICAgICAgICAgJ3AnOiBwLAogICAgICAgICAgICAgICAgICAgICdxJzogcSwKICAgICAgICAgICAgICAgICAgICAnZyc6IGcsCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgJ3ByaXZhdGVfa2V5JzogSW50ZWdlcihwcml2YXRlKSwKICAgICAgICB9KQoKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGtleV90eXBlIG11c3QgYmUgb25lIG9mICJwdWJsaWMiLCAicHJpdmF0ZSIsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHJlcHIoa2V5X3R5cGUpCiAgICAgICAgKSkKCgpkZWYgX2JjcnlwdF9pbnRlcnByZXRfZWNfa2V5X2Jsb2Ioa2V5X3R5cGUsIGJsb2Jfc3RydWN0LCBibG9iKToKICAgICIiIgogICAgVGFrZSBhIENORyBCQ1JZUFRfRUNDS0VZX0JMT0IgYW5kIGNvbnZlcnRzIGl0IGludG8gYW4gQVNOLjEgc3RydWN0dXJlCgogICAgOnBhcmFtIGtleV90eXBlOgogICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgInByaXZhdGUiIG9yICJwdWJsaWMiCgogICAgOnBhcmFtIGJsb2Jfc3RydWN0OgogICAgICAgIEFuIGluc3RhbmNlIG9mIEJDUllQVF9FQ0NLRVlfQkxPQgoKICAgIDpwYXJhbSBibG9iOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGJpbmFyeSBkYXRhIGNvbnRhaW5lZCBhZnRlciB0aGUgc3RydWN0CgogICAgOnJldHVybjoKICAgICAgICBBbiBhc24xY3J5cHRvLmtleXMuUHJpdmF0ZUtleUluZm8gb3IgYXNuMWNyeXB0by5rZXlzLlB1YmxpY0tleUluZm8KICAgICAgICBvYmplY3QsIGJhc2VkIG9uIHRoZSBrZXlfdHlwZSBwYXJhbQogICAgIiIiCgogICAgbWFnaWMgPSBuYXRpdmUoaW50LCBibG9iX3N0cnVjdC5kd01hZ2ljKQogICAga2V5X2J5dGVfbGVuZ3RoID0gbmF0aXZlKGludCwgYmxvYl9zdHJ1Y3QuY2JLZXkpCgogICAgY3VydmUgPSB7CiAgICAgICAgQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1BSSVZBVEVfUDI1Nl9NQUdJQzogJ3NlY3AyNTZyMScsCiAgICAgICAgQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1BSSVZBVEVfUDM4NF9NQUdJQzogJ3NlY3AzODRyMScsCiAgICAgICAgQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1BSSVZBVEVfUDUyMV9NQUdJQzogJ3NlY3A1MjFyMScsCiAgICAgICAgQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1BVQkxJQ19QMjU2X01BR0lDOiAnc2VjcDI1NnIxJywKICAgICAgICBCY3J5cHRDb25zdC5CQ1JZUFRfRUNEU0FfUFVCTElDX1AzODRfTUFHSUM6ICdzZWNwMzg0cjEnLAogICAgICAgIEJjcnlwdENvbnN0LkJDUllQVF9FQ0RTQV9QVUJMSUNfUDUyMV9NQUdJQzogJ3NlY3A1MjFyMScsCiAgICB9W21hZ2ljXQoKICAgIHB1YmxpYyA9IGInXHgwNCcgKyBibG9iWzA6a2V5X2J5dGVfbGVuZ3RoICogMl0KCiAgICBpZiBrZXlfdHlwZSA9PSAncHVibGljJzoKICAgICAgICByZXR1cm4gUHVibGljS2V5SW5mbyh7CiAgICAgICAgICAgICdhbGdvcml0aG0nOiBQdWJsaWNLZXlBbGdvcml0aG0oewogICAgICAgICAgICAgICAgJ2FsZ29yaXRobSc6ICdlYycsCiAgICAgICAgICAgICAgICAncGFyYW1ldGVycyc6IEVDRG9tYWluUGFyYW1ldGVycygKICAgICAgICAgICAgICAgICAgICBuYW1lPSduYW1lZCcsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU9Y3VydmUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgfSksCiAgICAgICAgICAgICdwdWJsaWNfa2V5JzogcHVibGljLAogICAgICAgIH0pCgogICAgZWxpZiBrZXlfdHlwZSA9PSAncHJpdmF0ZSc6CiAgICAgICAgcHJpdmF0ZSA9IGludF9mcm9tX2J5dGVzKGJsb2Jba2V5X2J5dGVfbGVuZ3RoICogMjprZXlfYnl0ZV9sZW5ndGggKiAzXSkKICAgICAgICByZXR1cm4gUHJpdmF0ZUtleUluZm8oewogICAgICAgICAgICAndmVyc2lvbic6IDAsCiAgICAgICAgICAgICdwcml2YXRlX2tleV9hbGdvcml0aG0nOiBQcml2YXRlS2V5QWxnb3JpdGhtKHsKICAgICAgICAgICAgICAgICdhbGdvcml0aG0nOiAnZWMnLAogICAgICAgICAgICAgICAgJ3BhcmFtZXRlcnMnOiBFQ0RvbWFpblBhcmFtZXRlcnMoCiAgICAgICAgICAgICAgICAgICAgbmFtZT0nbmFtZWQnLAogICAgICAgICAgICAgICAgICAgIHZhbHVlPWN1cnZlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAncHJpdmF0ZV9rZXknOiBFQ1ByaXZhdGVLZXkoewogICAgICAgICAgICAgICAgJ3ZlcnNpb24nOiAnZWNQcml2a2V5VmVyMScsCiAgICAgICAgICAgICAgICAncHJpdmF0ZV9rZXknOiBwcml2YXRlLAogICAgICAgICAgICAgICAgJ3B1YmxpY19rZXknOiBwdWJsaWMsCiAgICAgICAgICAgIH0pLAogICAgICAgIH0pCgogICAgZWxzZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAga2V5X3R5cGUgbXVzdCBiZSBvbmUgb2YgInB1YmxpYyIsICJwcml2YXRlIiwgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgcmVwcihrZXlfdHlwZSkKICAgICAgICApKQoKCmRlZiBsb2FkX2NlcnRpZmljYXRlKHNvdXJjZSk6CiAgICAiIiIKICAgIExvYWRzIGFuIHg1MDkgY2VydGlmaWNhdGUgaW50byBhIENlcnRpZmljYXRlIG9iamVjdAoKICAgIDpwYXJhbSBzb3VyY2U6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiBmaWxlIGNvbnRlbnRzIG9yIGEgdW5pY29kZSBzdHJpbmcgZmlsZW5hbWUKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKCiAgICA6cmV0dXJuOgogICAgICAgIEEgQ2VydGlmaWNhdGUgb2JqZWN0CiAgICAiIiIKCiAgICBpZiBpc2luc3RhbmNlKHNvdXJjZSwgQXNuMUNlcnRpZmljYXRlKToKICAgICAgICBjZXJ0aWZpY2F0ZSA9IHNvdXJjZQoKICAgIGVsaWYgaXNpbnN0YW5jZShzb3VyY2UsIGJ5dGVfY2xzKToKICAgICAgICBjZXJ0aWZpY2F0ZSA9IHBhcnNlX2NlcnRpZmljYXRlKHNvdXJjZSkKCiAgICBlbGlmIGlzaW5zdGFuY2Uoc291cmNlLCBzdHJfY2xzKToKICAgICAgICB3aXRoIG9wZW4oc291cmNlLCAncmInKSBhcyBmOgogICAgICAgICAgICBjZXJ0aWZpY2F0ZSA9IHBhcnNlX2NlcnRpZmljYXRlKGYucmVhZCgpKQoKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgc291cmNlIG11c3QgYmUgYSBieXRlIHN0cmluZywgdW5pY29kZSBzdHJpbmcgb3IKICAgICAgICAgICAgYXNuMWNyeXB0by54NTA5LkNlcnRpZmljYXRlIG9iamVjdCwgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKHNvdXJjZSkKICAgICAgICApKQoKICAgIHJldHVybiBfbG9hZF9rZXkoY2VydGlmaWNhdGUsIENlcnRpZmljYXRlKQoKCmRlZiBfbG9hZF9rZXkoa2V5X29iamVjdCwgY29udGFpbmVyKToKICAgICIiIgogICAgTG9hZHMgYSBjZXJ0aWZpY2F0ZSwgcHVibGljIGtleSBvciBwcml2YXRlIGtleSBpbnRvIGEgQ2VydGlmaWNhdGUsCiAgICBQdWJsaWNLZXkgb3IgUHJpdmF0ZUtleSBvYmplY3QKCiAgICA6cGFyYW0ga2V5X29iamVjdDoKICAgICAgICBBbiBhc24xY3J5cHRvLng1MDkuQ2VydGlmaWNhdGUsIGFzbjFjcnlwdG8ua2V5cy5QdWJsaWNLZXlJbmZvIG9yCiAgICAgICAgYXNuMWNyeXB0by5rZXlzLlByaXZhdGVLZXlJbmZvIG9iamVjdAoKICAgIDpwYXJhbSBjb250YWluZXI6CiAgICAgICAgVGhlIGNsYXNzIG9mIHRoZSBvYmplY3QgdG8gaG9sZCB0aGUga2V5X2hhbmRsZQoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIG9zY3J5cHRvLmVycm9ycy5Bc3ltbWV0cmljS2V5RXJyb3IgLSB3aGVuIHRoZSBrZXkgaXMgaW5jb21wYXRpYmxlIHdpdGggdGhlIE9TIGNyeXB0byBsaWJyYXJ5CiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIFByaXZhdGVLZXksIFB1YmxpY0tleSBvciBDZXJ0aWZpY2F0ZSBvYmplY3QsIGJhc2VkIG9uIGNvbnRhaW5lcgogICAgIiIiCgogICAga2V5X2luZm8gPSBrZXlfb2JqZWN0CiAgICBpZiBpc2luc3RhbmNlKGtleV9vYmplY3QsIEFzbjFDZXJ0aWZpY2F0ZSk6CiAgICAgICAga2V5X2luZm8gPSBrZXlfb2JqZWN0Wyd0YnNfY2VydGlmaWNhdGUnXVsnc3ViamVjdF9wdWJsaWNfa2V5X2luZm8nXQoKICAgIGFsZ28gPSBrZXlfaW5mby5hbGdvcml0aG0KICAgIGN1cnZlX25hbWUgPSBOb25lCgogICAgaWYgYWxnbyA9PSAnZWMnOgogICAgICAgIGN1cnZlX3R5cGUsIGN1cnZlX25hbWUgPSBrZXlfaW5mby5jdXJ2ZQogICAgICAgIGlmIGN1cnZlX3R5cGUgIT0gJ25hbWVkJzoKICAgICAgICAgICAgcmFpc2UgQXN5bW1ldHJpY0tleUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBXaW5kb3dzIG9ubHkgc3VwcG9ydHMgRUMga2V5cyB1c2luZyBuYW1lZCBjdXJ2ZXMKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICApKQogICAgICAgIGlmIGN1cnZlX25hbWUgbm90IGluIHNldChbJ3NlY3AyNTZyMScsICdzZWNwMzg0cjEnLCAnc2VjcDUyMXIxJ10pOgogICAgICAgICAgICByYWlzZSBBc3ltbWV0cmljS2V5RXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIFdpbmRvd3Mgb25seSBzdXBwb3J0cyBFQyBrZXlzIHVzaW5nIHRoZSBuYW1lZCBjdXJ2ZXMKICAgICAgICAgICAgICAgIHNlY3AyNTZyMSwgc2VjcDM4NHIxIGFuZCBzZWNwNTIxcjEKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICApKQoKICAgIGVsaWYgYWxnbyA9PSAnZHNhJzoKICAgICAgICBpZiBrZXlfaW5mby5oYXNoX2FsZ28gaXMgTm9uZToKICAgICAgICAgICAgcmFpc2UgSW5jb21wbGV0ZUFzeW1tZXRyaWNLZXlFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICAgICAgVGhlIERTQSBrZXkgZG9lcyBub3QgY29udGFpbiB0aGUgbmVjZXNzYXJ5IHAsIHEgYW5kIGcKICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMgYW5kIGNhbiBub3QgYmUgdXNlZAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICkpCiAgICAgICAgZWxpZiBrZXlfaW5mby5iaXRfc2l6ZSA+IDEwMjQgYW5kIChfd2luX3ZlcnNpb25faW5mbyA8ICg2LCAyKSBvciBfYmFja2VuZCA9PSAnd2lubGVnYWN5Jyk6CiAgICAgICAgICAgIHJhaXNlIEFzeW1tZXRyaWNLZXlFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICAgICAgV2luZG93cyBYUCwgMjAwMywgVmlzdGEsIDcgYW5kIFNlcnZlciAyMDA4IG9ubHkgc3VwcG9ydCBEU0EKICAgICAgICAgICAgICAgIGtleXMgYmFzZWQgb24gU0hBMSAoMTAyNCBiaXRzIG9yIGxlc3MpIC0gdGhpcyBrZXkgaXMgYmFzZWQKICAgICAgICAgICAgICAgIG9uICVzIGFuZCBpcyAlcyBiaXRzCiAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICBrZXlfaW5mby5oYXNoX2FsZ28udXBwZXIoKSwKICAgICAgICAgICAgICAgIGtleV9pbmZvLmJpdF9zaXplCiAgICAgICAgICAgICkpCiAgICAgICAgZWxpZiBrZXlfaW5mby5iaXRfc2l6ZSA9PSAyMDQ4IGFuZCBrZXlfaW5mby5oYXNoX2FsZ28gPT0gJ3NoYTEnOgogICAgICAgICAgICByYWlzZSBBc3ltbWV0cmljS2V5RXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIFdpbmRvd3Mgb25seSBzdXBwb3J0cyAyMDQ4IGJpdCBEU0Ega2V5cyBiYXNlZCBvbiBTSEEyIC0gdGhpcwogICAgICAgICAgICAgICAga2V5IGlzIDIwNDggYml0cyBhbmQgYmFzZWQgb24gU0hBMSwgYSBub24tc3RhbmRhcmQKICAgICAgICAgICAgICAgIGNvbWJpbmF0aW9uIHRoYXQgaXMgdXN1YWxseSBnZW5lcmF0ZWQgYnkgb2xkIHZlcnNpb25zCiAgICAgICAgICAgICAgICBvZiBPcGVuU1NMCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgKSkKCiAgICBpZiBfYmFja2VuZCA9PSAnd2lubGVnYWN5JzoKICAgICAgICBpZiBhbGdvID09ICdlYyc6CiAgICAgICAgICAgIHJldHVybiBjb250YWluZXIoTm9uZSwga2V5X29iamVjdCkKICAgICAgICByZXR1cm4gX2FkdmFwaTMyX2xvYWRfa2V5KGtleV9vYmplY3QsIGtleV9pbmZvLCBjb250YWluZXIpCiAgICByZXR1cm4gX2JjcnlwdF9sb2FkX2tleShrZXlfb2JqZWN0LCBrZXlfaW5mbywgY29udGFpbmVyLCBjdXJ2ZV9uYW1lKQoKCmRlZiBfYWR2YXBpMzJfbG9hZF9rZXkoa2V5X29iamVjdCwga2V5X2luZm8sIGNvbnRhaW5lcik6CiAgICAiIiIKICAgIExvYWRzIGEgY2VydGlmaWNhdGUsIHB1YmxpYyBrZXkgb3IgcHJpdmF0ZSBrZXkgaW50byBhIENlcnRpZmljYXRlLAogICAgUHVibGljS2V5IG9yIFByaXZhdGVLZXkgb2JqZWN0IHZpYSBDcnlwdG9BUEkKCiAgICA6cGFyYW0ga2V5X29iamVjdDoKICAgICAgICBBbiBhc24xY3J5cHRvLng1MDkuQ2VydGlmaWNhdGUsIGFzbjFjcnlwdG8ua2V5cy5QdWJsaWNLZXlJbmZvIG9yCiAgICAgICAgYXNuMWNyeXB0by5rZXlzLlByaXZhdGVLZXlJbmZvIG9iamVjdAoKICAgIDpwYXJhbSBrZXlfaW5mbzoKICAgICAgICBBbiBhc24xY3J5cHRvLmtleXMuUHVibGljS2V5SW5mbyBvciBhc24xY3J5cHRvLmtleXMuUHJpdmF0ZUtleUluZm8KICAgICAgICBvYmplY3QKCiAgICA6cGFyYW0gY29udGFpbmVyOgogICAgICAgIFRoZSBjbGFzcyBvZiB0aGUgb2JqZWN0IHRvIGhvbGQgdGhlIGtleV9oYW5kbGUKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBvc2NyeXB0by5lcnJvcnMuQXN5bW1ldHJpY0tleUVycm9yIC0gd2hlbiB0aGUga2V5IGlzIGluY29tcGF0aWJsZSB3aXRoIHRoZSBPUyBjcnlwdG8gbGlicmFyeQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBQcml2YXRlS2V5LCBQdWJsaWNLZXkgb3IgQ2VydGlmaWNhdGUgb2JqZWN0LCBiYXNlZCBvbiBjb250YWluZXIKICAgICIiIgoKICAgIGtleV90eXBlID0gJ3B1YmxpYycgaWYgaXNpbnN0YW5jZShrZXlfaW5mbywgUHVibGljS2V5SW5mbykgZWxzZSAncHJpdmF0ZScKICAgIGFsZ28gPSBrZXlfaW5mby5hbGdvcml0aG0KICAgIGlmIGFsZ28gPT0gJ3JzYXNzYV9wc3MnOgogICAgICAgIGFsZ28gPSAncnNhJwoKICAgIGlmIGFsZ28gPT0gJ3JzYScgb3IgYWxnbyA9PSAncnNhc3NhX3Bzcyc6CiAgICAgICAgcHJvdmlkZXIgPSBBZHZhcGkzMkNvbnN0Lk1TX0VOSF9SU0FfQUVTX1BST1YKICAgIGVsc2U6CiAgICAgICAgcHJvdmlkZXIgPSBBZHZhcGkzMkNvbnN0Lk1TX0VOSF9EU1NfREhfUFJPVgoKICAgIGNvbnRleHRfaGFuZGxlID0gTm9uZQogICAga2V5X2hhbmRsZSA9IE5vbmUKCiAgICB0cnk6CiAgICAgICAgY29udGV4dF9oYW5kbGUgPSBvcGVuX2NvbnRleHRfaGFuZGxlKHByb3ZpZGVyLCB2ZXJpZnlfb25seT1rZXlfdHlwZSA9PSAncHVibGljJykKCiAgICAgICAgYmxvYiA9IF9hZHZhcGkzMl9jcmVhdGVfYmxvYihrZXlfaW5mbywga2V5X3R5cGUsIGFsZ28pCiAgICAgICAgYnVmZmVyXyA9IGJ1ZmZlcl9mcm9tX2J5dGVzKGJsb2IpCgogICAgICAgIGtleV9oYW5kbGVfcG9pbnRlciA9IG5ldyhhZHZhcGkzMiwgJ0hDUllQVEtFWSAqJykKICAgICAgICByZXMgPSBhZHZhcGkzMi5DcnlwdEltcG9ydEtleSgKICAgICAgICAgICAgY29udGV4dF9oYW5kbGUsCiAgICAgICAgICAgIGJ1ZmZlcl8sCiAgICAgICAgICAgIGxlbihibG9iKSwKICAgICAgICAgICAgbnVsbCgpLAogICAgICAgICAgICAwLAogICAgICAgICAgICBrZXlfaGFuZGxlX3BvaW50ZXIKICAgICAgICApCiAgICAgICAgaGFuZGxlX2Vycm9yKHJlcykKCiAgICAgICAga2V5X2hhbmRsZSA9IHVud3JhcChrZXlfaGFuZGxlX3BvaW50ZXIpCiAgICAgICAgb3V0cHV0ID0gY29udGFpbmVyKGtleV9oYW5kbGUsIGtleV9vYmplY3QpCiAgICAgICAgb3V0cHV0LmNvbnRleHRfaGFuZGxlID0gY29udGV4dF9oYW5kbGUKCiAgICAgICAgaWYgYWxnbyA9PSAncnNhJzoKICAgICAgICAgICAgZXhfYmxvYiA9IF9hZHZhcGkzMl9jcmVhdGVfYmxvYihrZXlfaW5mbywga2V5X3R5cGUsIGFsZ28sIHNpZ25pbmc9RmFsc2UpCiAgICAgICAgICAgIGV4X2J1ZmZlciA9IGJ1ZmZlcl9mcm9tX2J5dGVzKGV4X2Jsb2IpCgogICAgICAgICAgICBleF9rZXlfaGFuZGxlX3BvaW50ZXIgPSBuZXcoYWR2YXBpMzIsICdIQ1JZUFRLRVkgKicpCiAgICAgICAgICAgIHJlcyA9IGFkdmFwaTMyLkNyeXB0SW1wb3J0S2V5KAogICAgICAgICAgICAgICAgY29udGV4dF9oYW5kbGUsCiAgICAgICAgICAgICAgICBleF9idWZmZXIsCiAgICAgICAgICAgICAgICBsZW4oZXhfYmxvYiksCiAgICAgICAgICAgICAgICBudWxsKCksCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgZXhfa2V5X2hhbmRsZV9wb2ludGVyCiAgICAgICAgICAgICkKICAgICAgICAgICAgaGFuZGxlX2Vycm9yKHJlcykKCiAgICAgICAgICAgIG91dHB1dC5leF9rZXlfaGFuZGxlID0gdW53cmFwKGV4X2tleV9oYW5kbGVfcG9pbnRlcikKCiAgICAgICAgcmV0dXJuIG91dHB1dAoKICAgIGV4Y2VwdCAoRXhjZXB0aW9uKToKICAgICAgICBpZiBrZXlfaGFuZGxlOgogICAgICAgICAgICBhZHZhcGkzMi5DcnlwdERlc3Ryb3lLZXkoa2V5X2hhbmRsZSkKICAgICAgICBpZiBjb250ZXh0X2hhbmRsZToKICAgICAgICAgICAgY2xvc2VfY29udGV4dF9oYW5kbGUoY29udGV4dF9oYW5kbGUpCiAgICAgICAgcmFpc2UKCgpkZWYgX2FkdmFwaTMyX2NyZWF0ZV9ibG9iKGtleV9pbmZvLCBrZXlfdHlwZSwgYWxnbywgc2lnbmluZz1UcnVlKToKICAgICIiIgogICAgR2VuZXJhdGVzIGEgYmxvYiBmb3IgaW1wb3J0aW5nIGEga2V5IHRvIENyeXB0b0FQSQoKICAgIDpwYXJhbSBrZXlfaW5mbzoKICAgICAgICBBbiBhc24xY3J5cHRvLmtleXMuUHVibGljS2V5SW5mbyBvciBhc24xY3J5cHRvLmtleXMuUHJpdmF0ZUtleUluZm8KICAgICAgICBvYmplY3QKCiAgICA6cGFyYW0ga2V5X3R5cGU6CiAgICAgICAgQSB1bmljb2RlIHN0cmluZyBvZiAicHVibGljIiBvciAicHJpdmF0ZSIKCiAgICA6cGFyYW0gYWxnbzoKICAgICAgICBBIHVuaWNvZGUgc3RyaW5nIG9mICJyc2EiIG9yICJkc2EiCgogICAgOnBhcmFtIHNpZ25pbmc6CiAgICAgICAgSWYgdGhlIGtleSBoYW5kbGUgaXMgZm9yIHNpZ25pbmcgLSBtYXkgb25seSBiZSBGYWxzZSBmb3IgcnNhIGtleXMKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgYSBibG9iIHRvIHBhc3MgdG8gYWR2YXBpMzIuQ3J5cHRJbXBvcnRLZXkoKQogICAgIiIiCgogICAgaWYga2V5X3R5cGUgPT0gJ3B1YmxpYyc6CiAgICAgICAgYmxvYl90eXBlID0gQWR2YXBpMzJDb25zdC5QVUJMSUNLRVlCTE9CCiAgICBlbHNlOgogICAgICAgIGJsb2JfdHlwZSA9IEFkdmFwaTMyQ29uc3QuUFJJVkFURUtFWUJMT0IKCiAgICBpZiBhbGdvID09ICdyc2EnOgogICAgICAgIHN0cnVjdF90eXBlID0gJ1JTQUJMT0JIRUFERVInCiAgICAgICAgaWYgc2lnbmluZzoKICAgICAgICAgICAgYWxnb3JpdGhtX2lkID0gQWR2YXBpMzJDb25zdC5DQUxHX1JTQV9TSUdOCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWxnb3JpdGhtX2lkID0gQWR2YXBpMzJDb25zdC5DQUxHX1JTQV9LRVlYCiAgICBlbHNlOgogICAgICAgIHN0cnVjdF90eXBlID0gJ0RTU0JMT0JIRUFERVInCiAgICAgICAgYWxnb3JpdGhtX2lkID0gQWR2YXBpMzJDb25zdC5DQUxHX0RTU19TSUdOCgogICAgYmxvYl9oZWFkZXJfcG9pbnRlciA9IHN0cnVjdChhZHZhcGkzMiwgJ0JMT0JIRUFERVInKQogICAgYmxvYl9oZWFkZXIgPSB1bndyYXAoYmxvYl9oZWFkZXJfcG9pbnRlcikKICAgIGJsb2JfaGVhZGVyLmJUeXBlID0gYmxvYl90eXBlCiAgICBibG9iX2hlYWRlci5iVmVyc2lvbiA9IEFkdmFwaTMyQ29uc3QuQ1VSX0JMT0JfVkVSU0lPTgogICAgYmxvYl9oZWFkZXIucmVzZXJ2ZWQgPSAwCiAgICBibG9iX2hlYWRlci5haUtleUFsZyA9IGFsZ29yaXRobV9pZAoKICAgIGJsb2Jfc3RydWN0X3BvaW50ZXIgPSBzdHJ1Y3QoYWR2YXBpMzIsIHN0cnVjdF90eXBlKQogICAgYmxvYl9zdHJ1Y3QgPSB1bndyYXAoYmxvYl9zdHJ1Y3RfcG9pbnRlcikKICAgIGJsb2Jfc3RydWN0LnB1YmxpY2tleXN0cnVjID0gYmxvYl9oZWFkZXIKCiAgICBiaXRfc2l6ZSA9IGtleV9pbmZvLmJpdF9zaXplCiAgICBsZW4xID0gYml0X3NpemUgLy8gOAogICAgbGVuMiA9IGJpdF9zaXplIC8vIDE2CgogICAgaWYgYWxnbyA9PSAncnNhJzoKICAgICAgICBwdWJrZXlfcG9pbnRlciA9IHN0cnVjdChhZHZhcGkzMiwgJ1JTQVBVQktFWScpCiAgICAgICAgcHVia2V5ID0gdW53cmFwKHB1YmtleV9wb2ludGVyKQogICAgICAgIHB1YmtleS5iaXRsZW4gPSBiaXRfc2l6ZQogICAgICAgIGlmIGtleV90eXBlID09ICdwdWJsaWMnOgogICAgICAgICAgICBwYXJzZWRfa2V5X2luZm8gPSBrZXlfaW5mb1sncHVibGljX2tleSddLnBhcnNlZAogICAgICAgICAgICBwdWJrZXkubWFnaWMgPSBBZHZhcGkzMkNvbnN0LlJTQTEKICAgICAgICAgICAgcHVia2V5LnB1YmV4cCA9IHBhcnNlZF9rZXlfaW5mb1sncHVibGljX2V4cG9uZW50J10ubmF0aXZlCiAgICAgICAgICAgIGJsb2JfZGF0YSA9IGludF90b19ieXRlcyhwYXJzZWRfa2V5X2luZm9bJ21vZHVsdXMnXS5uYXRpdmUsIHNpZ25lZD1GYWxzZSwgd2lkdGg9bGVuMSlbOjotMV0KICAgICAgICBlbHNlOgogICAgICAgICAgICBwYXJzZWRfa2V5X2luZm8gPSBrZXlfaW5mb1sncHJpdmF0ZV9rZXknXS5wYXJzZWQKICAgICAgICAgICAgcHVia2V5Lm1hZ2ljID0gQWR2YXBpMzJDb25zdC5SU0EyCiAgICAgICAgICAgIHB1YmtleS5wdWJleHAgPSBwYXJzZWRfa2V5X2luZm9bJ3B1YmxpY19leHBvbmVudCddLm5hdGl2ZQogICAgICAgICAgICBibG9iX2RhdGEgPSBpbnRfdG9fYnl0ZXMocGFyc2VkX2tleV9pbmZvWydtb2R1bHVzJ10ubmF0aXZlLCBzaWduZWQ9RmFsc2UsIHdpZHRoPWxlbjEpWzo6LTFdCiAgICAgICAgICAgIGJsb2JfZGF0YSArPSBpbnRfdG9fYnl0ZXMocGFyc2VkX2tleV9pbmZvWydwcmltZTEnXS5uYXRpdmUsIHNpZ25lZD1GYWxzZSwgd2lkdGg9bGVuMilbOjotMV0KICAgICAgICAgICAgYmxvYl9kYXRhICs9IGludF90b19ieXRlcyhwYXJzZWRfa2V5X2luZm9bJ3ByaW1lMiddLm5hdGl2ZSwgc2lnbmVkPUZhbHNlLCB3aWR0aD1sZW4yKVs6Oi0xXQogICAgICAgICAgICBibG9iX2RhdGEgKz0gaW50X3RvX2J5dGVzKHBhcnNlZF9rZXlfaW5mb1snZXhwb25lbnQxJ10ubmF0aXZlLCBzaWduZWQ9RmFsc2UsIHdpZHRoPWxlbjIpWzo6LTFdCiAgICAgICAgICAgIGJsb2JfZGF0YSArPSBpbnRfdG9fYnl0ZXMocGFyc2VkX2tleV9pbmZvWydleHBvbmVudDInXS5uYXRpdmUsIHNpZ25lZD1GYWxzZSwgd2lkdGg9bGVuMilbOjotMV0KICAgICAgICAgICAgYmxvYl9kYXRhICs9IGludF90b19ieXRlcyhwYXJzZWRfa2V5X2luZm9bJ2NvZWZmaWNpZW50J10ubmF0aXZlLCBzaWduZWQ9RmFsc2UsIHdpZHRoPWxlbjIpWzo6LTFdCiAgICAgICAgICAgIGJsb2JfZGF0YSArPSBpbnRfdG9fYnl0ZXMocGFyc2VkX2tleV9pbmZvWydwcml2YXRlX2V4cG9uZW50J10ubmF0aXZlLCBzaWduZWQ9RmFsc2UsIHdpZHRoPWxlbjEpWzo6LTFdCiAgICAgICAgYmxvYl9zdHJ1Y3QucnNhcHVia2V5ID0gcHVia2V5CgogICAgZWxzZToKICAgICAgICBwdWJrZXlfcG9pbnRlciA9IHN0cnVjdChhZHZhcGkzMiwgJ0RTU1BVQktFWScpCiAgICAgICAgcHVia2V5ID0gdW53cmFwKHB1YmtleV9wb2ludGVyKQogICAgICAgIHB1YmtleS5iaXRsZW4gPSBiaXRfc2l6ZQoKICAgICAgICBpZiBrZXlfdHlwZSA9PSAncHVibGljJzoKICAgICAgICAgICAgcHVia2V5Lm1hZ2ljID0gQWR2YXBpMzJDb25zdC5EU1MxCiAgICAgICAgICAgIHBhcmFtcyA9IGtleV9pbmZvWydhbGdvcml0aG0nXVsncGFyYW1ldGVycyddLm5hdGl2ZQogICAgICAgICAgICBrZXlfZGF0YSA9IGludF90b19ieXRlcyhrZXlfaW5mb1sncHVibGljX2tleSddLnBhcnNlZC5uYXRpdmUsIHNpZ25lZD1GYWxzZSwgd2lkdGg9bGVuMSlbOjotMV0KICAgICAgICBlbHNlOgogICAgICAgICAgICBwdWJrZXkubWFnaWMgPSBBZHZhcGkzMkNvbnN0LkRTUzIKICAgICAgICAgICAgcGFyYW1zID0ga2V5X2luZm9bJ3ByaXZhdGVfa2V5X2FsZ29yaXRobSddWydwYXJhbWV0ZXJzJ10ubmF0aXZlCiAgICAgICAgICAgIGtleV9kYXRhID0gaW50X3RvX2J5dGVzKGtleV9pbmZvWydwcml2YXRlX2tleSddLnBhcnNlZC5uYXRpdmUsIHNpZ25lZD1GYWxzZSwgd2lkdGg9MjApWzo6LTFdCiAgICAgICAgYmxvYl9zdHJ1Y3QuZHNzcHVia2V5ID0gcHVia2V5CgogICAgICAgIGJsb2JfZGF0YSA9IGludF90b19ieXRlcyhwYXJhbXNbJ3AnXSwgc2lnbmVkPUZhbHNlLCB3aWR0aD1sZW4xKVs6Oi0xXQogICAgICAgIGJsb2JfZGF0YSArPSBpbnRfdG9fYnl0ZXMocGFyYW1zWydxJ10sIHNpZ25lZD1GYWxzZSwgd2lkdGg9MjApWzo6LTFdCiAgICAgICAgYmxvYl9kYXRhICs9IGludF90b19ieXRlcyhwYXJhbXNbJ2cnXSwgc2lnbmVkPUZhbHNlLCB3aWR0aD1sZW4xKVs6Oi0xXQogICAgICAgIGJsb2JfZGF0YSArPSBrZXlfZGF0YQoKICAgICAgICBkc3NzZWVkX3BvaW50ZXIgPSBzdHJ1Y3QoYWR2YXBpMzIsICdEU1NTRUVEJykKICAgICAgICBkc3NzZWVkID0gdW53cmFwKGRzc3NlZWRfcG9pbnRlcikKICAgICAgICAjIFRoaXMgaW5kaWNhdGVzIG5vIGNvdW50ZXIgb3Igc2VlZCBpbmZvIGlzIGF2YWlsYWJsZQogICAgICAgIGRzc3NlZWQuY291bnRlciA9IDB4ZmZmZmZmZmYKCiAgICAgICAgYmxvYl9kYXRhICs9IHN0cnVjdF9ieXRlcyhkc3NzZWVkX3BvaW50ZXIpCgogICAgcmV0dXJuIHN0cnVjdF9ieXRlcyhibG9iX3N0cnVjdF9wb2ludGVyKSArIGJsb2JfZGF0YQoKCmRlZiBfYmNyeXB0X2xvYWRfa2V5KGtleV9vYmplY3QsIGtleV9pbmZvLCBjb250YWluZXIsIGN1cnZlX25hbWUpOgogICAgIiIiCiAgICBMb2FkcyBhIGNlcnRpZmljYXRlLCBwdWJsaWMga2V5IG9yIHByaXZhdGUga2V5IGludG8gYSBDZXJ0aWZpY2F0ZSwKICAgIFB1YmxpY0tleSBvciBQcml2YXRlS2V5IG9iamVjdCB2aWEgQ05HCgogICAgOnBhcmFtIGtleV9vYmplY3Q6CiAgICAgICAgQW4gYXNuMWNyeXB0by54NTA5LkNlcnRpZmljYXRlLCBhc24xY3J5cHRvLmtleXMuUHVibGljS2V5SW5mbyBvcgogICAgICAgIGFzbjFjcnlwdG8ua2V5cy5Qcml2YXRlS2V5SW5mbyBvYmplY3QKCiAgICA6cGFyYW0ga2V5X2luZm86CiAgICAgICAgQW4gYXNuMWNyeXB0by5rZXlzLlB1YmxpY0tleUluZm8gb3IgYXNuMWNyeXB0by5rZXlzLlByaXZhdGVLZXlJbmZvCiAgICAgICAgb2JqZWN0CgogICAgOnBhcmFtIGNvbnRhaW5lcjoKICAgICAgICBUaGUgY2xhc3Mgb2YgdGhlIG9iamVjdCB0byBob2xkIHRoZSBrZXlfaGFuZGxlCgogICAgOnBhcmFtIGN1cnZlX25hbWU6CiAgICAgICAgTm9uZSBvciBhIHVuaWNvZGUgc3RyaW5nIG9mIHRoZSBjdXJ2ZSBuYW1lIGZvciBhbiBFQyBrZXkKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBvc2NyeXB0by5lcnJvcnMuQXN5bW1ldHJpY0tleUVycm9yIC0gd2hlbiB0aGUga2V5IGlzIGluY29tcGF0aWJsZSB3aXRoIHRoZSBPUyBjcnlwdG8gbGlicmFyeQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBQcml2YXRlS2V5LCBQdWJsaWNLZXkgb3IgQ2VydGlmaWNhdGUgb2JqZWN0LCBiYXNlZCBvbiBjb250YWluZXIKICAgICIiIgoKICAgIGFsZ19oYW5kbGUgPSBOb25lCiAgICBrZXlfaGFuZGxlID0gTm9uZQoKICAgIGtleV90eXBlID0gJ3B1YmxpYycgaWYgaXNpbnN0YW5jZShrZXlfaW5mbywgUHVibGljS2V5SW5mbykgZWxzZSAncHJpdmF0ZScKICAgIGFsZ28gPSBrZXlfaW5mby5hbGdvcml0aG0KICAgIGlmIGFsZ28gPT0gJ3JzYXNzYV9wc3MnOgogICAgICAgIGFsZ28gPSAncnNhJwoKICAgIHRyeToKICAgICAgICBhbGdfc2VsZWN0b3IgPSBrZXlfaW5mby5jdXJ2ZVsxXSBpZiBhbGdvID09ICdlYycgZWxzZSBhbGdvCiAgICAgICAgYWxnX2NvbnN0YW50ID0gewogICAgICAgICAgICAncnNhJzogQmNyeXB0Q29uc3QuQkNSWVBUX1JTQV9BTEdPUklUSE0sCiAgICAgICAgICAgICdkc2EnOiBCY3J5cHRDb25zdC5CQ1JZUFRfRFNBX0FMR09SSVRITSwKICAgICAgICAgICAgJ3NlY3AyNTZyMSc6IEJjcnlwdENvbnN0LkJDUllQVF9FQ0RTQV9QMjU2X0FMR09SSVRITSwKICAgICAgICAgICAgJ3NlY3AzODRyMSc6IEJjcnlwdENvbnN0LkJDUllQVF9FQ0RTQV9QMzg0X0FMR09SSVRITSwKICAgICAgICAgICAgJ3NlY3A1MjFyMSc6IEJjcnlwdENvbnN0LkJDUllQVF9FQ0RTQV9QNTIxX0FMR09SSVRITSwKICAgICAgICB9W2FsZ19zZWxlY3Rvcl0KICAgICAgICBhbGdfaGFuZGxlID0gb3Blbl9hbGdfaGFuZGxlKGFsZ19jb25zdGFudCkKCiAgICAgICAgaWYgYWxnbyA9PSAncnNhJzoKICAgICAgICAgICAgaWYga2V5X3R5cGUgPT0gJ3B1YmxpYyc6CiAgICAgICAgICAgICAgICBibG9iX3R5cGUgPSBCY3J5cHRDb25zdC5CQ1JZUFRfUlNBUFVCTElDX0JMT0IKICAgICAgICAgICAgICAgIG1hZ2ljID0gQmNyeXB0Q29uc3QuQkNSWVBUX1JTQVBVQkxJQ19NQUdJQwogICAgICAgICAgICAgICAgcGFyc2VkX2tleSA9IGtleV9pbmZvWydwdWJsaWNfa2V5J10ucGFyc2VkCiAgICAgICAgICAgICAgICBwcmltZTFfc2l6ZSA9IDAKICAgICAgICAgICAgICAgIHByaW1lMl9zaXplID0gMAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYmxvYl90eXBlID0gQmNyeXB0Q29uc3QuQkNSWVBUX1JTQUZVTExQUklWQVRFX0JMT0IKICAgICAgICAgICAgICAgIG1hZ2ljID0gQmNyeXB0Q29uc3QuQkNSWVBUX1JTQUZVTExQUklWQVRFX01BR0lDCiAgICAgICAgICAgICAgICBwYXJzZWRfa2V5ID0ga2V5X2luZm9bJ3ByaXZhdGVfa2V5J10ucGFyc2VkCiAgICAgICAgICAgICAgICBwcmltZTEgPSBpbnRfdG9fYnl0ZXMocGFyc2VkX2tleVsncHJpbWUxJ10ubmF0aXZlKQogICAgICAgICAgICAgICAgcHJpbWUyID0gaW50X3RvX2J5dGVzKHBhcnNlZF9rZXlbJ3ByaW1lMiddLm5hdGl2ZSkKICAgICAgICAgICAgICAgIGV4cG9uZW50MSA9IGludF90b19ieXRlcyhwYXJzZWRfa2V5WydleHBvbmVudDEnXS5uYXRpdmUpCiAgICAgICAgICAgICAgICBleHBvbmVudDIgPSBpbnRfdG9fYnl0ZXMocGFyc2VkX2tleVsnZXhwb25lbnQyJ10ubmF0aXZlKQogICAgICAgICAgICAgICAgY29lZmZpY2llbnQgPSBpbnRfdG9fYnl0ZXMocGFyc2VkX2tleVsnY29lZmZpY2llbnQnXS5uYXRpdmUpCiAgICAgICAgICAgICAgICBwcml2YXRlX2V4cG9uZW50ID0gaW50X3RvX2J5dGVzKHBhcnNlZF9rZXlbJ3ByaXZhdGVfZXhwb25lbnQnXS5uYXRpdmUpCiAgICAgICAgICAgICAgICBwcmltZTFfc2l6ZSA9IGxlbihwcmltZTEpCiAgICAgICAgICAgICAgICBwcmltZTJfc2l6ZSA9IGxlbihwcmltZTIpCgogICAgICAgICAgICBwdWJsaWNfZXhwb25lbnQgPSBpbnRfdG9fYnl0ZXMocGFyc2VkX2tleVsncHVibGljX2V4cG9uZW50J10ubmF0aXZlKQogICAgICAgICAgICBtb2R1bHVzID0gaW50X3RvX2J5dGVzKHBhcnNlZF9rZXlbJ21vZHVsdXMnXS5uYXRpdmUpCgogICAgICAgICAgICBibG9iX3N0cnVjdF9wb2ludGVyID0gc3RydWN0KGJjcnlwdCwgJ0JDUllQVF9SU0FLRVlfQkxPQicpCiAgICAgICAgICAgIGJsb2Jfc3RydWN0ID0gdW53cmFwKGJsb2Jfc3RydWN0X3BvaW50ZXIpCiAgICAgICAgICAgIGJsb2Jfc3RydWN0Lk1hZ2ljID0gbWFnaWMKICAgICAgICAgICAgYmxvYl9zdHJ1Y3QuQml0TGVuZ3RoID0ga2V5X2luZm8uYml0X3NpemUKICAgICAgICAgICAgYmxvYl9zdHJ1Y3QuY2JQdWJsaWNFeHAgPSBsZW4ocHVibGljX2V4cG9uZW50KQogICAgICAgICAgICBibG9iX3N0cnVjdC5jYk1vZHVsdXMgPSBsZW4obW9kdWx1cykKICAgICAgICAgICAgYmxvYl9zdHJ1Y3QuY2JQcmltZTEgPSBwcmltZTFfc2l6ZQogICAgICAgICAgICBibG9iX3N0cnVjdC5jYlByaW1lMiA9IHByaW1lMl9zaXplCgogICAgICAgICAgICBibG9iID0gc3RydWN0X2J5dGVzKGJsb2Jfc3RydWN0X3BvaW50ZXIpICsgcHVibGljX2V4cG9uZW50ICsgbW9kdWx1cwogICAgICAgICAgICBpZiBrZXlfdHlwZSA9PSAncHJpdmF0ZSc6CiAgICAgICAgICAgICAgICBibG9iICs9IHByaW1lMSArIHByaW1lMgogICAgICAgICAgICAgICAgYmxvYiArPSBmaWxsX3dpZHRoKGV4cG9uZW50MSwgcHJpbWUxX3NpemUpCiAgICAgICAgICAgICAgICBibG9iICs9IGZpbGxfd2lkdGgoZXhwb25lbnQyLCBwcmltZTJfc2l6ZSkKICAgICAgICAgICAgICAgIGJsb2IgKz0gZmlsbF93aWR0aChjb2VmZmljaWVudCwgcHJpbWUxX3NpemUpCiAgICAgICAgICAgICAgICBibG9iICs9IGZpbGxfd2lkdGgocHJpdmF0ZV9leHBvbmVudCwgbGVuKG1vZHVsdXMpKQoKICAgICAgICBlbGlmIGFsZ28gPT0gJ2RzYSc6CiAgICAgICAgICAgIGlmIGtleV90eXBlID09ICdwdWJsaWMnOgogICAgICAgICAgICAgICAgYmxvYl90eXBlID0gQmNyeXB0Q29uc3QuQkNSWVBUX0RTQV9QVUJMSUNfQkxPQgogICAgICAgICAgICAgICAgcHVibGljX2tleSA9IGtleV9pbmZvWydwdWJsaWNfa2V5J10ucGFyc2VkLm5hdGl2ZQogICAgICAgICAgICAgICAgcGFyYW1zID0ga2V5X2luZm9bJ2FsZ29yaXRobSddWydwYXJhbWV0ZXJzJ10KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGJsb2JfdHlwZSA9IEJjcnlwdENvbnN0LkJDUllQVF9EU0FfUFJJVkFURV9CTE9CCiAgICAgICAgICAgICAgICBwdWJsaWNfa2V5ID0gX3Vud3JhcF9wcml2YXRlX2tleV9pbmZvKGtleV9pbmZvKVsncHVibGljX2tleSddLm5hdGl2ZQogICAgICAgICAgICAgICAgcHJpdmF0ZV9ieXRlcyA9IGludF90b19ieXRlcyhrZXlfaW5mb1sncHJpdmF0ZV9rZXknXS5wYXJzZWQubmF0aXZlKQogICAgICAgICAgICAgICAgcGFyYW1zID0ga2V5X2luZm9bJ3ByaXZhdGVfa2V5X2FsZ29yaXRobSddWydwYXJhbWV0ZXJzJ10KCiAgICAgICAgICAgIHB1YmxpY19ieXRlcyA9IGludF90b19ieXRlcyhwdWJsaWNfa2V5KQogICAgICAgICAgICBwID0gaW50X3RvX2J5dGVzKHBhcmFtc1sncCddLm5hdGl2ZSkKICAgICAgICAgICAgZyA9IGludF90b19ieXRlcyhwYXJhbXNbJ2cnXS5uYXRpdmUpCiAgICAgICAgICAgIHEgPSBpbnRfdG9fYnl0ZXMocGFyYW1zWydxJ10ubmF0aXZlKQoKICAgICAgICAgICAgaWYga2V5X2luZm8uYml0X3NpemUgPiAxMDI0OgogICAgICAgICAgICAgICAgcV9sZW4gPSBsZW4ocSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHFfbGVuID0gMjAKCiAgICAgICAgICAgIGtleV93aWR0aCA9IG1heChsZW4ocHVibGljX2J5dGVzKSwgbGVuKGcpLCBsZW4ocCkpCgogICAgICAgICAgICBwdWJsaWNfYnl0ZXMgPSBmaWxsX3dpZHRoKHB1YmxpY19ieXRlcywga2V5X3dpZHRoKQogICAgICAgICAgICBwID0gZmlsbF93aWR0aChwLCBrZXlfd2lkdGgpCiAgICAgICAgICAgIGcgPSBmaWxsX3dpZHRoKGcsIGtleV93aWR0aCkKICAgICAgICAgICAgcSA9IGZpbGxfd2lkdGgocSwgcV9sZW4pCiAgICAgICAgICAgICMgV2UgZG9uJ3Qga25vdyB0aGUgY291bnQgb3Igc2VlZCwgc28gd2Ugc2V0IHRoZW0gdG8gdGhlIG1heCB2YWx1ZQogICAgICAgICAgICAjIHNpbmNlIHNldHRpbmcgdGhlbSB0byAwIHJlc3VsdHMgaW4gYSBwYXJhbWV0ZXIgZXJyb3IKICAgICAgICAgICAgY291bnQgPSBiJ1x4ZmYnICogNAogICAgICAgICAgICBzZWVkID0gYidceGZmJyAqIHFfbGVuCgogICAgICAgICAgICBpZiBrZXlfaW5mby5iaXRfc2l6ZSA+IDEwMjQ6CiAgICAgICAgICAgICAgICBpZiBrZXlfdHlwZSA9PSAncHVibGljJzoKICAgICAgICAgICAgICAgICAgICBtYWdpYyA9IEJjcnlwdENvbnN0LkJDUllQVF9EU0FfUFVCTElDX01BR0lDX1YyCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIG1hZ2ljID0gQmNyeXB0Q29uc3QuQkNSWVBUX0RTQV9QUklWQVRFX01BR0lDX1YyCgogICAgICAgICAgICAgICAgYmxvYl9zdHJ1Y3RfcG9pbnRlciA9IHN0cnVjdChiY3J5cHQsICdCQ1JZUFRfRFNBX0tFWV9CTE9CX1YyJykKICAgICAgICAgICAgICAgIGJsb2Jfc3RydWN0ID0gdW53cmFwKGJsb2Jfc3RydWN0X3BvaW50ZXIpCiAgICAgICAgICAgICAgICBibG9iX3N0cnVjdC5kd01hZ2ljID0gbWFnaWMKICAgICAgICAgICAgICAgIGJsb2Jfc3RydWN0LmNiS2V5ID0ga2V5X3dpZHRoCiAgICAgICAgICAgICAgICAjIFdlIGRvbid0IGtub3cgaWYgU0hBMjU2IHdhcyB1c2VkIGhlcmUsIGJ1dCB0aGUgb3V0cHV0IGlzIGxvbmcKICAgICAgICAgICAgICAgICMgZW5vdWdoIGZvciB0aGUgZ2VuZXJhdGlvbiBvZiBxIGZvciB0aGUgc3VwcG9ydGVkIDIwNDgvMjI0LAogICAgICAgICAgICAgICAgIyAyMDQ4LzI1NiBhbmQgMzA3Mi8yNTYgRklQUyBhcHByb3ZlZCBwYWlycwogICAgICAgICAgICAgICAgYmxvYl9zdHJ1Y3QuaGFzaEFsZ29yaXRobSA9IEJjcnlwdENvbnN0LkRTQV9IQVNIX0FMR09SSVRITV9TSEEyNTYKICAgICAgICAgICAgICAgIGJsb2Jfc3RydWN0LnN0YW5kYXJkVmVyc2lvbiA9IEJjcnlwdENvbnN0LkRTQV9GSVBTMTg2XzMKICAgICAgICAgICAgICAgIGJsb2Jfc3RydWN0LmNiU2VlZExlbmd0aCA9IHFfbGVuCiAgICAgICAgICAgICAgICBibG9iX3N0cnVjdC5jYkdyb3VwU2l6ZSA9IHFfbGVuCiAgICAgICAgICAgICAgICBibG9iX3N0cnVjdC5Db3VudCA9IGJ5dGVfYXJyYXkoY291bnQpCgogICAgICAgICAgICAgICAgYmxvYiA9IHN0cnVjdF9ieXRlcyhibG9iX3N0cnVjdF9wb2ludGVyKQogICAgICAgICAgICAgICAgYmxvYiArPSBzZWVkICsgcSArIHAgKyBnICsgcHVibGljX2J5dGVzCiAgICAgICAgICAgICAgICBpZiBrZXlfdHlwZSA9PSAncHJpdmF0ZSc6CiAgICAgICAgICAgICAgICAgICAgYmxvYiArPSBmaWxsX3dpZHRoKHByaXZhdGVfYnl0ZXMsIHFfbGVuKQoKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIGtleV90eXBlID09ICdwdWJsaWMnOgogICAgICAgICAgICAgICAgICAgIG1hZ2ljID0gQmNyeXB0Q29uc3QuQkNSWVBUX0RTQV9QVUJMSUNfTUFHSUMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbWFnaWMgPSBCY3J5cHRDb25zdC5CQ1JZUFRfRFNBX1BSSVZBVEVfTUFHSUMKCiAgICAgICAgICAgICAgICBibG9iX3N0cnVjdF9wb2ludGVyID0gc3RydWN0KGJjcnlwdCwgJ0JDUllQVF9EU0FfS0VZX0JMT0InKQogICAgICAgICAgICAgICAgYmxvYl9zdHJ1Y3QgPSB1bndyYXAoYmxvYl9zdHJ1Y3RfcG9pbnRlcikKICAgICAgICAgICAgICAgIGJsb2Jfc3RydWN0LmR3TWFnaWMgPSBtYWdpYwogICAgICAgICAgICAgICAgYmxvYl9zdHJ1Y3QuY2JLZXkgPSBrZXlfd2lkdGgKICAgICAgICAgICAgICAgIGJsb2Jfc3RydWN0LkNvdW50ID0gYnl0ZV9hcnJheShjb3VudCkKICAgICAgICAgICAgICAgIGJsb2Jfc3RydWN0LlNlZWQgPSBieXRlX2FycmF5KHNlZWQpCiAgICAgICAgICAgICAgICBibG9iX3N0cnVjdC5xID0gYnl0ZV9hcnJheShxKQoKICAgICAgICAgICAgICAgIGJsb2IgPSBzdHJ1Y3RfYnl0ZXMoYmxvYl9zdHJ1Y3RfcG9pbnRlcikgKyBwICsgZyArIHB1YmxpY19ieXRlcwogICAgICAgICAgICAgICAgaWYga2V5X3R5cGUgPT0gJ3ByaXZhdGUnOgogICAgICAgICAgICAgICAgICAgIGJsb2IgKz0gZmlsbF93aWR0aChwcml2YXRlX2J5dGVzLCBxX2xlbikKCiAgICAgICAgZWxpZiBhbGdvID09ICdlYyc6CiAgICAgICAgICAgIGlmIGtleV90eXBlID09ICdwdWJsaWMnOgogICAgICAgICAgICAgICAgYmxvYl90eXBlID0gQmNyeXB0Q29uc3QuQkNSWVBUX0VDQ1BVQkxJQ19CTE9CCiAgICAgICAgICAgICAgICB4LCB5ID0ga2V5X2luZm9bJ3B1YmxpY19rZXknXS50b19jb29yZHMoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYmxvYl90eXBlID0gQmNyeXB0Q29uc3QuQkNSWVBUX0VDQ1BSSVZBVEVfQkxPQgogICAgICAgICAgICAgICAgcHVibGljX2tleSA9IGtleV9pbmZvWydwcml2YXRlX2tleSddLnBhcnNlZFsncHVibGljX2tleSddCiAgICAgICAgICAgICAgICAjIFdlIGFyZW4ndCBndWFyYW50ZWVkIHRvIGdldCB0aGUgcHVibGljIGtleSBjb29yZHMgd2l0aCB0aGUKICAgICAgICAgICAgICAgICMga2V5IGluZm8gc3RydWN0dXJlLCBidXQgQkNyeXB0IGRvZXNuJ3Qgc2VlbSB0byBoYXZlIGFuIGlzc3VlCiAgICAgICAgICAgICAgICAjIGltcG9ydGluZyB0aGUgcHJpdmF0ZSBrZXkgd2l0aCAwIHZhbHVlcywgd2hpY2ggY2FuIG9ubHkgYmUKICAgICAgICAgICAgICAgICMgcHJlc3VtZWQgdGhhdCBpdCBpcyBnZW5lcmF0aW5nIHRoZSB4IGFuZCB5IHBvaW50cyBmcm9tIHRoZQogICAgICAgICAgICAgICAgIyBwcml2YXRlIGtleSB2YWx1ZSBhbmQgYmFzZSBwb2ludAogICAgICAgICAgICAgICAgaWYgcHVibGljX2tleToKICAgICAgICAgICAgICAgICAgICB4LCB5ID0gcHVibGljX2tleS50b19jb29yZHMoKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB4ID0gMAogICAgICAgICAgICAgICAgICAgIHkgPSAwCiAgICAgICAgICAgICAgICBwcml2YXRlX2J5dGVzID0gaW50X3RvX2J5dGVzKGtleV9pbmZvWydwcml2YXRlX2tleSddLnBhcnNlZFsncHJpdmF0ZV9rZXknXS5uYXRpdmUpCgogICAgICAgICAgICBibG9iX3N0cnVjdF9wb2ludGVyID0gc3RydWN0KGJjcnlwdCwgJ0JDUllQVF9FQ0NLRVlfQkxPQicpCiAgICAgICAgICAgIGJsb2Jfc3RydWN0ID0gdW53cmFwKGJsb2Jfc3RydWN0X3BvaW50ZXIpCgogICAgICAgICAgICBtYWdpYyA9IHsKICAgICAgICAgICAgICAgICgncHVibGljJywgJ3NlY3AyNTZyMScpOiBCY3J5cHRDb25zdC5CQ1JZUFRfRUNEU0FfUFVCTElDX1AyNTZfTUFHSUMsCiAgICAgICAgICAgICAgICAoJ3B1YmxpYycsICdzZWNwMzg0cjEnKTogQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1BVQkxJQ19QMzg0X01BR0lDLAogICAgICAgICAgICAgICAgKCdwdWJsaWMnLCAnc2VjcDUyMXIxJyk6IEJjcnlwdENvbnN0LkJDUllQVF9FQ0RTQV9QVUJMSUNfUDUyMV9NQUdJQywKICAgICAgICAgICAgICAgICgncHJpdmF0ZScsICdzZWNwMjU2cjEnKTogQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1BSSVZBVEVfUDI1Nl9NQUdJQywKICAgICAgICAgICAgICAgICgncHJpdmF0ZScsICdzZWNwMzg0cjEnKTogQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1BSSVZBVEVfUDM4NF9NQUdJQywKICAgICAgICAgICAgICAgICgncHJpdmF0ZScsICdzZWNwNTIxcjEnKTogQmNyeXB0Q29uc3QuQkNSWVBUX0VDRFNBX1BSSVZBVEVfUDUyMV9NQUdJQywKICAgICAgICAgICAgfVsoa2V5X3R5cGUsIGN1cnZlX25hbWUpXQoKICAgICAgICAgICAga2V5X3dpZHRoID0gewogICAgICAgICAgICAgICAgJ3NlY3AyNTZyMSc6IDMyLAogICAgICAgICAgICAgICAgJ3NlY3AzODRyMSc6IDQ4LAogICAgICAgICAgICAgICAgJ3NlY3A1MjFyMSc6IDY2CiAgICAgICAgICAgIH1bY3VydmVfbmFtZV0KCiAgICAgICAgICAgIHhfYnl0ZXMgPSBpbnRfdG9fYnl0ZXMoeCkKICAgICAgICAgICAgeV9ieXRlcyA9IGludF90b19ieXRlcyh5KQoKICAgICAgICAgICAgeF9ieXRlcyA9IGZpbGxfd2lkdGgoeF9ieXRlcywga2V5X3dpZHRoKQogICAgICAgICAgICB5X2J5dGVzID0gZmlsbF93aWR0aCh5X2J5dGVzLCBrZXlfd2lkdGgpCgogICAgICAgICAgICBibG9iX3N0cnVjdC5kd01hZ2ljID0gbWFnaWMKICAgICAgICAgICAgYmxvYl9zdHJ1Y3QuY2JLZXkgPSBrZXlfd2lkdGgKCiAgICAgICAgICAgIGJsb2IgPSBzdHJ1Y3RfYnl0ZXMoYmxvYl9zdHJ1Y3RfcG9pbnRlcikgKyB4X2J5dGVzICsgeV9ieXRlcwogICAgICAgICAgICBpZiBrZXlfdHlwZSA9PSAncHJpdmF0ZSc6CiAgICAgICAgICAgICAgICBibG9iICs9IGZpbGxfd2lkdGgocHJpdmF0ZV9ieXRlcywga2V5X3dpZHRoKQoKICAgICAgICBrZXlfaGFuZGxlX3BvaW50ZXIgPSBuZXcoYmNyeXB0LCAnQkNSWVBUX0tFWV9IQU5ETEUgKicpCiAgICAgICAgcmVzID0gYmNyeXB0LkJDcnlwdEltcG9ydEtleVBhaXIoCiAgICAgICAgICAgIGFsZ19oYW5kbGUsCiAgICAgICAgICAgIG51bGwoKSwKICAgICAgICAgICAgYmxvYl90eXBlLAogICAgICAgICAgICBrZXlfaGFuZGxlX3BvaW50ZXIsCiAgICAgICAgICAgIGJsb2IsCiAgICAgICAgICAgIGxlbihibG9iKSwKICAgICAgICAgICAgQmNyeXB0Q29uc3QuQkNSWVBUX05PX0tFWV9WQUxJREFUSU9OCiAgICAgICAgKQogICAgICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgICAgIGtleV9oYW5kbGUgPSB1bndyYXAoa2V5X2hhbmRsZV9wb2ludGVyKQogICAgICAgIHJldHVybiBjb250YWluZXIoa2V5X2hhbmRsZSwga2V5X29iamVjdCkKCiAgICBmaW5hbGx5OgogICAgICAgIGlmIGFsZ19oYW5kbGU6CiAgICAgICAgICAgIGNsb3NlX2FsZ19oYW5kbGUoYWxnX2hhbmRsZSkKCgpkZWYgbG9hZF9wcml2YXRlX2tleShzb3VyY2UsIHBhc3N3b3JkPU5vbmUpOgogICAgIiIiCiAgICBMb2FkcyBhIHByaXZhdGUga2V5IGludG8gYSBQcml2YXRlS2V5IG9iamVjdAoKICAgIDpwYXJhbSBzb3VyY2U6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiBmaWxlIGNvbnRlbnRzLCBhIHVuaWNvZGUgc3RyaW5nIGZpbGVuYW1lIG9yIGFuCiAgICAgICAgYXNuMWNyeXB0by5rZXlzLlByaXZhdGVLZXlJbmZvIG9iamVjdAoKICAgIDpwYXJhbSBwYXNzd29yZDoKICAgICAgICBBIGJ5dGUgb3IgdW5pY29kZSBzdHJpbmcgdG8gZGVjcnlwdCB0aGUgcHJpdmF0ZSBrZXkgZmlsZS4gVW5pY29kZQogICAgICAgIHN0cmluZ3Mgd2lsbCBiZSBlbmNvZGVkIHVzaW5nIFVURi04LiBOb3QgdXNlZCBpcyB0aGUgc291cmNlIGlzIGEKICAgICAgICBQcml2YXRlS2V5SW5mbyBvYmplY3QuCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgb3NjcnlwdG8uZXJyb3JzLkFzeW1tZXRyaWNLZXlFcnJvciAtIHdoZW4gdGhlIHByaXZhdGUga2V5IGlzIGluY29tcGF0aWJsZSB3aXRoIHRoZSBPUyBjcnlwdG8gbGlicmFyeQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBQcml2YXRlS2V5IG9iamVjdAogICAgIiIiCgogICAgaWYgaXNpbnN0YW5jZShzb3VyY2UsIFByaXZhdGVLZXlJbmZvKToKICAgICAgICBwcml2YXRlX29iamVjdCA9IHNvdXJjZQoKICAgIGVsc2U6CiAgICAgICAgaWYgcGFzc3dvcmQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocGFzc3dvcmQsIHN0cl9jbHMpOgogICAgICAgICAgICAgICAgcGFzc3dvcmQgPSBwYXNzd29yZC5lbmNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UocGFzc3dvcmQsIGJ5dGVfY2xzKToKICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgICAgICBwYXNzd29yZCBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAgICAgICAgICcnJywKICAgICAgICAgICAgICAgICAgICB0eXBlX25hbWUocGFzc3dvcmQpCiAgICAgICAgICAgICAgICApKQoKICAgICAgICBpZiBpc2luc3RhbmNlKHNvdXJjZSwgc3RyX2Nscyk6CiAgICAgICAgICAgIHdpdGggb3Blbihzb3VyY2UsICdyYicpIGFzIGY6CiAgICAgICAgICAgICAgICBzb3VyY2UgPSBmLnJlYWQoKQoKICAgICAgICBlbGlmIG5vdCBpc2luc3RhbmNlKHNvdXJjZSwgYnl0ZV9jbHMpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIHNvdXJjZSBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIHVuaWNvZGUgc3RyaW5nIG9yCiAgICAgICAgICAgICAgICBhc24xY3J5cHRvLmtleXMuUHJpdmF0ZUtleUluZm8gb2JqZWN0LCBub3QgJXMKICAgICAgICAgICAgICAgICcnJywKICAgICAgICAgICAgICAgIHR5cGVfbmFtZShzb3VyY2UpCiAgICAgICAgICAgICkpCgogICAgICAgIHByaXZhdGVfb2JqZWN0ID0gcGFyc2VfcHJpdmF0ZShzb3VyY2UsIHBhc3N3b3JkKQoKICAgIHJldHVybiBfbG9hZF9rZXkocHJpdmF0ZV9vYmplY3QsIFByaXZhdGVLZXkpCgoKZGVmIGxvYWRfcHVibGljX2tleShzb3VyY2UpOgogICAgIiIiCiAgICBMb2FkcyBhIHB1YmxpYyBrZXkgaW50byBhIFB1YmxpY0tleSBvYmplY3QKCiAgICA6cGFyYW0gc291cmNlOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgZmlsZSBjb250ZW50cywgYSB1bmljb2RlIHN0cmluZyBmaWxlbmFtZSBvciBhbgogICAgICAgIGFzbjFjcnlwdG8ua2V5cy5QdWJsaWNLZXlJbmZvIG9iamVjdAoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIG9zY3J5cHRvLmVycm9ycy5Bc3ltbWV0cmljS2V5RXJyb3IgLSB3aGVuIHRoZSBwdWJsaWMga2V5IGlzIGluY29tcGF0aWJsZSB3aXRoIHRoZSBPUyBjcnlwdG8gbGlicmFyeQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBQdWJsaWNLZXkgb2JqZWN0CiAgICAiIiIKCiAgICBpZiBpc2luc3RhbmNlKHNvdXJjZSwgUHVibGljS2V5SW5mbyk6CiAgICAgICAgcHVibGljX2tleSA9IHNvdXJjZQoKICAgIGVsaWYgaXNpbnN0YW5jZShzb3VyY2UsIGJ5dGVfY2xzKToKICAgICAgICBwdWJsaWNfa2V5ID0gcGFyc2VfcHVibGljKHNvdXJjZSkKCiAgICBlbGlmIGlzaW5zdGFuY2Uoc291cmNlLCBzdHJfY2xzKToKICAgICAgICB3aXRoIG9wZW4oc291cmNlLCAncmInKSBhcyBmOgogICAgICAgICAgICBwdWJsaWNfa2V5ID0gcGFyc2VfcHVibGljKGYucmVhZCgpKQoKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgc291cmNlIG11c3QgYmUgYSBieXRlIHN0cmluZywgdW5pY29kZSBzdHJpbmcgb3IKICAgICAgICAgICAgYXNuMWNyeXB0by5rZXlzLlB1YmxpY0tleUluZm8gb2JqZWN0LCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICB0eXBlX25hbWUocHVibGljX2tleSkKICAgICAgICApKQoKICAgIHJldHVybiBfbG9hZF9rZXkocHVibGljX2tleSwgUHVibGljS2V5KQoKCmRlZiBwYXJzZV9wa2NzMTIoZGF0YSwgcGFzc3dvcmQ9Tm9uZSk6CiAgICAiIiIKICAgIFBhcnNlcyBhIFBLQ1MjMTIgQU5TLjEgREVSLWVuY29kZWQgc3RydWN0dXJlIGFuZCBleHRyYWN0cyBjZXJ0cyBhbmQga2V5cwoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgYSBERVItZW5jb2RlZCBQS0NTIzEyIGZpbGUKCiAgICA6cGFyYW0gcGFzc3dvcmQ6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgcGFzc3dvcmQgdG8gYW55IGVuY3J5cHRlZCBkYXRhCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlIG9yIHZhbHVlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgb25lIG9mIHRoZSBPUyBkZWNyeXB0aW9uIGZ1bmN0aW9ucwoKICAgIDpyZXR1cm46CiAgICAgICAgQSB0aHJlZS1lbGVtZW50IHR1cGxlIG9mOgogICAgICAgICAxLiBBbiBhc24xY3J5cHRvLmtleXMuUHJpdmF0ZUtleUluZm8gb2JqZWN0CiAgICAgICAgIDIuIEFuIGFzbjFjcnlwdG8ueDUwOS5DZXJ0aWZpY2F0ZSBvYmplY3QKICAgICAgICAgMy4gQSBsaXN0IG9mIHplcm8gb3IgbW9yZSBhc24xY3J5cHRvLng1MDkuQ2VydGlmaWNhdGUgb2JqZWN0cyB0aGF0IGFyZQogICAgICAgICAgICAiZXh0cmEiIGNlcnRpZmljYXRlcywgcG9zc2libHkgaW50ZXJtZWRpYXRlcyBmcm9tIHRoZSBjZXJ0IGNoYWluCiAgICAiIiIKCiAgICByZXR1cm4gX3BhcnNlX3BrY3MxMihkYXRhLCBwYXNzd29yZCwgbG9hZF9wcml2YXRlX2tleSkKCgpkZWYgbG9hZF9wa2NzMTIoc291cmNlLCBwYXNzd29yZD1Ob25lKToKICAgICIiIgogICAgTG9hZHMgYSAucDEyIG9yIC5wZnggZmlsZSBpbnRvIGEgUHJpdmF0ZUtleSBvYmplY3QgYW5kIG9uZSBvciBtb3JlCiAgICBDZXJ0aWZpY2F0ZXMgb2JqZWN0cwoKICAgIDpwYXJhbSBzb3VyY2U6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiBmaWxlIGNvbnRlbnRzIG9yIGEgdW5pY29kZSBzdHJpbmcgZmlsZW5hbWUKCiAgICA6cGFyYW0gcGFzc3dvcmQ6CiAgICAgICAgQSBieXRlIG9yIHVuaWNvZGUgc3RyaW5nIHRvIGRlY3J5cHQgdGhlIFBLQ1MxMiBmaWxlLiBVbmljb2RlIHN0cmluZ3MKICAgICAgICB3aWxsIGJlIGVuY29kZWQgdXNpbmcgVVRGLTguCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgb3NjcnlwdG8uZXJyb3JzLkFzeW1tZXRyaWNLZXlFcnJvciAtIHdoZW4gYSBjb250YWluZWQga2V5IGlzIGluY29tcGF0aWJsZSB3aXRoIHRoZSBPUyBjcnlwdG8gbGlicmFyeQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSB0aHJlZS1lbGVtZW50IHR1cGxlIGNvbnRhaW5pbmcgKFByaXZhdGVLZXksIENlcnRpZmljYXRlLCBbQ2VydGlmaWNhdGUsIC4uLl0pCiAgICAiIiIKCiAgICBpZiBwYXNzd29yZCBpcyBub3QgTm9uZToKICAgICAgICBpZiBpc2luc3RhbmNlKHBhc3N3b3JkLCBzdHJfY2xzKToKICAgICAgICAgICAgcGFzc3dvcmQgPSBwYXNzd29yZC5lbmNvZGUoJ3V0Zi04JykKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShwYXNzd29yZCwgYnl0ZV9jbHMpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIHBhc3N3b3JkIG11c3QgYmUgYSBieXRlIHN0cmluZywgbm90ICVzCiAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICB0eXBlX25hbWUocGFzc3dvcmQpCiAgICAgICAgICAgICkpCgogICAgaWYgaXNpbnN0YW5jZShzb3VyY2UsIHN0cl9jbHMpOgogICAgICAgIHdpdGggb3Blbihzb3VyY2UsICdyYicpIGFzIGY6CiAgICAgICAgICAgIHNvdXJjZSA9IGYucmVhZCgpCgogICAgZWxpZiBub3QgaXNpbnN0YW5jZShzb3VyY2UsIGJ5dGVfY2xzKToKICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBzb3VyY2UgbXVzdCBiZSBhIGJ5dGUgc3RyaW5nIG9yIGEgdW5pY29kZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShzb3VyY2UpCiAgICAgICAgKSkKCiAgICBrZXlfaW5mbywgY2VydF9pbmZvLCBleHRyYV9jZXJ0c19pbmZvID0gcGFyc2VfcGtjczEyKHNvdXJjZSwgcGFzc3dvcmQpCgogICAga2V5ID0gTm9uZQogICAgY2VydCA9IE5vbmUKCiAgICBpZiBrZXlfaW5mbzoKICAgICAgICBrZXkgPSBfbG9hZF9rZXkoa2V5X2luZm8sIFByaXZhdGVLZXkpCgogICAgaWYgY2VydF9pbmZvOgogICAgICAgIGNlcnQgPSBfbG9hZF9rZXkoY2VydF9pbmZvLnB1YmxpY19rZXksIENlcnRpZmljYXRlKQoKICAgIGV4dHJhX2NlcnRzID0gW19sb2FkX2tleShpbmZvLnB1YmxpY19rZXksIENlcnRpZmljYXRlKSBmb3IgaW5mbyBpbiBleHRyYV9jZXJ0c19pbmZvXQoKICAgIHJldHVybiAoa2V5LCBjZXJ0LCBleHRyYV9jZXJ0cykKCgpkZWYgcnNhX3BrY3MxdjE1X3ZlcmlmeShjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LCBzaWduYXR1cmUsIGRhdGEsIGhhc2hfYWxnb3JpdGhtKToKICAgICIiIgogICAgVmVyaWZpZXMgYW4gUlNBU1NBLVBLQ1MtdjEuNSBzaWduYXR1cmUuCgogICAgV2hlbiB0aGUgaGFzaF9hbGdvcml0aG0gaXMgInJhdyIsIHRoZSBvcGVyYXRpb24gaXMgaWRlbnRpY2FsIHRvIFJTQQogICAgcHVibGljIGtleSBkZWNyeXB0aW9uLiBUaGF0IGlzOiB0aGUgZGF0YSBpcyBub3QgaGFzaGVkIGFuZCBubyBBU04uMQogICAgc3RydWN0dXJlIHdpdGggYW4gYWxnb3JpdGhtIGlkZW50aWZpZXIgb2YgdGhlIGhhc2ggYWxnb3JpdGhtIGlzIHBsYWNlZCBpbgogICAgdGhlIGVuY3J5cHRlZCBieXRlIHN0cmluZy4KCiAgICA6cGFyYW0gY2VydGlmaWNhdGVfb3JfcHVibGljX2tleToKICAgICAgICBBIENlcnRpZmljYXRlIG9yIFB1YmxpY0tleSBpbnN0YW5jZSB0byB2ZXJpZnkgdGhlIHNpZ25hdHVyZSB3aXRoCgogICAgOnBhcmFtIHNpZ25hdHVyZToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBzaWduYXR1cmUgdG8gdmVyaWZ5CgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgZGF0YSB0aGUgc2lnbmF0dXJlIGlzIGZvcgoKICAgIDpwYXJhbSBoYXNoX2FsZ29yaXRobToKICAgICAgICBBIHVuaWNvZGUgc3RyaW5nIG9mICJtZDUiLCAic2hhMSIsICJzaGEyNTYiLCAic2hhMzg0IiwgInNoYTUxMiIgb3IgInJhdyIKCiAgICA6cmFpc2VzOgogICAgICAgIG9zY3J5cHRvLmVycm9ycy5TaWduYXR1cmVFcnJvciAtIHdoZW4gdGhlIHNpZ25hdHVyZSBpcyBkZXRlcm1pbmVkIHRvIGJlIGludmFsaWQKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CiAgICAiIiIKCiAgICBpZiBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LmFsZ29yaXRobSAhPSAncnNhJzoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdUaGUga2V5IHNwZWNpZmllZCBpcyBub3QgYW4gUlNBIHB1YmxpYyBrZXknKQoKICAgIHJldHVybiBfdmVyaWZ5KGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXksIHNpZ25hdHVyZSwgZGF0YSwgaGFzaF9hbGdvcml0aG0pCgoKZGVmIHJzYV9wc3NfdmVyaWZ5KGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXksIHNpZ25hdHVyZSwgZGF0YSwgaGFzaF9hbGdvcml0aG0pOgogICAgIiIiCiAgICBWZXJpZmllcyBhbiBSU0FTU0EtUFNTIHNpZ25hdHVyZS4gRm9yIHRoZSBQU1MgcGFkZGluZyB0aGUgbWFzayBnZW4gYWxnb3JpdGhtCiAgICB3aWxsIGJlIG1nZjEgdXNpbmcgdGhlIHNhbWUgaGFzaCBhbGdvcml0aG0gYXMgdGhlIHNpZ25hdHVyZS4gVGhlIHNhbHQgbGVuZ3RoCiAgICB3aXRoIGJlIHRoZSBsZW5ndGggb2YgdGhlIGhhc2ggYWxnb3JpdGhtLCBhbmQgdGhlIHRyYWlsZXIgZmllbGQgd2l0aCBiZSB0aGUKICAgIHN0YW5kYXJkIDB4QkMgYnl0ZS4KCiAgICA6cGFyYW0gY2VydGlmaWNhdGVfb3JfcHVibGljX2tleToKICAgICAgICBBIENlcnRpZmljYXRlIG9yIFB1YmxpY0tleSBpbnN0YW5jZSB0byB2ZXJpZnkgdGhlIHNpZ25hdHVyZSB3aXRoCgogICAgOnBhcmFtIHNpZ25hdHVyZToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBzaWduYXR1cmUgdG8gdmVyaWZ5CgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgZGF0YSB0aGUgc2lnbmF0dXJlIGlzIGZvcgoKICAgIDpwYXJhbSBoYXNoX2FsZ29yaXRobToKICAgICAgICBBIHVuaWNvZGUgc3RyaW5nIG9mICJtZDUiLCAic2hhMSIsICJzaGEyNTYiLCAic2hhMzg0IiBvciAic2hhNTEyIgoKICAgIDpyYWlzZXM6CiAgICAgICAgb3NjcnlwdG8uZXJyb3JzLlNpZ25hdHVyZUVycm9yIC0gd2hlbiB0aGUgc2lnbmF0dXJlIGlzIGRldGVybWluZWQgdG8gYmUgaW52YWxpZAogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKICAgICIiIgoKICAgIGNwX2FsZyA9IGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXkuYWxnb3JpdGhtCgogICAgaWYgY3BfYWxnICE9ICdyc2EnIGFuZCBjcF9hbGcgIT0gJ3JzYXNzYV9wc3MnOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ1RoZSBrZXkgc3BlY2lmaWVkIGlzIG5vdCBhbiBSU0EgcHVibGljIGtleScpCgogICAgcmV0dXJuIF92ZXJpZnkoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgc2lnbmF0dXJlLCBkYXRhLCBoYXNoX2FsZ29yaXRobSwgcnNhX3Bzc19wYWRkaW5nPVRydWUpCgoKZGVmIGRzYV92ZXJpZnkoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgc2lnbmF0dXJlLCBkYXRhLCBoYXNoX2FsZ29yaXRobSk6CiAgICAiIiIKICAgIFZlcmlmaWVzIGEgRFNBIHNpZ25hdHVyZQoKICAgIDpwYXJhbSBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5OgogICAgICAgIEEgQ2VydGlmaWNhdGUgb3IgUHVibGljS2V5IGluc3RhbmNlIHRvIHZlcmlmeSB0aGUgc2lnbmF0dXJlIHdpdGgKCiAgICA6cGFyYW0gc2lnbmF0dXJlOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHNpZ25hdHVyZSB0byB2ZXJpZnkKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBkYXRhIHRoZSBzaWduYXR1cmUgaXMgZm9yCgogICAgOnBhcmFtIGhhc2hfYWxnb3JpdGhtOgogICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgIm1kNSIsICJzaGExIiwgInNoYTI1NiIsICJzaGEzODQiIG9yICJzaGE1MTIiCgogICAgOnJhaXNlczoKICAgICAgICBvc2NyeXB0by5lcnJvcnMuU2lnbmF0dXJlRXJyb3IgLSB3aGVuIHRoZSBzaWduYXR1cmUgaXMgZGV0ZXJtaW5lZCB0byBiZSBpbnZhbGlkCiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQogICAgIiIiCgogICAgaWYgY2VydGlmaWNhdGVfb3JfcHVibGljX2tleS5hbGdvcml0aG0gIT0gJ2RzYSc6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignVGhlIGtleSBzcGVjaWZpZWQgaXMgbm90IGEgRFNBIHB1YmxpYyBrZXknKQoKICAgIHJldHVybiBfdmVyaWZ5KGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXksIHNpZ25hdHVyZSwgZGF0YSwgaGFzaF9hbGdvcml0aG0pCgoKZGVmIGVjZHNhX3ZlcmlmeShjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LCBzaWduYXR1cmUsIGRhdGEsIGhhc2hfYWxnb3JpdGhtKToKICAgICIiIgogICAgVmVyaWZpZXMgYW4gRUNEU0Egc2lnbmF0dXJlCgogICAgOnBhcmFtIGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXk6CiAgICAgICAgQSBDZXJ0aWZpY2F0ZSBvciBQdWJsaWNLZXkgaW5zdGFuY2UgdG8gdmVyaWZ5IHRoZSBzaWduYXR1cmUgd2l0aAoKICAgIDpwYXJhbSBzaWduYXR1cmU6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgc2lnbmF0dXJlIHRvIHZlcmlmeQoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGRhdGEgdGhlIHNpZ25hdHVyZSBpcyBmb3IKCiAgICA6cGFyYW0gaGFzaF9hbGdvcml0aG06CiAgICAgICAgQSB1bmljb2RlIHN0cmluZyBvZiAibWQ1IiwgInNoYTEiLCAic2hhMjU2IiwgInNoYTM4NCIgb3IgInNoYTUxMiIKCiAgICA6cmFpc2VzOgogICAgICAgIG9zY3J5cHRvLmVycm9ycy5TaWduYXR1cmVFcnJvciAtIHdoZW4gdGhlIHNpZ25hdHVyZSBpcyBkZXRlcm1pbmVkIHRvIGJlIGludmFsaWQKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CiAgICAiIiIKCiAgICBpZiBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LmFsZ29yaXRobSAhPSAnZWMnOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ1RoZSBrZXkgc3BlY2lmaWVkIGlzIG5vdCBhbiBFQyBwdWJsaWMga2V5JykKCiAgICByZXR1cm4gX3ZlcmlmeShjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LCBzaWduYXR1cmUsIGRhdGEsIGhhc2hfYWxnb3JpdGhtKQoKCmRlZiBfdmVyaWZ5KGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXksIHNpZ25hdHVyZSwgZGF0YSwgaGFzaF9hbGdvcml0aG0sIHJzYV9wc3NfcGFkZGluZz1GYWxzZSk6CiAgICAiIiIKICAgIFZlcmlmaWVzIGFuIFJTQSwgRFNBIG9yIEVDRFNBIHNpZ25hdHVyZQoKICAgIDpwYXJhbSBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5OgogICAgICAgIEEgQ2VydGlmaWNhdGUgb3IgUHVibGljS2V5IGluc3RhbmNlIHRvIHZlcmlmeSB0aGUgc2lnbmF0dXJlIHdpdGgKCiAgICA6cGFyYW0gc2lnbmF0dXJlOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHNpZ25hdHVyZSB0byB2ZXJpZnkKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBkYXRhIHRoZSBzaWduYXR1cmUgaXMgZm9yCgogICAgOnBhcmFtIGhhc2hfYWxnb3JpdGhtOgogICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgIm1kNSIsICJzaGExIiwgInNoYTI1NiIsICJzaGEzODQiLCAic2hhNTEyIiBvciAicmF3IgoKICAgIDpwYXJhbSByc2FfcHNzX3BhZGRpbmc6CiAgICAgICAgSWYgUFNTIHBhZGRpbmcgc2hvdWxkIGJlIHVzZWQgZm9yIFJTQSBrZXlzCgogICAgOnJhaXNlczoKICAgICAgICBvc2NyeXB0by5lcnJvcnMuU2lnbmF0dXJlRXJyb3IgLSB3aGVuIHRoZSBzaWduYXR1cmUgaXMgZGV0ZXJtaW5lZCB0byBiZSBpbnZhbGlkCiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQogICAgIiIiCgogICAgaWYgbm90IGlzaW5zdGFuY2UoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgKENlcnRpZmljYXRlLCBQdWJsaWNLZXkpKToKICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5IG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgdGhlIENlcnRpZmljYXRlIG9yCiAgICAgICAgICAgIFB1YmxpY0tleSBjbGFzcywgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXkpCiAgICAgICAgKSkKCiAgICBpZiBub3QgaXNpbnN0YW5jZShzaWduYXR1cmUsIGJ5dGVfY2xzKToKICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBzaWduYXR1cmUgbXVzdCBiZSBhIGJ5dGUgc3RyaW5nLCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICB0eXBlX25hbWUoc2lnbmF0dXJlKQogICAgICAgICkpCgogICAgaWYgbm90IGlzaW5zdGFuY2UoZGF0YSwgYnl0ZV9jbHMpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGRhdGEgbXVzdCBiZSBhIGJ5dGUgc3RyaW5nLCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICB0eXBlX25hbWUoZGF0YSkKICAgICAgICApKQoKICAgIGNwX2FsZyA9IGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXkuYWxnb3JpdGhtCiAgICBjcF9pc19yc2EgPSBjcF9hbGcgPT0gJ3JzYScgb3IgY3BfYWxnID09ICdyc2Fzc2FfcHNzJwoKICAgIHZhbGlkX2hhc2hfYWxnb3JpdGhtcyA9IHNldChbJ21kNScsICdzaGExJywgJ3NoYTI1NicsICdzaGEzODQnLCAnc2hhNTEyJ10pCiAgICBpZiBjcF9pc19yc2EgYW5kIG5vdCByc2FfcHNzX3BhZGRpbmc6CiAgICAgICAgdmFsaWRfaGFzaF9hbGdvcml0aG1zIHw9IHNldChbJ3JhdyddKQoKICAgIGlmIGhhc2hfYWxnb3JpdGhtIG5vdCBpbiB2YWxpZF9oYXNoX2FsZ29yaXRobXM6CiAgICAgICAgdmFsaWRfaGFzaF9hbGdvcml0aG1zX2Vycm9yID0gJyJtZDUiLCAic2hhMSIsICJzaGEyNTYiLCAic2hhMzg0IiwgInNoYTUxMiInCiAgICAgICAgaWYgY3BfaXNfcnNhIGFuZCBub3QgcnNhX3Bzc19wYWRkaW5nOgogICAgICAgICAgICB2YWxpZF9oYXNoX2FsZ29yaXRobXNfZXJyb3IgKz0gJywgInJhdyInCiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGhhc2hfYWxnb3JpdGhtIG11c3QgYmUgb25lIG9mICVzLCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICB2YWxpZF9oYXNoX2FsZ29yaXRobXNfZXJyb3IsCiAgICAgICAgICAgIHJlcHIoaGFzaF9hbGdvcml0aG0pCiAgICAgICAgKSkKCiAgICBpZiBub3QgY3BfaXNfcnNhIGFuZCByc2FfcHNzX3BhZGRpbmcgaXMgbm90IEZhbHNlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBQU1MgcGFkZGluZyBtYXkgb25seSBiZSB1c2VkIHdpdGggUlNBIGtleXMgLSBzaWduaW5nIHZpYSBhICVzIGtleQogICAgICAgICAgICB3YXMgcmVxdWVzdGVkCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgY3BfYWxnLnVwcGVyKCkKICAgICAgICApKQoKICAgIGlmIGhhc2hfYWxnb3JpdGhtID09ICdyYXcnOgogICAgICAgIGlmIGxlbihkYXRhKSA+IGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXkuYnl0ZV9zaXplIC0gMTE6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIGRhdGEgbXVzdCBiZSAxMSBieXRlcyBzaG9ydGVyIHRoYW4gdGhlIGtleSBzaXplIHdoZW4KICAgICAgICAgICAgICAgIGhhc2hfYWxnb3JpdGhtIGlzICJyYXciIC0ga2V5IHNpemUgaXMgJXMgYnl0ZXMsIGJ1dAogICAgICAgICAgICAgICAgZGF0YSBpcyAlcyBieXRlcyBsb25nCiAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LmJ5dGVfc2l6ZSwKICAgICAgICAgICAgICAgIGxlbihkYXRhKQogICAgICAgICAgICApKQoKICAgIGlmIF9iYWNrZW5kID09ICd3aW5sZWdhY3knOgogICAgICAgIGlmIGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXkuYWxnb3JpdGhtID09ICdlYyc6CiAgICAgICAgICAgIHJldHVybiBfcHVyZV9weXRob25fZWNkc2FfdmVyaWZ5KGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXksIHNpZ25hdHVyZSwgZGF0YSwgaGFzaF9hbGdvcml0aG0pCiAgICAgICAgcmV0dXJuIF9hZHZhcGkzMl92ZXJpZnkoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgc2lnbmF0dXJlLCBkYXRhLCBoYXNoX2FsZ29yaXRobSwgcnNhX3Bzc19wYWRkaW5nKQogICAgcmV0dXJuIF9iY3J5cHRfdmVyaWZ5KGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXksIHNpZ25hdHVyZSwgZGF0YSwgaGFzaF9hbGdvcml0aG0sIHJzYV9wc3NfcGFkZGluZykKCgpkZWYgX2FkdmFwaTMyX3ZlcmlmeShjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LCBzaWduYXR1cmUsIGRhdGEsIGhhc2hfYWxnb3JpdGhtLCByc2FfcHNzX3BhZGRpbmc9RmFsc2UpOgogICAgIiIiCiAgICBWZXJpZmllcyBhbiBSU0EsIERTQSBvciBFQ0RTQSBzaWduYXR1cmUgdmlhIENyeXB0b0FQSQoKICAgIDpwYXJhbSBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5OgogICAgICAgIEEgQ2VydGlmaWNhdGUgb3IgUHVibGljS2V5IGluc3RhbmNlIHRvIHZlcmlmeSB0aGUgc2lnbmF0dXJlIHdpdGgKCiAgICA6cGFyYW0gc2lnbmF0dXJlOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHNpZ25hdHVyZSB0byB2ZXJpZnkKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBkYXRhIHRoZSBzaWduYXR1cmUgaXMgZm9yCgogICAgOnBhcmFtIGhhc2hfYWxnb3JpdGhtOgogICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgIm1kNSIsICJzaGExIiwgInNoYTI1NiIsICJzaGEzODQiLCAic2hhNTEyIiBvciAicmF3IgoKICAgIDpwYXJhbSByc2FfcHNzX3BhZGRpbmc6CiAgICAgICAgSWYgUFNTIHBhZGRpbmcgc2hvdWxkIGJlIHVzZWQgZm9yIFJTQSBrZXlzCgogICAgOnJhaXNlczoKICAgICAgICBvc2NyeXB0by5lcnJvcnMuU2lnbmF0dXJlRXJyb3IgLSB3aGVuIHRoZSBzaWduYXR1cmUgaXMgZGV0ZXJtaW5lZCB0byBiZSBpbnZhbGlkCiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQogICAgIiIiCgogICAgYWxnbyA9IGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXkuYWxnb3JpdGhtCiAgICBhbGdvX2lzX3JzYSA9IGFsZ28gPT0gJ3JzYScgb3IgYWxnbyA9PSAncnNhc3NhX3BzcycKCiAgICBpZiBhbGdvX2lzX3JzYSBhbmQgcnNhX3Bzc19wYWRkaW5nOgogICAgICAgIGhhc2hfbGVuZ3RoID0gewogICAgICAgICAgICAnc2hhMSc6IDIwLAogICAgICAgICAgICAnc2hhMjI0JzogMjgsCiAgICAgICAgICAgICdzaGEyNTYnOiAzMiwKICAgICAgICAgICAgJ3NoYTM4NCc6IDQ4LAogICAgICAgICAgICAnc2hhNTEyJzogNjQKICAgICAgICB9LmdldChoYXNoX2FsZ29yaXRobSwgMCkKICAgICAgICBkZWNyeXB0ZWRfc2lnbmF0dXJlID0gcmF3X3JzYV9wdWJsaWNfY3J5cHQoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgc2lnbmF0dXJlKQogICAgICAgIGtleV9zaXplID0gY2VydGlmaWNhdGVfb3JfcHVibGljX2tleS5iaXRfc2l6ZQogICAgICAgIGlmIG5vdCB2ZXJpZnlfcHNzX3BhZGRpbmcoaGFzaF9hbGdvcml0aG0sIGhhc2hfbGVuZ3RoLCBrZXlfc2l6ZSwgZGF0YSwgZGVjcnlwdGVkX3NpZ25hdHVyZSk6CiAgICAgICAgICAgIHJhaXNlIFNpZ25hdHVyZUVycm9yKCdTaWduYXR1cmUgaXMgaW52YWxpZCcpCiAgICAgICAgcmV0dXJuCgogICAgaWYgYWxnb19pc19yc2EgYW5kIGhhc2hfYWxnb3JpdGhtID09ICdyYXcnOgogICAgICAgIHBhZGRlZF9wbGFpbnRleHQgPSByYXdfcnNhX3B1YmxpY19jcnlwdChjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LCBzaWduYXR1cmUpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwbGFpbnRleHQgPSByZW1vdmVfcGtjczF2MTVfc2lnbmF0dXJlX3BhZGRpbmcoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleS5ieXRlX3NpemUsIHBhZGRlZF9wbGFpbnRleHQpCiAgICAgICAgICAgIGlmIG5vdCBjb25zdGFudF9jb21wYXJlKHBsYWludGV4dCwgZGF0YSk6CiAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCkKICAgICAgICBleGNlcHQgKFZhbHVlRXJyb3IpOgogICAgICAgICAgICByYWlzZSBTaWduYXR1cmVFcnJvcignU2lnbmF0dXJlIGlzIGludmFsaWQnKQogICAgICAgIHJldHVybgoKICAgIGhhc2hfaGFuZGxlID0gTm9uZQoKICAgIHRyeToKICAgICAgICBhbGdfaWQgPSB7CiAgICAgICAgICAgICdtZDUnOiBBZHZhcGkzMkNvbnN0LkNBTEdfTUQ1LAogICAgICAgICAgICAnc2hhMSc6IEFkdmFwaTMyQ29uc3QuQ0FMR19TSEExLAogICAgICAgICAgICAnc2hhMjU2JzogQWR2YXBpMzJDb25zdC5DQUxHX1NIQV8yNTYsCiAgICAgICAgICAgICdzaGEzODQnOiBBZHZhcGkzMkNvbnN0LkNBTEdfU0hBXzM4NCwKICAgICAgICAgICAgJ3NoYTUxMic6IEFkdmFwaTMyQ29uc3QuQ0FMR19TSEFfNTEyLAogICAgICAgIH1baGFzaF9hbGdvcml0aG1dCgogICAgICAgIGhhc2hfaGFuZGxlX3BvaW50ZXIgPSBuZXcoYWR2YXBpMzIsICdIQ1JZUFRIQVNIIConKQogICAgICAgIHJlcyA9IGFkdmFwaTMyLkNyeXB0Q3JlYXRlSGFzaCgKICAgICAgICAgICAgY2VydGlmaWNhdGVfb3JfcHVibGljX2tleS5jb250ZXh0X2hhbmRsZSwKICAgICAgICAgICAgYWxnX2lkLAogICAgICAgICAgICBudWxsKCksCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGhhc2hfaGFuZGxlX3BvaW50ZXIKICAgICAgICApCiAgICAgICAgaGFuZGxlX2Vycm9yKHJlcykKCiAgICAgICAgaGFzaF9oYW5kbGUgPSB1bndyYXAoaGFzaF9oYW5kbGVfcG9pbnRlcikKCiAgICAgICAgcmVzID0gYWR2YXBpMzIuQ3J5cHRIYXNoRGF0YShoYXNoX2hhbmRsZSwgZGF0YSwgbGVuKGRhdGEpLCAwKQogICAgICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgICAgIGlmIGFsZ28gPT0gJ2RzYSc6CiAgICAgICAgICAgICMgV2luZG93cyBkb2Vzbid0IHVzZSB0aGUgQVNOLjEgU2VxdWVuY2UgZm9yIERTQSBzaWduYXR1cmVzLAogICAgICAgICAgICAjIHNvIHdlIGhhdmUgdG8gY29udmVydCBpdCBoZXJlIGZvciB0aGUgdmVyaWZpY2F0aW9uIHRvIHdvcmsKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2lnbmF0dXJlID0gRFNBU2lnbmF0dXJlLmxvYWQoc2lnbmF0dXJlKS50b19wMTM2MygpCiAgICAgICAgICAgICAgICAjIFN3aXRjaCB0aGUgdHdvIGludGVnZXJzIHNvIHRoYXQgdGhlIHJldmVyc2FsIGxhdGVyIHdpbGwKICAgICAgICAgICAgICAgICMgcmVzdWx0IGluIHRoZSBjb3JyZWN0IG9yZGVyCiAgICAgICAgICAgICAgICBoYWxmX2xlbiA9IGxlbihzaWduYXR1cmUpIC8vIDIKICAgICAgICAgICAgICAgIHNpZ25hdHVyZSA9IHNpZ25hdHVyZVtoYWxmX2xlbjpdICsgc2lnbmF0dXJlWzpoYWxmX2xlbl0KICAgICAgICAgICAgZXhjZXB0IChWYWx1ZUVycm9yLCBPdmVyZmxvd0Vycm9yLCBUeXBlRXJyb3IpOgogICAgICAgICAgICAgICAgcmFpc2UgU2lnbmF0dXJlRXJyb3IoJ1NpZ25hdHVyZSBpcyBpbnZhbGlkJykKCiAgICAgICAgIyBUaGUgQ3J5cHRvQVBJIGV4cGVjdHMgc2lnbmF0dXJlcyB0byBiZSBpbiBsaXR0bGUgZW5kaWFuIGJ5dGUgb3JkZXIsCiAgICAgICAgIyB3aGljaCBpcyB0aGUgb3Bwb3NpdGUgb2Ygb3RoZXIgc3lzdGVtcywgc28gd2UgbXVzdCByZXZlcnNlIGl0CiAgICAgICAgcmV2ZXJzZWRfc2lnbmF0dXJlID0gc2lnbmF0dXJlWzo6LTFdCgogICAgICAgIHJlcyA9IGFkdmFwaTMyLkNyeXB0VmVyaWZ5U2lnbmF0dXJlVygKICAgICAgICAgICAgaGFzaF9oYW5kbGUsCiAgICAgICAgICAgIHJldmVyc2VkX3NpZ25hdHVyZSwKICAgICAgICAgICAgbGVuKHNpZ25hdHVyZSksCiAgICAgICAgICAgIGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXkua2V5X2hhbmRsZSwKICAgICAgICAgICAgbnVsbCgpLAogICAgICAgICAgICAwCiAgICAgICAgKQogICAgICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgZmluYWxseToKICAgICAgICBpZiBoYXNoX2hhbmRsZToKICAgICAgICAgICAgYWR2YXBpMzIuQ3J5cHREZXN0cm95SGFzaChoYXNoX2hhbmRsZSkKCgpkZWYgX2JjcnlwdF92ZXJpZnkoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgc2lnbmF0dXJlLCBkYXRhLCBoYXNoX2FsZ29yaXRobSwgcnNhX3Bzc19wYWRkaW5nPUZhbHNlKToKICAgICIiIgogICAgVmVyaWZpZXMgYW4gUlNBLCBEU0Egb3IgRUNEU0Egc2lnbmF0dXJlIHZpYSBDTkcKCiAgICA6cGFyYW0gY2VydGlmaWNhdGVfb3JfcHVibGljX2tleToKICAgICAgICBBIENlcnRpZmljYXRlIG9yIFB1YmxpY0tleSBpbnN0YW5jZSB0byB2ZXJpZnkgdGhlIHNpZ25hdHVyZSB3aXRoCgogICAgOnBhcmFtIHNpZ25hdHVyZToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBzaWduYXR1cmUgdG8gdmVyaWZ5CgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgZGF0YSB0aGUgc2lnbmF0dXJlIGlzIGZvcgoKICAgIDpwYXJhbSBoYXNoX2FsZ29yaXRobToKICAgICAgICBBIHVuaWNvZGUgc3RyaW5nIG9mICJtZDUiLCAic2hhMSIsICJzaGEyNTYiLCAic2hhMzg0IiwgInNoYTUxMiIgb3IgInJhdyIKCiAgICA6cGFyYW0gcnNhX3Bzc19wYWRkaW5nOgogICAgICAgIElmIFBTUyBwYWRkaW5nIHNob3VsZCBiZSB1c2VkIGZvciBSU0Ega2V5cwoKICAgIDpyYWlzZXM6CiAgICAgICAgb3NjcnlwdG8uZXJyb3JzLlNpZ25hdHVyZUVycm9yIC0gd2hlbiB0aGUgc2lnbmF0dXJlIGlzIGRldGVybWluZWQgdG8gYmUgaW52YWxpZAogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKICAgICIiIgoKICAgIGlmIGhhc2hfYWxnb3JpdGhtID09ICdyYXcnOgogICAgICAgIGRpZ2VzdCA9IGRhdGEKICAgIGVsc2U6CiAgICAgICAgaGFzaF9jb25zdGFudCA9IHsKICAgICAgICAgICAgJ21kNSc6IEJjcnlwdENvbnN0LkJDUllQVF9NRDVfQUxHT1JJVEhNLAogICAgICAgICAgICAnc2hhMSc6IEJjcnlwdENvbnN0LkJDUllQVF9TSEExX0FMR09SSVRITSwKICAgICAgICAgICAgJ3NoYTI1Nic6IEJjcnlwdENvbnN0LkJDUllQVF9TSEEyNTZfQUxHT1JJVEhNLAogICAgICAgICAgICAnc2hhMzg0JzogQmNyeXB0Q29uc3QuQkNSWVBUX1NIQTM4NF9BTEdPUklUSE0sCiAgICAgICAgICAgICdzaGE1MTInOiBCY3J5cHRDb25zdC5CQ1JZUFRfU0hBNTEyX0FMR09SSVRITQogICAgICAgIH1baGFzaF9hbGdvcml0aG1dCiAgICAgICAgZGlnZXN0ID0gZ2V0YXR0cihoYXNobGliLCBoYXNoX2FsZ29yaXRobSkoZGF0YSkuZGlnZXN0KCkKCiAgICBwYWRkaW5nX2luZm8gPSBudWxsKCkKICAgIGZsYWdzID0gMAoKICAgIGNwX2FsZyA9IGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXkuYWxnb3JpdGhtCiAgICBjcF9pc19yc2EgPSBjcF9hbGcgPT0gJ3JzYScgb3IgY3BfYWxnID09ICdyc2Fzc2FfcHNzJwoKICAgIGlmIGNwX2lzX3JzYToKICAgICAgICBpZiByc2FfcHNzX3BhZGRpbmc6CiAgICAgICAgICAgIGZsYWdzID0gQmNyeXB0Q29uc3QuQkNSWVBUX1BBRF9QU1MKICAgICAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdF9wb2ludGVyID0gc3RydWN0KGJjcnlwdCwgJ0JDUllQVF9QU1NfUEFERElOR19JTkZPJykKICAgICAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdCA9IHVud3JhcChwYWRkaW5nX2luZm9fc3RydWN0X3BvaW50ZXIpCiAgICAgICAgICAgICMgVGhpcyBoYXMgdG8gYmUgYXNzaWduZWQgdG8gYSB2YXJpYWJsZSB0byBwcmV2ZW50IGNmZmkgZnJvbSBnYydpbmcgaXQKICAgICAgICAgICAgaGFzaF9idWZmZXIgPSBidWZmZXJfZnJvbV91bmljb2RlKGhhc2hfY29uc3RhbnQpCiAgICAgICAgICAgIHBhZGRpbmdfaW5mb19zdHJ1Y3QucHN6QWxnSWQgPSBjYXN0KGJjcnlwdCwgJ3djaGFyX3QgKicsIGhhc2hfYnVmZmVyKQogICAgICAgICAgICBwYWRkaW5nX2luZm9fc3RydWN0LmNiU2FsdCA9IGxlbihkaWdlc3QpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZmxhZ3MgPSBCY3J5cHRDb25zdC5CQ1JZUFRfUEFEX1BLQ1MxCiAgICAgICAgICAgIHBhZGRpbmdfaW5mb19zdHJ1Y3RfcG9pbnRlciA9IHN0cnVjdChiY3J5cHQsICdCQ1JZUFRfUEtDUzFfUEFERElOR19JTkZPJykKICAgICAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdCA9IHVud3JhcChwYWRkaW5nX2luZm9fc3RydWN0X3BvaW50ZXIpCiAgICAgICAgICAgICMgVGhpcyBoYXMgdG8gYmUgYXNzaWduZWQgdG8gYSB2YXJpYWJsZSB0byBwcmV2ZW50IGNmZmkgZnJvbSBnYydpbmcgaXQKICAgICAgICAgICAgaWYgaGFzaF9hbGdvcml0aG0gPT0gJ3Jhdyc6CiAgICAgICAgICAgICAgICBwYWRkaW5nX2luZm9fc3RydWN0LnBzekFsZ0lkID0gbnVsbCgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBoYXNoX2J1ZmZlciA9IGJ1ZmZlcl9mcm9tX3VuaWNvZGUoaGFzaF9jb25zdGFudCkKICAgICAgICAgICAgICAgIHBhZGRpbmdfaW5mb19zdHJ1Y3QucHN6QWxnSWQgPSBjYXN0KGJjcnlwdCwgJ3djaGFyX3QgKicsIGhhc2hfYnVmZmVyKQogICAgICAgIHBhZGRpbmdfaW5mbyA9IGNhc3QoYmNyeXB0LCAndm9pZCAqJywgcGFkZGluZ19pbmZvX3N0cnVjdF9wb2ludGVyKQogICAgZWxzZToKICAgICAgICAjIFdpbmRvd3MgZG9lc24ndCB1c2UgdGhlIEFTTi4xIFNlcXVlbmNlIGZvciBEU0EvRUNEU0Egc2lnbmF0dXJlcywKICAgICAgICAjIHNvIHdlIGhhdmUgdG8gY29udmVydCBpdCBoZXJlIGZvciB0aGUgdmVyaWZpY2F0aW9uIHRvIHdvcmsKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNpZ25hdHVyZSA9IERTQVNpZ25hdHVyZS5sb2FkKHNpZ25hdHVyZSkudG9fcDEzNjMoKQogICAgICAgIGV4Y2VwdCAoVmFsdWVFcnJvciwgT3ZlcmZsb3dFcnJvciwgVHlwZUVycm9yKToKICAgICAgICAgICAgcmFpc2UgU2lnbmF0dXJlRXJyb3IoJ1NpZ25hdHVyZSBpcyBpbnZhbGlkJykKCiAgICByZXMgPSBiY3J5cHQuQkNyeXB0VmVyaWZ5U2lnbmF0dXJlKAogICAgICAgIGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXkua2V5X2hhbmRsZSwKICAgICAgICBwYWRkaW5nX2luZm8sCiAgICAgICAgZGlnZXN0LAogICAgICAgIGxlbihkaWdlc3QpLAogICAgICAgIHNpZ25hdHVyZSwKICAgICAgICBsZW4oc2lnbmF0dXJlKSwKICAgICAgICBmbGFncwogICAgKQogICAgZmFpbHVyZSA9IHJlcyA9PSBCY3J5cHRDb25zdC5TVEFUVVNfSU5WQUxJRF9TSUdOQVRVUkUKICAgIGZhaWx1cmUgPSBmYWlsdXJlIG9yIHJlcyA9PSBCY3J5cHRDb25zdC5TVEFUVVNfSU5WQUxJRF9QQVJBTUVURVIKICAgIGlmIGZhaWx1cmU6CiAgICAgICAgcmFpc2UgU2lnbmF0dXJlRXJyb3IoJ1NpZ25hdHVyZSBpcyBpbnZhbGlkJykKCiAgICBoYW5kbGVfZXJyb3IocmVzKQoKCmRlZiByc2FfcGtjczF2MTVfc2lnbihwcml2YXRlX2tleSwgZGF0YSwgaGFzaF9hbGdvcml0aG0pOgogICAgIiIiCiAgICBHZW5lcmF0ZXMgYW4gUlNBU1NBLVBLQ1MtdjEuNSBzaWduYXR1cmUuCgogICAgV2hlbiB0aGUgaGFzaF9hbGdvcml0aG0gaXMgInJhdyIsIHRoZSBvcGVyYXRpb24gaXMgaWRlbnRpY2FsIHRvIFJTQQogICAgcHJpdmF0ZSBrZXkgZW5jcnlwdGlvbi4gVGhhdCBpczogdGhlIGRhdGEgaXMgbm90IGhhc2hlZCBhbmQgbm8gQVNOLjEKICAgIHN0cnVjdHVyZSB3aXRoIGFuIGFsZ29yaXRobSBpZGVudGlmaWVyIG9mIHRoZSBoYXNoIGFsZ29yaXRobSBpcyBwbGFjZWQgaW4KICAgIHRoZSBlbmNyeXB0ZWQgYnl0ZSBzdHJpbmcuCgogICAgOnBhcmFtIHByaXZhdGVfa2V5OgogICAgICAgIFRoZSBQcml2YXRlS2V5IHRvIGdlbmVyYXRlIHRoZSBzaWduYXR1cmUgd2l0aAoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGRhdGEgdGhlIHNpZ25hdHVyZSBpcyBmb3IKCiAgICA6cGFyYW0gaGFzaF9hbGdvcml0aG06CiAgICAgICAgQSB1bmljb2RlIHN0cmluZyBvZiAibWQ1IiwgInNoYTEiLCAic2hhMjU2IiwgInNoYTM4NCIsICJzaGE1MTIiIG9yICJyYXciCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBzaWduYXR1cmUKICAgICIiIgoKICAgIGlmIHByaXZhdGVfa2V5LmFsZ29yaXRobSAhPSAncnNhJzoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdUaGUga2V5IHNwZWNpZmllZCBpcyBub3QgYW4gUlNBIHByaXZhdGUga2V5JykKCiAgICByZXR1cm4gX3NpZ24ocHJpdmF0ZV9rZXksIGRhdGEsIGhhc2hfYWxnb3JpdGhtKQoKCmRlZiByc2FfcHNzX3NpZ24ocHJpdmF0ZV9rZXksIGRhdGEsIGhhc2hfYWxnb3JpdGhtKToKICAgICIiIgogICAgR2VuZXJhdGVzIGFuIFJTQVNTQS1QU1Mgc2lnbmF0dXJlLiBGb3IgdGhlIFBTUyBwYWRkaW5nIHRoZSBtYXNrIGdlbgogICAgYWxnb3JpdGhtIHdpbGwgYmUgbWdmMSB1c2luZyB0aGUgc2FtZSBoYXNoIGFsZ29yaXRobSBhcyB0aGUgc2lnbmF0dXJlLiBUaGUKICAgIHNhbHQgbGVuZ3RoIHdpdGggYmUgdGhlIGxlbmd0aCBvZiB0aGUgaGFzaCBhbGdvcml0aG0sIGFuZCB0aGUgdHJhaWxlciBmaWVsZAogICAgd2l0aCBiZSB0aGUgc3RhbmRhcmQgMHhCQyBieXRlLgoKICAgIDpwYXJhbSBwcml2YXRlX2tleToKICAgICAgICBUaGUgUHJpdmF0ZUtleSB0byBnZW5lcmF0ZSB0aGUgc2lnbmF0dXJlIHdpdGgKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBkYXRhIHRoZSBzaWduYXR1cmUgaXMgZm9yCgogICAgOnBhcmFtIGhhc2hfYWxnb3JpdGhtOgogICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgIm1kNSIsICJzaGExIiwgInNoYTI1NiIsICJzaGEzODQiIG9yICJzaGE1MTIiCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBzaWduYXR1cmUKICAgICIiIgoKICAgIHBrZXlfYWxnID0gcHJpdmF0ZV9rZXkuYWxnb3JpdGhtCgogICAgaWYgcGtleV9hbGcgIT0gJ3JzYScgYW5kIHBrZXlfYWxnICE9ICdyc2Fzc2FfcHNzJzoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdUaGUga2V5IHNwZWNpZmllZCBpcyBub3QgYW4gUlNBIHByaXZhdGUga2V5JykKCiAgICByZXR1cm4gX3NpZ24ocHJpdmF0ZV9rZXksIGRhdGEsIGhhc2hfYWxnb3JpdGhtLCByc2FfcHNzX3BhZGRpbmc9VHJ1ZSkKCgpkZWYgZHNhX3NpZ24ocHJpdmF0ZV9rZXksIGRhdGEsIGhhc2hfYWxnb3JpdGhtKToKICAgICIiIgogICAgR2VuZXJhdGVzIGEgRFNBIHNpZ25hdHVyZQoKICAgIDpwYXJhbSBwcml2YXRlX2tleToKICAgICAgICBUaGUgUHJpdmF0ZUtleSB0byBnZW5lcmF0ZSB0aGUgc2lnbmF0dXJlIHdpdGgKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBkYXRhIHRoZSBzaWduYXR1cmUgaXMgZm9yCgogICAgOnBhcmFtIGhhc2hfYWxnb3JpdGhtOgogICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgIm1kNSIsICJzaGExIiwgInNoYTI1NiIsICJzaGEzODQiIG9yICJzaGE1MTIiCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBzaWduYXR1cmUKICAgICIiIgoKICAgIGlmIHByaXZhdGVfa2V5LmFsZ29yaXRobSAhPSAnZHNhJzoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdUaGUga2V5IHNwZWNpZmllZCBpcyBub3QgYSBEU0EgcHJpdmF0ZSBrZXknKQoKICAgIHJldHVybiBfc2lnbihwcml2YXRlX2tleSwgZGF0YSwgaGFzaF9hbGdvcml0aG0pCgoKZGVmIGVjZHNhX3NpZ24ocHJpdmF0ZV9rZXksIGRhdGEsIGhhc2hfYWxnb3JpdGhtKToKICAgICIiIgogICAgR2VuZXJhdGVzIGFuIEVDRFNBIHNpZ25hdHVyZQoKICAgIDpwYXJhbSBwcml2YXRlX2tleToKICAgICAgICBUaGUgUHJpdmF0ZUtleSB0byBnZW5lcmF0ZSB0aGUgc2lnbmF0dXJlIHdpdGgKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBkYXRhIHRoZSBzaWduYXR1cmUgaXMgZm9yCgogICAgOnBhcmFtIGhhc2hfYWxnb3JpdGhtOgogICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgIm1kNSIsICJzaGExIiwgInNoYTI1NiIsICJzaGEzODQiIG9yICJzaGE1MTIiCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBzaWduYXR1cmUKICAgICIiIgoKICAgIGlmIHByaXZhdGVfa2V5LmFsZ29yaXRobSAhPSAnZWMnOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ1RoZSBrZXkgc3BlY2lmaWVkIGlzIG5vdCBhbiBFQyBwcml2YXRlIGtleScpCgogICAgcmV0dXJuIF9zaWduKHByaXZhdGVfa2V5LCBkYXRhLCBoYXNoX2FsZ29yaXRobSkKCgpkZWYgX3NpZ24ocHJpdmF0ZV9rZXksIGRhdGEsIGhhc2hfYWxnb3JpdGhtLCByc2FfcHNzX3BhZGRpbmc9RmFsc2UpOgogICAgIiIiCiAgICBHZW5lcmF0ZXMgYW4gUlNBLCBEU0Egb3IgRUNEU0Egc2lnbmF0dXJlCgogICAgOnBhcmFtIHByaXZhdGVfa2V5OgogICAgICAgIFRoZSBQcml2YXRlS2V5IHRvIGdlbmVyYXRlIHRoZSBzaWduYXR1cmUgd2l0aAoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGRhdGEgdGhlIHNpZ25hdHVyZSBpcyBmb3IKCiAgICA6cGFyYW0gaGFzaF9hbGdvcml0aG06CiAgICAgICAgQSB1bmljb2RlIHN0cmluZyBvZiAibWQ1IiwgInNoYTEiLCAic2hhMjU2IiwgInNoYTM4NCIsICJzaGE1MTIiIG9yICJyYXciCgogICAgOnBhcmFtIHJzYV9wc3NfcGFkZGluZzoKICAgICAgICBJZiBQU1MgcGFkZGluZyBzaG91bGQgYmUgdXNlZCBmb3IgUlNBIGtleXMKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSB0aGUgT1MgY3J5cHRvIGxpYnJhcnkKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHNpZ25hdHVyZQogICAgIiIiCgogICAgaWYgbm90IGlzaW5zdGFuY2UocHJpdmF0ZV9rZXksIFByaXZhdGVLZXkpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIHByaXZhdGVfa2V5IG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgUHJpdmF0ZUtleSwgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKHByaXZhdGVfa2V5KQogICAgICAgICkpCgogICAgaWYgbm90IGlzaW5zdGFuY2UoZGF0YSwgYnl0ZV9jbHMpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGRhdGEgbXVzdCBiZSBhIGJ5dGUgc3RyaW5nLCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICB0eXBlX25hbWUoZGF0YSkKICAgICAgICApKQoKICAgIHBrZXlfYWxnID0gcHJpdmF0ZV9rZXkuYWxnb3JpdGhtCiAgICBwa2V5X2lzX3JzYSA9IHBrZXlfYWxnID09ICdyc2EnIG9yIHBrZXlfYWxnID09ICdyc2Fzc2FfcHNzJwoKICAgIHZhbGlkX2hhc2hfYWxnb3JpdGhtcyA9IHNldChbJ21kNScsICdzaGExJywgJ3NoYTI1NicsICdzaGEzODQnLCAnc2hhNTEyJ10pCiAgICBpZiBwcml2YXRlX2tleS5hbGdvcml0aG0gPT0gJ3JzYScgYW5kIG5vdCByc2FfcHNzX3BhZGRpbmc6CiAgICAgICAgdmFsaWRfaGFzaF9hbGdvcml0aG1zIHw9IHNldChbJ3JhdyddKQoKICAgIGlmIGhhc2hfYWxnb3JpdGhtIG5vdCBpbiB2YWxpZF9oYXNoX2FsZ29yaXRobXM6CiAgICAgICAgdmFsaWRfaGFzaF9hbGdvcml0aG1zX2Vycm9yID0gJyJtZDUiLCAic2hhMSIsICJzaGEyNTYiLCAic2hhMzg0IiwgInNoYTUxMiInCiAgICAgICAgaWYgcGtleV9pc19yc2EgYW5kIG5vdCByc2FfcHNzX3BhZGRpbmc6CiAgICAgICAgICAgIHZhbGlkX2hhc2hfYWxnb3JpdGhtc19lcnJvciArPSAnLCAicmF3IicKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgaGFzaF9hbGdvcml0aG0gbXVzdCBiZSBvbmUgb2YgJXMsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHZhbGlkX2hhc2hfYWxnb3JpdGhtc19lcnJvciwKICAgICAgICAgICAgcmVwcihoYXNoX2FsZ29yaXRobSkKICAgICAgICApKQoKICAgIGlmIG5vdCBwa2V5X2lzX3JzYSBhbmQgcnNhX3Bzc19wYWRkaW5nIGlzIG5vdCBGYWxzZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgUFNTIHBhZGRpbmcgbWF5IG9ubHkgYmUgdXNlZCB3aXRoIFJTQSBrZXlzIC0gc2lnbmluZyB2aWEgYSAlcyBrZXkKICAgICAgICAgICAgd2FzIHJlcXVlc3RlZAogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHBrZXlfYWxnLnVwcGVyKCkKICAgICAgICApKQoKICAgIGlmIGhhc2hfYWxnb3JpdGhtID09ICdyYXcnOgogICAgICAgIGlmIGxlbihkYXRhKSA+IHByaXZhdGVfa2V5LmJ5dGVfc2l6ZSAtIDExOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBkYXRhIG11c3QgYmUgMTEgYnl0ZXMgc2hvcnRlciB0aGFuIHRoZSBrZXkgc2l6ZSB3aGVuCiAgICAgICAgICAgICAgICBoYXNoX2FsZ29yaXRobSBpcyAicmF3IiAtIGtleSBzaXplIGlzICVzIGJ5dGVzLCBidXQgZGF0YQogICAgICAgICAgICAgICAgaXMgJXMgYnl0ZXMgbG9uZwogICAgICAgICAgICAgICAgJycnLAogICAgICAgICAgICAgICAgcHJpdmF0ZV9rZXkuYnl0ZV9zaXplLAogICAgICAgICAgICAgICAgbGVuKGRhdGEpCiAgICAgICAgICAgICkpCgogICAgaWYgX2JhY2tlbmQgPT0gJ3dpbmxlZ2FjeSc6CiAgICAgICAgaWYgcHJpdmF0ZV9rZXkuYWxnb3JpdGhtID09ICdlYyc6CiAgICAgICAgICAgIHJldHVybiBfcHVyZV9weXRob25fZWNkc2Ffc2lnbihwcml2YXRlX2tleSwgZGF0YSwgaGFzaF9hbGdvcml0aG0pCiAgICAgICAgcmV0dXJuIF9hZHZhcGkzMl9zaWduKHByaXZhdGVfa2V5LCBkYXRhLCBoYXNoX2FsZ29yaXRobSwgcnNhX3Bzc19wYWRkaW5nKQogICAgcmV0dXJuIF9iY3J5cHRfc2lnbihwcml2YXRlX2tleSwgZGF0YSwgaGFzaF9hbGdvcml0aG0sIHJzYV9wc3NfcGFkZGluZykKCgpkZWYgX2FkdmFwaTMyX3NpZ24ocHJpdmF0ZV9rZXksIGRhdGEsIGhhc2hfYWxnb3JpdGhtLCByc2FfcHNzX3BhZGRpbmc9RmFsc2UpOgogICAgIiIiCiAgICBHZW5lcmF0ZXMgYW4gUlNBLCBEU0Egb3IgRUNEU0Egc2lnbmF0dXJlIHZpYSBDcnlwdG9BUEkKCiAgICA6cGFyYW0gcHJpdmF0ZV9rZXk6CiAgICAgICAgVGhlIFByaXZhdGVLZXkgdG8gZ2VuZXJhdGUgdGhlIHNpZ25hdHVyZSB3aXRoCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgZGF0YSB0aGUgc2lnbmF0dXJlIGlzIGZvcgoKICAgIDpwYXJhbSBoYXNoX2FsZ29yaXRobToKICAgICAgICBBIHVuaWNvZGUgc3RyaW5nIG9mICJtZDUiLCAic2hhMSIsICJzaGEyNTYiLCAic2hhMzg0IiwgInNoYTUxMiIgb3IgInJhdyIKCiAgICA6cGFyYW0gcnNhX3Bzc19wYWRkaW5nOgogICAgICAgIElmIFBTUyBwYWRkaW5nIHNob3VsZCBiZSB1c2VkIGZvciBSU0Ega2V5cwoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgc2lnbmF0dXJlCiAgICAiIiIKCiAgICBhbGdvID0gcHJpdmF0ZV9rZXkuYWxnb3JpdGhtCiAgICBhbGdvX2lzX3JzYSA9IGFsZ28gPT0gJ3JzYScgb3IgYWxnbyA9PSAncnNhc3NhX3BzcycKCiAgICBpZiBhbGdvX2lzX3JzYSBhbmQgaGFzaF9hbGdvcml0aG0gPT0gJ3Jhdyc6CiAgICAgICAgcGFkZGVkX2RhdGEgPSBhZGRfcGtjczF2MTVfc2lnbmF0dXJlX3BhZGRpbmcocHJpdmF0ZV9rZXkuYnl0ZV9zaXplLCBkYXRhKQogICAgICAgIHJldHVybiByYXdfcnNhX3ByaXZhdGVfY3J5cHQocHJpdmF0ZV9rZXksIHBhZGRlZF9kYXRhKQoKICAgIGlmIGFsZ29faXNfcnNhIGFuZCByc2FfcHNzX3BhZGRpbmc6CiAgICAgICAgaGFzaF9sZW5ndGggPSB7CiAgICAgICAgICAgICdzaGExJzogMjAsCiAgICAgICAgICAgICdzaGEyMjQnOiAyOCwKICAgICAgICAgICAgJ3NoYTI1Nic6IDMyLAogICAgICAgICAgICAnc2hhMzg0JzogNDgsCiAgICAgICAgICAgICdzaGE1MTInOiA2NAogICAgICAgIH0uZ2V0KGhhc2hfYWxnb3JpdGhtLCAwKQogICAgICAgIHBhZGRlZF9kYXRhID0gYWRkX3Bzc19wYWRkaW5nKGhhc2hfYWxnb3JpdGhtLCBoYXNoX2xlbmd0aCwgcHJpdmF0ZV9rZXkuYml0X3NpemUsIGRhdGEpCiAgICAgICAgcmV0dXJuIHJhd19yc2FfcHJpdmF0ZV9jcnlwdChwcml2YXRlX2tleSwgcGFkZGVkX2RhdGEpCgogICAgaWYgcHJpdmF0ZV9rZXkuYWxnb3JpdGhtID09ICdkc2EnIGFuZCBoYXNoX2FsZ29yaXRobSA9PSAnbWQ1JzoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgV2luZG93cyBkb2VzIG5vdCBzdXBwb3J0IG1kNSBzaWduYXR1cmVzIHdpdGggRFNBIGtleXMKICAgICAgICAgICAgJycnCiAgICAgICAgKSkKCiAgICBoYXNoX2hhbmRsZSA9IE5vbmUKCiAgICB0cnk6CiAgICAgICAgYWxnX2lkID0gewogICAgICAgICAgICAnbWQ1JzogQWR2YXBpMzJDb25zdC5DQUxHX01ENSwKICAgICAgICAgICAgJ3NoYTEnOiBBZHZhcGkzMkNvbnN0LkNBTEdfU0hBMSwKICAgICAgICAgICAgJ3NoYTI1Nic6IEFkdmFwaTMyQ29uc3QuQ0FMR19TSEFfMjU2LAogICAgICAgICAgICAnc2hhMzg0JzogQWR2YXBpMzJDb25zdC5DQUxHX1NIQV8zODQsCiAgICAgICAgICAgICdzaGE1MTInOiBBZHZhcGkzMkNvbnN0LkNBTEdfU0hBXzUxMiwKICAgICAgICB9W2hhc2hfYWxnb3JpdGhtXQoKICAgICAgICBoYXNoX2hhbmRsZV9wb2ludGVyID0gbmV3KGFkdmFwaTMyLCAnSENSWVBUSEFTSCAqJykKICAgICAgICByZXMgPSBhZHZhcGkzMi5DcnlwdENyZWF0ZUhhc2goCiAgICAgICAgICAgIHByaXZhdGVfa2V5LmNvbnRleHRfaGFuZGxlLAogICAgICAgICAgICBhbGdfaWQsCiAgICAgICAgICAgIG51bGwoKSwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgaGFzaF9oYW5kbGVfcG9pbnRlcgogICAgICAgICkKICAgICAgICBoYW5kbGVfZXJyb3IocmVzKQoKICAgICAgICBoYXNoX2hhbmRsZSA9IHVud3JhcChoYXNoX2hhbmRsZV9wb2ludGVyKQoKICAgICAgICByZXMgPSBhZHZhcGkzMi5DcnlwdEhhc2hEYXRhKGhhc2hfaGFuZGxlLCBkYXRhLCBsZW4oZGF0YSksIDApCiAgICAgICAgaGFuZGxlX2Vycm9yKHJlcykKCiAgICAgICAgb3V0X2xlbiA9IG5ldyhhZHZhcGkzMiwgJ0RXT1JEIConKQogICAgICAgIHJlcyA9IGFkdmFwaTMyLkNyeXB0U2lnbkhhc2hXKAogICAgICAgICAgICBoYXNoX2hhbmRsZSwKICAgICAgICAgICAgQWR2YXBpMzJDb25zdC5BVF9TSUdOQVRVUkUsCiAgICAgICAgICAgIG51bGwoKSwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgbnVsbCgpLAogICAgICAgICAgICBvdXRfbGVuCiAgICAgICAgKQogICAgICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgICAgIGJ1ZmZlcl9sZW5ndGggPSBkZXJlZihvdXRfbGVuKQogICAgICAgIGJ1ZmZlcl8gPSBidWZmZXJfZnJvbV9ieXRlcyhidWZmZXJfbGVuZ3RoKQoKICAgICAgICByZXMgPSBhZHZhcGkzMi5DcnlwdFNpZ25IYXNoVygKICAgICAgICAgICAgaGFzaF9oYW5kbGUsCiAgICAgICAgICAgIEFkdmFwaTMyQ29uc3QuQVRfU0lHTkFUVVJFLAogICAgICAgICAgICBudWxsKCksCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGJ1ZmZlcl8sCiAgICAgICAgICAgIG91dF9sZW4KICAgICAgICApCiAgICAgICAgaGFuZGxlX2Vycm9yKHJlcykKCiAgICAgICAgb3V0cHV0ID0gYnl0ZXNfZnJvbV9idWZmZXIoYnVmZmVyXywgZGVyZWYob3V0X2xlbikpCgogICAgICAgICMgQ3J5cHRvQVBJIG91dHB1dHMgdGhlIHNpZ25hdHVyZSBpbiBsaXR0bGUgZW5kaWFuIGJ5dGUgb3JkZXIsIHNvIHdlCiAgICAgICAgIyBtdXN0IHN3YXAgaXQgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBvdGhlciBzeXN0ZW1zCiAgICAgICAgb3V0cHV0ID0gb3V0cHV0Wzo6LTFdCgogICAgICAgIGlmIGFsZ28gPT0gJ2RzYSc6CiAgICAgICAgICAgICMgU3dpdGNoIHRoZSB0d28gaW50ZWdlcnMgYmVjYXVzZSB0aGUgcmV2ZXJzYWwganVzdCBiZWZvcmUgc3dpdGNoZWQKICAgICAgICAgICAgIyB0aGVuCiAgICAgICAgICAgIGhhbGZfbGVuID0gbGVuKG91dHB1dCkgLy8gMgogICAgICAgICAgICBvdXRwdXQgPSBvdXRwdXRbaGFsZl9sZW46XSArIG91dHB1dFs6aGFsZl9sZW5dCiAgICAgICAgICAgICMgV2luZG93cyBkb2Vzbid0IHVzZSB0aGUgQVNOLjEgU2VxdWVuY2UgZm9yIERTQSBzaWduYXR1cmVzLAogICAgICAgICAgICAjIHNvIHdlIGhhdmUgdG8gY29udmVydCBpdCBoZXJlIGZvciB0aGUgdmVyaWZpY2F0aW9uIHRvIHdvcmsKICAgICAgICAgICAgb3V0cHV0ID0gRFNBU2lnbmF0dXJlLmZyb21fcDEzNjMob3V0cHV0KS5kdW1wKCkKCiAgICAgICAgcmV0dXJuIG91dHB1dAoKICAgIGZpbmFsbHk6CiAgICAgICAgaWYgaGFzaF9oYW5kbGU6CiAgICAgICAgICAgIGFkdmFwaTMyLkNyeXB0RGVzdHJveUhhc2goaGFzaF9oYW5kbGUpCgoKZGVmIF9iY3J5cHRfc2lnbihwcml2YXRlX2tleSwgZGF0YSwgaGFzaF9hbGdvcml0aG0sIHJzYV9wc3NfcGFkZGluZz1GYWxzZSk6CiAgICAiIiIKICAgIEdlbmVyYXRlcyBhbiBSU0EsIERTQSBvciBFQ0RTQSBzaWduYXR1cmUgdmlhIENORwoKICAgIDpwYXJhbSBwcml2YXRlX2tleToKICAgICAgICBUaGUgUHJpdmF0ZUtleSB0byBnZW5lcmF0ZSB0aGUgc2lnbmF0dXJlIHdpdGgKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBkYXRhIHRoZSBzaWduYXR1cmUgaXMgZm9yCgogICAgOnBhcmFtIGhhc2hfYWxnb3JpdGhtOgogICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgIm1kNSIsICJzaGExIiwgInNoYTI1NiIsICJzaGEzODQiLCAic2hhNTEyIiBvciAicmF3IgoKICAgIDpwYXJhbSByc2FfcHNzX3BhZGRpbmc6CiAgICAgICAgSWYgUFNTIHBhZGRpbmcgc2hvdWxkIGJlIHVzZWQgZm9yIFJTQSBrZXlzCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBzaWduYXR1cmUKICAgICIiIgoKICAgIGlmIGhhc2hfYWxnb3JpdGhtID09ICdyYXcnOgogICAgICAgIGRpZ2VzdCA9IGRhdGEKICAgIGVsc2U6CiAgICAgICAgaGFzaF9jb25zdGFudCA9IHsKICAgICAgICAgICAgJ21kNSc6IEJjcnlwdENvbnN0LkJDUllQVF9NRDVfQUxHT1JJVEhNLAogICAgICAgICAgICAnc2hhMSc6IEJjcnlwdENvbnN0LkJDUllQVF9TSEExX0FMR09SSVRITSwKICAgICAgICAgICAgJ3NoYTI1Nic6IEJjcnlwdENvbnN0LkJDUllQVF9TSEEyNTZfQUxHT1JJVEhNLAogICAgICAgICAgICAnc2hhMzg0JzogQmNyeXB0Q29uc3QuQkNSWVBUX1NIQTM4NF9BTEdPUklUSE0sCiAgICAgICAgICAgICdzaGE1MTInOiBCY3J5cHRDb25zdC5CQ1JZUFRfU0hBNTEyX0FMR09SSVRITQogICAgICAgIH1baGFzaF9hbGdvcml0aG1dCgogICAgICAgIGRpZ2VzdCA9IGdldGF0dHIoaGFzaGxpYiwgaGFzaF9hbGdvcml0aG0pKGRhdGEpLmRpZ2VzdCgpCgogICAgcGFkZGluZ19pbmZvID0gbnVsbCgpCiAgICBmbGFncyA9IDAKCiAgICBwa2V5X2FsZyA9IHByaXZhdGVfa2V5LmFsZ29yaXRobQogICAgcGtleV9pc19yc2EgPSBwa2V5X2FsZyA9PSAncnNhJyBvciBwa2V5X2FsZyA9PSAncnNhc3NhX3BzcycKCiAgICBpZiBwa2V5X2lzX3JzYToKICAgICAgICBpZiByc2FfcHNzX3BhZGRpbmc6CiAgICAgICAgICAgIGhhc2hfbGVuZ3RoID0gewogICAgICAgICAgICAgICAgJ21kNSc6IDE2LAogICAgICAgICAgICAgICAgJ3NoYTEnOiAyMCwKICAgICAgICAgICAgICAgICdzaGEyNTYnOiAzMiwKICAgICAgICAgICAgICAgICdzaGEzODQnOiA0OCwKICAgICAgICAgICAgICAgICdzaGE1MTInOiA2NAogICAgICAgICAgICB9W2hhc2hfYWxnb3JpdGhtXQoKICAgICAgICAgICAgZmxhZ3MgPSBCY3J5cHRDb25zdC5CQ1JZUFRfUEFEX1BTUwogICAgICAgICAgICBwYWRkaW5nX2luZm9fc3RydWN0X3BvaW50ZXIgPSBzdHJ1Y3QoYmNyeXB0LCAnQkNSWVBUX1BTU19QQURESU5HX0lORk8nKQogICAgICAgICAgICBwYWRkaW5nX2luZm9fc3RydWN0ID0gdW53cmFwKHBhZGRpbmdfaW5mb19zdHJ1Y3RfcG9pbnRlcikKICAgICAgICAgICAgIyBUaGlzIGhhcyB0byBiZSBhc3NpZ25lZCB0byBhIHZhcmlhYmxlIHRvIHByZXZlbnQgY2ZmaSBmcm9tIGdjJ2luZyBpdAogICAgICAgICAgICBoYXNoX2J1ZmZlciA9IGJ1ZmZlcl9mcm9tX3VuaWNvZGUoaGFzaF9jb25zdGFudCkKICAgICAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdC5wc3pBbGdJZCA9IGNhc3QoYmNyeXB0LCAnd2NoYXJfdCAqJywgaGFzaF9idWZmZXIpCiAgICAgICAgICAgIHBhZGRpbmdfaW5mb19zdHJ1Y3QuY2JTYWx0ID0gaGFzaF9sZW5ndGgKICAgICAgICBlbHNlOgogICAgICAgICAgICBmbGFncyA9IEJjcnlwdENvbnN0LkJDUllQVF9QQURfUEtDUzEKICAgICAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdF9wb2ludGVyID0gc3RydWN0KGJjcnlwdCwgJ0JDUllQVF9QS0NTMV9QQURESU5HX0lORk8nKQogICAgICAgICAgICBwYWRkaW5nX2luZm9fc3RydWN0ID0gdW53cmFwKHBhZGRpbmdfaW5mb19zdHJ1Y3RfcG9pbnRlcikKICAgICAgICAgICAgIyBUaGlzIGhhcyB0byBiZSBhc3NpZ25lZCB0byBhIHZhcmlhYmxlIHRvIHByZXZlbnQgY2ZmaSBmcm9tIGdjJ2luZyBpdAogICAgICAgICAgICBpZiBoYXNoX2FsZ29yaXRobSA9PSAncmF3JzoKICAgICAgICAgICAgICAgIHBhZGRpbmdfaW5mb19zdHJ1Y3QucHN6QWxnSWQgPSBudWxsKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGhhc2hfYnVmZmVyID0gYnVmZmVyX2Zyb21fdW5pY29kZShoYXNoX2NvbnN0YW50KQogICAgICAgICAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdC5wc3pBbGdJZCA9IGNhc3QoYmNyeXB0LCAnd2NoYXJfdCAqJywgaGFzaF9idWZmZXIpCiAgICAgICAgcGFkZGluZ19pbmZvID0gY2FzdChiY3J5cHQsICd2b2lkIConLCBwYWRkaW5nX2luZm9fc3RydWN0X3BvaW50ZXIpCgogICAgaWYgcGtleV9hbGcgPT0gJ2RzYScgYW5kIHByaXZhdGVfa2V5LmJpdF9zaXplID4gMTAyNCBhbmQgaGFzaF9hbGdvcml0aG0gaW4gc2V0KFsnbWQ1JywgJ3NoYTEnXSk6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIFdpbmRvd3MgZG9lcyBub3Qgc3VwcG9ydCBzaGExIHNpZ25hdHVyZXMgd2l0aCBEU0Ega2V5cyBiYXNlZCBvbgogICAgICAgICAgICBzaGEyMjQsIHNoYTI1NiBvciBzaGE1MTIKICAgICAgICAgICAgJycnCiAgICAgICAgKSkKCiAgICBvdXRfbGVuID0gbmV3KGJjcnlwdCwgJ0RXT1JEIConKQogICAgcmVzID0gYmNyeXB0LkJDcnlwdFNpZ25IYXNoKAogICAgICAgIHByaXZhdGVfa2V5LmtleV9oYW5kbGUsCiAgICAgICAgcGFkZGluZ19pbmZvLAogICAgICAgIGRpZ2VzdCwKICAgICAgICBsZW4oZGlnZXN0KSwKICAgICAgICBudWxsKCksCiAgICAgICAgMCwKICAgICAgICBvdXRfbGVuLAogICAgICAgIGZsYWdzCiAgICApCiAgICBoYW5kbGVfZXJyb3IocmVzKQoKICAgIGJ1ZmZlcl9sZW4gPSBkZXJlZihvdXRfbGVuKQogICAgYnVmZmVyID0gYnVmZmVyX2Zyb21fYnl0ZXMoYnVmZmVyX2xlbikKCiAgICBpZiBwa2V5X2lzX3JzYToKICAgICAgICBwYWRkaW5nX2luZm8gPSBjYXN0KGJjcnlwdCwgJ3ZvaWQgKicsIHBhZGRpbmdfaW5mb19zdHJ1Y3RfcG9pbnRlcikKCiAgICByZXMgPSBiY3J5cHQuQkNyeXB0U2lnbkhhc2goCiAgICAgICAgcHJpdmF0ZV9rZXkua2V5X2hhbmRsZSwKICAgICAgICBwYWRkaW5nX2luZm8sCiAgICAgICAgZGlnZXN0LAogICAgICAgIGxlbihkaWdlc3QpLAogICAgICAgIGJ1ZmZlciwKICAgICAgICBidWZmZXJfbGVuLAogICAgICAgIG91dF9sZW4sCiAgICAgICAgZmxhZ3MKICAgICkKICAgIGhhbmRsZV9lcnJvcihyZXMpCiAgICBzaWduYXR1cmUgPSBieXRlc19mcm9tX2J1ZmZlcihidWZmZXIsIGRlcmVmKG91dF9sZW4pKQoKICAgIGlmIG5vdCBwa2V5X2lzX3JzYToKICAgICAgICAjIFdpbmRvd3MgZG9lc24ndCB1c2UgdGhlIEFTTi4xIFNlcXVlbmNlIGZvciBEU0EvRUNEU0Egc2lnbmF0dXJlcywKICAgICAgICAjIHNvIHdlIGhhdmUgdG8gY29udmVydCBpdCBoZXJlIGZvciB0aGUgdmVyaWZpY2F0aW9uIHRvIHdvcmsKICAgICAgICBzaWduYXR1cmUgPSBEU0FTaWduYXR1cmUuZnJvbV9wMTM2MyhzaWduYXR1cmUpLmR1bXAoKQoKICAgIHJldHVybiBzaWduYXR1cmUKCgpkZWYgX2VuY3J5cHQoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgZGF0YSwgcnNhX29hZXBfcGFkZGluZz1GYWxzZSk6CiAgICAiIiIKICAgIEVuY3J5cHRzIGEgdmFsdWUgdXNpbmcgYW4gUlNBIHB1YmxpYyBrZXkKCiAgICA6cGFyYW0gY2VydGlmaWNhdGVfb3JfcHVibGljX2tleToKICAgICAgICBBIENlcnRpZmljYXRlIG9yIFB1YmxpY0tleSBpbnN0YW5jZSB0byBlbmNyeXB0IHdpdGgKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBkYXRhIHRvIGVuY3J5cHQKCiAgICA6cGFyYW0gcnNhX29hZXBfcGFkZGluZzoKICAgICAgICBJZiBPQUVQIHBhZGRpbmcgc2hvdWxkIGJlIHVzZWQgaW5zdGVhZCBvZiBQS0NTIzEgdjEuNQoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgY2lwaGVydGV4dAogICAgIiIiCgogICAgaWYgbm90IGlzaW5zdGFuY2UoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgKENlcnRpZmljYXRlLCBQdWJsaWNLZXkpKToKICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5IG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgdGhlIENlcnRpZmljYXRlIG9yCiAgICAgICAgICAgIFB1YmxpY0tleSBjbGFzcywgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXkpCiAgICAgICAgKSkKCiAgICBpZiBub3QgaXNpbnN0YW5jZShkYXRhLCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgZGF0YSBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShkYXRhKQogICAgICAgICkpCgogICAgaWYgbm90IGlzaW5zdGFuY2UocnNhX29hZXBfcGFkZGluZywgYm9vbCk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgcnNhX29hZXBfcGFkZGluZyBtdXN0IGJlIGEgYm9vbCwgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKHJzYV9vYWVwX3BhZGRpbmcpCiAgICAgICAgKSkKCiAgICBpZiBfYmFja2VuZCA9PSAnd2lubGVnYWN5JzoKICAgICAgICByZXR1cm4gX2FkdmFwaTMyX2VuY3J5cHQoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgZGF0YSwgcnNhX29hZXBfcGFkZGluZykKICAgIHJldHVybiBfYmNyeXB0X2VuY3J5cHQoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgZGF0YSwgcnNhX29hZXBfcGFkZGluZykKCgpkZWYgX2FkdmFwaTMyX2VuY3J5cHQoY2VydGlmaWNhdGVfb3JfcHVibGljX2tleSwgZGF0YSwgcnNhX29hZXBfcGFkZGluZz1GYWxzZSk6CiAgICAiIiIKICAgIEVuY3J5cHRzIGEgdmFsdWUgdXNpbmcgYW4gUlNBIHB1YmxpYyBrZXkgdmlhIENyeXB0b0FQSQoKICAgIDpwYXJhbSBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5OgogICAgICAgIEEgQ2VydGlmaWNhdGUgb3IgUHVibGljS2V5IGluc3RhbmNlIHRvIGVuY3J5cHQgd2l0aAoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGRhdGEgdG8gZW5jcnlwdAoKICAgIDpwYXJhbSByc2Ffb2FlcF9wYWRkaW5nOgogICAgICAgIElmIE9BRVAgcGFkZGluZyBzaG91bGQgYmUgdXNlZCBpbnN0ZWFkIG9mIFBLQ1MjMSB2MS41CgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBjaXBoZXJ0ZXh0CiAgICAiIiIKCiAgICBmbGFncyA9IDAKICAgIGlmIHJzYV9vYWVwX3BhZGRpbmc6CiAgICAgICAgZmxhZ3MgPSBBZHZhcGkzMkNvbnN0LkNSWVBUX09BRVAKCiAgICBvdXRfbGVuID0gbmV3KGFkdmFwaTMyLCAnRFdPUkQgKicsIGxlbihkYXRhKSkKICAgIHJlcyA9IGFkdmFwaTMyLkNyeXB0RW5jcnlwdCgKICAgICAgICBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LmV4X2tleV9oYW5kbGUsCiAgICAgICAgbnVsbCgpLAogICAgICAgIFRydWUsCiAgICAgICAgZmxhZ3MsCiAgICAgICAgbnVsbCgpLAogICAgICAgIG91dF9sZW4sCiAgICAgICAgMAogICAgKQogICAgaGFuZGxlX2Vycm9yKHJlcykKCiAgICBidWZmZXJfbGVuID0gZGVyZWYob3V0X2xlbikKICAgIGJ1ZmZlciA9IGJ1ZmZlcl9mcm9tX2J5dGVzKGJ1ZmZlcl9sZW4pCiAgICB3cml0ZV90b19idWZmZXIoYnVmZmVyLCBkYXRhKQoKICAgIHBvaW50ZXJfc2V0KG91dF9sZW4sIGxlbihkYXRhKSkKICAgIHJlcyA9IGFkdmFwaTMyLkNyeXB0RW5jcnlwdCgKICAgICAgICBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LmV4X2tleV9oYW5kbGUsCiAgICAgICAgbnVsbCgpLAogICAgICAgIFRydWUsCiAgICAgICAgZmxhZ3MsCiAgICAgICAgYnVmZmVyLAogICAgICAgIG91dF9sZW4sCiAgICAgICAgYnVmZmVyX2xlbgogICAgKQogICAgaGFuZGxlX2Vycm9yKHJlcykKCiAgICByZXR1cm4gYnl0ZXNfZnJvbV9idWZmZXIoYnVmZmVyLCBkZXJlZihvdXRfbGVuKSlbOjotMV0KCgpkZWYgX2JjcnlwdF9lbmNyeXB0KGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXksIGRhdGEsIHJzYV9vYWVwX3BhZGRpbmc9RmFsc2UpOgogICAgIiIiCiAgICBFbmNyeXB0cyBhIHZhbHVlIHVzaW5nIGFuIFJTQSBwdWJsaWMga2V5IHZpYSBDTkcKCiAgICA6cGFyYW0gY2VydGlmaWNhdGVfb3JfcHVibGljX2tleToKICAgICAgICBBIENlcnRpZmljYXRlIG9yIFB1YmxpY0tleSBpbnN0YW5jZSB0byBlbmNyeXB0IHdpdGgKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBkYXRhIHRvIGVuY3J5cHQKCiAgICA6cGFyYW0gcnNhX29hZXBfcGFkZGluZzoKICAgICAgICBJZiBPQUVQIHBhZGRpbmcgc2hvdWxkIGJlIHVzZWQgaW5zdGVhZCBvZiBQS0NTIzEgdjEuNQoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IHRoZSBPUyBjcnlwdG8gbGlicmFyeQoKICAgIDpyZXR1cm46CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgY2lwaGVydGV4dAogICAgIiIiCgogICAgZmxhZ3MgPSBCY3J5cHRDb25zdC5CQ1JZUFRfUEFEX1BLQ1MxCiAgICBpZiByc2Ffb2FlcF9wYWRkaW5nIGlzIFRydWU6CiAgICAgICAgZmxhZ3MgPSBCY3J5cHRDb25zdC5CQ1JZUFRfUEFEX09BRVAKCiAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdF9wb2ludGVyID0gc3RydWN0KGJjcnlwdCwgJ0JDUllQVF9PQUVQX1BBRERJTkdfSU5GTycpCiAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdCA9IHVud3JhcChwYWRkaW5nX2luZm9fc3RydWN0X3BvaW50ZXIpCiAgICAgICAgIyBUaGlzIGhhcyB0byBiZSBhc3NpZ25lZCB0byBhIHZhcmlhYmxlIHRvIHByZXZlbnQgY2ZmaSBmcm9tIGdjJ2luZyBpdAogICAgICAgIGhhc2hfYnVmZmVyID0gYnVmZmVyX2Zyb21fdW5pY29kZShCY3J5cHRDb25zdC5CQ1JZUFRfU0hBMV9BTEdPUklUSE0pCiAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdC5wc3pBbGdJZCA9IGNhc3QoYmNyeXB0LCAnd2NoYXJfdCAqJywgaGFzaF9idWZmZXIpCiAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdC5wYkxhYmVsID0gbnVsbCgpCiAgICAgICAgcGFkZGluZ19pbmZvX3N0cnVjdC5jYkxhYmVsID0gMAogICAgICAgIHBhZGRpbmdfaW5mbyA9IGNhc3QoYmNyeXB0LCAndm9pZCAqJywgcGFkZGluZ19pbmZvX3N0cnVjdF9wb2ludGVyKQogICAgZWxzZToKICAgICAgICBwYWRkaW5nX2luZm8gPSBudWxsKCkKCiAgICBvdXRfbGVuID0gbmV3KGJjcnlwdCwgJ1VMT05HIConKQogICAgcmVzID0gYmNyeXB0LkJDcnlwdEVuY3J5cHQoCiAgICAgICAgY2VydGlmaWNhdGVfb3JfcHVibGljX2tleS5rZXlfaGFuZGxlLAogICAgICAgIGRhdGEsCiAgICAgICAgbGVuKGRhdGEpLAogICAgICAgIHBhZGRpbmdfaW5mbywKICAgICAgICBudWxsKCksCiAgICAgICAgMCwKICAgICAgICBudWxsKCksCiAgICAgICAgMCwKICAgICAgICBvdXRfbGVuLAogICAgICAgIGZsYWdzCiAgICApCiAgICBoYW5kbGVfZXJyb3IocmVzKQoKICAgIGJ1ZmZlcl9sZW4gPSBkZXJlZihvdXRfbGVuKQogICAgYnVmZmVyID0gYnVmZmVyX2Zyb21fYnl0ZXMoYnVmZmVyX2xlbikKCiAgICByZXMgPSBiY3J5cHQuQkNyeXB0RW5jcnlwdCgKICAgICAgICBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LmtleV9oYW5kbGUsCiAgICAgICAgZGF0YSwKICAgICAgICBsZW4oZGF0YSksCiAgICAgICAgcGFkZGluZ19pbmZvLAogICAgICAgIG51bGwoKSwKICAgICAgICAwLAogICAgICAgIGJ1ZmZlciwKICAgICAgICBidWZmZXJfbGVuLAogICAgICAgIG91dF9sZW4sCiAgICAgICAgZmxhZ3MKICAgICkKICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgcmV0dXJuIGJ5dGVzX2Zyb21fYnVmZmVyKGJ1ZmZlciwgZGVyZWYob3V0X2xlbikpCgoKZGVmIF9kZWNyeXB0KHByaXZhdGVfa2V5LCBjaXBoZXJ0ZXh0LCByc2Ffb2FlcF9wYWRkaW5nPUZhbHNlKToKICAgICIiIgogICAgRW5jcnlwdHMgYSB2YWx1ZSB1c2luZyBhbiBSU0EgcHJpdmF0ZSBrZXkKCiAgICA6cGFyYW0gcHJpdmF0ZV9rZXk6CiAgICAgICAgQSBQcml2YXRlS2V5IGluc3RhbmNlIHRvIGRlY3J5cHQgd2l0aAoKICAgIDpwYXJhbSBjaXBoZXJ0ZXh0OgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGRhdGEgdG8gZGVjcnlwdAoKICAgIDpwYXJhbSByc2Ffb2FlcF9wYWRkaW5nOgogICAgICAgIElmIE9BRVAgcGFkZGluZyBzaG91bGQgYmUgdXNlZCBpbnN0ZWFkIG9mIFBLQ1MjMSB2MS41CgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBwbGFpbnRleHQKICAgICIiIgoKICAgIGlmIG5vdCBpc2luc3RhbmNlKHByaXZhdGVfa2V5LCBQcml2YXRlS2V5KToKICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBwcml2YXRlX2tleSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIHRoZSBQcml2YXRlS2V5IGNsYXNzLCBub3QgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICB0eXBlX25hbWUocHJpdmF0ZV9rZXkpCiAgICAgICAgKSkKCiAgICBpZiBub3QgaXNpbnN0YW5jZShjaXBoZXJ0ZXh0LCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgY2lwaGVydGV4dCBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShjaXBoZXJ0ZXh0KQogICAgICAgICkpCgogICAgaWYgbm90IGlzaW5zdGFuY2UocnNhX29hZXBfcGFkZGluZywgYm9vbCk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgcnNhX29hZXBfcGFkZGluZyBtdXN0IGJlIGEgYm9vbCwgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKHJzYV9vYWVwX3BhZGRpbmcpCiAgICAgICAgKSkKCiAgICBpZiBfYmFja2VuZCA9PSAnd2lubGVnYWN5JzoKICAgICAgICByZXR1cm4gX2FkdmFwaTMyX2RlY3J5cHQocHJpdmF0ZV9rZXksIGNpcGhlcnRleHQsIHJzYV9vYWVwX3BhZGRpbmcpCiAgICByZXR1cm4gX2JjcnlwdF9kZWNyeXB0KHByaXZhdGVfa2V5LCBjaXBoZXJ0ZXh0LCByc2Ffb2FlcF9wYWRkaW5nKQoKCmRlZiBfYWR2YXBpMzJfZGVjcnlwdChwcml2YXRlX2tleSwgY2lwaGVydGV4dCwgcnNhX29hZXBfcGFkZGluZz1GYWxzZSk6CiAgICAiIiIKICAgIEVuY3J5cHRzIGEgdmFsdWUgdXNpbmcgYW4gUlNBIHByaXZhdGUga2V5IHZpYSBDcnlwdG9BUEkKCiAgICA6cGFyYW0gcHJpdmF0ZV9rZXk6CiAgICAgICAgQSBQcml2YXRlS2V5IGluc3RhbmNlIHRvIGRlY3J5cHQgd2l0aAoKICAgIDpwYXJhbSBjaXBoZXJ0ZXh0OgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGRhdGEgdG8gZGVjcnlwdAoKICAgIDpwYXJhbSByc2Ffb2FlcF9wYWRkaW5nOgogICAgICAgIElmIE9BRVAgcGFkZGluZyBzaG91bGQgYmUgdXNlZCBpbnN0ZWFkIG9mIFBLQ1MjMSB2MS41CgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBwbGFpbnRleHQKICAgICIiIgoKICAgIGZsYWdzID0gMAogICAgaWYgcnNhX29hZXBfcGFkZGluZzoKICAgICAgICBmbGFncyA9IEFkdmFwaTMyQ29uc3QuQ1JZUFRfT0FFUAoKICAgIGNpcGhlcnRleHQgPSBjaXBoZXJ0ZXh0Wzo6LTFdCgogICAgYnVmZmVyID0gYnVmZmVyX2Zyb21fYnl0ZXMoY2lwaGVydGV4dCkKICAgIG91dF9sZW4gPSBuZXcoYWR2YXBpMzIsICdEV09SRCAqJywgbGVuKGNpcGhlcnRleHQpKQogICAgcmVzID0gYWR2YXBpMzIuQ3J5cHREZWNyeXB0KAogICAgICAgIHByaXZhdGVfa2V5LmV4X2tleV9oYW5kbGUsCiAgICAgICAgbnVsbCgpLAogICAgICAgIFRydWUsCiAgICAgICAgZmxhZ3MsCiAgICAgICAgYnVmZmVyLAogICAgICAgIG91dF9sZW4KICAgICkKICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgcmV0dXJuIGJ5dGVzX2Zyb21fYnVmZmVyKGJ1ZmZlciwgZGVyZWYob3V0X2xlbikpCgoKZGVmIF9iY3J5cHRfZGVjcnlwdChwcml2YXRlX2tleSwgY2lwaGVydGV4dCwgcnNhX29hZXBfcGFkZGluZz1GYWxzZSk6CiAgICAiIiIKICAgIEVuY3J5cHRzIGEgdmFsdWUgdXNpbmcgYW4gUlNBIHByaXZhdGUga2V5IHZpYSBDTkcKCiAgICA6cGFyYW0gcHJpdmF0ZV9rZXk6CiAgICAgICAgQSBQcml2YXRlS2V5IGluc3RhbmNlIHRvIGRlY3J5cHQgd2l0aAoKICAgIDpwYXJhbSBjaXBoZXJ0ZXh0OgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGRhdGEgdG8gZGVjcnlwdAoKICAgIDpwYXJhbSByc2Ffb2FlcF9wYWRkaW5nOgogICAgICAgIElmIE9BRVAgcGFkZGluZyBzaG91bGQgYmUgdXNlZCBpbnN0ZWFkIG9mIFBLQ1MjMSB2MS41CgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBwbGFpbnRleHQKICAgICIiIgoKICAgIGZsYWdzID0gQmNyeXB0Q29uc3QuQkNSWVBUX1BBRF9QS0NTMQogICAgaWYgcnNhX29hZXBfcGFkZGluZyBpcyBUcnVlOgogICAgICAgIGZsYWdzID0gQmNyeXB0Q29uc3QuQkNSWVBUX1BBRF9PQUVQCgogICAgICAgIHBhZGRpbmdfaW5mb19zdHJ1Y3RfcG9pbnRlciA9IHN0cnVjdChiY3J5cHQsICdCQ1JZUFRfT0FFUF9QQURESU5HX0lORk8nKQogICAgICAgIHBhZGRpbmdfaW5mb19zdHJ1Y3QgPSB1bndyYXAocGFkZGluZ19pbmZvX3N0cnVjdF9wb2ludGVyKQogICAgICAgICMgVGhpcyBoYXMgdG8gYmUgYXNzaWduZWQgdG8gYSB2YXJpYWJsZSB0byBwcmV2ZW50IGNmZmkgZnJvbSBnYydpbmcgaXQKICAgICAgICBoYXNoX2J1ZmZlciA9IGJ1ZmZlcl9mcm9tX3VuaWNvZGUoQmNyeXB0Q29uc3QuQkNSWVBUX1NIQTFfQUxHT1JJVEhNKQogICAgICAgIHBhZGRpbmdfaW5mb19zdHJ1Y3QucHN6QWxnSWQgPSBjYXN0KGJjcnlwdCwgJ3djaGFyX3QgKicsIGhhc2hfYnVmZmVyKQogICAgICAgIHBhZGRpbmdfaW5mb19zdHJ1Y3QucGJMYWJlbCA9IG51bGwoKQogICAgICAgIHBhZGRpbmdfaW5mb19zdHJ1Y3QuY2JMYWJlbCA9IDAKICAgICAgICBwYWRkaW5nX2luZm8gPSBjYXN0KGJjcnlwdCwgJ3ZvaWQgKicsIHBhZGRpbmdfaW5mb19zdHJ1Y3RfcG9pbnRlcikKICAgIGVsc2U6CiAgICAgICAgcGFkZGluZ19pbmZvID0gbnVsbCgpCgogICAgb3V0X2xlbiA9IG5ldyhiY3J5cHQsICdVTE9ORyAqJykKICAgIHJlcyA9IGJjcnlwdC5CQ3J5cHREZWNyeXB0KAogICAgICAgIHByaXZhdGVfa2V5LmtleV9oYW5kbGUsCiAgICAgICAgY2lwaGVydGV4dCwKICAgICAgICBsZW4oY2lwaGVydGV4dCksCiAgICAgICAgcGFkZGluZ19pbmZvLAogICAgICAgIG51bGwoKSwKICAgICAgICAwLAogICAgICAgIG51bGwoKSwKICAgICAgICAwLAogICAgICAgIG91dF9sZW4sCiAgICAgICAgZmxhZ3MKICAgICkKICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgYnVmZmVyX2xlbiA9IGRlcmVmKG91dF9sZW4pCiAgICBidWZmZXIgPSBidWZmZXJfZnJvbV9ieXRlcyhidWZmZXJfbGVuKQoKICAgIHJlcyA9IGJjcnlwdC5CQ3J5cHREZWNyeXB0KAogICAgICAgIHByaXZhdGVfa2V5LmtleV9oYW5kbGUsCiAgICAgICAgY2lwaGVydGV4dCwKICAgICAgICBsZW4oY2lwaGVydGV4dCksCiAgICAgICAgcGFkZGluZ19pbmZvLAogICAgICAgIG51bGwoKSwKICAgICAgICAwLAogICAgICAgIGJ1ZmZlciwKICAgICAgICBidWZmZXJfbGVuLAogICAgICAgIG91dF9sZW4sCiAgICAgICAgZmxhZ3MKICAgICkKICAgIGhhbmRsZV9lcnJvcihyZXMpCgogICAgcmV0dXJuIGJ5dGVzX2Zyb21fYnVmZmVyKGJ1ZmZlciwgZGVyZWYob3V0X2xlbikpCgoKZGVmIHJzYV9wa2NzMXYxNV9lbmNyeXB0KGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXksIGRhdGEpOgogICAgIiIiCiAgICBFbmNyeXB0cyBhIGJ5dGUgc3RyaW5nIHVzaW5nIGFuIFJTQSBwdWJsaWMga2V5IG9yIGNlcnRpZmljYXRlLiBVc2VzIFBLQ1MjMQogICAgdjEuNSBwYWRkaW5nLgoKICAgIDpwYXJhbSBjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5OgogICAgICAgIEEgUHVibGljS2V5IG9yIENlcnRpZmljYXRlIG9iamVjdAoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIEEgYnl0ZSBzdHJpbmcsIHdpdGggYSBtYXhpbXVtIGxlbmd0aCAxMSBieXRlcyBsZXNzIHRoYW4gdGhlIGtleSBsZW5ndGgKICAgICAgICAoaW4gYnl0ZXMpCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBlbmNyeXB0ZWQgZGF0YQogICAgIiIiCgogICAgcmV0dXJuIF9lbmNyeXB0KGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXksIGRhdGEpCgoKZGVmIHJzYV9wa2NzMXYxNV9kZWNyeXB0KHByaXZhdGVfa2V5LCBjaXBoZXJ0ZXh0KToKICAgICIiIgogICAgRGVjcnlwdHMgYSBieXRlIHN0cmluZyB1c2luZyBhbiBSU0EgcHJpdmF0ZSBrZXkuIFVzZXMgUEtDUyMxIHYxLjUgcGFkZGluZy4KCiAgICA6cGFyYW0gcHJpdmF0ZV9rZXk6CiAgICAgICAgQSBQcml2YXRlS2V5IG9iamVjdAoKICAgIDpwYXJhbSBjaXBoZXJ0ZXh0OgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGVuY3J5cHRlZCBkYXRhCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBvcmlnaW5hbCBwbGFpbnRleHQKICAgICIiIgoKICAgIHJldHVybiBfZGVjcnlwdChwcml2YXRlX2tleSwgY2lwaGVydGV4dCkKCgpkZWYgcnNhX29hZXBfZW5jcnlwdChjZXJ0aWZpY2F0ZV9vcl9wdWJsaWNfa2V5LCBkYXRhKToKICAgICIiIgogICAgRW5jcnlwdHMgYSBieXRlIHN0cmluZyB1c2luZyBhbiBSU0EgcHVibGljIGtleSBvciBjZXJ0aWZpY2F0ZS4gVXNlcyBQS0NTIzEKICAgIE9BRVAgcGFkZGluZyB3aXRoIFNIQTEuCgogICAgOnBhcmFtIGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXk6CiAgICAgICAgQSBQdWJsaWNLZXkgb3IgQ2VydGlmaWNhdGUgb2JqZWN0CgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgQSBieXRlIHN0cmluZywgd2l0aCBhIG1heGltdW0gbGVuZ3RoIDQxIGJ5dGVzIChvciBtb3JlKSBsZXNzIHRoYW4gdGhlCiAgICAgICAga2V5IGxlbmd0aCAoaW4gYnl0ZXMpCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBlbmNyeXB0ZWQgZGF0YQogICAgIiIiCgogICAgcmV0dXJuIF9lbmNyeXB0KGNlcnRpZmljYXRlX29yX3B1YmxpY19rZXksIGRhdGEsIHJzYV9vYWVwX3BhZGRpbmc9VHJ1ZSkKCgpkZWYgcnNhX29hZXBfZGVjcnlwdChwcml2YXRlX2tleSwgY2lwaGVydGV4dCk6CiAgICAiIiIKICAgIERlY3J5cHRzIGEgYnl0ZSBzdHJpbmcgdXNpbmcgYW4gUlNBIHByaXZhdGUga2V5LiBVc2VzIFBLQ1MjMSBPQUVQIHBhZGRpbmcKICAgIHdpdGggU0hBMS4KCiAgICA6cGFyYW0gcHJpdmF0ZV9rZXk6CiAgICAgICAgQSBQcml2YXRlS2V5IG9iamVjdAoKICAgIDpwYXJhbSBjaXBoZXJ0ZXh0OgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGVuY3J5cHRlZCBkYXRhCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgdGhlIE9TIGNyeXB0byBsaWJyYXJ5CgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBvcmlnaW5hbCBwbGFpbnRleHQKICAgICIiIgoKICAgIHJldHVybiBfZGVjcnlwdChwcml2YXRlX2tleSwgY2lwaGVydGV4dCwgcnNhX29hZXBfcGFkZGluZz1UcnVlKQo=
