statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/customizations/s3/s3handler.py
  contents:
  - name: BaseTransferRequestSubmitter._submit_dryrun
    score: 0.0
    code: |-
      def _submit_dryrun(self, fileinfo):
              transfer_type = fileinfo.operation_name
              if self._cli_params.get('is_move', False):
                  transfer_type = 'move'
              src, dest = self._format_src_dest(fileinfo)
              self._result_queue.put(DryRunResult(
                  transfer_type=transfer_type, src=src, dest=dest))
    tokens: resume load_fast fileinfo load_attr operation_name store_fast transfer_type load_fast self load_attr _cli_params load_attr get load_const is_move load_const INTEGER call pop_jump_if_false TO_NUMBER load_const move store_fast transfer_type load_fast self load_attr STRING_LEN_S_ENT_HIGH load_fast fileinfo call unpack_sequence store_fast src store_fast dest load_fast self load_attr _result_queue load_attr put load_global DryRunResult load_fast transfer_type load_fast src load_fast dest kw_names dest src transfer_type call call pop_top return_const None
    hash: d0ac0dd128abe68dfc2936eda810fc3ee857856bbfd451f396b2c1b5881dd6ea
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/customizations/s3/s3handler.py
  : IyBDb3B5cmlnaHQgMjAxMyBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLgojCiMgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIikuIFlvdQojIG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YKIyB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0CiMKIyAgICAgaHR0cDovL2F3cy5hbWF6b24uY29tL2FwYWNoZTIuMC8KIwojIG9yIGluIHRoZSAibGljZW5zZSIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMKIyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRgojIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYwojIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCmltcG9ydCBsb2dnaW5nCmltcG9ydCBvcwoKZnJvbSBzM3RyYW5zZmVyLm1hbmFnZXIgaW1wb3J0IFRyYW5zZmVyTWFuYWdlcgoKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMudXRpbHMgaW1wb3J0ICgKICAgIGh1bWFuX3JlYWRhYmxlX3NpemUsIE1BWF9VUExPQURfU0laRSwgZmluZF9idWNrZXRfa2V5LCByZWxhdGl2ZV9wYXRoLAogICAgY3JlYXRlX3dhcm5pbmcsIE5vblNlZWthYmxlU3RyZWFtKQpmcm9tIGF3c2NsaS5jdXN0b21pemF0aW9ucy5zMy50cmFuc2ZlcmNvbmZpZyBpbXBvcnQgXAogICAgY3JlYXRlX3RyYW5zZmVyX2NvbmZpZ19mcm9tX3J1bnRpbWVfY29uZmlnCmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnJlc3VsdHMgaW1wb3J0IFVwbG9hZFJlc3VsdFN1YnNjcmliZXIKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMucmVzdWx0cyBpbXBvcnQgRG93bmxvYWRSZXN1bHRTdWJzY3JpYmVyCmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnJlc3VsdHMgaW1wb3J0IENvcHlSZXN1bHRTdWJzY3JpYmVyCmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnJlc3VsdHMgaW1wb3J0IFVwbG9hZFN0cmVhbVJlc3VsdFN1YnNjcmliZXIKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMucmVzdWx0cyBpbXBvcnQgRG93bmxvYWRTdHJlYW1SZXN1bHRTdWJzY3JpYmVyCmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnJlc3VsdHMgaW1wb3J0IERlbGV0ZVJlc3VsdFN1YnNjcmliZXIKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMucmVzdWx0cyBpbXBvcnQgUXVldWVkUmVzdWx0CmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnJlc3VsdHMgaW1wb3J0IFN1Y2Nlc3NSZXN1bHQKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMucmVzdWx0cyBpbXBvcnQgRmFpbHVyZVJlc3VsdApmcm9tIGF3c2NsaS5jdXN0b21pemF0aW9ucy5zMy5yZXN1bHRzIGltcG9ydCBEcnlSdW5SZXN1bHQKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMucmVzdWx0cyBpbXBvcnQgUmVzdWx0UmVjb3JkZXIKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMucmVzdWx0cyBpbXBvcnQgUmVzdWx0UHJpbnRlcgpmcm9tIGF3c2NsaS5jdXN0b21pemF0aW9ucy5zMy5yZXN1bHRzIGltcG9ydCBPbmx5U2hvd0Vycm9yc1Jlc3VsdFByaW50ZXIKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMucmVzdWx0cyBpbXBvcnQgTm9Qcm9ncmVzc1Jlc3VsdFByaW50ZXIKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMucmVzdWx0cyBpbXBvcnQgUmVzdWx0UHJvY2Vzc29yCmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnJlc3VsdHMgaW1wb3J0IENvbW1hbmRSZXN1bHRSZWNvcmRlcgpmcm9tIGF3c2NsaS5jdXN0b21pemF0aW9ucy5zMy51dGlscyBpbXBvcnQgUmVxdWVzdFBhcmFtc01hcHBlcgpmcm9tIGF3c2NsaS5jdXN0b21pemF0aW9ucy5zMy51dGlscyBpbXBvcnQgU3Rkb3V0Qnl0ZXNXcml0ZXIKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMudXRpbHMgaW1wb3J0IFByb3ZpZGVTaXplU3Vic2NyaWJlcgpmcm9tIGF3c2NsaS5jdXN0b21pemF0aW9ucy5zMy51dGlscyBpbXBvcnQgUHJvdmlkZVVwbG9hZENvbnRlbnRUeXBlU3Vic2NyaWJlcgpmcm9tIGF3c2NsaS5jdXN0b21pemF0aW9ucy5zMy51dGlscyBpbXBvcnQgUHJvdmlkZUNvcHlDb250ZW50VHlwZVN1YnNjcmliZXIKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMudXRpbHMgaW1wb3J0IFByb3ZpZGVMYXN0TW9kaWZpZWRUaW1lU3Vic2NyaWJlcgpmcm9tIGF3c2NsaS5jdXN0b21pemF0aW9ucy5zMy51dGlscyBpbXBvcnQgRGlyZWN0b3J5Q3JlYXRvclN1YnNjcmliZXIKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMudXRpbHMgaW1wb3J0IERlbGV0ZVNvdXJjZUZpbGVTdWJzY3JpYmVyCmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnV0aWxzIGltcG9ydCBEZWxldGVTb3VyY2VPYmplY3RTdWJzY3JpYmVyCmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnV0aWxzIGltcG9ydCBEZWxldGVDb3B5U291cmNlT2JqZWN0U3Vic2NyaWJlcgpmcm9tIGF3c2NsaS5jb21wYXQgaW1wb3J0IGdldF9iaW5hcnlfc3RkaW4KCgpMT0dHRVIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCgpjbGFzcyBTM1RyYW5zZmVySGFuZGxlckZhY3Rvcnkob2JqZWN0KToKICAgIE1BWF9JTl9NRU1PUllfQ0hVTktTID0gNgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjbGlfcGFyYW1zLCBydW50aW1lX2NvbmZpZyk6CiAgICAgICAgIiIiRmFjdG9yeSBmb3IgUzNUcmFuc2ZlckhhbmRsZXJzCgogICAgICAgIDp0eXBlIGNsaV9wYXJhbXM6IGRpY3QKICAgICAgICA6cGFyYW0gY2xpX3BhcmFtczogVGhlIHBhcmFtZXRlcnMgcHJvdmlkZSB0byB0aGUgQ0xJIGNvbW1hbmQKCiAgICAgICAgOnR5cGUgcnVudGltZV9jb25maWc6IFJ1bnRpbWVDb25maWcKICAgICAgICA6cGFyYW0gcnVudGltZV9jb25maWc6IFRoZSBydW50aW1lIGNvbmZpZyBmb3IgdGhlIENMSSBjb21tYW5kCiAgICAgICAgICAgIGJlaW5nIHJ1bgogICAgICAgICIiIgogICAgICAgIHNlbGYuX2NsaV9wYXJhbXMgPSBjbGlfcGFyYW1zCiAgICAgICAgc2VsZi5fcnVudGltZV9jb25maWcgPSBydW50aW1lX2NvbmZpZwoKICAgIGRlZiBfX2NhbGxfXyhzZWxmLCBjbGllbnQsIHJlc3VsdF9xdWV1ZSk6CiAgICAgICAgIiIiQ3JlYXRlcyBhIFMzVHJhbnNmZXJIYW5kbGVyIGluc3RhbmNlCgogICAgICAgIDp0eXBlIGNsaWVudDogYm90b2NvcmUuY2xpZW50LkNsaWVudAogICAgICAgIDpwYXJhbSBjbGllbnQ6IFRoZSBjbGllbnQgdG8gcG93ZXIgdGhlIFMzVHJhbnNmZXJIYW5kbGVyCgogICAgICAgIDp0eXBlIHJlc3VsdF9xdWV1ZTogcXVldWUuUXVldWUKICAgICAgICA6cGFyYW0gcmVzdWx0X3F1ZXVlOiBUaGUgcmVzdWx0IHF1ZXVlIHRvIGJlIHVzZWQgdG8gcHJvY2VzcyByZXN1bHRzCiAgICAgICAgICAgIGZvciB0aGUgUzNUcmFuc2ZlckhhbmRsZXIKCiAgICAgICAgOnJldHVybnM6IEEgUzNUcmFuc2ZlckhhbmRsZXIgaW5zdGFuY2UKICAgICAgICAiIiIKICAgICAgICB0cmFuc2Zlcl9jb25maWcgPSBjcmVhdGVfdHJhbnNmZXJfY29uZmlnX2Zyb21fcnVudGltZV9jb25maWcoCiAgICAgICAgICAgIHNlbGYuX3J1bnRpbWVfY29uZmlnKQogICAgICAgIHRyYW5zZmVyX2NvbmZpZy5tYXhfaW5fbWVtb3J5X3VwbG9hZF9jaHVua3MgPSBzZWxmLk1BWF9JTl9NRU1PUllfQ0hVTktTCiAgICAgICAgdHJhbnNmZXJfY29uZmlnLm1heF9pbl9tZW1vcnlfZG93bmxvYWRfY2h1bmtzID0gXAogICAgICAgICAgICBzZWxmLk1BWF9JTl9NRU1PUllfQ0hVTktTCgogICAgICAgIHRyYW5zZmVyX21hbmFnZXIgPSBUcmFuc2Zlck1hbmFnZXIoY2xpZW50LCB0cmFuc2Zlcl9jb25maWcpCgogICAgICAgIExPR0dFUi5kZWJ1ZygKICAgICAgICAgICAgIlVzaW5nIGEgbXVsdGlwYXJ0IHRocmVzaG9sZCBvZiAlcyBhbmQgYSBwYXJ0IHNpemUgb2YgJXMiLAogICAgICAgICAgICB0cmFuc2Zlcl9jb25maWcubXVsdGlwYXJ0X3RocmVzaG9sZCwKICAgICAgICAgICAgdHJhbnNmZXJfY29uZmlnLm11bHRpcGFydF9jaHVua3NpemUKICAgICAgICApCiAgICAgICAgcmVzdWx0X3JlY29yZGVyID0gUmVzdWx0UmVjb3JkZXIoKQogICAgICAgIHJlc3VsdF9wcm9jZXNzb3JfaGFuZGxlcnMgPSBbcmVzdWx0X3JlY29yZGVyXQogICAgICAgIHNlbGYuX2FkZF9yZXN1bHRfcHJpbnRlcihyZXN1bHRfcmVjb3JkZXIsIHJlc3VsdF9wcm9jZXNzb3JfaGFuZGxlcnMpCiAgICAgICAgcmVzdWx0X3Byb2Nlc3NvciA9IFJlc3VsdFByb2Nlc3NvcigKICAgICAgICAgICAgcmVzdWx0X3F1ZXVlLCByZXN1bHRfcHJvY2Vzc29yX2hhbmRsZXJzKQogICAgICAgIGNvbW1hbmRfcmVzdWx0X3JlY29yZGVyID0gQ29tbWFuZFJlc3VsdFJlY29yZGVyKAogICAgICAgICAgICByZXN1bHRfcXVldWUsIHJlc3VsdF9yZWNvcmRlciwgcmVzdWx0X3Byb2Nlc3NvcikKCiAgICAgICAgcmV0dXJuIFMzVHJhbnNmZXJIYW5kbGVyKAogICAgICAgICAgICB0cmFuc2Zlcl9tYW5hZ2VyLCBzZWxmLl9jbGlfcGFyYW1zLCBjb21tYW5kX3Jlc3VsdF9yZWNvcmRlcikKCiAgICBkZWYgX2FkZF9yZXN1bHRfcHJpbnRlcihzZWxmLCByZXN1bHRfcmVjb3JkZXIsIHJlc3VsdF9wcm9jZXNzb3JfaGFuZGxlcnMpOgogICAgICAgIGlmIHNlbGYuX2NsaV9wYXJhbXMuZ2V0KCdxdWlldCcpOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbGlmIHNlbGYuX2NsaV9wYXJhbXMuZ2V0KCdvbmx5X3Nob3dfZXJyb3JzJyk6CiAgICAgICAgICAgIHJlc3VsdF9wcmludGVyID0gT25seVNob3dFcnJvcnNSZXN1bHRQcmludGVyKHJlc3VsdF9yZWNvcmRlcikKICAgICAgICBlbGlmIHNlbGYuX2NsaV9wYXJhbXMuZ2V0KCdpc19zdHJlYW0nKToKICAgICAgICAgICAgcmVzdWx0X3ByaW50ZXIgPSBPbmx5U2hvd0Vycm9yc1Jlc3VsdFByaW50ZXIocmVzdWx0X3JlY29yZGVyKQogICAgICAgIGVsaWYgbm90IHNlbGYuX2NsaV9wYXJhbXMuZ2V0KCdwcm9ncmVzcycpOgogICAgICAgICAgICByZXN1bHRfcHJpbnRlciA9IE5vUHJvZ3Jlc3NSZXN1bHRQcmludGVyKHJlc3VsdF9yZWNvcmRlcikKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXN1bHRfcHJpbnRlciA9IFJlc3VsdFByaW50ZXIocmVzdWx0X3JlY29yZGVyKQogICAgICAgIHJlc3VsdF9wcm9jZXNzb3JfaGFuZGxlcnMuYXBwZW5kKHJlc3VsdF9wcmludGVyKQoKCmNsYXNzIFMzVHJhbnNmZXJIYW5kbGVyKG9iamVjdCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgdHJhbnNmZXJfbWFuYWdlciwgY2xpX3BhcmFtcywgcmVzdWx0X2NvbW1hbmRfcmVjb3JkZXIpOgogICAgICAgICIiIkJhY2tlbmQgZm9yIHBlcmZvcm1pbmcgUzMgdHJhbnNmZXJzCgogICAgICAgIDp0eXBlIHRyYW5zZmVyX21hbmFnZXI6IHMzdHJhbnNmZXIubWFuYWdlci5UcmFuc2Zlck1hbmFnZXIKICAgICAgICA6cGFyYW0gdHJhbnNmZXJfbWFuYWdlcjogVHJhbnNmZXIgbWFuYWdlciB0byB1c2UgZm9yIHRyYW5zZmVycwoKICAgICAgICA6dHlwZSBjbGlfcGFyYW1zOiBkaWN0CiAgICAgICAgOnBhcmFtIGNsaV9wYXJhbXM6IFRoZSBwYXJhbWV0ZXJzIHBhc3NlZCB0byB0aGUgQ0xJIGNvbW1hbmQgaW4gdGhlCiAgICAgICAgICAgIGZvcm0gb2YgYSBkaWN0aW9uYXJ5CgogICAgICAgIDp0eXBlIHJlc3VsdF9jb21tYW5kX3JlY29yZGVyOiBSZXN1bHRDb21tYW5kUmVjb3JkZXIKICAgICAgICA6cGFyYW0gcmVzdWx0X2NvbW1hbmRfcmVjb3JkZXI6IFRoZSByZXN1bHQgY29tbWFuZCByZWNvcmRlciB0byBiZQogICAgICAgICAgICB1c2VkIHRvIGdldCB0aGUgZmluYWwgcmVzdWx0IG9mIHRoZSB0cmFuc2ZlcgogICAgICAgICIiIgogICAgICAgIHNlbGYuX3RyYW5zZmVyX21hbmFnZXIgPSB0cmFuc2Zlcl9tYW5hZ2VyCiAgICAgICAgIyBUT0RPOiBJZGVhbGx5IHRoZSBzMyB0cmFuc2ZlciBoYW5kbGVyIHNob3VsZCBub3QgbmVlZCB0byBrbm93CiAgICAgICAgIyBhYm91dCB0aGUgcmVzdWx0IGNvbW1hbmQgcmVjb3JkZXIuIEl0IHJlYWxseSBvbmx5IG5lZWRzIGFuIGludGVyZmFjZQogICAgICAgICMgZm9yIGFkZGluZyByZXN1bHRzIHRvIHRoZSBxdWV1ZS4gV2hlbiBhbGwgb2YgdGhlIGNvbW1hbmRzIGhhdmUKICAgICAgICAjIGNvbnZlcnRlZCB0byB1c2UgdGhpcyB0cmFuc2ZlciBoYW5kbGVyLCBhbiBlZmZvcnQgc2hvdWxkIGJlIG1hZGUKICAgICAgICAjIHRvIHJlcGxhY2UgdGhlIHBhc3Npbmcgb2YgYSByZXN1bHQgY29tbWFuZCByZWNvcmRlciB3aXRoIGFuCiAgICAgICAgIyBhYnN0cmFjdGlvbiB0byBlbnF1ZXVlIHJlc3VsdHMuCiAgICAgICAgc2VsZi5fcmVzdWx0X2NvbW1hbmRfcmVjb3JkZXIgPSByZXN1bHRfY29tbWFuZF9yZWNvcmRlcgoKICAgICAgICBzdWJtaXR0ZXJfYXJncyA9ICgKICAgICAgICAgICAgc2VsZi5fdHJhbnNmZXJfbWFuYWdlciwgc2VsZi5fcmVzdWx0X2NvbW1hbmRfcmVjb3JkZXIucmVzdWx0X3F1ZXVlLAogICAgICAgICAgICBjbGlfcGFyYW1zCiAgICAgICAgKQogICAgICAgIHNlbGYuX3N1Ym1pdHRlcnMgPSBbCiAgICAgICAgICAgIFVwbG9hZFN0cmVhbVJlcXVlc3RTdWJtaXR0ZXIoKnN1Ym1pdHRlcl9hcmdzKSwKICAgICAgICAgICAgRG93bmxvYWRTdHJlYW1SZXF1ZXN0U3VibWl0dGVyKCpzdWJtaXR0ZXJfYXJncyksCiAgICAgICAgICAgIFVwbG9hZFJlcXVlc3RTdWJtaXR0ZXIoKnN1Ym1pdHRlcl9hcmdzKSwKICAgICAgICAgICAgRG93bmxvYWRSZXF1ZXN0U3VibWl0dGVyKCpzdWJtaXR0ZXJfYXJncyksCiAgICAgICAgICAgIENvcHlSZXF1ZXN0U3VibWl0dGVyKCpzdWJtaXR0ZXJfYXJncyksCiAgICAgICAgICAgIERlbGV0ZVJlcXVlc3RTdWJtaXR0ZXIoKnN1Ym1pdHRlcl9hcmdzKSwKICAgICAgICAgICAgTG9jYWxEZWxldGVSZXF1ZXN0U3VibWl0dGVyKCpzdWJtaXR0ZXJfYXJncykKICAgICAgICBdCgogICAgZGVmIGNhbGwoc2VsZiwgZmlsZWluZm9zKToKICAgICAgICAiIiJQcm9jZXNzIGl0ZXJhYmxlIG9mIEZpbGVJbmZvcyBmb3IgdHJhbnNmZXIKCiAgICAgICAgOnR5cGUgZmlsZWluZm9zOiBpdGVyYWJsZSBvZiBGaWxlSW5mb3MKICAgICAgICBwYXJhbSBmaWxlaW5mb3M6IFNldCBvZiBGaWxlSW5mb3MgdG8gc3VibWl0IHRvIHVuZGVybHlpbmcgdHJhbnNmZXIKICAgICAgICAgICAgcmVxdWVzdCBzdWJtaXR0ZXJzIHRvIG1ha2UgdHJhbnNmZXIgQVBJIGNhbGxzIHRvIFMzCgogICAgICAgIDpydHlwZTogQ29tbWFuZFJlc3VsdAogICAgICAgIDpyZXR1cm5zOiBUaGUgcmVzdWx0IG9mIHRoZSBjb21tYW5kIHRoYXQgc3BlY2lmaWVzIHRoZSBudW1iZXIgb2YKICAgICAgICAgICAgZmFpbHVyZXMgYW5kIHdhcm5pbmdzIGVuY291bnRlcmVkLgogICAgICAgICIiIgogICAgICAgIHdpdGggc2VsZi5fcmVzdWx0X2NvbW1hbmRfcmVjb3JkZXI6CiAgICAgICAgICAgIHdpdGggc2VsZi5fdHJhbnNmZXJfbWFuYWdlcjoKICAgICAgICAgICAgICAgIHRvdGFsX3N1Ym1pc3Npb25zID0gMAogICAgICAgICAgICAgICAgZm9yIGZpbGVpbmZvIGluIGZpbGVpbmZvczoKICAgICAgICAgICAgICAgICAgICBmb3Igc3VibWl0dGVyIGluIHNlbGYuX3N1Ym1pdHRlcnM6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN1Ym1pdHRlci5jYW5fc3VibWl0KGZpbGVpbmZvKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN1Ym1pdHRlci5zdWJtaXQoZmlsZWluZm8pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX3N1Ym1pc3Npb25zICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBzZWxmLl9yZXN1bHRfY29tbWFuZF9yZWNvcmRlci5ub3RpZnlfdG90YWxfc3VibWlzc2lvbnMoCiAgICAgICAgICAgICAgICAgICAgdG90YWxfc3VibWlzc2lvbnMpCiAgICAgICAgcmV0dXJuIHNlbGYuX3Jlc3VsdF9jb21tYW5kX3JlY29yZGVyLmdldF9jb21tYW5kX3Jlc3VsdCgpCgoKY2xhc3MgQmFzZVRyYW5zZmVyUmVxdWVzdFN1Ym1pdHRlcihvYmplY3QpOgogICAgUkVRVUVTVF9NQVBQRVJfTUVUSE9EID0gTm9uZQogICAgUkVTVUxUX1NVQlNDUklCRVJfQ0xBU1MgPSBOb25lCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHRyYW5zZmVyX21hbmFnZXIsIHJlc3VsdF9xdWV1ZSwgY2xpX3BhcmFtcyk6CiAgICAgICAgIiIiU3VibWl0cyB0cmFuc2ZlciByZXF1ZXN0cyB0byB0aGUgVHJhbnNmZXJNYW5hZ2VyCgogICAgICAgIEdpdmVuIGEgRmlsZUluZm8gb2JqZWN0IGFuZCBwcm92aWRlZCBDTEkgcGFyYW1ldGVycywgaXQgd2lsbCBhZGQgdGhlCiAgICAgICAgbmVjZXNzYXJ5IGV4dHJhIGFyZ3VtZW50cyBhbmQgc3Vic2NyaWJlcnMgaW4gbWFraW5nIGEgY2FsbCB0byB0aGUKICAgICAgICBUcmFuc2Zlck1hbmFnZXIuCgogICAgICAgIDp0eXBlIHRyYW5zZmVyX21hbmFnZXI6IHMzdHJhbnNmZXIubWFuYWdlci5UcmFuc2Zlck1hbmFnZXIKICAgICAgICA6cGFyYW0gdHJhbnNmZXJfbWFuYWdlcjogVGhlIHVuZGVybHlpbmcgdHJhbnNmZXIgbWFuYWdlcgoKICAgICAgICA6dHlwZSByZXN1bHRfcXVldWU6IHF1ZXVlLlF1ZXVlCiAgICAgICAgOnBhcmFtIHJlc3VsdF9xdWV1ZTogVGhlIHJlc3VsdCBxdWV1ZSB0byB1c2UKCiAgICAgICAgOnR5cGUgY2xpX3BhcmFtczogZGljdAogICAgICAgIDpwYXJhbSBjbGlfcGFyYW1zOiBUaGUgYXNzb2NpYXRlZCBDTEkgcGFyYW1ldGVycyBwYXNzZWQgaW4gdG8gdGhlCiAgICAgICAgICAgIGNvbW1hbmQgYXMgYSBkaWN0aW9uYXJ5LgogICAgICAgICIiIgogICAgICAgIHNlbGYuX3RyYW5zZmVyX21hbmFnZXIgPSB0cmFuc2Zlcl9tYW5hZ2VyCiAgICAgICAgc2VsZi5fcmVzdWx0X3F1ZXVlID0gcmVzdWx0X3F1ZXVlCiAgICAgICAgc2VsZi5fY2xpX3BhcmFtcyA9IGNsaV9wYXJhbXMKCiAgICBkZWYgc3VibWl0KHNlbGYsIGZpbGVpbmZvKToKICAgICAgICAiIiJTdWJtaXRzIGEgdHJhbnNmZXIgcmVxdWVzdCBiYXNlZCBvbiB0aGUgRmlsZUluZm8gcHJvdmlkZWQKCiAgICAgICAgVGhlcmUgaXMgbm8gZ3VhcmFudGVlIHRoYXQgdGhlIHRyYW5zZmVyIHJlcXVlc3Qgd2lsbCBiZSBtYWRlIG9uCiAgICAgICAgYmVoYWxmIG9mIHRoZSBmaWxlaW5mbyBhcyBhIGZpbGVpbmZvIG1heSBiZSBza2lwcGVkIGJhc2VkIG9uCiAgICAgICAgY2lyY3Vtc3RhbmNlcyBpbiB3aGljaCB0aGUgdHJhbnNmZXIgaXMgbm90IHBvc3NpYmxlLgoKICAgICAgICA6dHlwZSBmaWxlaW5mbzogYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLmZpbGVpbmZvLkZpbGVJbmZvCiAgICAgICAgOnBhcmFtIGZpbGVpbmZvOiBUaGUgRmlsZUluZm8gdG8gYmUgdXNlZCB0byBzdWJtaXQgYSB0cmFuc2ZlcgogICAgICAgICAgICByZXF1ZXN0IHRvIHRoZSB1bmRlcmx5aW5nIHRyYW5zZmVyIG1hbmFnZXIuCgogICAgICAgIDpydHlwZTogczN0cmFuc2Zlci5mdXR1cmVzLlRyYW5zZmVyRnV0dXJlCiAgICAgICAgOnJldHVybnM6IEEgVHJhbnNmZXJGdXR1cmUgcmVwcmVzZW50aW5nIHRoZSB0cmFuc2ZlciBpZiBpdCB0aGUKICAgICAgICAgICAgdHJhbnNmZXIgd2FzIHN1Ym1pdHRlZC4gSWYgaXQgd2FzIG5vdCBzdWJtaXR0ZWQgbm90aGluZwogICAgICAgICAgICBpcyByZXR1cm5lZC4KICAgICAgICAiIiIKICAgICAgICBzaG91bGRfc2tpcCA9IHNlbGYuX3dhcm5fYW5kX3NpZ25hbF9pZl9za2lwKGZpbGVpbmZvKQogICAgICAgIGlmIG5vdCBzaG91bGRfc2tpcDoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RvX3N1Ym1pdChmaWxlaW5mbykKCiAgICBkZWYgY2FuX3N1Ym1pdChzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgIiIiQ2hlY2tzIHdoZXRoZXIgaXQgY2FuIHN1Ym1pdCBhIHBhcnRpY3VsYXIgRmlsZUluZm8KCiAgICAgICAgOnR5cGUgZmlsZWluZm86IGF3c2NsaS5jdXN0b21pemF0aW9ucy5zMy5maWxlaW5mby5GaWxlSW5mbwogICAgICAgIDpwYXJhbSBmaWxlaW5mbzogVGhlIEZpbGVJbmZvIHRvIGNoZWNrIGlmIHRoZSB0cmFuc2ZlciByZXF1ZXN0CiAgICAgICAgICAgIHN1Ym1pdHRlciBjYW4gaGFuZGxlLgoKICAgICAgICA6cmV0dXJuczogVHJ1ZSBpZiBpdCBjYW4gdXNlIHRoZSBwcm92aWRlZCBGaWxlSW5mbyB0byBtYWtlIGEgdHJhbnNmZXIKICAgICAgICAgICAgcmVxdWVzdCB0byB0aGUgdW5kZXJseWluZyB0cmFuc2ZlciBtYW5hZ2VyLiBGYWxzZSwgb3RoZXJ3aXNlLgogICAgICAgICIiIgogICAgICAgIHJhaXNlIE5vdEltcGxlbWVudGVkRXJyb3IoJ2Nhbl9zdWJtaXQoKScpCgogICAgZGVmIF9kb19zdWJtaXQoc2VsZiwgZmlsZWluZm8pOgogICAgICAgIGV4dHJhX2FyZ3MgPSB7fQogICAgICAgIGlmIHNlbGYuUkVRVUVTVF9NQVBQRVJfTUVUSE9EOgogICAgICAgICAgICBzZWxmLlJFUVVFU1RfTUFQUEVSX01FVEhPRChleHRyYV9hcmdzLCBzZWxmLl9jbGlfcGFyYW1zKQogICAgICAgIHN1YnNjcmliZXJzID0gW10KICAgICAgICBzZWxmLl9hZGRfYWRkaXRpb25hbF9zdWJzY3JpYmVycyhzdWJzY3JpYmVycywgZmlsZWluZm8pCiAgICAgICAgIyBUaGUgcmVzdWx0IHN1YnNjcmliZXIgY2xhc3Mgc2hvdWxkIGFsd2F5cyBiZSB0aGUgbGFzdCByZWdpc3RlcmVkCiAgICAgICAgIyBzdWJzY3JpYmVyIHRvIGVuc3VyZSBpdCBpcyBub3QgbWlzc2luZyBhbnkgaW5mb3JtYXRpb24gdGhhdAogICAgICAgICMgbWF5IGhhdmUgYmVlbiBhZGRlZCBpbiBhIGRpZmZlcmVudCBzdWJzY3JpYmVyIHN1Y2ggYXMgc2l6ZS4KICAgICAgICBpZiBzZWxmLlJFU1VMVF9TVUJTQ1JJQkVSX0NMQVNTOgogICAgICAgICAgICByZXN1bHRfa3dhcmdzID0geydyZXN1bHRfcXVldWUnOiBzZWxmLl9yZXN1bHRfcXVldWV9CiAgICAgICAgICAgIGlmIHNlbGYuX2NsaV9wYXJhbXMuZ2V0KCdpc19tb3ZlJywgRmFsc2UpOgogICAgICAgICAgICAgICAgcmVzdWx0X2t3YXJnc1sndHJhbnNmZXJfdHlwZSddID0gJ21vdmUnCiAgICAgICAgICAgIHN1YnNjcmliZXJzLmFwcGVuZChzZWxmLlJFU1VMVF9TVUJTQ1JJQkVSX0NMQVNTKCoqcmVzdWx0X2t3YXJncykpCgogICAgICAgIGlmIG5vdCBzZWxmLl9jbGlfcGFyYW1zLmdldCgnZHJ5cnVuJyk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zdWJtaXRfdHJhbnNmZXJfcmVxdWVzdCgKICAgICAgICAgICAgICAgIGZpbGVpbmZvLCBleHRyYV9hcmdzLCBzdWJzY3JpYmVycykKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLl9zdWJtaXRfZHJ5cnVuKGZpbGVpbmZvKQoKICAgIGRlZiBfc3VibWl0X2RyeXJ1bihzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgdHJhbnNmZXJfdHlwZSA9IGZpbGVpbmZvLm9wZXJhdGlvbl9uYW1lCiAgICAgICAgaWYgc2VsZi5fY2xpX3BhcmFtcy5nZXQoJ2lzX21vdmUnLCBGYWxzZSk6CiAgICAgICAgICAgIHRyYW5zZmVyX3R5cGUgPSAnbW92ZScKICAgICAgICBzcmMsIGRlc3QgPSBzZWxmLl9mb3JtYXRfc3JjX2Rlc3QoZmlsZWluZm8pCiAgICAgICAgc2VsZi5fcmVzdWx0X3F1ZXVlLnB1dChEcnlSdW5SZXN1bHQoCiAgICAgICAgICAgIHRyYW5zZmVyX3R5cGU9dHJhbnNmZXJfdHlwZSwgc3JjPXNyYywgZGVzdD1kZXN0KSkKCiAgICBkZWYgX2FkZF9hZGRpdGlvbmFsX3N1YnNjcmliZXJzKHNlbGYsIHN1YnNjcmliZXJzLCBmaWxlaW5mbyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBfc3VibWl0X3RyYW5zZmVyX3JlcXVlc3Qoc2VsZiwgZmlsZWluZm8sIGV4dHJhX2FyZ3MsIHN1YnNjcmliZXJzKToKICAgICAgICByYWlzZSBOb3RJbXBsZW1lbnRlZEVycm9yKCdfc3VibWl0X3RyYW5zZmVyX3JlcXVlc3QoKScpCgogICAgZGVmIF93YXJuX2FuZF9zaWduYWxfaWZfc2tpcChzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgZm9yIHdhcm5pbmdfaGFuZGxlciBpbiBzZWxmLl9nZXRfd2FybmluZ19oYW5kbGVycygpOgogICAgICAgICAgICBpZiB3YXJuaW5nX2hhbmRsZXIoZmlsZWluZm8pOgogICAgICAgICAgICAgICAgIyBPbiB0aGUgZmlyc3Qgd2FybmluZyBoYW5kbGVyIHRoYXQgcmV0dXJucyBhIHNpZ25hbCB0byBza2lwCiAgICAgICAgICAgICAgICAjIGltbWVkaWF0ZWx5IHByb3BhZ2F0ZSB0aGlzIHNpZ25hbCBhbmQgbm8gbG9uZ2VyIGNoZWNrCiAgICAgICAgICAgICAgICAjIHRoZSBvdGhlciB3YXJuaW5nIGhhbmRsZXJzIGFzIG5vIG1hdHRlciB3aGF0IHRoZSBmaWxlIHdpbGwKICAgICAgICAgICAgICAgICMgYmUgc2tpcHBlZC4KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIF9nZXRfd2FybmluZ19oYW5kbGVycyhzZWxmKToKICAgICAgICAjIFJldHVybnMgYSBsaXN0IG9mIHdhcm5pbmcgaGFuZGxlcnMsIHdoaWNoIGFyZSBjYWxsYWJsZXMgdGhhdAogICAgICAgICMgdGFrZSBpbiBhIHNpbmdsZSBwYXJhbWV0ZXIgcmVwcmVzZW50aW5nIGEgRmlsZUluZm8uIEl0IHdpbGwgdGhlbgogICAgICAgICMgYWRkIGEgd2FybmluZyB0byByZXN1bHRfcXVldWUgaWYgbmVlZGVkIGFuZCByZXR1cm4gVHJ1ZSBpZgogICAgICAgICMgdGhhdCBGaWxlSW5mbyBzaG91bGQgYmUgc2tpcHBlZC4KICAgICAgICByZXR1cm4gW10KCiAgICBkZWYgX3Nob3VsZF9pbmplY3RfY29udGVudF90eXBlKHNlbGYpOgogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIHNlbGYuX2NsaV9wYXJhbXMuZ2V0KCdndWVzc19taW1lX3R5cGUnKSBhbmQKICAgICAgICAgICAgbm90IHNlbGYuX2NsaV9wYXJhbXMuZ2V0KCdjb250ZW50X3R5cGUnKQogICAgICAgICkKCiAgICBkZWYgX3dhcm5fZ2xhY2llcihzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgaWYgbm90IHNlbGYuX2NsaV9wYXJhbXMuZ2V0KCdmb3JjZV9nbGFjaWVyX3RyYW5zZmVyJyk6CiAgICAgICAgICAgIGlmIG5vdCBmaWxlaW5mby5pc19nbGFjaWVyX2NvbXBhdGlibGUoKToKICAgICAgICAgICAgICAgIExPR0dFUi5kZWJ1ZygKICAgICAgICAgICAgICAgICAgICAnRW5jb3VudGVyZWQgZ2xhY2llciBvYmplY3QgczM6Ly8lcy4gTm90IHBlcmZvcm1pbmcgJwogICAgICAgICAgICAgICAgICAgICclcyBvbiBvYmplY3QuJyAlIChmaWxlaW5mby5zcmMsIGZpbGVpbmZvLm9wZXJhdGlvbl9uYW1lKSkKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9jbGlfcGFyYW1zLmdldCgnaWdub3JlX2dsYWNpZXJfd2FybmluZ3MnKToKICAgICAgICAgICAgICAgICAgICB3YXJuaW5nID0gY3JlYXRlX3dhcm5pbmcoCiAgICAgICAgICAgICAgICAgICAgICAgICdzMzovLycrZmlsZWluZm8uc3JjLAogICAgICAgICAgICAgICAgICAgICAgICAnT2JqZWN0IGlzIG9mIHN0b3JhZ2UgY2xhc3MgR0xBQ0lFUi4gVW5hYmxlIHRvICcKICAgICAgICAgICAgICAgICAgICAgICAgJ3BlcmZvcm0gJXMgb3BlcmF0aW9ucyBvbiBHTEFDSUVSIG9iamVjdHMuIFlvdSBtdXN0ICcKICAgICAgICAgICAgICAgICAgICAgICAgJ3Jlc3RvcmUgdGhlIG9iamVjdCB0byBiZSBhYmxlIHRvIHBlcmZvcm0gdGhlICcKICAgICAgICAgICAgICAgICAgICAgICAgJ29wZXJhdGlvbi4gU2VlIGF3cyBzMyAlcyBoZWxwIGZvciBhZGRpdGlvbmFsICcKICAgICAgICAgICAgICAgICAgICAgICAgJ3BhcmFtZXRlciBvcHRpb25zIHRvIGlnbm9yZSBvciBmb3JjZSB0aGVzZSAnCiAgICAgICAgICAgICAgICAgICAgICAgICd0cmFuc2ZlcnMuJyAlCiAgICAgICAgICAgICAgICAgICAgICAgIChmaWxlaW5mby5vcGVyYXRpb25fbmFtZSwgZmlsZWluZm8ub3BlcmF0aW9uX25hbWUpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3Jlc3VsdF9xdWV1ZS5wdXQod2FybmluZykKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF93YXJuX3BhcmVudF9yZWZlcmVuY2Uoc2VsZiwgZmlsZWluZm8pOgogICAgICAgICMgbm9ybXBhdGgoKSB3aWxsIHVzZSB0aGUgT1MgcGF0aCBzZXBhcmF0b3Igc28gd2UKICAgICAgICAjIG5lZWQgdG8gdGFrZSB0aGF0IGludG8gYWNjb3VudCB3aGVuIGNoZWNraW5nIGZvciBhIHBhcmVudCBwcmVmaXguCiAgICAgICAgcGFyZW50X3ByZWZpeCA9ICcuLicgKyBvcy5wYXRoLnNlcAogICAgICAgIGVzY2FwZXNfY3dkID0gb3MucGF0aC5ub3JtcGF0aChmaWxlaW5mby5jb21wYXJlX2tleSkuc3RhcnRzd2l0aCgKICAgICAgICAgICAgcGFyZW50X3ByZWZpeCkKICAgICAgICBpZiBlc2NhcGVzX2N3ZDoKICAgICAgICAgICAgd2FybmluZyA9IGNyZWF0ZV93YXJuaW5nKAogICAgICAgICAgICAgICAgZmlsZWluZm8uY29tcGFyZV9rZXksICJGaWxlIHJlZmVyZW5jZXMgYSBwYXJlbnQgZGlyZWN0b3J5LiIpCiAgICAgICAgICAgIHNlbGYuX3Jlc3VsdF9xdWV1ZS5wdXQod2FybmluZykKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2Zvcm1hdF9zcmNfZGVzdChzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgIiIiUmV0dXJucyBmb3JtYXR0ZWQgdmVyc2lvbnMgb2YgYSBmaWxlaW5mb3Mgc291cmNlIGFuZCBkZXN0aW5hdGlvbi4iIiIKICAgICAgICByYWlzZSBOb3RJbXBsZW1lbnRlZEVycm9yKCdfZm9ybWF0X3NyY19kZXN0JykKCiAgICBkZWYgX2Zvcm1hdF9sb2NhbF9wYXRoKHNlbGYsIHBhdGgpOgogICAgICAgIHJldHVybiByZWxhdGl2ZV9wYXRoKHBhdGgpCgogICAgZGVmIF9mb3JtYXRfczNfcGF0aChzZWxmLCBwYXRoKToKICAgICAgICBpZiBwYXRoLnN0YXJ0c3dpdGgoJ3MzOi8vJyk6CiAgICAgICAgICAgIHJldHVybiBwYXRoCiAgICAgICAgcmV0dXJuICdzMzovLycgKyBwYXRoCgoKY2xhc3MgVXBsb2FkUmVxdWVzdFN1Ym1pdHRlcihCYXNlVHJhbnNmZXJSZXF1ZXN0U3VibWl0dGVyKToKICAgIFJFUVVFU1RfTUFQUEVSX01FVEhPRCA9IFJlcXVlc3RQYXJhbXNNYXBwZXIubWFwX3B1dF9vYmplY3RfcGFyYW1zCiAgICBSRVNVTFRfU1VCU0NSSUJFUl9DTEFTUyA9IFVwbG9hZFJlc3VsdFN1YnNjcmliZXIKCiAgICBkZWYgY2FuX3N1Ym1pdChzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgcmV0dXJuIGZpbGVpbmZvLm9wZXJhdGlvbl9uYW1lID09ICd1cGxvYWQnCgogICAgZGVmIF9hZGRfYWRkaXRpb25hbF9zdWJzY3JpYmVycyhzZWxmLCBzdWJzY3JpYmVycywgZmlsZWluZm8pOgogICAgICAgIHN1YnNjcmliZXJzLmFwcGVuZChQcm92aWRlU2l6ZVN1YnNjcmliZXIoZmlsZWluZm8uc2l6ZSkpCiAgICAgICAgaWYgc2VsZi5fc2hvdWxkX2luamVjdF9jb250ZW50X3R5cGUoKToKICAgICAgICAgICAgc3Vic2NyaWJlcnMuYXBwZW5kKFByb3ZpZGVVcGxvYWRDb250ZW50VHlwZVN1YnNjcmliZXIoKSkKICAgICAgICBpZiBzZWxmLl9jbGlfcGFyYW1zLmdldCgnaXNfbW92ZScsIEZhbHNlKToKICAgICAgICAgICAgc3Vic2NyaWJlcnMuYXBwZW5kKERlbGV0ZVNvdXJjZUZpbGVTdWJzY3JpYmVyKCkpCgogICAgZGVmIF9zdWJtaXRfdHJhbnNmZXJfcmVxdWVzdChzZWxmLCBmaWxlaW5mbywgZXh0cmFfYXJncywgc3Vic2NyaWJlcnMpOgogICAgICAgIGJ1Y2tldCwga2V5ID0gZmluZF9idWNrZXRfa2V5KGZpbGVpbmZvLmRlc3QpCiAgICAgICAgZmlsZWluID0gc2VsZi5fZ2V0X2ZpbGVpbihmaWxlaW5mbykKICAgICAgICByZXR1cm4gc2VsZi5fdHJhbnNmZXJfbWFuYWdlci51cGxvYWQoCiAgICAgICAgICAgIGZpbGVvYmo9ZmlsZWluLCBidWNrZXQ9YnVja2V0LCBrZXk9a2V5LAogICAgICAgICAgICBleHRyYV9hcmdzPWV4dHJhX2FyZ3MsIHN1YnNjcmliZXJzPXN1YnNjcmliZXJzCiAgICAgICAgKQoKICAgIGRlZiBfZ2V0X2ZpbGVpbihzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgcmV0dXJuIGZpbGVpbmZvLnNyYwoKICAgIGRlZiBfZ2V0X3dhcm5pbmdfaGFuZGxlcnMoc2VsZik6CiAgICAgICAgcmV0dXJuIFtzZWxmLl93YXJuX2lmX3Rvb19sYXJnZV0KCiAgICBkZWYgX3dhcm5faWZfdG9vX2xhcmdlKHNlbGYsIGZpbGVpbmZvKToKICAgICAgICBpZiBnZXRhdHRyKGZpbGVpbmZvLCAnc2l6ZScpIGFuZCBmaWxlaW5mby5zaXplID4gTUFYX1VQTE9BRF9TSVpFOgogICAgICAgICAgICBmaWxlX3BhdGggPSByZWxhdGl2ZV9wYXRoKGZpbGVpbmZvLnNyYykKICAgICAgICAgICAgd2FybmluZ19tZXNzYWdlID0gKAogICAgICAgICAgICAgICAgIkZpbGUgJXMgZXhjZWVkcyBzMyB1cGxvYWQgbGltaXQgb2YgJXMuIiAlICgKICAgICAgICAgICAgICAgICAgICBmaWxlX3BhdGgsIGh1bWFuX3JlYWRhYmxlX3NpemUoTUFYX1VQTE9BRF9TSVpFKSkpCiAgICAgICAgICAgIHdhcm5pbmcgPSBjcmVhdGVfd2FybmluZygKICAgICAgICAgICAgICAgIGZpbGVfcGF0aCwgd2FybmluZ19tZXNzYWdlLCBza2lwX2ZpbGU9RmFsc2UpCiAgICAgICAgICAgIHNlbGYuX3Jlc3VsdF9xdWV1ZS5wdXQod2FybmluZykKCiAgICBkZWYgX2Zvcm1hdF9zcmNfZGVzdChzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgc3JjID0gc2VsZi5fZm9ybWF0X2xvY2FsX3BhdGgoZmlsZWluZm8uc3JjKQogICAgICAgIGRlc3QgPSBzZWxmLl9mb3JtYXRfczNfcGF0aChmaWxlaW5mby5kZXN0KQogICAgICAgIHJldHVybiBzcmMsIGRlc3QKCgpjbGFzcyBEb3dubG9hZFJlcXVlc3RTdWJtaXR0ZXIoQmFzZVRyYW5zZmVyUmVxdWVzdFN1Ym1pdHRlcik6CiAgICBSRVFVRVNUX01BUFBFUl9NRVRIT0QgPSBSZXF1ZXN0UGFyYW1zTWFwcGVyLm1hcF9nZXRfb2JqZWN0X3BhcmFtcwogICAgUkVTVUxUX1NVQlNDUklCRVJfQ0xBU1MgPSBEb3dubG9hZFJlc3VsdFN1YnNjcmliZXIKCiAgICBkZWYgY2FuX3N1Ym1pdChzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgcmV0dXJuIGZpbGVpbmZvLm9wZXJhdGlvbl9uYW1lID09ICdkb3dubG9hZCcKCiAgICBkZWYgX2FkZF9hZGRpdGlvbmFsX3N1YnNjcmliZXJzKHNlbGYsIHN1YnNjcmliZXJzLCBmaWxlaW5mbyk6CiAgICAgICAgc3Vic2NyaWJlcnMuYXBwZW5kKFByb3ZpZGVTaXplU3Vic2NyaWJlcihmaWxlaW5mby5zaXplKSkKICAgICAgICBzdWJzY3JpYmVycy5hcHBlbmQoRGlyZWN0b3J5Q3JlYXRvclN1YnNjcmliZXIoKSkKICAgICAgICBzdWJzY3JpYmVycy5hcHBlbmQoUHJvdmlkZUxhc3RNb2RpZmllZFRpbWVTdWJzY3JpYmVyKAogICAgICAgICAgICBmaWxlaW5mby5sYXN0X3VwZGF0ZSwgc2VsZi5fcmVzdWx0X3F1ZXVlKSkKICAgICAgICBpZiBzZWxmLl9jbGlfcGFyYW1zLmdldCgnaXNfbW92ZScsIEZhbHNlKToKICAgICAgICAgICAgc3Vic2NyaWJlcnMuYXBwZW5kKERlbGV0ZVNvdXJjZU9iamVjdFN1YnNjcmliZXIoCiAgICAgICAgICAgICAgICBmaWxlaW5mby5zb3VyY2VfY2xpZW50KSkKCiAgICBkZWYgX3N1Ym1pdF90cmFuc2Zlcl9yZXF1ZXN0KHNlbGYsIGZpbGVpbmZvLCBleHRyYV9hcmdzLCBzdWJzY3JpYmVycyk6CiAgICAgICAgYnVja2V0LCBrZXkgPSBmaW5kX2J1Y2tldF9rZXkoZmlsZWluZm8uc3JjKQogICAgICAgIGZpbGVvdXQgPSBzZWxmLl9nZXRfZmlsZW91dChmaWxlaW5mbykKICAgICAgICByZXR1cm4gc2VsZi5fdHJhbnNmZXJfbWFuYWdlci5kb3dubG9hZCgKICAgICAgICAgICAgZmlsZW9iaj1maWxlb3V0LCBidWNrZXQ9YnVja2V0LCBrZXk9a2V5LAogICAgICAgICAgICBleHRyYV9hcmdzPWV4dHJhX2FyZ3MsIHN1YnNjcmliZXJzPXN1YnNjcmliZXJzCiAgICAgICAgKQoKICAgIGRlZiBfZ2V0X2ZpbGVvdXQoc2VsZiwgZmlsZWluZm8pOgogICAgICAgIHJldHVybiBmaWxlaW5mby5kZXN0CgogICAgZGVmIF9nZXRfd2FybmluZ19oYW5kbGVycyhzZWxmKToKICAgICAgICByZXR1cm4gW3NlbGYuX3dhcm5fZ2xhY2llciwgc2VsZi5fd2Fybl9wYXJlbnRfcmVmZXJlbmNlXQoKICAgIGRlZiBfZm9ybWF0X3NyY19kZXN0KHNlbGYsIGZpbGVpbmZvKToKICAgICAgICBzcmMgPSBzZWxmLl9mb3JtYXRfczNfcGF0aChmaWxlaW5mby5zcmMpCiAgICAgICAgZGVzdCA9IHNlbGYuX2Zvcm1hdF9sb2NhbF9wYXRoKGZpbGVpbmZvLmRlc3QpCiAgICAgICAgcmV0dXJuIHNyYywgZGVzdAoKCmNsYXNzIENvcHlSZXF1ZXN0U3VibWl0dGVyKEJhc2VUcmFuc2ZlclJlcXVlc3RTdWJtaXR0ZXIpOgogICAgUkVRVUVTVF9NQVBQRVJfTUVUSE9EID0gUmVxdWVzdFBhcmFtc01hcHBlci5tYXBfY29weV9vYmplY3RfcGFyYW1zCiAgICBSRVNVTFRfU1VCU0NSSUJFUl9DTEFTUyA9IENvcHlSZXN1bHRTdWJzY3JpYmVyCgogICAgZGVmIGNhbl9zdWJtaXQoc2VsZiwgZmlsZWluZm8pOgogICAgICAgIHJldHVybiBmaWxlaW5mby5vcGVyYXRpb25fbmFtZSA9PSAnY29weScKCiAgICBkZWYgX2FkZF9hZGRpdGlvbmFsX3N1YnNjcmliZXJzKHNlbGYsIHN1YnNjcmliZXJzLCBmaWxlaW5mbyk6CiAgICAgICAgc3Vic2NyaWJlcnMuYXBwZW5kKFByb3ZpZGVTaXplU3Vic2NyaWJlcihmaWxlaW5mby5zaXplKSkKICAgICAgICBpZiBzZWxmLl9zaG91bGRfaW5qZWN0X2NvbnRlbnRfdHlwZSgpOgogICAgICAgICAgICBzdWJzY3JpYmVycy5hcHBlbmQoUHJvdmlkZUNvcHlDb250ZW50VHlwZVN1YnNjcmliZXIoKSkKICAgICAgICBpZiBzZWxmLl9jbGlfcGFyYW1zLmdldCgnaXNfbW92ZScsIEZhbHNlKToKICAgICAgICAgICAgc3Vic2NyaWJlcnMuYXBwZW5kKERlbGV0ZUNvcHlTb3VyY2VPYmplY3RTdWJzY3JpYmVyKAogICAgICAgICAgICAgICAgZmlsZWluZm8uc291cmNlX2NsaWVudCkpCgogICAgZGVmIF9zdWJtaXRfdHJhbnNmZXJfcmVxdWVzdChzZWxmLCBmaWxlaW5mbywgZXh0cmFfYXJncywgc3Vic2NyaWJlcnMpOgogICAgICAgIGJ1Y2tldCwga2V5ID0gZmluZF9idWNrZXRfa2V5KGZpbGVpbmZvLmRlc3QpCiAgICAgICAgc291cmNlX2J1Y2tldCwgc291cmNlX2tleSA9IGZpbmRfYnVja2V0X2tleShmaWxlaW5mby5zcmMpCiAgICAgICAgY29weV9zb3VyY2UgPSB7J0J1Y2tldCc6IHNvdXJjZV9idWNrZXQsICdLZXknOiBzb3VyY2Vfa2V5fQogICAgICAgIHJldHVybiBzZWxmLl90cmFuc2Zlcl9tYW5hZ2VyLmNvcHkoCiAgICAgICAgICAgIGJ1Y2tldD1idWNrZXQsIGtleT1rZXksIGNvcHlfc291cmNlPWNvcHlfc291cmNlLAogICAgICAgICAgICBleHRyYV9hcmdzPWV4dHJhX2FyZ3MsIHN1YnNjcmliZXJzPXN1YnNjcmliZXJzLAogICAgICAgICAgICBzb3VyY2VfY2xpZW50PWZpbGVpbmZvLnNvdXJjZV9jbGllbnQKICAgICAgICApCgogICAgZGVmIF9nZXRfd2FybmluZ19oYW5kbGVycyhzZWxmKToKICAgICAgICByZXR1cm4gW3NlbGYuX3dhcm5fZ2xhY2llcl0KCiAgICBkZWYgX2Zvcm1hdF9zcmNfZGVzdChzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgc3JjID0gc2VsZi5fZm9ybWF0X3MzX3BhdGgoZmlsZWluZm8uc3JjKQogICAgICAgIGRlc3QgPSBzZWxmLl9mb3JtYXRfczNfcGF0aChmaWxlaW5mby5kZXN0KQogICAgICAgIHJldHVybiBzcmMsIGRlc3QKCgpjbGFzcyBVcGxvYWRTdHJlYW1SZXF1ZXN0U3VibWl0dGVyKFVwbG9hZFJlcXVlc3RTdWJtaXR0ZXIpOgogICAgUkVTVUxUX1NVQlNDUklCRVJfQ0xBU1MgPSBVcGxvYWRTdHJlYW1SZXN1bHRTdWJzY3JpYmVyCgogICAgZGVmIGNhbl9zdWJtaXQoc2VsZiwgZmlsZWluZm8pOgogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGZpbGVpbmZvLm9wZXJhdGlvbl9uYW1lID09ICd1cGxvYWQnIGFuZAogICAgICAgICAgICBzZWxmLl9jbGlfcGFyYW1zLmdldCgnaXNfc3RyZWFtJykKICAgICAgICApCgogICAgZGVmIF9hZGRfYWRkaXRpb25hbF9zdWJzY3JpYmVycyhzZWxmLCBzdWJzY3JpYmVycywgZmlsZWluZm8pOgogICAgICAgIGV4cGVjdGVkX3NpemUgPSBzZWxmLl9jbGlfcGFyYW1zLmdldCgnZXhwZWN0ZWRfc2l6ZScsIE5vbmUpCiAgICAgICAgaWYgZXhwZWN0ZWRfc2l6ZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgc3Vic2NyaWJlcnMuYXBwZW5kKFByb3ZpZGVTaXplU3Vic2NyaWJlcihpbnQoZXhwZWN0ZWRfc2l6ZSkpKQoKICAgIGRlZiBfZ2V0X2ZpbGVpbihzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgYmluYXJ5X3N0ZGluID0gZ2V0X2JpbmFyeV9zdGRpbigpCiAgICAgICAgcmV0dXJuIE5vblNlZWthYmxlU3RyZWFtKGJpbmFyeV9zdGRpbikKCiAgICBkZWYgX2Zvcm1hdF9sb2NhbF9wYXRoKHNlbGYsIHBhdGgpOgogICAgICAgIHJldHVybiAnLScKCgpjbGFzcyBEb3dubG9hZFN0cmVhbVJlcXVlc3RTdWJtaXR0ZXIoRG93bmxvYWRSZXF1ZXN0U3VibWl0dGVyKToKICAgIFJFU1VMVF9TVUJTQ1JJQkVSX0NMQVNTID0gRG93bmxvYWRTdHJlYW1SZXN1bHRTdWJzY3JpYmVyCgogICAgZGVmIGNhbl9zdWJtaXQoc2VsZiwgZmlsZWluZm8pOgogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGZpbGVpbmZvLm9wZXJhdGlvbl9uYW1lID09ICdkb3dubG9hZCcgYW5kCiAgICAgICAgICAgIHNlbGYuX2NsaV9wYXJhbXMuZ2V0KCdpc19zdHJlYW0nKQogICAgICAgICkKCiAgICBkZWYgX2FkZF9hZGRpdGlvbmFsX3N1YnNjcmliZXJzKHNlbGYsIHN1YnNjcmliZXJzLCBmaWxlaW5mbyk6CiAgICAgICAgcGFzcwoKICAgIGRlZiBfZ2V0X2ZpbGVvdXQoc2VsZiwgZmlsZWluZm8pOgogICAgICAgIHJldHVybiBTdGRvdXRCeXRlc1dyaXRlcigpCgogICAgZGVmIF9mb3JtYXRfbG9jYWxfcGF0aChzZWxmLCBwYXRoKToKICAgICAgICByZXR1cm4gJy0nCgoKY2xhc3MgRGVsZXRlUmVxdWVzdFN1Ym1pdHRlcihCYXNlVHJhbnNmZXJSZXF1ZXN0U3VibWl0dGVyKToKICAgIFJFUVVFU1RfTUFQUEVSX01FVEhPRCA9IFJlcXVlc3RQYXJhbXNNYXBwZXIubWFwX2RlbGV0ZV9vYmplY3RfcGFyYW1zCiAgICBSRVNVTFRfU1VCU0NSSUJFUl9DTEFTUyA9IERlbGV0ZVJlc3VsdFN1YnNjcmliZXIKCiAgICBkZWYgY2FuX3N1Ym1pdChzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgcmV0dXJuIGZpbGVpbmZvLm9wZXJhdGlvbl9uYW1lID09ICdkZWxldGUnIGFuZCBcCiAgICAgICAgICAgIGZpbGVpbmZvLnNyY190eXBlID09ICdzMycKCiAgICBkZWYgX3N1Ym1pdF90cmFuc2Zlcl9yZXF1ZXN0KHNlbGYsIGZpbGVpbmZvLCBleHRyYV9hcmdzLCBzdWJzY3JpYmVycyk6CiAgICAgICAgYnVja2V0LCBrZXkgPSBmaW5kX2J1Y2tldF9rZXkoZmlsZWluZm8uc3JjKQogICAgICAgIHJldHVybiBzZWxmLl90cmFuc2Zlcl9tYW5hZ2VyLmRlbGV0ZSgKICAgICAgICAgICAgYnVja2V0PWJ1Y2tldCwga2V5PWtleSwgZXh0cmFfYXJncz1leHRyYV9hcmdzLAogICAgICAgICAgICBzdWJzY3JpYmVycz1zdWJzY3JpYmVycykKCiAgICBkZWYgX2Zvcm1hdF9zcmNfZGVzdChzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgcmV0dXJuIHNlbGYuX2Zvcm1hdF9zM19wYXRoKGZpbGVpbmZvLnNyYyksIE5vbmUKCgpjbGFzcyBMb2NhbERlbGV0ZVJlcXVlc3RTdWJtaXR0ZXIoQmFzZVRyYW5zZmVyUmVxdWVzdFN1Ym1pdHRlcik6CiAgICBSRVFVRVNUX01BUFBFUl9NRVRIT0QgPSBOb25lCiAgICBSRVNVTFRfU1VCU0NSSUJFUl9DTEFTUyA9IE5vbmUKCiAgICBkZWYgY2FuX3N1Ym1pdChzZWxmLCBmaWxlaW5mbyk6CiAgICAgICAgcmV0dXJuIGZpbGVpbmZvLm9wZXJhdGlvbl9uYW1lID09ICdkZWxldGUnIGFuZCBcCiAgICAgICAgICAgIGZpbGVpbmZvLnNyY190eXBlID09ICdsb2NhbCcKCiAgICBkZWYgX3N1Ym1pdF90cmFuc2Zlcl9yZXF1ZXN0KHNlbGYsIGZpbGVpbmZvLCBleHRyYV9hcmdzLCBzdWJzY3JpYmVycyk6CiAgICAgICAgIyBUaGlzIGlzIHF1aXJreSBidXQgZXNzZW50aWFsbHkgaW5zdGVhZCBvZiByZWx5aW5nIG9uIGEgYnVpbHQtaW4KICAgICAgICAjIG1ldGhvZCBvZiBzMyB0cmFuc2ZlciwgdGhlIGxvZ2ljIGxpdmVzIGRpcmVjdGx5IGluIHRoZSBzdWJtaXR0ZXIuCiAgICAgICAgIyBUaGUgcmVhc29uIGEgZXhwbGljaXQgZGVsZXRlIGxvY2FsIGZpbGUgZG9lcyBub3QKICAgICAgICAjIGxpdmUgaW4gczN0cmFuc2ZlciBpcyBiZWNhdXNlIGl0IGlzIG91dHNpZGUgdGhlIHNjb3BlIG9mIHMzdHJhbnNmZXI7CiAgICAgICAgIyBpdCBzaG91bGQgb25seSBoYXZlIGludGVyZmFjZXMgZm9yIGludGVyYWN0aW5nIHdpdGggUzMuIFRoZXJlZm9yZSwKICAgICAgICAjIHRoZSBidXJkZW4gb2YgdGhpcyBmdW5jdGlvbmFsaXR5IHNob3VsZCBsaXZlIGluIHRoZSBDTEkuCgogICAgICAgICMgVGhlIG1haW4gZG93bnNpZGVzIGluIGRvaW5nIHRoaXMgaXMgdGhhdCBkZWxldGUgYW5kIHRoZSByZXN1bHQKICAgICAgICAjIGNyZWF0aW9uIGhhcHBlbnMgaW4gdGhlIG1haW4gdGhyZWFkIGFzIG9wcG9zZWQgdG8gYSBzZXBhcmF0ZSB0aHJlYWQKICAgICAgICAjIGluIHMzdHJhbnNmZXIuIEhvd2V2ZXIsIHRoaXMgaXMgbm90IHRvbyBiaWcgb2YgYSBkb3duc2lkZSBiZWNhdXNlCiAgICAgICAgIyBkZWxldGluZyBhIGxvY2FsIGZpbGUgb25seSBoYXBwZW5zIGZvciBzeW5jIC0tZGVsZXRlIGRvd25sb2FkcyBhbmQKICAgICAgICAjIGlzIHZlcnkgZmFzdCBjb21wYXJlZCB0byBhbGwgb2YgdGhlIG90aGVyIHR5cGVzIG9mIHRyYW5zZmVycy4KICAgICAgICBzcmMsIGRlc3QgPSBzZWxmLl9mb3JtYXRfc3JjX2Rlc3QoZmlsZWluZm8pCiAgICAgICAgcmVzdWx0X2t3YXJncyA9IHsKICAgICAgICAgICAgJ3RyYW5zZmVyX3R5cGUnOiAnZGVsZXRlJywKICAgICAgICAgICAgJ3NyYyc6IHNyYywKICAgICAgICAgICAgJ2Rlc3QnOiBkZXN0CiAgICAgICAgfQogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5fcmVzdWx0X3F1ZXVlLnB1dChRdWV1ZWRSZXN1bHQoCiAgICAgICAgICAgICAgICB0b3RhbF90cmFuc2Zlcl9zaXplPTAsICoqcmVzdWx0X2t3YXJncykpCiAgICAgICAgICAgIG9zLnJlbW92ZShmaWxlaW5mby5zcmMpCiAgICAgICAgICAgIHNlbGYuX3Jlc3VsdF9xdWV1ZS5wdXQoU3VjY2Vzc1Jlc3VsdCgqKnJlc3VsdF9rd2FyZ3MpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5fcmVzdWx0X3F1ZXVlLnB1dCgKICAgICAgICAgICAgICAgIEZhaWx1cmVSZXN1bHQoZXhjZXB0aW9uPWUsICoqcmVzdWx0X2t3YXJncykpCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgIyBSZXR1cm4gVHJ1ZSB0byBpbmRpY2F0ZSB0aGF0IHRoZSB0cmFuc2ZlciB3YXMgc3VibWl0dGVkCiAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIF9mb3JtYXRfc3JjX2Rlc3Qoc2VsZiwgZmlsZWluZm8pOgogICAgICAgIHJldHVybiBzZWxmLl9mb3JtYXRfbG9jYWxfcGF0aChmaWxlaW5mby5zcmMpLCBOb25lCg==
