statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/shaasigma/2.0.0/shaasigma-2.0.0/shaasigma-2.0.0/shaasigma/__init__.py
  contents:
  - name: TimeDelta.__repr__
    score: 0.0
    code: |-
      def __repr__(self):
              return f"datetime2.{type(self).__name__}('{self.fractional_days!s}')"
    tokens: TARGETED_FILE resume load_const datetime2. load_global type load_fast self call load_attr __name__ format_value INTEGER load_const (' load_fast self load_attr fractional_days format_value INTEGER load_const ') build_string return_value
    hash: 80f47d7813ade8cdd3e9fb9cbedb4de3d3d8826f695ae68deed496aa2cf968af
sources:
  .repo_cache/malicious_repos/pypi_malregistry/shaasigma/2.0.0/shaasigma-2.0.0/shaasigma-2.0.0/shaasigma/__init__.py: IyBkYXRldGltZTIgcGFja2FnZSBtYWluIGZpbGUKCiMgQ29weXJpZ2h0IChjKSAyMDExLTIwMjIgRnJhbmNlc2NvIFJpY2NpYXJkaQojCiMgQWxsIHJpZ2h0cyByZXNlcnZlZC4KIwojIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAojIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgojCiMgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiMgICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgojICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAojICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgojICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiMgKiBOZWl0aGVyIHRoZSBuYW1lKHMpIG9mIHRoZSBjb3B5cmlnaHQgaG9sZGVycyBub3IgdGhlIG5hbWVzIG9mIGl0cwojICAgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcwojICAgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiMKIyBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBUyBJUyBBTkQgQU5ZIEVYUFJFU1MgT1IKIyBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GCiMgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk8KIyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwKIyBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UCiMgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsCiMgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRgojIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HCiMgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLAojIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCgpfX2F1dGhvcl9fID0gIkZyYW5jZXNjbyBSaWNjaWFyZGkgPGZyYW5jZXNjb3IyMDEwIGF0IHlhaG9vLml0PiIKCgppbXBvcnQgbnVtYmVycwppbXBvcnQgdGltZQpmcm9tIGRlY2ltYWwgaW1wb3J0IERlY2ltYWwKZnJvbSBmcmFjdGlvbnMgaW1wb3J0IEZyYWN0aW9uCmZyb20gbWF0aCBpbXBvcnQgZmxvb3IKCmZyb20gLmNvbW1vbiBpbXBvcnQgdmVyaWZ5X2ZyYWN0aW9uYWxfdmFsdWUsIHZlcmlmeV9mcmFjdGlvbmFsX3ZhbHVlX251bV9kZW4KZnJvbSAuIGltcG9ydCB3ZXN0ZXJuLCBtb2Rlcm4KCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBPUyBkZXBlbmRlbnQgZnVuY3Rpb25zCiMKZGVmIGdldF9tb21lbnRfY29tcGxldGUoKToKICAgICIiIlJldHVybiBsb2NhbCBkYXRlIGFuZCB0aW1lIGFzIGRheV9jb3VudCwgbG9jYWwgdGltZSBhcyBkYXkgZnJhY3Rpb24sIGFuZCwKICAgIGlmIHBvc3NpYmxlLCBkaXN0YW5jZSBmcm9tIFVUQyBhcyBmcmFjdGlvbiBvZiBhIGRheS4iIiIKICAgIHRyeToKICAgICAgICBtb21lbnRfbnMgPSAodGltZS50aW1lX25zKCkpICAjIHRpbWUgaW4gbnMgZnJvbSBlcG9jaDsgbm90ZSBlcG9jaCBpcyBwbGF0Zm9ybSBkZXBlbmRlbnQKICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvcjoKICAgICAgICBtb21lbnRfbnMgPSBpbnQodGltZS50aW1lKCkgKiAxXzAwMF8wMDBfMDAwKSAgIyB0aW1lKCkgcmV0dXJucyBhIGZsb2F0IGluIHNlY29uZAogICAgIyBmb3IgdGhlIG1vbWVudCB3ZSBhcmUgdXNpbmcgdGltZSBtb2R1bGUncyBmdW5jdGlvbnMgdG8gZ2V0IGxvY2FsdGltZQogICAgIyBUT0RPOiBjaGVjayBpZiBwb3NzaWJsZSB0byBpbXBsZW1lbnQgc29tZXRoaW5nIGluZGVwZW5kZW50IGZyb20gdGltZSBtb2R1bGUsIHNlZSBlLmcuIHR6bG9jYWwKICAgIHNlY29uZHMsIG5hbm9zZWNvbmRzID0gZGl2bW9kKG1vbWVudF9ucywgMV8wMDBfMDAwXzAwMCkKICAgIG1vbWVudCA9IHRpbWUubG9jYWx0aW1lKHNlY29uZHMpCiAgICB5ZWFyID0gbW9tZW50LnRtX3llYXIKICAgIGRheXNfYmVmb3JlX3llYXIgPSAoKHllYXIgLSAxKSAqIDM2NSArICh5ZWFyIC0gMSkgLy8gNCAtICh5ZWFyIC0gMSkgLy8gMTAwICsgKHllYXIgLSAxKSAvLyA0MDApCiAgICBkYXlfY291bnQgPSBkYXlzX2JlZm9yZV95ZWFyICsgbW9tZW50LnRtX3lkYXkKICAgIGRheV9mcmFjID0gKEZyYWN0aW9uKG1vbWVudC50bV9ob3VyLCAyNCkgICArIEZyYWN0aW9uKG1vbWVudC50bV9taW4sIDE0NDApICsKICAgICAgICAgICAgICAgIEZyYWN0aW9uKG1vbWVudC50bV9zZWMsIDg2NDAwKSArIEZyYWN0aW9uKG5hbm9zZWNvbmRzLCA4Nl80MDBfMDAwXzAwMF8wMDApKQogICAgdXRjb2Zmc2V0ID0gRnJhY3Rpb24obW9tZW50LnRtX2dtdG9mZiwgODY0MDApCiAgICByZXR1cm4gZGF5X2NvdW50LCBkYXlfZnJhYywgdXRjb2Zmc2V0CgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyBEYXRlCiMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgoKY2xhc3MgRGF0ZToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkYXlfY291bnQpOgogICAgICAgICMgVE9ETzogY29uc2lkZXIgdXNpbmcgdGhlIG51bWJlciBoaWVyYXJjaHkKICAgICAgICBpZiBpc2luc3RhbmNlKGRheV9jb3VudCwgaW50KToKICAgICAgICAgICAgc2VsZi5fZGF5X2NvdW50ID0gZGF5X2NvdW50CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJkYXlfY291bnQgYXJndW1lbnQgZm9yIERhdGUgbXVzdCBiZSBhbiBpbnRlZ2VyLiIpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgdG9kYXkoY2xzKToKICAgICAgICByZXR1cm4gY2xzKGdldF9tb21lbnRfY29tcGxldGUoKVswXSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBkYXlfY291bnQoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2RheV9jb3VudAoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gZiJkYXRldGltZTIue3R5cGUoc2VsZikuX19uYW1lX199KHtzZWxmLmRheV9jb3VudH0pIgoKICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgIHJldHVybiBmIlIuRC4ge3NlbGYuZGF5X2NvdW50fSIKCiAgICBkZWYgX19hZGRfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgaWYgbm90IG90aGVyLmlzX2ludGVnZXIoKToKICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIkRhdGUgb2JqZWN0IGNhbm5vdCBiZSBhZGRlZCB0byBub24gaW50ZWdyYWwgVGltZURlbHRhLiIpCiAgICAgICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHNlbGYuZGF5X2NvdW50ICsgaW50KG90aGVyLmZyYWN0aW9uYWxfZGF5cykpICAgIyBub3RlOiBmcmFjdGlvbmFsIGRheXMgaXMgYSBGcmFjdGlvbgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAoKICAgIF9fcmFkZF9fID0gX19hZGRfXwoKICAgIGRlZiBfX3N1Yl9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBEYXRlKToKICAgICAgICAgICAgcmV0dXJuIFRpbWVEZWx0YShzZWxmLmRheV9jb3VudCAtIG90aGVyLmRheV9jb3VudCkKICAgICAgICBlbGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWVEZWx0YSk6CiAgICAgICAgICAgIGlmIG5vdCBvdGhlci5pc19pbnRlZ2VyKCk6CiAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJOb24gaW50ZWdyYWwgVGltZURlbHRhIGNhbm5vdCBiZSBzdWJ0cmFjdGVkIGZyb20gRGF0ZS4iKQogICAgICAgICAgICByZXR1cm4gdHlwZShzZWxmKShzZWxmLmRheV9jb3VudCAtIGludChvdGhlci5mcmFjdGlvbmFsX2RheXMpKSAgICMgbm90ZTogZnJhY3Rpb25hbCBkYXlzIGlzIGEgRnJhY3Rpb24KICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKCiAgICAjIENvbXBhcmlzb24gb3BlcmF0b3JzCiAgICBkZWYgX19lcV9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBEYXRlKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2NvdW50ID09IG90aGVyLmRheV9jb3VudAogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImRheV9jb3VudCIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX19uZV9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBEYXRlKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2NvdW50ICE9IG90aGVyLmRheV9jb3VudAogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImRheV9jb3VudCIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBfX2d0X18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIERhdGUpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5kYXlfY291bnQgPiBvdGhlci5kYXlfY291bnQKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJkYXlfY291bnQiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKGYiWW91IGNhbm5vdCBjb21wYXJlICd7dHlwZShzZWxmKSFzfScgd2l0aCAne3R5cGUob3RoZXIpIXN9Jy4iKQoKICAgIGRlZiBfX2dlX18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIERhdGUpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5kYXlfY291bnQgPj0gb3RoZXIuZGF5X2NvdW50CiAgICAgICAgZWxpZiBoYXNhdHRyKG90aGVyLCAiZGF5X2NvdW50Iik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihmIllvdSBjYW5ub3QgY29tcGFyZSAne3R5cGUoc2VsZikhc30nIHdpdGggJ3t0eXBlKG90aGVyKSFzfScuIikKCiAgICBkZWYgX19sdF9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBEYXRlKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2NvdW50IDwgb3RoZXIuZGF5X2NvdW50CiAgICAgICAgZWxpZiBoYXNhdHRyKG90aGVyLCAiZGF5X2NvdW50Iik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihmIllvdSBjYW5ub3QgY29tcGFyZSAne3R5cGUoc2VsZikhc30nIHdpdGggJ3t0eXBlKG90aGVyKSFzfScuIikKCiAgICBkZWYgX19sZV9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBEYXRlKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2NvdW50IDw9IG90aGVyLmRheV9jb3VudAogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImRheV9jb3VudCIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoZiJZb3UgY2Fubm90IGNvbXBhcmUgJ3t0eXBlKHNlbGYpIXN9JyB3aXRoICd7dHlwZShvdGhlcikhc30nLiIpCgogICAgIyBoYXNoIHZhbHVlCiAgICBkZWYgX19oYXNoX18oc2VsZik6CiAgICAgICAgcmV0dXJuIGhhc2goc2VsZi5fZGF5X2NvdW50KQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIHJlZ2lzdGVyX25ld19jYWxlbmRhcihjbHMsIGF0dHJpYnV0ZV9uYW1lLCBjYWxlbmRhcl9jbGFzcyk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UoYXR0cmlidXRlX25hbWUsIHN0cikgb3Igbm90IGF0dHJpYnV0ZV9uYW1lLmlzaWRlbnRpZmllcigpOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYiSW52YWxpZCBjYWxlbmRhciBhdHRyaWJ1dGUgbmFtZToge2F0dHJpYnV0ZV9uYW1lfS4iKQogICAgICAgIGlmIGhhc2F0dHIoY2xzLCBhdHRyaWJ1dGVfbmFtZSk6CiAgICAgICAgICAgIHJhaXNlIEF0dHJpYnV0ZUVycm9yKGYiQ2FsZW5kYXIgYXR0cmlidXRlIGFscmVhZHkgZXhpc3Rpbmc6IHthdHRyaWJ1dGVfbmFtZX0uIikKICAgICAgICBpZiBub3QgaGFzYXR0cihjYWxlbmRhcl9jbGFzcywgImZyb21fcmF0YV9kaWUiKToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJDYWxlbmRhciBjbGFzcyBkb2VzIG5vdCBoYXZlIG1ldGhvZCBmcm9tX3JhdGFfZGllLiIpCiAgICAgICAgaWYgbm90IGhhc2F0dHIoY2FsZW5kYXJfY2xhc3MsICJ0b19yYXRhX2RpZSIpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoIkNhbGVuZGFyIGNsYXNzIGRvZXMgbm90IGhhdmUgbWV0aG9kIHRvX3JhdGFfZGllLiIpCgogICAgICAgIGNsYXNzIE1vZGlmaWVkQ2xhc3ModHlwZSk6CiAgICAgICAgICAgIGRlZiBfX2NhbGxfXyhrbGFzcywgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAgICAgICAgIGNhbGVuZGFyX29iaiA9IHN1cGVyKCkuX19jYWxsX18oKmFyZ3MsICoqa3dhcmdzKQogICAgICAgICAgICAgICAgZGF0ZV9vYmogPSBjbHMoY2FsZW5kYXJfb2JqLnRvX3JhdGFfZGllKCkpCiAgICAgICAgICAgICAgICBzZXRhdHRyKGRhdGVfb2JqLCBhdHRyaWJ1dGVfbmFtZSwgY2FsZW5kYXJfb2JqKQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVfb2JqCgogICAgICAgICMgQ3JlYXRlIHRoZSBtb2RpZmllZCBjYWxlbmRhciBjbGFzcwogICAgICAgIG5ld19jbGFzc19uYW1lID0gZiJ7Y2FsZW5kYXJfY2xhc3MuX19uYW1lX199SW57Y2xzLl9fbmFtZV9ffSIKICAgICAgICBtb2RpZmllZF9jYWxlbmRhcl9jbGFzcyA9IE1vZGlmaWVkQ2xhc3MobmV3X2NsYXNzX25hbWUsIChjYWxlbmRhcl9jbGFzcywpLCB7fSkKCiAgICAgICAgY2xhc3MgQ2FsZW5kYXJBdHRyaWJ1dGU6CiAgICAgICAgICAgICMgVGhpcyBjbGFzcyBpbXBsZW1lbnRzIGEgY29udGV4dCBkZXBlbmRlbnQgYXR0cmlidXRlCiAgICAgICAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBhdHRyX25hbWUsIG1vZGlmX2NhbGVuZGFyX2NsYXNzKToKICAgICAgICAgICAgICAgIHNlbGYuYXR0cmlidXRlX25hbWUgPSBhdHRyX25hbWUKICAgICAgICAgICAgICAgIHNlbGYubW9kaWZpZWRfY2FsZW5kYXJfY2xhc3MgPSBtb2RpZl9jYWxlbmRhcl9jbGFzcwoKICAgICAgICAgICAgZGVmIF9fZ2V0X18oc2VsZiwgaW5zdGFuY2UsIG93bmVyKToKICAgICAgICAgICAgICAgIGlmIGluc3RhbmNlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYubW9kaWZpZWRfY2FsZW5kYXJfY2xhc3MKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0IHNlbGYuYXR0cmlidXRlX25hbWUgbm90IGluIGluc3RhbmNlLl9fZGljdF9fCiAgICAgICAgICAgICAgICAgICAgZGF0ZV9vYmogPSBzZWxmLm1vZGlmaWVkX2NhbGVuZGFyX2NsYXNzLmZyb21fcmF0YV9kaWUoaW5zdGFuY2UuZGF5X2NvdW50KQogICAgICAgICAgICAgICAgICAgIGNhbGVuZGFyX29iaiA9IGdldGF0dHIoZGF0ZV9vYmosIHNlbGYuYXR0cmlidXRlX25hbWUpCiAgICAgICAgICAgICAgICAgICAgc2V0YXR0cihpbnN0YW5jZSwgc2VsZi5hdHRyaWJ1dGVfbmFtZSwgY2FsZW5kYXJfb2JqKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxlbmRhcl9vYmoKCiAgICAgICAgc2V0YXR0cihjbHMsIGF0dHJpYnV0ZV9uYW1lLCBDYWxlbmRhckF0dHJpYnV0ZShhdHRyaWJ1dGVfbmFtZSwgbW9kaWZpZWRfY2FsZW5kYXJfY2xhc3MpKQoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIFJlZ2lzdGVyIGN1cnJlbnQgY2FsZW5kYXJzCiMKRGF0ZS5yZWdpc3Rlcl9uZXdfY2FsZW5kYXIoImdyZWdvcmlhbiIsIHdlc3Rlcm4uR3JlZ29yaWFuQ2FsZW5kYXIpCkRhdGUucmVnaXN0ZXJfbmV3X2NhbGVuZGFyKCJpc28iLCBtb2Rlcm4uSXNvQ2FsZW5kYXIpCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyBUaW1lCiMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgoKY2xhc3MgVGltZToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBudW1lcmF0b3IsIGRlbm9taW5hdG9yPU5vbmUsICosIHV0Y29mZnNldD1Ob25lKToKICAgICAgICBpZiBkZW5vbWluYXRvciBpcyBOb25lOgogICAgICAgICAgICBzZWxmLl9kYXlfZnJhYyA9IHZlcmlmeV9mcmFjdGlvbmFsX3ZhbHVlKG51bWVyYXRvciwgbWluPTAsIG1heF9leGNsPTEpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5fZGF5X2ZyYWMgPSB2ZXJpZnlfZnJhY3Rpb25hbF92YWx1ZV9udW1fZGVuKG51bWVyYXRvciwgZGVub21pbmF0b3IsIG1pbj0wLCBtYXhfZXhjbD0xKQogICAgICAgIGlmIHV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICAjIG5haXZlIGluc3RhbmNlCiAgICAgICAgICAgIHNlbGYuX3V0Y29mZnNldCA9IE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIGF3YXJlIGluc3RhbmNlCiAgICAgICAgICAgIHNlbGYuX3V0Y29mZnNldCA9IHZlcmlmeV9mcmFjdGlvbmFsX3ZhbHVlKHV0Y29mZnNldCwgbWluPS0xLCBtYXg9MSkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBub3coY2xzLCB1dGNvZmZzZXQ9Tm9uZSk6CiAgICAgICAgY3VycmVudF9tb21lbnQgPSBnZXRfbW9tZW50X2NvbXBsZXRlKCkKICAgICAgICBpZiB1dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIGNscyhjdXJyZW50X21vbWVudFsxXSwgdXRjb2Zmc2V0PWN1cnJlbnRfbW9tZW50WzJdKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHZhbGlkX3V0Y29mZnNldCA9IHZlcmlmeV9mcmFjdGlvbmFsX3ZhbHVlKHV0Y29mZnNldCwgbWluPS0xLCBtYXg9MSkKICAgICAgICAgICAgZGVsdGEgPSBjdXJyZW50X21vbWVudFsyXSAtIHZhbGlkX3V0Y29mZnNldAogICAgICAgICAgICBkYXlfZnJhY190ZW1wID0gY3VycmVudF9tb21lbnRbMV0gLSBkZWx0YSArIDIgICMgKzIgbmVlZGVkIHRvIGF2b2lkIHVuZGVycnVucwogICAgICAgICAgICBuZXdfZGF5X2ZyYWMgPSBkYXlfZnJhY190ZW1wIC0gaW50KGRheV9mcmFjX3RlbXApICAjIGFzIHNvIHdlIGVsaW1pbmF0ZSB0aGUgKzIgYWJvdmUKICAgICAgICAgICAgcmV0dXJuIGNscyhuZXdfZGF5X2ZyYWMsIHV0Y29mZnNldD12YWxpZF91dGNvZmZzZXQpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgbG9jYWxub3coY2xzKToKICAgICAgICBjdXJyZW50X21vbWVudCA9IGdldF9tb21lbnRfY29tcGxldGUoKQogICAgICAgIHJldHVybiBjbHMoY3VycmVudF9tb21lbnRbMV0pCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgdXRjbm93KGNscyk6CiAgICAgICAgY3VycmVudF9tb21lbnQgPSBnZXRfbW9tZW50X2NvbXBsZXRlKCkKICAgICAgICB1dGNub3cgPSBjdXJyZW50X21vbWVudFsxXSAtIGN1cnJlbnRfbW9tZW50WzJdCiAgICAgICAgaWYgdXRjbm93IDwgMDoKICAgICAgICAgICAgdXRjbm93ICs9IDEKICAgICAgICBlbGlmIHV0Y25vdyA+PSAxOgogICAgICAgICAgICB1dGNub3cgLT0gMQogICAgICAgIHJldHVybiBjbHModXRjbm93KQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGRheV9mcmFjKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9kYXlfZnJhYwoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHV0Y29mZnNldChzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5fdXRjb2Zmc2V0CgogICAgZGVmIF9fcmVwcl9fKHNlbGYpOgogICAgICAgIGlmIHNlbGYudXRjb2Zmc2V0IGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBmImRhdGV0aW1lMi57dHlwZShzZWxmKS5fX25hbWVfX30oJ3tzZWxmLmRheV9mcmFjIXN9JykiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIGYiZGF0ZXRpbWUyLnt0eXBlKHNlbGYpLl9fbmFtZV9ffSgne3NlbGYuZGF5X2ZyYWMhc30nLCB1dGNvZmZzZXQ9J3tzZWxmLnV0Y29mZnNldCFzfScpIgoKICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgIGlmIHNlbGYudXRjb2Zmc2V0IGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBmIntzZWxmLmRheV9mcmFjIXN9IG9mIGEgZGF5IgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBmIntzZWxmLmRheV9mcmFjIXN9IG9mIGEgZGF5LCB7c2VsZi51dGNvZmZzZXQhc30gb2YgYSBkYXkgZnJvbSBVVEMiCgogICAgIyBNYXRoIG9wZXJhdG9ycwogICAgZGVmIF9fYWRkX18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWVEZWx0YSk6CiAgICAgICAgICAgIHRvdGFsID0gc2VsZi5kYXlfZnJhYyArIG90aGVyLmZyYWN0aW9uYWxfZGF5cwogICAgICAgICAgICByZXR1cm4gdHlwZShzZWxmKSh0b3RhbCAtIGZsb29yKHRvdGFsKSwgdXRjb2Zmc2V0PXNlbGYudXRjb2Zmc2V0KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAoKICAgIF9fcmFkZF9fID0gX19hZGRfXwoKICAgIGRlZiBfX3N1Yl9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lKToKICAgICAgICAgICAgaWYgc2VsZi51dGNvZmZzZXQ6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJZb3UgY2Fubm90IG1peCBuYWl2ZSBhbmQgYXdhcmUgaW5zdGFuY2VzLiIpCiAgICAgICAgICAgICAgICBzZWxmX3V0YyA9IHNlbGYuZGF5X2ZyYWMgLSBzZWxmLnV0Y29mZnNldAogICAgICAgICAgICAgICAgb3RoZXJfdXRjID0gb3RoZXIuZGF5X2ZyYWMgLSAgb3RoZXIudXRjb2Zmc2V0CiAgICAgICAgICAgICAgICBkZWx0YSA9IHNlbGZfdXRjIC0gb3RoZXJfdXRjCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiWW91IGNhbm5vdCBtaXggbmFpdmUgYW5kIGF3YXJlIGluc3RhbmNlcy4iKQogICAgICAgICAgICAgICAgZGVsdGEgPSBzZWxmLmRheV9mcmFjIC0gb3RoZXIuZGF5X2ZyYWMKICAgICAgICAgICAgaWYgZGVsdGEgPD0gRnJhY3Rpb24oLTEsIDIpOgogICAgICAgICAgICAgICAgZGVsdGEgKz0gMQogICAgICAgICAgICAgICAgd2hpbGUgZGVsdGEgPD0gRnJhY3Rpb24oLTEsIDIpOgogICAgICAgICAgICAgICAgICAgIGRlbHRhICs9IDEKICAgICAgICAgICAgZWxpZiBkZWx0YSA+IEZyYWN0aW9uKDEsIDIpOgogICAgICAgICAgICAgICAgZGVsdGEgLT0gMQogICAgICAgICAgICAgICAgd2hpbGUgZGVsdGEgPiBGcmFjdGlvbigxLCAyKToKICAgICAgICAgICAgICAgICAgICBkZWx0YSAtPSAxCiAgICAgICAgICAgIHJldHVybiBUaW1lRGVsdGEoZGVsdGEpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lRGVsdGEpOgogICAgICAgICAgICB0b3RhbCA9IHNlbGYuZGF5X2ZyYWMgLSBvdGhlci5mcmFjdGlvbmFsX2RheXMKICAgICAgICAgICAgcmV0dXJuIHR5cGUoc2VsZikodG90YWwgLSBmbG9vcih0b3RhbCksIHV0Y29mZnNldD1zZWxmLnV0Y29mZnNldCkKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKCiAgICAjIENvbXBhcmlzb24gb3BlcmF0b3JzCiAgICBkZWYgX19lcV9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lKToKICAgICAgICAgICAgaWYgc2VsZi51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgIGlmIG90aGVyLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjID09IG90aGVyLmRheV9mcmFjCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgb3RoZXIudXRjb2Zmc2V0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjIC0gc2VsZi51dGNvZmZzZXQgPT0gb3RoZXIuZGF5X2ZyYWMgLSBvdGhlci51dGNvZmZzZXQKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxpZiBoYXNhdHRyKG90aGVyLCAiZGF5X2ZyYWMiKSBhbmQgaGFzYXR0cihvdGhlciwgInV0Y29mZnNldCIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX19uZV9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lKToKICAgICAgICAgICAgaWYgc2VsZi51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgIGlmIG90aGVyLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjICE9IG90aGVyLmRheV9mcmFjCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2ZyYWMgLSBzZWxmLnV0Y29mZnNldCAhPSBvdGhlci5kYXlfZnJhYyAtIG90aGVyLnV0Y29mZnNldAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImRheV9mcmFjIikgYW5kIGhhc2F0dHIob3RoZXIsICJ1dGNvZmZzZXQiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgX19ndF9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lKToKICAgICAgICAgICAgaWYgc2VsZi51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgIGlmIG90aGVyLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjID4gb3RoZXIuZGF5X2ZyYWMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJZb3UgY2Fubm90IGNvbXBhcmUgYSBuYWl2ZSBUaW1lIGluc3RhbmNlIHdpdGggYW4gYXdhcmUgb25lLiIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2ZyYWMgLSBzZWxmLnV0Y29mZnNldCA+IG90aGVyLmRheV9mcmFjIC0gb3RoZXIudXRjb2Zmc2V0CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiWW91IGNhbm5vdCBjb21wYXJlIGFuIGF3YXJlIFRpbWUgaW5zdGFuY2Ugd2l0aCBhIG5haXZlIG9uZS4iKQogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImRheV9mcmFjIikgYW5kIGhhc2F0dHIob3RoZXIsICJ1dGNvZmZzZXQiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKGYiWW91IGNhbm5vdCBjb21wYXJlICd7dHlwZShzZWxmKSFzfScgd2l0aCAne3R5cGUob3RoZXIpIXN9Jy4iKQoKICAgIGRlZiBfX2dlX18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWUpOgogICAgICAgICAgICBpZiBzZWxmLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICAgICAgaWYgb3RoZXIudXRjb2Zmc2V0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2ZyYWMgPj0gb3RoZXIuZGF5X2ZyYWMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJZb3UgY2Fubm90IGNvbXBhcmUgYSBuYWl2ZSBUaW1lIGluc3RhbmNlIHdpdGggYW4gYXdhcmUgb25lLiIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2ZyYWMgLSBzZWxmLnV0Y29mZnNldCA+PSBvdGhlci5kYXlfZnJhYyAtIG90aGVyLnV0Y29mZnNldAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoIllvdSBjYW5ub3QgY29tcGFyZSBhbiBhd2FyZSBUaW1lIGluc3RhbmNlIHdpdGggYSBuYWl2ZSBvbmUuIikKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJkYXlfZnJhYyIpIGFuZCBoYXNhdHRyKG90aGVyLCAidXRjb2Zmc2V0Iik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihmIllvdSBjYW5ub3QgY29tcGFyZSAne3R5cGUoc2VsZikhc30nIHdpdGggJ3t0eXBlKG90aGVyKSFzfScuIikKCiAgICBkZWYgX19sdF9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lKToKICAgICAgICAgICAgaWYgc2VsZi51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgIGlmIG90aGVyLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjIDwgb3RoZXIuZGF5X2ZyYWMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJZb3UgY2Fubm90IGNvbXBhcmUgYSBuYWl2ZSBUaW1lIGluc3RhbmNlIHdpdGggYW4gYXdhcmUgb25lLiIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2ZyYWMgLSBzZWxmLnV0Y29mZnNldCA8IG90aGVyLmRheV9mcmFjIC0gb3RoZXIudXRjb2Zmc2V0CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiWW91IGNhbm5vdCBjb21wYXJlIGFuIGF3YXJlIFRpbWUgaW5zdGFuY2Ugd2l0aCBhIG5haXZlIG9uZS4iKQogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImRheV9mcmFjIikgYW5kIGhhc2F0dHIob3RoZXIsICJ1dGNvZmZzZXQiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKGYiWW91IGNhbm5vdCBjb21wYXJlICd7dHlwZShzZWxmKSFzfScgd2l0aCAne3R5cGUob3RoZXIpIXN9Jy4iKQoKICAgIGRlZiBfX2xlX18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWUpOgogICAgICAgICAgICBpZiBzZWxmLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICAgICAgaWYgb3RoZXIudXRjb2Zmc2V0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2ZyYWMgPD0gb3RoZXIuZGF5X2ZyYWMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJZb3UgY2Fubm90IGNvbXBhcmUgYSBuYWl2ZSBUaW1lIGluc3RhbmNlIHdpdGggYW4gYXdhcmUgb25lLiIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2ZyYWMgLSBzZWxmLnV0Y29mZnNldCA8PSBvdGhlci5kYXlfZnJhYyAtIG90aGVyLnV0Y29mZnNldAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoIllvdSBjYW5ub3QgY29tcGFyZSBhbiBhd2FyZSBUaW1lIGluc3RhbmNlIHdpdGggYSBuYWl2ZSBvbmUuIikKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJkYXlfZnJhYyIpIGFuZCBoYXNhdHRyKG90aGVyLCAidXRjb2Zmc2V0Iik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihmIllvdSBjYW5ub3QgY29tcGFyZSAne3R5cGUoc2VsZikhc30nIHdpdGggJ3t0eXBlKG90aGVyKSFzfScuIikKCiAgICAjIGhhc2ggdmFsdWUKICAgIGRlZiBfX2hhc2hfXyhzZWxmKToKICAgICAgICBpZiBzZWxmLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gaGFzaCgoc2VsZi5kYXlfZnJhYywgTm9uZSkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIGhhc2goc2VsZi5kYXlfZnJhYyAtIHNlbGYudXRjb2Zmc2V0KQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIHJlZ2lzdGVyX25ld190aW1lKGNscywgYXR0cmlidXRlX25hbWUsIHRpbWVfcmVwcl9jbGFzcyk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UoYXR0cmlidXRlX25hbWUsIHN0cikgb3Igbm90IGF0dHJpYnV0ZV9uYW1lLmlzaWRlbnRpZmllcigpOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYiSW52YWxpZCBhdHRyaWJ1dGUgbmFtZSAoJ3thdHRyaWJ1dGVfbmFtZX0nKSBmb3IgdGltZSByZXByZXNlbnRhdGlvbi4iKQogICAgICAgIGlmIGhhc2F0dHIoY2xzLCBhdHRyaWJ1dGVfbmFtZSk6CiAgICAgICAgICAgIHJhaXNlIEF0dHJpYnV0ZUVycm9yKGYiVGltZSByZXByZXNlbnRhdGlvbiBhdHRyaWJ1dGUgYWxyZWFkeSBleGlzdGluZzoge2F0dHJpYnV0ZV9uYW1lfS4iKQogICAgICAgIGlmIG5vdCBoYXNhdHRyKHRpbWVfcmVwcl9jbGFzcywgImZyb21fdGltZV9wYWlyIik6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiVGltZSByZXByZXNlbnRhdGlvbiBjbGFzcyBkb2VzIG5vdCBoYXZlIG1ldGhvZCBmcm9tX3RpbWVfcGFpci4iKQogICAgICAgIGlmIG5vdCBoYXNhdHRyKHRpbWVfcmVwcl9jbGFzcywgInRvX3RpbWVfcGFpciIpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoIlRpbWUgcmVwcmVzZW50YXRpb24gY2xhc3MgZG9lcyBub3QgaGF2ZSBtZXRob2QgdG9fdGltZV9wYWlyLiIpCgogICAgICAgIGNsYXNzIE1vZGlmaWVkQ2xhc3ModHlwZSk6CiAgICAgICAgICAgIGRlZiBfX2NhbGxfXyhrbGFzcywgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAgICAgICAgIHRpbWVfcmVwcl9vYmogPSBzdXBlcigpLl9fY2FsbF9fKCphcmdzLCAqKmt3YXJncykKICAgICAgICAgICAgICAgIGRheV9mcmFjLCB1dGNvZmZzZXQgPSB0aW1lX3JlcHJfb2JqLnRvX3RpbWVfcGFpcigpCiAgICAgICAgICAgICAgICB0aW1lX29iaiA9IGNscyhkYXlfZnJhYywgdXRjb2Zmc2V0PXV0Y29mZnNldCkKICAgICAgICAgICAgICAgIHNldGF0dHIodGltZV9vYmosIGF0dHJpYnV0ZV9uYW1lLCB0aW1lX3JlcHJfb2JqKQogICAgICAgICAgICAgICAgcmV0dXJuIHRpbWVfb2JqCgogICAgICAgICMgQ3JlYXRlIHRoZSBtb2RpZmllZCBjYWxlbmRhciBjbGFzcwogICAgICAgIG5ld19jbGFzc19uYW1lID0gZiJ7dGltZV9yZXByX2NsYXNzLl9fbmFtZV9ffUlue2Nscy5fX25hbWVfX30iCiAgICAgICAgbW9kaWZpZWRfdGltZV9yZXByX2NsYXNzID0gTW9kaWZpZWRDbGFzcyhuZXdfY2xhc3NfbmFtZSwgKHRpbWVfcmVwcl9jbGFzcywpLCB7fSkKCiAgICAgICAgY2xhc3MgVGltZVJlcHJBdHRyaWJ1dGU6CiAgICAgICAgICAgICMgVGhpcyBjbGFzcyBpbXBsZW1lbnRzIGEgY29udGV4dCBkZXBlbmRlbnQgYXR0cmlidXRlCiAgICAgICAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBhdHRyX25hbWUsIG1vZGlmX3RpbWVfcmVwcl9jbGFzcyk6CiAgICAgICAgICAgICAgICBzZWxmLmF0dHJfbmFtZSA9IGF0dHJfbmFtZQogICAgICAgICAgICAgICAgc2VsZi5tb2RpZmllZF90aW1lX3JlcHJfY2xhc3MgPSBtb2RpZl90aW1lX3JlcHJfY2xhc3MKCiAgICAgICAgICAgIGRlZiBfX2dldF9fKHNlbGYsIGluc3RhbmNlLCBvd25lcik6CiAgICAgICAgICAgICAgICBpZiBpbnN0YW5jZSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLm1vZGlmaWVkX3RpbWVfcmVwcl9jbGFzcwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBhc3NlcnQgc2VsZi5hdHRyX25hbWUgbm90IGluIGluc3RhbmNlLl9fZGljdF9fCiAgICAgICAgICAgICAgICAgICAgdGltZV9vYmogPSBzZWxmLm1vZGlmaWVkX3RpbWVfcmVwcl9jbGFzcy5mcm9tX3RpbWVfcGFpcihpbnN0YW5jZS5kYXlfZnJhYywgdXRjb2Zmc2V0PWluc3RhbmNlLnV0Y29mZnNldCkKICAgICAgICAgICAgICAgICAgICB0aW1lX3JlcHJfb2JqID0gZ2V0YXR0cih0aW1lX29iaiwgc2VsZi5hdHRyX25hbWUpCiAgICAgICAgICAgICAgICAgICAgc2V0YXR0cihpbnN0YW5jZSwgc2VsZi5hdHRyX25hbWUsIHRpbWVfcmVwcl9vYmopCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRpbWVfcmVwcl9vYmoKCiAgICAgICAgc2V0YXR0cihjbHMsIGF0dHJpYnV0ZV9uYW1lLCBUaW1lUmVwckF0dHJpYnV0ZShhdHRyaWJ1dGVfbmFtZSwgbW9kaWZpZWRfdGltZV9yZXByX2NsYXNzKSkKCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBSZWdpc3RlciBjdXJyZW50IHRpbWUgcmVwcmVzZW50YXRpb25zCiMKVGltZS5yZWdpc3Rlcl9uZXdfdGltZSgid2VzdGVybiIsIHdlc3Rlcm4uV2VzdGVyblRpbWUpClRpbWUucmVnaXN0ZXJfbmV3X3RpbWUoImludGVybmV0IiwgbW9kZXJuLkludGVybmV0VGltZSkKCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIFRpbWVEZWx0YQojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCmNsYXNzIFRpbWVEZWx0YToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBudW1lcmF0b3IsIGRlbm9taW5hdG9yPU5vbmUpOgogICAgICAgIGlmIGRlbm9taW5hdG9yIGlzIE5vbmU6CiAgICAgICAgICAgIHNlbGYuX2ZyYWN0aW9uYWxfZGF5cyA9IHZlcmlmeV9mcmFjdGlvbmFsX3ZhbHVlKG51bWVyYXRvcikKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLl9mcmFjdGlvbmFsX2RheXMgPSB2ZXJpZnlfZnJhY3Rpb25hbF92YWx1ZV9udW1fZGVuKG51bWVyYXRvciwgZGVub21pbmF0b3IpCiAgICAgICAgc2VsZi5faW50X3BhcnQgPSBpbnQoc2VsZi5fZnJhY3Rpb25hbF9kYXlzKQogICAgICAgIHNlbGYuX2ZyYWNfcGFydCA9IHNlbGYuX2ZyYWN0aW9uYWxfZGF5cyAtIHNlbGYuX2ludF9wYXJ0CgogICAgQHByb3BlcnR5CiAgICBkZWYgZnJhY3Rpb25hbF9kYXlzKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9mcmFjdGlvbmFsX2RheXMKCiAgICBAcHJvcGVydHkKICAgIGRlZiBpbnRfcGFydChzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5faW50X3BhcnQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBmcmFjX3BhcnQoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2ZyYWNfcGFydAoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gZiJkYXRldGltZTIue3R5cGUoc2VsZikuX19uYW1lX199KCd7c2VsZi5mcmFjdGlvbmFsX2RheXMhc30nKSIKCiAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICBpZiBzZWxmLl9mcmFjdGlvbmFsX2RheXMgPT0gMDoKICAgICAgICAgICAgcmV0dXJuICIwIGRheXMiCiAgICAgICAgaW50X3N0cmluZyA9IGYie3NlbGYuaW50X3BhcnQhc30gZGF5eydzJyBpZiBzZWxmLl9mcmFjdGlvbmFsX2RheXMgIT0gMSBhbmQgc2VsZi5fZnJhY3Rpb25hbF9kYXlzICE9IC0xIGVsc2UgJyd9IiBpZiBzZWxmLmludF9wYXJ0IGVsc2UgIiIKICAgICAgICBmcmFjX3N0cmluZyA9IGYie3NlbGYuX2ZyYWNfcGFydCFzfSBvZiBhIGRheSIgaWYgc2VsZi5fZnJhY19wYXJ0IGVsc2UgIiIKICAgICAgICBpZiBpbnRfc3RyaW5nIGFuZCBmcmFjX3N0cmluZzoKICAgICAgICAgICAgcmV0dXJuIGYie2ludF9zdHJpbmd9IGFuZCB7ZnJhY19zdHJpbmd9IgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBpbnRfc3RyaW5nICsgZnJhY19zdHJpbmcKCiAgICAjIE1hdGggb3BlcmF0b3JzCiAgICBkZWYgaW50KHNlbGYpOgogICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHNlbGYuaW50X3BhcnQpCgogICAgZGVmIGZyYWMoc2VsZik6CiAgICAgICAgcmV0dXJuIHR5cGUoc2VsZikoc2VsZi5mcmFjX3BhcnQpCgogICAgZGVmIF9fYWRkX18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWVEZWx0YSk6CiAgICAgICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHNlbGYuZnJhY3Rpb25hbF9kYXlzICsgb3RoZXIuZnJhY3Rpb25hbF9kYXlzKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAoKICAgIGRlZiBfX3Bvc19fKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmCgogICAgZGVmIF9fbmVnX18oc2VsZik6CiAgICAgICAgcmV0dXJuIFRpbWVEZWx0YSgtc2VsZi5mcmFjdGlvbmFsX2RheXMpCgogICAgZGVmIF9fYWJzX18oc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYgaWYgc2VsZi5mcmFjdGlvbmFsX2RheXMgPj0gMCBlbHNlIC1zZWxmCgogICAgZGVmIF9fc3ViX18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWVEZWx0YSk6CiAgICAgICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHNlbGYuZnJhY3Rpb25hbF9kYXlzIC0gb3RoZXIuZnJhY3Rpb25hbF9kYXlzKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAoKICAgIGRlZiBfX211bF9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCAobnVtYmVycy5SZWFsLCBEZWNpbWFsKSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHNlbGYuZnJhY3Rpb25hbF9kYXlzICogRnJhY3Rpb24ob3RoZXIpKQogICAgICAgICAgICBleGNlcHQgKE92ZXJmbG93RXJyb3IsIFZhbHVlRXJyb3IpIGFzIGV4YzoKICAgICAgICAgICAgICAgIHJlYXNvbiA9IHN0cihleGMpCiAgICAgICAgICAgICAgICBpZiByZWFzb24uc3RhcnRzd2l0aCgiY2Fubm90IGNvbnZlcnQiKSBhbmQgcmVhc29uLmVuZHN3aXRoKCJ0byBpbnRlZ2VyIHJhdGlvIik6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yIGZyb20gZXhjCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCgogICAgX19ybXVsX18gPSBfX211bF9fCgogICAgZGVmIF9fdHJ1ZWRpdl9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lRGVsdGEpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5mcmFjdGlvbmFsX2RheXMgLyBvdGhlci5mcmFjdGlvbmFsX2RheXMKICAgICAgICBlbGlmIGlzaW5zdGFuY2Uob3RoZXIsIChudW1iZXJzLlJlYWwsIERlY2ltYWwpKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGUoc2VsZikoc2VsZi5mcmFjdGlvbmFsX2RheXMgLyBGcmFjdGlvbihvdGhlcikpCiAgICAgICAgICAgIGV4Y2VwdCAoT3ZlcmZsb3dFcnJvciwgVmFsdWVFcnJvcikgYXMgZXhjOgogICAgICAgICAgICAgICAgcmVhc29uID0gc3RyKGV4YykKICAgICAgICAgICAgICAgIGlmIHJlYXNvbi5zdGFydHN3aXRoKCJjYW5ub3QgY29udmVydCIpIGFuZCByZWFzb24uZW5kc3dpdGgoInRvIGludGVnZXIgcmF0aW8iKToKICAgICAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IgZnJvbSBleGMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKCiAgICBkZWYgX19mbG9vcmRpdl9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lRGVsdGEpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5mcmFjdGlvbmFsX2RheXMgLy8gb3RoZXIuZnJhY3Rpb25hbF9kYXlzCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG90aGVyLCAobnVtYmVycy5SZWFsLCBEZWNpbWFsKSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHNlbGYuZnJhY3Rpb25hbF9kYXlzIC8vIEZyYWN0aW9uKG90aGVyKSkKICAgICAgICAgICAgZXhjZXB0IChPdmVyZmxvd0Vycm9yLCBWYWx1ZUVycm9yKSBhcyBleGM6CiAgICAgICAgICAgICAgICByZWFzb24gPSBzdHIoZXhjKQogICAgICAgICAgICAgICAgaWYgcmVhc29uLnN0YXJ0c3dpdGgoImNhbm5vdCBjb252ZXJ0IikgYW5kIHJlYXNvbi5lbmRzd2l0aCgidG8gaW50ZWdlciByYXRpbyIpOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvciBmcm9tIGV4YwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAoKICAgIGRlZiBfX21vZF9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lRGVsdGEpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5mcmFjdGlvbmFsX2RheXMgJSBvdGhlci5mcmFjdGlvbmFsX2RheXMKICAgICAgICBlbGlmIGlzaW5zdGFuY2Uob3RoZXIsIChudW1iZXJzLlJlYWwsIERlY2ltYWwpKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGUoc2VsZikoc2VsZi5mcmFjdGlvbmFsX2RheXMgJSBGcmFjdGlvbihvdGhlcikpCiAgICAgICAgICAgIGV4Y2VwdCAoT3ZlcmZsb3dFcnJvciwgVmFsdWVFcnJvcikgYXMgZXhjOgogICAgICAgICAgICAgICAgcmVhc29uID0gc3RyKGV4YykKICAgICAgICAgICAgICAgIGlmIHJlYXNvbi5zdGFydHN3aXRoKCJjYW5ub3QgY29udmVydCIpIGFuZCByZWFzb24uZW5kc3dpdGgoInRvIGludGVnZXIgcmF0aW8iKToKICAgICAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IgZnJvbSBleGMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKCiAgICBkZWYgZGl2bW9kKHNlbGYsIG90aGVyKToKICAgICAgICByZXR1cm4gc2VsZiAvLyBvdGhlciwgc2VsZiAlIG90aGVyCgogICAgIyBib29sZWFuIGFuZCB0ZXN0CiAgICBkZWYgX19ib29sX18oc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2ZyYWN0aW9uYWxfZGF5cyAhPSAwCgogICAgZGVmIGlzX2ludGVnZXIoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2ZyYWNfcGFydCA9PSAwCgogICAgIyBjb21wYXJpc29ucwogICAgZGVmIF9fZXFfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2ZyYWN0aW9uYWxfZGF5cyA9PSBvdGhlci5mcmFjdGlvbmFsX2RheXMKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJmcmFjdGlvbmFsX2RheXMiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9fbmVfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2ZyYWN0aW9uYWxfZGF5cyAhPSBvdGhlci5mcmFjdGlvbmFsX2RheXMKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJmcmFjdGlvbmFsX2RheXMiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgX19ndF9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lRGVsdGEpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZnJhY3Rpb25hbF9kYXlzID4gb3RoZXIuZnJhY3Rpb25hbF9kYXlzCiAgICAgICAgZWxpZiBoYXNhdHRyKG90aGVyLCAiZnJhY3Rpb25hbF9kYXlzIik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihmIllvdSBjYW5ub3QgY29tcGFyZSAne3R5cGUoc2VsZikhc30nIHdpdGggJ3t0eXBlKG90aGVyKSFzfScuIikKCiAgICBkZWYgX19nZV9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lRGVsdGEpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZnJhY3Rpb25hbF9kYXlzID49IG90aGVyLmZyYWN0aW9uYWxfZGF5cwogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImZyYWN0aW9uYWxfZGF5cyIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoZiJZb3UgY2Fubm90IGNvbXBhcmUgJ3t0eXBlKHNlbGYpIXN9JyB3aXRoICd7dHlwZShvdGhlcikhc30nLiIpCgogICAgZGVmIF9fbHRfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2ZyYWN0aW9uYWxfZGF5cyA8IG90aGVyLmZyYWN0aW9uYWxfZGF5cwogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImZyYWN0aW9uYWxfZGF5cyIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoZiJZb3UgY2Fubm90IGNvbXBhcmUgJ3t0eXBlKHNlbGYpIXN9JyB3aXRoICd7dHlwZShvdGhlcikhc30nLiIpCgogICAgZGVmIF9fbGVfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2ZyYWN0aW9uYWxfZGF5cyA8PSBvdGhlci5mcmFjdGlvbmFsX2RheXMKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJmcmFjdGlvbmFsX2RheXMiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKGYiWW91IGNhbm5vdCBjb21wYXJlICd7dHlwZShzZWxmKSFzfScgd2l0aCAne3R5cGUob3RoZXIpIXN9Jy4iKQoKICAgICMgaGFzaCB2YWx1ZQogICAgZGVmIF9faGFzaF9fKHNlbGYpOgogICAgICAgIHJldHVybiBoYXNoKHNlbGYuX2ZyYWN0aW9uYWxfZGF5cykKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiByZWdpc3Rlcl9uZXdfdGltZV9pbnRlcnZhbChjbHMsIGF0dHJpYnV0ZV9uYW1lLCB0aW1lX2ludGVydmFsX2NsYXNzKToKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShhdHRyaWJ1dGVfbmFtZSwgc3RyKSBvciBub3QgYXR0cmlidXRlX25hbWUuaXNpZGVudGlmaWVyKCk6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiJJbnZhbGlkIHRpbWUgaW50ZXJ2YWwgYXR0cmlidXRlIG5hbWU6IHthdHRyaWJ1dGVfbmFtZX0uIikKICAgICAgICBpZiBoYXNhdHRyKGNscywgYXR0cmlidXRlX25hbWUpOgogICAgICAgICAgICByYWlzZSBBdHRyaWJ1dGVFcnJvcihmIlRpbWUgaW50ZXJ2YWwgYXR0cmlidXRlIGFscmVhZHkgZXhpc3Rpbmc6IHthdHRyaWJ1dGVfbmFtZX0uIikKICAgICAgICBpZiBub3QgaGFzYXR0cih0aW1lX2ludGVydmFsX2NsYXNzLCAiZnJvbV9mcmFjdGlvbmFsX2RheXMiKToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJUaW1lIGludGVydmFsIGNsYXNzIGRvZXMgbm90IGhhdmUgbWV0aG9kIGZyb21fZnJhY3Rpb25hbF9kYXlzLiIpCiAgICAgICAgaWYgbm90IGhhc2F0dHIodGltZV9pbnRlcnZhbF9jbGFzcywgInRvX2ZyYWN0aW9uYWxfZGF5cyIpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoIlRpbWUgaW50ZXJ2YWwgY2xhc3MgZG9lcyBub3QgaGF2ZSBtZXRob2QgdG9fZnJhY3Rpb25hbF9kYXlzLiIpCgogICAgICAgIGNsYXNzIE1vZGlmaWVkQ2xhc3ModHlwZSk6CiAgICAgICAgICAgIGRlZiBfX2NhbGxfXyhrbGFzcywgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAgICAgICAgIHRpbWVfaW50ZXJ2YWxfb2JqID0gc3VwZXIoKS5fX2NhbGxfXygqYXJncywgKiprd2FyZ3MpCiAgICAgICAgICAgICAgICBkYXRlX29iaiA9IGNscyh0aW1lX2ludGVydmFsX29iai50b19mcmFjdGlvbmFsX2RheXMoKSkKICAgICAgICAgICAgICAgIHNldGF0dHIoZGF0ZV9vYmosIGF0dHJpYnV0ZV9uYW1lLCB0aW1lX2ludGVydmFsX29iaikKICAgICAgICAgICAgICAgIHJldHVybiBkYXRlX29iagoKICAgICAgICAjIENyZWF0ZSB0aGUgbW9kaWZpZWQgY2FsZW5kYXIgY2xhc3MKICAgICAgICBuZXdfY2xhc3NfbmFtZSA9IGYie3RpbWVfaW50ZXJ2YWxfY2xhc3MuX19uYW1lX199SW57Y2xzLl9fbmFtZV9ffSIKICAgICAgICBtb2RpZmllZF90aW1lX2ludGVydmFsX2NsYXNzID0gTW9kaWZpZWRDbGFzcyhuZXdfY2xhc3NfbmFtZSwgKHRpbWVfaW50ZXJ2YWxfY2xhc3MsKSwge30pCgogICAgICAgIGNsYXNzIFRpbWVJbnRlcnZhbEF0dHJpYnV0ZToKICAgICAgICAgICAgIyBUaGlzIGNsYXNzIGltcGxlbWVudHMgYSBjb250ZXh0IGRlcGVuZGVudCBhdHRyaWJ1dGUKICAgICAgICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIGF0dHJfbmFtZSwgbW9kaWZfdGltZV9pbnRlcnZhbF9jbGFzcyk6CiAgICAgICAgICAgICAgICBzZWxmLmF0dHJpYnV0ZV9uYW1lID0gYXR0cl9uYW1lCiAgICAgICAgICAgICAgICBzZWxmLm1vZGlmaWVkX3RpbWVfaW50ZXJ2YWxfY2xhc3MgPSBtb2RpZl90aW1lX2ludGVydmFsX2NsYXNzCgogICAgICAgICAgICBkZWYgX19nZXRfXyhzZWxmLCBpbnN0YW5jZSwgb3duZXIpOgogICAgICAgICAgICAgICAgaWYgaW5zdGFuY2UgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5tb2RpZmllZF90aW1lX2ludGVydmFsX2NsYXNzCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGFzc2VydCBzZWxmLmF0dHJpYnV0ZV9uYW1lIG5vdCBpbiBpbnN0YW5jZS5fX2RpY3RfXwogICAgICAgICAgICAgICAgICAgIHRpbWVkZWx0YSA9IHNlbGYubW9kaWZpZWRfdGltZV9pbnRlcnZhbF9jbGFzcy5mcm9tX2ZyYWN0aW9uYWxfZGF5cyhpbnN0YW5jZS5mcmFjdGlvbmFsX2RheXMpCiAgICAgICAgICAgICAgICAgICAgdGltZV9pbnRlcnZhbF9vYmogPSBnZXRhdHRyKHRpbWVkZWx0YSwgc2VsZi5hdHRyaWJ1dGVfbmFtZSkKICAgICAgICAgICAgICAgICAgICBzZXRhdHRyKGluc3RhbmNlLCBzZWxmLmF0dHJpYnV0ZV9uYW1lLCB0aW1lX2ludGVydmFsX29iaikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGltZV9pbnRlcnZhbF9vYmoKCiAgICAgICAgc2V0YXR0cihjbHMsIGF0dHJpYnV0ZV9uYW1lLCBUaW1lSW50ZXJ2YWxBdHRyaWJ1dGUoYXR0cmlidXRlX25hbWUsIG1vZGlmaWVkX3RpbWVfaW50ZXJ2YWxfY2xhc3MpKQoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIFJlZ2lzdGVyIGN1cnJlbnQgY2FsZW5kYXJzCiMKVGltZURlbHRhLnJlZ2lzdGVyX25ld190aW1lX2ludGVydmFsKCJ3ZXN0ZXJuIiwgd2VzdGVybi5XZXN0ZXJuVGltZURlbHRhKQoKCg==
