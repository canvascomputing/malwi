statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/botaa3/1.0.0/botaa3-1.0.0/boto3-1.20.7/boto3/resources/model.py
  contents:
  - name: <module>
    score: 0.0
    code: |-
      # Copyright 2014 Amazon.com, Inc. or its affiliates. All Rights Reserved.
      #
      # Licensed under the Apache License, Version 2.0 (the "License"). You
      # may not use this file except in compliance with the License. A copy of
      # the License is located at
      #
      # https://aws.amazon.com/apache2.0/
      #
      # or in the "license" file accompanying this file. This file is
      # distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
      # ANY KIND, either express or implied. See the License for the specific
      # language governing permissions and limitations under the License.

      """
      The models defined in this file represent the resource JSON description
      format and provide a layer of abstraction from the raw JSON. The advantages
      of this are:

      * Pythonic interface (e.g. ``action.request.operation``)
      * Consumers need not change for minor JSON changes (e.g. renamed field)

      These models are used both by the resource factory to generate resource
      classes as well as by the documentation generator.
      """

      import logging

      from botocore import xform_name


      logger = logging.getLogger(__name__)


      class Identifier(object):
          """
          A resource identifier, given by its name.

          :type name: string
          :param name: The name of the identifier
          """
          def __init__(self, name, member_name=None):
              #: (``string``) The name of the identifier
              self.name = name
              self.member_name = member_name
    tokens: resume load_const STRING_LEN_M_ENT_HIGH store_name __doc__ load_const INTEGER load_const import_name logging store_name logging load_const INTEGER load_const import_name botocore import_from xform_name store_name xform_name pop_top push_null load_name logging load_attr getLogger load_name __name__ call store_name logger push_null load_build_class load_const OBJECT make_function load_const Identifier load_name object call store_name Identifier push_null load_build_class load_const OBJECT make_function load_const Action load_name object call store_name Action push_null load_build_class load_const OBJECT make_function load_const STRING_BASE64_LEN_S_ENT_HIGH load_name object call store_name STRING_BASE64_LEN_S_ENT_HIGH push_null load_build_class load_const OBJECT make_function load_const Parameter load_name object call store_name Parameter push_null load_build_class load_const OBJECT make_function load_const Request load_name STRING_BASE64_LEN_S_ENT_HIGH call store_name Request push_null load_build_class load_const OBJECT make_function load_const Waiter load_name STRING_BASE64_LEN_S_ENT_HIGH call store_name Waiter push_null load_build_class load_const OBJECT make_function load_const STRING_BASE64_LEN_S_ENT_HIGH load_name object call store_name STRING_BASE64_LEN_S_ENT_HIGH push_null load_build_class load_const OBJECT make_function load_const Collection load_name Action call store_name Collection push_null load_build_class load_const OBJECT make_function load_const ResourceModel load_name object call store_name ResourceModel return_const None
    hash: d82b527aa258973b2bec11f4259351d2077e19322d6e47ca469b79deeab32717
sources:
  .repo_cache/malicious_repos/pypi_malregistry/botaa3/1.0.0/botaa3-1.0.0/boto3-1.20.7/boto3/resources/model.py: IyBDb3B5cmlnaHQgMjAxNCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLgojCiMgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIikuIFlvdQojIG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YKIyB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0CiMKIyBodHRwczovL2F3cy5hbWF6b24uY29tL2FwYWNoZTIuMC8KIwojIG9yIGluIHRoZSAibGljZW5zZSIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMKIyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRgojIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYwojIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgoiIiIKVGhlIG1vZGVscyBkZWZpbmVkIGluIHRoaXMgZmlsZSByZXByZXNlbnQgdGhlIHJlc291cmNlIEpTT04gZGVzY3JpcHRpb24KZm9ybWF0IGFuZCBwcm92aWRlIGEgbGF5ZXIgb2YgYWJzdHJhY3Rpb24gZnJvbSB0aGUgcmF3IEpTT04uIFRoZSBhZHZhbnRhZ2VzCm9mIHRoaXMgYXJlOgoKKiBQeXRob25pYyBpbnRlcmZhY2UgKGUuZy4gYGBhY3Rpb24ucmVxdWVzdC5vcGVyYXRpb25gYCkKKiBDb25zdW1lcnMgbmVlZCBub3QgY2hhbmdlIGZvciBtaW5vciBKU09OIGNoYW5nZXMgKGUuZy4gcmVuYW1lZCBmaWVsZCkKClRoZXNlIG1vZGVscyBhcmUgdXNlZCBib3RoIGJ5IHRoZSByZXNvdXJjZSBmYWN0b3J5IHRvIGdlbmVyYXRlIHJlc291cmNlCmNsYXNzZXMgYXMgd2VsbCBhcyBieSB0aGUgZG9jdW1lbnRhdGlvbiBnZW5lcmF0b3IuCiIiIgoKaW1wb3J0IGxvZ2dpbmcKCmZyb20gYm90b2NvcmUgaW1wb3J0IHhmb3JtX25hbWUKCgpsb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCgpjbGFzcyBJZGVudGlmaWVyKG9iamVjdCk6CiAgICAiIiIKICAgIEEgcmVzb3VyY2UgaWRlbnRpZmllciwgZ2l2ZW4gYnkgaXRzIG5hbWUuCgogICAgOnR5cGUgbmFtZTogc3RyaW5nCiAgICA6cGFyYW0gbmFtZTogVGhlIG5hbWUgb2YgdGhlIGlkZW50aWZpZXIKICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5hbWUsIG1lbWJlcl9uYW1lPU5vbmUpOgogICAgICAgICM6IChgYHN0cmluZ2BgKSBUaGUgbmFtZSBvZiB0aGUgaWRlbnRpZmllcgogICAgICAgIHNlbGYubmFtZSA9IG5hbWUKICAgICAgICBzZWxmLm1lbWJlcl9uYW1lID0gbWVtYmVyX25hbWUKCgpjbGFzcyBBY3Rpb24ob2JqZWN0KToKICAgICIiIgogICAgQSBzZXJ2aWNlIG9wZXJhdGlvbiBhY3Rpb24uCgogICAgOnR5cGUgbmFtZTogc3RyaW5nCiAgICA6cGFyYW0gbmFtZTogVGhlIG5hbWUgb2YgdGhlIGFjdGlvbgogICAgOnR5cGUgZGVmaW5pdGlvbjogZGljdAogICAgOnBhcmFtIGRlZmluaXRpb246IFRoZSBKU09OIGRlZmluaXRpb24KICAgIDp0eXBlIHJlc291cmNlX2RlZnM6IGRpY3QKICAgIDpwYXJhbSByZXNvdXJjZV9kZWZzOiBBbGwgcmVzb3VyY2VzIGRlZmluZWQgaW4gdGhlIHNlcnZpY2UKICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5hbWUsIGRlZmluaXRpb24sIHJlc291cmNlX2RlZnMpOgogICAgICAgIHNlbGYuX2RlZmluaXRpb24gPSBkZWZpbml0aW9uCgogICAgICAgICM6IChgYHN0cmluZ2BgKSBUaGUgbmFtZSBvZiB0aGUgYWN0aW9uCiAgICAgICAgc2VsZi5uYW1lID0gbmFtZQogICAgICAgICM6ICg6cHk6Y2xhc3M6YFJlcXVlc3RgKSBUaGlzIGFjdGlvbidzIHJlcXVlc3Qgb3IgYGBOb25lYGAKICAgICAgICBzZWxmLnJlcXVlc3QgPSBOb25lCiAgICAgICAgaWYgJ3JlcXVlc3QnIGluIGRlZmluaXRpb246CiAgICAgICAgICAgIHNlbGYucmVxdWVzdCA9IFJlcXVlc3QoZGVmaW5pdGlvbi5nZXQoJ3JlcXVlc3QnLCB7fSkpCiAgICAgICAgIzogKDpweTpjbGFzczpgUmVzcG9uc2VSZXNvdXJjZWApIFRoaXMgYWN0aW9uJ3MgcmVzb3VyY2Ugb3IgYGBOb25lYGAKICAgICAgICBzZWxmLnJlc291cmNlID0gTm9uZQogICAgICAgIGlmICdyZXNvdXJjZScgaW4gZGVmaW5pdGlvbjoKICAgICAgICAgICAgc2VsZi5yZXNvdXJjZSA9IFJlc3BvbnNlUmVzb3VyY2UoZGVmaW5pdGlvbi5nZXQoJ3Jlc291cmNlJywge30pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9kZWZzKQogICAgICAgICM6IChgYHN0cmluZ2BgKSBUaGUgSk1FU1BhdGggc2VhcmNoIHBhdGggb3IgYGBOb25lYGAKICAgICAgICBzZWxmLnBhdGggPSBkZWZpbml0aW9uLmdldCgncGF0aCcpCgoKY2xhc3MgRGVmaW5pdGlvbldpdGhQYXJhbXMob2JqZWN0KToKICAgICIiIgogICAgQW4gaXRlbSB3aGljaCBoYXMgcGFyYW1ldGVycyBleHBvc2VkIHZpYSB0aGUgYGBwYXJhbXNgYCBwcm9wZXJ0eS4KICAgIEEgcmVxdWVzdCBoYXMgYW4gb3BlcmF0aW9uIGFuZCBwYXJhbWV0ZXJzLCB3aGlsZSBhIHdhaXRlciBoYXMKICAgIGEgbmFtZSwgYSBsb3ctbGV2ZWwgd2FpdGVyIG5hbWUgYW5kIHBhcmFtZXRlcnMuCgogICAgOnR5cGUgZGVmaW5pdGlvbjogZGljdAogICAgOnBhcmFtIGRlZmluaXRpb246IFRoZSBKU09OIGRlZmluaXRpb24KICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRlZmluaXRpb24pOgogICAgICAgIHNlbGYuX2RlZmluaXRpb24gPSBkZWZpbml0aW9uCgogICAgQHByb3BlcnR5CiAgICBkZWYgcGFyYW1zKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEdldCBhIGxpc3Qgb2YgYXV0by1maWxsZWQgcGFyYW1ldGVycyBmb3IgdGhpcyByZXF1ZXN0LgoKICAgICAgICA6dHlwZTogbGlzdCg6cHk6Y2xhc3M6YFBhcmFtZXRlcmApCiAgICAgICAgIiIiCiAgICAgICAgcGFyYW1zID0gW10KCiAgICAgICAgZm9yIGl0ZW0gaW4gc2VsZi5fZGVmaW5pdGlvbi5nZXQoJ3BhcmFtcycsIFtdKToKICAgICAgICAgICAgcGFyYW1zLmFwcGVuZChQYXJhbWV0ZXIoKippdGVtKSkKCiAgICAgICAgcmV0dXJuIHBhcmFtcwoKCmNsYXNzIFBhcmFtZXRlcihvYmplY3QpOgogICAgIiIiCiAgICBBbiBhdXRvLWZpbGxlZCBwYXJhbWV0ZXIgd2hpY2ggaGFzIGEgc291cmNlIGFuZCB0YXJnZXQuIEZvciBleGFtcGxlLAogICAgdGhlIGBgUXVldWVVcmxgYCBtYXkgYmUgYXV0by1maWxsZWQgZnJvbSBhIHJlc291cmNlJ3MgYGB1cmxgYCBpZGVudGlmaWVyCiAgICB3aGVuIG1ha2luZyBjYWxscyB0byBgYHF1ZXVlLnJlY2VpdmVfbWVzc2FnZXNgYC4KCiAgICA6dHlwZSB0YXJnZXQ6IHN0cmluZwogICAgOnBhcmFtIHRhcmdldDogVGhlIGRlc3RpbmF0aW9uIHBhcmFtZXRlciBuYW1lLCBlLmcuIGBgUXVldWVVcmxgYAogICAgOnR5cGUgc291cmNlX3R5cGU6IHN0cmluZwogICAgOnBhcmFtIHNvdXJjZV90eXBlOiBXaGVyZSB0aGUgc291cmNlIGlzIGRlZmluZWQuCiAgICA6dHlwZSBzb3VyY2U6IHN0cmluZwogICAgOnBhcmFtIHNvdXJjZTogVGhlIHNvdXJjZSBuYW1lLCBlLmcuIGBgVXJsYGAKICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHRhcmdldCwgc291cmNlLCBuYW1lPU5vbmUsIHBhdGg9Tm9uZSwgdmFsdWU9Tm9uZSwKICAgICAgICAgICAgICAgICAqKmt3YXJncyk6CiAgICAgICAgIzogKGBgc3RyaW5nYGApIFRoZSBkZXN0aW5hdGlvbiBwYXJhbWV0ZXIgbmFtZQogICAgICAgIHNlbGYudGFyZ2V0ID0gdGFyZ2V0CiAgICAgICAgIzogKGBgc3RyaW5nYGApIFdoZXJlIHRoZSBzb3VyY2UgaXMgZGVmaW5lZAogICAgICAgIHNlbGYuc291cmNlID0gc291cmNlCiAgICAgICAgIzogKGBgc3RyaW5nYGApIFRoZSBuYW1lIG9mIHRoZSBzb3VyY2UsIGlmIGdpdmVuCiAgICAgICAgc2VsZi5uYW1lID0gbmFtZQogICAgICAgICM6IChgYHN0cmluZ2BgKSBUaGUgSk1FU1BhdGggcXVlcnkgb2YgdGhlIHNvdXJjZQogICAgICAgIHNlbGYucGF0aCA9IHBhdGgKICAgICAgICAjOiAoYGBzdHJpbmd8aW50fGZsb2F0fGJvb2xgYCkgVGhlIHNvdXJjZSBjb25zdGFudCB2YWx1ZQogICAgICAgIHNlbGYudmFsdWUgPSB2YWx1ZQoKICAgICAgICAjIENvbXBsYWluIGlmIHdlIGVuY291bnRlciBhbnkgdW5rbm93biB2YWx1ZXMuCiAgICAgICAgaWYga3dhcmdzOgogICAgICAgICAgICBsb2dnZXIud2FybmluZygnVW5rbm93biBwYXJhbWV0ZXIgb3B0aW9ucyBmb3VuZDogJXMnLCBrd2FyZ3MpCgoKY2xhc3MgUmVxdWVzdChEZWZpbml0aW9uV2l0aFBhcmFtcyk6CiAgICAiIiIKICAgIEEgc2VydmljZSBvcGVyYXRpb24gYWN0aW9uIHJlcXVlc3QuCgogICAgOnR5cGUgZGVmaW5pdGlvbjogZGljdAogICAgOnBhcmFtIGRlZmluaXRpb246IFRoZSBKU09OIGRlZmluaXRpb24KICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGRlZmluaXRpb24pOgogICAgICAgIHN1cGVyKFJlcXVlc3QsIHNlbGYpLl9faW5pdF9fKGRlZmluaXRpb24pCgogICAgICAgICM6IChgYHN0cmluZ2BgKSBUaGUgbmFtZSBvZiB0aGUgbG93LWxldmVsIHNlcnZpY2Ugb3BlcmF0aW9uCiAgICAgICAgc2VsZi5vcGVyYXRpb24gPSBkZWZpbml0aW9uLmdldCgnb3BlcmF0aW9uJykKCgpjbGFzcyBXYWl0ZXIoRGVmaW5pdGlvbldpdGhQYXJhbXMpOgogICAgIiIiCiAgICBBbiBldmVudCB3YWl0ZXIgc3BlY2lmaWNhdGlvbi4KCiAgICA6dHlwZSBuYW1lOiBzdHJpbmcKICAgIDpwYXJhbSBuYW1lOiBOYW1lIG9mIHRoZSB3YWl0ZXIKICAgIDp0eXBlIGRlZmluaXRpb246IGRpY3QKICAgIDpwYXJhbSBkZWZpbml0aW9uOiBUaGUgSlNPTiBkZWZpbml0aW9uCiAgICAiIiIKICAgIFBSRUZJWCA9ICdXYWl0VW50aWwnCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5hbWUsIGRlZmluaXRpb24pOgogICAgICAgIHN1cGVyKFdhaXRlciwgc2VsZikuX19pbml0X18oZGVmaW5pdGlvbikKCiAgICAgICAgIzogKGBgc3RyaW5nYGApIFRoZSBuYW1lIG9mIHRoaXMgd2FpdGVyCiAgICAgICAgc2VsZi5uYW1lID0gbmFtZQoKICAgICAgICAjOiAoYGBzdHJpbmdgYCkgVGhlIG5hbWUgb2YgdGhlIHVuZGVybHlpbmcgZXZlbnQgd2FpdGVyCiAgICAgICAgc2VsZi53YWl0ZXJfbmFtZSA9IGRlZmluaXRpb24uZ2V0KCd3YWl0ZXJOYW1lJykKCgpjbGFzcyBSZXNwb25zZVJlc291cmNlKG9iamVjdCk6CiAgICAiIiIKICAgIEEgcmVzb3VyY2UgcmVzcG9uc2UgdG8gY3JlYXRlIGFmdGVyIHBlcmZvcm1pbmcgYW4gYWN0aW9uLgoKICAgIDp0eXBlIGRlZmluaXRpb246IGRpY3QKICAgIDpwYXJhbSBkZWZpbml0aW9uOiBUaGUgSlNPTiBkZWZpbml0aW9uCiAgICA6dHlwZSByZXNvdXJjZV9kZWZzOiBkaWN0CiAgICA6cGFyYW0gcmVzb3VyY2VfZGVmczogQWxsIHJlc291cmNlcyBkZWZpbmVkIGluIHRoZSBzZXJ2aWNlCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBkZWZpbml0aW9uLCByZXNvdXJjZV9kZWZzKToKICAgICAgICBzZWxmLl9kZWZpbml0aW9uID0gZGVmaW5pdGlvbgogICAgICAgIHNlbGYuX3Jlc291cmNlX2RlZnMgPSByZXNvdXJjZV9kZWZzCgogICAgICAgICM6IChgYHN0cmluZ2BgKSBUaGUgbmFtZSBvZiB0aGUgcmVzcG9uc2UgcmVzb3VyY2UgdHlwZQogICAgICAgIHNlbGYudHlwZSA9IGRlZmluaXRpb24uZ2V0KCd0eXBlJykKCiAgICAgICAgIzogKGBgc3RyaW5nYGApIFRoZSBKTUVTUGF0aCBzZWFyY2ggcXVlcnkgb3IgYGBOb25lYGAKICAgICAgICBzZWxmLnBhdGggPSBkZWZpbml0aW9uLmdldCgncGF0aCcpCgogICAgQHByb3BlcnR5CiAgICBkZWYgaWRlbnRpZmllcnMoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgQSBsaXN0IG9mIHJlc291cmNlIGlkZW50aWZpZXJzLgoKICAgICAgICA6dHlwZTogbGlzdCg6cHk6Y2xhc3M6YElkZW50aWZpZXJgKQogICAgICAgICIiIgogICAgICAgIGlkZW50aWZpZXJzID0gW10KCiAgICAgICAgZm9yIGl0ZW0gaW4gc2VsZi5fZGVmaW5pdGlvbi5nZXQoJ2lkZW50aWZpZXJzJywgW10pOgogICAgICAgICAgICBpZGVudGlmaWVycy5hcHBlbmQoCiAgICAgICAgICAgICAgICBQYXJhbWV0ZXIoKippdGVtKSkKCiAgICAgICAgcmV0dXJuIGlkZW50aWZpZXJzCgogICAgQHByb3BlcnR5CiAgICBkZWYgbW9kZWwoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgR2V0IHRoZSByZXNvdXJjZSBtb2RlbCBmb3IgdGhlIHJlc3BvbnNlIHJlc291cmNlLgoKICAgICAgICA6dHlwZTogOnB5OmNsYXNzOmBSZXNvdXJjZU1vZGVsYAogICAgICAgICIiIgogICAgICAgIHJldHVybiBSZXNvdXJjZU1vZGVsKHNlbGYudHlwZSwgc2VsZi5fcmVzb3VyY2VfZGVmc1tzZWxmLnR5cGVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3Jlc291cmNlX2RlZnMpCgoKY2xhc3MgQ29sbGVjdGlvbihBY3Rpb24pOgogICAgIiIiCiAgICBBIGdyb3VwIG9mIHJlc291cmNlcy4gU2VlIDpweTpjbGFzczpgQWN0aW9uYC4KCiAgICA6dHlwZSBuYW1lOiBzdHJpbmcKICAgIDpwYXJhbSBuYW1lOiBUaGUgbmFtZSBvZiB0aGUgY29sbGVjdGlvbgogICAgOnR5cGUgZGVmaW5pdGlvbjogZGljdAogICAgOnBhcmFtIGRlZmluaXRpb246IFRoZSBKU09OIGRlZmluaXRpb24KICAgIDp0eXBlIHJlc291cmNlX2RlZnM6IGRpY3QKICAgIDpwYXJhbSByZXNvdXJjZV9kZWZzOiBBbGwgcmVzb3VyY2VzIGRlZmluZWQgaW4gdGhlIHNlcnZpY2UKICAgICIiIgogICAgQHByb3BlcnR5CiAgICBkZWYgYmF0Y2hfYWN0aW9ucyhzZWxmKToKICAgICAgICAiIiIKICAgICAgICBHZXQgYSBsaXN0IG9mIGJhdGNoIGFjdGlvbnMgc3VwcG9ydGVkIGJ5IHRoZSByZXNvdXJjZSB0eXBlCiAgICAgICAgY29udGFpbmVkIGluIHRoaXMgYWN0aW9uLiBUaGlzIGlzIGEgc2hvcnRjdXQgZm9yIGFjY2Vzc2luZwogICAgICAgIHRoZSBzYW1lIGluZm9ybWF0aW9uIHRocm91Z2ggdGhlIHJlc291cmNlIG1vZGVsLgoKICAgICAgICA6cnR5cGU6IGxpc3QoOnB5OmNsYXNzOmBBY3Rpb25gKQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLnJlc291cmNlLm1vZGVsLmJhdGNoX2FjdGlvbnMKCgpjbGFzcyBSZXNvdXJjZU1vZGVsKG9iamVjdCk6CiAgICAiIiIKICAgIEEgbW9kZWwgcmVwcmVzZW50aW5nIGEgcmVzb3VyY2UsIGRlZmluZWQgdmlhIGEgSlNPTiBkZXNjcmlwdGlvbgogICAgZm9ybWF0LiBBIHJlc291cmNlIGhhcyBpZGVudGlmaWVycywgYXR0cmlidXRlcywgYWN0aW9ucywKICAgIHN1Yi1yZXNvdXJjZXMsIHJlZmVyZW5jZXMgYW5kIGNvbGxlY3Rpb25zLiBGb3IgbW9yZSBpbmZvcm1hdGlvbgogICAgb24gcmVzb3VyY2VzLCBzZWUgOnJlZjpgZ3VpZGVfcmVzb3VyY2VzYC4KCiAgICA6dHlwZSBuYW1lOiBzdHJpbmcKICAgIDpwYXJhbSBuYW1lOiBUaGUgbmFtZSBvZiB0aGlzIHJlc291cmNlLCBlLmcuIGBgc3FzYGAgb3IgYGBRdWV1ZWBgCiAgICA6dHlwZSBkZWZpbml0aW9uOiBkaWN0CiAgICA6cGFyYW0gZGVmaW5pdGlvbjogVGhlIEpTT04gZGVmaW5pdGlvbgogICAgOnR5cGUgcmVzb3VyY2VfZGVmczogZGljdAogICAgOnBhcmFtIHJlc291cmNlX2RlZnM6IEFsbCByZXNvdXJjZXMgZGVmaW5lZCBpbiB0aGUgc2VydmljZQogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgbmFtZSwgZGVmaW5pdGlvbiwgcmVzb3VyY2VfZGVmcyk6CiAgICAgICAgc2VsZi5fZGVmaW5pdGlvbiA9IGRlZmluaXRpb24KICAgICAgICBzZWxmLl9yZXNvdXJjZV9kZWZzID0gcmVzb3VyY2VfZGVmcwogICAgICAgIHNlbGYuX3JlbmFtZWQgPSB7fQoKICAgICAgICAjOiAoYGBzdHJpbmdgYCkgVGhlIG5hbWUgb2YgdGhpcyByZXNvdXJjZQogICAgICAgIHNlbGYubmFtZSA9IG5hbWUKICAgICAgICAjOiAoYGBzdHJpbmdgYCkgVGhlIHNlcnZpY2Ugc2hhcGUgbmFtZSBmb3IgdGhpcyByZXNvdXJjZSBvciBgYE5vbmVgYAogICAgICAgIHNlbGYuc2hhcGUgPSBkZWZpbml0aW9uLmdldCgnc2hhcGUnKQoKICAgIGRlZiBsb2FkX3JlbmFtZV9tYXAoc2VsZiwgc2hhcGU9Tm9uZSk6CiAgICAgICAgIiIiCiAgICAgICAgTG9hZCBhIG5hbWUgdHJhbnNsYXRpb24gbWFwIGdpdmVuIGEgc2hhcGUuIFRoaXMgd2lsbCBzZXQKICAgICAgICB1cCByZW5hbWVkIHZhbHVlcyBmb3IgYW55IGNvbGxpc2lvbnMsIGUuZy4gaWYgdGhlIHNoYXBlLAogICAgICAgIGFuIGFjdGlvbiwgYW5kIGEgc3VicmVzb3VyY2UgYWxsIGFyZSBhbGwgbmFtZWQgYGBmb29gYAogICAgICAgIHRoZW4gdGhlIHJlc291cmNlIHdpbGwgaGF2ZSBhbiBhY3Rpb24gYGBmb29gYCwgYSBzdWJyZXNvdXJjZQogICAgICAgIG5hbWVkIGBgRm9vYGAgYW5kIGEgcHJvcGVydHkgbmFtZWQgYGBmb29fYXR0cmlidXRlYGAuCiAgICAgICAgVGhpcyBpcyB0aGUgb3JkZXIgb2YgcHJlY2VkZW5jZSwgZnJvbSBtb3N0IGltcG9ydGFudCB0bwogICAgICAgIGxlYXN0IGltcG9ydGFudDoKCiAgICAgICAgKiBMb2FkIGFjdGlvbiAocmVzb3VyY2UubG9hZCkKICAgICAgICAqIElkZW50aWZpZXJzCiAgICAgICAgKiBBY3Rpb25zCiAgICAgICAgKiBTdWJyZXNvdXJjZXMKICAgICAgICAqIFJlZmVyZW5jZXMKICAgICAgICAqIENvbGxlY3Rpb25zCiAgICAgICAgKiBXYWl0ZXJzCiAgICAgICAgKiBBdHRyaWJ1dGVzIChzaGFwZSBtZW1iZXJzKQoKICAgICAgICBCYXRjaCBhY3Rpb25zIGFyZSBvbmx5IGV4cG9zZWQgb24gY29sbGVjdGlvbnMsIHNvIGRvIG5vdAogICAgICAgIGdldCBtb2RpZmllZCBoZXJlLiBTdWJyZXNvdXJjZXMgdXNlIHVwcGVyIGNhbWVsIGNhc2luZywgc28KICAgICAgICBhcmUgdW5saWtlbHkgdG8gY29sbGlkZSB3aXRoIGFueXRoaW5nIGJ1dCBvdGhlciBzdWJyZXNvdXJjZXMuCgogICAgICAgIENyZWF0ZXMgYSBzdHJ1Y3R1cmUgbGlrZSB0aGlzOjoKCiAgICAgICAgICAgIHJlbmFtZXMgPSB7CiAgICAgICAgICAgICAgICAoJ2FjdGlvbicsICdpZCcpOiAnaWRfYWN0aW9uJywKICAgICAgICAgICAgICAgICgnY29sbGVjdGlvbicsICdpZCcpOiAnaWRfY29sbGVjdGlvbicsCiAgICAgICAgICAgICAgICAoJ2F0dHJpYnV0ZScsICdpZCcpOiAnaWRfYXR0cmlidXRlJwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEdldCB0aGUgZmluYWwgbmFtZSBmb3IgYW4gYWN0aW9uIG5hbWVkICdpZCcKICAgICAgICAgICAgbmFtZSA9IHJlbmFtZXMuZ2V0KCgnYWN0aW9uJywgJ2lkJyksICdpZCcpCgogICAgICAgIDp0eXBlIHNoYXBlOiBib3RvY29yZS5tb2RlbC5TaGFwZQogICAgICAgIDpwYXJhbSBzaGFwZTogVGhlIHVuZGVybHlpbmcgc2hhcGUgZm9yIHRoaXMgcmVzb3VyY2UuCiAgICAgICAgIiIiCiAgICAgICAgIyBNZXRhIGlzIGEgcmVzZXJ2ZWQgbmFtZSBmb3IgcmVzb3VyY2VzCiAgICAgICAgbmFtZXMgPSBzZXQoWydtZXRhJ10pCiAgICAgICAgc2VsZi5fcmVuYW1lZCA9IHt9CgogICAgICAgIGlmIHNlbGYuX2RlZmluaXRpb24uZ2V0KCdsb2FkJyk6CiAgICAgICAgICAgIG5hbWVzLmFkZCgnbG9hZCcpCgogICAgICAgIGZvciBpdGVtIGluIHNlbGYuX2RlZmluaXRpb24uZ2V0KCdpZGVudGlmaWVycycsIFtdKToKICAgICAgICAgICAgc2VsZi5fbG9hZF9uYW1lX3dpdGhfY2F0ZWdvcnkobmFtZXMsIGl0ZW1bJ25hbWUnXSwgJ2lkZW50aWZpZXInKQoKICAgICAgICBmb3IgbmFtZSBpbiBzZWxmLl9kZWZpbml0aW9uLmdldCgnYWN0aW9ucycsIHt9KToKICAgICAgICAgICAgc2VsZi5fbG9hZF9uYW1lX3dpdGhfY2F0ZWdvcnkobmFtZXMsIG5hbWUsICdhY3Rpb24nKQoKICAgICAgICBmb3IgbmFtZSwgcmVmIGluIHNlbGYuX2dldF9oYXNfZGVmaW5pdGlvbigpLml0ZW1zKCk6CiAgICAgICAgICAgICMgU3VicmVzb3VyY2VzIHJlcXVpcmUgbm8gZGF0YSBtZW1iZXJzLCBqdXN0IHR5cGljYWxseQogICAgICAgICAgICAjIGlkZW50aWZpZXJzIGFuZCB1c2VyIGlucHV0LgogICAgICAgICAgICBkYXRhX3JlcXVpcmVkID0gRmFsc2UKICAgICAgICAgICAgZm9yIGlkZW50aWZpZXIgaW4gcmVmWydyZXNvdXJjZSddWydpZGVudGlmaWVycyddOgogICAgICAgICAgICAgICAgaWYgaWRlbnRpZmllclsnc291cmNlJ10gPT0gJ2RhdGEnOgogICAgICAgICAgICAgICAgICAgIGRhdGFfcmVxdWlyZWQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIGlmIG5vdCBkYXRhX3JlcXVpcmVkOgogICAgICAgICAgICAgICAgc2VsZi5fbG9hZF9uYW1lX3dpdGhfY2F0ZWdvcnkobmFtZXMsIG5hbWUsICdzdWJyZXNvdXJjZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbmFrZV9jYXNlPUZhbHNlKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5fbG9hZF9uYW1lX3dpdGhfY2F0ZWdvcnkobmFtZXMsIG5hbWUsICdyZWZlcmVuY2UnKQoKICAgICAgICBmb3IgbmFtZSBpbiBzZWxmLl9kZWZpbml0aW9uLmdldCgnaGFzTWFueScsIHt9KToKICAgICAgICAgICAgc2VsZi5fbG9hZF9uYW1lX3dpdGhfY2F0ZWdvcnkobmFtZXMsIG5hbWUsICdjb2xsZWN0aW9uJykKCiAgICAgICAgZm9yIG5hbWUgaW4gc2VsZi5fZGVmaW5pdGlvbi5nZXQoJ3dhaXRlcnMnLCB7fSk6CiAgICAgICAgICAgIHNlbGYuX2xvYWRfbmFtZV93aXRoX2NhdGVnb3J5KG5hbWVzLCBXYWl0ZXIuUFJFRklYICsgbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dhaXRlcicpCgogICAgICAgIGlmIHNoYXBlIGlzIG5vdCBOb25lOgogICAgICAgICAgICBmb3IgbmFtZSBpbiBzaGFwZS5tZW1iZXJzLmtleXMoKToKICAgICAgICAgICAgICAgIHNlbGYuX2xvYWRfbmFtZV93aXRoX2NhdGVnb3J5KG5hbWVzLCBuYW1lLCAnYXR0cmlidXRlJykKCiAgICBkZWYgX2xvYWRfbmFtZV93aXRoX2NhdGVnb3J5KHNlbGYsIG5hbWVzLCBuYW1lLCBjYXRlZ29yeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc25ha2VfY2FzZT1UcnVlKToKICAgICAgICAiIiIKICAgICAgICBMb2FkIGEgbmFtZSB3aXRoIGEgZ2l2ZW4gY2F0ZWdvcnksIHBvc3NpYmx5IHJlbmFtaW5nIGl0CiAgICAgICAgaWYgdGhhdCBuYW1lIGlzIGFscmVhZHkgaW4gdXNlLiBUaGUgbmFtZSB3aWxsIGJlIHN0b3JlZAogICAgICAgIGluIGBgbmFtZXNgYCBhbmQgcG9zc2libHkgYmUgc2V0IHVwIGluIGBgc2VsZi5fcmVuYW1lZGBgLgoKICAgICAgICA6dHlwZSBuYW1lczogc2V0CiAgICAgICAgOnBhcmFtIG5hbWVzOiBFeGlzdGluZyBuYW1lcyAoUHl0aG9uIGF0dHJpYnV0ZXMsIHByb3BlcnRpZXMsIG9yCiAgICAgICAgICAgICAgICAgICAgICBtZXRob2RzKSBvbiB0aGUgcmVzb3VyY2UuCiAgICAgICAgOnR5cGUgbmFtZTogc3RyaW5nCiAgICAgICAgOnBhcmFtIG5hbWU6IFRoZSBvcmlnaW5hbCBuYW1lIG9mIHRoZSB2YWx1ZS4KICAgICAgICA6dHlwZSBjYXRlZ29yeTogc3RyaW5nCiAgICAgICAgOnBhcmFtIGNhdGVnb3J5OiBUaGUgdmFsdWUgdHlwZSwgc3VjaCBhcyAnaWRlbnRpZmllcicgb3IgJ2FjdGlvbicKICAgICAgICA6dHlwZSBzbmFrZV9jYXNlOiBib29sCiAgICAgICAgOnBhcmFtIHNuYWtlX2Nhc2U6IFRydWUgKGRlZmF1bHQpIGlmIHRoZSBuYW1lIHNob3VsZCBiZSBzbmFrZSBjYXNlZC4KICAgICAgICAiIiIKICAgICAgICBpZiBzbmFrZV9jYXNlOgogICAgICAgICAgICBuYW1lID0geGZvcm1fbmFtZShuYW1lKQoKICAgICAgICBpZiBuYW1lIGluIG5hbWVzOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoJ1JlbmFtaW5nICVzICVzICVzJyAlIChzZWxmLm5hbWUsIGNhdGVnb3J5LCBuYW1lKSkKICAgICAgICAgICAgc2VsZi5fcmVuYW1lZFsoY2F0ZWdvcnksIG5hbWUpXSA9IG5hbWUgKyAnXycgKyBjYXRlZ29yeQogICAgICAgICAgICBuYW1lICs9ICdfJyArIGNhdGVnb3J5CgogICAgICAgICAgICBpZiBuYW1lIGluIG5hbWVzOgogICAgICAgICAgICAgICAgIyBUaGlzIGlzbid0IGdvb2QsIGxldCdzIHJhaXNlIGluc3RlYWQgb2YgdHJ5aW5nIHRvIGtlZXAKICAgICAgICAgICAgICAgICMgcmVuYW1pbmcgdGhpcyB2YWx1ZS4KICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ1Byb2JsZW0gcmVuYW1pbmcgezB9IHsxfSB0byB7Mn0hJy5mb3JtYXQoCiAgICAgICAgICAgICAgICAgICAgc2VsZi5uYW1lLCBjYXRlZ29yeSwgbmFtZSkpCgogICAgICAgIG5hbWVzLmFkZChuYW1lKQoKICAgIGRlZiBfZ2V0X25hbWUoc2VsZiwgY2F0ZWdvcnksIG5hbWUsIHNuYWtlX2Nhc2U9VHJ1ZSk6CiAgICAgICAgIiIiCiAgICAgICAgR2V0IGEgcG9zc2libHkgcmVuYW1lZCB2YWx1ZSBnaXZlbiBhIGNhdGVnb3J5IGFuZCBuYW1lLiBUaGlzCiAgICAgICAgdXNlcyB0aGUgcmVuYW1lIG1hcCBzZXQgdXAgaW4gYGBsb2FkX3JlbmFtZV9tYXBgYCwgc28gdGhhdAogICAgICAgIG1ldGhvZCBtdXN0IGJlIGNhbGxlZCBvbmNlIGZpcnN0LgoKICAgICAgICA6dHlwZSBjYXRlZ29yeTogc3RyaW5nCiAgICAgICAgOnBhcmFtIGNhdGVnb3J5OiBUaGUgdmFsdWUgdHlwZSwgc3VjaCBhcyAnaWRlbnRpZmllcicgb3IgJ2FjdGlvbicKICAgICAgICA6dHlwZSBuYW1lOiBzdHJpbmcKICAgICAgICA6cGFyYW0gbmFtZTogVGhlIG9yaWdpbmFsIG5hbWUgb2YgdGhlIHZhbHVlCiAgICAgICAgOnR5cGUgc25ha2VfY2FzZTogYm9vbAogICAgICAgIDpwYXJhbSBzbmFrZV9jYXNlOiBUcnVlIChkZWZhdWx0KSBpZiB0aGUgbmFtZSBzaG91bGQgYmUgc25ha2UgY2FzZWQuCiAgICAgICAgOnJ0eXBlOiBzdHJpbmcKICAgICAgICA6cmV0dXJuOiBFaXRoZXIgdGhlIHJlbmFtZWQgdmFsdWUgaWYgaXQgaXMgc2V0LCBvdGhlcndpc2UgdGhlCiAgICAgICAgICAgICAgICAgb3JpZ2luYWwgbmFtZS4KICAgICAgICAiIiIKICAgICAgICBpZiBzbmFrZV9jYXNlOgogICAgICAgICAgICBuYW1lID0geGZvcm1fbmFtZShuYW1lKQoKICAgICAgICByZXR1cm4gc2VsZi5fcmVuYW1lZC5nZXQoKGNhdGVnb3J5LCBuYW1lKSwgbmFtZSkKCiAgICBkZWYgZ2V0X2F0dHJpYnV0ZXMoc2VsZiwgc2hhcGUpOgogICAgICAgICIiIgogICAgICAgIEdldCBhIGRpY3Rpb25hcnkgb2YgYXR0cmlidXRlIG5hbWVzIHRvIG9yaWdpbmFsIG5hbWUgYW5kIHNoYXBlCiAgICAgICAgbW9kZWxzIHRoYXQgcmVwcmVzZW50IHRoZSBhdHRyaWJ1dGVzIG9mIHRoaXMgcmVzb3VyY2UuIExvb2tzCiAgICAgICAgbGlrZSB0aGUgZm9sbG93aW5nOgoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJ3NvbWVfbmFtZSc6ICgnU29tZU5hbWUnLCA8U2hhcGUuLi4+KQogICAgICAgICAgICB9CgogICAgICAgIDp0eXBlIHNoYXBlOiBib3RvY29yZS5tb2RlbC5TaGFwZQogICAgICAgIDpwYXJhbSBzaGFwZTogVGhlIHVuZGVybHlpbmcgc2hhcGUgZm9yIHRoaXMgcmVzb3VyY2UuCiAgICAgICAgOnJ0eXBlOiBkaWN0CiAgICAgICAgOnJldHVybjogTWFwcGluZyBvZiByZXNvdXJjZSBhdHRyaWJ1dGVzLgogICAgICAgICIiIgogICAgICAgIGF0dHJpYnV0ZXMgPSB7fQogICAgICAgIGlkZW50aWZpZXJfbmFtZXMgPSBbaS5uYW1lIGZvciBpIGluIHNlbGYuaWRlbnRpZmllcnNdCgogICAgICAgIGZvciBuYW1lLCBtZW1iZXIgaW4gc2hhcGUubWVtYmVycy5pdGVtcygpOgogICAgICAgICAgICBzbmFrZV9jYXNlZCA9IHhmb3JtX25hbWUobmFtZSkKICAgICAgICAgICAgaWYgc25ha2VfY2FzZWQgaW4gaWRlbnRpZmllcl9uYW1lczoKICAgICAgICAgICAgICAgICMgU2tpcCBpZGVudGlmaWVycywgdGhlc2UgYXJlIHNldCB0aHJvdWdoIG90aGVyIG1lYW5zCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBzbmFrZV9jYXNlZCA9IHNlbGYuX2dldF9uYW1lKCdhdHRyaWJ1dGUnLCBzbmFrZV9jYXNlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbmFrZV9jYXNlPUZhbHNlKQogICAgICAgICAgICBhdHRyaWJ1dGVzW3NuYWtlX2Nhc2VkXSA9IChuYW1lLCBtZW1iZXIpCgogICAgICAgIHJldHVybiBhdHRyaWJ1dGVzCgogICAgQHByb3BlcnR5CiAgICBkZWYgaWRlbnRpZmllcnMoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgR2V0IGEgbGlzdCBvZiByZXNvdXJjZSBpZGVudGlmaWVycy4KCiAgICAgICAgOnR5cGU6IGxpc3QoOnB5OmNsYXNzOmBJZGVudGlmaWVyYCkKICAgICAgICAiIiIKICAgICAgICBpZGVudGlmaWVycyA9IFtdCgogICAgICAgIGZvciBpdGVtIGluIHNlbGYuX2RlZmluaXRpb24uZ2V0KCdpZGVudGlmaWVycycsIFtdKToKICAgICAgICAgICAgbmFtZSA9IHNlbGYuX2dldF9uYW1lKCdpZGVudGlmaWVyJywgaXRlbVsnbmFtZSddKQogICAgICAgICAgICBtZW1iZXJfbmFtZSA9IGl0ZW0uZ2V0KCdtZW1iZXJOYW1lJywgTm9uZSkKICAgICAgICAgICAgaWYgbWVtYmVyX25hbWU6CiAgICAgICAgICAgICAgICBtZW1iZXJfbmFtZSA9IHNlbGYuX2dldF9uYW1lKCdhdHRyaWJ1dGUnLCBtZW1iZXJfbmFtZSkKICAgICAgICAgICAgaWRlbnRpZmllcnMuYXBwZW5kKElkZW50aWZpZXIobmFtZSwgbWVtYmVyX25hbWUpKQoKICAgICAgICByZXR1cm4gaWRlbnRpZmllcnMKCiAgICBAcHJvcGVydHkKICAgIGRlZiBsb2FkKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIEdldCB0aGUgbG9hZCBhY3Rpb24gZm9yIHRoaXMgcmVzb3VyY2UsIGlmIGl0IGlzIGRlZmluZWQuCgogICAgICAgIDp0eXBlOiA6cHk6Y2xhc3M6YEFjdGlvbmAgb3IgYGBOb25lYGAKICAgICAgICAiIiIKICAgICAgICBhY3Rpb24gPSBzZWxmLl9kZWZpbml0aW9uLmdldCgnbG9hZCcpCgogICAgICAgIGlmIGFjdGlvbiBpcyBub3QgTm9uZToKICAgICAgICAgICAgYWN0aW9uID0gQWN0aW9uKCdsb2FkJywgYWN0aW9uLCBzZWxmLl9yZXNvdXJjZV9kZWZzKQoKICAgICAgICByZXR1cm4gYWN0aW9uCgogICAgQHByb3BlcnR5CiAgICBkZWYgYWN0aW9ucyhzZWxmKToKICAgICAgICAiIiIKICAgICAgICBHZXQgYSBsaXN0IG9mIGFjdGlvbnMgZm9yIHRoaXMgcmVzb3VyY2UuCgogICAgICAgIDp0eXBlOiBsaXN0KDpweTpjbGFzczpgQWN0aW9uYCkKICAgICAgICAiIiIKICAgICAgICBhY3Rpb25zID0gW10KCiAgICAgICAgZm9yIG5hbWUsIGl0ZW0gaW4gc2VsZi5fZGVmaW5pdGlvbi5nZXQoJ2FjdGlvbnMnLCB7fSkuaXRlbXMoKToKICAgICAgICAgICAgbmFtZSA9IHNlbGYuX2dldF9uYW1lKCdhY3Rpb24nLCBuYW1lKQogICAgICAgICAgICBhY3Rpb25zLmFwcGVuZChBY3Rpb24obmFtZSwgaXRlbSwgc2VsZi5fcmVzb3VyY2VfZGVmcykpCgogICAgICAgIHJldHVybiBhY3Rpb25zCgogICAgQHByb3BlcnR5CiAgICBkZWYgYmF0Y2hfYWN0aW9ucyhzZWxmKToKICAgICAgICAiIiIKICAgICAgICBHZXQgYSBsaXN0IG9mIGJhdGNoIGFjdGlvbnMgZm9yIHRoaXMgcmVzb3VyY2UuCgogICAgICAgIDp0eXBlOiBsaXN0KDpweTpjbGFzczpgQWN0aW9uYCkKICAgICAgICAiIiIKICAgICAgICBhY3Rpb25zID0gW10KCiAgICAgICAgZm9yIG5hbWUsIGl0ZW0gaW4gc2VsZi5fZGVmaW5pdGlvbi5nZXQoJ2JhdGNoQWN0aW9ucycsIHt9KS5pdGVtcygpOgogICAgICAgICAgICBuYW1lID0gc2VsZi5fZ2V0X25hbWUoJ2JhdGNoX2FjdGlvbicsIG5hbWUpCiAgICAgICAgICAgIGFjdGlvbnMuYXBwZW5kKEFjdGlvbihuYW1lLCBpdGVtLCBzZWxmLl9yZXNvdXJjZV9kZWZzKSkKCiAgICAgICAgcmV0dXJuIGFjdGlvbnMKCiAgICBkZWYgX2dldF9oYXNfZGVmaW5pdGlvbihzZWxmKToKICAgICAgICAiIiIKICAgICAgICBHZXQgYSBgYGhhc2BgIHJlbGF0aW9uc2hpcCBkZWZpbml0aW9uIGZyb20gYSBtb2RlbCwgd2hlcmUgdGhlCiAgICAgICAgc2VydmljZSByZXNvdXJjZSBtb2RlbCBpcyB0cmVhdGVkIHNwZWNpYWwgaW4gdGhhdCBpdCBjb250YWlucwogICAgICAgIGEgcmVsYXRpb25zaGlwIHRvIGV2ZXJ5IHJlc291cmNlIGRlZmluZWQgZm9yIHRoZSBzZXJ2aWNlLiBUaGlzCiAgICAgICAgYWxsb3dzIHRoaW5ncyBsaWtlIGBgczMuT2JqZWN0KCdidWNrZXQtbmFtZScsICdrZXknKWBgIHRvCiAgICAgICAgd29yayBldmVuIHRob3VnaCB0aGUgSlNPTiBkb2Vzbid0IGRlZmluZSBpdCBleHBsaWNpdGx5LgoKICAgICAgICA6cnR5cGU6IGRpY3QKICAgICAgICA6cmV0dXJuOiBNYXBwaW5nIG9mIG5hbWVzIHRvIHN1YnJlc291cmNlIGFuZCByZWZlcmVuY2UKICAgICAgICAgICAgICAgICBkZWZpbml0aW9ucy4KICAgICAgICAiIiIKICAgICAgICBpZiBzZWxmLm5hbWUgbm90IGluIHNlbGYuX3Jlc291cmNlX2RlZnM6CiAgICAgICAgICAgICMgVGhpcyBpcyB0aGUgc2VydmljZSByZXNvdXJjZSwgc28gbGV0IHVzIGV4cG9zZSBhbGwgb2YKICAgICAgICAgICAgIyB0aGUgZGVmaW5lZCByZXNvdXJjZXMgYXMgc3VicmVzb3VyY2VzLgogICAgICAgICAgICBkZWZpbml0aW9uID0ge30KCiAgICAgICAgICAgIGZvciBuYW1lLCByZXNvdXJjZV9kZWYgaW4gc2VsZi5fcmVzb3VyY2VfZGVmcy5pdGVtcygpOgogICAgICAgICAgICAgICAgIyBJdCdzIHBvc3NpYmxlIGZvciB0aGUgc2VydmljZSB0byBoYXZlIHJlbmFtZWQgYQogICAgICAgICAgICAgICAgIyByZXNvdXJjZSBvciB0byBoYXZlIGRlZmluZWQgbXVsdGlwbGUgbmFtZXMgdGhhdAogICAgICAgICAgICAgICAgIyBwb2ludCB0byB0aGUgc2FtZSByZXNvdXJjZSB0eXBlLCBzbyB3ZSBuZWVkIHRvCiAgICAgICAgICAgICAgICAjIHRha2UgdGhhdCBpbnRvIGFjY291bnQuCiAgICAgICAgICAgICAgICBmb3VuZCA9IEZhbHNlCiAgICAgICAgICAgICAgICBoYXNfaXRlbXMgPSBzZWxmLl9kZWZpbml0aW9uLmdldCgnaGFzJywge30pLml0ZW1zKCkKICAgICAgICAgICAgICAgIGZvciBoYXNfbmFtZSwgaGFzX2RlZiBpbiBoYXNfaXRlbXM6CiAgICAgICAgICAgICAgICAgICAgaWYgaGFzX2RlZi5nZXQoJ3Jlc291cmNlJywge30pLmdldCgndHlwZScpID09IG5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluaXRpb25baGFzX25hbWVdID0gaGFzX2RlZgogICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IFRydWUKCiAgICAgICAgICAgICAgICBpZiBub3QgZm91bmQ6CiAgICAgICAgICAgICAgICAgICAgIyBDcmVhdGUgYSByZWxhdGlvbnNoaXAgZGVmaW5pdGlvbiBhbmQgYXR0YWNoIGl0CiAgICAgICAgICAgICAgICAgICAgIyB0byB0aGUgbW9kZWwsIHN1Y2ggdGhhdCBhbGwgaWRlbnRpZmllcnMgbXVzdCBiZQogICAgICAgICAgICAgICAgICAgICMgc3VwcGxpZWQgYnkgdGhlIHVzZXIuIEl0IHdpbGwgbG9vayBzb21ldGhpbmcgbGlrZToKICAgICAgICAgICAgICAgICAgICAjCiAgICAgICAgICAgICAgICAgICAgIyB7CiAgICAgICAgICAgICAgICAgICAgIyAgICdyZXNvdXJjZSc6IHsKICAgICAgICAgICAgICAgICAgICAjICAgICAndHlwZSc6ICdSZXNvdXJjZU5hbWUnLAogICAgICAgICAgICAgICAgICAgICMgICAgICdpZGVudGlmaWVycyc6IFsKICAgICAgICAgICAgICAgICAgICAjICAgICAgIHsndGFyZ2V0JzogJ05hbWUxJywgJ3NvdXJjZSc6ICdpbnB1dCd9LAogICAgICAgICAgICAgICAgICAgICMgICAgICAgeyd0YXJnZXQnOiAnTmFtZTInLCAnc291cmNlJzogJ2lucHV0J30sCiAgICAgICAgICAgICAgICAgICAgIyAgICAgICAuLi4KICAgICAgICAgICAgICAgICAgICAjICAgICBdCiAgICAgICAgICAgICAgICAgICAgIyAgIH0KICAgICAgICAgICAgICAgICAgICAjIH0KICAgICAgICAgICAgICAgICAgICAjCiAgICAgICAgICAgICAgICAgICAgZmFrZV9oYXMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICdyZXNvdXJjZSc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJzogbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpZGVudGlmaWVycyc6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGZvciBpZGVudGlmaWVyIGluIHJlc291cmNlX2RlZi5nZXQoJ2lkZW50aWZpZXJzJywgW10pOgogICAgICAgICAgICAgICAgICAgICAgICBmYWtlX2hhc1sncmVzb3VyY2UnXVsnaWRlbnRpZmllcnMnXS5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RhcmdldCc6IGlkZW50aWZpZXJbJ25hbWUnXSwgJ3NvdXJjZSc6ICdpbnB1dCcKICAgICAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgZGVmaW5pdGlvbltuYW1lXSA9IGZha2VfaGFzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVmaW5pdGlvbiA9IHNlbGYuX2RlZmluaXRpb24uZ2V0KCdoYXMnLCB7fSkKCiAgICAgICAgcmV0dXJuIGRlZmluaXRpb24KCiAgICBkZWYgX2dldF9yZWxhdGVkX3Jlc291cmNlcyhzZWxmLCBzdWJyZXNvdXJjZXMpOgogICAgICAgICIiIgogICAgICAgIEdldCBhIGxpc3Qgb2Ygc3ViLXJlc291cmNlcyBvciByZWZlcmVuY2VzLgoKICAgICAgICA6dHlwZSBzdWJyZXNvdXJjZXM6IGJvb2wKICAgICAgICA6cGFyYW0gc3VicmVzb3VyY2VzOiBgYFRydWVgYCB0byBnZXQgc3ViLXJlc291cmNlcywgYGBGYWxzZWBgIHRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0IHJlZmVyZW5jZXMuCiAgICAgICAgOnJ0eXBlOiBsaXN0KDpweTpjbGFzczpgQWN0aW9uYCkKICAgICAgICAiIiIKICAgICAgICByZXNvdXJjZXMgPSBbXQoKICAgICAgICBmb3IgbmFtZSwgZGVmaW5pdGlvbiBpbiBzZWxmLl9nZXRfaGFzX2RlZmluaXRpb24oKS5pdGVtcygpOgogICAgICAgICAgICBpZiBzdWJyZXNvdXJjZXM6CiAgICAgICAgICAgICAgICBuYW1lID0gc2VsZi5fZ2V0X25hbWUoJ3N1YnJlc291cmNlJywgbmFtZSwgc25ha2VfY2FzZT1GYWxzZSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG5hbWUgPSBzZWxmLl9nZXRfbmFtZSgncmVmZXJlbmNlJywgbmFtZSkKICAgICAgICAgICAgYWN0aW9uID0gQWN0aW9uKG5hbWUsIGRlZmluaXRpb24sIHNlbGYuX3Jlc291cmNlX2RlZnMpCgogICAgICAgICAgICBkYXRhX3JlcXVpcmVkID0gRmFsc2UKICAgICAgICAgICAgZm9yIGlkZW50aWZpZXIgaW4gYWN0aW9uLnJlc291cmNlLmlkZW50aWZpZXJzOgogICAgICAgICAgICAgICAgaWYgaWRlbnRpZmllci5zb3VyY2UgPT0gJ2RhdGEnOgogICAgICAgICAgICAgICAgICAgIGRhdGFfcmVxdWlyZWQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIGlmIHN1YnJlc291cmNlcyBhbmQgbm90IGRhdGFfcmVxdWlyZWQ6CiAgICAgICAgICAgICAgICByZXNvdXJjZXMuYXBwZW5kKGFjdGlvbikKICAgICAgICAgICAgZWxpZiBub3Qgc3VicmVzb3VyY2VzIGFuZCBkYXRhX3JlcXVpcmVkOgogICAgICAgICAgICAgICAgcmVzb3VyY2VzLmFwcGVuZChhY3Rpb24pCgogICAgICAgIHJldHVybiByZXNvdXJjZXMKCiAgICBAcHJvcGVydHkKICAgIGRlZiBzdWJyZXNvdXJjZXMoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgR2V0IGEgbGlzdCBvZiBzdWItcmVzb3VyY2VzLgoKICAgICAgICA6dHlwZTogbGlzdCg6cHk6Y2xhc3M6YEFjdGlvbmApCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX2dldF9yZWxhdGVkX3Jlc291cmNlcyhUcnVlKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHJlZmVyZW5jZXMoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgR2V0IGEgbGlzdCBvZiByZWZlcmVuY2UgcmVzb3VyY2VzLgoKICAgICAgICA6dHlwZTogbGlzdCg6cHk6Y2xhc3M6YEFjdGlvbmApCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX2dldF9yZWxhdGVkX3Jlc291cmNlcyhGYWxzZSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBjb2xsZWN0aW9ucyhzZWxmKToKICAgICAgICAiIiIKICAgICAgICBHZXQgYSBsaXN0IG9mIGNvbGxlY3Rpb25zIGZvciB0aGlzIHJlc291cmNlLgoKICAgICAgICA6dHlwZTogbGlzdCg6cHk6Y2xhc3M6YENvbGxlY3Rpb25gKQogICAgICAgICIiIgogICAgICAgIGNvbGxlY3Rpb25zID0gW10KCiAgICAgICAgZm9yIG5hbWUsIGl0ZW0gaW4gc2VsZi5fZGVmaW5pdGlvbi5nZXQoJ2hhc01hbnknLCB7fSkuaXRlbXMoKToKICAgICAgICAgICAgbmFtZSA9IHNlbGYuX2dldF9uYW1lKCdjb2xsZWN0aW9uJywgbmFtZSkKICAgICAgICAgICAgY29sbGVjdGlvbnMuYXBwZW5kKENvbGxlY3Rpb24obmFtZSwgaXRlbSwgc2VsZi5fcmVzb3VyY2VfZGVmcykpCgogICAgICAgIHJldHVybiBjb2xsZWN0aW9ucwoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHdhaXRlcnMoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgR2V0IGEgbGlzdCBvZiB3YWl0ZXJzIGZvciB0aGlzIHJlc291cmNlLgoKICAgICAgICA6dHlwZTogbGlzdCg6cHk6Y2xhc3M6YFdhaXRlcmApCiAgICAgICAgIiIiCiAgICAgICAgd2FpdGVycyA9IFtdCgogICAgICAgIGZvciBuYW1lLCBpdGVtIGluIHNlbGYuX2RlZmluaXRpb24uZ2V0KCd3YWl0ZXJzJywge30pLml0ZW1zKCk6CiAgICAgICAgICAgIG5hbWUgPSBzZWxmLl9nZXRfbmFtZSgnd2FpdGVyJywgV2FpdGVyLlBSRUZJWCArIG5hbWUpCiAgICAgICAgICAgIHdhaXRlcnMuYXBwZW5kKFdhaXRlcihuYW1lLCBpdGVtKSkKCiAgICAgICAgcmV0dXJuIHdhaXRlcnMK
