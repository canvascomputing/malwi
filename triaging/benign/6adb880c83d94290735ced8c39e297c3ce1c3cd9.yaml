statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/activity.py
  contents:
  - name: CustomActivity.__init__
    score: 0.0
    code: |-
      def __init__(self, name, *, emoji=None, **extra):
              super().__init__(**extra)
              self.name = name
              self.state = extra.pop('state', None)
              if self.name == 'Custom Status':
                  self.name = self.state

              if emoji is None:
                  self.emoji = emoji
              elif isinstance(emoji, dict):
                  self.emoji = PartialEmoji.from_dict(emoji)
              elif isinstance(emoji, str):
                  self.emoji = PartialEmoji(name=emoji)
              elif isinstance(emoji, PartialEmoji):
                  self.emoji = emoji
              else:
                  raise TypeError('Expected str, PartialEmoji, or None, received {0!r} instead.'.format(type(emoji)))
    tokens: copy_free_vars resume load_global super load_deref __class__ load_fast self load_super_attr __init__ load_const build_map load_fast extra dict_merge call_function_ex pop_top load_fast name load_fast self store_attr name load_fast extra load_attr pop load_const state load_const call load_fast self store_attr state load_fast self load_attr name load_const Custom Status compare_op == pop_jump_if_false TO_NUMBER load_fast self load_attr state load_fast self store_attr name load_fast emoji pop_jump_if_not_none TO_NUMBER load_fast emoji load_fast self store_attr emoji return_const None load_global isinstance load_fast emoji load_global dict call pop_jump_if_false TO_NUMBER load_global PartialEmoji load_attr from_dict load_fast emoji call load_fast self store_attr emoji return_const None load_global isinstance load_fast emoji load_global str call pop_jump_if_false TO_NUMBER load_global PartialEmoji load_fast emoji kw_names name call load_fast self store_attr emoji return_const None load_global isinstance load_fast emoji load_global PartialEmoji call pop_jump_if_false TO_NUMBER load_fast emoji load_fast self store_attr emoji return_const None load_global TypeError load_const STRING_LEN_S_ENT_HIGH load_attr format load_global type load_fast emoji call call call raise_varargs
    hash: 8d383a29c2a484380012ba3b0450988c1dfd0b78b3a8bf2553cfe0cc285eae04
sources:
  .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/activity.py: IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KCiIiIgpUaGUgTUlUIExpY2Vuc2UgKE1JVCkKCkNvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50IFJhcHB0egoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgp0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlClNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCk9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwpGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSCkRFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KIiIiCgppbXBvcnQgZGF0ZXRpbWUKCmZyb20gLmFzc2V0IGltcG9ydCBBc3NldApmcm9tIC5lbnVtcyBpbXBvcnQgQWN0aXZpdHlUeXBlLCB0cnlfZW51bQpmcm9tIC5jb2xvdXIgaW1wb3J0IENvbG91cgpmcm9tIC5wYXJ0aWFsX2Vtb2ppIGltcG9ydCBQYXJ0aWFsRW1vamkKZnJvbSAudXRpbHMgaW1wb3J0IF9nZXRfYXNfc25vd2ZsYWtlCgpfX2FsbF9fID0gKAogICAgJ0Jhc2VBY3Rpdml0eScsCiAgICAnQWN0aXZpdHknLAogICAgJ1N0cmVhbWluZycsCiAgICAnR2FtZScsCiAgICAnU3BvdGlmeScsCiAgICAnQ3VzdG9tQWN0aXZpdHknLAopCgoiIiJJZiBjdXJpb3VzLCB0aGlzIGlzIHRoZSBjdXJyZW50IHNjaGVtYSBmb3IgYW4gYWN0aXZpdHkuCgpJdCdzIGZhaXJseSBsb25nIHNvIEkgd2lsbCBkb2N1bWVudCBpdCBoZXJlOgoKQWxsIGtleXMgYXJlIG9wdGlvbmFsLgoKc3RhdGU6IHN0ciAobWF4OiAxMjgpLApkZXRhaWxzOiBzdHIgKG1heDogMTI4KQp0aW1lc3RhbXBzOiBkaWN0CiAgICBzdGFydDogaW50IChtaW46IDEpCiAgICBlbmQ6IGludCAobWluOiAxKQphc3NldHM6IGRpY3QKICAgIGxhcmdlX2ltYWdlOiBzdHIgKG1heDogMzIpCiAgICBsYXJnZV90ZXh0OiBzdHIgKG1heDogMTI4KQogICAgc21hbGxfaW1hZ2U6IHN0ciAobWF4OiAzMikKICAgIHNtYWxsX3RleHQ6IHN0ciAobWF4OiAxMjgpCnBhcnR5OiBkaWN0CiAgICBpZDogc3RyIChtYXg6IDEyOCksCiAgICBzaXplOiBMaXN0W2ludF0gKG1heC1sZW5ndGg6IDIpCiAgICAgICAgZWxlbTogaW50IChtaW46IDEpCnNlY3JldHM6IGRpY3QKICAgIG1hdGNoOiBzdHIgKG1heDogMTI4KQogICAgam9pbjogc3RyIChtYXg6IDEyOCkKICAgIHNwZWN0YXRlOiBzdHIgKG1heDogMTI4KQppbnN0YW5jZTogYm9vbAphcHBsaWNhdGlvbl9pZDogc3RyCm5hbWU6IHN0ciAobWF4OiAxMjgpCnVybDogc3RyCnR5cGU6IGludApzeW5jX2lkOiBzdHIKc2Vzc2lvbl9pZDogc3RyCmZsYWdzOiBpbnQKClRoZXJlIGFyZSBhbHNvIGFjdGl2aXR5IGZsYWdzIHdoaWNoIGFyZSBtb3N0bHkgdW5pbnRlcmVzdGluZyBmb3IgdGhlIGxpYnJhcnkgYXRtLgoKdC5BY3Rpdml0eUZsYWdzID0gewogICAgSU5TVEFOQ0U6IDEsCiAgICBKT0lOOiAyLAogICAgU1BFQ1RBVEU6IDQsCiAgICBKT0lOX1JFUVVFU1Q6IDgsCiAgICBTWU5DOiAxNiwKICAgIFBMQVk6IDMyCn0KIiIiCgpjbGFzcyBCYXNlQWN0aXZpdHk6CiAgICAiIiJUaGUgYmFzZSBhY3Rpdml0eSB0aGF0IGFsbCB1c2VyLXNldHRhYmxlIGFjdGl2aXRpZXMgaW5oZXJpdCBmcm9tLgogICAgQSB1c2VyLXNldHRhYmxlIGFjdGl2aXR5IGlzIG9uZSB0aGF0IGNhbiBiZSB1c2VkIGluIDptZXRoOmBDbGllbnQuY2hhbmdlX3ByZXNlbmNlYC4KCiAgICBUaGUgZm9sbG93aW5nIHR5cGVzIGN1cnJlbnRseSBjb3VudCBhcyB1c2VyLXNldHRhYmxlOgoKICAgIC0gOmNsYXNzOmBBY3Rpdml0eWAKICAgIC0gOmNsYXNzOmBHYW1lYAogICAgLSA6Y2xhc3M6YFN0cmVhbWluZ2AKICAgIC0gOmNsYXNzOmBDdXN0b21BY3Rpdml0eWAKCiAgICBOb3RlIHRoYXQgYWx0aG91Z2ggdGhlc2UgdHlwZXMgYXJlIGNvbnNpZGVyZWQgdXNlci1zZXR0YWJsZSBieSB0aGUgbGlicmFyeSwKICAgIERpc2NvcmQgdHlwaWNhbGx5IGlnbm9yZXMgY2VydGFpbiBjb21iaW5hdGlvbnMgb2YgYWN0aXZpdHkgZGVwZW5kaW5nIG9uCiAgICB3aGF0IGlzIGN1cnJlbnRseSBzZXQuIFRoaXMgYmVoYXZpb3VyIG1heSBjaGFuZ2UgaW4gdGhlIGZ1dHVyZSBzbyB0aGVyZSBhcmUKICAgIG5vIGd1YXJhbnRlZXMgb24gd2hldGhlciBEaXNjb3JkIHdpbGwgYWN0dWFsbHkgbGV0IHlvdSBzZXQgdGhlc2UgdHlwZXMuCgogICAgLi4gdmVyc2lvbmFkZGVkOjogMS4zCiAgICAiIiIKICAgIF9fc2xvdHNfXyA9ICgnX2NyZWF0ZWRfYXQnLCkKCiAgICBkZWYgX19pbml0X18oc2VsZiwgKiprd2FyZ3MpOgogICAgICAgIHNlbGYuX2NyZWF0ZWRfYXQgPSBrd2FyZ3MucG9wKCdjcmVhdGVkX2F0JywgTm9uZSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBjcmVhdGVkX2F0KHNlbGYpOgogICAgICAgICIiIk9wdGlvbmFsWzpjbGFzczpgZGF0ZXRpbWUuZGF0ZXRpbWVgXTogV2hlbiB0aGUgdXNlciBzdGFydGVkIGRvaW5nIHRoaXMgYWN0aXZpdHkgaW4gVVRDLgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjMKICAgICAgICAiIiIKICAgICAgICBpZiBzZWxmLl9jcmVhdGVkX2F0IGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXR1cm4gZGF0ZXRpbWUuZGF0ZXRpbWUudXRjZnJvbXRpbWVzdGFtcChzZWxmLl9jcmVhdGVkX2F0IC8gMTAwMCkKCmNsYXNzIEFjdGl2aXR5KEJhc2VBY3Rpdml0eSk6CiAgICAiIiJSZXByZXNlbnRzIGFuIGFjdGl2aXR5IGluIERpc2NvcmQuCgogICAgVGhpcyBjb3VsZCBiZSBhbiBhY3Rpdml0eSBzdWNoIGFzIHN0cmVhbWluZywgcGxheWluZywgbGlzdGVuaW5nCiAgICBvciB3YXRjaGluZy4KCiAgICBGb3IgbWVtb3J5IG9wdGltaXNhdGlvbiBwdXJwb3Nlcywgc29tZSBhY3Rpdml0aWVzIGFyZSBvZmZlcmVkIGluIHNsaW1tZWQKICAgIGRvd24gdmVyc2lvbnM6CgogICAgLSA6Y2xhc3M6YEdhbWVgCiAgICAtIDpjbGFzczpgU3RyZWFtaW5nYAoKICAgIEF0dHJpYnV0ZXMKICAgIC0tLS0tLS0tLS0tLQogICAgYXBwbGljYXRpb25faWQ6IDpjbGFzczpgaW50YAogICAgICAgIFRoZSBhcHBsaWNhdGlvbiBJRCBvZiB0aGUgZ2FtZS4KICAgIG5hbWU6IDpjbGFzczpgc3RyYAogICAgICAgIFRoZSBuYW1lIG9mIHRoZSBhY3Rpdml0eS4KICAgIHVybDogOmNsYXNzOmBzdHJgCiAgICAgICAgQSBzdHJlYW0gVVJMIHRoYXQgdGhlIGFjdGl2aXR5IGNvdWxkIGJlIGRvaW5nLgogICAgdHlwZTogOmNsYXNzOmBBY3Rpdml0eVR5cGVgCiAgICAgICAgVGhlIHR5cGUgb2YgYWN0aXZpdHkgY3VycmVudGx5IGJlaW5nIGRvbmUuCiAgICBzdGF0ZTogOmNsYXNzOmBzdHJgCiAgICAgICAgVGhlIHVzZXIncyBjdXJyZW50IHN0YXRlLiBGb3IgZXhhbXBsZSwgIkluIEdhbWUiLgogICAgZGV0YWlsczogOmNsYXNzOmBzdHJgCiAgICAgICAgVGhlIGRldGFpbCBvZiB0aGUgdXNlcidzIGN1cnJlbnQgYWN0aXZpdHkuCiAgICB0aW1lc3RhbXBzOiA6Y2xhc3M6YGRpY3RgCiAgICAgICAgQSBkaWN0aW9uYXJ5IG9mIHRpbWVzdGFtcHMuIEl0IGNvbnRhaW5zIHRoZSBmb2xsb3dpbmcgb3B0aW9uYWwga2V5czoKCiAgICAgICAgLSBgYHN0YXJ0YGA6IENvcnJlc3BvbmRzIHRvIHdoZW4gdGhlIHVzZXIgc3RhcnRlZCBkb2luZyB0aGUKICAgICAgICAgIGFjdGl2aXR5IGluIG1pbGxpc2Vjb25kcyBzaW5jZSBVbml4IGVwb2NoLgogICAgICAgIC0gYGBlbmRgYDogQ29ycmVzcG9uZHMgdG8gd2hlbiB0aGUgdXNlciB3aWxsIGZpbmlzaCBkb2luZyB0aGUKICAgICAgICAgIGFjdGl2aXR5IGluIG1pbGxpc2Vjb25kcyBzaW5jZSBVbml4IGVwb2NoLgoKICAgIGFzc2V0czogOmNsYXNzOmBkaWN0YAogICAgICAgIEEgZGljdGlvbmFyeSByZXByZXNlbnRpbmcgdGhlIGltYWdlcyBhbmQgdGhlaXIgaG92ZXIgdGV4dCBvZiBhbiBhY3Rpdml0eS4KICAgICAgICBJdCBjb250YWlucyB0aGUgZm9sbG93aW5nIG9wdGlvbmFsIGtleXM6CgogICAgICAgIC0gYGBsYXJnZV9pbWFnZWBgOiBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIElEIGZvciB0aGUgbGFyZ2UgaW1hZ2UgYXNzZXQuCiAgICAgICAgLSBgYGxhcmdlX3RleHRgYDogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSB0ZXh0IHdoZW4gaG92ZXJpbmcgb3ZlciB0aGUgbGFyZ2UgaW1hZ2UgYXNzZXQuCiAgICAgICAgLSBgYHNtYWxsX2ltYWdlYGA6IEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgSUQgZm9yIHRoZSBzbWFsbCBpbWFnZSBhc3NldC4KICAgICAgICAtIGBgc21hbGxfdGV4dGBgOiBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIHRleHQgd2hlbiBob3ZlcmluZyBvdmVyIHRoZSBzbWFsbCBpbWFnZSBhc3NldC4KCiAgICBwYXJ0eTogOmNsYXNzOmBkaWN0YAogICAgICAgIEEgZGljdGlvbmFyeSByZXByZXNlbnRpbmcgdGhlIGFjdGl2aXR5IHBhcnR5LiBJdCBjb250YWlucyB0aGUgZm9sbG93aW5nIG9wdGlvbmFsIGtleXM6CgogICAgICAgIC0gYGBpZGBgOiBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIHBhcnR5IElELgogICAgICAgIC0gYGBzaXplYGA6IEEgbGlzdCBvZiB1cCB0byB0d28gaW50ZWdlciBlbGVtZW50cyBkZW5vdGluZyAoY3VycmVudF9zaXplLCBtYXhpbXVtX3NpemUpLgogICAgZW1vamk6IE9wdGlvbmFsWzpjbGFzczpgUGFydGlhbEVtb2ppYF0KICAgICAgICBUaGUgZW1vamkgdGhhdCBiZWxvbmdzIHRvIHRoaXMgYWN0aXZpdHkuCiAgICAiIiIKCiAgICBfX3Nsb3RzX18gPSAoJ3N0YXRlJywgJ2RldGFpbHMnLCAnX2NyZWF0ZWRfYXQnLCAndGltZXN0YW1wcycsICdhc3NldHMnLCAncGFydHknLAogICAgICAgICAgICAgICAgICdmbGFncycsICdzeW5jX2lkJywgJ3Nlc3Npb25faWQnLCAndHlwZScsICduYW1lJywgJ3VybCcsCiAgICAgICAgICAgICAgICAgJ2FwcGxpY2F0aW9uX2lkJywgJ2Vtb2ppJykKCiAgICBkZWYgX19pbml0X18oc2VsZiwgKiprd2FyZ3MpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKiprd2FyZ3MpCiAgICAgICAgc2VsZi5zdGF0ZSA9IGt3YXJncy5wb3AoJ3N0YXRlJywgTm9uZSkKICAgICAgICBzZWxmLmRldGFpbHMgPSBrd2FyZ3MucG9wKCdkZXRhaWxzJywgTm9uZSkKICAgICAgICBzZWxmLnRpbWVzdGFtcHMgPSBrd2FyZ3MucG9wKCd0aW1lc3RhbXBzJywge30pCiAgICAgICAgc2VsZi5hc3NldHMgPSBrd2FyZ3MucG9wKCdhc3NldHMnLCB7fSkKICAgICAgICBzZWxmLnBhcnR5ID0ga3dhcmdzLnBvcCgncGFydHknLCB7fSkKICAgICAgICBzZWxmLmFwcGxpY2F0aW9uX2lkID0gX2dldF9hc19zbm93Zmxha2Uoa3dhcmdzLCAnYXBwbGljYXRpb25faWQnKQogICAgICAgIHNlbGYubmFtZSA9IGt3YXJncy5wb3AoJ25hbWUnLCBOb25lKQogICAgICAgIHNlbGYudXJsID0ga3dhcmdzLnBvcCgndXJsJywgTm9uZSkKICAgICAgICBzZWxmLmZsYWdzID0ga3dhcmdzLnBvcCgnZmxhZ3MnLCAwKQogICAgICAgIHNlbGYuc3luY19pZCA9IGt3YXJncy5wb3AoJ3N5bmNfaWQnLCBOb25lKQogICAgICAgIHNlbGYuc2Vzc2lvbl9pZCA9IGt3YXJncy5wb3AoJ3Nlc3Npb25faWQnLCBOb25lKQogICAgICAgIHNlbGYudHlwZSA9IHRyeV9lbnVtKEFjdGl2aXR5VHlwZSwga3dhcmdzLnBvcCgndHlwZScsIC0xKSkKICAgICAgICBlbW9qaSA9IGt3YXJncy5wb3AoJ2Vtb2ppJywgTm9uZSkKICAgICAgICBpZiBlbW9qaSBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5lbW9qaSA9IFBhcnRpYWxFbW9qaS5mcm9tX2RpY3QoZW1vamkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5lbW9qaSA9IE5vbmUKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgYXR0cnMgPSAoCiAgICAgICAgICAgICd0eXBlJywKICAgICAgICAgICAgJ25hbWUnLAogICAgICAgICAgICAndXJsJywKICAgICAgICAgICAgJ2RldGFpbHMnLAogICAgICAgICAgICAnYXBwbGljYXRpb25faWQnLAogICAgICAgICAgICAnc2Vzc2lvbl9pZCcsCiAgICAgICAgICAgICdlbW9qaScsCiAgICAgICAgKQogICAgICAgIG1hcHBlZCA9ICcgJy5qb2luKCclcz0lcicgJSAoYXR0ciwgZ2V0YXR0cihzZWxmLCBhdHRyKSkgZm9yIGF0dHIgaW4gYXR0cnMpCiAgICAgICAgcmV0dXJuICc8QWN0aXZpdHkgJXM+JyAlIG1hcHBlZAoKICAgIGRlZiB0b19kaWN0KHNlbGYpOgogICAgICAgIHJldCA9IHt9CiAgICAgICAgZm9yIGF0dHIgaW4gc2VsZi5fX3Nsb3RzX186CiAgICAgICAgICAgIHZhbHVlID0gZ2V0YXR0cihzZWxmLCBhdHRyLCBOb25lKQogICAgICAgICAgICBpZiB2YWx1ZSBpcyBOb25lOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIGRpY3QpIGFuZCBsZW4odmFsdWUpID09IDA6CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgcmV0W2F0dHJdID0gdmFsdWUKICAgICAgICByZXRbJ3R5cGUnXSA9IGludChzZWxmLnR5cGUpCiAgICAgICAgaWYgc2VsZi5lbW9qaToKICAgICAgICAgICAgcmV0WydlbW9qaSddID0gc2VsZi5lbW9qaS50b19kaWN0KCkKICAgICAgICByZXR1cm4gcmV0CgogICAgQHByb3BlcnR5CiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgIiIiT3B0aW9uYWxbOmNsYXNzOmBkYXRldGltZS5kYXRldGltZWBdOiBXaGVuIHRoZSB1c2VyIHN0YXJ0ZWQgZG9pbmcgdGhpcyBhY3Rpdml0eSBpbiBVVEMsIGlmIGFwcGxpY2FibGUuIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gZGF0ZXRpbWUuZGF0ZXRpbWUudXRjZnJvbXRpbWVzdGFtcChzZWxmLnRpbWVzdGFtcHNbJ3N0YXJ0J10gLyAxMDAwKQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBAcHJvcGVydHkKICAgIGRlZiBlbmQoc2VsZik6CiAgICAgICAgIiIiT3B0aW9uYWxbOmNsYXNzOmBkYXRldGltZS5kYXRldGltZWBdOiBXaGVuIHRoZSB1c2VyIHdpbGwgc3RvcCBkb2luZyB0aGlzIGFjdGl2aXR5IGluIFVUQywgaWYgYXBwbGljYWJsZS4iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiBkYXRldGltZS5kYXRldGltZS51dGNmcm9tdGltZXN0YW1wKHNlbGYudGltZXN0YW1wc1snZW5kJ10gLyAxMDAwKQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBAcHJvcGVydHkKICAgIGRlZiBsYXJnZV9pbWFnZV91cmwoc2VsZik6CiAgICAgICAgIiIiT3B0aW9uYWxbOmNsYXNzOmBzdHJgXTogUmV0dXJucyBhIFVSTCBwb2ludGluZyB0byB0aGUgbGFyZ2UgaW1hZ2UgYXNzZXQgb2YgdGhpcyBhY3Rpdml0eSBpZiBhcHBsaWNhYmxlLiIiIgogICAgICAgIGlmIHNlbGYuYXBwbGljYXRpb25faWQgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsYXJnZV9pbWFnZSA9IHNlbGYuYXNzZXRzWydsYXJnZV9pbWFnZSddCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBBc3NldC5CQVNFICsgJy9hcHAtYXNzZXRzL3swfS97MX0ucG5nJy5mb3JtYXQoc2VsZi5hcHBsaWNhdGlvbl9pZCwgbGFyZ2VfaW1hZ2UpCgogICAgQHByb3BlcnR5CiAgICBkZWYgc21hbGxfaW1hZ2VfdXJsKHNlbGYpOgogICAgICAgICIiIk9wdGlvbmFsWzpjbGFzczpgc3RyYF06IFJldHVybnMgYSBVUkwgcG9pbnRpbmcgdG8gdGhlIHNtYWxsIGltYWdlIGFzc2V0IG9mIHRoaXMgYWN0aXZpdHkgaWYgYXBwbGljYWJsZS4iIiIKICAgICAgICBpZiBzZWxmLmFwcGxpY2F0aW9uX2lkIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIHRyeToKICAgICAgICAgICAgc21hbGxfaW1hZ2UgPSBzZWxmLmFzc2V0c1snc21hbGxfaW1hZ2UnXQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gQXNzZXQuQkFTRSArICcvYXBwLWFzc2V0cy97MH0vezF9LnBuZycuZm9ybWF0KHNlbGYuYXBwbGljYXRpb25faWQsIHNtYWxsX2ltYWdlKQogICAgQHByb3BlcnR5CiAgICBkZWYgbGFyZ2VfaW1hZ2VfdGV4dChzZWxmKToKICAgICAgICAiIiJPcHRpb25hbFs6Y2xhc3M6YHN0cmBdOiBSZXR1cm5zIHRoZSBsYXJnZSBpbWFnZSBhc3NldCBob3ZlciB0ZXh0IG9mIHRoaXMgYWN0aXZpdHkgaWYgYXBwbGljYWJsZS4iIiIKICAgICAgICByZXR1cm4gc2VsZi5hc3NldHMuZ2V0KCdsYXJnZV90ZXh0JywgTm9uZSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBzbWFsbF9pbWFnZV90ZXh0KHNlbGYpOgogICAgICAgICIiIk9wdGlvbmFsWzpjbGFzczpgc3RyYF06IFJldHVybnMgdGhlIHNtYWxsIGltYWdlIGFzc2V0IGhvdmVyIHRleHQgb2YgdGhpcyBhY3Rpdml0eSBpZiBhcHBsaWNhYmxlLiIiIgogICAgICAgIHJldHVybiBzZWxmLmFzc2V0cy5nZXQoJ3NtYWxsX3RleHQnLCBOb25lKQoKCmNsYXNzIEdhbWUoQmFzZUFjdGl2aXR5KToKICAgICIiIkEgc2xpbW1lZCBkb3duIHZlcnNpb24gb2YgOmNsYXNzOmBBY3Rpdml0eWAgdGhhdCByZXByZXNlbnRzIGEgRGlzY29yZCBnYW1lLgoKICAgIFRoaXMgaXMgdHlwaWNhbGx5IGRpc3BsYXllZCB2aWEgKipQbGF5aW5nKiogb24gdGhlIG9mZmljaWFsIERpc2NvcmQgY2xpZW50LgoKICAgIC4uIGNvbnRhaW5lcjo6IG9wZXJhdGlvbnMKCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4ID09IHkKCiAgICAgICAgICAgIENoZWNrcyBpZiB0d28gZ2FtZXMgYXJlIGVxdWFsLgoKICAgICAgICAuLiBkZXNjcmliZTo6IHggIT0geQoKICAgICAgICAgICAgQ2hlY2tzIGlmIHR3byBnYW1lcyBhcmUgbm90IGVxdWFsLgoKICAgICAgICAuLiBkZXNjcmliZTo6IGhhc2goeCkKCiAgICAgICAgICAgIFJldHVybnMgdGhlIGdhbWUncyBoYXNoLgoKICAgICAgICAuLiBkZXNjcmliZTo6IHN0cih4KQoKICAgICAgICAgICAgUmV0dXJucyB0aGUgZ2FtZSdzIG5hbWUuCgogICAgUGFyYW1ldGVycwogICAgLS0tLS0tLS0tLS0KICAgIG5hbWU6IDpjbGFzczpgc3RyYAogICAgICAgIFRoZSBnYW1lJ3MgbmFtZS4KICAgIHN0YXJ0OiBPcHRpb25hbFs6Y2xhc3M6YGRhdGV0aW1lLmRhdGV0aW1lYF0KICAgICAgICBBIG5haXZlIFVUQyB0aW1lc3RhbXAgcmVwcmVzZW50aW5nIHdoZW4gdGhlIGdhbWUgc3RhcnRlZC4gS2V5d29yZC1vbmx5IHBhcmFtZXRlci4gSWdub3JlZCBmb3IgYm90cy4KICAgIGVuZDogT3B0aW9uYWxbOmNsYXNzOmBkYXRldGltZS5kYXRldGltZWBdCiAgICAgICAgQSBuYWl2ZSBVVEMgdGltZXN0YW1wIHJlcHJlc2VudGluZyB3aGVuIHRoZSBnYW1lIGVuZHMuIEtleXdvcmQtb25seSBwYXJhbWV0ZXIuIElnbm9yZWQgZm9yIGJvdHMuCgogICAgQXR0cmlidXRlcwogICAgLS0tLS0tLS0tLS0KICAgIG5hbWU6IDpjbGFzczpgc3RyYAogICAgICAgIFRoZSBnYW1lJ3MgbmFtZS4KICAgICIiIgoKICAgIF9fc2xvdHNfXyA9ICgnbmFtZScsICdfZW5kJywgJ19zdGFydCcpCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5hbWUsICoqZXh0cmEpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKipleHRyYSkKICAgICAgICBzZWxmLm5hbWUgPSBuYW1lCgogICAgICAgIHRyeToKICAgICAgICAgICAgdGltZXN0YW1wcyA9IGV4dHJhWyd0aW1lc3RhbXBzJ10KICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHNlbGYuX2V4dHJhY3RfdGltZXN0YW1wKGV4dHJhLCAnc3RhcnQnKQogICAgICAgICAgICBzZWxmLl9leHRyYWN0X3RpbWVzdGFtcChleHRyYSwgJ2VuZCcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5fc3RhcnQgPSB0aW1lc3RhbXBzLmdldCgnc3RhcnQnLCAwKQogICAgICAgICAgICBzZWxmLl9lbmQgPSB0aW1lc3RhbXBzLmdldCgnZW5kJywgMCkKCiAgICBkZWYgX2V4dHJhY3RfdGltZXN0YW1wKHNlbGYsIGRhdGEsIGtleSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBkdCA9IGRhdGFba2V5XQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgc2V0YXR0cihzZWxmLCAnXycgKyBrZXksIDApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2V0YXR0cihzZWxmLCAnXycgKyBrZXksIGR0LnRpbWVzdGFtcCgpICogMTAwMC4wKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHR5cGUoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBBY3Rpdml0eVR5cGVgOiBSZXR1cm5zIHRoZSBnYW1lJ3MgdHlwZS4gVGhpcyBpcyBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIDpjbGFzczpgQWN0aXZpdHlgLgoKICAgICAgICBJdCBhbHdheXMgcmV0dXJucyA6YXR0cjpgQWN0aXZpdHlUeXBlLnBsYXlpbmdgLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBBY3Rpdml0eVR5cGUucGxheWluZwoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHN0YXJ0KHNlbGYpOgogICAgICAgICIiIk9wdGlvbmFsWzpjbGFzczpgZGF0ZXRpbWUuZGF0ZXRpbWVgXTogV2hlbiB0aGUgdXNlciBzdGFydGVkIHBsYXlpbmcgdGhpcyBnYW1lIGluIFVUQywgaWYgYXBwbGljYWJsZS4iIiIKICAgICAgICBpZiBzZWxmLl9zdGFydDoKICAgICAgICAgICAgcmV0dXJuIGRhdGV0aW1lLmRhdGV0aW1lLnV0Y2Zyb210aW1lc3RhbXAoc2VsZi5fc3RhcnQgLyAxMDAwKQogICAgICAgIHJldHVybiBOb25lCgogICAgQHByb3BlcnR5CiAgICBkZWYgZW5kKHNlbGYpOgogICAgICAgICIiIk9wdGlvbmFsWzpjbGFzczpgZGF0ZXRpbWUuZGF0ZXRpbWVgXTogV2hlbiB0aGUgdXNlciB3aWxsIHN0b3AgcGxheWluZyB0aGlzIGdhbWUgaW4gVVRDLCBpZiBhcHBsaWNhYmxlLiIiIgogICAgICAgIGlmIHNlbGYuX2VuZDoKICAgICAgICAgICAgcmV0dXJuIGRhdGV0aW1lLmRhdGV0aW1lLnV0Y2Zyb210aW1lc3RhbXAoc2VsZi5fZW5kIC8gMTAwMCkKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgIHJldHVybiBzdHIoc2VsZi5uYW1lKQoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gJzxHYW1lIG5hbWU9ezAubmFtZSFyfT4nLmZvcm1hdChzZWxmKQoKICAgIGRlZiB0b19kaWN0KHNlbGYpOgogICAgICAgIHRpbWVzdGFtcHMgPSB7fQogICAgICAgIGlmIHNlbGYuX3N0YXJ0OgogICAgICAgICAgICB0aW1lc3RhbXBzWydzdGFydCddID0gc2VsZi5fc3RhcnQKCiAgICAgICAgaWYgc2VsZi5fZW5kOgogICAgICAgICAgICB0aW1lc3RhbXBzWydlbmQnXSA9IHNlbGYuX2VuZAoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAndHlwZSc6IEFjdGl2aXR5VHlwZS5wbGF5aW5nLnZhbHVlLAogICAgICAgICAgICAnbmFtZSc6IHN0cihzZWxmLm5hbWUpLAogICAgICAgICAgICAndGltZXN0YW1wcyc6IHRpbWVzdGFtcHMKICAgICAgICB9CgogICAgZGVmIF9fZXFfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgcmV0dXJuIGlzaW5zdGFuY2Uob3RoZXIsIEdhbWUpIGFuZCBvdGhlci5uYW1lID09IHNlbGYubmFtZQoKICAgIGRlZiBfX25lX18oc2VsZiwgb3RoZXIpOgogICAgICAgIHJldHVybiBub3Qgc2VsZi5fX2VxX18ob3RoZXIpCgogICAgZGVmIF9faGFzaF9fKHNlbGYpOgogICAgICAgIHJldHVybiBoYXNoKHNlbGYubmFtZSkKCmNsYXNzIFN0cmVhbWluZyhCYXNlQWN0aXZpdHkpOgogICAgIiIiQSBzbGltbWVkIGRvd24gdmVyc2lvbiBvZiA6Y2xhc3M6YEFjdGl2aXR5YCB0aGF0IHJlcHJlc2VudHMgYSBEaXNjb3JkIHN0cmVhbWluZyBzdGF0dXMuCgogICAgVGhpcyBpcyB0eXBpY2FsbHkgZGlzcGxheWVkIHZpYSAqKlN0cmVhbWluZyoqIG9uIHRoZSBvZmZpY2lhbCBEaXNjb3JkIGNsaWVudC4KCiAgICAuLiBjb250YWluZXI6OiBvcGVyYXRpb25zCgogICAgICAgIC4uIGRlc2NyaWJlOjogeCA9PSB5CgogICAgICAgICAgICBDaGVja3MgaWYgdHdvIHN0cmVhbXMgYXJlIGVxdWFsLgoKICAgICAgICAuLiBkZXNjcmliZTo6IHggIT0geQoKICAgICAgICAgICAgQ2hlY2tzIGlmIHR3byBzdHJlYW1zIGFyZSBub3QgZXF1YWwuCgogICAgICAgIC4uIGRlc2NyaWJlOjogaGFzaCh4KQoKICAgICAgICAgICAgUmV0dXJucyB0aGUgc3RyZWFtJ3MgaGFzaC4KCiAgICAgICAgLi4gZGVzY3JpYmU6OiBzdHIoeCkKCiAgICAgICAgICAgIFJldHVybnMgdGhlIHN0cmVhbSdzIG5hbWUuCgogICAgQXR0cmlidXRlcwogICAgLS0tLS0tLS0tLS0KICAgIHBsYXRmb3JtOiA6Y2xhc3M6YHN0cmAKICAgICAgICBXaGVyZSB0aGUgdXNlciBpcyBzdHJlYW1pbmcgZnJvbSAoaWUuIFlvdVR1YmUsIFR3aXRjaCkuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuMwoKICAgIG5hbWU6IE9wdGlvbmFsWzpjbGFzczpgc3RyYF0KICAgICAgICBUaGUgc3RyZWFtJ3MgbmFtZS4KICAgIGRldGFpbHM6IE9wdGlvbmFsWzpjbGFzczpgc3RyYF0KICAgICAgICBBbiBhbGlhcyBmb3IgOmF0dHI6YG5hbWVgCiAgICBnYW1lOiBPcHRpb25hbFs6Y2xhc3M6YHN0cmBdCiAgICAgICAgVGhlIGdhbWUgYmVpbmcgc3RyZWFtZWQuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuMwoKICAgIHVybDogOmNsYXNzOmBzdHJgCiAgICAgICAgVGhlIHN0cmVhbSdzIFVSTC4KICAgIGFzc2V0czogOmNsYXNzOmBkaWN0YAogICAgICAgIEEgZGljdGlvbmFyeSBjb21wcmlzaW5nIG9mIHNpbWlsYXIga2V5cyB0aGFuIHRob3NlIGluIDphdHRyOmBBY3Rpdml0eS5hc3NldHNgLgogICAgIiIiCgogICAgX19zbG90c19fID0gKCdwbGF0Zm9ybScsICduYW1lJywgJ2dhbWUnLCAndXJsJywgJ2RldGFpbHMnLCAnYXNzZXRzJykKCiAgICBkZWYgX19pbml0X18oc2VsZiwgKiwgbmFtZSwgdXJsLCAqKmV4dHJhKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCoqZXh0cmEpCiAgICAgICAgc2VsZi5wbGF0Zm9ybSA9IG5hbWUKICAgICAgICBzZWxmLm5hbWUgPSBleHRyYS5wb3AoJ2RldGFpbHMnLCBuYW1lKQogICAgICAgIHNlbGYuZ2FtZSA9IGV4dHJhLnBvcCgnc3RhdGUnLCBOb25lKQogICAgICAgIHNlbGYudXJsID0gdXJsCiAgICAgICAgc2VsZi5kZXRhaWxzID0gZXh0cmEucG9wKCdkZXRhaWxzJywgc2VsZi5uYW1lKSAjIGNvbXBhdGliaWxpdHkKICAgICAgICBzZWxmLmFzc2V0cyA9IGV4dHJhLnBvcCgnYXNzZXRzJywge30pCgogICAgQHByb3BlcnR5CiAgICBkZWYgdHlwZShzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YEFjdGl2aXR5VHlwZWA6IFJldHVybnMgdGhlIGdhbWUncyB0eXBlLiBUaGlzIGlzIGZvciBjb21wYXRpYmlsaXR5IHdpdGggOmNsYXNzOmBBY3Rpdml0eWAuCgogICAgICAgIEl0IGFsd2F5cyByZXR1cm5zIDphdHRyOmBBY3Rpdml0eVR5cGUuc3RyZWFtaW5nYC4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gQWN0aXZpdHlUeXBlLnN0cmVhbWluZwoKICAgIGRlZiBfX3N0cl9fKHNlbGYpOgogICAgICAgIHJldHVybiBzdHIoc2VsZi5uYW1lKQoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gJzxTdHJlYW1pbmcgbmFtZT17MC5uYW1lIXJ9PicuZm9ybWF0KHNlbGYpCgogICAgQHByb3BlcnR5CiAgICBkZWYgdHdpdGNoX25hbWUoc2VsZik6CiAgICAgICAgIiIiT3B0aW9uYWxbOmNsYXNzOmBzdHJgXTogSWYgcHJvdmlkZWQsIHRoZSB0d2l0Y2ggbmFtZSBvZiB0aGUgdXNlciBzdHJlYW1pbmcuCgogICAgICAgIFRoaXMgY29ycmVzcG9uZHMgdG8gdGhlIGBgbGFyZ2VfaW1hZ2VgYCBrZXkgb2YgdGhlIDphdHRyOmBTdHJlYW1pbmcuYXNzZXRzYAogICAgICAgIGRpY3Rpb25hcnkgaWYgaXQgc3RhcnRzIHdpdGggYGB0d2l0Y2g6YGAuIFR5cGljYWxseSBzZXQgYnkgdGhlIERpc2NvcmQgY2xpZW50LgogICAgICAgICIiIgoKICAgICAgICB0cnk6CiAgICAgICAgICAgIG5hbWUgPSBzZWxmLmFzc2V0c1snbGFyZ2VfaW1hZ2UnXQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gbmFtZVs3Ol0gaWYgbmFtZVs6N10gPT0gJ3R3aXRjaDonIGVsc2UgTm9uZQoKICAgIGRlZiB0b19kaWN0KHNlbGYpOgogICAgICAgIHJldCA9IHsKICAgICAgICAgICAgJ3R5cGUnOiBBY3Rpdml0eVR5cGUuc3RyZWFtaW5nLnZhbHVlLAogICAgICAgICAgICAnbmFtZSc6IHN0cihzZWxmLm5hbWUpLAogICAgICAgICAgICAndXJsJzogc3RyKHNlbGYudXJsKSwKICAgICAgICAgICAgJ2Fzc2V0cyc6IHNlbGYuYXNzZXRzCiAgICAgICAgfQogICAgICAgIGlmIHNlbGYuZGV0YWlsczoKICAgICAgICAgICAgcmV0WydkZXRhaWxzJ10gPSBzZWxmLmRldGFpbHMKICAgICAgICByZXR1cm4gcmV0CgogICAgZGVmIF9fZXFfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgcmV0dXJuIGlzaW5zdGFuY2Uob3RoZXIsIFN0cmVhbWluZykgYW5kIG90aGVyLm5hbWUgPT0gc2VsZi5uYW1lIGFuZCBvdGhlci51cmwgPT0gc2VsZi51cmwKCiAgICBkZWYgX19uZV9fKHNlbGYsIG90aGVyKToKICAgICAgICByZXR1cm4gbm90IHNlbGYuX19lcV9fKG90aGVyKQoKICAgIGRlZiBfX2hhc2hfXyhzZWxmKToKICAgICAgICByZXR1cm4gaGFzaChzZWxmLm5hbWUpCgpjbGFzcyBTcG90aWZ5OgogICAgIiIiUmVwcmVzZW50cyBhIFNwb3RpZnkgbGlzdGVuaW5nIGFjdGl2aXR5IGZyb20gRGlzY29yZC4gVGhpcyBpcyBhIHNwZWNpYWwgY2FzZSBvZgogICAgOmNsYXNzOmBBY3Rpdml0eWAgdGhhdCBtYWtlcyBpdCBlYXNpZXIgdG8gd29yayB3aXRoIHRoZSBTcG90aWZ5IGludGVncmF0aW9uLgoKICAgIC4uIGNvbnRhaW5lcjo6IG9wZXJhdGlvbnMKCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4ID09IHkKCiAgICAgICAgICAgIENoZWNrcyBpZiB0d28gYWN0aXZpdGllcyBhcmUgZXF1YWwuCgogICAgICAgIC4uIGRlc2NyaWJlOjogeCAhPSB5CgogICAgICAgICAgICBDaGVja3MgaWYgdHdvIGFjdGl2aXRpZXMgYXJlIG5vdCBlcXVhbC4KCiAgICAgICAgLi4gZGVzY3JpYmU6OiBoYXNoKHgpCgogICAgICAgICAgICBSZXR1cm5zIHRoZSBhY3Rpdml0eSdzIGhhc2guCgogICAgICAgIC4uIGRlc2NyaWJlOjogc3RyKHgpCgogICAgICAgICAgICBSZXR1cm5zIHRoZSBzdHJpbmcgJ1Nwb3RpZnknLgogICAgIiIiCgogICAgX19zbG90c19fID0gKCdfc3RhdGUnLCAnX2RldGFpbHMnLCAnX3RpbWVzdGFtcHMnLCAnX2Fzc2V0cycsICdfcGFydHknLCAnX3N5bmNfaWQnLCAnX3Nlc3Npb25faWQnLAogICAgICAgICAgICAgICAgICdfY3JlYXRlZF9hdCcpCgogICAgZGVmIF9faW5pdF9fKHNlbGYsICoqZGF0YSk6CiAgICAgICAgc2VsZi5fc3RhdGUgPSBkYXRhLnBvcCgnc3RhdGUnLCBOb25lKQogICAgICAgIHNlbGYuX2RldGFpbHMgPSBkYXRhLnBvcCgnZGV0YWlscycsIE5vbmUpCiAgICAgICAgc2VsZi5fdGltZXN0YW1wcyA9IGRhdGEucG9wKCd0aW1lc3RhbXBzJywge30pCiAgICAgICAgc2VsZi5fYXNzZXRzID0gZGF0YS5wb3AoJ2Fzc2V0cycsIHt9KQogICAgICAgIHNlbGYuX3BhcnR5ID0gZGF0YS5wb3AoJ3BhcnR5Jywge30pCiAgICAgICAgc2VsZi5fc3luY19pZCA9IGRhdGEucG9wKCdzeW5jX2lkJykKICAgICAgICBzZWxmLl9zZXNzaW9uX2lkID0gZGF0YS5wb3AoJ3Nlc3Npb25faWQnKQogICAgICAgIHNlbGYuX2NyZWF0ZWRfYXQgPSBkYXRhLnBvcCgnY3JlYXRlZF9hdCcsIE5vbmUpCgogICAgQHByb3BlcnR5CiAgICBkZWYgdHlwZShzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YEFjdGl2aXR5VHlwZWA6IFJldHVybnMgdGhlIGFjdGl2aXR5J3MgdHlwZS4gVGhpcyBpcyBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIDpjbGFzczpgQWN0aXZpdHlgLgoKICAgICAgICBJdCBhbHdheXMgcmV0dXJucyA6YXR0cjpgQWN0aXZpdHlUeXBlLmxpc3RlbmluZ2AuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIEFjdGl2aXR5VHlwZS5saXN0ZW5pbmcKCiAgICBAcHJvcGVydHkKICAgIGRlZiBjcmVhdGVkX2F0KHNlbGYpOgogICAgICAgICIiIk9wdGlvbmFsWzpjbGFzczpgZGF0ZXRpbWUuZGF0ZXRpbWVgXTogV2hlbiB0aGUgdXNlciBzdGFydGVkIGxpc3RlbmluZyBpbiBVVEMuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuMwogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuX2NyZWF0ZWRfYXQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldHVybiBkYXRldGltZS5kYXRldGltZS51dGNmcm9tdGltZXN0YW1wKHNlbGYuX2NyZWF0ZWRfYXQgLyAxMDAwKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNvbG91cihzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YENvbG91cmA6IFJldHVybnMgdGhlIFNwb3RpZnkgaW50ZWdyYXRpb24gY29sb3VyLCBhcyBhIDpjbGFzczpgQ29sb3VyYC4KCiAgICAgICAgVGhlcmUgaXMgYW4gYWxpYXMgZm9yIHRoaXMgbmFtZWQgOmF0dHI6YGNvbG9yYCIiIgogICAgICAgIHJldHVybiBDb2xvdXIoMHgxZGI5NTQpCgogICAgQHByb3BlcnR5CiAgICBkZWYgY29sb3Ioc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBDb2xvdXJgOiBSZXR1cm5zIHRoZSBTcG90aWZ5IGludGVncmF0aW9uIGNvbG91ciwgYXMgYSA6Y2xhc3M6YENvbG91cmAuCgogICAgICAgIFRoZXJlIGlzIGFuIGFsaWFzIGZvciB0aGlzIG5hbWVkIDphdHRyOmBjb2xvdXJgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuY29sb3VyCgogICAgZGVmIHRvX2RpY3Qoc2VsZik6CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ2ZsYWdzJzogNDgsICMgU1lOQyB8IFBMQVkKICAgICAgICAgICAgJ25hbWUnOiAnU3BvdGlmeScsCiAgICAgICAgICAgICdhc3NldHMnOiBzZWxmLl9hc3NldHMsCiAgICAgICAgICAgICdwYXJ0eSc6IHNlbGYuX3BhcnR5LAogICAgICAgICAgICAnc3luY19pZCc6IHNlbGYuX3N5bmNfaWQsCiAgICAgICAgICAgICdzZXNzaW9uX2lkJzogc2VsZi5fc2Vzc2lvbl9pZCwKICAgICAgICAgICAgJ3RpbWVzdGFtcHMnOiBzZWxmLl90aW1lc3RhbXBzLAogICAgICAgICAgICAnZGV0YWlscyc6IHNlbGYuX2RldGFpbHMsCiAgICAgICAgICAgICdzdGF0ZSc6IHNlbGYuX3N0YXRlCiAgICAgICAgfQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIG5hbWUoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBzdHJgOiBUaGUgYWN0aXZpdHkncyBuYW1lLiBUaGlzIHdpbGwgYWx3YXlzIHJldHVybiAiU3BvdGlmeSIuIiIiCiAgICAgICAgcmV0dXJuICdTcG90aWZ5JwoKICAgIGRlZiBfX2VxX18oc2VsZiwgb3RoZXIpOgogICAgICAgIHJldHVybiAoaXNpbnN0YW5jZShvdGhlciwgU3BvdGlmeSkgYW5kIG90aGVyLl9zZXNzaW9uX2lkID09IHNlbGYuX3Nlc3Npb25faWQKICAgICAgICAgICAgICAgIGFuZCBvdGhlci5fc3luY19pZCA9PSBzZWxmLl9zeW5jX2lkIGFuZCBvdGhlci5zdGFydCA9PSBzZWxmLnN0YXJ0KQoKICAgIGRlZiBfX25lX18oc2VsZiwgb3RoZXIpOgogICAgICAgIHJldHVybiBub3Qgc2VsZi5fX2VxX18ob3RoZXIpCgogICAgZGVmIF9faGFzaF9fKHNlbGYpOgogICAgICAgIHJldHVybiBoYXNoKHNlbGYuX3Nlc3Npb25faWQpCgogICAgZGVmIF9fc3RyX18oc2VsZik6CiAgICAgICAgcmV0dXJuICdTcG90aWZ5JwoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gJzxTcG90aWZ5IHRpdGxlPXswLnRpdGxlIXJ9IGFydGlzdD17MC5hcnRpc3Qhcn0gdHJhY2tfaWQ9ezAudHJhY2tfaWQhcn0+Jy5mb3JtYXQoc2VsZikKCiAgICBAcHJvcGVydHkKICAgIGRlZiB0aXRsZShzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YHN0cmA6IFRoZSB0aXRsZSBvZiB0aGUgc29uZyBiZWluZyBwbGF5ZWQuIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX2RldGFpbHMKCiAgICBAcHJvcGVydHkKICAgIGRlZiBhcnRpc3RzKHNlbGYpOgogICAgICAgICIiIkxpc3RbOmNsYXNzOmBzdHJgXTogVGhlIGFydGlzdHMgb2YgdGhlIHNvbmcgYmVpbmcgcGxheWVkLiIiIgogICAgICAgIHJldHVybiBzZWxmLl9zdGF0ZS5zcGxpdCgnOyAnKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGFydGlzdChzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YHN0cmA6IFRoZSBhcnRpc3Qgb2YgdGhlIHNvbmcgYmVpbmcgcGxheWVkLgoKICAgICAgICBUaGlzIGRvZXMgbm90IGF0dGVtcHQgdG8gc3BsaXQgdGhlIGFydGlzdCBpbmZvcm1hdGlvbiBpbnRvCiAgICAgICAgbXVsdGlwbGUgYXJ0aXN0cy4gVXNlZnVsIGlmIHRoZXJlJ3Mgb25seSBhIHNpbmdsZSBhcnRpc3QuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX3N0YXRlCgogICAgQHByb3BlcnR5CiAgICBkZWYgYWxidW0oc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBzdHJgOiBUaGUgYWxidW0gdGhhdCB0aGUgc29uZyBiZWluZyBwbGF5ZWQgYmVsb25ncyB0by4iIiIKICAgICAgICByZXR1cm4gc2VsZi5fYXNzZXRzLmdldCgnbGFyZ2VfdGV4dCcsICcnKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGFsYnVtX2NvdmVyX3VybChzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YHN0cmA6IFRoZSBhbGJ1bSBjb3ZlciBpbWFnZSBVUkwgZnJvbSBTcG90aWZ5J3MgQ0ROLiIiIgogICAgICAgIGxhcmdlX2ltYWdlID0gc2VsZi5fYXNzZXRzLmdldCgnbGFyZ2VfaW1hZ2UnLCAnJykKICAgICAgICBpZiBsYXJnZV9pbWFnZVs6OF0gIT0gJ3Nwb3RpZnk6JzoKICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgYWxidW1faW1hZ2VfaWQgPSBsYXJnZV9pbWFnZVs4Ol0KICAgICAgICByZXR1cm4gJ2h0dHBzOi8vaS5zY2RuLmNvL2ltYWdlLycgKyBhbGJ1bV9pbWFnZV9pZAoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHRyYWNrX2lkKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgc3RyYDogVGhlIHRyYWNrIElEIHVzZWQgYnkgU3BvdGlmeSB0byBpZGVudGlmeSB0aGlzIHNvbmcuIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX3N5bmNfaWQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBzdGFydChzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGRhdGV0aW1lLmRhdGV0aW1lYDogV2hlbiB0aGUgdXNlciBzdGFydGVkIHBsYXlpbmcgdGhpcyBzb25nIGluIFVUQy4iIiIKICAgICAgICByZXR1cm4gZGF0ZXRpbWUuZGF0ZXRpbWUudXRjZnJvbXRpbWVzdGFtcChzZWxmLl90aW1lc3RhbXBzWydzdGFydCddIC8gMTAwMCkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBlbmQoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBkYXRldGltZS5kYXRldGltZWA6IFdoZW4gdGhlIHVzZXIgd2lsbCBzdG9wIHBsYXlpbmcgdGhpcyBzb25nIGluIFVUQy4iIiIKICAgICAgICByZXR1cm4gZGF0ZXRpbWUuZGF0ZXRpbWUudXRjZnJvbXRpbWVzdGFtcChzZWxmLl90aW1lc3RhbXBzWydlbmQnXSAvIDEwMDApCgogICAgQHByb3BlcnR5CiAgICBkZWYgZHVyYXRpb24oc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBkYXRldGltZS50aW1lZGVsdGFgOiBUaGUgZHVyYXRpb24gb2YgdGhlIHNvbmcgYmVpbmcgcGxheWVkLiIiIgogICAgICAgIHJldHVybiBzZWxmLmVuZCAtIHNlbGYuc3RhcnQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBwYXJ0eV9pZChzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YHN0cmA6IFRoZSBwYXJ0eSBJRCBvZiB0aGUgbGlzdGVuaW5nIHBhcnR5LiIiIgogICAgICAgIHJldHVybiBzZWxmLl9wYXJ0eS5nZXQoJ2lkJywgJycpCgpjbGFzcyBDdXN0b21BY3Rpdml0eShCYXNlQWN0aXZpdHkpOgogICAgIiIiUmVwcmVzZW50cyBhIEN1c3RvbSBhY3Rpdml0eSBmcm9tIERpc2NvcmQuCgogICAgLi4gY29udGFpbmVyOjogb3BlcmF0aW9ucwoKICAgICAgICAuLiBkZXNjcmliZTo6IHggPT0geQoKICAgICAgICAgICAgQ2hlY2tzIGlmIHR3byBhY3Rpdml0aWVzIGFyZSBlcXVhbC4KCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4ICE9IHkKCiAgICAgICAgICAgIENoZWNrcyBpZiB0d28gYWN0aXZpdGllcyBhcmUgbm90IGVxdWFsLgoKICAgICAgICAuLiBkZXNjcmliZTo6IGhhc2goeCkKCiAgICAgICAgICAgIFJldHVybnMgdGhlIGFjdGl2aXR5J3MgaGFzaC4KCiAgICAgICAgLi4gZGVzY3JpYmU6OiBzdHIoeCkKCiAgICAgICAgICAgIFJldHVybnMgdGhlIGN1c3RvbSBzdGF0dXMgdGV4dC4KCiAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjMKCiAgICBBdHRyaWJ1dGVzCiAgICAtLS0tLS0tLS0tLQogICAgbmFtZTogT3B0aW9uYWxbOmNsYXNzOmBzdHJgXQogICAgICAgIFRoZSBjdXN0b20gYWN0aXZpdHkncyBuYW1lLgogICAgZW1vamk6IE9wdGlvbmFsWzpjbGFzczpgUGFydGlhbEVtb2ppYF0KICAgICAgICBUaGUgZW1vamkgdG8gcGFzcyB0byB0aGUgYWN0aXZpdHksIGlmIGFueS4KICAgICIiIgoKICAgIF9fc2xvdHNfXyA9ICgnbmFtZScsICdlbW9qaScsICdzdGF0ZScpCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5hbWUsICosIGVtb2ppPU5vbmUsICoqZXh0cmEpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKipleHRyYSkKICAgICAgICBzZWxmLm5hbWUgPSBuYW1lCiAgICAgICAgc2VsZi5zdGF0ZSA9IGV4dHJhLnBvcCgnc3RhdGUnLCBOb25lKQogICAgICAgIGlmIHNlbGYubmFtZSA9PSAnQ3VzdG9tIFN0YXR1cyc6CiAgICAgICAgICAgIHNlbGYubmFtZSA9IHNlbGYuc3RhdGUKCiAgICAgICAgaWYgZW1vamkgaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5lbW9qaSA9IGVtb2ppCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGVtb2ppLCBkaWN0KToKICAgICAgICAgICAgc2VsZi5lbW9qaSA9IFBhcnRpYWxFbW9qaS5mcm9tX2RpY3QoZW1vamkpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGVtb2ppLCBzdHIpOgogICAgICAgICAgICBzZWxmLmVtb2ppID0gUGFydGlhbEVtb2ppKG5hbWU9ZW1vamkpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGVtb2ppLCBQYXJ0aWFsRW1vamkpOgogICAgICAgICAgICBzZWxmLmVtb2ppID0gZW1vamkKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ0V4cGVjdGVkIHN0ciwgUGFydGlhbEVtb2ppLCBvciBOb25lLCByZWNlaXZlZCB7MCFyfSBpbnN0ZWFkLicuZm9ybWF0KHR5cGUoZW1vamkpKSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiB0eXBlKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgQWN0aXZpdHlUeXBlYDogUmV0dXJucyB0aGUgYWN0aXZpdHkncyB0eXBlLiBUaGlzIGlzIGZvciBjb21wYXRpYmlsaXR5IHdpdGggOmNsYXNzOmBBY3Rpdml0eWAuCgogICAgICAgIEl0IGFsd2F5cyByZXR1cm5zIDphdHRyOmBBY3Rpdml0eVR5cGUuY3VzdG9tYC4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gQWN0aXZpdHlUeXBlLmN1c3RvbQoKICAgIGRlZiB0b19kaWN0KHNlbGYpOgogICAgICAgIGlmIHNlbGYubmFtZSA9PSBzZWxmLnN0YXRlOgogICAgICAgICAgICBvID0gewogICAgICAgICAgICAgICAgJ3R5cGUnOiBBY3Rpdml0eVR5cGUuY3VzdG9tLnZhbHVlLAogICAgICAgICAgICAgICAgJ3N0YXRlJzogc2VsZi5uYW1lLAogICAgICAgICAgICAgICAgJ25hbWUnOiAnQ3VzdG9tIFN0YXR1cycsCiAgICAgICAgICAgIH0KICAgICAgICBlbHNlOgogICAgICAgICAgICBvID0gewogICAgICAgICAgICAgICAgJ3R5cGUnOiBBY3Rpdml0eVR5cGUuY3VzdG9tLnZhbHVlLAogICAgICAgICAgICAgICAgJ25hbWUnOiBzZWxmLm5hbWUsCiAgICAgICAgICAgIH0KCiAgICAgICAgaWYgc2VsZi5lbW9qaToKICAgICAgICAgICAgb1snZW1vamknXSA9IHNlbGYuZW1vamkudG9fZGljdCgpCiAgICAgICAgcmV0dXJuIG8KCiAgICBkZWYgX19lcV9fKHNlbGYsIG90aGVyKToKICAgICAgICByZXR1cm4gKGlzaW5zdGFuY2Uob3RoZXIsIEN1c3RvbUFjdGl2aXR5KSBhbmQgb3RoZXIubmFtZSA9PSBzZWxmLm5hbWUgYW5kIG90aGVyLmVtb2ppID09IHNlbGYuZW1vamkpCgogICAgZGVmIF9fbmVfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgcmV0dXJuIG5vdCBzZWxmLl9fZXFfXyhvdGhlcikKCiAgICBkZWYgX19oYXNoX18oc2VsZik6CiAgICAgICAgcmV0dXJuIGhhc2goKHNlbGYubmFtZSwgc3RyKHNlbGYuZW1vamkpKSkKCiAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICBpZiBzZWxmLmVtb2ppOgogICAgICAgICAgICBpZiBzZWxmLm5hbWU6CiAgICAgICAgICAgICAgICByZXR1cm4gJyVzICVzJyAlIChzZWxmLmVtb2ppLCBzZWxmLm5hbWUpCiAgICAgICAgICAgIHJldHVybiBzdHIoc2VsZi5lbW9qaSkKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc3RyKHNlbGYubmFtZSkKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgcmV0dXJuICc8Q3VzdG9tQWN0aXZpdHkgbmFtZT17MC5uYW1lIXJ9IGVtb2ppPXswLmVtb2ppIXJ9PicuZm9ybWF0KHNlbGYpCgoKZGVmIGNyZWF0ZV9hY3Rpdml0eShkYXRhKToKICAgIGlmIG5vdCBkYXRhOgogICAgICAgIHJldHVybiBOb25lCgogICAgZ2FtZV90eXBlID0gdHJ5X2VudW0oQWN0aXZpdHlUeXBlLCBkYXRhLmdldCgndHlwZScsIC0xKSkKICAgIGlmIGdhbWVfdHlwZSBpcyBBY3Rpdml0eVR5cGUucGxheWluZzoKICAgICAgICBpZiAnYXBwbGljYXRpb25faWQnIGluIGRhdGEgb3IgJ3Nlc3Npb25faWQnIGluIGRhdGE6CiAgICAgICAgICAgIHJldHVybiBBY3Rpdml0eSgqKmRhdGEpCiAgICAgICAgcmV0dXJuIEdhbWUoKipkYXRhKQogICAgZWxpZiBnYW1lX3R5cGUgaXMgQWN0aXZpdHlUeXBlLmN1c3RvbToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG5hbWUgPSBkYXRhLnBvcCgnbmFtZScpCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICByZXR1cm4gQWN0aXZpdHkoKipkYXRhKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBDdXN0b21BY3Rpdml0eShuYW1lPW5hbWUsICoqZGF0YSkKICAgIGVsaWYgZ2FtZV90eXBlIGlzIEFjdGl2aXR5VHlwZS5zdHJlYW1pbmc6CiAgICAgICAgaWYgJ3VybCcgaW4gZGF0YToKICAgICAgICAgICAgcmV0dXJuIFN0cmVhbWluZygqKmRhdGEpCiAgICAgICAgcmV0dXJuIEFjdGl2aXR5KCoqZGF0YSkKICAgIGVsaWYgZ2FtZV90eXBlIGlzIEFjdGl2aXR5VHlwZS5saXN0ZW5pbmcgYW5kICdzeW5jX2lkJyBpbiBkYXRhIGFuZCAnc2Vzc2lvbl9pZCcgaW4gZGF0YToKICAgICAgICByZXR1cm4gU3BvdGlmeSgqKmRhdGEpCiAgICByZXR1cm4gQWN0aXZpdHkoKipkYXRhKQo=
