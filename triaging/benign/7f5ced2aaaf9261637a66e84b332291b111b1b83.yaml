statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/table.py
  contents:
  - name: <module>
    score: 0.0
    code: |-
      # Copyright 2012-2013 Amazon.com, Inc. or its affiliates. All Rights Reserved.

      # Licensed under the Apache License, Version 2.0 (the "License"). You
      # may not use this file except in compliance with the License. A copy of
      # the License is located at

      #     http://aws.amazon.com/apache2.0/

      # or in the "license" file accompanying this file. This file is
      # distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
      # ANY KIND, either express or implied. See the License for the specific
      # language governing permissions and limitations under the License.
      import sys
      import struct
      import unicodedata

      import colorama

      from awscli.utils import is_a_tty
      from awscli.compat import six


      # `autoreset` allows us to not have to sent reset sequences for every
      # string. `strip` lets us preserve color when redirecting.
      COLORAMA_KWARGS = {
          'autoreset': True,
          'strip': False,
      }


      def get_text_length(text):
          # `len(unichar)` measures the number of characters, so we use
          # `unicodedata.east_asian_width` to measure the length of characters.
          # Following responses are considered to be full-width length.
          # * A(Ambiguous)
          # * F(Fullwidth)
          # * W(Wide)
          text = six.text_type(text)
          return sum(2 if unicodedata.east_asian_width(char) in 'WFA' else 1
                     for char in text)
    tokens: resume load_const INTEGER load_const import_name sys store_name sys load_const INTEGER load_const import_name struct store_name struct load_const INTEGER load_const import_name unicodedata store_name unicodedata load_const INTEGER load_const import_name colorama store_name colorama load_const INTEGER load_const import_name awscli.utils import_from is_a_tty store_name is_a_tty pop_top load_const INTEGER load_const import_name awscli.compat import_from six store_name six pop_top load_const INTEGER load_const INTEGER load_const build_const_key_map store_name COLORAMA_KWARGS load_const OBJECT make_function store_name get_text_length load_const load_const OBJECT make_function defaults store_name STRING_LEN_S_ENT_HIGH nop nop load_const load_const OBJECT make_function defaults store_name center_text nop nop load_const load_const OBJECT make_function defaults store_name align_left load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH push_null load_build_class load_const OBJECT make_function load_const IndentedStream load_name object call store_name IndentedStream push_null load_build_class load_const OBJECT make_function load_const Styler load_name object call store_name Styler push_null load_build_class load_const OBJECT make_function load_const ColorizedStyler load_name Styler call store_name ColorizedStyler push_null load_build_class load_const OBJECT make_function load_const MultiTable load_name object call store_name MultiTable push_null load_build_class load_const OBJECT make_function load_const Section load_name object call store_name Section return_const None
    hash: ca3d8c795d22c798e5f3d4086f4cd5cb86171ac908843e957fb68adfff70f04c
sources:
  .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/table.py: IyBDb3B5cmlnaHQgMjAxMi0yMDEzIEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCgojIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpLiBZb3UKIyBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mCiMgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdAoKIyAgICAgaHR0cDovL2F3cy5hbWF6b24uY29tL2FwYWNoZTIuMC8KCiMgb3IgaW4gdGhlICJsaWNlbnNlIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcwojIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GCiMgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljCiMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KaW1wb3J0IHN5cwppbXBvcnQgc3RydWN0CmltcG9ydCB1bmljb2RlZGF0YQoKaW1wb3J0IGNvbG9yYW1hCgpmcm9tIGF3c2NsaS51dGlscyBpbXBvcnQgaXNfYV90dHkKZnJvbSBhd3NjbGkuY29tcGF0IGltcG9ydCBzaXgKCgojIGBhdXRvcmVzZXRgIGFsbG93cyB1cyB0byBub3QgaGF2ZSB0byBzZW50IHJlc2V0IHNlcXVlbmNlcyBmb3IgZXZlcnkKIyBzdHJpbmcuIGBzdHJpcGAgbGV0cyB1cyBwcmVzZXJ2ZSBjb2xvciB3aGVuIHJlZGlyZWN0aW5nLgpDT0xPUkFNQV9LV0FSR1MgPSB7CiAgICAnYXV0b3Jlc2V0JzogVHJ1ZSwKICAgICdzdHJpcCc6IEZhbHNlLAp9CgoKZGVmIGdldF90ZXh0X2xlbmd0aCh0ZXh0KToKICAgICMgYGxlbih1bmljaGFyKWAgbWVhc3VyZXMgdGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzLCBzbyB3ZSB1c2UKICAgICMgYHVuaWNvZGVkYXRhLmVhc3RfYXNpYW5fd2lkdGhgIHRvIG1lYXN1cmUgdGhlIGxlbmd0aCBvZiBjaGFyYWN0ZXJzLgogICAgIyBGb2xsb3dpbmcgcmVzcG9uc2VzIGFyZSBjb25zaWRlcmVkIHRvIGJlIGZ1bGwtd2lkdGggbGVuZ3RoLgogICAgIyAqIEEoQW1iaWd1b3VzKQogICAgIyAqIEYoRnVsbHdpZHRoKQogICAgIyAqIFcoV2lkZSkKICAgIHRleHQgPSBzaXgudGV4dF90eXBlKHRleHQpCiAgICByZXR1cm4gc3VtKDIgaWYgdW5pY29kZWRhdGEuZWFzdF9hc2lhbl93aWR0aChjaGFyKSBpbiAnV0ZBJyBlbHNlIDEKICAgICAgICAgICAgICAgZm9yIGNoYXIgaW4gdGV4dCkKCgpkZWYgZGV0ZXJtaW5lX3Rlcm1pbmFsX3dpZHRoKGRlZmF1bHRfd2lkdGg9ODApOgogICAgIyBJZiB3ZSBjYW4ndCBkZXRlY3QgdGhlIHRlcm1pbmFsIHdpZHRoLCB0aGUgZGVmYXVsdF93aWR0aCBpcyByZXR1cm5lZC4KICAgIHRyeToKICAgICAgICBmcm9tIHRlcm1pb3MgaW1wb3J0IFRJT0NHV0lOU1oKICAgICAgICBmcm9tIGZjbnRsIGltcG9ydCBpb2N0bAogICAgZXhjZXB0IEltcG9ydEVycm9yOgogICAgICAgIHJldHVybiBkZWZhdWx0X3dpZHRoCiAgICB0cnk6CiAgICAgICAgaGVpZ2h0LCB3aWR0aCA9IHN0cnVjdC51bnBhY2soJ2hoaGgnLCBpb2N0bChzeXMuc3Rkb3V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVElPQ0dXSU5TWiwgJ1wwMDAnICogOCkpWzA6Ml0KICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcmV0dXJuIGRlZmF1bHRfd2lkdGgKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIHdpZHRoCgoKZGVmIGNlbnRlcl90ZXh0KHRleHQsIGxlbmd0aD04MCwgbGVmdF9lZGdlPSd8JywgcmlnaHRfZWRnZT0nfCcsCiAgICAgICAgICAgICAgICB0ZXh0X2xlbmd0aD1Ob25lKToKICAgICIiIkNlbnRlciB0ZXh0IHdpdGggc3BlY2lmaWVkIGVkZ2UgY2hhcnMuCgogICAgWW91IGNhbiBwYXNzIGluIHRoZSBsZW5ndGggb2YgdGhlIHRleHQgYXMgYW4gYXJnLCBvdGhlcndpc2UgaXQgaXMgY29tcHV0ZWQKICAgIGF1dG9tYXRpY2FsbHkgZm9yIHlvdS4gIFRoaXMgY2FuIGFsbG93IHlvdSB0byBjZW50ZXIgYSBzdHJpbmcgbm90IGJhc2VkCiAgICBvbiBpdCdzIGxpdGVyYWwgbGVuZ3RoICh1c2VmdWwgaWYgeW91J3JlIHVzaW5nIEFOU0kgY29kZXMpLgogICAgIiIiCiAgICAjIHBvc3Rjb25kaXRpb246IGdldF90ZXh0X2xlbmd0aChyZXR1cm5lZF90ZXh0KSA9PSBsZW5ndGgKICAgIGlmIHRleHRfbGVuZ3RoIGlzIE5vbmU6CiAgICAgICAgdGV4dF9sZW5ndGggPSBnZXRfdGV4dF9sZW5ndGgodGV4dCkKICAgIG91dHB1dCA9IFtdCiAgICBjaGFyX3N0YXJ0ID0gKGxlbmd0aCAvLyAyKSAtICh0ZXh0X2xlbmd0aCAvLyAyKSAtIDEKICAgIG91dHB1dC5hcHBlbmQobGVmdF9lZGdlICsgJyAnICogY2hhcl9zdGFydCArIHRleHQpCiAgICBsZW5ndGhfc29fZmFyID0gZ2V0X3RleHRfbGVuZ3RoKGxlZnRfZWRnZSkgKyBjaGFyX3N0YXJ0ICsgdGV4dF9sZW5ndGgKICAgIHJpZ2h0X3NpZGVfc3BhY2VzID0gbGVuZ3RoIC0gZ2V0X3RleHRfbGVuZ3RoKHJpZ2h0X2VkZ2UpIC0gbGVuZ3RoX3NvX2ZhcgogICAgb3V0cHV0LmFwcGVuZCgnICcgKiByaWdodF9zaWRlX3NwYWNlcykKICAgIG91dHB1dC5hcHBlbmQocmlnaHRfZWRnZSkKICAgIGZpbmFsID0gJycuam9pbihvdXRwdXQpCiAgICByZXR1cm4gZmluYWwKCgpkZWYgYWxpZ25fbGVmdCh0ZXh0LCBsZW5ndGgsIGxlZnRfZWRnZT0nfCcsIHJpZ2h0X2VkZ2U9J3wnLCB0ZXh0X2xlbmd0aD1Ob25lLAogICAgICAgICAgICAgICBsZWZ0X3BhZGRpbmc9Mik6CiAgICAiIiJMZWZ0IGFsaWduIHRleHQuIiIiCiAgICAjIHBvc3Rjb25kaXRpb246IGdldF90ZXh0X2xlbmd0aChyZXR1cm5lZF90ZXh0KSA9PSBsZW5ndGgKICAgIGlmIHRleHRfbGVuZ3RoIGlzIE5vbmU6CiAgICAgICAgdGV4dF9sZW5ndGggPSBnZXRfdGV4dF9sZW5ndGgodGV4dCkKICAgIGNvbXB1dGVkX2xlbmd0aCA9ICgKICAgICAgICB0ZXh0X2xlbmd0aCArIGxlZnRfcGFkZGluZyArIFwKICAgICAgICBnZXRfdGV4dF9sZW5ndGgobGVmdF9lZGdlKSArIGdldF90ZXh0X2xlbmd0aChyaWdodF9lZGdlKSkKICAgIGlmIGxlbmd0aCAtIGNvbXB1dGVkX2xlbmd0aCA+PSAwOgogICAgICAgIHBhZGRpbmcgPSBsZWZ0X3BhZGRpbmcKICAgIGVsc2U6CiAgICAgICAgcGFkZGluZyA9IDAKICAgIG91dHB1dCA9IFtdCiAgICBsZW5ndGhfc29fZmFyID0gMAogICAgb3V0cHV0LmFwcGVuZChsZWZ0X2VkZ2UpCiAgICBsZW5ndGhfc29fZmFyICs9IGxlbihsZWZ0X2VkZ2UpCiAgICBvdXRwdXQuYXBwZW5kKCcgJyAqIHBhZGRpbmcpCiAgICBsZW5ndGhfc29fZmFyICs9IHBhZGRpbmcKICAgIG91dHB1dC5hcHBlbmQodGV4dCkKICAgIGxlbmd0aF9zb19mYXIgKz0gdGV4dF9sZW5ndGgKICAgIG91dHB1dC5hcHBlbmQoJyAnICogKGxlbmd0aCAtIGxlbmd0aF9zb19mYXIgLSBsZW4ocmlnaHRfZWRnZSkpKQogICAgb3V0cHV0LmFwcGVuZChyaWdodF9lZGdlKQogICAgcmV0dXJuICcnLmpvaW4ob3V0cHV0KQoKCmRlZiBjb252ZXJ0X3RvX3ZlcnRpY2FsX3RhYmxlKHNlY3Rpb25zKToKICAgICMgQW55IHNlY3Rpb24gdGhhdCBvbmx5IGhhcyBhIHNpbmdsZSByb3cgaXMKICAgICMgaW52ZXJ0ZWQsIHNvOgogICAgIyBoZWFkZXIxIHwgaGVhZGVyMiB8IGhlYWRlcjMKICAgICMgdmFsMSAgICB8IHZhbDIgICAgfCB2YWwyCiAgICAjCiAgICAjIGJlY29tZXM6CiAgICAjCiAgICAjIGhlYWRlcjEgfCB2YWwxCiAgICAjIGhlYWRlcjIgfCB2YWwyCiAgICAjIGhlYWRlcjMgfCB2YWwzCiAgICBmb3IgaSwgc2VjdGlvbiBpbiBlbnVtZXJhdGUoc2VjdGlvbnMpOgogICAgICAgIGlmIGxlbihzZWN0aW9uLnJvd3MpID09IDEgYW5kIHNlY3Rpb24uaGVhZGVyczoKICAgICAgICAgICAgaGVhZGVycyA9IHNlY3Rpb24uaGVhZGVycwogICAgICAgICAgICBuZXdfc2VjdGlvbiA9IFNlY3Rpb24oKQogICAgICAgICAgICBuZXdfc2VjdGlvbi50aXRsZSA9IHNlY3Rpb24udGl0bGUKICAgICAgICAgICAgbmV3X3NlY3Rpb24uaW5kZW50X2xldmVsID0gc2VjdGlvbi5pbmRlbnRfbGV2ZWwKICAgICAgICAgICAgZm9yIGhlYWRlciwgZWxlbWVudCBpbiB6aXAoaGVhZGVycywgc2VjdGlvbi5yb3dzWzBdKToKICAgICAgICAgICAgICAgIG5ld19zZWN0aW9uLmFkZF9yb3coW2hlYWRlciwgZWxlbWVudF0pCiAgICAgICAgICAgIHNlY3Rpb25zW2ldID0gbmV3X3NlY3Rpb24KCgpjbGFzcyBJbmRlbnRlZFN0cmVhbShvYmplY3QpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHN0cmVhbSwgaW5kZW50X2xldmVsLCBsZWZ0X2luZGVudF9jaGFyPSd8JywKICAgICAgICAgICAgICAgICByaWdodF9pbmRlbnRfY2hhcj0nfCcpOgogICAgICAgIHNlbGYuX3N0cmVhbSA9IHN0cmVhbQogICAgICAgIHNlbGYuX2luZGVudF9sZXZlbCA9IGluZGVudF9sZXZlbAogICAgICAgIHNlbGYuX2xlZnRfaW5kZW50X2NoYXIgPSBsZWZ0X2luZGVudF9jaGFyCiAgICAgICAgc2VsZi5fcmlnaHRfaW5kZW50X2NoYXIgPSByaWdodF9pbmRlbnRfY2hhcgoKICAgIGRlZiB3cml0ZShzZWxmLCB0ZXh0KToKICAgICAgICBzZWxmLl9zdHJlYW0ud3JpdGUoc2VsZi5fbGVmdF9pbmRlbnRfY2hhciAqIHNlbGYuX2luZGVudF9sZXZlbCkKICAgICAgICBpZiB0ZXh0LmVuZHN3aXRoKCdcbicpOgogICAgICAgICAgICBzZWxmLl9zdHJlYW0ud3JpdGUodGV4dFs6LTFdKQogICAgICAgICAgICBzZWxmLl9zdHJlYW0ud3JpdGUoc2VsZi5fcmlnaHRfaW5kZW50X2NoYXIgKiBzZWxmLl9pbmRlbnRfbGV2ZWwpCiAgICAgICAgICAgIHNlbGYuX3N0cmVhbS53cml0ZSgnXG4nKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuX3N0cmVhbS53cml0ZSh0ZXh0KQoKICAgIGRlZiBfX2dldGF0dHJfXyhzZWxmLCBhdHRyKToKICAgICAgICByZXR1cm4gZ2V0YXR0cihzZWxmLl9zdHJlYW0sIGF0dHIpCgoKY2xhc3MgU3R5bGVyKG9iamVjdCk6CiAgICBkZWYgc3R5bGVfdGl0bGUoc2VsZiwgdGV4dCk6CiAgICAgICAgcmV0dXJuIHRleHQKCiAgICBkZWYgc3R5bGVfaGVhZGVyX2NvbHVtbihzZWxmLCB0ZXh0KToKICAgICAgICByZXR1cm4gdGV4dAoKICAgIGRlZiBzdHlsZV9yb3dfZWxlbWVudChzZWxmLCB0ZXh0KToKICAgICAgICByZXR1cm4gdGV4dAoKICAgIGRlZiBzdHlsZV9pbmRlbnRhdGlvbl9jaGFyKHNlbGYsIHRleHQpOgogICAgICAgIHJldHVybiB0ZXh0CgoKY2xhc3MgQ29sb3JpemVkU3R5bGVyKFN0eWxlcik6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgY29sb3JhbWEuaW5pdCgqKkNPTE9SQU1BX0tXQVJHUykKCiAgICBkZWYgc3R5bGVfdGl0bGUoc2VsZiwgdGV4dCk6CiAgICAgICAgIyBPcmlnaW5hbGx5IGJvbGQgKyB1bmRlcmxpbmUKICAgICAgICByZXR1cm4gdGV4dAogICAgICAgICNyZXR1cm4gY29sb3JhbWEuU3R5bGUuQk9MRCArIHRleHQgKyBjb2xvcmFtYS5TdHlsZS5SRVNFVF9BTEwKCiAgICBkZWYgc3R5bGVfaGVhZGVyX2NvbHVtbihzZWxmLCB0ZXh0KToKICAgICAgICAjIE9yaWdpbmFsbHkgdW5kZXJsaW5lCiAgICAgICAgcmV0dXJuIHRleHQKCiAgICBkZWYgc3R5bGVfcm93X2VsZW1lbnQoc2VsZiwgdGV4dCk6CiAgICAgICAgcmV0dXJuIChjb2xvcmFtYS5TdHlsZS5CUklHSFQgKyBjb2xvcmFtYS5Gb3JlLkJMVUUgKwogICAgICAgICAgICAgICAgdGV4dCArIGNvbG9yYW1hLlN0eWxlLlJFU0VUX0FMTCkKCiAgICBkZWYgc3R5bGVfaW5kZW50YXRpb25fY2hhcihzZWxmLCB0ZXh0KToKICAgICAgICByZXR1cm4gKGNvbG9yYW1hLlN0eWxlLkRJTSArIGNvbG9yYW1hLkZvcmUuWUVMTE9XICsKICAgICAgICAgICAgICAgIHRleHQgKyBjb2xvcmFtYS5TdHlsZS5SRVNFVF9BTEwpCgoKY2xhc3MgTXVsdGlUYWJsZShvYmplY3QpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHRlcm1pbmFsX3dpZHRoPU5vbmUsIGluaXRpYWxfc2VjdGlvbj1UcnVlLAogICAgICAgICAgICAgICAgIGNvbHVtbl9zZXBhcmF0b3I9J3wnLCB0ZXJtaW5hbD1Ob25lLAogICAgICAgICAgICAgICAgIHN0eWxlcj1Ob25lLCBhdXRvX3JlZm9ybWF0PVRydWUpOgogICAgICAgIHNlbGYuX2F1dG9fcmVmb3JtYXQgPSBhdXRvX3JlZm9ybWF0CiAgICAgICAgaWYgaW5pdGlhbF9zZWN0aW9uOgogICAgICAgICAgICBzZWxmLl9jdXJyZW50X3NlY3Rpb24gPSBTZWN0aW9uKCkKICAgICAgICAgICAgc2VsZi5fc2VjdGlvbnMgPSBbc2VsZi5fY3VycmVudF9zZWN0aW9uXQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuX2N1cnJlbnRfc2VjdGlvbiA9IE5vbmUKICAgICAgICAgICAgc2VsZi5fc2VjdGlvbnMgPSBbXQogICAgICAgIGlmIHN0eWxlciBpcyBOb25lOgogICAgICAgICAgICAjIE1vdmUgb3V0IHRvIGZhY3RvcnkuCiAgICAgICAgICAgIGlmIGlzX2FfdHR5KCk6CiAgICAgICAgICAgICAgICBzZWxmLl9zdHlsZXIgPSBDb2xvcml6ZWRTdHlsZXIoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5fc3R5bGVyID0gU3R5bGVyKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLl9zdHlsZXIgPSBzdHlsZXIKICAgICAgICBzZWxmLl9yZW5kZXJpbmdfaW5kZXggPSAwCiAgICAgICAgc2VsZi5fY29sdW1uX3NlcGFyYXRvciA9IGNvbHVtbl9zZXBhcmF0b3IKICAgICAgICBpZiB0ZXJtaW5hbF93aWR0aCBpcyBOb25lOgogICAgICAgICAgICBzZWxmLl90ZXJtaW5hbF93aWR0aCA9IGRldGVybWluZV90ZXJtaW5hbF93aWR0aCgpCgogICAgZGVmIGFkZF90aXRsZShzZWxmLCB0aXRsZSk6CiAgICAgICAgc2VsZi5fY3VycmVudF9zZWN0aW9uLmFkZF90aXRsZSh0aXRsZSkKCiAgICBkZWYgYWRkX3Jvd19oZWFkZXIoc2VsZiwgaGVhZGVycyk6CiAgICAgICAgc2VsZi5fY3VycmVudF9zZWN0aW9uLmFkZF9oZWFkZXIoaGVhZGVycykKCiAgICBkZWYgYWRkX3JvdyhzZWxmLCByb3dfZWxlbWVudHMpOgogICAgICAgIHNlbGYuX2N1cnJlbnRfc2VjdGlvbi5hZGRfcm93KHJvd19lbGVtZW50cykKCiAgICBkZWYgbmV3X3NlY3Rpb24oc2VsZiwgdGl0bGUsIGluZGVudF9sZXZlbD0wKToKICAgICAgICBzZWxmLl9jdXJyZW50X3NlY3Rpb24gPSBTZWN0aW9uKCkKICAgICAgICBzZWxmLl9zZWN0aW9ucy5hcHBlbmQoc2VsZi5fY3VycmVudF9zZWN0aW9uKQogICAgICAgIHNlbGYuX2N1cnJlbnRfc2VjdGlvbi5hZGRfdGl0bGUodGl0bGUpCiAgICAgICAgc2VsZi5fY3VycmVudF9zZWN0aW9uLmluZGVudF9sZXZlbCA9IGluZGVudF9sZXZlbAoKICAgIGRlZiByZW5kZXIoc2VsZiwgc3RyZWFtKToKICAgICAgICBtYXhfd2lkdGggPSBzZWxmLl9jYWxjdWxhdGVfbWF4X3dpZHRoKCkKICAgICAgICBzaG91bGRfY29udmVydF90YWJsZSA9IHNlbGYuX2RldGVybWluZV9jb252ZXJzaW9uX25lZWRlZChtYXhfd2lkdGgpCiAgICAgICAgaWYgc2hvdWxkX2NvbnZlcnRfdGFibGU6CiAgICAgICAgICAgIGNvbnZlcnRfdG9fdmVydGljYWxfdGFibGUoc2VsZi5fc2VjdGlvbnMpCiAgICAgICAgICAgIG1heF93aWR0aCA9IHNlbGYuX2NhbGN1bGF0ZV9tYXhfd2lkdGgoKQogICAgICAgIHN0cmVhbS53cml0ZSgnLScgKiBtYXhfd2lkdGggKyAnXG4nKQogICAgICAgIGZvciBzZWN0aW9uIGluIHNlbGYuX3NlY3Rpb25zOgogICAgICAgICAgICBzZWxmLl9yZW5kZXJfc2VjdGlvbihzZWN0aW9uLCBtYXhfd2lkdGgsIHN0cmVhbSkKCiAgICBkZWYgX2RldGVybWluZV9jb252ZXJzaW9uX25lZWRlZChzZWxmLCBtYXhfd2lkdGgpOgogICAgICAgICMgSWYgd2UgZG9uJ3Qga25vdyB0aGUgd2lkdGggb2YgdGhlIGNvbnRyb2xsaW5nIHRlcm1pbmFsLAogICAgICAgICMgdGhlbiB3ZSBkb24ndCB0cnkgdG8gcmVzaXplIHRoZSB0YWJsZS4KICAgICAgICBpZiBtYXhfd2lkdGggPiBzZWxmLl90ZXJtaW5hbF93aWR0aDoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2F1dG9fcmVmb3JtYXQKCiAgICBkZWYgX2NhbGN1bGF0ZV9tYXhfd2lkdGgoc2VsZik6CiAgICAgICAgbWF4X3dpZHRoID0gbWF4KHMudG90YWxfd2lkdGgocGFkZGluZz00LCB3aXRoX2JvcmRlcj1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyX3BhZGRpbmc9cy5pbmRlbnRfbGV2ZWwpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBzIGluIHNlbGYuX3NlY3Rpb25zKQogICAgICAgIHJldHVybiBtYXhfd2lkdGgKCiAgICBkZWYgX3JlbmRlcl9zZWN0aW9uKHNlbGYsIHNlY3Rpb24sIG1heF93aWR0aCwgc3RyZWFtKToKICAgICAgICBzdHJlYW0gPSBJbmRlbnRlZFN0cmVhbShzdHJlYW0sIHNlY3Rpb24uaW5kZW50X2xldmVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3N0eWxlci5zdHlsZV9pbmRlbnRhdGlvbl9jaGFyKCd8JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fc3R5bGVyLnN0eWxlX2luZGVudGF0aW9uX2NoYXIoJ3wnKSkKICAgICAgICBtYXhfd2lkdGggLT0gKHNlY3Rpb24uaW5kZW50X2xldmVsICogMikKICAgICAgICBzZWxmLl9yZW5kZXJfdGl0bGUoc2VjdGlvbiwgbWF4X3dpZHRoLCBzdHJlYW0pCiAgICAgICAgc2VsZi5fcmVuZGVyX2NvbHVtbl90aXRsZXMoc2VjdGlvbiwgbWF4X3dpZHRoLCBzdHJlYW0pCiAgICAgICAgc2VsZi5fcmVuZGVyX3Jvd3Moc2VjdGlvbiwgbWF4X3dpZHRoLCBzdHJlYW0pCgogICAgZGVmIF9yZW5kZXJfdGl0bGUoc2VsZiwgc2VjdGlvbiwgbWF4X3dpZHRoLCBzdHJlYW0pOgogICAgICAgICMgVGhlIHRpdGxlIGNvbnNpc3RzIG9mOgogICAgICAgICMgdGl0bGUgICAgICAgIDogIHwgICBUaGlzIGlzIHRoZSB0aXRsZSAgICAgIHwKICAgICAgICAjIGJvdHRvbV9ib3JkZXI6ICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgaWYgc2VjdGlvbi50aXRsZToKICAgICAgICAgICAgdGl0bGUgPSBzZWxmLl9zdHlsZXIuc3R5bGVfdGl0bGUoc2VjdGlvbi50aXRsZSkKICAgICAgICAgICAgc3RyZWFtLndyaXRlKGNlbnRlcl90ZXh0KHRpdGxlLCBtYXhfd2lkdGgsICd8JywgJ3wnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0X3RleHRfbGVuZ3RoKHNlY3Rpb24udGl0bGUpKSArICdcbicpCiAgICAgICAgICAgIGlmIG5vdCBzZWN0aW9uLmhlYWRlcnMgYW5kIG5vdCBzZWN0aW9uLnJvd3M6CiAgICAgICAgICAgICAgICBzdHJlYW0ud3JpdGUoJyslcysnICUgKCctJyAqIChtYXhfd2lkdGggLSAyKSkgKyAnXG4nKQoKICAgIGRlZiBfcmVuZGVyX2NvbHVtbl90aXRsZXMoc2VsZiwgc2VjdGlvbiwgbWF4X3dpZHRoLCBzdHJlYW0pOgogICAgICAgIGlmIG5vdCBzZWN0aW9uLmhlYWRlcnM6CiAgICAgICAgICAgIHJldHVybgogICAgICAgICMgSW4gb3JkZXIgdG8gcmVuZGVyIHRoZSBjb2x1bW4gdGl0bGVzIHdlIG5lZWQgdG8ga25vdwogICAgICAgICMgdGhlIHdpZHRoIG9mIGVhY2ggb2YgdGhlIGNvbHVtbnMuCiAgICAgICAgd2lkdGhzID0gc2VjdGlvbi5jYWxjdWxhdGVfY29sdW1uX3dpZHRocyhwYWRkaW5nPTQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfd2lkdGg9bWF4X3dpZHRoKQogICAgICAgICMgVE9ETzogQnVpbHQgYSBsaXN0IGluc3RlYWQgb2YgKz0sIGl0J3MgbW9yZSBlZmZpY2llbnQuCiAgICAgICAgY3VycmVudCA9ICcnCiAgICAgICAgbGVuZ3RoX3NvX2ZhciA9IDAKICAgICAgICAjIFRoZSBmaXJzdCBjZWxsIG5lZWRzIGJvdGggbGVmdCBhbmQgcmlnaHQgZWRnZXMgJ3wgIGZvbyAgfCcKICAgICAgICAjIHdoaWxlIHN1YnNlcXVlbnQgY2VsbHMgb25seSBuZWVkIHJpZ2h0IGVkZ2VzICcgIGZvbyAgfCcuCiAgICAgICAgZmlyc3QgPSBUcnVlCiAgICAgICAgZm9yIHdpZHRoLCBoZWFkZXIgaW4gemlwKHdpZHRocywgc2VjdGlvbi5oZWFkZXJzKToKICAgICAgICAgICAgc3R5bGl6ZWRfaGVhZGVyID0gc2VsZi5fc3R5bGVyLnN0eWxlX2hlYWRlcl9jb2x1bW4oaGVhZGVyKQogICAgICAgICAgICBpZiBmaXJzdDoKICAgICAgICAgICAgICAgIGxlZnRfZWRnZSA9ICd8JwogICAgICAgICAgICAgICAgZmlyc3QgPSBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbGVmdF9lZGdlID0gJycKICAgICAgICAgICAgY3VycmVudCArPSBjZW50ZXJfdGV4dCh0ZXh0PXN0eWxpemVkX2hlYWRlciwgbGVuZ3RoPXdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRfZWRnZT1sZWZ0X2VkZ2UsIHJpZ2h0X2VkZ2U9J3wnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRfbGVuZ3RoPWdldF90ZXh0X2xlbmd0aChoZWFkZXIpKQogICAgICAgICAgICBsZW5ndGhfc29fZmFyICs9IHdpZHRoCiAgICAgICAgc2VsZi5fd3JpdGVfbGluZV9icmVhayhzdHJlYW0sIHdpZHRocykKICAgICAgICBzdHJlYW0ud3JpdGUoY3VycmVudCArICdcbicpCgogICAgZGVmIF93cml0ZV9saW5lX2JyZWFrKHNlbGYsIHN0cmVhbSwgd2lkdGhzKToKICAgICAgICAjIFdyaXRlIG91dCBzb21ldGhpbmcgbGlrZToKICAgICAgICAjICstLS0tLS0tKy0tLS0tLS0tLSstLS0tLS0tLS0rCiAgICAgICAgcGFydHMgPSBbXQogICAgICAgIGZpcnN0ID0gVHJ1ZQogICAgICAgIGZvciB3aWR0aCBpbiB3aWR0aHM6CiAgICAgICAgICAgIGlmIGZpcnN0OgogICAgICAgICAgICAgICAgcGFydHMuYXBwZW5kKCcrJXMrJyAlICgnLScgKiAod2lkdGggLSAyKSkpCiAgICAgICAgICAgICAgICBmaXJzdCA9IEZhbHNlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwYXJ0cy5hcHBlbmQoJyVzKycgJSAoJy0nICogKHdpZHRoIC0gMSkpKQogICAgICAgIHBhcnRzLmFwcGVuZCgnXG4nKQogICAgICAgIHN0cmVhbS53cml0ZSgnJy5qb2luKHBhcnRzKSkKCiAgICBkZWYgX3JlbmRlcl9yb3dzKHNlbGYsIHNlY3Rpb24sIG1heF93aWR0aCwgc3RyZWFtKToKICAgICAgICBpZiBub3Qgc2VjdGlvbi5yb3dzOgogICAgICAgICAgICByZXR1cm4KICAgICAgICB3aWR0aHMgPSBzZWN0aW9uLmNhbGN1bGF0ZV9jb2x1bW5fd2lkdGhzKHBhZGRpbmc9NCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heF93aWR0aD1tYXhfd2lkdGgpCiAgICAgICAgaWYgbm90IHdpZHRoczoKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgc2VsZi5fd3JpdGVfbGluZV9icmVhayhzdHJlYW0sIHdpZHRocykKICAgICAgICBmb3Igcm93IGluIHNlY3Rpb24ucm93czoKICAgICAgICAgICAgIyBUT0RPOiBCdWlsdCB0aGUgc3RyaW5nIGluIGEgbGlzdCB0aGVuIGpvaW4gaW5zdGVhZCBvZiB1c2luZyArPSwKICAgICAgICAgICAgIyBpdCdzIG1vcmUgZWZmaWNpZW50LgogICAgICAgICAgICBjdXJyZW50ID0gJycKICAgICAgICAgICAgbGVuZ3RoX3NvX2ZhciA9IDAKICAgICAgICAgICAgZmlyc3QgPSBUcnVlCiAgICAgICAgICAgIGZvciB3aWR0aCwgZWxlbWVudCBpbiB6aXAod2lkdGhzLCByb3cpOgogICAgICAgICAgICAgICAgaWYgZmlyc3Q6CiAgICAgICAgICAgICAgICAgICAgbGVmdF9lZGdlID0gJ3wnCiAgICAgICAgICAgICAgICAgICAgZmlyc3QgPSBGYWxzZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsZWZ0X2VkZ2UgPSAnJwogICAgICAgICAgICAgICAgc3R5bGl6ZWQgPSBzZWxmLl9zdHlsZXIuc3R5bGVfcm93X2VsZW1lbnQoZWxlbWVudCkKICAgICAgICAgICAgICAgIGN1cnJlbnQgKz0gYWxpZ25fbGVmdCh0ZXh0PXN0eWxpemVkLCBsZW5ndGg9d2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdF9lZGdlPWxlZnRfZWRnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByaWdodF9lZGdlPXNlbGYuX2NvbHVtbl9zZXBhcmF0b3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dF9sZW5ndGg9Z2V0X3RleHRfbGVuZ3RoKGVsZW1lbnQpKQogICAgICAgICAgICAgICAgbGVuZ3RoX3NvX2ZhciArPSB3aWR0aAogICAgICAgICAgICBzdHJlYW0ud3JpdGUoY3VycmVudCArICdcbicpCiAgICAgICAgc2VsZi5fd3JpdGVfbGluZV9icmVhayhzdHJlYW0sIHdpZHRocykKCgpjbGFzcyBTZWN0aW9uKG9iamVjdCk6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi50aXRsZSA9ICcnCiAgICAgICAgc2VsZi5oZWFkZXJzID0gW10KICAgICAgICBzZWxmLnJvd3MgPSBbXQogICAgICAgIHNlbGYuaW5kZW50X2xldmVsID0gMAogICAgICAgIHNlbGYuX251bV9jb2xzID0gTm9uZQogICAgICAgIHNlbGYuX21heF93aWR0aHMgPSBbXQoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gKCJTZWN0aW9uKHRpdGxlPSVzLCBoZWFkZXJzPSVzLCBpbmRlbnRfbGV2ZWw9JXMsIG51bV9yb3dzPSVzKSIgJQogICAgICAgICAgICAgICAgKHNlbGYudGl0bGUsIHNlbGYuaGVhZGVycywgc2VsZi5pbmRlbnRfbGV2ZWwsIGxlbihzZWxmLnJvd3MpKSkKCiAgICBkZWYgY2FsY3VsYXRlX2NvbHVtbl93aWR0aHMoc2VsZiwgcGFkZGluZz0wLCBtYXhfd2lkdGg9Tm9uZSk6CiAgICAgICAgIyBwb3N0Y29uZGl0aW9uOiBzdW0od2lkdGhzKSA9PSBtYXhfd2lkdGgKICAgICAgICB1bnNjYWxlZF93aWR0aHMgPSBbdyArIHBhZGRpbmcgZm9yIHcgaW4gc2VsZi5fbWF4X3dpZHRoc10KICAgICAgICBpZiBtYXhfd2lkdGggaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHVuc2NhbGVkX3dpZHRocwogICAgICAgIGlmIG5vdCB1bnNjYWxlZF93aWR0aHM6CiAgICAgICAgICAgIHJldHVybiB1bnNjYWxlZF93aWR0aHMKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIENvbXB1dGUgc2NhbGUgZmFjdG9yIGZvciBtYXhfd2lkdGguCiAgICAgICAgICAgIHNjYWxlX2ZhY3RvciA9IG1heF93aWR0aCAvIGZsb2F0KHN1bSh1bnNjYWxlZF93aWR0aHMpKQogICAgICAgICAgICBzY2FsZWQgPSBbaW50KHJvdW5kKHNjYWxlX2ZhY3RvciAqIHcpKSBmb3IgdyBpbiB1bnNjYWxlZF93aWR0aHNdCiAgICAgICAgICAgICMgT25jZSB3ZSd2ZSBzY2FsZWQgdGhlIGNvbHVtbnMsIHdlIG1heSBiZSBzbGlnaHRseSBvdmVyL3VuZGVyCiAgICAgICAgICAgICMgdGhlIGFtb3VudCB3ZSBuZWVkIHNvIHdlIGhhdmUgdG8gYWRqdXN0IHRoZSBjb2x1bW5zLgogICAgICAgICAgICBvZmZfYnkgPSBzdW0oc2NhbGVkKSAtIG1heF93aWR0aAogICAgICAgICAgICB3aGlsZSBvZmZfYnkgIT0gMDoKICAgICAgICAgICAgICAgIGl0ZXJfb3JkZXIgPSByYW5nZShsZW4oc2NhbGVkKSkKICAgICAgICAgICAgICAgIGlmIG9mZl9ieSA8IDA6CiAgICAgICAgICAgICAgICAgICAgaXRlcl9vcmRlciA9IHJldmVyc2VkKGl0ZXJfb3JkZXIpCiAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVyX29yZGVyOgogICAgICAgICAgICAgICAgICAgIGlmIG9mZl9ieSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlZFtpXSAtPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZl9ieSAtPSAxCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVkW2ldICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgb2ZmX2J5ICs9IDEKICAgICAgICAgICAgICAgICAgICBpZiBvZmZfYnkgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgcmV0dXJuIHNjYWxlZAoKICAgIGRlZiB0b3RhbF93aWR0aChzZWxmLCBwYWRkaW5nPTAsIHdpdGhfYm9yZGVyPUZhbHNlLCBvdXRlcl9wYWRkaW5nPTApOgogICAgICAgIHRvdGFsID0gMAogICAgICAgICMgT25lIGNoYXIgb24gZWFjaCBzaWRlID09IDIgY2hhcnMgdG90YWwgdG8gdGhlIHdpZHRoLgogICAgICAgIGJvcmRlcl9wYWRkaW5nID0gMgogICAgICAgIGZvciB3IGluIHNlbGYuY2FsY3VsYXRlX2NvbHVtbl93aWR0aHMoKToKICAgICAgICAgICAgdG90YWwgKz0gdyArIHBhZGRpbmcKICAgICAgICBpZiB3aXRoX2JvcmRlcjoKICAgICAgICAgICAgdG90YWwgKz0gYm9yZGVyX3BhZGRpbmcKICAgICAgICB0b3RhbCArPSBvdXRlcl9wYWRkaW5nICsgb3V0ZXJfcGFkZGluZwogICAgICAgIHJldHVybiBtYXgoZ2V0X3RleHRfbGVuZ3RoKHNlbGYudGl0bGUpICsgYm9yZGVyX3BhZGRpbmcgKyBvdXRlcl9wYWRkaW5nICsKICAgICAgICAgICAgICAgICAgIG91dGVyX3BhZGRpbmcsIHRvdGFsKQoKICAgIGRlZiBhZGRfdGl0bGUoc2VsZiwgdGl0bGUpOgogICAgICAgIHNlbGYudGl0bGUgPSB0aXRsZQoKICAgIGRlZiBhZGRfaGVhZGVyKHNlbGYsIGhlYWRlcnMpOgogICAgICAgIHNlbGYuX3VwZGF0ZV9tYXhfd2lkdGhzKGhlYWRlcnMpCiAgICAgICAgaWYgc2VsZi5fbnVtX2NvbHMgaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5fbnVtX2NvbHMgPSBsZW4oaGVhZGVycykKICAgICAgICBzZWxmLmhlYWRlcnMgPSBzZWxmLl9mb3JtYXRfaGVhZGVycyhoZWFkZXJzKQoKICAgIGRlZiBfZm9ybWF0X2hlYWRlcnMoc2VsZiwgaGVhZGVycyk6CiAgICAgICAgcmV0dXJuIGhlYWRlcnMKCiAgICBkZWYgYWRkX3JvdyhzZWxmLCByb3cpOgogICAgICAgIGlmIHNlbGYuX251bV9jb2xzIGlzIE5vbmU6CiAgICAgICAgICAgIHNlbGYuX251bV9jb2xzID0gbGVuKHJvdykKICAgICAgICBpZiBsZW4ocm93KSAhPSBzZWxmLl9udW1fY29sczoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiUm93IHNob3VsZCBoYXZlICVzIGVsZW1lbnRzLCBpbnN0ZWFkICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXQgaGFzICVzIiAlIChzZWxmLl9udW1fY29scywgbGVuKHJvdykpKQogICAgICAgIHJvdyA9IHNlbGYuX2Zvcm1hdF9yb3cocm93KQogICAgICAgIHNlbGYucm93cy5hcHBlbmQocm93KQogICAgICAgIHNlbGYuX3VwZGF0ZV9tYXhfd2lkdGhzKHJvdykKCiAgICBkZWYgX2Zvcm1hdF9yb3coc2VsZiwgcm93KToKICAgICAgICByZXR1cm4gW3NpeC50ZXh0X3R5cGUocikgZm9yIHIgaW4gcm93XQoKICAgIGRlZiBfdXBkYXRlX21heF93aWR0aHMoc2VsZiwgcm93KToKICAgICAgICBpZiBub3Qgc2VsZi5fbWF4X3dpZHRoczoKICAgICAgICAgICAgc2VsZi5fbWF4X3dpZHRocyA9IFtnZXRfdGV4dF9sZW5ndGgoZWwpIGZvciBlbCBpbiByb3ddCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZm9yIGksIGVsIGluIGVudW1lcmF0ZShyb3cpOgogICAgICAgICAgICAgICAgc2VsZi5fbWF4X3dpZHRoc1tpXSA9IG1heChnZXRfdGV4dF9sZW5ndGgoZWwpLCBzZWxmLl9tYXhfd2lkdGhzW2ldKQo=
