statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/rrequests/2.27.1/rrequests-2.27.1/rrequests-2.27.1/tests/test_lowlevel.py
  contents:
  - name: <module>
    score: 0.0
    code: |-
      # -*- coding: utf-8 -*-

      import pytest
      import threading
      import requests

      from tests.testserver.server import Server, consume_socket_content

      from .utils import override_environ


      def echo_response_handler(sock):
          """Simple handler that will take request and echo it back to requester."""
          request_content = consume_socket_content(sock, timeout=0.5)

          text_200 = (
              b'HTTP/1.1 200 OK\r\n'
              b'Content-Length: %d\r\n\r\n'
              b'%s'
          ) % (len(request_content), request_content)
          sock.send(text_200)
    tokens: resume load_const INTEGER load_const import_name pytest store_name pytest load_const INTEGER load_const import_name threading store_name threading load_const INTEGER load_const import_name requests store_name requests load_const INTEGER load_const import_name STRING_LEN_S_ENT_MED import_from Server store_name Server import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top load_const INTEGER load_const import_name utils import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const http load_const http build_list build_tuple load_const https load_const https build_list build_tuple load_const all load_const http load_const https build_list build_tuple build_list store_name STRING_LEN_S_ENT_HIGH build_list store_name _proxy_combos load_name STRING_LEN_S_ENT_HIGH get_iter for_iter TO_NUMBER unpack_sequence store_name prefix store_name schemes load_name schemes get_iter for_iter TO_NUMBER store_name scheme load_name _proxy_combos load_attr append load_const {}_proxy load_attr format load_name prefix call load_name scheme build_tuple call pop_top jump_backward TO_NUMBER end_for jump_backward TO_NUMBER end_for load_name _proxy_combos load_name _proxy_combos get_iter load_fast_and_clear var load_fast_and_clear scheme swap build_list swap for_iter TO_NUMBER unpack_sequence store_fast var store_fast scheme load_fast var load_attr upper call load_fast scheme build_tuple list_append jump_backward TO_NUMBER end_for swap store_fast scheme store_fast var binary_op += store_name _proxy_combos load_name pytest load_attr mark load_attr parametrize load_const var,scheme load_name _proxy_combos call load_const OBJECT make_function call store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH return_const None swap pop_top swap store_fast scheme store_fast var reraise
    hash: 594298251a07455aa2d0bd2fc9411d3a1657643bc22182b7ca477333cc8b6615
sources:
  .repo_cache/malicious_repos/pypi_malregistry/rrequests/2.27.1/rrequests-2.27.1/rrequests-2.27.1/tests/test_lowlevel.py: IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KCmltcG9ydCBweXRlc3QKaW1wb3J0IHRocmVhZGluZwppbXBvcnQgcmVxdWVzdHMKCmZyb20gdGVzdHMudGVzdHNlcnZlci5zZXJ2ZXIgaW1wb3J0IFNlcnZlciwgY29uc3VtZV9zb2NrZXRfY29udGVudAoKZnJvbSAudXRpbHMgaW1wb3J0IG92ZXJyaWRlX2Vudmlyb24KCgpkZWYgZWNob19yZXNwb25zZV9oYW5kbGVyKHNvY2spOgogICAgIiIiU2ltcGxlIGhhbmRsZXIgdGhhdCB3aWxsIHRha2UgcmVxdWVzdCBhbmQgZWNobyBpdCBiYWNrIHRvIHJlcXVlc3Rlci4iIiIKICAgIHJlcXVlc3RfY29udGVudCA9IGNvbnN1bWVfc29ja2V0X2NvbnRlbnQoc29jaywgdGltZW91dD0wLjUpCgogICAgdGV4dF8yMDAgPSAoCiAgICAgICAgYidIVFRQLzEuMSAyMDAgT0tcclxuJwogICAgICAgIGInQ29udGVudC1MZW5ndGg6ICVkXHJcblxyXG4nCiAgICAgICAgYiclcycKICAgICkgJSAobGVuKHJlcXVlc3RfY29udGVudCksIHJlcXVlc3RfY29udGVudCkKICAgIHNvY2suc2VuZCh0ZXh0XzIwMCkKCgpkZWYgdGVzdF9jaHVua2VkX3VwbG9hZCgpOgogICAgIiIiY2FuIHNhZmVseSBzZW5kIGdlbmVyYXRvcnMiIiIKICAgIGNsb3NlX3NlcnZlciA9IHRocmVhZGluZy5FdmVudCgpCiAgICBzZXJ2ZXIgPSBTZXJ2ZXIuYmFzaWNfcmVzcG9uc2Vfc2VydmVyKHdhaXRfdG9fY2xvc2VfZXZlbnQ9Y2xvc2Vfc2VydmVyKQogICAgZGF0YSA9IGl0ZXIoW2InYScsIGInYicsIGInYyddKQoKICAgIHdpdGggc2VydmVyIGFzIChob3N0LCBwb3J0KToKICAgICAgICB1cmwgPSAnaHR0cDovL3t9Ont9LycuZm9ybWF0KGhvc3QsIHBvcnQpCiAgICAgICAgciA9IHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPWRhdGEsIHN0cmVhbT1UcnVlKQogICAgICAgIGNsb3NlX3NlcnZlci5zZXQoKSAgIyByZWxlYXNlIHNlcnZlciBibG9jawoKICAgIGFzc2VydCByLnN0YXR1c19jb2RlID09IDIwMAogICAgYXNzZXJ0IHIucmVxdWVzdC5oZWFkZXJzWydUcmFuc2Zlci1FbmNvZGluZyddID09ICdjaHVua2VkJwoKCmRlZiB0ZXN0X2NodW5rZWRfZW5jb2RpbmdfZXJyb3IoKToKICAgICIiImdldCBhIENodW5rZWRFbmNvZGluZ0Vycm9yIGlmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhIGJhZCByZXNwb25zZSIiIgoKICAgIGRlZiBpbmNvbXBsZXRlX2NodW5rZWRfcmVzcG9uc2VfaGFuZGxlcihzb2NrKToKICAgICAgICByZXF1ZXN0X2NvbnRlbnQgPSBjb25zdW1lX3NvY2tldF9jb250ZW50KHNvY2ssIHRpbWVvdXQ9MC41KQoKICAgICAgICAjIFRoZSBzZXJ2ZXIgbmV2ZXIgZW5kcyB0aGUgcmVxdWVzdCBhbmQgZG9lc24ndCBwcm92aWRlIGFueSB2YWxpZCBjaHVua3MKICAgICAgICBzb2NrLnNlbmQoYiJIVFRQLzEuMSAyMDAgT0tcclxuIiArCiAgICAgICAgICAgICAgICAgIGIiVHJhbnNmZXItRW5jb2Rpbmc6IGNodW5rZWRcclxuIikKCiAgICAgICAgcmV0dXJuIHJlcXVlc3RfY29udGVudAoKICAgIGNsb3NlX3NlcnZlciA9IHRocmVhZGluZy5FdmVudCgpCiAgICBzZXJ2ZXIgPSBTZXJ2ZXIoaW5jb21wbGV0ZV9jaHVua2VkX3Jlc3BvbnNlX2hhbmRsZXIpCgogICAgd2l0aCBzZXJ2ZXIgYXMgKGhvc3QsIHBvcnQpOgogICAgICAgIHVybCA9ICdodHRwOi8ve306e30vJy5mb3JtYXQoaG9zdCwgcG9ydCkKICAgICAgICB3aXRoIHB5dGVzdC5yYWlzZXMocmVxdWVzdHMuZXhjZXB0aW9ucy5DaHVua2VkRW5jb2RpbmdFcnJvcik6CiAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5nZXQodXJsKQogICAgICAgIGNsb3NlX3NlcnZlci5zZXQoKSAgIyByZWxlYXNlIHNlcnZlciBibG9jawoKCmRlZiB0ZXN0X2NodW5rZWRfdXBsb2FkX3VzZXNfb25seV9zcGVjaWZpZWRfaG9zdF9oZWFkZXIoKToKICAgICIiIkVuc3VyZSB3ZSB1c2Ugb25seSB0aGUgc3BlY2lmaWVkIEhvc3QgaGVhZGVyIGZvciBjaHVua2VkIHJlcXVlc3RzLiIiIgogICAgY2xvc2Vfc2VydmVyID0gdGhyZWFkaW5nLkV2ZW50KCkKICAgIHNlcnZlciA9IFNlcnZlcihlY2hvX3Jlc3BvbnNlX2hhbmRsZXIsIHdhaXRfdG9fY2xvc2VfZXZlbnQ9Y2xvc2Vfc2VydmVyKQoKICAgIGRhdGEgPSBpdGVyKFtiJ2EnLCBiJ2InLCBiJ2MnXSkKICAgIGN1c3RvbV9ob3N0ID0gJ3NhbXBsZS1ob3N0JwoKICAgIHdpdGggc2VydmVyIGFzIChob3N0LCBwb3J0KToKICAgICAgICB1cmwgPSAnaHR0cDovL3t9Ont9LycuZm9ybWF0KGhvc3QsIHBvcnQpCiAgICAgICAgciA9IHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPWRhdGEsIGhlYWRlcnM9eydIb3N0JzogY3VzdG9tX2hvc3R9LCBzdHJlYW09VHJ1ZSkKICAgICAgICBjbG9zZV9zZXJ2ZXIuc2V0KCkgICMgcmVsZWFzZSBzZXJ2ZXIgYmxvY2sKCiAgICBleHBlY3RlZF9oZWFkZXIgPSBiJ0hvc3Q6ICVzXHJcbicgJSBjdXN0b21faG9zdC5lbmNvZGUoJ3V0Zi04JykKICAgIGFzc2VydCBleHBlY3RlZF9oZWFkZXIgaW4gci5jb250ZW50CiAgICBhc3NlcnQgci5jb250ZW50LmNvdW50KGInSG9zdDogJykgPT0gMQoKCmRlZiB0ZXN0X2NodW5rZWRfdXBsb2FkX2RvZXNudF9za2lwX2hvc3RfaGVhZGVyKCk6CiAgICAiIiJFbnN1cmUgd2UgZG9uJ3Qgb21pdCBhbGwgSG9zdCBoZWFkZXJzIHdpdGggY2h1bmtlZCByZXF1ZXN0cy4iIiIKICAgIGNsb3NlX3NlcnZlciA9IHRocmVhZGluZy5FdmVudCgpCiAgICBzZXJ2ZXIgPSBTZXJ2ZXIoZWNob19yZXNwb25zZV9oYW5kbGVyLCB3YWl0X3RvX2Nsb3NlX2V2ZW50PWNsb3NlX3NlcnZlcikKCiAgICBkYXRhID0gaXRlcihbYidhJywgYidiJywgYidjJ10pCgogICAgd2l0aCBzZXJ2ZXIgYXMgKGhvc3QsIHBvcnQpOgogICAgICAgIGV4cGVjdGVkX2hvc3QgPSAne306e30nLmZvcm1hdChob3N0LCBwb3J0KQogICAgICAgIHVybCA9ICdodHRwOi8ve306e30vJy5mb3JtYXQoaG9zdCwgcG9ydCkKICAgICAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSwgc3RyZWFtPVRydWUpCiAgICAgICAgY2xvc2Vfc2VydmVyLnNldCgpICAjIHJlbGVhc2Ugc2VydmVyIGJsb2NrCgogICAgZXhwZWN0ZWRfaGVhZGVyID0gYidIb3N0OiAlc1xyXG4nICUgZXhwZWN0ZWRfaG9zdC5lbmNvZGUoJ3V0Zi04JykKICAgIGFzc2VydCBleHBlY3RlZF9oZWFkZXIgaW4gci5jb250ZW50CiAgICBhc3NlcnQgci5jb250ZW50LmNvdW50KGInSG9zdDogJykgPT0gMQoKCmRlZiB0ZXN0X2NvbmZsaWN0aW5nX2NvbnRlbnRfbGVuZ3RocygpOgogICAgIiIiRW5zdXJlIHdlIGNvcnJlY3RseSB0aHJvdyBhbiBJbnZhbGlkSGVhZGVyIGVycm9yIGlmIG11bHRpcGxlCiAgICBjb25mbGljdGluZyBDb250ZW50LUxlbmd0aCBoZWFkZXJzIGFyZSByZXR1cm5lZC4KICAgICIiIgoKICAgIGRlZiBtdWx0aXBsZV9jb250ZW50X2xlbmd0aF9yZXNwb25zZV9oYW5kbGVyKHNvY2spOgogICAgICAgIHJlcXVlc3RfY29udGVudCA9IGNvbnN1bWVfc29ja2V0X2NvbnRlbnQoc29jaywgdGltZW91dD0wLjUpCgogICAgICAgIHNvY2suc2VuZChiIkhUVFAvMS4xIDIwMCBPS1xyXG4iICsKICAgICAgICAgICAgICAgICAgYiJDb250ZW50LVR5cGU6IHRleHQvcGxhaW5cclxuIiArCiAgICAgICAgICAgICAgICAgIGIiQ29udGVudC1MZW5ndGg6IDE2XHJcbiIgKwogICAgICAgICAgICAgICAgICBiIkNvbnRlbnQtTGVuZ3RoOiAzMlxyXG5cclxuIiArCiAgICAgICAgICAgICAgICAgIGIiLS0gQmFkIEFjdG9yIC0tIE9yaWdpbmFsIENvbnRlbnRcclxuIikKCiAgICAgICAgcmV0dXJuIHJlcXVlc3RfY29udGVudAoKICAgIGNsb3NlX3NlcnZlciA9IHRocmVhZGluZy5FdmVudCgpCiAgICBzZXJ2ZXIgPSBTZXJ2ZXIobXVsdGlwbGVfY29udGVudF9sZW5ndGhfcmVzcG9uc2VfaGFuZGxlcikKCiAgICB3aXRoIHNlcnZlciBhcyAoaG9zdCwgcG9ydCk6CiAgICAgICAgdXJsID0gJ2h0dHA6Ly97fTp7fS8nLmZvcm1hdChob3N0LCBwb3J0KQogICAgICAgIHdpdGggcHl0ZXN0LnJhaXNlcyhyZXF1ZXN0cy5leGNlcHRpb25zLkludmFsaWRIZWFkZXIpOgogICAgICAgICAgICByID0gcmVxdWVzdHMuZ2V0KHVybCkKICAgICAgICBjbG9zZV9zZXJ2ZXIuc2V0KCkKCgpkZWYgdGVzdF9kaWdlc3RhdXRoXzQwMV9jb3VudF9yZXNldF9vbl9yZWRpcmVjdCgpOgogICAgIiIiRW5zdXJlIHdlIGNvcnJlY3RseSByZXNldCBudW1fNDAxX2NhbGxzIGFmdGVyIGEgc3VjY2Vzc2Z1bCBkaWdlc3QgYXV0aCwKICAgIGZvbGxvd2VkIGJ5IGEgMzAyIHJlZGlyZWN0IHRvIGFub3RoZXIgZGlnZXN0IGF1dGggcHJvbXB0LgoKICAgIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcHNmL3JlcXVlc3RzL2lzc3Vlcy8xOTc5LgogICAgIiIiCiAgICB0ZXh0XzQwMSA9IChiJ0hUVFAvMS4xIDQwMSBVTkFVVEhPUklaRURcclxuJwogICAgICAgICAgICAgICAgYidDb250ZW50LUxlbmd0aDogMFxyXG4nCiAgICAgICAgICAgICAgICBiJ1dXVy1BdXRoZW50aWNhdGU6IERpZ2VzdCBub25jZT0iNmJmNWQ2ZTRkYTFjZTY2OTE4ODAwMTk1ZDZiOTEzMGQiJwogICAgICAgICAgICAgICAgYicsIG9wYXF1ZT0iMzcyODI1MjkzZDFjMjY5NTU0OTZjODBlZDY0MjZlOWUiLCAnCiAgICAgICAgICAgICAgICBiJ3JlYWxtPSJtZUBrZW5uZXRocmVpdHouY29tIiwgcW9wPWF1dGhcclxuXHJcbicpCgogICAgdGV4dF8zMDIgPSAoYidIVFRQLzEuMSAzMDIgRk9VTkRcclxuJwogICAgICAgICAgICAgICAgYidDb250ZW50LUxlbmd0aDogMFxyXG4nCiAgICAgICAgICAgICAgICBiJ0xvY2F0aW9uOiAvXHJcblxyXG4nKQoKICAgIHRleHRfMjAwID0gKGInSFRUUC8xLjEgMjAwIE9LXHJcbicKICAgICAgICAgICAgICAgIGInQ29udGVudC1MZW5ndGg6IDBcclxuXHJcbicpCgogICAgZXhwZWN0ZWRfZGlnZXN0ID0gKGInQXV0aG9yaXphdGlvbjogRGlnZXN0IHVzZXJuYW1lPSJ1c2VyIiwgJwogICAgICAgICAgICAgICAgICAgICAgIGIncmVhbG09Im1lQGtlbm5ldGhyZWl0ei5jb20iLCAnCiAgICAgICAgICAgICAgICAgICAgICAgYidub25jZT0iNmJmNWQ2ZTRkYTFjZTY2OTE4ODAwMTk1ZDZiOTEzMGQiLCB1cmk9Ii8iJykKCiAgICBhdXRoID0gcmVxdWVzdHMuYXV0aC5IVFRQRGlnZXN0QXV0aCgndXNlcicsICdwYXNzJykKCiAgICBkZWYgZGlnZXN0X3Jlc3BvbnNlX2hhbmRsZXIoc29jayk6CiAgICAgICAgIyBSZXNwb25kIHRvIGluaXRpYWwgR0VUIHdpdGggYSBjaGFsbGVuZ2UuCiAgICAgICAgcmVxdWVzdF9jb250ZW50ID0gY29uc3VtZV9zb2NrZXRfY29udGVudChzb2NrLCB0aW1lb3V0PTAuNSkKICAgICAgICBhc3NlcnQgcmVxdWVzdF9jb250ZW50LnN0YXJ0c3dpdGgoYiJHRVQgLyBIVFRQLzEuMSIpCiAgICAgICAgc29jay5zZW5kKHRleHRfNDAxKQoKICAgICAgICAjIFZlcmlmeSB3ZSByZWNlaXZlIGFuIEF1dGhvcml6YXRpb24gaGVhZGVyIGluIHJlc3BvbnNlLCB0aGVuIHJlZGlyZWN0LgogICAgICAgIHJlcXVlc3RfY29udGVudCA9IGNvbnN1bWVfc29ja2V0X2NvbnRlbnQoc29jaywgdGltZW91dD0wLjUpCiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2RpZ2VzdCBpbiByZXF1ZXN0X2NvbnRlbnQKICAgICAgICBzb2NrLnNlbmQodGV4dF8zMDIpCgogICAgICAgICMgVmVyaWZ5IEF1dGhvcml6YXRpb24gaXNuJ3Qgc2VudCB0byB0aGUgcmVkaXJlY3RlZCBob3N0LAogICAgICAgICMgdGhlbiBzZW5kIGFub3RoZXIgY2hhbGxlbmdlLgogICAgICAgIHJlcXVlc3RfY29udGVudCA9IGNvbnN1bWVfc29ja2V0X2NvbnRlbnQoc29jaywgdGltZW91dD0wLjUpCiAgICAgICAgYXNzZXJ0IGInQXV0aG9yaXphdGlvbjonIG5vdCBpbiByZXF1ZXN0X2NvbnRlbnQKICAgICAgICBzb2NrLnNlbmQodGV4dF80MDEpCgogICAgICAgICMgVmVyaWZ5IEF1dGhvcml6YXRpb24gaXMgc2VudCBjb3JyZWN0bHkgYWdhaW4sIGFuZCByZXR1cm4gMjAwIE9LLgogICAgICAgIHJlcXVlc3RfY29udGVudCA9IGNvbnN1bWVfc29ja2V0X2NvbnRlbnQoc29jaywgdGltZW91dD0wLjUpCiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2RpZ2VzdCBpbiByZXF1ZXN0X2NvbnRlbnQKICAgICAgICBzb2NrLnNlbmQodGV4dF8yMDApCgogICAgICAgIHJldHVybiByZXF1ZXN0X2NvbnRlbnQKCiAgICBjbG9zZV9zZXJ2ZXIgPSB0aHJlYWRpbmcuRXZlbnQoKQogICAgc2VydmVyID0gU2VydmVyKGRpZ2VzdF9yZXNwb25zZV9oYW5kbGVyLCB3YWl0X3RvX2Nsb3NlX2V2ZW50PWNsb3NlX3NlcnZlcikKCiAgICB3aXRoIHNlcnZlciBhcyAoaG9zdCwgcG9ydCk6CiAgICAgICAgdXJsID0gJ2h0dHA6Ly97fTp7fS8nLmZvcm1hdChob3N0LCBwb3J0KQogICAgICAgIHIgPSByZXF1ZXN0cy5nZXQodXJsLCBhdXRoPWF1dGgpCiAgICAgICAgIyBWZXJpZnkgc2VydmVyIHN1Y2NlZWRlZCBpbiBhdXRoZW50aWNhdGluZy4KICAgICAgICBhc3NlcnQgci5zdGF0dXNfY29kZSA9PSAyMDAKICAgICAgICAjIFZlcmlmeSBBdXRob3JpemF0aW9uIHdhcyBzZW50IGluIGZpbmFsIHJlcXVlc3QuCiAgICAgICAgYXNzZXJ0ICdBdXRob3JpemF0aW9uJyBpbiByLnJlcXVlc3QuaGVhZGVycwogICAgICAgIGFzc2VydCByLnJlcXVlc3QuaGVhZGVyc1snQXV0aG9yaXphdGlvbiddLnN0YXJ0c3dpdGgoJ0RpZ2VzdCAnKQogICAgICAgICMgVmVyaWZ5IHJlZGlyZWN0IGhhcHBlbmVkIGFzIHdlIGV4cGVjdGVkLgogICAgICAgIGFzc2VydCByLmhpc3RvcnlbMF0uc3RhdHVzX2NvZGUgPT0gMzAyCiAgICAgICAgY2xvc2Vfc2VydmVyLnNldCgpCgoKZGVmIHRlc3RfZGlnZXN0YXV0aF80MDFfb25seV9zZW50X29uY2UoKToKICAgICIiIkVuc3VyZSB3ZSBjb3JyZWN0bHkgcmVzcG9uZCB0byBhIDQwMSBjaGFsbGVuZ2Ugb25jZSwgYW5kIHRoZW4KICAgIHN0b3AgcmVzcG9uZGluZyBpZiBjaGFsbGVuZ2VkIGFnYWluLgogICAgIiIiCiAgICB0ZXh0XzQwMSA9IChiJ0hUVFAvMS4xIDQwMSBVTkFVVEhPUklaRURcclxuJwogICAgICAgICAgICAgICAgYidDb250ZW50LUxlbmd0aDogMFxyXG4nCiAgICAgICAgICAgICAgICBiJ1dXVy1BdXRoZW50aWNhdGU6IERpZ2VzdCBub25jZT0iNmJmNWQ2ZTRkYTFjZTY2OTE4ODAwMTk1ZDZiOTEzMGQiJwogICAgICAgICAgICAgICAgYicsIG9wYXF1ZT0iMzcyODI1MjkzZDFjMjY5NTU0OTZjODBlZDY0MjZlOWUiLCAnCiAgICAgICAgICAgICAgICBiJ3JlYWxtPSJtZUBrZW5uZXRocmVpdHouY29tIiwgcW9wPWF1dGhcclxuXHJcbicpCgogICAgZXhwZWN0ZWRfZGlnZXN0ID0gKGInQXV0aG9yaXphdGlvbjogRGlnZXN0IHVzZXJuYW1lPSJ1c2VyIiwgJwogICAgICAgICAgICAgICAgICAgICAgIGIncmVhbG09Im1lQGtlbm5ldGhyZWl0ei5jb20iLCAnCiAgICAgICAgICAgICAgICAgICAgICAgYidub25jZT0iNmJmNWQ2ZTRkYTFjZTY2OTE4ODAwMTk1ZDZiOTEzMGQiLCB1cmk9Ii8iJykKCiAgICBhdXRoID0gcmVxdWVzdHMuYXV0aC5IVFRQRGlnZXN0QXV0aCgndXNlcicsICdwYXNzJykKCiAgICBkZWYgZGlnZXN0X2ZhaWxlZF9yZXNwb25zZV9oYW5kbGVyKHNvY2spOgogICAgICAgICMgUmVzcG9uZCB0byBpbml0aWFsIEdFVCB3aXRoIGEgY2hhbGxlbmdlLgogICAgICAgIHJlcXVlc3RfY29udGVudCA9IGNvbnN1bWVfc29ja2V0X2NvbnRlbnQoc29jaywgdGltZW91dD0wLjUpCiAgICAgICAgYXNzZXJ0IHJlcXVlc3RfY29udGVudC5zdGFydHN3aXRoKGIiR0VUIC8gSFRUUC8xLjEiKQogICAgICAgIHNvY2suc2VuZCh0ZXh0XzQwMSkKCiAgICAgICAgIyBWZXJpZnkgd2UgcmVjZWl2ZSBhbiBBdXRob3JpemF0aW9uIGhlYWRlciBpbiByZXNwb25zZSwgdGhlbgogICAgICAgICMgY2hhbGxlbmdlIGFnYWluLgogICAgICAgIHJlcXVlc3RfY29udGVudCA9IGNvbnN1bWVfc29ja2V0X2NvbnRlbnQoc29jaywgdGltZW91dD0wLjUpCiAgICAgICAgYXNzZXJ0IGV4cGVjdGVkX2RpZ2VzdCBpbiByZXF1ZXN0X2NvbnRlbnQKICAgICAgICBzb2NrLnNlbmQodGV4dF80MDEpCgogICAgICAgICMgVmVyaWZ5IHRoZSBjbGllbnQgZGlkbid0IHJlc3BvbmQgdG8gc2Vjb25kIGNoYWxsZW5nZS4KICAgICAgICByZXF1ZXN0X2NvbnRlbnQgPSBjb25zdW1lX3NvY2tldF9jb250ZW50KHNvY2ssIHRpbWVvdXQ9MC41KQogICAgICAgIGFzc2VydCByZXF1ZXN0X2NvbnRlbnQgPT0gYicnCgogICAgICAgIHJldHVybiByZXF1ZXN0X2NvbnRlbnQKCiAgICBjbG9zZV9zZXJ2ZXIgPSB0aHJlYWRpbmcuRXZlbnQoKQogICAgc2VydmVyID0gU2VydmVyKGRpZ2VzdF9mYWlsZWRfcmVzcG9uc2VfaGFuZGxlciwgd2FpdF90b19jbG9zZV9ldmVudD1jbG9zZV9zZXJ2ZXIpCgogICAgd2l0aCBzZXJ2ZXIgYXMgKGhvc3QsIHBvcnQpOgogICAgICAgIHVybCA9ICdodHRwOi8ve306e30vJy5mb3JtYXQoaG9zdCwgcG9ydCkKICAgICAgICByID0gcmVxdWVzdHMuZ2V0KHVybCwgYXV0aD1hdXRoKQogICAgICAgICMgVmVyaWZ5IHNlcnZlciBkaWRuJ3QgYXV0aGVudGljYXRlIHVzLgogICAgICAgIGFzc2VydCByLnN0YXR1c19jb2RlID09IDQwMQogICAgICAgIGFzc2VydCByLmhpc3RvcnlbMF0uc3RhdHVzX2NvZGUgPT0gNDAxCiAgICAgICAgY2xvc2Vfc2VydmVyLnNldCgpCgoKZGVmIHRlc3RfZGlnZXN0YXV0aF9vbmx5X29uXzR4eCgpOgogICAgIiIiRW5zdXJlIHdlIG9ubHkgc2VuZCBkaWdlc3RhdXRoIG9uIDR4eCBjaGFsbGVuZ2VzLgoKICAgIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcHNmL3JlcXVlc3RzL2lzc3Vlcy8zNzcyLgogICAgIiIiCiAgICB0ZXh0XzIwMF9jaGFsID0gKGInSFRUUC8xLjEgMjAwIE9LXHJcbicKICAgICAgICAgICAgICAgICAgICAgYidDb250ZW50LUxlbmd0aDogMFxyXG4nCiAgICAgICAgICAgICAgICAgICAgIGInV1dXLUF1dGhlbnRpY2F0ZTogRGlnZXN0IG5vbmNlPSI2YmY1ZDZlNGRhMWNlNjY5MTg4MDAxOTVkNmI5MTMwZCInCiAgICAgICAgICAgICAgICAgICAgIGInLCBvcGFxdWU9IjM3MjgyNTI5M2QxYzI2OTU1NDk2YzgwZWQ2NDI2ZTllIiwgJwogICAgICAgICAgICAgICAgICAgICBiJ3JlYWxtPSJtZUBrZW5uZXRocmVpdHouY29tIiwgcW9wPWF1dGhcclxuXHJcbicpCgogICAgYXV0aCA9IHJlcXVlc3RzLmF1dGguSFRUUERpZ2VzdEF1dGgoJ3VzZXInLCAncGFzcycpCgogICAgZGVmIGRpZ2VzdF9yZXNwb25zZV9oYW5kbGVyKHNvY2spOgogICAgICAgICMgUmVzcG9uZCB0byBHRVQgd2l0aCBhIDIwMCBjb250YWluaW5nIHd3dy1hdXRoZW50aWNhdGUgaGVhZGVyLgogICAgICAgIHJlcXVlc3RfY29udGVudCA9IGNvbnN1bWVfc29ja2V0X2NvbnRlbnQoc29jaywgdGltZW91dD0wLjUpCiAgICAgICAgYXNzZXJ0IHJlcXVlc3RfY29udGVudC5zdGFydHN3aXRoKGIiR0VUIC8gSFRUUC8xLjEiKQogICAgICAgIHNvY2suc2VuZCh0ZXh0XzIwMF9jaGFsKQoKICAgICAgICAjIFZlcmlmeSB0aGUgY2xpZW50IGRpZG4ndCByZXNwb25kIHdpdGggYXV0aC4KICAgICAgICByZXF1ZXN0X2NvbnRlbnQgPSBjb25zdW1lX3NvY2tldF9jb250ZW50KHNvY2ssIHRpbWVvdXQ9MC41KQogICAgICAgIGFzc2VydCByZXF1ZXN0X2NvbnRlbnQgPT0gYicnCgogICAgICAgIHJldHVybiByZXF1ZXN0X2NvbnRlbnQKCiAgICBjbG9zZV9zZXJ2ZXIgPSB0aHJlYWRpbmcuRXZlbnQoKQogICAgc2VydmVyID0gU2VydmVyKGRpZ2VzdF9yZXNwb25zZV9oYW5kbGVyLCB3YWl0X3RvX2Nsb3NlX2V2ZW50PWNsb3NlX3NlcnZlcikKCiAgICB3aXRoIHNlcnZlciBhcyAoaG9zdCwgcG9ydCk6CiAgICAgICAgdXJsID0gJ2h0dHA6Ly97fTp7fS8nLmZvcm1hdChob3N0LCBwb3J0KQogICAgICAgIHIgPSByZXF1ZXN0cy5nZXQodXJsLCBhdXRoPWF1dGgpCiAgICAgICAgIyBWZXJpZnkgc2VydmVyIGRpZG4ndCByZWNlaXZlIGF1dGggZnJvbSB1cy4KICAgICAgICBhc3NlcnQgci5zdGF0dXNfY29kZSA9PSAyMDAKICAgICAgICBhc3NlcnQgbGVuKHIuaGlzdG9yeSkgPT0gMAogICAgICAgIGNsb3NlX3NlcnZlci5zZXQoKQoKCl9zY2hlbWVzX2J5X3Zhcl9wcmVmaXggPSBbCiAgICAoJ2h0dHAnLCBbJ2h0dHAnXSksCiAgICAoJ2h0dHBzJywgWydodHRwcyddKSwKICAgICgnYWxsJywgWydodHRwJywgJ2h0dHBzJ10pLApdCgpfcHJveHlfY29tYm9zID0gW10KZm9yIHByZWZpeCwgc2NoZW1lcyBpbiBfc2NoZW1lc19ieV92YXJfcHJlZml4OgogICAgZm9yIHNjaGVtZSBpbiBzY2hlbWVzOgogICAgICAgIF9wcm94eV9jb21ib3MuYXBwZW5kKCgie31fcHJveHkiLmZvcm1hdChwcmVmaXgpLCBzY2hlbWUpKQoKX3Byb3h5X2NvbWJvcyArPSBbKHZhci51cHBlcigpLCBzY2hlbWUpIGZvciB2YXIsIHNjaGVtZSBpbiBfcHJveHlfY29tYm9zXQoKCkBweXRlc3QubWFyay5wYXJhbWV0cml6ZSgidmFyLHNjaGVtZSIsIF9wcm94eV9jb21ib3MpCmRlZiB0ZXN0X3VzZV9wcm94eV9mcm9tX2Vudmlyb25tZW50KGh0dHBiaW4sIHZhciwgc2NoZW1lKToKICAgIHVybCA9ICJ7fTovL2h0dHBiaW4ub3JnIi5mb3JtYXQoc2NoZW1lKQogICAgZmFrZV9wcm94eSA9IFNlcnZlcigpICAjIGRvIG5vdGhpbmcgd2l0aCB0aGUgcmVxdWVzdHM7IGp1c3QgY2xvc2UgdGhlIHNvY2tldAogICAgd2l0aCBmYWtlX3Byb3h5IGFzIChob3N0LCBwb3J0KToKICAgICAgICBwcm94eV91cmwgPSAic29ja3M1Oi8ve306e30iLmZvcm1hdChob3N0LCBwb3J0KQogICAgICAgIGt3YXJncyA9IHt2YXI6IHByb3h5X3VybH0KICAgICAgICB3aXRoIG92ZXJyaWRlX2Vudmlyb24oKiprd2FyZ3MpOgogICAgICAgICAgICAjIGZha2UgcHJveHkncyBsYWNrIG9mIHJlc3BvbnNlIHdpbGwgY2F1c2UgYSBDb25uZWN0aW9uRXJyb3IKICAgICAgICAgICAgd2l0aCBweXRlc3QucmFpc2VzKHJlcXVlc3RzLmV4Y2VwdGlvbnMuQ29ubmVjdGlvbkVycm9yKToKICAgICAgICAgICAgICAgIHJlcXVlc3RzLmdldCh1cmwpCgogICAgICAgICMgdGhlIGZha2UgcHJveHkgcmVjZWl2ZWQgYSByZXF1ZXN0CiAgICAgICAgYXNzZXJ0IGxlbihmYWtlX3Byb3h5LmhhbmRsZXJfcmVzdWx0cykgPT0gMQoKICAgICAgICAjIGl0IGhhZCBhY3R1YWwgY29udGVudCAobm90IGNoZWNraW5nIGZvciBTT0NLUyBwcm90b2NvbCBmb3Igbm93KQogICAgICAgIGFzc2VydCBsZW4oZmFrZV9wcm94eS5oYW5kbGVyX3Jlc3VsdHNbMF0pID4gMAoKCmRlZiB0ZXN0X3JlZGlyZWN0X3JmYzE4MDhfdG9fbm9uX2FzY2lpX2xvY2F0aW9uKCk6CiAgICBwYXRoID0gdSfFoScKICAgIGV4cGVjdGVkX3BhdGggPSBiJyVDNSVBMScKICAgIHJlZGlyZWN0X3JlcXVlc3QgPSBbXSAgIyBzdG9yZXMgdGhlIHNlY29uZCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIKCiAgICBkZWYgcmVkaXJlY3RfcmVzcF9oYW5kbGVyKHNvY2spOgogICAgICAgIGNvbnN1bWVfc29ja2V0X2NvbnRlbnQoc29jaywgdGltZW91dD0wLjUpCiAgICAgICAgbG9jYXRpb24gPSB1Jy8ve306e30ve30nLmZvcm1hdChob3N0LCBwb3J0LCBwYXRoKQogICAgICAgIHNvY2suc2VuZCgKICAgICAgICAgICAgYidIVFRQLzEuMSAzMDEgTW92ZWQgUGVybWFuZW50bHlcclxuJwogICAgICAgICAgICBiJ0NvbnRlbnQtTGVuZ3RoOiAwXHJcbicKICAgICAgICAgICAgYidMb2NhdGlvbjogJyArIGxvY2F0aW9uLmVuY29kZSgndXRmOCcpICsgYidcclxuJwogICAgICAgICAgICBiJ1xyXG4nCiAgICAgICAgKQogICAgICAgIHJlZGlyZWN0X3JlcXVlc3QuYXBwZW5kKGNvbnN1bWVfc29ja2V0X2NvbnRlbnQoc29jaywgdGltZW91dD0wLjUpKQogICAgICAgIHNvY2suc2VuZChiJ0hUVFAvMS4xIDIwMCBPS1xyXG5cclxuJykKCiAgICBjbG9zZV9zZXJ2ZXIgPSB0aHJlYWRpbmcuRXZlbnQoKQogICAgc2VydmVyID0gU2VydmVyKHJlZGlyZWN0X3Jlc3BfaGFuZGxlciwgd2FpdF90b19jbG9zZV9ldmVudD1jbG9zZV9zZXJ2ZXIpCgogICAgd2l0aCBzZXJ2ZXIgYXMgKGhvc3QsIHBvcnQpOgogICAgICAgIHVybCA9IHUnaHR0cDovL3t9Ont9Jy5mb3JtYXQoaG9zdCwgcG9ydCkKICAgICAgICByID0gcmVxdWVzdHMuZ2V0KHVybD11cmwsIGFsbG93X3JlZGlyZWN0cz1UcnVlKQogICAgICAgIGFzc2VydCByLnN0YXR1c19jb2RlID09IDIwMAogICAgICAgIGFzc2VydCBsZW4oci5oaXN0b3J5KSA9PSAxCiAgICAgICAgYXNzZXJ0IHIuaGlzdG9yeVswXS5zdGF0dXNfY29kZSA9PSAzMDEKICAgICAgICBhc3NlcnQgcmVkaXJlY3RfcmVxdWVzdFswXS5zdGFydHN3aXRoKGInR0VUIC8nICsgZXhwZWN0ZWRfcGF0aCArIGInIEhUVFAvMS4xJykKICAgICAgICBhc3NlcnQgci51cmwgPT0gdSd7fS97fScuZm9ybWF0KHVybCwgZXhwZWN0ZWRfcGF0aC5kZWNvZGUoJ2FzY2lpJykpCgogICAgICAgIGNsb3NlX3NlcnZlci5zZXQoKQoKZGVmIHRlc3RfZnJhZ21lbnRfbm90X3NlbnRfd2l0aF9yZXF1ZXN0KCk6CiAgICAiIiJWZXJpZnkgdGhhdCB0aGUgZnJhZ21lbnQgcG9ydGlvbiBvZiBhIFVSSSBpc24ndCBzZW50IHRvIHRoZSBzZXJ2ZXIuIiIiCiAgICBkZWYgcmVzcG9uc2VfaGFuZGxlcihzb2NrKToKICAgICAgICByZXEgPSBjb25zdW1lX3NvY2tldF9jb250ZW50KHNvY2ssIHRpbWVvdXQ9MC41KQogICAgICAgIHNvY2suc2VuZCgKICAgICAgICAgICAgYidIVFRQLzEuMSAyMDAgT0tcclxuJwogICAgICAgICAgICBiJ0NvbnRlbnQtTGVuZ3RoOiAnK2J5dGVzKGxlbihyZXEpKStiJ1xyXG4nCiAgICAgICAgICAgIGInXHJcbicrcmVxCiAgICAgICAgKQoKICAgIGNsb3NlX3NlcnZlciA9IHRocmVhZGluZy5FdmVudCgpCiAgICBzZXJ2ZXIgPSBTZXJ2ZXIocmVzcG9uc2VfaGFuZGxlciwgd2FpdF90b19jbG9zZV9ldmVudD1jbG9zZV9zZXJ2ZXIpCgogICAgd2l0aCBzZXJ2ZXIgYXMgKGhvc3QsIHBvcnQpOgogICAgICAgIHVybCA9ICdodHRwOi8ve306e30vcGF0aC90by90aGluZy8jdmlldz1lZGl0JnRva2VuPWh1bnRlcjInLmZvcm1hdChob3N0LCBwb3J0KQogICAgICAgIHIgPSByZXF1ZXN0cy5nZXQodXJsKQogICAgICAgIHJhd19yZXF1ZXN0ID0gci5jb250ZW50CgogICAgICAgIGFzc2VydCByLnN0YXR1c19jb2RlID09IDIwMAogICAgICAgIGhlYWRlcnMsIGJvZHkgPSByYXdfcmVxdWVzdC5zcGxpdChiJ1xyXG5cclxuJywgMSkKICAgICAgICBzdGF0dXNfbGluZSwgaGVhZGVycyA9IGhlYWRlcnMuc3BsaXQoYidcclxuJywgMSkKCiAgICAgICAgYXNzZXJ0IHN0YXR1c19saW5lID09IGInR0VUIC9wYXRoL3RvL3RoaW5nLyBIVFRQLzEuMScKICAgICAgICBmb3IgZnJhZyBpbiAoYid2aWV3JywgYidlZGl0JywgYid0b2tlbicsIGInaHVudGVyMicpOgogICAgICAgICAgICBhc3NlcnQgZnJhZyBub3QgaW4gaGVhZGVycwogICAgICAgICAgICBhc3NlcnQgZnJhZyBub3QgaW4gYm9keQoKICAgICAgICBjbG9zZV9zZXJ2ZXIuc2V0KCkKCmRlZiB0ZXN0X2ZyYWdtZW50X3VwZGF0ZV9vbl9yZWRpcmVjdCgpOgogICAgIiIiVmVyaWZ5IHdlIG9ubHkgYXBwZW5kIHByZXZpb3VzIGZyYWdtZW50IGlmIG9uZSBkb2Vzbid0IGV4aXN0IG9uIG5ldwogICAgbG9jYXRpb24uIElmIGEgbmV3IGZyYWdtZW50IGlzIGVuY291bnRlcmVkIGluIGEgTG9jYXRpb24gaGVhZGVyLCBpdCBzaG91bGQKICAgIGJlIGFkZGVkIHRvIGFsbCBzdWJzZXF1ZW50IHJlcXVlc3RzLgogICAgIiIiCgogICAgZGVmIHJlc3BvbnNlX2hhbmRsZXIoc29jayk6CiAgICAgICAgY29uc3VtZV9zb2NrZXRfY29udGVudChzb2NrLCB0aW1lb3V0PTAuNSkKICAgICAgICBzb2NrLnNlbmQoCiAgICAgICAgICAgIGInSFRUUC8xLjEgMzAyIEZPVU5EXHJcbicKICAgICAgICAgICAgYidDb250ZW50LUxlbmd0aDogMFxyXG4nCiAgICAgICAgICAgIGInTG9jYXRpb246IC9nZXQjcmVsZXZhbnQtc2VjdGlvblxyXG5cclxuJwogICAgICAgICkKICAgICAgICBjb25zdW1lX3NvY2tldF9jb250ZW50KHNvY2ssIHRpbWVvdXQ9MC41KQogICAgICAgIHNvY2suc2VuZCgKICAgICAgICAgICAgYidIVFRQLzEuMSAzMDIgRk9VTkRcclxuJwogICAgICAgICAgICBiJ0NvbnRlbnQtTGVuZ3RoOiAwXHJcbicKICAgICAgICAgICAgYidMb2NhdGlvbjogL2ZpbmFsLXVybC9cclxuXHJcbicKICAgICAgICApCiAgICAgICAgY29uc3VtZV9zb2NrZXRfY29udGVudChzb2NrLCB0aW1lb3V0PTAuNSkKICAgICAgICBzb2NrLnNlbmQoCiAgICAgICAgICAgIGInSFRUUC8xLjEgMjAwIE9LXHJcblxyXG4nCiAgICAgICAgKQoKICAgIGNsb3NlX3NlcnZlciA9IHRocmVhZGluZy5FdmVudCgpCiAgICBzZXJ2ZXIgPSBTZXJ2ZXIocmVzcG9uc2VfaGFuZGxlciwgd2FpdF90b19jbG9zZV9ldmVudD1jbG9zZV9zZXJ2ZXIpCgogICAgd2l0aCBzZXJ2ZXIgYXMgKGhvc3QsIHBvcnQpOgogICAgICAgIHVybCA9ICdodHRwOi8ve306e30vcGF0aC90by90aGluZy8jdmlldz1lZGl0JnRva2VuPWh1bnRlcjInLmZvcm1hdChob3N0LCBwb3J0KQogICAgICAgIHIgPSByZXF1ZXN0cy5nZXQodXJsKQogICAgICAgIHJhd19yZXF1ZXN0ID0gci5jb250ZW50CgogICAgICAgIGFzc2VydCByLnN0YXR1c19jb2RlID09IDIwMAogICAgICAgIGFzc2VydCBsZW4oci5oaXN0b3J5KSA9PSAyCiAgICAgICAgYXNzZXJ0IHIuaGlzdG9yeVswXS5yZXF1ZXN0LnVybCA9PSB1cmwKCiAgICAgICAgIyBWZXJpZnkgd2UgaGF2ZW4ndCBvdmVyd3JpdHRlbiB0aGUgbG9jYXRpb24gd2l0aCBvdXIgcHJldmlvdXMgZnJhZ21lbnQuCiAgICAgICAgYXNzZXJ0IHIuaGlzdG9yeVsxXS5yZXF1ZXN0LnVybCA9PSAnaHR0cDovL3t9Ont9L2dldCNyZWxldmFudC1zZWN0aW9uJy5mb3JtYXQoaG9zdCwgcG9ydCkKICAgICAgICAjIFZlcmlmeSBwcmV2aW91cyBmcmFnbWVudCBpcyB1c2VkIGFuZCBub3QgdGhlIG9yaWdpbmFsLgogICAgICAgIGFzc2VydCByLnVybCA9PSAnaHR0cDovL3t9Ont9L2ZpbmFsLXVybC8jcmVsZXZhbnQtc2VjdGlvbicuZm9ybWF0KGhvc3QsIHBvcnQpCgogICAgICAgIGNsb3NlX3NlcnZlci5zZXQoKQo=
