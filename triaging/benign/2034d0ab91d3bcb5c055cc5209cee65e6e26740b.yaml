statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/urlib3/1.21.1/urlib3-1.21.1/urlib3-1.21.1/test/test_response.py
  contents:
  - name: TestResponse.test_io
    score: 0.0
    code: |-
      def test_io(self):
              fp = BytesIO(b'foo')
              resp = HTTPResponse(fp, preload_content=False)

              self.assertEqual(resp.closed, False)
              self.assertEqual(resp.readable(), True)
              self.assertEqual(resp.writable(), False)
              self.assertRaises(IOError, resp.fileno)

              resp.close()
              self.assertEqual(resp.closed, True)

              # Try closing with an `httplib.HTTPResponse`, because it has an
              # `isclosed` method.
              hlr = httplib.HTTPResponse(socket.socket())
              resp2 = HTTPResponse(hlr, preload_content=False)
              self.assertEqual(resp2.closed, False)
              resp2.close()
              self.assertEqual(resp2.closed, True)

              # also try when only data is present.
              resp3 = HTTPResponse('foodata')
              self.assertRaises(IOError, resp3.fileno)

              resp3._fp = 2
              # A corner case where _fp is present but doesn't have `closed`,
              # `isclosed`, or `fileno`.  Unlikely, but possible.
              self.assertEqual(resp3.closed, True)
              self.assertRaises(IOError, resp3.fileno)
    tokens: resume load_global BytesIO load_const call store_fast fp load_global HTTPResponse load_fast fp load_const INTEGER kw_names preload_content call store_fast resp load_fast self load_attr assertEqual load_fast resp load_attr closed load_const INTEGER call pop_top load_fast self load_attr assertEqual load_fast resp load_attr readable call load_const INTEGER call pop_top load_fast self load_attr assertEqual load_fast resp load_attr writable call load_const INTEGER call pop_top load_fast self load_attr assertRaises load_global IOError load_fast resp load_attr fileno call pop_top load_fast resp load_attr close call pop_top load_fast self load_attr assertEqual load_fast resp load_attr closed load_const INTEGER call pop_top load_global httplib load_attr HTTPResponse load_global socket load_attr socket call call store_fast hlr load_global HTTPResponse load_fast hlr load_const INTEGER kw_names preload_content call store_fast resp2 load_fast self load_attr assertEqual load_fast resp2 load_attr closed load_const INTEGER call pop_top load_fast resp2 load_attr close call pop_top load_fast self load_attr assertEqual load_fast resp2 load_attr closed load_const INTEGER call pop_top load_global HTTPResponse load_const foodata call store_fast resp3 load_fast self load_attr assertRaises load_global IOError load_fast resp3 load_attr fileno call pop_top load_const INTEGER load_fast resp3 store_attr _fp load_fast self load_attr assertEqual load_fast resp3 load_attr closed load_const INTEGER call pop_top load_fast self load_attr assertRaises load_global IOError load_fast resp3 load_attr fileno call pop_top return_const None
    hash: c5c2912571e38a5a33b367d2e74b329ce77cd6e496d8d4f62250e6fc99eaa939
sources:
  .repo_cache/malicious_repos/pypi_malregistry/urlib3/1.21.1/urlib3-1.21.1/urlib3-1.21.1/test/test_response.py: aW1wb3J0IHNvY2tldAppbXBvcnQgc3lzCgpmcm9tIGlvIGltcG9ydCBCeXRlc0lPLCBCdWZmZXJlZFJlYWRlcgoKZnJvbSB1cmxsaWIzLnJlc3BvbnNlIGltcG9ydCBIVFRQUmVzcG9uc2UKZnJvbSB1cmxsaWIzLmV4Y2VwdGlvbnMgaW1wb3J0ICgKICAgIERlY29kZUVycm9yLCBSZXNwb25zZU5vdENodW5rZWQsIFByb3RvY29sRXJyb3IsIEludmFsaWRIZWFkZXIKKQpmcm9tIHVybGxpYjMucGFja2FnZXMuc2l4Lm1vdmVzIGltcG9ydCBodHRwX2NsaWVudCBhcyBodHRwbGliCmZyb20gdXJsbGliMy51dGlsLnJldHJ5IGltcG9ydCBSZXRyeQpmcm9tIHVybGxpYjMudXRpbC5yZXNwb25zZSBpbXBvcnQgaXNfZnBfY2xvc2VkCgpmcm9tIGJhc2U2NCBpbXBvcnQgYjY0ZGVjb2RlCgppZiBzeXMudmVyc2lvbl9pbmZvID49ICgyLCA3KToKICAgIGltcG9ydCB1bml0dGVzdAplbHNlOgogICAgaW1wb3J0IHVuaXR0ZXN0MiBhcyB1bml0dGVzdAoKIyBBIGtub3duIHJhbmRvbSAoaS5lLCBub3QtdG9vLWNvbXByZXNzaWJsZSkgcGF5bG9hZCBnZW5lcmF0ZWQgd2l0aDoKIyAgICAiIi5qb2luKHJhbmRvbS5jaG9pY2Uoc3RyaW5nLnByaW50YWJsZSkgZm9yIGkgaW4geHJhbmdlKDUxMikpCiMgICAgLmVuY29kZSgiemxpYiIpLmVuY29kZSgiYmFzZTY0IikKIyBSYW5kb21uZXNzIGluIHRlc3RzID09IGJhZCwgYW5kIGZpeGluZyBhIHNlZWQgbWF5IG5vdCBiZSBzdWZmaWNpZW50LgpaTElCX1BBWUxPQUQgPSBiNjRkZWNvZGUoYiIiIlwKZUp3RndldWFvUUFBQU5EZmluZVFoaUtMVWlhaUN6dnVURW1OTmxKR2lMNVFobkdwWjk5ejhsdVFmZTFBSG9NaW9CK1FTV0hRdS9MKwpsemQ3VzVDaXBxWW1lVlRCamRnU0FUZGc0bDRaMnpoaWtidUYrRUtuNjlRMERUcGRtTkp6OFMzM29kZkpvVkVleHcvbDJTUzluRmRpCnBpczdLT3dYemZTcWFyU285dUpZZ2JER3JzMVZOblFwVDlmOHpBb3JoWUNFWnJvblpRRjlEdURGZk5LM0hlY2MrV0hMblpMUXB0d2sKbnVmdzhTOUk0M3NFd3hzVDcxQmlxZWRIbzBRZUlyRkUwMUYvNGF0VkZYdUpzMnl4SU9hazNidnRYalVLQUE2T0tuUUovbk52REdLWgpLaGU1VEYzNkpibktWamRjTDFFVU5wd3JXVmZRcEZZSi9XV20yYjc0cU5lU1plUXY1L3hCaFJkT21LVEpGWWdPOTZQd3JIQmxzbkxuCmEzbDBMd0pzbG9XcE1iekJ5VTVXTGJSRTZYNUlORnFqUU90SXdZejVCQWxoa24ra1ZxSnZXTTV2QmxmcndQNDJpZm9uTTV5RjRjaUoKYXVIVmtzNjI5OTdtTkdPc003V1hORzNQOThkQkhQbzJOaGJUdkhsZUwwQkk1ZHVzMkpZODFNVU9uSzNTR1dMSDhIZVdQYTF0NUtjVwpTNW1vQWo1SGV4WS9nL0Y4VGN0cHh3c3Z5WnAzOGRYZUxEalNRdkVRSWtGN1hSM1lYYmVaZ0trM1YzNEtHQ1BPQWVldVFESWd5VmhWCm5QNEhGMnVXSEE9PSIiIikKCgpjbGFzcyBUZXN0TGVnYWN5UmVzcG9uc2UodW5pdHRlc3QuVGVzdENhc2UpOgogICAgZGVmIHRlc3RfZ2V0aGVhZGVycyhzZWxmKToKICAgICAgICBoZWFkZXJzID0geydob3N0JzogJ2V4YW1wbGUuY29tJ30KICAgICAgICByID0gSFRUUFJlc3BvbnNlKGhlYWRlcnM9aGVhZGVycykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIuZ2V0aGVhZGVycygpLCBoZWFkZXJzKQoKICAgIGRlZiB0ZXN0X2dldGhlYWRlcihzZWxmKToKICAgICAgICBoZWFkZXJzID0geydob3N0JzogJ2V4YW1wbGUuY29tJ30KICAgICAgICByID0gSFRUUFJlc3BvbnNlKGhlYWRlcnM9aGVhZGVycykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIuZ2V0aGVhZGVyKCdob3N0JyksICdleGFtcGxlLmNvbScpCgoKY2xhc3MgVGVzdFJlc3BvbnNlKHVuaXR0ZXN0LlRlc3RDYXNlKToKICAgIGRlZiB0ZXN0X2NhY2hlX2NvbnRlbnQoc2VsZik6CiAgICAgICAgciA9IEhUVFBSZXNwb25zZSgnZm9vJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIuZGF0YSwgJ2ZvbycpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLl9ib2R5LCAnZm9vJykKCiAgICBkZWYgdGVzdF9kZWZhdWx0KHNlbGYpOgogICAgICAgIHIgPSBIVFRQUmVzcG9uc2UoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoci5kYXRhLCBOb25lKQoKICAgIGRlZiB0ZXN0X25vbmUoc2VsZik6CiAgICAgICAgciA9IEhUVFBSZXNwb25zZShOb25lKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoci5kYXRhLCBOb25lKQoKICAgIGRlZiB0ZXN0X3ByZWxvYWQoc2VsZik6CiAgICAgICAgZnAgPSBCeXRlc0lPKGInZm9vJykKCiAgICAgICAgciA9IEhUVFBSZXNwb25zZShmcCwgcHJlbG9hZF9jb250ZW50PVRydWUpCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoZnAudGVsbCgpLCBsZW4oYidmb28nKSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIuZGF0YSwgYidmb28nKQoKICAgIGRlZiB0ZXN0X25vX3ByZWxvYWQoc2VsZik6CiAgICAgICAgZnAgPSBCeXRlc0lPKGInZm9vJykKCiAgICAgICAgciA9IEhUVFBSZXNwb25zZShmcCwgcHJlbG9hZF9jb250ZW50PUZhbHNlKQoKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKGZwLnRlbGwoKSwgMCkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIuZGF0YSwgYidmb28nKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoZnAudGVsbCgpLCBsZW4oYidmb28nKSkKCiAgICBkZWYgdGVzdF9kZWNvZGVfYmFkX2RhdGEoc2VsZik6CiAgICAgICAgZnAgPSBCeXRlc0lPKGInXHgwMCcgKiAxMCkKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhEZWNvZGVFcnJvciwgSFRUUFJlc3BvbnNlLCBmcCwgaGVhZGVycz17CiAgICAgICAgICAgICdjb250ZW50LWVuY29kaW5nJzogJ2RlZmxhdGUnCiAgICAgICAgfSkKCiAgICBkZWYgdGVzdF9yZWZlcmVuY2VfcmVhZChzZWxmKToKICAgICAgICBmcCA9IEJ5dGVzSU8oYidmb28nKQogICAgICAgIHIgPSBIVFRQUmVzcG9uc2UoZnAsIHByZWxvYWRfY29udGVudD1GYWxzZSkKCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLnJlYWQoMSksIGInZicpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLnJlYWQoMiksIGInb28nKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoci5yZWFkKCksIGInJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIucmVhZCgpLCBiJycpCgogICAgZGVmIHRlc3RfZGVjb2RlX2RlZmxhdGUoc2VsZik6CiAgICAgICAgaW1wb3J0IHpsaWIKICAgICAgICBkYXRhID0gemxpYi5jb21wcmVzcyhiJ2ZvbycpCgogICAgICAgIGZwID0gQnl0ZXNJTyhkYXRhKQogICAgICAgIHIgPSBIVFRQUmVzcG9uc2UoZnAsIGhlYWRlcnM9eydjb250ZW50LWVuY29kaW5nJzogJ2RlZmxhdGUnfSkKCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLmRhdGEsIGInZm9vJykKCiAgICBkZWYgdGVzdF9kZWNvZGVfZGVmbGF0ZV9jYXNlX2luc2Vuc2l0dmUoc2VsZik6CiAgICAgICAgaW1wb3J0IHpsaWIKICAgICAgICBkYXRhID0gemxpYi5jb21wcmVzcyhiJ2ZvbycpCgogICAgICAgIGZwID0gQnl0ZXNJTyhkYXRhKQogICAgICAgIHIgPSBIVFRQUmVzcG9uc2UoZnAsIGhlYWRlcnM9eydjb250ZW50LWVuY29kaW5nJzogJ0RlRmxBdEUnfSkKCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLmRhdGEsIGInZm9vJykKCiAgICBkZWYgdGVzdF9jaHVua2VkX2RlY29kaW5nX2RlZmxhdGUoc2VsZik6CiAgICAgICAgaW1wb3J0IHpsaWIKICAgICAgICBkYXRhID0gemxpYi5jb21wcmVzcyhiJ2ZvbycpCgogICAgICAgIGZwID0gQnl0ZXNJTyhkYXRhKQogICAgICAgIHIgPSBIVFRQUmVzcG9uc2UoZnAsIGhlYWRlcnM9eydjb250ZW50LWVuY29kaW5nJzogJ2RlZmxhdGUnfSwKICAgICAgICAgICAgICAgICAgICAgICAgIHByZWxvYWRfY29udGVudD1GYWxzZSkKCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLnJlYWQoMyksIGInJykKICAgICAgICAjIEJ1ZmZlciBpbiBjYXNlIHdlIG5lZWQgdG8gc3dpdGNoIHRvIHRoZSByYXcgc3RyZWFtCiAgICAgICAgc2VsZi5hc3NlcnRJc05vdE5vbmUoci5fZGVjb2Rlci5fZGF0YSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIucmVhZCgxKSwgYidmJykKICAgICAgICAjIE5vdyB0aGF0IHdlJ3ZlIGRlY29kZWQgZGF0YSwgd2UganVzdCBzdHJlYW0gdGhyb3VnaCB0aGUgZGVjb2RlcgogICAgICAgIHNlbGYuYXNzZXJ0SXNOb25lKHIuX2RlY29kZXIuX2RhdGEpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLnJlYWQoMiksIGInb28nKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoci5yZWFkKCksIGInJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIucmVhZCgpLCBiJycpCgogICAgZGVmIHRlc3RfY2h1bmtlZF9kZWNvZGluZ19kZWZsYXRlMihzZWxmKToKICAgICAgICBpbXBvcnQgemxpYgogICAgICAgIGNvbXByZXNzID0gemxpYi5jb21wcmVzc29iaig2LCB6bGliLkRFRkxBVEVELCAtemxpYi5NQVhfV0JJVFMpCiAgICAgICAgZGF0YSA9IGNvbXByZXNzLmNvbXByZXNzKGInZm9vJykKICAgICAgICBkYXRhICs9IGNvbXByZXNzLmZsdXNoKCkKCiAgICAgICAgZnAgPSBCeXRlc0lPKGRhdGEpCiAgICAgICAgciA9IEhUVFBSZXNwb25zZShmcCwgaGVhZGVycz17J2NvbnRlbnQtZW5jb2RpbmcnOiAnZGVmbGF0ZSd9LAogICAgICAgICAgICAgICAgICAgICAgICAgcHJlbG9hZF9jb250ZW50PUZhbHNlKQoKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIucmVhZCgxKSwgYicnKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoci5yZWFkKDEpLCBiJ2YnKQogICAgICAgICMgT25jZSB3ZSd2ZSBkZWNvZGVkIGRhdGEsIHdlIGp1c3Qgc3RyZWFtIHRvIHRoZSBkZWNvZGVyOyBubyBidWZmZXJpbmcKICAgICAgICBzZWxmLmFzc2VydElzTm9uZShyLl9kZWNvZGVyLl9kYXRhKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoci5yZWFkKDIpLCBiJ29vJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIucmVhZCgpLCBiJycpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLnJlYWQoKSwgYicnKQoKICAgIGRlZiB0ZXN0X2NodW5rZWRfZGVjb2RpbmdfZ3ppcChzZWxmKToKICAgICAgICBpbXBvcnQgemxpYgogICAgICAgIGNvbXByZXNzID0gemxpYi5jb21wcmVzc29iaig2LCB6bGliLkRFRkxBVEVELCAxNiArIHpsaWIuTUFYX1dCSVRTKQogICAgICAgIGRhdGEgPSBjb21wcmVzcy5jb21wcmVzcyhiJ2ZvbycpCiAgICAgICAgZGF0YSArPSBjb21wcmVzcy5mbHVzaCgpCgogICAgICAgIGZwID0gQnl0ZXNJTyhkYXRhKQogICAgICAgIHIgPSBIVFRQUmVzcG9uc2UoZnAsIGhlYWRlcnM9eydjb250ZW50LWVuY29kaW5nJzogJ2d6aXAnfSwKICAgICAgICAgICAgICAgICAgICAgICAgIHByZWxvYWRfY29udGVudD1GYWxzZSkKCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLnJlYWQoMTEpLCBiJycpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLnJlYWQoMSksIGInZicpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyLnJlYWQoMiksIGInb28nKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoci5yZWFkKCksIGInJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHIucmVhZCgpLCBiJycpCgogICAgZGVmIHRlc3RfYm9keV9ibG9iKHNlbGYpOgogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UoYidmb28nKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcC5kYXRhLCBiJ2ZvbycpCiAgICAgICAgc2VsZi5hc3NlcnRUcnVlKHJlc3AuY2xvc2VkKQoKICAgIGRlZiB0ZXN0X2lvKHNlbGYpOgogICAgICAgIGZwID0gQnl0ZXNJTyhiJ2ZvbycpCiAgICAgICAgcmVzcCA9IEhUVFBSZXNwb25zZShmcCwgcHJlbG9hZF9jb250ZW50PUZhbHNlKQoKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc3AuY2xvc2VkLCBGYWxzZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc3AucmVhZGFibGUoKSwgVHJ1ZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc3Aud3JpdGFibGUoKSwgRmFsc2UpCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoSU9FcnJvciwgcmVzcC5maWxlbm8pCgogICAgICAgIHJlc3AuY2xvc2UoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcC5jbG9zZWQsIFRydWUpCgogICAgICAgICMgVHJ5IGNsb3Npbmcgd2l0aCBhbiBgaHR0cGxpYi5IVFRQUmVzcG9uc2VgLCBiZWNhdXNlIGl0IGhhcyBhbgogICAgICAgICMgYGlzY2xvc2VkYCBtZXRob2QuCiAgICAgICAgaGxyID0gaHR0cGxpYi5IVFRQUmVzcG9uc2Uoc29ja2V0LnNvY2tldCgpKQogICAgICAgIHJlc3AyID0gSFRUUFJlc3BvbnNlKGhsciwgcHJlbG9hZF9jb250ZW50PUZhbHNlKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcDIuY2xvc2VkLCBGYWxzZSkKICAgICAgICByZXNwMi5jbG9zZSgpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXNwMi5jbG9zZWQsIFRydWUpCgogICAgICAgICMgYWxzbyB0cnkgd2hlbiBvbmx5IGRhdGEgaXMgcHJlc2VudC4KICAgICAgICByZXNwMyA9IEhUVFBSZXNwb25zZSgnZm9vZGF0YScpCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoSU9FcnJvciwgcmVzcDMuZmlsZW5vKQoKICAgICAgICByZXNwMy5fZnAgPSAyCiAgICAgICAgIyBBIGNvcm5lciBjYXNlIHdoZXJlIF9mcCBpcyBwcmVzZW50IGJ1dCBkb2Vzbid0IGhhdmUgYGNsb3NlZGAsCiAgICAgICAgIyBgaXNjbG9zZWRgLCBvciBgZmlsZW5vYC4gIFVubGlrZWx5LCBidXQgcG9zc2libGUuCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXNwMy5jbG9zZWQsIFRydWUpCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoSU9FcnJvciwgcmVzcDMuZmlsZW5vKQoKICAgIGRlZiB0ZXN0X2lvX2Nsb3NlZF9jb25zaXN0ZW50bHkoc2VsZik6CiAgICAgICAgaGxyID0gaHR0cGxpYi5IVFRQUmVzcG9uc2Uoc29ja2V0LnNvY2tldCgpKQogICAgICAgIGhsci5mcCA9IEJ5dGVzSU8oYidmb28nKQogICAgICAgIGhsci5jaHVua2VkID0gMAogICAgICAgIGhsci5sZW5ndGggPSAzCiAgICAgICAgcmVzcCA9IEhUVFBSZXNwb25zZShobHIsIHByZWxvYWRfY29udGVudD1GYWxzZSkKCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXNwLmNsb3NlZCwgRmFsc2UpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXNwLl9mcC5pc2Nsb3NlZCgpLCBGYWxzZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKGlzX2ZwX2Nsb3NlZChyZXNwLl9mcCksIEZhbHNlKQogICAgICAgIHJlc3AucmVhZCgpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXNwLmNsb3NlZCwgVHJ1ZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc3AuX2ZwLmlzY2xvc2VkKCksIFRydWUpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChpc19mcF9jbG9zZWQocmVzcC5fZnApLCBUcnVlKQoKICAgIGRlZiB0ZXN0X2lvX2J1ZmZlcmVkcmVhZGVyKHNlbGYpOgogICAgICAgIGZwID0gQnl0ZXNJTyhiJ2ZvbycpCiAgICAgICAgcmVzcCA9IEhUVFBSZXNwb25zZShmcCwgcHJlbG9hZF9jb250ZW50PUZhbHNlKQogICAgICAgIGJyID0gQnVmZmVyZWRSZWFkZXIocmVzcCkKCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChici5yZWFkKCksIGInZm9vJykKCiAgICAgICAgYnIuY2xvc2UoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcC5jbG9zZWQsIFRydWUpCgogICAgICAgIGIgPSBiJ2Zvb2FuZGFoYWxmJwogICAgICAgIGZwID0gQnl0ZXNJTyhiKQogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UoZnAsIHByZWxvYWRfY29udGVudD1GYWxzZSkKICAgICAgICBiciA9IEJ1ZmZlcmVkUmVhZGVyKHJlc3AsIDUpCgogICAgICAgIGJyLnJlYWQoMSkgICMgc2V0cyB1cCB0aGUgYnVmZmVyLCByZWFkaW5nIDUKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKGxlbihmcC5yZWFkKCkpLCBsZW4oYikgLSA1KQoKICAgICAgICAjIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIG1ha2Ugc3VyZSB0aGUgIm5vIGJ5dGVzIGxlZnQiIHBhcnQgb2YgYHJlYWRpbnRvYAogICAgICAgICMgZ2V0cyB0ZXN0ZWQuCiAgICAgICAgd2hpbGUgbm90IGJyLmNsb3NlZDoKICAgICAgICAgICAgYnIucmVhZCg1KQoKICAgIGRlZiB0ZXN0X2lvX3JlYWRpbnRvKHNlbGYpOgogICAgICAgICMgVGhpcyB0ZXN0IGlzIG5lY2Vzc2FyeSBiZWNhdXNlIGluIHB5Mi42LCBgcmVhZGludG9gIGRvZXNuJ3QgZ2V0IGNhbGxlZAogICAgICAgICMgaW4gYHRlc3RfaW9fYnVmZmVyZWRyZWFkZXJgIGxpa2UgaXQgZG9lcyBmb3IgYWxsIHRoZSBvdGhlciBweXRob24KICAgICAgICAjIHZlcnNpb25zLiAgUHJvYmFibHkgdGhpcyBpcyBiZWNhdXNlIHRoZSBgaW9gIG1vZHVsZSBpbiBweTIuNiBpcyBhbgogICAgICAgICMgb2xkIHZlcnNpb24gdGhhdCBoYXMgYSBkaWZmZXJlbnQgdW5kZXJseWluZyBpbXBsZW1lbnRhdGlvbi4KCiAgICAgICAgZnAgPSBCeXRlc0lPKGInZm9vJykKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKGZwLCBwcmVsb2FkX2NvbnRlbnQ9RmFsc2UpCgogICAgICAgIGJhcnIgPSBieXRlYXJyYXkoMykKICAgICAgICBhc3NlcnQgcmVzcC5yZWFkaW50byhiYXJyKSA9PSAzCiAgICAgICAgYXNzZXJ0IGInZm9vJyA9PSBiYXJyCgogICAgICAgICMgVGhlIHJlYWRlciBzaG91bGQgYWxyZWFkeSBiZSBlbXB0eSwgc28gdGhpcyBzaG91bGQgcmVhZCBub3RoaW5nLgogICAgICAgIGFzc2VydCByZXNwLnJlYWRpbnRvKGJhcnIpID09IDAKICAgICAgICBhc3NlcnQgYidmb28nID09IGJhcnIKCiAgICBkZWYgdGVzdF9zdHJlYW1pbmcoc2VsZik6CiAgICAgICAgZnAgPSBCeXRlc0lPKGInZm9vJykKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKGZwLCBwcmVsb2FkX2NvbnRlbnQ9RmFsc2UpCiAgICAgICAgc3RyZWFtID0gcmVzcC5zdHJlYW0oMiwgZGVjb2RlX2NvbnRlbnQ9RmFsc2UpCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwobmV4dChzdHJlYW0pLCBiJ2ZvJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKG5leHQoc3RyZWFtKSwgYidvJykKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhTdG9wSXRlcmF0aW9uLCBuZXh0LCBzdHJlYW0pCgogICAgZGVmIHRlc3Rfc3RyZWFtaW5nX3RlbGwoc2VsZik6CiAgICAgICAgZnAgPSBCeXRlc0lPKGInZm9vJykKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKGZwLCBwcmVsb2FkX2NvbnRlbnQ9RmFsc2UpCiAgICAgICAgc3RyZWFtID0gcmVzcC5zdHJlYW0oMiwgZGVjb2RlX2NvbnRlbnQ9RmFsc2UpCgogICAgICAgIHBvc2l0aW9uID0gMAoKICAgICAgICBwb3NpdGlvbiArPSBsZW4obmV4dChzdHJlYW0pKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoMiwgcG9zaXRpb24pCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChwb3NpdGlvbiwgcmVzcC50ZWxsKCkpCgogICAgICAgIHBvc2l0aW9uICs9IGxlbihuZXh0KHN0cmVhbSkpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgzLCBwb3NpdGlvbikKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHBvc2l0aW9uLCByZXNwLnRlbGwoKSkKCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoU3RvcEl0ZXJhdGlvbiwgbmV4dCwgc3RyZWFtKQoKICAgIGRlZiB0ZXN0X2d6aXBwZWRfc3RyZWFtaW5nKHNlbGYpOgogICAgICAgIGltcG9ydCB6bGliCiAgICAgICAgY29tcHJlc3MgPSB6bGliLmNvbXByZXNzb2JqKDYsIHpsaWIuREVGTEFURUQsIDE2ICsgemxpYi5NQVhfV0JJVFMpCiAgICAgICAgZGF0YSA9IGNvbXByZXNzLmNvbXByZXNzKGInZm9vJykKICAgICAgICBkYXRhICs9IGNvbXByZXNzLmZsdXNoKCkKCiAgICAgICAgZnAgPSBCeXRlc0lPKGRhdGEpCiAgICAgICAgcmVzcCA9IEhUVFBSZXNwb25zZShmcCwgaGVhZGVycz17J2NvbnRlbnQtZW5jb2RpbmcnOiAnZ3ppcCd9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlbG9hZF9jb250ZW50PUZhbHNlKQogICAgICAgIHN0cmVhbSA9IHJlc3Auc3RyZWFtKDIpCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwobmV4dChzdHJlYW0pLCBiJ2YnKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwobmV4dChzdHJlYW0pLCBiJ29vJykKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhTdG9wSXRlcmF0aW9uLCBuZXh0LCBzdHJlYW0pCgogICAgZGVmIHRlc3RfZ3ppcHBlZF9zdHJlYW1pbmdfdGVsbChzZWxmKToKICAgICAgICBpbXBvcnQgemxpYgogICAgICAgIGNvbXByZXNzID0gemxpYi5jb21wcmVzc29iaig2LCB6bGliLkRFRkxBVEVELCAxNiArIHpsaWIuTUFYX1dCSVRTKQogICAgICAgIHVuY29tcHJlc3NlZF9kYXRhID0gYidmb28nCiAgICAgICAgZGF0YSA9IGNvbXByZXNzLmNvbXByZXNzKHVuY29tcHJlc3NlZF9kYXRhKQogICAgICAgIGRhdGEgKz0gY29tcHJlc3MuZmx1c2goKQoKICAgICAgICBmcCA9IEJ5dGVzSU8oZGF0YSkKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKGZwLCBoZWFkZXJzPXsnY29udGVudC1lbmNvZGluZyc6ICdnemlwJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVsb2FkX2NvbnRlbnQ9RmFsc2UpCiAgICAgICAgc3RyZWFtID0gcmVzcC5zdHJlYW0oKQoKICAgICAgICAjIFJlYWQgZXZlcnl0aGluZwogICAgICAgIHBheWxvYWQgPSBuZXh0KHN0cmVhbSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHBheWxvYWQsIHVuY29tcHJlc3NlZF9kYXRhKQoKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKGxlbihkYXRhKSwgcmVzcC50ZWxsKCkpCgogICAgICAgIHNlbGYuYXNzZXJ0UmFpc2VzKFN0b3BJdGVyYXRpb24sIG5leHQsIHN0cmVhbSkKCiAgICBkZWYgdGVzdF9kZWZsYXRlX3N0cmVhbWluZ190ZWxsX2ludGVybWVkaWF0ZV9wb2ludChzZWxmKToKICAgICAgICAjIEVuc3VyZSB0aGF0IGBgdGVsbCgpYGAgcmV0dXJucyB0aGUgY29ycmVjdCBudW1iZXIgb2YgYnl0ZXMgd2hlbgogICAgICAgICMgcGFydC13YXkgdGhyb3VnaCBzdHJlYW1pbmcgY29tcHJlc3NlZCBjb250ZW50LgogICAgICAgIGltcG9ydCB6bGliCgogICAgICAgIE5VTUJFUl9PRl9SRUFEUyA9IDEwCgogICAgICAgIGNsYXNzIE1vY2tDb21wcmVzc2VkRGF0YVJlYWRpbmcoQnl0ZXNJTyk6CiAgICAgICAgICAgICIiIgogICAgICAgICAgICBBIEJ5dGVJTy1saWtlIHJlYWRlciByZXR1cm5pbmcgYGBwYXlsb2FkYGAgaW4gYGBOVU1CRVJfT0ZfUkVBRFNgYAogICAgICAgICAgICBjYWxscyB0byBgYHJlYWRgYC4KICAgICAgICAgICAgIiIiCgogICAgICAgICAgICBkZWYgX19pbml0X18oc2VsZiwgcGF5bG9hZCwgcGF5bG9hZF9wYXJ0X3NpemUpOgogICAgICAgICAgICAgICAgc2VsZi5wYXlsb2FkcyA9IFsKICAgICAgICAgICAgICAgICAgICBwYXlsb2FkW2kqcGF5bG9hZF9wYXJ0X3NpemU6KGkrMSkqcGF5bG9hZF9wYXJ0X3NpemVdCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoTlVNQkVSX09GX1JFQURTKzEpXQoKICAgICAgICAgICAgICAgIGFzc2VydCBiIiIuam9pbihzZWxmLnBheWxvYWRzKSA9PSBwYXlsb2FkCgogICAgICAgICAgICBkZWYgcmVhZChzZWxmLCBfKToKICAgICAgICAgICAgICAgICMgQW1vdW50IGlzIHVudXNlZC4KICAgICAgICAgICAgICAgIGlmIGxlbihzZWxmLnBheWxvYWRzKSA+IDA6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucGF5bG9hZHMucG9wKDApCiAgICAgICAgICAgICAgICByZXR1cm4gYiIiCgogICAgICAgIHVuY29tcHJlc3NlZF9kYXRhID0gemxpYi5kZWNvbXByZXNzKFpMSUJfUEFZTE9BRCkKCiAgICAgICAgcGF5bG9hZF9wYXJ0X3NpemUgPSBsZW4oWkxJQl9QQVlMT0FEKSAvLyBOVU1CRVJfT0ZfUkVBRFMKICAgICAgICBmcCA9IE1vY2tDb21wcmVzc2VkRGF0YVJlYWRpbmcoWkxJQl9QQVlMT0FELCBwYXlsb2FkX3BhcnRfc2l6ZSkKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKGZwLCBoZWFkZXJzPXsnY29udGVudC1lbmNvZGluZyc6ICdkZWZsYXRlJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVsb2FkX2NvbnRlbnQ9RmFsc2UpCiAgICAgICAgc3RyZWFtID0gcmVzcC5zdHJlYW0oKQoKICAgICAgICBwYXJ0c19wb3NpdGlvbnMgPSBbKHBhcnQsIHJlc3AudGVsbCgpKSBmb3IgcGFydCBpbiBzdHJlYW1dCiAgICAgICAgZW5kX29mX3N0cmVhbSA9IHJlc3AudGVsbCgpCgogICAgICAgIHNlbGYuYXNzZXJ0UmFpc2VzKFN0b3BJdGVyYXRpb24sIG5leHQsIHN0cmVhbSkKCiAgICAgICAgcGFydHMsIHBvc2l0aW9ucyA9IHppcCgqcGFydHNfcG9zaXRpb25zKQoKICAgICAgICAjIENoZWNrIHRoYXQgdGhlIHBheWxvYWQgaXMgZXF1YWwgdG8gdGhlIHVuY29tcHJlc3NlZCBkYXRhCiAgICAgICAgcGF5bG9hZCA9IGIiIi5qb2luKHBhcnRzKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwodW5jb21wcmVzc2VkX2RhdGEsIHBheWxvYWQpCgogICAgICAgICMgQ2hlY2sgdGhhdCB0aGUgcG9zaXRpb25zIGluIHRoZSBzdHJlYW0gYXJlIGNvcnJlY3QKICAgICAgICBleHBlY3RlZCA9IFsoaSsxKSpwYXlsb2FkX3BhcnRfc2l6ZSBmb3IgaSBpbiByYW5nZShOVU1CRVJfT0ZfUkVBRFMpXQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoZXhwZWN0ZWQsIGxpc3QocG9zaXRpb25zKSkKCiAgICAgICAgIyBDaGVjayB0aGF0IHRoZSBlbmQgb2YgdGhlIHN0cmVhbSBpcyBpbiB0aGUgY29ycmVjdCBwbGFjZQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwobGVuKFpMSUJfUEFZTE9BRCksIGVuZF9vZl9zdHJlYW0pCgogICAgZGVmIHRlc3RfZGVmbGF0ZV9zdHJlYW1pbmcoc2VsZik6CiAgICAgICAgaW1wb3J0IHpsaWIKICAgICAgICBkYXRhID0gemxpYi5jb21wcmVzcyhiJ2ZvbycpCgogICAgICAgIGZwID0gQnl0ZXNJTyhkYXRhKQogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UoZnAsIGhlYWRlcnM9eydjb250ZW50LWVuY29kaW5nJzogJ2RlZmxhdGUnfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWxvYWRfY29udGVudD1GYWxzZSkKICAgICAgICBzdHJlYW0gPSByZXNwLnN0cmVhbSgyKQoKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKG5leHQoc3RyZWFtKSwgYidmJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKG5leHQoc3RyZWFtKSwgYidvbycpCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoU3RvcEl0ZXJhdGlvbiwgbmV4dCwgc3RyZWFtKQoKICAgIGRlZiB0ZXN0X2RlZmxhdGUyX3N0cmVhbWluZyhzZWxmKToKICAgICAgICBpbXBvcnQgemxpYgogICAgICAgIGNvbXByZXNzID0gemxpYi5jb21wcmVzc29iaig2LCB6bGliLkRFRkxBVEVELCAtemxpYi5NQVhfV0JJVFMpCiAgICAgICAgZGF0YSA9IGNvbXByZXNzLmNvbXByZXNzKGInZm9vJykKICAgICAgICBkYXRhICs9IGNvbXByZXNzLmZsdXNoKCkKCiAgICAgICAgZnAgPSBCeXRlc0lPKGRhdGEpCiAgICAgICAgcmVzcCA9IEhUVFBSZXNwb25zZShmcCwgaGVhZGVycz17J2NvbnRlbnQtZW5jb2RpbmcnOiAnZGVmbGF0ZSd9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlbG9hZF9jb250ZW50PUZhbHNlKQogICAgICAgIHN0cmVhbSA9IHJlc3Auc3RyZWFtKDIpCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwobmV4dChzdHJlYW0pLCBiJ2YnKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwobmV4dChzdHJlYW0pLCBiJ29vJykKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhTdG9wSXRlcmF0aW9uLCBuZXh0LCBzdHJlYW0pCgogICAgZGVmIHRlc3RfZW1wdHlfc3RyZWFtKHNlbGYpOgogICAgICAgIGZwID0gQnl0ZXNJTyhiJycpCiAgICAgICAgcmVzcCA9IEhUVFBSZXNwb25zZShmcCwgcHJlbG9hZF9jb250ZW50PUZhbHNlKQogICAgICAgIHN0cmVhbSA9IHJlc3Auc3RyZWFtKDIsIGRlY29kZV9jb250ZW50PUZhbHNlKQoKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhTdG9wSXRlcmF0aW9uLCBuZXh0LCBzdHJlYW0pCgogICAgZGVmIHRlc3RfbGVuZ3RoX25vX2hlYWRlcihzZWxmKToKICAgICAgICBmcCA9IEJ5dGVzSU8oYicxMjM0NScpCiAgICAgICAgcmVzcCA9IEhUVFBSZXNwb25zZShmcCwgcHJlbG9hZF9jb250ZW50PUZhbHNlKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcC5sZW5ndGhfcmVtYWluaW5nLCBOb25lKQoKICAgIGRlZiB0ZXN0X2xlbmd0aF93X3ZhbGlkX2hlYWRlcihzZWxmKToKICAgICAgICBoZWFkZXJzID0geyJjb250ZW50LWxlbmd0aCI6ICI1In0KICAgICAgICBmcCA9IEJ5dGVzSU8oYicxMjM0NScpCgogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UoZnAsIGhlYWRlcnM9aGVhZGVycywgcHJlbG9hZF9jb250ZW50PUZhbHNlKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcC5sZW5ndGhfcmVtYWluaW5nLCA1KQoKICAgIGRlZiB0ZXN0X2xlbmd0aF93X2JhZF9oZWFkZXIoc2VsZik6CiAgICAgICAgZ2FyYmFnZSA9IHsnY29udGVudC1sZW5ndGgnOiAnZm9vJ30KICAgICAgICBmcCA9IEJ5dGVzSU8oYicxMjM0NScpCgogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UoZnAsIGhlYWRlcnM9Z2FyYmFnZSwgcHJlbG9hZF9jb250ZW50PUZhbHNlKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcC5sZW5ndGhfcmVtYWluaW5nLCBOb25lKQoKICAgICAgICBnYXJiYWdlWydjb250ZW50LWxlbmd0aCddID0gIi0xMCIKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKGZwLCBoZWFkZXJzPWdhcmJhZ2UsIHByZWxvYWRfY29udGVudD1GYWxzZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc3AubGVuZ3RoX3JlbWFpbmluZywgTm9uZSkKCiAgICBkZWYgdGVzdF9sZW5ndGhfd2hlbl9jaHVua2VkKHNlbGYpOgogICAgICAgICMgVGhpcyBpcyBleHByZXNzbHkgZm9yYmlkZGVuIGluIFJGQyA3MjMwIHNlYyAzLjMuMgogICAgICAgICMgV2UgZmFsbCBiYWNrIHRvIGNodW5rZWQgaW4gdGhpcyBjYXNlIGFuZCB0cnkgdG8KICAgICAgICAjIGhhbmRsZSByZXNwb25zZSBpZ25vcmluZyBjb250ZW50IGxlbmd0aC4KICAgICAgICBoZWFkZXJzID0geydjb250ZW50LWxlbmd0aCc6ICc1JywKICAgICAgICAgICAgICAgICAgICd0cmFuc2Zlci1lbmNvZGluZyc6ICdjaHVua2VkJ30KICAgICAgICBmcCA9IEJ5dGVzSU8oYicxMjM0NScpCgogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UoZnAsIGhlYWRlcnM9aGVhZGVycywgcHJlbG9hZF9jb250ZW50PUZhbHNlKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcC5sZW5ndGhfcmVtYWluaW5nLCBOb25lKQoKICAgIGRlZiB0ZXN0X2xlbmd0aF93aXRoX211bHRpcGxlX2NvbnRlbnRfbGVuZ3RocyhzZWxmKToKICAgICAgICBoZWFkZXJzID0geydjb250ZW50LWxlbmd0aCc6ICc1LCA1LCA1J30KICAgICAgICBnYXJiYWdlID0geydjb250ZW50LWxlbmd0aCc6ICc1LCA0Mid9CiAgICAgICAgZnAgPSBCeXRlc0lPKGInYWJjZGUnKQoKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKGZwLCBoZWFkZXJzPWhlYWRlcnMsIHByZWxvYWRfY29udGVudD1GYWxzZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc3AubGVuZ3RoX3JlbWFpbmluZywgNSkKCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoSW52YWxpZEhlYWRlciwgSFRUUFJlc3BvbnNlLCBmcCwKICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWdhcmJhZ2UsIHByZWxvYWRfY29udGVudD1GYWxzZSkKCiAgICBkZWYgdGVzdF9sZW5ndGhfYWZ0ZXJfcmVhZChzZWxmKToKICAgICAgICBoZWFkZXJzID0geyJjb250ZW50LWxlbmd0aCI6ICI1In0KCiAgICAgICAgIyBUZXN0IG5vIGRlZmluZWQgbGVuZ3RoCiAgICAgICAgZnAgPSBCeXRlc0lPKGInMTIzNDUnKQogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UoZnAsIHByZWxvYWRfY29udGVudD1GYWxzZSkKICAgICAgICByZXNwLnJlYWQoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcC5sZW5ndGhfcmVtYWluaW5nLCBOb25lKQoKICAgICAgICAjIFRlc3Qgb3VyIHVwZGF0ZSBmcm9tIGNvbnRlbnQtbGVuZ3RoCiAgICAgICAgZnAgPSBCeXRlc0lPKGInMTIzNDUnKQogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UoZnAsIGhlYWRlcnM9aGVhZGVycywgcHJlbG9hZF9jb250ZW50PUZhbHNlKQogICAgICAgIHJlc3AucmVhZCgpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXNwLmxlbmd0aF9yZW1haW5pbmcsIDApCgogICAgICAgICMgVGVzdCBwYXJ0aWFsIHJlYWQKICAgICAgICBmcCA9IEJ5dGVzSU8oYicxMjM0NScpCiAgICAgICAgcmVzcCA9IEhUVFBSZXNwb25zZShmcCwgaGVhZGVycz1oZWFkZXJzLCBwcmVsb2FkX2NvbnRlbnQ9RmFsc2UpCiAgICAgICAgZGF0YSA9IHJlc3Auc3RyZWFtKDIpCiAgICAgICAgbmV4dChkYXRhKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcC5sZW5ndGhfcmVtYWluaW5nLCAzKQoKICAgIGRlZiB0ZXN0X21vY2tfaHR0cHJlc3BvbnNlX3N0cmVhbShzZWxmKToKICAgICAgICAjIE1vY2sgb3V0IGEgSFRUUCBSZXF1ZXN0IHRoYXQgZG9lcyBlbm91Z2ggdG8gbWFrZSBpdCB0aHJvdWdoIHVybGxpYjMncwogICAgICAgICMgcmVhZCgpIGFuZCBjbG9zZSgpIGNhbGxzLCBhbmQgYWxzbyBleGhhdXN0cyBhbmQgdW5kZXJseWluZyBmaWxlCiAgICAgICAgIyBvYmplY3QuCiAgICAgICAgY2xhc3MgTW9ja0hUVFBSZXF1ZXN0KG9iamVjdCk6CiAgICAgICAgICAgIHNlbGYuZnAgPSBOb25lCgogICAgICAgICAgICBkZWYgcmVhZChzZWxmLCBhbXQpOgogICAgICAgICAgICAgICAgZGF0YSA9IHNlbGYuZnAucmVhZChhbXQpCiAgICAgICAgICAgICAgICBpZiBub3QgZGF0YToKICAgICAgICAgICAgICAgICAgICBzZWxmLmZwID0gTm9uZQoKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCgogICAgICAgICAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgICAgICAgICBzZWxmLmZwID0gTm9uZQoKICAgICAgICBiaW8gPSBCeXRlc0lPKGInZm9vJykKICAgICAgICBmcCA9IE1vY2tIVFRQUmVxdWVzdCgpCiAgICAgICAgZnAuZnAgPSBiaW8KICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKGZwLCBwcmVsb2FkX2NvbnRlbnQ9RmFsc2UpCiAgICAgICAgc3RyZWFtID0gcmVzcC5zdHJlYW0oMikKCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChuZXh0KHN0cmVhbSksIGInZm8nKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwobmV4dChzdHJlYW0pLCBiJ28nKQogICAgICAgIHNlbGYuYXNzZXJ0UmFpc2VzKFN0b3BJdGVyYXRpb24sIG5leHQsIHN0cmVhbSkKCiAgICBkZWYgdGVzdF9tb2NrX3RyYW5zZmVyX2VuY29kaW5nX2NodW5rZWQoc2VsZik6CiAgICAgICAgc3RyZWFtID0gW2IiZm8iLCBiIm8iLCBiImJhciJdCiAgICAgICAgZnAgPSBNb2NrQ2h1bmtlZEVuY29kaW5nUmVzcG9uc2Uoc3RyZWFtKQogICAgICAgIHIgPSBodHRwbGliLkhUVFBSZXNwb25zZShNb2NrU29jaykKICAgICAgICByLmZwID0gZnAKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKHIsIHByZWxvYWRfY29udGVudD1GYWxzZSwgaGVhZGVycz17J3RyYW5zZmVyLWVuY29kaW5nJzogJ2NodW5rZWQnfSkKCiAgICAgICAgaSA9IDAKICAgICAgICBmb3IgYyBpbiByZXNwLnN0cmVhbSgpOgogICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKGMsIHN0cmVhbVtpXSkKICAgICAgICAgICAgaSArPSAxCgogICAgZGVmIHRlc3RfbW9ja19nemlwcGVkX3RyYW5zZmVyX2VuY29kaW5nX2NodW5rZWRfZGVjb2RlZChzZWxmKToKICAgICAgICAiIiJTaG93IHRoYXQgd2UgY2FuIGRlY29kZSB0aGUgZ2l6cHBlZCBhbmQgY2h1bmtlZCBib2R5LiIiIgogICAgICAgIGRlZiBzdHJlYW0oKToKICAgICAgICAgICAgIyBTZXQgdXAgYSBnZW5lcmF0b3IgdG8gY2h1bmsgdGhlIGd6aXBwZWQgYm9keQogICAgICAgICAgICBpbXBvcnQgemxpYgogICAgICAgICAgICBjb21wcmVzcyA9IHpsaWIuY29tcHJlc3NvYmooNiwgemxpYi5ERUZMQVRFRCwgMTYgKyB6bGliLk1BWF9XQklUUykKICAgICAgICAgICAgZGF0YSA9IGNvbXByZXNzLmNvbXByZXNzKGInZm9vYmFyJykKICAgICAgICAgICAgZGF0YSArPSBjb21wcmVzcy5mbHVzaCgpCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDAsIGxlbihkYXRhKSwgMik6CiAgICAgICAgICAgICAgICB5aWVsZCBkYXRhW2k6aSsyXQoKICAgICAgICBmcCA9IE1vY2tDaHVua2VkRW5jb2RpbmdSZXNwb25zZShsaXN0KHN0cmVhbSgpKSkKICAgICAgICByID0gaHR0cGxpYi5IVFRQUmVzcG9uc2UoTW9ja1NvY2spCiAgICAgICAgci5mcCA9IGZwCiAgICAgICAgaGVhZGVycyA9IHsndHJhbnNmZXItZW5jb2RpbmcnOiAnY2h1bmtlZCcsICdjb250ZW50LWVuY29kaW5nJzogJ2d6aXAnfQogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UociwgcHJlbG9hZF9jb250ZW50PUZhbHNlLCBoZWFkZXJzPWhlYWRlcnMpCgogICAgICAgIGRhdGEgPSBiJycKICAgICAgICBmb3IgYyBpbiByZXNwLnN0cmVhbShkZWNvZGVfY29udGVudD1UcnVlKToKICAgICAgICAgICAgZGF0YSArPSBjCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoYidmb29iYXInLCBkYXRhKQoKICAgIGRlZiB0ZXN0X21vY2tfdHJhbnNmZXJfZW5jb2RpbmdfY2h1bmtlZF9jdXN0b21fcmVhZChzZWxmKToKICAgICAgICBzdHJlYW0gPSBbYiJmb29vbyIsIGIiYmJiYmFhYWFhciJdCiAgICAgICAgZnAgPSBNb2NrQ2h1bmtlZEVuY29kaW5nUmVzcG9uc2Uoc3RyZWFtKQogICAgICAgIHIgPSBodHRwbGliLkhUVFBSZXNwb25zZShNb2NrU29jaykKICAgICAgICByLmZwID0gZnAKICAgICAgICByLmNodW5rZWQgPSBUcnVlCiAgICAgICAgci5jaHVua19sZWZ0ID0gTm9uZQogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UociwgcHJlbG9hZF9jb250ZW50PUZhbHNlLCBoZWFkZXJzPXsndHJhbnNmZXItZW5jb2RpbmcnOiAnY2h1bmtlZCd9KQogICAgICAgIGV4cGVjdGVkX3Jlc3BvbnNlID0gW2InZm8nLCBiJ29vJywgYidvJywgYidiYicsIGInYmInLCBiJ2FhJywgYidhYScsIGInYXInXQogICAgICAgIHJlc3BvbnNlID0gbGlzdChyZXNwLnJlYWRfY2h1bmtlZCgyKSkKICAgICAgICBpZiBnZXRhdHRyKHNlbGYsICJhc3NlcnRMaXN0RXF1YWwiLCBGYWxzZSk6CiAgICAgICAgICAgIHNlbGYuYXNzZXJ0TGlzdEVxdWFsKGV4cGVjdGVkX3Jlc3BvbnNlLCByZXNwb25zZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBmb3IgaW5kZXgsIGl0ZW0gaW4gZW51bWVyYXRlKHJlc3BvbnNlKToKICAgICAgICAgICAgICAgIHYgPSBleHBlY3RlZF9yZXNwb25zZVtpbmRleF0KICAgICAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoaXRlbSwgdikKCiAgICBkZWYgdGVzdF9tb2NrX3RyYW5zZmVyX2VuY29kaW5nX2NodW5rZWRfdW5sbXRkX3JlYWQoc2VsZik6CiAgICAgICAgc3RyZWFtID0gW2IiZm9vb28iLCBiImJiYmJhYWFhYXIiXQogICAgICAgIGZwID0gTW9ja0NodW5rZWRFbmNvZGluZ1Jlc3BvbnNlKHN0cmVhbSkKICAgICAgICByID0gaHR0cGxpYi5IVFRQUmVzcG9uc2UoTW9ja1NvY2spCiAgICAgICAgci5mcCA9IGZwCiAgICAgICAgci5jaHVua2VkID0gVHJ1ZQogICAgICAgIHIuY2h1bmtfbGVmdCA9IE5vbmUKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKHIsIHByZWxvYWRfY29udGVudD1GYWxzZSwgaGVhZGVycz17J3RyYW5zZmVyLWVuY29kaW5nJzogJ2NodW5rZWQnfSkKICAgICAgICBpZiBnZXRhdHRyKHNlbGYsICJhc3NlcnRMaXN0RXF1YWwiLCBGYWxzZSk6CiAgICAgICAgICAgIHNlbGYuYXNzZXJ0TGlzdEVxdWFsKHN0cmVhbSwgbGlzdChyZXNwLnJlYWRfY2h1bmtlZCgpKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBmb3IgaW5kZXgsIGl0ZW0gaW4gZW51bWVyYXRlKHJlc3AucmVhZF9jaHVua2VkKCkpOgogICAgICAgICAgICAgICAgdiA9IHN0cmVhbVtpbmRleF0KICAgICAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoaXRlbSwgdikKCiAgICBkZWYgdGVzdF9yZWFkX25vdF9jaHVua2VkX3Jlc3BvbnNlX2FzX2NodW5rcyhzZWxmKToKICAgICAgICBmcCA9IEJ5dGVzSU8oYidmb28nKQogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UoZnAsIHByZWxvYWRfY29udGVudD1GYWxzZSkKICAgICAgICByID0gcmVzcC5yZWFkX2NodW5rZWQoKQogICAgICAgIHNlbGYuYXNzZXJ0UmFpc2VzKFJlc3BvbnNlTm90Q2h1bmtlZCwgbmV4dCwgcikKCiAgICBkZWYgdGVzdF9pbnZhbGlkX2NodW5rcyhzZWxmKToKICAgICAgICBzdHJlYW0gPSBbYiJmb29vbyIsIGIiYmJiYmFhYWFhciJdCiAgICAgICAgZnAgPSBNb2NrQ2h1bmtlZEludmFsaWRFbmNvZGluZyhzdHJlYW0pCiAgICAgICAgciA9IGh0dHBsaWIuSFRUUFJlc3BvbnNlKE1vY2tTb2NrKQogICAgICAgIHIuZnAgPSBmcAogICAgICAgIHIuY2h1bmtlZCA9IFRydWUKICAgICAgICByLmNodW5rX2xlZnQgPSBOb25lCiAgICAgICAgcmVzcCA9IEhUVFBSZXNwb25zZShyLCBwcmVsb2FkX2NvbnRlbnQ9RmFsc2UsIGhlYWRlcnM9eyd0cmFuc2Zlci1lbmNvZGluZyc6ICdjaHVua2VkJ30pCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoUHJvdG9jb2xFcnJvciwgbmV4dCwgcmVzcC5yZWFkX2NodW5rZWQoKSkKCiAgICBkZWYgdGVzdF9jaHVua2VkX3Jlc3BvbnNlX3dpdGhvdXRfY3JsZl9vbl9lbmQoc2VsZik6CiAgICAgICAgc3RyZWFtID0gW2IiZm9vIiwgYiJiYXIiLCBiImJheiJdCiAgICAgICAgZnAgPSBNb2NrQ2h1bmtlZEVuY29kaW5nV2l0aG91dENSTEZPbkVuZChzdHJlYW0pCiAgICAgICAgciA9IGh0dHBsaWIuSFRUUFJlc3BvbnNlKE1vY2tTb2NrKQogICAgICAgIHIuZnAgPSBmcAogICAgICAgIHIuY2h1bmtlZCA9IFRydWUKICAgICAgICByLmNodW5rX2xlZnQgPSBOb25lCiAgICAgICAgcmVzcCA9IEhUVFBSZXNwb25zZShyLCBwcmVsb2FkX2NvbnRlbnQ9RmFsc2UsIGhlYWRlcnM9eyd0cmFuc2Zlci1lbmNvZGluZyc6ICdjaHVua2VkJ30pCiAgICAgICAgaWYgZ2V0YXR0cihzZWxmLCAiYXNzZXJ0TGlzdEVxdWFsIiwgRmFsc2UpOgogICAgICAgICAgICBzZWxmLmFzc2VydExpc3RFcXVhbChzdHJlYW0sIGxpc3QocmVzcC5zdHJlYW0oKSkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZm9yIGluZGV4LCBpdGVtIGluIGVudW1lcmF0ZShyZXNwLnN0cmVhbSgpKToKICAgICAgICAgICAgICAgIHYgPSBzdHJlYW1baW5kZXhdCiAgICAgICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKGl0ZW0sIHYpCgogICAgZGVmIHRlc3RfY2h1bmtlZF9yZXNwb25zZV93aXRoX2V4dGVuc2lvbnMoc2VsZik6CiAgICAgICAgc3RyZWFtID0gW2IiZm9vIiwgYiJiYXIiXQogICAgICAgIGZwID0gTW9ja0NodW5rZWRFbmNvZGluZ1dpdGhFeHRlbnNpb25zKHN0cmVhbSkKICAgICAgICByID0gaHR0cGxpYi5IVFRQUmVzcG9uc2UoTW9ja1NvY2spCiAgICAgICAgci5mcCA9IGZwCiAgICAgICAgci5jaHVua2VkID0gVHJ1ZQogICAgICAgIHIuY2h1bmtfbGVmdCA9IE5vbmUKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKHIsIHByZWxvYWRfY29udGVudD1GYWxzZSwgaGVhZGVycz17J3RyYW5zZmVyLWVuY29kaW5nJzogJ2NodW5rZWQnfSkKICAgICAgICBpZiBnZXRhdHRyKHNlbGYsICJhc3NlcnRMaXN0RXF1YWwiLCBGYWxzZSk6CiAgICAgICAgICAgIHNlbGYuYXNzZXJ0TGlzdEVxdWFsKHN0cmVhbSwgbGlzdChyZXNwLnN0cmVhbSgpKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBmb3IgaW5kZXgsIGl0ZW0gaW4gZW51bWVyYXRlKHJlc3Auc3RyZWFtKCkpOgogICAgICAgICAgICAgICAgdiA9IHN0cmVhbVtpbmRleF0KICAgICAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoaXRlbSwgdikKCiAgICBkZWYgdGVzdF9nZXRfY2FzZV9pbnNlbnNpdGl2ZV9oZWFkZXJzKHNlbGYpOgogICAgICAgIGhlYWRlcnMgPSB7J2hvc3QnOiAnZXhhbXBsZS5jb20nfQogICAgICAgIHIgPSBIVFRQUmVzcG9uc2UoaGVhZGVycz1oZWFkZXJzKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoci5oZWFkZXJzLmdldCgnaG9zdCcpLCAnZXhhbXBsZS5jb20nKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoci5oZWFkZXJzLmdldCgnSG9zdCcpLCAnZXhhbXBsZS5jb20nKQoKICAgIGRlZiB0ZXN0X3JldHJpZXMoc2VsZik6CiAgICAgICAgZnAgPSBCeXRlc0lPKGInJykKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKGZwKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcC5yZXRyaWVzLCBOb25lKQogICAgICAgIHJldHJ5ID0gUmV0cnkoKQogICAgICAgIHJlc3AgPSBIVFRQUmVzcG9uc2UoZnAsIHJldHJpZXM9cmV0cnkpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXNwLnJldHJpZXMsIHJldHJ5KQoKCmNsYXNzIE1vY2tDaHVua2VkRW5jb2RpbmdSZXNwb25zZShvYmplY3QpOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb250ZW50KToKICAgICAgICAiIiIKICAgICAgICBjb250ZW50OiBjb2xsZWN0aW9uIG9mIHN0ciwgZWFjaCBzdHIgaXMgYSBjaHVuayBpbiByZXNwb25zZQogICAgICAgICIiIgogICAgICAgIHNlbGYuY29udGVudCA9IGNvbnRlbnQKICAgICAgICBzZWxmLmluZGV4ID0gMCAgIyBUaGlzIGNsYXNzIGl0ZXJhdGVzIG92ZXIgc2VsZi5jb250ZW50LgogICAgICAgIHNlbGYuY2xvc2VkID0gRmFsc2UKICAgICAgICBzZWxmLmN1cl9jaHVuayA9IGInJwogICAgICAgIHNlbGYuY2h1bmtzX2V4aGF1c3RlZCA9IEZhbHNlCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIF9lbmNvZGVfY2h1bmsoY2h1bmspOgogICAgICAgICMgSW4gdGhlIGdlbmVyYWwgY2FzZSwgd2UgY2FuJ3QgZGVjb2RlIHRoZSBjaHVuayB0byB1bmljb2RlCiAgICAgICAgbGVuZ3RoID0gJyVYXHJcbicgJSBsZW4oY2h1bmspCiAgICAgICAgcmV0dXJuIGxlbmd0aC5lbmNvZGUoKSArIGNodW5rICsgYidcclxuJwoKICAgIGRlZiBfcG9wX25ld19jaHVuayhzZWxmKToKICAgICAgICBpZiBzZWxmLmNodW5rc19leGhhdXN0ZWQ6CiAgICAgICAgICAgIHJldHVybiBiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNodW5rID0gc2VsZi5jb250ZW50W3NlbGYuaW5kZXhdCiAgICAgICAgZXhjZXB0IEluZGV4RXJyb3I6CiAgICAgICAgICAgIGNodW5rID0gYicnCiAgICAgICAgICAgIHNlbGYuY2h1bmtzX2V4aGF1c3RlZCA9IFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLmluZGV4ICs9IDEKICAgICAgICBjaHVuayA9IHNlbGYuX2VuY29kZV9jaHVuayhjaHVuaykKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShjaHVuaywgYnl0ZXMpOgogICAgICAgICAgICBjaHVuayA9IGNodW5rLmVuY29kZSgpCiAgICAgICAgcmV0dXJuIGNodW5rCgogICAgZGVmIHBvcF9jdXJyZW50X2NodW5rKHNlbGYsIGFtdD0tMSwgdGlsbF9jcmxmPUZhbHNlKToKICAgICAgICBpZiBhbXQgPiAwIGFuZCB0aWxsX2NybGY6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIkNhbid0IHNwZWNpZnkgYW10IGFuZCB0aWxsX2NybGYuIikKICAgICAgICBpZiBsZW4oc2VsZi5jdXJfY2h1bmspIDw9IDA6CiAgICAgICAgICAgIHNlbGYuY3VyX2NodW5rID0gc2VsZi5fcG9wX25ld19jaHVuaygpCiAgICAgICAgaWYgdGlsbF9jcmxmOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpID0gc2VsZi5jdXJfY2h1bmsuaW5kZXgoYiJcclxuIikKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICAjIE5vIENSTEYgaW4gY3VycmVudCBjaHVuayAtLSBwcm9iYWJseSBjYXVzZWQgYnkgZW5jb2Rlci4KICAgICAgICAgICAgICAgIHNlbGYuY3VyX2NodW5rID0gYiIiCiAgICAgICAgICAgICAgICByZXR1cm4gYiIiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjaHVua19wYXJ0ID0gc2VsZi5jdXJfY2h1bmtbOmkrMl0KICAgICAgICAgICAgICAgIHNlbGYuY3VyX2NodW5rID0gc2VsZi5jdXJfY2h1bmtbaSsyOl0KICAgICAgICAgICAgICAgIHJldHVybiBjaHVua19wYXJ0CiAgICAgICAgZWxpZiBhbXQgPD0gLTE6CiAgICAgICAgICAgIGNodW5rX3BhcnQgPSBzZWxmLmN1cl9jaHVuawogICAgICAgICAgICBzZWxmLmN1cl9jaHVuayA9IGInJwogICAgICAgICAgICByZXR1cm4gY2h1bmtfcGFydAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGNodW5rX3BhcnQgPSBzZWxmLmN1cl9jaHVua1s6YW10XQogICAgICAgICAgICBleGNlcHQgSW5kZXhFcnJvcjoKICAgICAgICAgICAgICAgIGNodW5rX3BhcnQgPSBzZWxmLmN1cl9jaHVuawogICAgICAgICAgICAgICAgc2VsZi5jdXJfY2h1bmsgPSBiJycKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuY3VyX2NodW5rID0gc2VsZi5jdXJfY2h1bmtbYW10Ol0KICAgICAgICAgICAgcmV0dXJuIGNodW5rX3BhcnQKCiAgICBkZWYgcmVhZGxpbmUoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYucG9wX2N1cnJlbnRfY2h1bmsodGlsbF9jcmxmPVRydWUpCgogICAgZGVmIHJlYWQoc2VsZiwgYW10PS0xKToKICAgICAgICByZXR1cm4gc2VsZi5wb3BfY3VycmVudF9jaHVuayhhbXQpCgogICAgZGVmIGZsdXNoKHNlbGYpOgogICAgICAgICMgUHl0aG9uIDMgd2FudHMgdGhpcyBtZXRob2QuCiAgICAgICAgcGFzcwoKICAgIGRlZiBjbG9zZShzZWxmKToKICAgICAgICBzZWxmLmNsb3NlZCA9IFRydWUKCgpjbGFzcyBNb2NrQ2h1bmtlZEludmFsaWRFbmNvZGluZyhNb2NrQ2h1bmtlZEVuY29kaW5nUmVzcG9uc2UpOgoKICAgIGRlZiBfZW5jb2RlX2NodW5rKHNlbGYsIGNodW5rKToKICAgICAgICByZXR1cm4gJ1paWlxyXG4lc1xyXG4nICUgY2h1bmsuZGVjb2RlKCkKCgpjbGFzcyBNb2NrQ2h1bmtlZEVuY29kaW5nV2l0aG91dENSTEZPbkVuZChNb2NrQ2h1bmtlZEVuY29kaW5nUmVzcG9uc2UpOgoKICAgIGRlZiBfZW5jb2RlX2NodW5rKHNlbGYsIGNodW5rKToKICAgICAgICByZXR1cm4gJyVYXHJcbiVzJXMnICUgKGxlbihjaHVuayksIGNodW5rLmRlY29kZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlxyXG4iIGlmIGxlbihjaHVuaykgPiAwIGVsc2UgIiIpCgoKY2xhc3MgTW9ja0NodW5rZWRFbmNvZGluZ1dpdGhFeHRlbnNpb25zKE1vY2tDaHVua2VkRW5jb2RpbmdSZXNwb25zZSk6CgogICAgZGVmIF9lbmNvZGVfY2h1bmsoc2VsZiwgY2h1bmspOgogICAgICAgIHJldHVybiAnJVg7YXNkPXF3ZVxyXG4lc1xyXG4nICUgKGxlbihjaHVuayksIGNodW5rLmRlY29kZSgpKQoKCmNsYXNzIE1vY2tTb2NrKG9iamVjdCk6CiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBtYWtlZmlsZShjbHMsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgcmV0dXJuCgoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICAgIHVuaXR0ZXN0Lm1haW4oKQo=
