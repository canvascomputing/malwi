statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/quantiumbase/0.8.1/quantiumbase-0.8.1/quantiumbase-0.8.1/quantiumbase/backends/aiopg.py
  contents:
  - name: AiopgConnection.execute
    score: 0.0
    code: |-
      async def execute(self, query: ClauseElement) -> typing.Any:
              assert self._connection is not None, "Connection is not acquired"
              query_str, args, context = self._compile(query)
              cursor = await self._connection.cursor()
              try:
                  await cursor.execute(query_str, args)
                  return cursor.lastrowid
              finally:
                  cursor.close()
    tokens: return_generator pop_top resume load_fast self load_attr _connection pop_jump_if_not_none TO_NUMBER load_assertion_error load_const STRING_LEN_S_ENT_HIGH call raise_varargs load_fast self load_attr _compile load_fast query call unpack_sequence store_fast query_str store_fast args store_fast context load_fast self load_attr _connection load_attr cursor call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send store_fast cursor nop load_fast cursor load_attr execute load_fast query_str load_fast args call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top load_fast cursor load_attr lastrowid load_fast cursor load_attr close call pop_top return_value cleanup_throw jump_backward TO_NUMBER cleanup_throw jump_backward TO_NUMBER push_exc_info load_fast cursor load_attr close call pop_top reraise copy pop_except reraise call_intrinsic_1 INTRINSIC_STOPITERATION_ERROR reraise
    hash: fc88bb55b874481dbc853385fd372c28ee4faea4b0577437ef5377dd71123635
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/quantiumbase/0.8.1/quantiumbase-0.8.1/quantiumbase-0.8.1/quantiumbase/backends/aiopg.py
  : aW1wb3J0IGdldHBhc3MKaW1wb3J0IGpzb24KaW1wb3J0IGxvZ2dpbmcKaW1wb3J0IHR5cGluZwppbXBvcnQgdXVpZAoKaW1wb3J0IGFpb3BnCmZyb20gYWlvcGcuc2EuZW5naW5lIGltcG9ydCBBUEdDb21waWxlcl9wc3ljb3BnMgpmcm9tIHNxbGFsY2hlbXkuZGlhbGVjdHMucG9zdGdyZXNxbC5wc3ljb3BnMiBpbXBvcnQgUEdEaWFsZWN0X3BzeWNvcGcyCmZyb20gc3FsYWxjaGVteS5lbmdpbmUuY3Vyc29yIGltcG9ydCBDdXJzb3JSZXN1bHRNZXRhRGF0YQpmcm9tIHNxbGFsY2hlbXkuZW5naW5lLmludGVyZmFjZXMgaW1wb3J0IERpYWxlY3QsIEV4ZWN1dGlvbkNvbnRleHQKZnJvbSBzcWxhbGNoZW15LmVuZ2luZS5yb3cgaW1wb3J0IFJvdwpmcm9tIHNxbGFsY2hlbXkuc3FsIGltcG9ydCBDbGF1c2VFbGVtZW50CmZyb20gc3FsYWxjaGVteS5zcWwuZGRsIGltcG9ydCBERExFbGVtZW50Cgpmcm9tIHF1YW50aXVtYmFzZS5jb3JlIGltcG9ydCBEYXRhYmFzZVVSTApmcm9tIHF1YW50aXVtYmFzZS5pbnRlcmZhY2VzIGltcG9ydCAoCiAgICBDb25uZWN0aW9uQmFja2VuZCwKICAgIERhdGFiYXNlQmFja2VuZCwKICAgIFJlY29yZCwKICAgIFRyYW5zYWN0aW9uQmFja2VuZCwKKQoKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoInF1YW50aXVtYmFzZSIpCgoKY2xhc3MgQWlvcGdCYWNrZW5kKERhdGFiYXNlQmFja2VuZCk6CiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwgZGF0YWJhc2VfdXJsOiB0eXBpbmcuVW5pb25bRGF0YWJhc2VVUkwsIHN0cl0sICoqb3B0aW9uczogdHlwaW5nLkFueQogICAgKSAtPiBOb25lOgogICAgICAgIHNlbGYuX2RhdGFiYXNlX3VybCA9IERhdGFiYXNlVVJMKGRhdGFiYXNlX3VybCkKICAgICAgICBzZWxmLl9vcHRpb25zID0gb3B0aW9ucwogICAgICAgIHNlbGYuX2RpYWxlY3QgPSBzZWxmLl9nZXRfZGlhbGVjdCgpCiAgICAgICAgc2VsZi5fcG9vbDogdHlwaW5nLlVuaW9uW2Fpb3BnLlBvb2wsIE5vbmVdID0gTm9uZQoKICAgIGRlZiBfZ2V0X2RpYWxlY3Qoc2VsZikgLT4gRGlhbGVjdDoKICAgICAgICBkaWFsZWN0ID0gUEdEaWFsZWN0X3BzeWNvcGcyKAogICAgICAgICAgICBqc29uX3NlcmlhbGl6ZXI9anNvbi5kdW1wcywganNvbl9kZXNlcmlhbGl6ZXI9bGFtYmRhIHg6IHgKICAgICAgICApCiAgICAgICAgZGlhbGVjdC5zdGF0ZW1lbnRfY29tcGlsZXIgPSBBUEdDb21waWxlcl9wc3ljb3BnMgogICAgICAgIGRpYWxlY3QuaW1wbGljaXRfcmV0dXJuaW5nID0gVHJ1ZQogICAgICAgIGRpYWxlY3Quc3VwcG9ydHNfbmF0aXZlX2VudW0gPSBUcnVlCiAgICAgICAgZGlhbGVjdC5zdXBwb3J0c19zbWFsbHNlcmlhbCA9IFRydWUgICMgOS4yKwogICAgICAgIGRpYWxlY3QuX2JhY2tzbGFzaF9lc2NhcGVzID0gRmFsc2UKICAgICAgICBkaWFsZWN0LnN1cHBvcnRzX3NhbmVfbXVsdGlfcm93Y291bnQgPSBUcnVlICAjIHBzeWNvcGcgMi4wLjkrCiAgICAgICAgZGlhbGVjdC5faGFzX25hdGl2ZV9oc3RvcmUgPSBUcnVlCiAgICAgICAgZGlhbGVjdC5zdXBwb3J0c19uYXRpdmVfZGVjaW1hbCA9IFRydWUKCiAgICAgICAgcmV0dXJuIGRpYWxlY3QKCiAgICBkZWYgX2dldF9jb25uZWN0aW9uX2t3YXJncyhzZWxmKSAtPiBkaWN0OgogICAgICAgIHVybF9vcHRpb25zID0gc2VsZi5fZGF0YWJhc2VfdXJsLm9wdGlvbnMKCiAgICAgICAga3dhcmdzID0ge30KICAgICAgICBtaW5fc2l6ZSA9IHVybF9vcHRpb25zLmdldCgibWluX3NpemUiKQogICAgICAgIG1heF9zaXplID0gdXJsX29wdGlvbnMuZ2V0KCJtYXhfc2l6ZSIpCiAgICAgICAgc3NsID0gdXJsX29wdGlvbnMuZ2V0KCJzc2wiKQoKICAgICAgICBpZiBtaW5fc2l6ZSBpcyBub3QgTm9uZToKICAgICAgICAgICAga3dhcmdzWyJtaW5zaXplIl0gPSBpbnQobWluX3NpemUpCiAgICAgICAgaWYgbWF4X3NpemUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGt3YXJnc1sibWF4c2l6ZSJdID0gaW50KG1heF9zaXplKQogICAgICAgIGlmIHNzbCBpcyBub3QgTm9uZToKICAgICAgICAgICAga3dhcmdzWyJzc2wiXSA9IHsidHJ1ZSI6IFRydWUsICJmYWxzZSI6IEZhbHNlfVtzc2wubG93ZXIoKV0KCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gc2VsZi5fb3B0aW9ucy5pdGVtcygpOgogICAgICAgICAgICAjIENvZXJjZSAnbWluX3NpemUnIGFuZCAnbWF4X3NpemUnIGZvciBjb25zaXN0ZW5jeS4KICAgICAgICAgICAgaWYga2V5ID09ICJtaW5fc2l6ZSI6CiAgICAgICAgICAgICAgICBrZXkgPSAibWluc2l6ZSIKICAgICAgICAgICAgZWxpZiBrZXkgPT0gIm1heF9zaXplIjoKICAgICAgICAgICAgICAgIGtleSA9ICJtYXhzaXplIgogICAgICAgICAgICBrd2FyZ3Nba2V5XSA9IHZhbHVlCgogICAgICAgIHJldHVybiBrd2FyZ3MKCiAgICBhc3luYyBkZWYgY29ubmVjdChzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9wb29sIGlzIE5vbmUsICJEYXRhYmFzZUJhY2tlbmQgaXMgYWxyZWFkeSBydW5uaW5nIgogICAgICAgIGt3YXJncyA9IHNlbGYuX2dldF9jb25uZWN0aW9uX2t3YXJncygpCiAgICAgICAgc2VsZi5fcG9vbCA9IGF3YWl0IGFpb3BnLmNyZWF0ZV9wb29sKAogICAgICAgICAgICBob3N0PXNlbGYuX2RhdGFiYXNlX3VybC5ob3N0bmFtZSwKICAgICAgICAgICAgcG9ydD1zZWxmLl9kYXRhYmFzZV91cmwucG9ydCwKICAgICAgICAgICAgdXNlcj1zZWxmLl9kYXRhYmFzZV91cmwudXNlcm5hbWUgb3IgZ2V0cGFzcy5nZXR1c2VyKCksCiAgICAgICAgICAgIHBhc3N3b3JkPXNlbGYuX2RhdGFiYXNlX3VybC5wYXNzd29yZCwKICAgICAgICAgICAgZGF0YWJhc2U9c2VsZi5fZGF0YWJhc2VfdXJsLmRhdGFiYXNlLAogICAgICAgICAgICAqKmt3YXJncywKICAgICAgICApCgogICAgYXN5bmMgZGVmIGRpc2Nvbm5lY3Qoc2VsZikgLT4gTm9uZToKICAgICAgICBhc3NlcnQgc2VsZi5fcG9vbCBpcyBub3QgTm9uZSwgIkRhdGFiYXNlQmFja2VuZCBpcyBub3QgcnVubmluZyIKICAgICAgICBzZWxmLl9wb29sLmNsb3NlKCkKICAgICAgICBhd2FpdCBzZWxmLl9wb29sLndhaXRfY2xvc2VkKCkKICAgICAgICBzZWxmLl9wb29sID0gTm9uZQoKICAgIGRlZiBjb25uZWN0aW9uKHNlbGYpIC0+ICJBaW9wZ0Nvbm5lY3Rpb24iOgogICAgICAgIHJldHVybiBBaW9wZ0Nvbm5lY3Rpb24oc2VsZiwgc2VsZi5fZGlhbGVjdCkKCgpjbGFzcyBDb21waWxhdGlvbkNvbnRleHQ6CiAgICBkZWYgX19pbml0X18oc2VsZiwgY29udGV4dDogRXhlY3V0aW9uQ29udGV4dCk6CiAgICAgICAgc2VsZi5jb250ZXh0ID0gY29udGV4dAoKCmNsYXNzIEFpb3BnQ29ubmVjdGlvbihDb25uZWN0aW9uQmFja2VuZCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGF0YWJhc2U6IEFpb3BnQmFja2VuZCwgZGlhbGVjdDogRGlhbGVjdCk6CiAgICAgICAgc2VsZi5fZGF0YWJhc2UgPSBkYXRhYmFzZQogICAgICAgIHNlbGYuX2RpYWxlY3QgPSBkaWFsZWN0CiAgICAgICAgc2VsZi5fY29ubmVjdGlvbiA9IE5vbmUgICMgdHlwZTogdHlwaW5nLk9wdGlvbmFsW2Fpb3BnLkNvbm5lY3Rpb25dCgogICAgYXN5bmMgZGVmIGFjcXVpcmUoc2VsZikgLT4gTm9uZToKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbiBpcyBOb25lLCAiQ29ubmVjdGlvbiBpcyBhbHJlYWR5IGFjcXVpcmVkIgogICAgICAgIGFzc2VydCBzZWxmLl9kYXRhYmFzZS5fcG9vbCBpcyBub3QgTm9uZSwgIkRhdGFiYXNlQmFja2VuZCBpcyBub3QgcnVubmluZyIKICAgICAgICBzZWxmLl9jb25uZWN0aW9uID0gYXdhaXQgc2VsZi5fZGF0YWJhc2UuX3Bvb2wuYWNxdWlyZSgpCgogICAgYXN5bmMgZGVmIHJlbGVhc2Uoc2VsZikgLT4gTm9uZToKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbiBpcyBub3QgTm9uZSwgIkNvbm5lY3Rpb24gaXMgbm90IGFjcXVpcmVkIgogICAgICAgIGFzc2VydCBzZWxmLl9kYXRhYmFzZS5fcG9vbCBpcyBub3QgTm9uZSwgIkRhdGFiYXNlQmFja2VuZCBpcyBub3QgcnVubmluZyIKICAgICAgICBhd2FpdCBzZWxmLl9kYXRhYmFzZS5fcG9vbC5yZWxlYXNlKHNlbGYuX2Nvbm5lY3Rpb24pCiAgICAgICAgc2VsZi5fY29ubmVjdGlvbiA9IE5vbmUKCiAgICBhc3luYyBkZWYgZmV0Y2hfYWxsKHNlbGYsIHF1ZXJ5OiBDbGF1c2VFbGVtZW50KSAtPiB0eXBpbmcuTGlzdFtSZWNvcmRdOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgcXVlcnlfc3RyLCBhcmdzLCBjb250ZXh0ID0gc2VsZi5fY29tcGlsZShxdWVyeSkKICAgICAgICBjdXJzb3IgPSBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLmN1cnNvcigpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBhd2FpdCBjdXJzb3IuZXhlY3V0ZShxdWVyeV9zdHIsIGFyZ3MpCiAgICAgICAgICAgIHJvd3MgPSBhd2FpdCBjdXJzb3IuZmV0Y2hhbGwoKQogICAgICAgICAgICBtZXRhZGF0YSA9IEN1cnNvclJlc3VsdE1ldGFEYXRhKGNvbnRleHQsIGN1cnNvci5kZXNjcmlwdGlvbikKICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgIFJvdygKICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YSwKICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5fcHJvY2Vzc29ycywKICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5fa2V5bWFwLAogICAgICAgICAgICAgICAgICAgIFJvdy5fZGVmYXVsdF9rZXlfc3R5bGUsCiAgICAgICAgICAgICAgICAgICAgcm93LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZm9yIHJvdyBpbiByb3dzCiAgICAgICAgICAgIF0KICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQoKICAgIGFzeW5jIGRlZiBmZXRjaF9vbmUoc2VsZiwgcXVlcnk6IENsYXVzZUVsZW1lbnQpIC0+IHR5cGluZy5PcHRpb25hbFtSZWNvcmRdOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgcXVlcnlfc3RyLCBhcmdzLCBjb250ZXh0ID0gc2VsZi5fY29tcGlsZShxdWVyeSkKICAgICAgICBjdXJzb3IgPSBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLmN1cnNvcigpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBhd2FpdCBjdXJzb3IuZXhlY3V0ZShxdWVyeV9zdHIsIGFyZ3MpCiAgICAgICAgICAgIHJvdyA9IGF3YWl0IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgICAgIGlmIHJvdyBpcyBOb25lOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgbWV0YWRhdGEgPSBDdXJzb3JSZXN1bHRNZXRhRGF0YShjb250ZXh0LCBjdXJzb3IuZGVzY3JpcHRpb24pCiAgICAgICAgICAgIHJldHVybiBSb3coCiAgICAgICAgICAgICAgICBtZXRhZGF0YSwKICAgICAgICAgICAgICAgIG1ldGFkYXRhLl9wcm9jZXNzb3JzLAogICAgICAgICAgICAgICAgbWV0YWRhdGEuX2tleW1hcCwKICAgICAgICAgICAgICAgIFJvdy5fZGVmYXVsdF9rZXlfc3R5bGUsCiAgICAgICAgICAgICAgICByb3csCiAgICAgICAgICAgICkKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQoKICAgIGFzeW5jIGRlZiBleGVjdXRlKHNlbGYsIHF1ZXJ5OiBDbGF1c2VFbGVtZW50KSAtPiB0eXBpbmcuQW55OgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgcXVlcnlfc3RyLCBhcmdzLCBjb250ZXh0ID0gc2VsZi5fY29tcGlsZShxdWVyeSkKICAgICAgICBjdXJzb3IgPSBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLmN1cnNvcigpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBhd2FpdCBjdXJzb3IuZXhlY3V0ZShxdWVyeV9zdHIsIGFyZ3MpCiAgICAgICAgICAgIHJldHVybiBjdXJzb3IubGFzdHJvd2lkCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCkKCiAgICBhc3luYyBkZWYgZXhlY3V0ZV9tYW55KHNlbGYsIHF1ZXJpZXM6IHR5cGluZy5MaXN0W0NsYXVzZUVsZW1lbnRdKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgY3Vyc29yID0gYXdhaXQgc2VsZi5fY29ubmVjdGlvbi5jdXJzb3IoKQogICAgICAgIHRyeToKICAgICAgICAgICAgZm9yIHNpbmdsZV9xdWVyeSBpbiBxdWVyaWVzOgogICAgICAgICAgICAgICAgc2luZ2xlX3F1ZXJ5LCBhcmdzLCBjb250ZXh0ID0gc2VsZi5fY29tcGlsZShzaW5nbGVfcXVlcnkpCiAgICAgICAgICAgICAgICBhd2FpdCBjdXJzb3IuZXhlY3V0ZShzaW5nbGVfcXVlcnksIGFyZ3MpCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCkKCiAgICBhc3luYyBkZWYgaXRlcmF0ZSgKICAgICAgICBzZWxmLCBxdWVyeTogQ2xhdXNlRWxlbWVudAogICAgKSAtPiB0eXBpbmcuQXN5bmNHZW5lcmF0b3JbdHlwaW5nLkFueSwgTm9uZV06CiAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUsICJDb25uZWN0aW9uIGlzIG5vdCBhY3F1aXJlZCIKICAgICAgICBxdWVyeV9zdHIsIGFyZ3MsIGNvbnRleHQgPSBzZWxmLl9jb21waWxlKHF1ZXJ5KQogICAgICAgIGN1cnNvciA9IGF3YWl0IHNlbGYuX2Nvbm5lY3Rpb24uY3Vyc29yKCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGF3YWl0IGN1cnNvci5leGVjdXRlKHF1ZXJ5X3N0ciwgYXJncykKICAgICAgICAgICAgbWV0YWRhdGEgPSBDdXJzb3JSZXN1bHRNZXRhRGF0YShjb250ZXh0LCBjdXJzb3IuZGVzY3JpcHRpb24pCiAgICAgICAgICAgIGFzeW5jIGZvciByb3cgaW4gY3Vyc29yOgogICAgICAgICAgICAgICAgeWllbGQgUm93KAogICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLAogICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLl9wcm9jZXNzb3JzLAogICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLl9rZXltYXAsCiAgICAgICAgICAgICAgICAgICAgUm93Ll9kZWZhdWx0X2tleV9zdHlsZSwKICAgICAgICAgICAgICAgICAgICByb3csCiAgICAgICAgICAgICAgICApCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCkKCiAgICBkZWYgdHJhbnNhY3Rpb24oc2VsZikgLT4gVHJhbnNhY3Rpb25CYWNrZW5kOgogICAgICAgIHJldHVybiBBaW9wZ1RyYW5zYWN0aW9uKHNlbGYpCgogICAgZGVmIF9jb21waWxlKAogICAgICAgIHNlbGYsIHF1ZXJ5OiBDbGF1c2VFbGVtZW50CiAgICApIC0+IHR5cGluZy5UdXBsZVtzdHIsIGRpY3QsIENvbXBpbGF0aW9uQ29udGV4dF06CiAgICAgICAgY29tcGlsZWQgPSBxdWVyeS5jb21waWxlKAogICAgICAgICAgICBkaWFsZWN0PXNlbGYuX2RpYWxlY3QsIGNvbXBpbGVfa3dhcmdzPXsicmVuZGVyX3Bvc3Rjb21waWxlIjogVHJ1ZX0KICAgICAgICApCgogICAgICAgIGV4ZWN1dGlvbl9jb250ZXh0ID0gc2VsZi5fZGlhbGVjdC5leGVjdXRpb25fY3R4X2NscygpCiAgICAgICAgZXhlY3V0aW9uX2NvbnRleHQuZGlhbGVjdCA9IHNlbGYuX2RpYWxlY3QKCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UocXVlcnksIERETEVsZW1lbnQpOgogICAgICAgICAgICBhcmdzID0gY29tcGlsZWQuY29uc3RydWN0X3BhcmFtcygpCiAgICAgICAgICAgIGZvciBrZXksIHZhbCBpbiBhcmdzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiBrZXkgaW4gY29tcGlsZWQuX2JpbmRfcHJvY2Vzc29yczoKICAgICAgICAgICAgICAgICAgICBhcmdzW2tleV0gPSBjb21waWxlZC5fYmluZF9wcm9jZXNzb3JzW2tleV0odmFsKQoKICAgICAgICAgICAgZXhlY3V0aW9uX2NvbnRleHQucmVzdWx0X2NvbHVtbl9zdHJ1Y3QgPSAoCiAgICAgICAgICAgICAgICBjb21waWxlZC5fcmVzdWx0X2NvbHVtbnMsCiAgICAgICAgICAgICAgICBjb21waWxlZC5fb3JkZXJlZF9jb2x1bW5zLAogICAgICAgICAgICAgICAgY29tcGlsZWQuX3RleHR1YWxfb3JkZXJlZF9jb2x1bW5zLAogICAgICAgICAgICAgICAgY29tcGlsZWQuX2FkX2hvY190ZXh0dWFsLAogICAgICAgICAgICAgICAgY29tcGlsZWQuX2xvb3NlX2NvbHVtbl9uYW1lX21hdGNoaW5nLAogICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXJncyA9IHt9CgogICAgICAgIGxvZ2dlci5kZWJ1ZygiUXVlcnk6ICVzXG5BcmdzOiAlcyIsIGNvbXBpbGVkLnN0cmluZywgYXJncykKICAgICAgICByZXR1cm4gY29tcGlsZWQuc3RyaW5nLCBhcmdzLCBDb21waWxhdGlvbkNvbnRleHQoZXhlY3V0aW9uX2NvbnRleHQpCgogICAgQHByb3BlcnR5CiAgICBkZWYgcmF3X2Nvbm5lY3Rpb24oc2VsZikgLT4gYWlvcGcuY29ubmVjdGlvbi5Db25uZWN0aW9uOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgcmV0dXJuIHNlbGYuX2Nvbm5lY3Rpb24KCgpjbGFzcyBBaW9wZ1RyYW5zYWN0aW9uKFRyYW5zYWN0aW9uQmFja2VuZCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgY29ubmVjdGlvbjogQWlvcGdDb25uZWN0aW9uKToKICAgICAgICBzZWxmLl9jb25uZWN0aW9uID0gY29ubmVjdGlvbgogICAgICAgIHNlbGYuX2lzX3Jvb3QgPSBGYWxzZQogICAgICAgIHNlbGYuX3NhdmVwb2ludF9uYW1lID0gIiIKCiAgICBhc3luYyBkZWYgc3RhcnQoCiAgICAgICAgc2VsZiwgaXNfcm9vdDogYm9vbCwgZXh0cmFfb3B0aW9uczogdHlwaW5nLkRpY3RbdHlwaW5nLkFueSwgdHlwaW5nLkFueV0KICAgICkgLT4gTm9uZToKICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbiBpcyBub3QgTm9uZSwgIkNvbm5lY3Rpb24gaXMgbm90IGFjcXVpcmVkIgogICAgICAgIHNlbGYuX2lzX3Jvb3QgPSBpc19yb290CiAgICAgICAgY3Vyc29yID0gYXdhaXQgc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbi5jdXJzb3IoKQogICAgICAgIGlmIHNlbGYuX2lzX3Jvb3Q6CiAgICAgICAgICAgIGF3YWl0IGN1cnNvci5leGVjdXRlKCJCRUdJTiIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWQgPSBzdHIodXVpZC51dWlkNCgpKS5yZXBsYWNlKCItIiwgIl8iKQogICAgICAgICAgICBzZWxmLl9zYXZlcG9pbnRfbmFtZSA9IGYiU1RBUkxFVFRFX1NBVkVQT0lOVF97aWR9IgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhd2FpdCBjdXJzb3IuZXhlY3V0ZShmIlNBVkVQT0lOVCB7c2VsZi5fc2F2ZXBvaW50X25hbWV9IikKICAgICAgICAgICAgZmluYWxseToKICAgICAgICAgICAgICAgIGN1cnNvci5jbG9zZSgpCgogICAgYXN5bmMgZGVmIGNvbW1pdChzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgY3Vyc29yID0gYXdhaXQgc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbi5jdXJzb3IoKQogICAgICAgIGlmIHNlbGYuX2lzX3Jvb3Q6CiAgICAgICAgICAgIGF3YWl0IGN1cnNvci5leGVjdXRlKCJDT01NSVQiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGF3YWl0IGN1cnNvci5leGVjdXRlKGYiUkVMRUFTRSBTQVZFUE9JTlQge3NlbGYuX3NhdmVwb2ludF9uYW1lfSIpCiAgICAgICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQoKICAgIGFzeW5jIGRlZiByb2xsYmFjayhzZWxmKSAtPiBOb25lOgogICAgICAgIGFzc2VydCBzZWxmLl9jb25uZWN0aW9uLl9jb25uZWN0aW9uIGlzIG5vdCBOb25lLCAiQ29ubmVjdGlvbiBpcyBub3QgYWNxdWlyZWQiCiAgICAgICAgY3Vyc29yID0gYXdhaXQgc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbi5jdXJzb3IoKQogICAgICAgIGlmIHNlbGYuX2lzX3Jvb3Q6CiAgICAgICAgICAgIGF3YWl0IGN1cnNvci5leGVjdXRlKCJST0xMQkFDSyIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYXdhaXQgY3Vyc29yLmV4ZWN1dGUoZiJST0xMQkFDSyBUTyBTQVZFUE9JTlQge3NlbGYuX3NhdmVwb2ludF9uYW1lfSIpCiAgICAgICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQo=
