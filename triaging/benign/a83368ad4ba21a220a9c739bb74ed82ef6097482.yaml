statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/urlib3/1.21.1/urlib3-1.21.1/urlib3-1.21.1/test/test_util.py
  contents:
  - name: TestUtil.test_invalid_host
    score: 0.0
    code: |-
      def test_invalid_host(self):
              # TODO: Add more tests
              invalid_host = [
                  'http://google.com:foo',
                  'http://::1/',
                  'http://::1:80/',
                  'http://google.com:-80',
                  six.u('http://google.com:\xb2\xb2'),  # \xb2 = ^2
              ]

              for location in invalid_host:
                  self.assertRaises(LocationParseError, get_host, location)
    tokens: resume load_const STRING_URL load_const STRING_URL load_const STRING_URL load_const STRING_URL load_global six load_attr u load_const STRING_URL call build_list store_fast invalid_host load_fast invalid_host get_iter for_iter TO_NUMBER store_fast location load_fast self load_attr assertRaises load_global STRING_LEN_S_ENT_HIGH load_global get_host load_fast location call pop_top jump_backward TO_NUMBER end_for return_const None
    hash: 3dd1cdfaf20d336afd51c5735bdca3c56216caa6d812c36cb0463ab6d9f0d0d4
sources:
  .repo_cache/malicious_repos/pypi_malregistry/urlib3/1.21.1/urlib3-1.21.1/urlib3-1.21.1/test/test_util.py: aW1wb3J0IGhhc2hsaWIKaW1wb3J0IHdhcm5pbmdzCmltcG9ydCBsb2dnaW5nCmltcG9ydCBpbwppbXBvcnQgdW5pdHRlc3QKaW1wb3J0IHNzbAppbXBvcnQgc29ja2V0CmZyb20gaXRlcnRvb2xzIGltcG9ydCBjaGFpbgoKZnJvbSBtb2NrIGltcG9ydCBwYXRjaCwgTW9jawoKZnJvbSB1cmxsaWIzIGltcG9ydCBhZGRfc3RkZXJyX2xvZ2dlciwgZGlzYWJsZV93YXJuaW5ncwpmcm9tIHVybGxpYjMudXRpbC5yZXF1ZXN0IGltcG9ydCBtYWtlX2hlYWRlcnMsIHJld2luZF9ib2R5LCBfRkFJTEVEVEVMTApmcm9tIHVybGxpYjMudXRpbC5yZXRyeSBpbXBvcnQgUmV0cnkKZnJvbSB1cmxsaWIzLnV0aWwudGltZW91dCBpbXBvcnQgVGltZW91dApmcm9tIHVybGxpYjMudXRpbC51cmwgaW1wb3J0ICgKICAgIGdldF9ob3N0LAogICAgcGFyc2VfdXJsLAogICAgc3BsaXRfZmlyc3QsCiAgICBVcmwsCikKZnJvbSB1cmxsaWIzLnV0aWwuc3NsXyBpbXBvcnQgKAogICAgcmVzb2x2ZV9jZXJ0X3JlcXMsCiAgICByZXNvbHZlX3NzbF92ZXJzaW9uLAogICAgc3NsX3dyYXBfc29ja2V0LAogICAgX2NvbnN0X2NvbXBhcmVfZGlnZXN0X2JhY2twb3J0LAopCmZyb20gdXJsbGliMy5leGNlcHRpb25zIGltcG9ydCAoCiAgICBMb2NhdGlvblBhcnNlRXJyb3IsCiAgICBUaW1lb3V0U3RhdGVFcnJvciwKICAgIEluc2VjdXJlUmVxdWVzdFdhcm5pbmcsCiAgICBTTklNaXNzaW5nV2FybmluZywKICAgIEludmFsaWRIZWFkZXIsCiAgICBVbnJld2luZGFibGVCb2R5RXJyb3IsCikKZnJvbSB1cmxsaWIzLnV0aWwuY29ubmVjdGlvbiBpbXBvcnQgKAogICAgYWxsb3dlZF9nYWlfZmFtaWx5LAogICAgX2hhc19pcHY2CikKZnJvbSB1cmxsaWIzLnV0aWwgaW1wb3J0IGlzX2ZwX2Nsb3NlZCwgc3NsXwpmcm9tIHVybGxpYjMucGFja2FnZXMgaW1wb3J0IHNpeAoKZnJvbSAuIGltcG9ydCBjbGVhcl93YXJuaW5ncwoKIyBUaGlzIG51bWJlciByZXByZXNlbnRzIGEgdGltZSBpbiBzZWNvbmRzLCBpdCBkb2Vzbid0IG1lYW4gYW55dGhpbmcgaW4KIyBpc29sYXRpb24uIFNldHRpbmcgdG8gYSBoaWdoLWlzaCB2YWx1ZSB0byBhdm9pZCBjb25mbGljdHMgd2l0aCB0aGUgc21hbGxlcgojIG51bWJlcnMgdXNlZCBmb3IgdGltZW91dHMKVElNRU9VVF9FUE9DSCA9IDEwMDAKCgpjbGFzcyBUZXN0VXRpbCh1bml0dGVzdC5UZXN0Q2FzZSk6CiAgICBkZWYgdGVzdF9nZXRfaG9zdChzZWxmKToKICAgICAgICB1cmxfaG9zdF9tYXAgPSB7CiAgICAgICAgICAgICMgSG9zdHMKICAgICAgICAgICAgJ2h0dHA6Ly9nb29nbGUuY29tL21haWwnOiAoJ2h0dHAnLCAnZ29vZ2xlLmNvbScsIE5vbmUpLAogICAgICAgICAgICAnaHR0cDovL2dvb2dsZS5jb20vbWFpbC8nOiAoJ2h0dHAnLCAnZ29vZ2xlLmNvbScsIE5vbmUpLAogICAgICAgICAgICAnZ29vZ2xlLmNvbS9tYWlsJzogKCdodHRwJywgJ2dvb2dsZS5jb20nLCBOb25lKSwKICAgICAgICAgICAgJ2h0dHA6Ly9nb29nbGUuY29tLyc6ICgnaHR0cCcsICdnb29nbGUuY29tJywgTm9uZSksCiAgICAgICAgICAgICdodHRwOi8vZ29vZ2xlLmNvbSc6ICgnaHR0cCcsICdnb29nbGUuY29tJywgTm9uZSksCiAgICAgICAgICAgICdodHRwOi8vd3d3Lmdvb2dsZS5jb20nOiAoJ2h0dHAnLCAnd3d3Lmdvb2dsZS5jb20nLCBOb25lKSwKICAgICAgICAgICAgJ2h0dHA6Ly9tYWlsLmdvb2dsZS5jb20nOiAoJ2h0dHAnLCAnbWFpbC5nb29nbGUuY29tJywgTm9uZSksCiAgICAgICAgICAgICdodHRwOi8vZ29vZ2xlLmNvbTo4MDAwL21haWwvJzogKCdodHRwJywgJ2dvb2dsZS5jb20nLCA4MDAwKSwKICAgICAgICAgICAgJ2h0dHA6Ly9nb29nbGUuY29tOjgwMDAnOiAoJ2h0dHAnLCAnZ29vZ2xlLmNvbScsIDgwMDApLAogICAgICAgICAgICAnaHR0cHM6Ly9nb29nbGUuY29tJzogKCdodHRwcycsICdnb29nbGUuY29tJywgTm9uZSksCiAgICAgICAgICAgICdodHRwczovL2dvb2dsZS5jb206ODAwMCc6ICgnaHR0cHMnLCAnZ29vZ2xlLmNvbScsIDgwMDApLAogICAgICAgICAgICAnaHR0cDovL3VzZXI6cGFzc3dvcmRAMTI3LjAuMC4xOjEyMzQnOiAoJ2h0dHAnLCAnMTI3LjAuMC4xJywgMTIzNCksCiAgICAgICAgICAgICdodHRwOi8vZ29vZ2xlLmNvbS9mb289aHR0cDovL2Jhcjo0Mi9iYXonOiAoJ2h0dHAnLCAnZ29vZ2xlLmNvbScsIE5vbmUpLAogICAgICAgICAgICAnaHR0cDovL2dvb2dsZS5jb20/Zm9vPWh0dHA6Ly9iYXI6NDIvYmF6JzogKCdodHRwJywgJ2dvb2dsZS5jb20nLCBOb25lKSwKICAgICAgICAgICAgJ2h0dHA6Ly9nb29nbGUuY29tI2Zvbz1odHRwOi8vYmFyOjQyL2Jheic6ICgnaHR0cCcsICdnb29nbGUuY29tJywgTm9uZSksCgogICAgICAgICAgICAjIElQdjQKICAgICAgICAgICAgJzE3My4xOTQuMzUuNyc6ICgnaHR0cCcsICcxNzMuMTk0LjM1LjcnLCBOb25lKSwKICAgICAgICAgICAgJ2h0dHA6Ly8xNzMuMTk0LjM1LjcnOiAoJ2h0dHAnLCAnMTczLjE5NC4zNS43JywgTm9uZSksCiAgICAgICAgICAgICdodHRwOi8vMTczLjE5NC4zNS43L3Rlc3QnOiAoJ2h0dHAnLCAnMTczLjE5NC4zNS43JywgTm9uZSksCiAgICAgICAgICAgICdodHRwOi8vMTczLjE5NC4zNS43OjgwJzogKCdodHRwJywgJzE3My4xOTQuMzUuNycsIDgwKSwKICAgICAgICAgICAgJ2h0dHA6Ly8xNzMuMTk0LjM1Ljc6ODAvdGVzdCc6ICgnaHR0cCcsICcxNzMuMTk0LjM1LjcnLCA4MCksCgogICAgICAgICAgICAjIElQdjYKICAgICAgICAgICAgJ1syYTAwOjE0NTA6NDAwMTpjMDE6OjY3XSc6ICgnaHR0cCcsICdbMmEwMDoxNDUwOjQwMDE6YzAxOjo2N10nLCBOb25lKSwKICAgICAgICAgICAgJ2h0dHA6Ly9bMmEwMDoxNDUwOjQwMDE6YzAxOjo2N10nOiAoJ2h0dHAnLCAnWzJhMDA6MTQ1MDo0MDAxOmMwMTo6NjddJywgTm9uZSksCiAgICAgICAgICAgICdodHRwOi8vWzJhMDA6MTQ1MDo0MDAxOmMwMTo6NjddL3Rlc3QnOiAoJ2h0dHAnLCAnWzJhMDA6MTQ1MDo0MDAxOmMwMTo6NjddJywgTm9uZSksCiAgICAgICAgICAgICdodHRwOi8vWzJhMDA6MTQ1MDo0MDAxOmMwMTo6NjddOjgwJzogKCdodHRwJywgJ1syYTAwOjE0NTA6NDAwMTpjMDE6OjY3XScsIDgwKSwKICAgICAgICAgICAgJ2h0dHA6Ly9bMmEwMDoxNDUwOjQwMDE6YzAxOjo2N106ODAvdGVzdCc6ICgnaHR0cCcsICdbMmEwMDoxNDUwOjQwMDE6YzAxOjo2N10nLCA4MCksCgogICAgICAgICAgICAjIE1vcmUgSVB2NiBmcm9tIGh0dHA6Ly93d3cuaWV0Zi5vcmcvcmZjL3JmYzI3MzIudHh0CiAgICAgICAgICAgICdodHRwOi8vW2ZlZGM6YmE5ODo3NjU0OjMyMTA6ZmVkYzpiYTk4Ojc2NTQ6MzIxMF06ODAwMC9pbmRleC5odG1sJzogKAogICAgICAgICAgICAgICAgJ2h0dHAnLCAnW2ZlZGM6YmE5ODo3NjU0OjMyMTA6ZmVkYzpiYTk4Ojc2NTQ6MzIxMF0nLCA4MDAwKSwKICAgICAgICAgICAgJ2h0dHA6Ly9bMTA4MDowOjA6MDo4OjgwMDoyMDBjOjQxN2FdL2luZGV4Lmh0bWwnOiAoCiAgICAgICAgICAgICAgICAnaHR0cCcsICdbMTA4MDowOjA6MDo4OjgwMDoyMDBjOjQxN2FdJywgTm9uZSksCiAgICAgICAgICAgICdodHRwOi8vWzNmZmU6MmEwMDoxMDA6NzAzMTo6MV0nOiAoJ2h0dHAnLCAnWzNmZmU6MmEwMDoxMDA6NzAzMTo6MV0nLCBOb25lKSwKICAgICAgICAgICAgJ2h0dHA6Ly9bMTA4MDo6ODo4MDA6MjAwYzo0MTdhXS9mb28nOiAoJ2h0dHAnLCAnWzEwODA6Ojg6ODAwOjIwMGM6NDE3YV0nLCBOb25lKSwKICAgICAgICAgICAgJ2h0dHA6Ly9bOjoxOTIuOS41LjVdL2lwbmcnOiAoJ2h0dHAnLCAnWzo6MTkyLjkuNS41XScsIE5vbmUpLAogICAgICAgICAgICAnaHR0cDovL1s6OmZmZmY6MTI5LjE0NC41Mi4zOF06NDIvaW5kZXguaHRtbCc6ICgnaHR0cCcsICdbOjpmZmZmOjEyOS4xNDQuNTIuMzhdJywgNDIpLAogICAgICAgICAgICAnaHR0cDovL1syMDEwOjgzNmI6NDE3OTo6ODM2Yjo0MTc5XSc6ICgnaHR0cCcsICdbMjAxMDo4MzZiOjQxNzk6OjgzNmI6NDE3OV0nLCBOb25lKSwKICAgICAgICB9CiAgICAgICAgZm9yIHVybCwgZXhwZWN0ZWRfaG9zdCBpbiB1cmxfaG9zdF9tYXAuaXRlbXMoKToKICAgICAgICAgICAgcmV0dXJuZWRfaG9zdCA9IGdldF9ob3N0KHVybCkKICAgICAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXR1cm5lZF9ob3N0LCBleHBlY3RlZF9ob3N0KQoKICAgIGRlZiB0ZXN0X2ludmFsaWRfaG9zdChzZWxmKToKICAgICAgICAjIFRPRE86IEFkZCBtb3JlIHRlc3RzCiAgICAgICAgaW52YWxpZF9ob3N0ID0gWwogICAgICAgICAgICAnaHR0cDovL2dvb2dsZS5jb206Zm9vJywKICAgICAgICAgICAgJ2h0dHA6Ly86OjEvJywKICAgICAgICAgICAgJ2h0dHA6Ly86OjE6ODAvJywKICAgICAgICAgICAgJ2h0dHA6Ly9nb29nbGUuY29tOi04MCcsCiAgICAgICAgICAgIHNpeC51KCdodHRwOi8vZ29vZ2xlLmNvbTpceGIyXHhiMicpLCAgIyBceGIyID0gXjIKICAgICAgICBdCgogICAgICAgIGZvciBsb2NhdGlvbiBpbiBpbnZhbGlkX2hvc3Q6CiAgICAgICAgICAgIHNlbGYuYXNzZXJ0UmFpc2VzKExvY2F0aW9uUGFyc2VFcnJvciwgZ2V0X2hvc3QsIGxvY2F0aW9uKQoKICAgIGRlZiB0ZXN0X2hvc3Rfbm9ybWFsaXphdGlvbihzZWxmKToKICAgICAgICAiIiIKICAgICAgICBBc3NlcnRzIHRoZSBzY2hlbWUgYW5kIGhvc3RzIHdpdGggYSBub3JtYWxpemFibGUgc2NoZW1lIGFyZQogICAgICAgIGNvbnZlcnRlZCB0byBsb3dlci1jYXNlLgogICAgICAgICIiIgogICAgICAgIHVybF9ob3N0X21hcCA9IHsKICAgICAgICAgICAgIyBIb3N0cwogICAgICAgICAgICAnSFRUUDovL0dPT0dMRS5DT00vbWFpbC8nOiAoJ2h0dHAnLCAnZ29vZ2xlLmNvbScsIE5vbmUpLAogICAgICAgICAgICAnR09vZ2xlLkNPTS9tYWlsJzogKCdodHRwJywgJ2dvb2dsZS5jb20nLCBOb25lKSwKICAgICAgICAgICAgJ0hUVFA6Ly9Hb09nTGUuQ29NOjgwMDAvbWFpbC8nOiAoJ2h0dHAnLCAnZ29vZ2xlLmNvbScsIDgwMDApLAogICAgICAgICAgICAnSFRUUDovL3VzZXI6cGFzc3dvcmRARVhBTVBMRS5DT006MTIzNCc6ICgnaHR0cCcsICdleGFtcGxlLmNvbScsIDEyMzQpLAogICAgICAgICAgICAnMTczLjE5NC4zNS43JzogKCdodHRwJywgJzE3My4xOTQuMzUuNycsIE5vbmUpLAogICAgICAgICAgICAnSFRUUDovLzE3My4xOTQuMzUuNyc6ICgnaHR0cCcsICcxNzMuMTk0LjM1LjcnLCBOb25lKSwKICAgICAgICAgICAgJ0hUVFA6Ly9bMmEwMDoxNDUwOjQwMDE6YzAxOjo2N106ODAvdGVzdCc6ICgnaHR0cCcsICdbMmEwMDoxNDUwOjQwMDE6YzAxOjo2N10nLCA4MCksCiAgICAgICAgICAgICdIVFRQOi8vW0ZFREM6QkE5ODo3NjU0OjMyMTA6RkVEQzpCQTk4Ojc2NTQ6MzIxMF06ODAwMC9pbmRleC5odG1sJzogKAogICAgICAgICAgICAgICAgJ2h0dHAnLCAnW2ZlZGM6YmE5ODo3NjU0OjMyMTA6ZmVkYzpiYTk4Ojc2NTQ6MzIxMF0nLCA4MDAwKSwKICAgICAgICAgICAgJ0hUVFBTOi8vWzEwODA6MDowOjA6ODo4MDA6MjAwYzo0MTdBXS9pbmRleC5odG1sJzogKAogICAgICAgICAgICAgICAgJ2h0dHBzJywgJ1sxMDgwOjA6MDowOjg6ODAwOjIwMGM6NDE3YV0nLCBOb25lKSwKICAgICAgICAgICAgJ2FiT3V0Oi8vZVhhbVBsRS5jb20/aW5mbz0xJzogKCdhYm91dCcsICdlWGFtUGxFLmNvbScsIE5vbmUpLAogICAgICAgICAgICAnaHR0cCtVTklYOi8vJTJmdmFyJTJmcnVuJTJmU09DS0VUL3BhdGgnOiAoCiAgICAgICAgICAgICAgICAnaHR0cCt1bml4JywgJyUyZnZhciUyZnJ1biUyZlNPQ0tFVCcsIE5vbmUpLAogICAgICAgIH0KICAgICAgICBmb3IgdXJsLCBleHBlY3RlZF9ob3N0IGluIHVybF9ob3N0X21hcC5pdGVtcygpOgogICAgICAgICAgICByZXR1cm5lZF9ob3N0ID0gZ2V0X2hvc3QodXJsKQogICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJldHVybmVkX2hvc3QsIGV4cGVjdGVkX2hvc3QpCgogICAgZGVmIHRlc3RfcGFyc2VfdXJsX25vcm1hbGl6YXRpb24oc2VsZik6CiAgICAgICAgIiIiQXNzZXJ0IHBhcnNlX3VybCBub3JtYWxpemVzIHRoZSBzY2hlbWUvaG9zdCwgYW5kIG9ubHkgdGhlIHNjaGVtZS9ob3N0IiIiCiAgICAgICAgdGVzdF91cmxzID0gWwogICAgICAgICAgICAoJ0hUVFA6Ly9HT09HTEUuQ09NL01BSUwvJywgJ2h0dHA6Ly9nb29nbGUuY29tL01BSUwvJyksCiAgICAgICAgICAgICgnSFRUUDovL0plcmVteUNsaW5lOkh1bnRlcjJARXhhbXBsZS5jb206ODA4MC8nLAogICAgICAgICAgICAgJ2h0dHA6Ly9KZXJlbXlDbGluZTpIdW50ZXIyQGV4YW1wbGUuY29tOjgwODAvJyksCiAgICAgICAgICAgICgnSFRUUFM6Ly9FeGFtcGxlLkNvbS8/S2V5PVZhbHVlJywgJ2h0dHBzOi8vZXhhbXBsZS5jb20vP0tleT1WYWx1ZScpLAogICAgICAgICAgICAoJ0h0dHBzOi8vRXhhbXBsZS5Db20vI0ZyYWdtZW50JywgJ2h0dHBzOi8vZXhhbXBsZS5jb20vI0ZyYWdtZW50JyksCiAgICAgICAgXQogICAgICAgIGZvciB1cmwsIGV4cGVjdGVkX25vcm1hbGl6ZWRfdXJsIGluIHRlc3RfdXJsczoKICAgICAgICAgICAgYWN0dWFsX25vcm1hbGl6ZWRfdXJsID0gcGFyc2VfdXJsKHVybCkudXJsCiAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoYWN0dWFsX25vcm1hbGl6ZWRfdXJsLCBleHBlY3RlZF9ub3JtYWxpemVkX3VybCkKCiAgICBwYXJzZV91cmxfaG9zdF9tYXAgPSBbCiAgICAgICAgKCdodHRwOi8vZ29vZ2xlLmNvbS9tYWlsJywgVXJsKCdodHRwJywgaG9zdD0nZ29vZ2xlLmNvbScsIHBhdGg9Jy9tYWlsJykpLAogICAgICAgICgnaHR0cDovL2dvb2dsZS5jb20vbWFpbC8nLCBVcmwoJ2h0dHAnLCBob3N0PSdnb29nbGUuY29tJywgcGF0aD0nL21haWwvJykpLAogICAgICAgICgnaHR0cDovL2dvb2dsZS5jb20vbWFpbCcsIFVybCgnaHR0cCcsIGhvc3Q9J2dvb2dsZS5jb20nLCBwYXRoPSdtYWlsJykpLAogICAgICAgICgnZ29vZ2xlLmNvbS9tYWlsJywgVXJsKGhvc3Q9J2dvb2dsZS5jb20nLCBwYXRoPScvbWFpbCcpKSwKICAgICAgICAoJ2h0dHA6Ly9nb29nbGUuY29tLycsIFVybCgnaHR0cCcsIGhvc3Q9J2dvb2dsZS5jb20nLCBwYXRoPScvJykpLAogICAgICAgICgnaHR0cDovL2dvb2dsZS5jb20nLCBVcmwoJ2h0dHAnLCBob3N0PSdnb29nbGUuY29tJykpLAogICAgICAgICgnaHR0cDovL2dvb2dsZS5jb20/Zm9vJywgVXJsKCdodHRwJywgaG9zdD0nZ29vZ2xlLmNvbScsIHBhdGg9JycsIHF1ZXJ5PSdmb28nKSksCgogICAgICAgICMgUGF0aC9xdWVyeS9mcmFnbWVudAogICAgICAgICgnJywgVXJsKCkpLAogICAgICAgICgnLycsIFVybChwYXRoPScvJykpLAogICAgICAgICgnIz8vIWdvb2dsZS5jb20vP2ZvbyNiYXInLCBVcmwocGF0aD0nJywgZnJhZ21lbnQ9Jz8vIWdvb2dsZS5jb20vP2ZvbyNiYXInKSksCiAgICAgICAgKCcvZm9vJywgVXJsKHBhdGg9Jy9mb28nKSksCiAgICAgICAgKCcvZm9vP2Jhcj1iYXonLCBVcmwocGF0aD0nL2ZvbycsIHF1ZXJ5PSdiYXI9YmF6JykpLAogICAgICAgICgnL2Zvbz9iYXI9YmF6I2JhbmFuYT9hcHBsZS9vcmFuZ2UnLCBVcmwocGF0aD0nL2ZvbycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeT0nYmFyPWJheicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudD0nYmFuYW5hP2FwcGxlL29yYW5nZScpKSwKCiAgICAgICAgIyBQb3J0CiAgICAgICAgKCdodHRwOi8vZ29vZ2xlLmNvbS8nLCBVcmwoJ2h0dHAnLCBob3N0PSdnb29nbGUuY29tJywgcGF0aD0nLycpKSwKICAgICAgICAoJ2h0dHA6Ly9nb29nbGUuY29tOjgwLycsIFVybCgnaHR0cCcsIGhvc3Q9J2dvb2dsZS5jb20nLCBwb3J0PTgwLCBwYXRoPScvJykpLAogICAgICAgICgnaHR0cDovL2dvb2dsZS5jb206ODAnLCBVcmwoJ2h0dHAnLCBob3N0PSdnb29nbGUuY29tJywgcG9ydD04MCkpLAoKICAgICAgICAjIEF1dGgKICAgICAgICAoJ2h0dHA6Ly9mb286YmFyQGxvY2FsaG9zdC8nLCBVcmwoJ2h0dHAnLCBhdXRoPSdmb286YmFyJywgaG9zdD0nbG9jYWxob3N0JywgcGF0aD0nLycpKSwKICAgICAgICAoJ2h0dHA6Ly9mb29AbG9jYWxob3N0LycsIFVybCgnaHR0cCcsIGF1dGg9J2ZvbycsIGhvc3Q9J2xvY2FsaG9zdCcsIHBhdGg9Jy8nKSksCiAgICAgICAgKCdodHRwOi8vZm9vOmJhckBiYXpAbG9jYWxob3N0LycsIFVybCgnaHR0cCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoPSdmb286YmFyQGJheicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0PSdsb2NhbGhvc3QnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aD0nLycpKSwKICAgICAgICAoJ2h0dHA6Ly9AJywgVXJsKCdodHRwJywgaG9zdD1Ob25lLCBhdXRoPScnKSkKICAgIF0KCiAgICBub25fcm91bmRfdHJpcHBpbmdfcGFyc2VfdXJsX2hvc3RfbWFwID0gewogICAgICAgICMgUGF0aC9xdWVyeS9mcmFnbWVudAogICAgICAgICc/JzogVXJsKHBhdGg9JycsIHF1ZXJ5PScnKSwKICAgICAgICAnIyc6IFVybChwYXRoPScnLCBmcmFnbWVudD0nJyksCgogICAgICAgICMgRW1wdHkgUG9ydAogICAgICAgICdodHRwOi8vZ29vZ2xlLmNvbTonOiBVcmwoJ2h0dHAnLCBob3N0PSdnb29nbGUuY29tJyksCiAgICAgICAgJ2h0dHA6Ly9nb29nbGUuY29tOi8nOiBVcmwoJ2h0dHAnLCBob3N0PSdnb29nbGUuY29tJywgcGF0aD0nLycpLAoKICAgICAgICB9CgogICAgZGVmIHRlc3RfcGFyc2VfdXJsKHNlbGYpOgogICAgICAgIGZvciB1cmwsIGV4cGVjdGVkX1VybCBpbiBjaGFpbihzZWxmLnBhcnNlX3VybF9ob3N0X21hcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5ub25fcm91bmRfdHJpcHBpbmdfcGFyc2VfdXJsX2hvc3RfbWFwLml0ZW1zKCkpOgogICAgICAgICAgICByZXR1cm5lZF9VcmwgPSBwYXJzZV91cmwodXJsKQogICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJldHVybmVkX1VybCwgZXhwZWN0ZWRfVXJsKQoKICAgIGRlZiB0ZXN0X3VucGFyc2VfdXJsKHNlbGYpOgogICAgICAgIGZvciB1cmwsIGV4cGVjdGVkX1VybCBpbiBzZWxmLnBhcnNlX3VybF9ob3N0X21hcDoKICAgICAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCh1cmwsIGV4cGVjdGVkX1VybC51cmwpCgogICAgZGVmIHRlc3RfcGFyc2VfdXJsX2ludmFsaWRfSVB2NihzZWxmKToKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhWYWx1ZUVycm9yLCBwYXJzZV91cmwsICdbOjoxJykKCiAgICBkZWYgdGVzdF9Vcmxfc3RyKHNlbGYpOgogICAgICAgIFUgPSBVcmwoJ2h0dHAnLCBob3N0PSdnb29nbGUuY29tJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHN0cihVKSwgVS51cmwpCgogICAgZGVmIHRlc3RfcmVxdWVzdF91cmkoc2VsZik6CiAgICAgICAgdXJsX2hvc3RfbWFwID0gewogICAgICAgICAgICAnaHR0cDovL2dvb2dsZS5jb20vbWFpbCc6ICcvbWFpbCcsCiAgICAgICAgICAgICdodHRwOi8vZ29vZ2xlLmNvbS9tYWlsLyc6ICcvbWFpbC8nLAogICAgICAgICAgICAnaHR0cDovL2dvb2dsZS5jb20vJzogJy8nLAogICAgICAgICAgICAnaHR0cDovL2dvb2dsZS5jb20nOiAnLycsCiAgICAgICAgICAgICcnOiAnLycsCiAgICAgICAgICAgICcvJzogJy8nLAogICAgICAgICAgICAnPyc6ICcvPycsCiAgICAgICAgICAgICcjJzogJy8nLAogICAgICAgICAgICAnL2Zvbz9iYXI9YmF6JzogJy9mb28/YmFyPWJheicsCiAgICAgICAgfQogICAgICAgIGZvciB1cmwsIGV4cGVjdGVkX3JlcXVlc3RfdXJpIGluIHVybF9ob3N0X21hcC5pdGVtcygpOgogICAgICAgICAgICByZXR1cm5lZF91cmwgPSBwYXJzZV91cmwodXJsKQogICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJldHVybmVkX3VybC5yZXF1ZXN0X3VyaSwgZXhwZWN0ZWRfcmVxdWVzdF91cmkpCgogICAgZGVmIHRlc3RfbmV0bG9jKHNlbGYpOgogICAgICAgIHVybF9uZXRsb2NfbWFwID0gewogICAgICAgICAgICAnaHR0cDovL2dvb2dsZS5jb20vbWFpbCc6ICdnb29nbGUuY29tJywKICAgICAgICAgICAgJ2h0dHA6Ly9nb29nbGUuY29tOjgwL21haWwnOiAnZ29vZ2xlLmNvbTo4MCcsCiAgICAgICAgICAgICdnb29nbGUuY29tL2Zvb2Jhcic6ICdnb29nbGUuY29tJywKICAgICAgICAgICAgJ2dvb2dsZS5jb206MTIzNDUnOiAnZ29vZ2xlLmNvbToxMjM0NScsCiAgICAgICAgfQoKICAgICAgICBmb3IgdXJsLCBleHBlY3RlZF9uZXRsb2MgaW4gdXJsX25ldGxvY19tYXAuaXRlbXMoKToKICAgICAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChwYXJzZV91cmwodXJsKS5uZXRsb2MsIGV4cGVjdGVkX25ldGxvYykKCiAgICBkZWYgdGVzdF9tYWtlX2hlYWRlcnMoc2VsZik6CiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgKICAgICAgICAgICAgbWFrZV9oZWFkZXJzKGFjY2VwdF9lbmNvZGluZz1UcnVlKSwKICAgICAgICAgICAgeydhY2NlcHQtZW5jb2RpbmcnOiAnZ3ppcCxkZWZsYXRlJ30pCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoCiAgICAgICAgICAgIG1ha2VfaGVhZGVycyhhY2NlcHRfZW5jb2Rpbmc9J2ZvbyxiYXInKSwKICAgICAgICAgICAgeydhY2NlcHQtZW5jb2RpbmcnOiAnZm9vLGJhcid9KQoKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKAogICAgICAgICAgICBtYWtlX2hlYWRlcnMoYWNjZXB0X2VuY29kaW5nPVsnZm9vJywgJ2JhciddKSwKICAgICAgICAgICAgeydhY2NlcHQtZW5jb2RpbmcnOiAnZm9vLGJhcid9KQoKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKAogICAgICAgICAgICBtYWtlX2hlYWRlcnMoYWNjZXB0X2VuY29kaW5nPVRydWUsIHVzZXJfYWdlbnQ9J2JhbmFuYScpLAogICAgICAgICAgICB7J2FjY2VwdC1lbmNvZGluZyc6ICdnemlwLGRlZmxhdGUnLCAndXNlci1hZ2VudCc6ICdiYW5hbmEnfSkKCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgKICAgICAgICAgICAgbWFrZV9oZWFkZXJzKHVzZXJfYWdlbnQ9J2JhbmFuYScpLAogICAgICAgICAgICB7J3VzZXItYWdlbnQnOiAnYmFuYW5hJ30pCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoCiAgICAgICAgICAgIG1ha2VfaGVhZGVycyhrZWVwX2FsaXZlPVRydWUpLAogICAgICAgICAgICB7J2Nvbm5lY3Rpb24nOiAna2VlcC1hbGl2ZSd9KQoKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKAogICAgICAgICAgICBtYWtlX2hlYWRlcnMoYmFzaWNfYXV0aD0nZm9vOmJhcicpLAogICAgICAgICAgICB7J2F1dGhvcml6YXRpb24nOiAnQmFzaWMgWm05dk9tSmhjZz09J30pCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoCiAgICAgICAgICAgIG1ha2VfaGVhZGVycyhwcm94eV9iYXNpY19hdXRoPSdmb286YmFyJyksCiAgICAgICAgICAgIHsncHJveHktYXV0aG9yaXphdGlvbic6ICdCYXNpYyBabTl2T21KaGNnPT0nfSkKCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCgKICAgICAgICAgICAgbWFrZV9oZWFkZXJzKGRpc2FibGVfY2FjaGU9VHJ1ZSksCiAgICAgICAgICAgIHsnY2FjaGUtY29udHJvbCc6ICduby1jYWNoZSd9KQoKICAgIGRlZiB0ZXN0X3Jld2luZF9ib2R5KHNlbGYpOgogICAgICAgIGJvZHkgPSBpby5CeXRlc0lPKGIndGVzdCBkYXRhJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKGJvZHkucmVhZCgpLCBiJ3Rlc3QgZGF0YScpCgogICAgICAgICMgQXNzZXJ0IHRoZSBmaWxlIG9iamVjdCBoYXMgYmVlbiBjb25zdW1lZAogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoYm9keS5yZWFkKCksIGInJykKCiAgICAgICAgIyBSZXdpbmQgaXQgYmFjayB0byBqdXN0IGJlIGInZGF0YScKICAgICAgICByZXdpbmRfYm9keShib2R5LCA1KQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoYm9keS5yZWFkKCksIGInZGF0YScpCgogICAgZGVmIHRlc3RfcmV3aW5kX2JvZHlfZmFpbGVkX3RlbGwoc2VsZik6CiAgICAgICAgYm9keSA9IGlvLkJ5dGVzSU8oYid0ZXN0IGRhdGEnKQogICAgICAgIGJvZHkucmVhZCgpICAjIENvbnN1bWUgYm9keQoKICAgICAgICAjIFNpbXVsYXRlIGZhaWxlZCB0ZWxsKCkKICAgICAgICBib2R5X3BvcyA9IF9GQUlMRURURUxMCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoVW5yZXdpbmRhYmxlQm9keUVycm9yLCByZXdpbmRfYm9keSwgYm9keSwgYm9keV9wb3MpCgogICAgZGVmIHRlc3RfcmV3aW5kX2JvZHlfYmFkX3Bvc2l0aW9uKHNlbGYpOgogICAgICAgIGJvZHkgPSBpby5CeXRlc0lPKGIndGVzdCBkYXRhJykKICAgICAgICBib2R5LnJlYWQoKSAgIyBDb25zdW1lIGJvZHkKCiAgICAgICAgIyBQYXNzIG5vbi1pbnRlZ2VyIHBvc2l0aW9uCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoVmFsdWVFcnJvciwgcmV3aW5kX2JvZHksIGJvZHksIE5vbmUpCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoVmFsdWVFcnJvciwgcmV3aW5kX2JvZHksIGJvZHksIG9iamVjdCgpKQoKICAgIGRlZiB0ZXN0X3Jld2luZF9ib2R5X2ZhaWxlZF9zZWVrKHNlbGYpOgogICAgICAgIGNsYXNzIEJhZFNlZWsoKToKCiAgICAgICAgICAgIGRlZiBzZWVrKHNlbGYsIHBvcywgb2Zmc2V0PTApOgogICAgICAgICAgICAgICAgcmFpc2UgSU9FcnJvcgoKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhVbnJld2luZGFibGVCb2R5RXJyb3IsIHJld2luZF9ib2R5LCBCYWRTZWVrKCksIDIpCgogICAgZGVmIHRlc3Rfc3BsaXRfZmlyc3Qoc2VsZik6CiAgICAgICAgdGVzdF9jYXNlcyA9IHsKICAgICAgICAgICAgKCdhYmNkJywgJ2InKTogKCdhJywgJ2NkJywgJ2InKSwKICAgICAgICAgICAgKCdhYmNkJywgJ2NiJyk6ICgnYScsICdjZCcsICdiJyksCiAgICAgICAgICAgICgnYWJjZCcsICcnKTogKCdhYmNkJywgJycsIE5vbmUpLAogICAgICAgICAgICAoJ2FiY2QnLCAnYScpOiAoJycsICdiY2QnLCAnYScpLAogICAgICAgICAgICAoJ2FiY2QnLCAnYWInKTogKCcnLCAnYmNkJywgJ2EnKSwKICAgICAgICB9CiAgICAgICAgZm9yIGlucHV0LCBleHBlY3RlZCBpbiB0ZXN0X2Nhc2VzLml0ZW1zKCk6CiAgICAgICAgICAgIG91dHB1dCA9IHNwbGl0X2ZpcnN0KCppbnB1dCkKICAgICAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChvdXRwdXQsIGV4cGVjdGVkKQoKICAgIGRlZiB0ZXN0X2FkZF9zdGRlcnJfbG9nZ2VyKHNlbGYpOgogICAgICAgIGhhbmRsZXIgPSBhZGRfc3RkZXJyX2xvZ2dlcihsZXZlbD1sb2dnaW5nLklORk8pICAjIERvbid0IGFjdHVhbGx5IHByaW50IGRlYnVnCiAgICAgICAgbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoJ3VybGxpYjMnKQogICAgICAgIHNlbGYuYXNzZXJ0VHJ1ZShoYW5kbGVyIGluIGxvZ2dlci5oYW5kbGVycykKCiAgICAgICAgbG9nZ2VyLmRlYnVnKCdUZXN0aW5nIGFkZF9zdGRlcnJfbG9nZ2VyJykKICAgICAgICBsb2dnZXIucmVtb3ZlSGFuZGxlcihoYW5kbGVyKQoKICAgIGRlZiB0ZXN0X2Rpc2FibGVfd2FybmluZ3Moc2VsZik6CiAgICAgICAgd2l0aCB3YXJuaW5ncy5jYXRjaF93YXJuaW5ncyhyZWNvcmQ9VHJ1ZSkgYXMgdzoKICAgICAgICAgICAgY2xlYXJfd2FybmluZ3MoKQogICAgICAgICAgICB3YXJuaW5ncy53YXJuKCdUaGlzIGlzIGEgdGVzdC4nLCBJbnNlY3VyZVJlcXVlc3RXYXJuaW5nKQogICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKGxlbih3KSwgMSkKICAgICAgICAgICAgZGlzYWJsZV93YXJuaW5ncygpCiAgICAgICAgICAgIHdhcm5pbmdzLndhcm4oJ1RoaXMgaXMgYSB0ZXN0LicsIEluc2VjdXJlUmVxdWVzdFdhcm5pbmcpCiAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwobGVuKHcpLCAxKQoKICAgIGRlZiBfbWFrZV90aW1lX3Bhc3Moc2VsZiwgc2Vjb25kcywgdGltZW91dCwgdGltZV9tb2NrKToKICAgICAgICAiIiIgTWFrZSBzb21lIHRpbWUgcGFzcyBmb3IgdGhlIHRpbWVvdXQgb2JqZWN0ICIiIgogICAgICAgIHRpbWVfbW9jay5yZXR1cm5fdmFsdWUgPSBUSU1FT1VUX0VQT0NICiAgICAgICAgdGltZW91dC5zdGFydF9jb25uZWN0KCkKICAgICAgICB0aW1lX21vY2sucmV0dXJuX3ZhbHVlID0gVElNRU9VVF9FUE9DSCArIHNlY29uZHMKICAgICAgICByZXR1cm4gdGltZW91dAoKICAgIGRlZiB0ZXN0X2ludmFsaWRfdGltZW91dHMoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBUaW1lb3V0KHRvdGFsPS0xKQogICAgICAgICAgICBzZWxmLmZhaWwoIm5lZ2F0aXZlIHZhbHVlIHNob3VsZCB0aHJvdyBleGNlcHRpb24iKQogICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yIGFzIGU6CiAgICAgICAgICAgIHNlbGYuYXNzZXJ0VHJ1ZSgnbGVzcyB0aGFuJyBpbiBzdHIoZSkpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBUaW1lb3V0KGNvbm5lY3Q9MiwgdG90YWw9LTEpCiAgICAgICAgICAgIHNlbGYuZmFpbCgibmVnYXRpdmUgdmFsdWUgc2hvdWxkIHRocm93IGV4Y2VwdGlvbiIpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3IgYXMgZToKICAgICAgICAgICAgc2VsZi5hc3NlcnRUcnVlKCdsZXNzIHRoYW4nIGluIHN0cihlKSkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBUaW1lb3V0KHJlYWQ9LTEpCiAgICAgICAgICAgIHNlbGYuZmFpbCgibmVnYXRpdmUgdmFsdWUgc2hvdWxkIHRocm93IGV4Y2VwdGlvbiIpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3IgYXMgZToKICAgICAgICAgICAgc2VsZi5hc3NlcnRUcnVlKCdsZXNzIHRoYW4nIGluIHN0cihlKSkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBUaW1lb3V0KGNvbm5lY3Q9RmFsc2UpCiAgICAgICAgICAgIHNlbGYuZmFpbCgiYm9vbGVhbiB2YWx1ZXMgc2hvdWxkIHRocm93IGV4Y2VwdGlvbiIpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3IgYXMgZToKICAgICAgICAgICAgc2VsZi5hc3NlcnRUcnVlKCdjYW5ub3QgYmUgYSBib29sZWFuJyBpbiBzdHIoZSkpCgogICAgICAgIHRyeToKICAgICAgICAgICAgVGltZW91dChyZWFkPVRydWUpCiAgICAgICAgICAgIHNlbGYuZmFpbCgiYm9vbGVhbiB2YWx1ZXMgc2hvdWxkIHRocm93IGV4Y2VwdGlvbiIpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3IgYXMgZToKICAgICAgICAgICAgc2VsZi5hc3NlcnRUcnVlKCdjYW5ub3QgYmUgYSBib29sZWFuJyBpbiBzdHIoZSkpCgogICAgICAgIHRyeToKICAgICAgICAgICAgVGltZW91dChjb25uZWN0PTApCiAgICAgICAgICAgIHNlbGYuZmFpbCgidmFsdWUgPD0gMCBzaG91bGQgdGhyb3cgZXhjZXB0aW9uIikKICAgICAgICBleGNlcHQgVmFsdWVFcnJvciBhcyBlOgogICAgICAgICAgICBzZWxmLmFzc2VydFRydWUoJ2xlc3MgdGhhbiBvciBlcXVhbCcgaW4gc3RyKGUpKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIFRpbWVvdXQocmVhZD0iZm9vIikKICAgICAgICAgICAgc2VsZi5mYWlsKCJzdHJpbmcgdmFsdWUgc2hvdWxkIG5vdCBiZSBhbGxvd2VkIikKICAgICAgICBleGNlcHQgVmFsdWVFcnJvciBhcyBlOgogICAgICAgICAgICBzZWxmLmFzc2VydFRydWUoJ2ludCwgZmxvYXQgb3IgTm9uZScgaW4gc3RyKGUpKQoKICAgIEBwYXRjaCgndXJsbGliMy51dGlsLnRpbWVvdXQuY3VycmVudF90aW1lJykKICAgIGRlZiB0ZXN0X3RpbWVvdXQoc2VsZiwgY3VycmVudF90aW1lKToKICAgICAgICB0aW1lb3V0ID0gVGltZW91dCh0b3RhbD0zKQoKICAgICAgICAjIG1ha2UgJ25vIHRpbWUnIGVsYXBzZQogICAgICAgIHRpbWVvdXQgPSBzZWxmLl9tYWtlX3RpbWVfcGFzcyhzZWNvbmRzPTAsIHRpbWVvdXQ9dGltZW91dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZV9tb2NrPWN1cnJlbnRfdGltZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHRpbWVvdXQucmVhZF90aW1lb3V0LCAzKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwodGltZW91dC5jb25uZWN0X3RpbWVvdXQsIDMpCgogICAgICAgIHRpbWVvdXQgPSBUaW1lb3V0KHRvdGFsPTMsIGNvbm5lY3Q9MikKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHRpbWVvdXQuY29ubmVjdF90aW1lb3V0LCAyKQoKICAgICAgICB0aW1lb3V0ID0gVGltZW91dCgpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCh0aW1lb3V0LmNvbm5lY3RfdGltZW91dCwgVGltZW91dC5ERUZBVUxUX1RJTUVPVVQpCgogICAgICAgICMgQ29ubmVjdCB0YWtlcyA1IHNlY29uZHMsIGxlYXZpbmcgNSBzZWNvbmRzIGZvciByZWFkCiAgICAgICAgdGltZW91dCA9IFRpbWVvdXQodG90YWw9MTAsIHJlYWQ9NykKICAgICAgICB0aW1lb3V0ID0gc2VsZi5fbWFrZV90aW1lX3Bhc3Moc2Vjb25kcz01LCB0aW1lb3V0PXRpbWVvdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVfbW9jaz1jdXJyZW50X3RpbWUpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCh0aW1lb3V0LnJlYWRfdGltZW91dCwgNSkKCiAgICAgICAgIyBDb25uZWN0IHRha2VzIDIgc2Vjb25kcywgcmVhZCB0aW1lb3V0IHN0aWxsIDcgc2Vjb25kcwogICAgICAgIHRpbWVvdXQgPSBUaW1lb3V0KHRvdGFsPTEwLCByZWFkPTcpCiAgICAgICAgdGltZW91dCA9IHNlbGYuX21ha2VfdGltZV9wYXNzKHNlY29uZHM9MiwgdGltZW91dD10aW1lb3V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lX21vY2s9Y3VycmVudF90aW1lKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwodGltZW91dC5yZWFkX3RpbWVvdXQsIDcpCgogICAgICAgIHRpbWVvdXQgPSBUaW1lb3V0KHRvdGFsPTEwLCByZWFkPTcpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCh0aW1lb3V0LnJlYWRfdGltZW91dCwgNykKCiAgICAgICAgdGltZW91dCA9IFRpbWVvdXQodG90YWw9Tm9uZSwgcmVhZD1Ob25lLCBjb25uZWN0PU5vbmUpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbCh0aW1lb3V0LmNvbm5lY3RfdGltZW91dCwgTm9uZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHRpbWVvdXQucmVhZF90aW1lb3V0LCBOb25lKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwodGltZW91dC50b3RhbCwgTm9uZSkKCiAgICAgICAgdGltZW91dCA9IFRpbWVvdXQoNSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHRpbWVvdXQudG90YWwsIDUpCgogICAgZGVmIHRlc3RfdGltZW91dF9zdHIoc2VsZik6CiAgICAgICAgdGltZW91dCA9IFRpbWVvdXQoY29ubmVjdD0xLCByZWFkPTIsIHRvdGFsPTMpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChzdHIodGltZW91dCksICJUaW1lb3V0KGNvbm5lY3Q9MSwgcmVhZD0yLCB0b3RhbD0zKSIpCiAgICAgICAgdGltZW91dCA9IFRpbWVvdXQoY29ubmVjdD0xLCByZWFkPU5vbmUsIHRvdGFsPTMpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChzdHIodGltZW91dCksICJUaW1lb3V0KGNvbm5lY3Q9MSwgcmVhZD1Ob25lLCB0b3RhbD0zKSIpCgogICAgQHBhdGNoKCd1cmxsaWIzLnV0aWwudGltZW91dC5jdXJyZW50X3RpbWUnKQogICAgZGVmIHRlc3RfdGltZW91dF9lbGFwc2VkKHNlbGYsIGN1cnJlbnRfdGltZSk6CiAgICAgICAgY3VycmVudF90aW1lLnJldHVybl92YWx1ZSA9IFRJTUVPVVRfRVBPQ0gKICAgICAgICB0aW1lb3V0ID0gVGltZW91dCh0b3RhbD0zKQogICAgICAgIHNlbGYuYXNzZXJ0UmFpc2VzKFRpbWVvdXRTdGF0ZUVycm9yLCB0aW1lb3V0LmdldF9jb25uZWN0X2R1cmF0aW9uKQoKICAgICAgICB0aW1lb3V0LnN0YXJ0X2Nvbm5lY3QoKQogICAgICAgIHNlbGYuYXNzZXJ0UmFpc2VzKFRpbWVvdXRTdGF0ZUVycm9yLCB0aW1lb3V0LnN0YXJ0X2Nvbm5lY3QpCgogICAgICAgIGN1cnJlbnRfdGltZS5yZXR1cm5fdmFsdWUgPSBUSU1FT1VUX0VQT0NIICsgMgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwodGltZW91dC5nZXRfY29ubmVjdF9kdXJhdGlvbigpLCAyKQogICAgICAgIGN1cnJlbnRfdGltZS5yZXR1cm5fdmFsdWUgPSBUSU1FT1VUX0VQT0NIICsgMzcKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHRpbWVvdXQuZ2V0X2Nvbm5lY3RfZHVyYXRpb24oKSwgMzcpCgogICAgZGVmIHRlc3RfcmVzb2x2ZV9jZXJ0X3JlcXMoc2VsZik6CiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXNvbHZlX2NlcnRfcmVxcyhOb25lKSwgc3NsLkNFUlRfTk9ORSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc29sdmVfY2VydF9yZXFzKHNzbC5DRVJUX05PTkUpLCBzc2wuQ0VSVF9OT05FKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzb2x2ZV9jZXJ0X3JlcXMoc3NsLkNFUlRfUkVRVUlSRUQpLCBzc2wuQ0VSVF9SRVFVSVJFRCkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc29sdmVfY2VydF9yZXFzKCdSRVFVSVJFRCcpLCBzc2wuQ0VSVF9SRVFVSVJFRCkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc29sdmVfY2VydF9yZXFzKCdDRVJUX1JFUVVJUkVEJyksIHNzbC5DRVJUX1JFUVVJUkVEKQoKICAgIGRlZiB0ZXN0X3Jlc29sdmVfc3NsX3ZlcnNpb24oc2VsZik6CiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXNvbHZlX3NzbF92ZXJzaW9uKHNzbC5QUk9UT0NPTF9UTFN2MSksIHNzbC5QUk9UT0NPTF9UTFN2MSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc29sdmVfc3NsX3ZlcnNpb24oIlBST1RPQ09MX1RMU3YxIiksIHNzbC5QUk9UT0NPTF9UTFN2MSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc29sdmVfc3NsX3ZlcnNpb24oIlRMU3YxIiksIHNzbC5QUk9UT0NPTF9UTFN2MSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc29sdmVfc3NsX3ZlcnNpb24oc3NsLlBST1RPQ09MX1NTTHYyMyksIHNzbC5QUk9UT0NPTF9TU0x2MjMpCgogICAgZGVmIHRlc3RfaXNfZnBfY2xvc2VkX29iamVjdF9zdXBwb3J0c19jbG9zZWQoc2VsZik6CiAgICAgICAgY2xhc3MgQ2xvc2VkRmlsZShvYmplY3QpOgogICAgICAgICAgICBAcHJvcGVydHkKICAgICAgICAgICAgZGVmIGNsb3NlZChzZWxmKToKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgICAgIHNlbGYuYXNzZXJ0VHJ1ZShpc19mcF9jbG9zZWQoQ2xvc2VkRmlsZSgpKSkKCiAgICBkZWYgdGVzdF9pc19mcF9jbG9zZWRfb2JqZWN0X2hhc19ub25lX2ZwKHNlbGYpOgogICAgICAgIGNsYXNzIE5vbmVGcEZpbGUob2JqZWN0KToKICAgICAgICAgICAgQHByb3BlcnR5CiAgICAgICAgICAgIGRlZiBmcChzZWxmKToKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIHNlbGYuYXNzZXJ0VHJ1ZShpc19mcF9jbG9zZWQoTm9uZUZwRmlsZSgpKSkKCiAgICBkZWYgdGVzdF9pc19mcF9jbG9zZWRfb2JqZWN0X2hhc19mcChzZWxmKToKICAgICAgICBjbGFzcyBGcEZpbGUob2JqZWN0KToKICAgICAgICAgICAgQHByb3BlcnR5CiAgICAgICAgICAgIGRlZiBmcChzZWxmKToKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgICAgIHNlbGYuYXNzZXJ0VHJ1ZShub3QgaXNfZnBfY2xvc2VkKEZwRmlsZSgpKSkKCiAgICBkZWYgdGVzdF9pc19mcF9jbG9zZWRfb2JqZWN0X2hhc19uZWl0aGVyX2ZwX25vcl9jbG9zZWQoc2VsZik6CiAgICAgICAgY2xhc3MgTm90UmVhbGx5QUZpbGUob2JqZWN0KToKICAgICAgICAgICAgcGFzcwoKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhWYWx1ZUVycm9yLCBpc19mcF9jbG9zZWQsIE5vdFJlYWxseUFGaWxlKCkpCgogICAgZGVmIHRlc3Rfc3NsX3dyYXBfc29ja2V0X2xvYWRzX3RoZV9jZXJ0X2NoYWluKHNlbGYpOgogICAgICAgIHNvY2tldCA9IG9iamVjdCgpCiAgICAgICAgbW9ja19jb250ZXh0ID0gTW9jaygpCiAgICAgICAgc3NsX3dyYXBfc29ja2V0KHNzbF9jb250ZXh0PW1vY2tfY29udGV4dCwgc29jaz1zb2NrZXQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNlcnRmaWxlPScvcGF0aC90by9jZXJ0ZmlsZScpCgogICAgICAgIG1vY2tfY29udGV4dC5sb2FkX2NlcnRfY2hhaW4uYXNzZXJ0X2NhbGxlZF9vbmNlX3dpdGgoCiAgICAgICAgICAgICcvcGF0aC90by9jZXJ0ZmlsZScsIE5vbmUpCgogICAgQHBhdGNoKCd1cmxsaWIzLnV0aWwuc3NsXy5jcmVhdGVfdXJsbGliM19jb250ZXh0JykKICAgIGRlZiB0ZXN0X3NzbF93cmFwX3NvY2tldF9jcmVhdGVzX25ld19jb250ZXh0KHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVfdXJsbGliM19jb250ZXh0KToKICAgICAgICBzb2NrZXQgPSBvYmplY3QoKQogICAgICAgIHNzbF93cmFwX3NvY2tldChzb2NrPXNvY2tldCwgY2VydF9yZXFzPSdDRVJUX1JFUVVJUkVEJykKCiAgICAgICAgY3JlYXRlX3VybGxpYjNfY29udGV4dC5hc3NlcnRfY2FsbGVkX29uY2Vfd2l0aCgKICAgICAgICAgICAgTm9uZSwgJ0NFUlRfUkVRVUlSRUQnLCBjaXBoZXJzPU5vbmUKICAgICAgICApCgogICAgZGVmIHRlc3Rfc3NsX3dyYXBfc29ja2V0X2xvYWRzX3ZlcmlmeV9sb2NhdGlvbnMoc2VsZik6CiAgICAgICAgc29ja2V0ID0gb2JqZWN0KCkKICAgICAgICBtb2NrX2NvbnRleHQgPSBNb2NrKCkKICAgICAgICBzc2xfd3JhcF9zb2NrZXQoc3NsX2NvbnRleHQ9bW9ja19jb250ZXh0LCBjYV9jZXJ0cz0nL3BhdGgvdG8vcGVtJywKICAgICAgICAgICAgICAgICAgICAgICAgc29jaz1zb2NrZXQpCiAgICAgICAgbW9ja19jb250ZXh0LmxvYWRfdmVyaWZ5X2xvY2F0aW9ucy5hc3NlcnRfY2FsbGVkX29uY2Vfd2l0aCgKICAgICAgICAgICAgJy9wYXRoL3RvL3BlbScsIE5vbmUpCgogICAgZGVmIHRlc3Rfc3NsX3dyYXBfc29ja2V0X2xvYWRzX2NlcnRpZmljYXRlX2RpcmVjdG9yaWVzKHNlbGYpOgogICAgICAgIHNvY2tldCA9IG9iamVjdCgpCiAgICAgICAgbW9ja19jb250ZXh0ID0gTW9jaygpCiAgICAgICAgc3NsX3dyYXBfc29ja2V0KHNzbF9jb250ZXh0PW1vY2tfY29udGV4dCwgY2FfY2VydF9kaXI9Jy9wYXRoL3RvL3BlbXMnLAogICAgICAgICAgICAgICAgICAgICAgICBzb2NrPXNvY2tldCkKICAgICAgICBtb2NrX2NvbnRleHQubG9hZF92ZXJpZnlfbG9jYXRpb25zLmFzc2VydF9jYWxsZWRfb25jZV93aXRoKAogICAgICAgICAgICBOb25lLCAnL3BhdGgvdG8vcGVtcycpCgogICAgZGVmIHRlc3Rfc3NsX3dyYXBfc29ja2V0X3dpdGhfbm9fc25pKHNlbGYpOgogICAgICAgIHNvY2tldCA9IG9iamVjdCgpCiAgICAgICAgbW9ja19jb250ZXh0ID0gTW9jaygpCiAgICAgICAgIyBVZ2x5IHByZXNlcnZhdGlvbiBvZiBvcmlnaW5hbCB2YWx1ZQogICAgICAgIEhBU19TTkkgPSBzc2xfLkhBU19TTkkKICAgICAgICBzc2xfLkhBU19TTkkgPSBGYWxzZQogICAgICAgIHNzbF93cmFwX3NvY2tldChzc2xfY29udGV4dD1tb2NrX2NvbnRleHQsIHNvY2s9c29ja2V0KQogICAgICAgIG1vY2tfY29udGV4dC53cmFwX3NvY2tldC5hc3NlcnRfY2FsbGVkX29uY2Vfd2l0aChzb2NrZXQpCiAgICAgICAgc3NsXy5IQVNfU05JID0gSEFTX1NOSQoKICAgIGRlZiB0ZXN0X3NzbF93cmFwX3NvY2tldF93aXRoX25vX3NuaV93YXJucyhzZWxmKToKICAgICAgICBzb2NrZXQgPSBvYmplY3QoKQogICAgICAgIG1vY2tfY29udGV4dCA9IE1vY2soKQogICAgICAgICMgVWdseSBwcmVzZXJ2YXRpb24gb2Ygb3JpZ2luYWwgdmFsdWUKICAgICAgICBIQVNfU05JID0gc3NsXy5IQVNfU05JCiAgICAgICAgc3NsXy5IQVNfU05JID0gRmFsc2UKICAgICAgICB3aXRoIHBhdGNoKCd3YXJuaW5ncy53YXJuJykgYXMgd2FybjoKICAgICAgICAgICAgc3NsX3dyYXBfc29ja2V0KHNzbF9jb250ZXh0PW1vY2tfY29udGV4dCwgc29jaz1zb2NrZXQpCiAgICAgICAgbW9ja19jb250ZXh0LndyYXBfc29ja2V0LmFzc2VydF9jYWxsZWRfb25jZV93aXRoKHNvY2tldCkKICAgICAgICBzc2xfLkhBU19TTkkgPSBIQVNfU05JCiAgICAgICAgc2VsZi5hc3NlcnRUcnVlKHdhcm4uY2FsbF9jb3VudCA+PSAxKQogICAgICAgIHdhcm5pbmdzID0gW2NhbGxbMF1bMV0gZm9yIGNhbGwgaW4gd2Fybi5jYWxsX2FyZ3NfbGlzdF0KICAgICAgICBzZWxmLmFzc2VydFRydWUoU05JTWlzc2luZ1dhcm5pbmcgaW4gd2FybmluZ3MpCgogICAgZGVmIHRlc3RfY29uc3RfY29tcGFyZV9kaWdlc3RfZmFsbGJhY2soc2VsZik6CiAgICAgICAgdGFyZ2V0ID0gaGFzaGxpYi5zaGEyNTYoYidhYmNkZWYnKS5kaWdlc3QoKQogICAgICAgIHNlbGYuYXNzZXJ0VHJ1ZShfY29uc3RfY29tcGFyZV9kaWdlc3RfYmFja3BvcnQodGFyZ2V0LCB0YXJnZXQpKQoKICAgICAgICBwcmVmaXggPSB0YXJnZXRbOi0xXQogICAgICAgIHNlbGYuYXNzZXJ0RmFsc2UoX2NvbnN0X2NvbXBhcmVfZGlnZXN0X2JhY2twb3J0KHRhcmdldCwgcHJlZml4KSkKCiAgICAgICAgc3VmZml4ID0gdGFyZ2V0ICsgYicwJwogICAgICAgIHNlbGYuYXNzZXJ0RmFsc2UoX2NvbnN0X2NvbXBhcmVfZGlnZXN0X2JhY2twb3J0KHRhcmdldCwgc3VmZml4KSkKCiAgICAgICAgaW5jb3JyZWN0ID0gaGFzaGxpYi5zaGEyNTYoYid4eXonKS5kaWdlc3QoKQogICAgICAgIHNlbGYuYXNzZXJ0RmFsc2UoX2NvbnN0X2NvbXBhcmVfZGlnZXN0X2JhY2twb3J0KHRhcmdldCwgaW5jb3JyZWN0KSkKCiAgICBkZWYgdGVzdF9oYXNfaXB2Nl9kaXNhYmxlZF9vbl9jb21waWxlKHNlbGYpOgogICAgICAgIHdpdGggcGF0Y2goJ3NvY2tldC5oYXNfaXB2NicsIEZhbHNlKToKICAgICAgICAgICAgc2VsZi5hc3NlcnRGYWxzZShfaGFzX2lwdjYoJzo6MScpKQoKICAgIGRlZiB0ZXN0X2hhc19pcHY2X2VuYWJsZWRfYnV0X2ZhaWxzKHNlbGYpOgogICAgICAgIHdpdGggcGF0Y2goJ3NvY2tldC5oYXNfaXB2NicsIFRydWUpOgogICAgICAgICAgICB3aXRoIHBhdGNoKCdzb2NrZXQuc29ja2V0JykgYXMgbW9jazoKICAgICAgICAgICAgICAgIGluc3RhbmNlID0gbW9jay5yZXR1cm5fdmFsdWUKICAgICAgICAgICAgICAgIGluc3RhbmNlLmJpbmQgPSBNb2NrKHNpZGVfZWZmZWN0PUV4Y2VwdGlvbignTm8gSVB2NiBoZXJlIScpKQogICAgICAgICAgICAgICAgc2VsZi5hc3NlcnRGYWxzZShfaGFzX2lwdjYoJzo6MScpKQoKICAgIGRlZiB0ZXN0X2hhc19pcHY2X2VuYWJsZWRfYW5kX3dvcmtpbmcoc2VsZik6CiAgICAgICAgd2l0aCBwYXRjaCgnc29ja2V0Lmhhc19pcHY2JywgVHJ1ZSk6CiAgICAgICAgICAgIHdpdGggcGF0Y2goJ3NvY2tldC5zb2NrZXQnKSBhcyBtb2NrOgogICAgICAgICAgICAgICAgaW5zdGFuY2UgPSBtb2NrLnJldHVybl92YWx1ZQogICAgICAgICAgICAgICAgaW5zdGFuY2UuYmluZC5yZXR1cm5fdmFsdWUgPSBUcnVlCiAgICAgICAgICAgICAgICBzZWxmLmFzc2VydFRydWUoX2hhc19pcHY2KCc6OjEnKSkKCiAgICBkZWYgdGVzdF9pcF9mYW1pbHlfaXB2Nl9lbmFibGVkKHNlbGYpOgogICAgICAgIHdpdGggcGF0Y2goJ3VybGxpYjMudXRpbC5jb25uZWN0aW9uLkhBU19JUFY2JywgVHJ1ZSk6CiAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoYWxsb3dlZF9nYWlfZmFtaWx5KCksIHNvY2tldC5BRl9VTlNQRUMpCgogICAgZGVmIHRlc3RfaXBfZmFtaWx5X2lwdjZfZGlzYWJsZWQoc2VsZik6CiAgICAgICAgd2l0aCBwYXRjaCgndXJsbGliMy51dGlsLmNvbm5lY3Rpb24uSEFTX0lQVjYnLCBGYWxzZSk6CiAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoYWxsb3dlZF9nYWlfZmFtaWx5KCksIHNvY2tldC5BRl9JTkVUKQoKICAgIGRlZiB0ZXN0X3BhcnNlX3JldHJ5X2FmdGVyKHNlbGYpOgogICAgICAgIGludmFsaWQgPSBbCiAgICAgICAgICAgICItMSIsCiAgICAgICAgICAgICIrMSIsCiAgICAgICAgICAgICIxLjAiLAogICAgICAgICAgICBzaXgudSgiXHhiMiIpLCAgIyBceGIyID0gXjIKICAgICAgICBdCiAgICAgICAgcmV0cnkgPSBSZXRyeSgpCgogICAgICAgIGZvciB2YWx1ZSBpbiBpbnZhbGlkOgogICAgICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhJbnZhbGlkSGVhZGVyLCByZXRyeS5wYXJzZV9yZXRyeV9hZnRlciwgdmFsdWUpCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkucGFyc2VfcmV0cnlfYWZ0ZXIoIjAiKSwgMCkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJldHJ5LnBhcnNlX3JldHJ5X2FmdGVyKCIxMDAwIiksIDEwMDApCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXRyeS5wYXJzZV9yZXRyeV9hZnRlcigiXHQ0MiAiKSwgNDIpCg==
