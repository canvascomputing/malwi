statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_asymmetric.py
  contents:
  - name: _CertificateBase.bit_size
    score: 0.0
    code: |-
      @property
          def bit_size(self):
              """
              :return:
                  The number of bits in the public key, as an integer
              """

              return self.public_key.bit_size
    tokens: resume load_fast self load_attr public_key load_attr bit_size return_value
    hash: 85aedba7f562742f8fa513d5591b9db60610c322d961999e70eceaa744c218ad
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_asymmetric.py
  : IyBjb2Rpbmc6IHV0Zi04CmZyb20gX19mdXR1cmVfXyBpbXBvcnQgdW5pY29kZV9saXRlcmFscywgZGl2aXNpb24sIGFic29sdXRlX2ltcG9ydCwgcHJpbnRfZnVuY3Rpb24KCmltcG9ydCBoYXNobGliCmltcG9ydCBobWFjCmltcG9ydCByZQppbXBvcnQgYmluYXNjaWkKCmZyb20gLl9hc24xIGltcG9ydCAoCiAgICBDZXJ0QmFnLAogICAgQ2VydGlmaWNhdGUsCiAgICBEU0FQcml2YXRlS2V5LAogICAgRUNQcml2YXRlS2V5LAogICAgRW5jcnlwdGVkRGF0YSwKICAgIEVuY3J5cHRlZFByaXZhdGVLZXlJbmZvLAogICAgSW50ZWdlciwKICAgIE9jdGV0U3RyaW5nLAogICAgUGZ4LAogICAgUHJpdmF0ZUtleUluZm8sCiAgICBQdWJsaWNLZXlJbmZvLAogICAgUlNBUHJpdmF0ZUtleSwKICAgIFJTQVB1YmxpY0tleSwKICAgIFNhZmVDb250ZW50cywKICAgIHVuYXJtb3IsCikKCmZyb20gLmtkZiBpbXBvcnQgcGJrZGYxLCBwYmtkZjIsIHBrY3MxMl9rZGYKZnJvbSAuc3ltbWV0cmljIGltcG9ydCAoCiAgICBhZXNfY2JjX3BrY3M3X2RlY3J5cHQsCiAgICBkZXNfY2JjX3BrY3M1X2RlY3J5cHQsCiAgICByYzJfY2JjX3BrY3M1X2RlY3J5cHQsCiAgICByYzRfZGVjcnlwdCwKICAgIHRyaXBsZWRlc19jYmNfcGtjczVfZGVjcnlwdCwKKQpmcm9tIC51dGlsIGltcG9ydCBjb25zdGFudF9jb21wYXJlCmZyb20gLl9lcnJvcnMgaW1wb3J0IHByZXR0eV9tZXNzYWdlCmZyb20gLl90eXBlcyBpbXBvcnQgYnl0ZV9jbHMsIHN0cl9jbHMsIHR5cGVfbmFtZQoKCmNsYXNzIF9Qcml2YXRlS2V5QmFzZSgpOgoKICAgIGFzbjEgPSBOb25lCiAgICBfZmluZ2VycHJpbnQgPSBOb25lCgogICAgZGVmIHVud3JhcChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBVbndyYXBzIHRoZSBwcml2YXRlIGtleSBpbnRvIGFuIGFzbjFjcnlwdG8ua2V5cy5SU0FQcml2YXRlS2V5LAogICAgICAgIGFzbjFjcnlwdG8ua2V5cy5EU0FQcml2YXRlS2V5IG9yIGFzbjFjcnlwdG8ua2V5cy5FQ1ByaXZhdGVLZXkgb2JqZWN0CgogICAgICAgIDpyZXR1cm46CiAgICAgICAgICAgIEFuIGFzbjFjcnlwdG8ua2V5cy5SU0FQcml2YXRlS2V5LCBhc24xY3J5cHRvLmtleXMuRFNBUHJpdmF0ZUtleSBvcgogICAgICAgICAgICBhc24xY3J5cHRvLmtleXMuRUNQcml2YXRlS2V5IG9iamVjdAogICAgICAgICIiIgoKICAgICAgICBpZiBzZWxmLmFsZ29yaXRobSA9PSAncnNhJzoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuYXNuMVsncHJpdmF0ZV9rZXknXS5wYXJzZWQKCiAgICAgICAgaWYgc2VsZi5hbGdvcml0aG0gPT0gJ2RzYSc6CiAgICAgICAgICAgIHBhcmFtcyA9IHNlbGYuYXNuMVsncHJpdmF0ZV9rZXlfYWxnb3JpdGhtJ11bJ3BhcmFtZXRlcnMnXQogICAgICAgICAgICByZXR1cm4gRFNBUHJpdmF0ZUtleSh7CiAgICAgICAgICAgICAgICAndmVyc2lvbic6IDAsCiAgICAgICAgICAgICAgICAncCc6IHBhcmFtc1sncCddLAogICAgICAgICAgICAgICAgJ3EnOiBwYXJhbXNbJ3EnXSwKICAgICAgICAgICAgICAgICdnJzogcGFyYW1zWydnJ10sCiAgICAgICAgICAgICAgICAncHVibGljX2tleSc6IHNlbGYucHVibGljX2tleS51bndyYXAoKSwKICAgICAgICAgICAgICAgICdwcml2YXRlX2tleSc6IHNlbGYuYXNuMVsncHJpdmF0ZV9rZXknXS5wYXJzZWQsCiAgICAgICAgICAgIH0pCgogICAgICAgIGlmIHNlbGYuYWxnb3JpdGhtID09ICdlYyc6CiAgICAgICAgICAgIG91dHB1dCA9IHNlbGYuYXNuMVsncHJpdmF0ZV9rZXknXS5wYXJzZWQKICAgICAgICAgICAgb3V0cHV0WydwYXJhbWV0ZXJzJ10gPSBzZWxmLmFzbjFbJ3ByaXZhdGVfa2V5X2FsZ29yaXRobSddWydwYXJhbWV0ZXJzJ10KICAgICAgICAgICAgb3V0cHV0WydwdWJsaWNfa2V5J10gPSBzZWxmLnB1YmxpY19rZXkudW53cmFwKCkKICAgICAgICAgICAgcmV0dXJuIG91dHB1dAoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGFsZ29yaXRobShzZWxmKToKICAgICAgICAiIiIKICAgICAgICA6cmV0dXJuOgogICAgICAgICAgICBBIHVuaWNvZGUgc3RyaW5nIG9mICJyc2EiLCAiZHNhIiBvciAiZWMiCiAgICAgICAgIiIiCgogICAgICAgIHJldHVybiBzZWxmLmFzbjEuYWxnb3JpdGhtCgogICAgQHByb3BlcnR5CiAgICBkZWYgY3VydmUoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgOnJldHVybjoKICAgICAgICAgICAgQSB1bmljb2RlIHN0cmluZyBvZiBFQyBjdXJ2ZSBuYW1lCiAgICAgICAgIiIiCgogICAgICAgIHJldHVybiBzZWxmLmFzbjEuY3VydmVbMV0KCiAgICBAcHJvcGVydHkKICAgIGRlZiBiaXRfc2l6ZShzZWxmKToKICAgICAgICAiIiIKICAgICAgICA6cmV0dXJuOgogICAgICAgICAgICBUaGUgbnVtYmVyIG9mIGJpdHMgaW4gdGhlIGtleSwgYXMgYW4gaW50ZWdlcgogICAgICAgICIiIgoKICAgICAgICByZXR1cm4gc2VsZi5hc24xLmJpdF9zaXplCgogICAgQHByb3BlcnR5CiAgICBkZWYgYnl0ZV9zaXplKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIDpyZXR1cm46CiAgICAgICAgICAgIFRoZSBudW1iZXIgb2YgYnl0ZXMgaW4gdGhlIGtleSwgYXMgYW4gaW50ZWdlcgogICAgICAgICIiIgoKICAgICAgICByZXR1cm4gc2VsZi5hc24xLmJ5dGVfc2l6ZQoKCmNsYXNzIF9QdWJsaWNLZXlCYXNlKCk6CgogICAgYXNuMSA9IE5vbmUKICAgIF9maW5nZXJwcmludCA9IE5vbmUKCiAgICBkZWYgdW53cmFwKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIFVud3JhcHMgYSBwdWJsaWMga2V5IGludG8gYW4gYXNuMWNyeXB0by5rZXlzLlJTQVB1YmxpY0tleSwKICAgICAgICBhc24xY3J5cHRvLmNvcmUuSW50ZWdlciAoZm9yIERTQSkgb3IgYXNuMWNyeXB0by5rZXlzLkVDUG9pbnRCaXRTdHJpbmcKICAgICAgICBvYmplY3QKCiAgICAgICAgOnJldHVybjoKICAgICAgICAgICAgQW4gYXNuMWNyeXB0by5rZXlzLlJTQVB1YmxpY0tleSwgYXNuMWNyeXB0by5jb3JlLkludGVnZXIgb3IKICAgICAgICAgICAgYXNuMWNyeXB0by5rZXlzLkVDUG9pbnRCaXRTdHJpbmcgb2JqZWN0CiAgICAgICAgIiIiCgogICAgICAgIGlmIHNlbGYuYWxnb3JpdGhtID09ICdlYyc6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmFzbjFbJ3B1YmxpY19rZXknXQogICAgICAgIHJldHVybiBzZWxmLmFzbjFbJ3B1YmxpY19rZXknXS5wYXJzZWQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBmaW5nZXJwcmludChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBDcmVhdGVzIGEgZmluZ2VycHJpbnQgdGhhdCBjYW4gYmUgY29tcGFyZWQgd2l0aCBhIHByaXZhdGUga2V5IHRvIHNlZSBpZgogICAgICAgIHRoZSB0d28gZm9ybSBhIHBhaXIuCgogICAgICAgIFRoaXMgZmluZ2VycHJpbnQgaXMgbm90IGNvbXBhdGlibGUgd2l0aCBmaW5nZXJwcmludHMgZ2VuZXJhdGVkIGJ5IGFueQogICAgICAgIG90aGVyIHNvZnR3YXJlLgoKICAgICAgICA6cmV0dXJuOgogICAgICAgICAgICBBIGJ5dGUgc3RyaW5nIHRoYXQgaXMgYSBzaGEyNTYgaGFzaCBvZiBzZWxlY3RlZCBjb21wb25lbnRzIChiYXNlZAogICAgICAgICAgICBvbiB0aGUga2V5IHR5cGUpCiAgICAgICAgIiIiCgogICAgICAgIGlmIHNlbGYuX2ZpbmdlcnByaW50IGlzIE5vbmU6CiAgICAgICAgICAgIHNlbGYuX2ZpbmdlcnByaW50ID0gX2ZpbmdlcnByaW50KHNlbGYuYXNuMSwgTm9uZSkKICAgICAgICByZXR1cm4gc2VsZi5fZmluZ2VycHJpbnQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBhbGdvcml0aG0oc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgOnJldHVybjoKICAgICAgICAgICAgQSB1bmljb2RlIHN0cmluZyBvZiAicnNhIiwgImRzYSIgb3IgImVjIgogICAgICAgICIiIgoKICAgICAgICByZXR1cm4gc2VsZi5hc24xLmFsZ29yaXRobQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGN1cnZlKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIDpyZXR1cm46CiAgICAgICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgRUMgY3VydmUgbmFtZQogICAgICAgICIiIgoKICAgICAgICByZXR1cm4gc2VsZi5hc24xLmN1cnZlWzFdCgogICAgQHByb3BlcnR5CiAgICBkZWYgYml0X3NpemUoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgOnJldHVybjoKICAgICAgICAgICAgVGhlIG51bWJlciBvZiBiaXRzIGluIHRoZSBrZXksIGFzIGFuIGludGVnZXIKICAgICAgICAiIiIKCiAgICAgICAgcmV0dXJuIHNlbGYuYXNuMS5iaXRfc2l6ZQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGJ5dGVfc2l6ZShzZWxmKToKICAgICAgICAiIiIKICAgICAgICA6cmV0dXJuOgogICAgICAgICAgICBUaGUgbnVtYmVyIG9mIGJ5dGVzIGluIHRoZSBrZXksIGFzIGFuIGludGVnZXIKICAgICAgICAiIiIKCiAgICAgICAgcmV0dXJuIHNlbGYuYXNuMS5ieXRlX3NpemUKCgpjbGFzcyBfQ2VydGlmaWNhdGVCYXNlKCk6CgogICAgYXNuMSA9IE5vbmUKCiAgICBAcHJvcGVydHkKICAgIGRlZiBhbGdvcml0aG0oc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgOnJldHVybjoKICAgICAgICAgICAgQSB1bmljb2RlIHN0cmluZyBvZiAicnNhIiwgImRzYSIgb3IgImVjIgogICAgICAgICIiIgoKICAgICAgICByZXR1cm4gc2VsZi5wdWJsaWNfa2V5LmFsZ29yaXRobQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGN1cnZlKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIDpyZXR1cm46CiAgICAgICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgRUMgY3VydmUgbmFtZQogICAgICAgICIiIgoKICAgICAgICByZXR1cm4gc2VsZi5wdWJsaWNfa2V5LmN1cnZlCgogICAgQHByb3BlcnR5CiAgICBkZWYgYml0X3NpemUoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgOnJldHVybjoKICAgICAgICAgICAgVGhlIG51bWJlciBvZiBiaXRzIGluIHRoZSBwdWJsaWMga2V5LCBhcyBhbiBpbnRlZ2VyCiAgICAgICAgIiIiCgogICAgICAgIHJldHVybiBzZWxmLnB1YmxpY19rZXkuYml0X3NpemUKCiAgICBAcHJvcGVydHkKICAgIGRlZiBieXRlX3NpemUoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgOnJldHVybjoKICAgICAgICAgICAgVGhlIG51bWJlciBvZiBieXRlcyBpbiB0aGUgcHVibGljIGtleSwgYXMgYW4gaW50ZWdlcgogICAgICAgICIiIgoKICAgICAgICByZXR1cm4gc2VsZi5wdWJsaWNfa2V5LmJ5dGVfc2l6ZQoKCmRlZiBfdW53cmFwX3ByaXZhdGVfa2V5X2luZm8oa2V5X2luZm8pOgogICAgIiIiCiAgICBVbndyYXBzIGFuIGFzbjFjcnlwdG8ua2V5cy5Qcml2YXRlS2V5SW5mbyBvYmplY3QgaW50byBhbgogICAgYXNuMWNyeXB0by5rZXlzLlJTQVByaXZhdGVLZXksIGFzbjFjcnlwdG8ua2V5cy5EU0FQcml2YXRlS2V5CiAgICBvciBhc24xY3J5cHRvLmtleXMuRUNQcml2YXRlS2V5LgoKICAgIDpwYXJhbSBrZXlfaW5mbzoKICAgICAgICBBbiBhc24xY3J5cHRvLmtleXMuUHJpdmF0ZUtleUluZm8gb2JqZWN0CgogICAgOnJldHVybjoKICAgICAgICBPbmUgb2Y6CiAgICAgICAgIC0gYXNuMWNyeXB0by5rZXlzLlJTQVByaXZhdGVLZXkKICAgICAgICAgLSBhc24xY3J5cHRvLmtleXMuRFNBUHJpdmF0ZUtleQogICAgICAgICAtIGFzbjFjcnlwdG8ua2V5cy5FQ1ByaXZhdGVLZXkKICAgICIiIgoKICAgIGtleV9hbGcgPSBrZXlfaW5mby5hbGdvcml0aG0KCiAgICBpZiBrZXlfYWxnID09ICdyc2EnIG9yIGtleV9hbGcgPT0gJ3JzYXNzYV9wc3MnOgogICAgICAgIHJldHVybiBrZXlfaW5mb1sncHJpdmF0ZV9rZXknXS5wYXJzZWQKCiAgICBpZiBrZXlfYWxnID09ICdkc2EnOgogICAgICAgIHBhcmFtcyA9IGtleV9pbmZvWydwcml2YXRlX2tleV9hbGdvcml0aG0nXVsncGFyYW1ldGVycyddCiAgICAgICAgcGFyc2VkID0ga2V5X2luZm9bJ3ByaXZhdGVfa2V5J10ucGFyc2VkCiAgICAgICAgcmV0dXJuIERTQVByaXZhdGVLZXkoewogICAgICAgICAgICAndmVyc2lvbic6IDAsCiAgICAgICAgICAgICdwJzogcGFyYW1zWydwJ10sCiAgICAgICAgICAgICdxJzogcGFyYW1zWydxJ10sCiAgICAgICAgICAgICdnJzogcGFyYW1zWydnJ10sCiAgICAgICAgICAgICdwdWJsaWNfa2V5JzogSW50ZWdlcihwb3coCiAgICAgICAgICAgICAgICBwYXJhbXNbJ2cnXS5uYXRpdmUsCiAgICAgICAgICAgICAgICBwYXJzZWQubmF0aXZlLAogICAgICAgICAgICAgICAgcGFyYW1zWydwJ10ubmF0aXZlCiAgICAgICAgICAgICkpLAogICAgICAgICAgICAncHJpdmF0ZV9rZXknOiBwYXJzZWQsCiAgICAgICAgfSkKCiAgICBpZiBrZXlfYWxnID09ICdlYyc6CiAgICAgICAgcGFyc2VkID0ga2V5X2luZm9bJ3ByaXZhdGVfa2V5J10ucGFyc2VkCiAgICAgICAgcGFyc2VkWydwYXJhbWV0ZXJzJ10gPSBrZXlfaW5mb1sncHJpdmF0ZV9rZXlfYWxnb3JpdGhtJ11bJ3BhcmFtZXRlcnMnXQogICAgICAgIHJldHVybiBwYXJzZWQKCiAgICByYWlzZSBWYWx1ZUVycm9yKCdVbnN1cHBvcnRlZCBrZXlfaW5mby5hbGdvcml0aG0gIiVzIicgJSBrZXlfaW5mby5hbGdvcml0aG0pCgoKZGVmIF9maW5nZXJwcmludChrZXlfb2JqZWN0LCBsb2FkX3ByaXZhdGVfa2V5KToKICAgICIiIgogICAgUmV0dXJucyBhIGZpbmdlcnByaW50IHVzZWQgZm9yIGNvcnJlbGF0aW5nIHB1YmxpYyBrZXlzIGFuZCBwcml2YXRlIGtleXMKCiAgICA6cGFyYW0ga2V5X29iamVjdDoKICAgICAgICBBbiBhc24xY3J5cHRvLmtleXMuUHJpdmF0ZUtleUluZm8gb3IgYXNuMWNyeXB0by5rZXlzLlB1YmxpY0tleUluZm8KCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIHRoZSBrZXlfb2JqZWN0IGlzIG5vdCBvZiB0aGUgcHJvcGVyIHR5cGUKCiAgICA7cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgZmluZ2VycHJpbnQKICAgICIiIgoKICAgIGlmIGlzaW5zdGFuY2Uoa2V5X29iamVjdCwgUHJpdmF0ZUtleUluZm8pOgogICAgICAgIGtleSA9IGtleV9vYmplY3RbJ3ByaXZhdGVfa2V5J10ucGFyc2VkCgogICAgICAgIGlmIGtleV9vYmplY3QuYWxnb3JpdGhtID09ICdyc2EnOgogICAgICAgICAgICB0b19oYXNoID0gJyVkOiVkJyAlICgKICAgICAgICAgICAgICAgIGtleVsnbW9kdWx1cyddLm5hdGl2ZSwKICAgICAgICAgICAgICAgIGtleVsncHVibGljX2V4cG9uZW50J10ubmF0aXZlLAogICAgICAgICAgICApCgogICAgICAgIGVsaWYga2V5X29iamVjdC5hbGdvcml0aG0gPT0gJ2RzYSc6CiAgICAgICAgICAgIHBhcmFtcyA9IGtleV9vYmplY3RbJ3ByaXZhdGVfa2V5X2FsZ29yaXRobSddWydwYXJhbWV0ZXJzJ10KICAgICAgICAgICAgcHVibGljX2tleSA9IEludGVnZXIocG93KAogICAgICAgICAgICAgICAgcGFyYW1zWydnJ10ubmF0aXZlLAogICAgICAgICAgICAgICAga2V5X29iamVjdFsncHJpdmF0ZV9rZXknXS5wYXJzZWQubmF0aXZlLAogICAgICAgICAgICAgICAgcGFyYW1zWydwJ10ubmF0aXZlCiAgICAgICAgICAgICkpCgogICAgICAgICAgICB0b19oYXNoID0gJyVkOiVkOiVkOiVkJyAlICgKICAgICAgICAgICAgICAgIHBhcmFtc1sncCddLm5hdGl2ZSwKICAgICAgICAgICAgICAgIHBhcmFtc1sncSddLm5hdGl2ZSwKICAgICAgICAgICAgICAgIHBhcmFtc1snZyddLm5hdGl2ZSwKICAgICAgICAgICAgICAgIHB1YmxpY19rZXkubmF0aXZlLAogICAgICAgICAgICApCgogICAgICAgIGVsaWYga2V5X29iamVjdC5hbGdvcml0aG0gPT0gJ2VjJzoKICAgICAgICAgICAgcHVibGljX2tleSA9IGtleVsncHVibGljX2tleSddLm5hdGl2ZQogICAgICAgICAgICBpZiBwdWJsaWNfa2V5IGlzIE5vbmU6CiAgICAgICAgICAgICAgICAjIFRoaXMgaXMgZ3Jvc3MsIGJ1dCBzaW5jZSB0aGUgRUMgcHVibGljIGtleSBpcyBvcHRpb25hbCwKICAgICAgICAgICAgICAgICMgYW5kIHdlIG5lZWQgdG8gbG9hZCB0aGUgcHJpdmF0ZSBrZXkgYW5kIHVzZSB0aGUgY3J5cHRvIGxpYgogICAgICAgICAgICAgICAgIyB0byBnZXQgdGhlIHB1YmxpYyBrZXksIHdlIGhhdmUgdG8gaW1wb3J0IHRoZSBwbGF0Zm9ybS1zcGVjaWZpYwogICAgICAgICAgICAgICAgIyBhc3ltbWV0cmljIGltcGxlbWVudGF0aW9uLiBUaGlzIGlzIHRoZSByZWFzb24gYSBidW5jaCBvZiB0aGUKICAgICAgICAgICAgICAgICMgaW1wb3J0cyBhcmUgbW9kdWxlIGltcG9ydHMsIHNvIHdlIGRvbid0IGdldCBhbiBpbXBvcnQgY3ljbGUuCiAgICAgICAgICAgICAgICBwdWJsaWNfa2V5X29iamVjdCA9IGxvYWRfcHJpdmF0ZV9rZXkoa2V5X29iamVjdCkucHVibGljX2tleQogICAgICAgICAgICAgICAgcHVibGljX2tleSA9IHB1YmxpY19rZXlfb2JqZWN0LmFzbjFbJ3B1YmxpY19rZXknXS5wYXJzZWQubmF0aXZlCgogICAgICAgICAgICB0b19oYXNoID0gJyVzOicgJSBrZXlfb2JqZWN0LmN1cnZlWzFdCiAgICAgICAgICAgIHRvX2hhc2ggPSB0b19oYXNoLmVuY29kZSgndXRmLTgnKQogICAgICAgICAgICB0b19oYXNoICs9IHB1YmxpY19rZXkKCiAgICAgICAgaWYgaXNpbnN0YW5jZSh0b19oYXNoLCBzdHJfY2xzKToKICAgICAgICAgICAgdG9faGFzaCA9IHRvX2hhc2guZW5jb2RlKCd1dGYtOCcpCgogICAgICAgIHJldHVybiBoYXNobGliLnNoYTI1Nih0b19oYXNoKS5kaWdlc3QoKQoKICAgIGlmIGlzaW5zdGFuY2Uoa2V5X29iamVjdCwgUHVibGljS2V5SW5mbyk6CiAgICAgICAgaWYga2V5X29iamVjdC5hbGdvcml0aG0gPT0gJ3JzYSc6CiAgICAgICAgICAgIGtleSA9IGtleV9vYmplY3RbJ3B1YmxpY19rZXknXS5wYXJzZWQKCiAgICAgICAgICAgIHRvX2hhc2ggPSAnJWQ6JWQnICUgKAogICAgICAgICAgICAgICAga2V5Wydtb2R1bHVzJ10ubmF0aXZlLAogICAgICAgICAgICAgICAga2V5WydwdWJsaWNfZXhwb25lbnQnXS5uYXRpdmUsCiAgICAgICAgICAgICkKCiAgICAgICAgZWxpZiBrZXlfb2JqZWN0LmFsZ29yaXRobSA9PSAnZHNhJzoKICAgICAgICAgICAga2V5ID0ga2V5X29iamVjdFsncHVibGljX2tleSddLnBhcnNlZAogICAgICAgICAgICBwYXJhbXMgPSBrZXlfb2JqZWN0WydhbGdvcml0aG0nXVsncGFyYW1ldGVycyddCgogICAgICAgICAgICB0b19oYXNoID0gJyVkOiVkOiVkOiVkJyAlICgKICAgICAgICAgICAgICAgIHBhcmFtc1sncCddLm5hdGl2ZSwKICAgICAgICAgICAgICAgIHBhcmFtc1sncSddLm5hdGl2ZSwKICAgICAgICAgICAgICAgIHBhcmFtc1snZyddLm5hdGl2ZSwKICAgICAgICAgICAgICAgIGtleS5uYXRpdmUsCiAgICAgICAgICAgICkKCiAgICAgICAgZWxpZiBrZXlfb2JqZWN0LmFsZ29yaXRobSA9PSAnZWMnOgogICAgICAgICAgICBwdWJsaWNfa2V5ID0ga2V5X29iamVjdFsncHVibGljX2tleSddLm5hdGl2ZQoKICAgICAgICAgICAgdG9faGFzaCA9ICclczonICUga2V5X29iamVjdC5jdXJ2ZVsxXQogICAgICAgICAgICB0b19oYXNoID0gdG9faGFzaC5lbmNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgdG9faGFzaCArPSBwdWJsaWNfa2V5CgogICAgICAgIGlmIGlzaW5zdGFuY2UodG9faGFzaCwgc3RyX2Nscyk6CiAgICAgICAgICAgIHRvX2hhc2ggPSB0b19oYXNoLmVuY29kZSgndXRmLTgnKQoKICAgICAgICByZXR1cm4gaGFzaGxpYi5zaGEyNTYodG9faGFzaCkuZGlnZXN0KCkKCiAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICcnJwogICAgICAgIGtleV9vYmplY3QgbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiB0aGUKICAgICAgICBhc24xY3J5cHRvLmtleXMuUHJpdmF0ZUtleUluZm8gb3IgYXNuMWNyeXB0by5rZXlzLlB1YmxpY0tleUluZm8KICAgICAgICBjbGFzc2VzLCBub3QgJXMKICAgICAgICAnJycsCiAgICAgICAgdHlwZV9uYW1lKGtleV9vYmplY3QpCiAgICApKQoKCmNyeXB0b19mdW5jcyA9IHsKICAgICdyYzInOiByYzJfY2JjX3BrY3M1X2RlY3J5cHQsCiAgICAncmM0JzogcmM0X2RlY3J5cHQsCiAgICAnZGVzJzogZGVzX2NiY19wa2NzNV9kZWNyeXB0LAogICAgJ3RyaXBsZWRlcyc6IHRyaXBsZWRlc19jYmNfcGtjczVfZGVjcnlwdCwKICAgICdhZXMnOiBhZXNfY2JjX3BrY3M3X2RlY3J5cHQsCn0KCgpkZWYgcGFyc2VfcHVibGljKGRhdGEpOgogICAgIiIiCiAgICBMb2FkcyBhIHB1YmxpYyBrZXkgZnJvbSBhIERFUiBvciBQRU0tZm9ybWF0dGVkIGZpbGUuIFN1cHBvcnRzIFJTQSwgRFNBIGFuZAogICAgRUMgcHVibGljIGtleXMuIEZvciBSU0Ega2V5cywgYm90aCB0aGUgb2xkIFJTQVB1YmxpY0tleSBhbmQKICAgIFN1YmplY3RQdWJsaWNLZXlJbmZvIHN0cnVjdHVyZXMgYXJlIHN1cHBvcnRlZC4gQWxzbyBhbGxvd3MgZXh0cmFjdGluZyBhCiAgICBwdWJsaWMga2V5IGZyb20gYW4gWC41MDkgY2VydGlmaWNhdGUuCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgQSBieXRlIHN0cmluZyB0byBsb2FkIHRoZSBwdWJsaWMga2V5IGZyb20KCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIHRoZSBkYXRhIGRvZXMgbm90IGFwcGVhciB0byBjb250YWluIGEgcHVibGljIGtleQoKICAgIDpyZXR1cm46CiAgICAgICAgQW4gYXNuMWNyeXB0by5rZXlzLlB1YmxpY0tleUluZm8gb2JqZWN0CiAgICAiIiIKCiAgICBpZiBub3QgaXNpbnN0YW5jZShkYXRhLCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgZGF0YSBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShkYXRhKQogICAgICAgICkpCgogICAga2V5X3R5cGUgPSBOb25lCgogICAgIyBBcHBlYXJzIHRvIGJlIFBFTSBmb3JtYXR0ZWQKICAgIGlmIHJlLm1hdGNoKGInXFxzKi0tLS0tJywgZGF0YSkgaXMgbm90IE5vbmU6CiAgICAgICAga2V5X3R5cGUsIGFsZ28sIGRhdGEgPSBfdW5hcm1vcl9wZW0oZGF0YSkKCiAgICAgICAgaWYga2V5X3R5cGUgPT0gJ3ByaXZhdGUga2V5JzoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICAgICAgVGhlIGRhdGEgc3BlY2lmaWVkIGRvZXMgbm90IGFwcGVhciB0byBiZSBhIHB1YmxpYyBrZXkgb3IKICAgICAgICAgICAgICAgIGNlcnRpZmljYXRlLCBidXQgcmF0aGVyIGEgcHJpdmF0ZSBrZXkKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICApKQoKICAgICAgICAjIFdoZW4gYSBwdWJsaWMga2V5IHJldHVybmluZyBmcm9tIF91bmFybW9yX3BlbSBoYXMgYSBrbm93biBhbGdvcml0aG0KICAgICAgICAjIG9mIFJTQSwgdGhhdCBtZWFucyB0aGUgREVSIHN0cnVjdHVyZSBpcyBvZiB0aGUgdHlwZSBSU0FQdWJsaWNLZXksIHNvCiAgICAgICAgIyB3ZSBuZWVkIHRvIHdyYXAgaXQgaW4gdGhlIFB1YmxpY0tleUluZm8gc3RydWN0dXJlLgogICAgICAgIGlmIGFsZ28gPT0gJ3JzYSc6CiAgICAgICAgICAgIHJldHVybiBQdWJsaWNLZXlJbmZvLndyYXAoZGF0YSwgJ3JzYScpCgogICAgaWYga2V5X3R5cGUgaXMgTm9uZSBvciBrZXlfdHlwZSA9PSAncHVibGljIGtleSc6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBwa2kgPSBQdWJsaWNLZXlJbmZvLmxvYWQoZGF0YSkKICAgICAgICAgICAgIyBDYWxsIC5uYXRpdmUgdG8gZnVsbHkgcGFyc2Ugc2luY2UgYXNuMWNyeXB0byBpcyBsYXp5CiAgICAgICAgICAgIHBraS5uYXRpdmUKICAgICAgICAgICAgcmV0dXJuIHBraQogICAgICAgIGV4Y2VwdCAoVmFsdWVFcnJvcik6CiAgICAgICAgICAgIHBhc3MgICMgRGF0YSB3YXMgbm90IFB1YmxpY0tleUluZm8KCiAgICAgICAgdHJ5OgogICAgICAgICAgICBycGsgPSBSU0FQdWJsaWNLZXkubG9hZChkYXRhKQogICAgICAgICAgICAjIENhbGwgLm5hdGl2ZSB0byBmdWxseSBwYXJzZSBzaW5jZSBhc24xY3J5cHRvIGlzIGxhenkKICAgICAgICAgICAgcnBrLm5hdGl2ZQogICAgICAgICAgICByZXR1cm4gUHVibGljS2V5SW5mby53cmFwKHJwaywgJ3JzYScpCiAgICAgICAgZXhjZXB0IChWYWx1ZUVycm9yKToKICAgICAgICAgICAgcGFzcyAgIyBEYXRhIHdhcyBub3QgYW4gUlNBUHVibGljS2V5CgogICAgaWYga2V5X3R5cGUgaXMgTm9uZSBvciBrZXlfdHlwZSA9PSAnY2VydGlmaWNhdGUnOgogICAgICAgIHRyeToKICAgICAgICAgICAgcGFyc2VkX2NlcnQgPSBDZXJ0aWZpY2F0ZS5sb2FkKGRhdGEpCiAgICAgICAgICAgIGtleV9pbmZvID0gcGFyc2VkX2NlcnRbJ3Ric19jZXJ0aWZpY2F0ZSddWydzdWJqZWN0X3B1YmxpY19rZXlfaW5mbyddCiAgICAgICAgICAgIHJldHVybiBrZXlfaW5mbwogICAgICAgIGV4Y2VwdCAoVmFsdWVFcnJvcik6CiAgICAgICAgICAgIHBhc3MgICMgRGF0YSB3YXMgbm90IGEgY2VydAoKICAgIHJhaXNlIFZhbHVlRXJyb3IoJ1RoZSBkYXRhIHNwZWNpZmllZCBkb2VzIG5vdCBhcHBlYXIgdG8gYmUgYSBrbm93biBwdWJsaWMga2V5IG9yIGNlcnRpZmljYXRlIGZvcm1hdCcpCgoKZGVmIHBhcnNlX2NlcnRpZmljYXRlKGRhdGEpOgogICAgIiIiCiAgICBMb2FkcyBhIGNlcnRpZmljYXRlIGZyb20gYSBERVIgb3IgUEVNLWZvcm1hdHRlZCBmaWxlLiBTdXBwb3J0cyBYLjUwOQogICAgY2VydGlmaWNhdGVzIG9ubHkuCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgQSBieXRlIHN0cmluZyB0byBsb2FkIHRoZSBjZXJ0aWZpY2F0ZSBmcm9tCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiB0aGUgZGF0YSBkb2VzIG5vdCBhcHBlYXIgdG8gY29udGFpbiBhIGNlcnRpZmljYXRlCgogICAgOnJldHVybjoKICAgICAgICBBbiBhc24xY3J5cHRvLng1MDkuQ2VydGlmaWNhdGUgb2JqZWN0CiAgICAiIiIKCiAgICBpZiBub3QgaXNpbnN0YW5jZShkYXRhLCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgZGF0YSBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShkYXRhKQogICAgICAgICkpCgogICAga2V5X3R5cGUgPSBOb25lCgogICAgIyBBcHBlYXJzIHRvIGJlIFBFTSBmb3JtYXR0ZWQKICAgIGlmIHJlLm1hdGNoKGInXFxzKi0tLS0tJywgZGF0YSkgaXMgbm90IE5vbmU6CiAgICAgICAga2V5X3R5cGUsIF8sIGRhdGEgPSBfdW5hcm1vcl9wZW0oZGF0YSkKCiAgICAgICAgaWYga2V5X3R5cGUgPT0gJ3ByaXZhdGUga2V5JzoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICAgICAgVGhlIGRhdGEgc3BlY2lmaWVkIGRvZXMgbm90IGFwcGVhciB0byBiZSBhIGNlcnRpZmljYXRlLCBidXQKICAgICAgICAgICAgICAgIHJhdGhlciBhIHByaXZhdGUga2V5CiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgKSkKCiAgICAgICAgaWYga2V5X3R5cGUgPT0gJ3B1YmxpYyBrZXknOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBUaGUgZGF0YSBzcGVjaWZpZWQgZG9lcyBub3QgYXBwZWFyIHRvIGJlIGEgY2VydGlmaWNhdGUsIGJ1dAogICAgICAgICAgICAgICAgcmF0aGVyIGEgcHVibGljIGtleQogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICkpCgogICAgaWYga2V5X3R5cGUgaXMgTm9uZSBvciBrZXlfdHlwZSA9PSAnY2VydGlmaWNhdGUnOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIENlcnRpZmljYXRlLmxvYWQoZGF0YSkKICAgICAgICBleGNlcHQgKFZhbHVlRXJyb3IpOgogICAgICAgICAgICBwYXNzICAjIERhdGEgd2FzIG5vdCBhIENlcnRpZmljYXRlCgogICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAnJycKICAgICAgICBUaGUgZGF0YSBzcGVjaWZpZWQgZG9lcyBub3QgYXBwZWFyIHRvIGJlIGEga25vd24gY2VydGlmaWNhdGUgZm9ybWF0CiAgICAgICAgJycnCiAgICApKQoKCmRlZiBwYXJzZV9wcml2YXRlKGRhdGEsIHBhc3N3b3JkPU5vbmUpOgogICAgIiIiCiAgICBMb2FkcyBhIHByaXZhdGUga2V5IGZyb20gYSBERVIgb3IgUEVNLWZvcm1hdHRlZCBmaWxlLiBTdXBwb3J0cyBSU0EsIERTQSBhbmQKICAgIEVDIHByaXZhdGUga2V5cy4gV29ya3Mgd2l0aCB0aGUgZm9sbG93IGZvcm1hdHM6CgogICAgIC0gUlNBUHJpdmF0ZUtleSAoUEtDUyMxKQogICAgIC0gRUNQcml2YXRlS2V5IChTRUNHIFNFQzEgVjIpCiAgICAgLSBEU0FQcml2YXRlS2V5IChPcGVuU1NMKQogICAgIC0gUHJpdmF0ZUtleUluZm8gKFJTQS9EU0EvRUMgLSBQS0NTIzgpCiAgICAgLSBFbmNyeXB0ZWRQcml2YXRlS2V5SW5mbyAoUlNBL0RTQS9FQyAtIFBLQ1MjOCkKICAgICAtIEVuY3J5cHRlZCBSU0FQcml2YXRlS2V5IChQRU0gb25seSwgT3BlblNTTCkKICAgICAtIEVuY3J5cHRlZCBEU0FQcml2YXRlS2V5IChQRU0gb25seSwgT3BlblNTTCkKICAgICAtIEVuY3J5cHRlZCBFQ1ByaXZhdGVLZXkgKFBFTSBvbmx5LCBPcGVuU1NMKQoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgdG8gbG9hZCB0aGUgcHJpdmF0ZSBrZXkgZnJvbQoKICAgIDpwYXJhbSBwYXNzd29yZDoKICAgICAgICBUaGUgcGFzc3dvcmQgdG8gdW5lbmNyeXB0IHRoZSBwcml2YXRlIGtleQoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gdGhlIGRhdGEgZG9lcyBub3QgYXBwZWFyIHRvIGNvbnRhaW4gYSBwcml2YXRlIGtleSwgb3IgdGhlIHBhc3N3b3JkIGlzIGludmFsaWQKCiAgICA6cmV0dXJuOgogICAgICAgIEFuIGFzbjFjcnlwdG8ua2V5cy5Qcml2YXRlS2V5SW5mbyBvYmplY3QKICAgICIiIgoKICAgIGlmIG5vdCBpc2luc3RhbmNlKGRhdGEsIGJ5dGVfY2xzKToKICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBkYXRhIG11c3QgYmUgYSBieXRlIHN0cmluZywgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKGRhdGEpCiAgICAgICAgKSkKCiAgICBpZiBwYXNzd29yZCBpcyBub3QgTm9uZToKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShwYXNzd29yZCwgYnl0ZV9jbHMpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIHBhc3N3b3JkIG11c3QgYmUgYSBieXRlIHN0cmluZywgbm90ICVzCiAgICAgICAgICAgICAgICAnJycsCiAgICAgICAgICAgICAgICB0eXBlX25hbWUocGFzc3dvcmQpCiAgICAgICAgICAgICkpCiAgICBlbHNlOgogICAgICAgIHBhc3N3b3JkID0gYicnCgogICAgIyBBcHBlYXJzIHRvIGJlIFBFTSBmb3JtYXR0ZWQKICAgIGlmIHJlLm1hdGNoKGInXFxzKi0tLS0tJywgZGF0YSkgaXMgbm90IE5vbmU6CiAgICAgICAga2V5X3R5cGUsIF8sIGRhdGEgPSBfdW5hcm1vcl9wZW0oZGF0YSwgcGFzc3dvcmQpCgogICAgICAgIGlmIGtleV90eXBlID09ICdwdWJsaWMga2V5JzoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICAgICAgVGhlIGRhdGEgc3BlY2lmaWVkIGRvZXMgbm90IGFwcGVhciB0byBiZSBhIHByaXZhdGUga2V5LCBidXQKICAgICAgICAgICAgICAgIHJhdGhlciBhIHB1YmxpYyBrZXkKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICApKQoKICAgICAgICBpZiBrZXlfdHlwZSA9PSAnY2VydGlmaWNhdGUnOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBUaGUgZGF0YSBzcGVjaWZpZWQgZG9lcyBub3QgYXBwZWFyIHRvIGJlIGEgcHJpdmF0ZSBrZXksIGJ1dAogICAgICAgICAgICAgICAgcmF0aGVyIGEgY2VydGlmaWNhdGUKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICApKQoKICAgIHRyeToKICAgICAgICBwa2kgPSBQcml2YXRlS2V5SW5mby5sb2FkKGRhdGEpCiAgICAgICAgIyBDYWxsIC5uYXRpdmUgdG8gZnVsbHkgcGFyc2Ugc2luY2UgYXNuMWNyeXB0byBpcyBsYXp5CiAgICAgICAgcGtpLm5hdGl2ZQogICAgICAgIHJldHVybiBwa2kKICAgIGV4Y2VwdCAoVmFsdWVFcnJvcik6CiAgICAgICAgcGFzcyAgIyBEYXRhIHdhcyBub3QgUHJpdmF0ZUtleUluZm8KCiAgICB0cnk6CiAgICAgICAgcGFyc2VkX3dyYXBwZXIgPSBFbmNyeXB0ZWRQcml2YXRlS2V5SW5mby5sb2FkKGRhdGEpCiAgICAgICAgZW5jcnlwdGlvbl9hbGdvcml0aG1faW5mbyA9IHBhcnNlZF93cmFwcGVyWydlbmNyeXB0aW9uX2FsZ29yaXRobSddCiAgICAgICAgZW5jcnlwdGVkX2RhdGEgPSBwYXJzZWRfd3JhcHBlclsnZW5jcnlwdGVkX2RhdGEnXS5uYXRpdmUKICAgICAgICBkZWNyeXB0ZWRfZGF0YSA9IF9kZWNyeXB0X2VuY3J5cHRlZF9kYXRhKGVuY3J5cHRpb25fYWxnb3JpdGhtX2luZm8sIGVuY3J5cHRlZF9kYXRhLCBwYXNzd29yZCkKICAgICAgICBwa2kgPSBQcml2YXRlS2V5SW5mby5sb2FkKGRlY3J5cHRlZF9kYXRhKQogICAgICAgICMgQ2FsbCAubmF0aXZlIHRvIGZ1bGx5IHBhcnNlIHNpbmNlIGFzbjFjcnlwdG8gaXMgbGF6eQogICAgICAgIHBraS5uYXRpdmUKICAgICAgICByZXR1cm4gcGtpCiAgICBleGNlcHQgKFZhbHVlRXJyb3IpOgogICAgICAgIHBhc3MgICMgRGF0YSB3YXMgbm90IEVuY3J5cHRlZFByaXZhdGVLZXlJbmZvCgogICAgdHJ5OgogICAgICAgIHBhcnNlZCA9IFJTQVByaXZhdGVLZXkubG9hZChkYXRhKQogICAgICAgICMgQ2FsbCAubmF0aXZlIHRvIGZ1bGx5IHBhcnNlIHNpbmNlIGFzbjFjcnlwdG8gaXMgbGF6eQogICAgICAgIHBhcnNlZC5uYXRpdmUKICAgICAgICByZXR1cm4gUHJpdmF0ZUtleUluZm8ud3JhcChwYXJzZWQsICdyc2EnKQogICAgZXhjZXB0IChWYWx1ZUVycm9yKToKICAgICAgICBwYXNzICAjIERhdGEgd2FzIG5vdCBhbiBSU0FQcml2YXRlS2V5CgogICAgdHJ5OgogICAgICAgIHBhcnNlZCA9IERTQVByaXZhdGVLZXkubG9hZChkYXRhKQogICAgICAgICMgQ2FsbCAubmF0aXZlIHRvIGZ1bGx5IHBhcnNlIHNpbmNlIGFzbjFjcnlwdG8gaXMgbGF6eQogICAgICAgIHBhcnNlZC5uYXRpdmUKICAgICAgICByZXR1cm4gUHJpdmF0ZUtleUluZm8ud3JhcChwYXJzZWQsICdkc2EnKQogICAgZXhjZXB0IChWYWx1ZUVycm9yKToKICAgICAgICBwYXNzICAjIERhdGEgd2FzIG5vdCBhIERTQVByaXZhdGVLZXkKCiAgICB0cnk6CiAgICAgICAgcGFyc2VkID0gRUNQcml2YXRlS2V5LmxvYWQoZGF0YSkKICAgICAgICAjIENhbGwgLm5hdGl2ZSB0byBmdWxseSBwYXJzZSBzaW5jZSBhc24xY3J5cHRvIGlzIGxhenkKICAgICAgICBwYXJzZWQubmF0aXZlCiAgICAgICAgcmV0dXJuIFByaXZhdGVLZXlJbmZvLndyYXAocGFyc2VkLCAnZWMnKQogICAgZXhjZXB0IChWYWx1ZUVycm9yKToKICAgICAgICBwYXNzICAjIERhdGEgd2FzIG5vdCBhbiBFQ1ByaXZhdGVLZXkKCiAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICcnJwogICAgICAgIFRoZSBkYXRhIHNwZWNpZmllZCBkb2VzIG5vdCBhcHBlYXIgdG8gYmUgYSBrbm93biBwcml2YXRlIGtleSBmb3JtYXQKICAgICAgICAnJycKICAgICkpCgoKZGVmIF91bmFybW9yX3BlbShkYXRhLCBwYXNzd29yZD1Ob25lKToKICAgICIiIgogICAgUmVtb3ZlcyBQRU0tZW5jb2RpbmcgZnJvbSBhIHB1YmxpYyBrZXksIHByaXZhdGUga2V5IG9yIGNlcnRpZmljYXRlLiBJZiB0aGUKICAgIHByaXZhdGUga2V5IGlzIGVuY3J5cHRlZCwgdGhlIHBhc3N3b3JkIHdpbGwgYmUgdXNlZCB0byBkZWNyeXB0IGl0LgoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIFBFTS1lbmNvZGVkIGRhdGEKCiAgICA6cGFyYW0gcGFzc3dvcmQ6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgZW5jcnlwdGlvbiBwYXNzd29yZCwgb3IgTm9uZQoKICAgIDpyZXR1cm46CiAgICAgICAgQSAzLWVsZW1lbnQgdHVwbGUgaW4gdGhlIGZvcm1hdDogKGtleV90eXBlLCBhbGdvcml0aG0sIGRlcl9ieXRlcykuIFRoZQogICAgICAgIGtleV90eXBlIHdpbGwgYmUgYSB1bmljb2RlIHN0cmluZyBvZiAicHVibGljIGtleSIsICJwcml2YXRlIGtleSIgb3IKICAgICAgICAiY2VydGlmaWNhdGUiLiBUaGUgYWxnb3JpdGhtIHdpbGwgYmUgYSB1bmljb2RlIHN0cmluZyBvZiAicnNhIiwgImRzYSIKICAgICAgICBvciAiZWMiLgogICAgIiIiCgogICAgb2JqZWN0X3R5cGUsIGhlYWRlcnMsIGRlcl9ieXRlcyA9IHVuYXJtb3IoZGF0YSkKCiAgICB0eXBlX3JlZ2V4ID0gJ14oKERTQXxFQ3xSU0EpIFBSSVZBVEUgS0VZfEVOQ1JZUFRFRCBQUklWQVRFIEtFWXxQUklWQVRFIEtFWXxQVUJMSUMgS0VZfFJTQSBQVUJMSUMgS0VZfENFUlRJRklDQVRFKScKICAgIGFybW9yX3R5cGUgPSByZS5tYXRjaCh0eXBlX3JlZ2V4LCBvYmplY3RfdHlwZSkKICAgIGlmIG5vdCBhcm1vcl90eXBlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBkYXRhIGRvZXMgbm90IHNlZW0gdG8gY29udGFpbiBhIFBFTS1lbmNvZGVkIGNlcnRpZmljYXRlLCBwcml2YXRlCiAgICAgICAgICAgIGtleSBvciBwdWJsaWMga2V5CiAgICAgICAgICAgICcnJwogICAgICAgICkpCgogICAgcGVtX2hlYWRlciA9IGFybW9yX3R5cGUuZ3JvdXAoMSkKCiAgICBkYXRhID0gZGF0YS5zdHJpcCgpCgogICAgIyBSU0EgcHJpdmF0ZSBrZXlzIGFyZSBlbmNyeXB0ZWQgYWZ0ZXIgYmVpbmcgREVSLWVuY29kZWQsIGJ1dCBiZWZvcmUgYmFzZTY0CiAgICAjIGVuY29kaW5nLCBzbyB0aGV5IG5lZWQgdG8gYmUgaGFuZGxlZCBzcGVjaWFsbHkKICAgIGlmIHBlbV9oZWFkZXIgaW4gc2V0KFsnUlNBIFBSSVZBVEUgS0VZJywgJ0RTQSBQUklWQVRFIEtFWScsICdFQyBQUklWQVRFIEtFWSddKToKICAgICAgICBhbGdvID0gYXJtb3JfdHlwZS5ncm91cCgyKS5sb3dlcigpCiAgICAgICAgcmV0dXJuICgncHJpdmF0ZSBrZXknLCBhbGdvLCBfdW5hcm1vcl9wZW1fb3BlbnNzbF9wcml2YXRlKGhlYWRlcnMsIGRlcl9ieXRlcywgcGFzc3dvcmQpKQoKICAgIGtleV90eXBlID0gcGVtX2hlYWRlci5sb3dlcigpCiAgICBhbGdvID0gTm9uZQogICAgaWYga2V5X3R5cGUgPT0gJ2VuY3J5cHRlZCBwcml2YXRlIGtleSc6CiAgICAgICAga2V5X3R5cGUgPSAncHJpdmF0ZSBrZXknCiAgICBlbGlmIGtleV90eXBlID09ICdyc2EgcHVibGljIGtleSc6CiAgICAgICAga2V5X3R5cGUgPSAncHVibGljIGtleScKICAgICAgICBhbGdvID0gJ3JzYScKCiAgICByZXR1cm4gKGtleV90eXBlLCBhbGdvLCBkZXJfYnl0ZXMpCgoKZGVmIF91bmFybW9yX3BlbV9vcGVuc3NsX3ByaXZhdGUoaGVhZGVycywgZGF0YSwgcGFzc3dvcmQpOgogICAgIiIiCiAgICBQYXJzZXMgYSBQS0NTIzEgcHJpdmF0ZSBrZXksIG9yIGVuY3J5cHRlZCBwcml2YXRlIGtleQoKICAgIDpwYXJhbSBoZWFkZXJzOgogICAgICAgIEEgZGljdCBvZiAiTmFtZTogVmFsdWUiIGxpbmVzIGZyb20gcmlnaHQgYWZ0ZXIgdGhlIFBFTSBoZWFkZXIKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBERVItZW5jb2RlZCBQS0NTIzEgcHJpdmF0ZSBrZXkKCiAgICA6cGFyYW0gcGFzc3dvcmQ6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgcGFzc3dvcmQgdG8gdXNlIGlmIHRoZSBwcml2YXRlIGtleSBpcyBlbmNyeXB0ZWQKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIERFUi1lbmNvZGVkIHByaXZhdGUga2V5CiAgICAiIiIKCiAgICBlbmNfYWxnbyA9IE5vbmUKICAgIGVuY19pdl9oZXggPSBOb25lCiAgICBlbmNfaXYgPSBOb25lCgogICAgaWYgJ0RFSy1JbmZvJyBpbiBoZWFkZXJzOgogICAgICAgIHBhcmFtcyA9IGhlYWRlcnNbJ0RFSy1JbmZvJ10KICAgICAgICBpZiBwYXJhbXMuZmluZCgnLCcpICE9IC0xOgogICAgICAgICAgICBlbmNfYWxnbywgZW5jX2l2X2hleCA9IHBhcmFtcy5zdHJpcCgpLnNwbGl0KCcsJykKICAgICAgICBlbHNlOgogICAgICAgICAgICBlbmNfYWxnbyA9ICdSQzQnCgogICAgaWYgbm90IGVuY19hbGdvOgogICAgICAgIHJldHVybiBkYXRhCgogICAgaWYgZW5jX2l2X2hleDoKICAgICAgICBlbmNfaXYgPSBiaW5hc2NpaS51bmhleGxpZnkoZW5jX2l2X2hleC5lbmNvZGUoJ2FzY2lpJykpCiAgICBlbmNfYWxnbyA9IGVuY19hbGdvLmxvd2VyKCkKCiAgICBlbmNfa2V5X2xlbmd0aCA9IHsKICAgICAgICAnYWVzLTEyOC1jYmMnOiAxNiwKICAgICAgICAnYWVzLTEyOCc6IDE2LAogICAgICAgICdhZXMtMTkyLWNiYyc6IDI0LAogICAgICAgICdhZXMtMTkyJzogMjQsCiAgICAgICAgJ2Flcy0yNTYtY2JjJzogMzIsCiAgICAgICAgJ2Flcy0yNTYnOiAzMiwKICAgICAgICAncmM0JzogMTYsCiAgICAgICAgJ3JjNC02NCc6IDgsCiAgICAgICAgJ3JjNC00MCc6IDUsCiAgICAgICAgJ3JjMi02NC1jYmMnOiA4LAogICAgICAgICdyYzItNDAtY2JjJzogNSwKICAgICAgICAncmMyLWNiYyc6IDE2LAogICAgICAgICdyYzInOiAxNiwKICAgICAgICAnZGVzLWVkZTMtY2JjJzogMjQsCiAgICAgICAgJ2Rlcy1lZGUzJzogMjQsCiAgICAgICAgJ2RlczMnOiAyNCwKICAgICAgICAnZGVzLWVkZS1jYmMnOiAxNiwKICAgICAgICAnZGVzLWNiYyc6IDgsCiAgICAgICAgJ2Rlcyc6IDgsCiAgICB9W2VuY19hbGdvXQoKICAgIGVuY19rZXkgPSBoYXNobGliLm1kNShwYXNzd29yZCArIGVuY19pdlswOjhdKS5kaWdlc3QoKQogICAgd2hpbGUgZW5jX2tleV9sZW5ndGggPiBsZW4oZW5jX2tleSk6CiAgICAgICAgZW5jX2tleSArPSBoYXNobGliLm1kNShlbmNfa2V5ICsgcGFzc3dvcmQgKyBlbmNfaXZbMDo4XSkuZGlnZXN0KCkKICAgIGVuY19rZXkgPSBlbmNfa2V5WzA6ZW5jX2tleV9sZW5ndGhdCgogICAgZW5jX2FsZ29fbmFtZSA9IHsKICAgICAgICAnYWVzLTEyOC1jYmMnOiAnYWVzJywKICAgICAgICAnYWVzLTEyOCc6ICdhZXMnLAogICAgICAgICdhZXMtMTkyLWNiYyc6ICdhZXMnLAogICAgICAgICdhZXMtMTkyJzogJ2FlcycsCiAgICAgICAgJ2Flcy0yNTYtY2JjJzogJ2FlcycsCiAgICAgICAgJ2Flcy0yNTYnOiAnYWVzJywKICAgICAgICAncmM0JzogJ3JjNCcsCiAgICAgICAgJ3JjNC02NCc6ICdyYzQnLAogICAgICAgICdyYzQtNDAnOiAncmM0JywKICAgICAgICAncmMyLTY0LWNiYyc6ICdyYzInLAogICAgICAgICdyYzItNDAtY2JjJzogJ3JjMicsCiAgICAgICAgJ3JjMi1jYmMnOiAncmMyJywKICAgICAgICAncmMyJzogJ3JjMicsCiAgICAgICAgJ2Rlcy1lZGUzLWNiYyc6ICd0cmlwbGVkZXMnLAogICAgICAgICdkZXMtZWRlMyc6ICd0cmlwbGVkZXMnLAogICAgICAgICdkZXMzJzogJ3RyaXBsZWRlcycsCiAgICAgICAgJ2Rlcy1lZGUtY2JjJzogJ3RyaXBsZWRlcycsCiAgICAgICAgJ2Rlcy1jYmMnOiAnZGVzJywKICAgICAgICAnZGVzJzogJ2RlcycsCiAgICB9W2VuY19hbGdvXQogICAgZGVjcnlwdF9mdW5jID0gY3J5cHRvX2Z1bmNzW2VuY19hbGdvX25hbWVdCgogICAgaWYgZW5jX2FsZ29fbmFtZSA9PSAncmM0JzoKICAgICAgICByZXR1cm4gZGVjcnlwdF9mdW5jKGVuY19rZXksIGRhdGEpCgogICAgcmV0dXJuIGRlY3J5cHRfZnVuYyhlbmNfa2V5LCBkYXRhLCBlbmNfaXYpCgoKZGVmIF9wYXJzZV9wa2NzMTIoZGF0YSwgcGFzc3dvcmQsIGxvYWRfcHJpdmF0ZV9rZXkpOgogICAgIiIiCiAgICBQYXJzZXMgYSBQS0NTIzEyIEFOUy4xIERFUi1lbmNvZGVkIHN0cnVjdHVyZSBhbmQgZXh0cmFjdHMgY2VydHMgYW5kIGtleXMKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIGEgREVSLWVuY29kZWQgUEtDUyMxMiBmaWxlCgogICAgOnBhcmFtIHBhc3N3b3JkOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHBhc3N3b3JkIHRvIGFueSBlbmNyeXB0ZWQgZGF0YQoKICAgIDpwYXJhbSBsb2FkX3ByaXZhdGVfa2V5OgogICAgICAgIEEgY2FsbGFibGUgdGhhdCB3aWxsIGFjY2VwdCBhIGJ5dGUgc3RyaW5nIGFuZCByZXR1cm4gYW4KICAgICAgICBvc2NyeXB0by5hc3ltbWV0cmljLlByaXZhdGVLZXkgb2JqZWN0CgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlIG9yIHZhbHVlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgb25lIG9mIHRoZSBPUyBkZWNyeXB0aW9uIGZ1bmN0aW9ucwoKICAgIDpyZXR1cm46CiAgICAgICAgQSB0aHJlZS1lbGVtZW50IHR1cGxlIG9mOgogICAgICAgICAxLiBBbiBhc24xY3J5cHRvLmtleXMuUHJpdmF0ZUtleUluZm8gb2JqZWN0CiAgICAgICAgIDIuIEFuIGFzbjFjcnlwdG8ueDUwOS5DZXJ0aWZpY2F0ZSBvYmplY3QKICAgICAgICAgMy4gQSBsaXN0IG9mIHplcm8gb3IgbW9yZSBhc24xY3J5cHRvLng1MDkuQ2VydGlmaWNhdGUgb2JqZWN0cyB0aGF0IGFyZQogICAgICAgICAgICAiZXh0cmEiIGNlcnRpZmljYXRlcywgcG9zc2libHkgaW50ZXJtZWRpYXRlcyBmcm9tIHRoZSBjZXJ0IGNoYWluCiAgICAiIiIKCiAgICBpZiBub3QgaXNpbnN0YW5jZShkYXRhLCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgZGF0YSBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShkYXRhKQogICAgICAgICkpCgogICAgaWYgcGFzc3dvcmQgaXMgbm90IE5vbmU6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UocGFzc3dvcmQsIGJ5dGVfY2xzKToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBwYXNzd29yZCBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAgICAgJycnLAogICAgICAgICAgICAgICAgdHlwZV9uYW1lKHBhc3N3b3JkKQogICAgICAgICAgICApKQogICAgZWxzZToKICAgICAgICBwYXNzd29yZCA9IGInJwoKICAgIGNlcnRzID0ge30KICAgIHByaXZhdGVfa2V5cyA9IHt9CgogICAgcGZ4ID0gUGZ4LmxvYWQoZGF0YSkKCiAgICBhdXRoX3NhZmUgPSBwZnhbJ2F1dGhfc2FmZSddCiAgICBpZiBhdXRoX3NhZmVbJ2NvbnRlbnRfdHlwZSddLm5hdGl2ZSAhPSAnZGF0YSc6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIE9ubHkgcGFzc3dvcmQtcHJvdGVjdGVkIFBLQ1MxMiBmaWxlcyBhcmUgY3VycmVudGx5IHN1cHBvcnRlZAogICAgICAgICAgICAnJycKICAgICAgICApKQogICAgYXV0aGVudGljYXRlZF9zYWZlID0gcGZ4LmF1dGhlbnRpY2F0ZWRfc2FmZQoKICAgIG1hY19kYXRhID0gcGZ4WydtYWNfZGF0YSddCiAgICBpZiBtYWNfZGF0YToKICAgICAgICBtYWNfYWxnbyA9IG1hY19kYXRhWydtYWMnXVsnZGlnZXN0X2FsZ29yaXRobSddWydhbGdvcml0aG0nXS5uYXRpdmUKICAgICAgICBrZXlfbGVuZ3RoID0gewogICAgICAgICAgICAnc2hhMSc6IDIwLAogICAgICAgICAgICAnc2hhMjI0JzogMjgsCiAgICAgICAgICAgICdzaGEyNTYnOiAzMiwKICAgICAgICAgICAgJ3NoYTM4NCc6IDQ4LAogICAgICAgICAgICAnc2hhNTEyJzogNjQsCiAgICAgICAgICAgICdzaGE1MTJfMjI0JzogMjgsCiAgICAgICAgICAgICdzaGE1MTJfMjU2JzogMzIsCiAgICAgICAgfVttYWNfYWxnb10KICAgICAgICBtYWNfa2V5ID0gcGtjczEyX2tkZigKICAgICAgICAgICAgbWFjX2FsZ28sCiAgICAgICAgICAgIHBhc3N3b3JkLAogICAgICAgICAgICBtYWNfZGF0YVsnbWFjX3NhbHQnXS5uYXRpdmUsCiAgICAgICAgICAgIG1hY19kYXRhWydpdGVyYXRpb25zJ10ubmF0aXZlLAogICAgICAgICAgICBrZXlfbGVuZ3RoLAogICAgICAgICAgICAzICAjIElEIDMgaXMgZm9yIGdlbmVyYXRpbmcgYW4gSE1BQyBrZXkKICAgICAgICApCiAgICAgICAgaGFzaF9tb2QgPSBnZXRhdHRyKGhhc2hsaWIsIG1hY19hbGdvKQogICAgICAgIGNvbXB1dGVkX2htYWMgPSBobWFjLm5ldyhtYWNfa2V5LCBhdXRoX3NhZmVbJ2NvbnRlbnQnXS5jb250ZW50cywgaGFzaF9tb2QpLmRpZ2VzdCgpCiAgICAgICAgc3RvcmVkX2htYWMgPSBtYWNfZGF0YVsnbWFjJ11bJ2RpZ2VzdCddLm5hdGl2ZQogICAgICAgIGlmIG5vdCBjb25zdGFudF9jb21wYXJlKGNvbXB1dGVkX2htYWMsIHN0b3JlZF9obWFjKToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignUGFzc3dvcmQgcHJvdmlkZWQgaXMgaW52YWxpZCcpCgogICAgZm9yIGNvbnRlbnRfaW5mbyBpbiBhdXRoZW50aWNhdGVkX3NhZmU6CiAgICAgICAgY29udGVudCA9IGNvbnRlbnRfaW5mb1snY29udGVudCddCgogICAgICAgIGlmIGlzaW5zdGFuY2UoY29udGVudCwgT2N0ZXRTdHJpbmcpOgogICAgICAgICAgICBfcGFyc2Vfc2FmZV9jb250ZW50cyhjb250ZW50Lm5hdGl2ZSwgY2VydHMsIHByaXZhdGVfa2V5cywgcGFzc3dvcmQsIGxvYWRfcHJpdmF0ZV9rZXkpCgogICAgICAgIGVsaWYgaXNpbnN0YW5jZShjb250ZW50LCBFbmNyeXB0ZWREYXRhKToKICAgICAgICAgICAgZW5jcnlwdGVkX2NvbnRlbnRfaW5mbyA9IGNvbnRlbnRbJ2VuY3J5cHRlZF9jb250ZW50X2luZm8nXQoKICAgICAgICAgICAgZW5jcnlwdGlvbl9hbGdvcml0aG1faW5mbyA9IGVuY3J5cHRlZF9jb250ZW50X2luZm9bJ2NvbnRlbnRfZW5jcnlwdGlvbl9hbGdvcml0aG0nXQogICAgICAgICAgICBlbmNyeXB0ZWRfY29udGVudCA9IGVuY3J5cHRlZF9jb250ZW50X2luZm9bJ2VuY3J5cHRlZF9jb250ZW50J10ubmF0aXZlCiAgICAgICAgICAgIGRlY3J5cHRlZF9jb250ZW50ID0gX2RlY3J5cHRfZW5jcnlwdGVkX2RhdGEoZW5jcnlwdGlvbl9hbGdvcml0aG1faW5mbywgZW5jcnlwdGVkX2NvbnRlbnQsIHBhc3N3b3JkKQoKICAgICAgICAgICAgX3BhcnNlX3NhZmVfY29udGVudHMoZGVjcnlwdGVkX2NvbnRlbnQsIGNlcnRzLCBwcml2YXRlX2tleXMsIHBhc3N3b3JkLCBsb2FkX3ByaXZhdGVfa2V5KQoKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBQdWJsaWMta2V5LWJhc2VkIFBLQ1MxMiBmaWxlcyBhcmUgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQKICAgICAgICAgICAgICAgICcnJwogICAgICAgICAgICApKQoKICAgIGtleV9maW5nZXJwcmludHMgPSBzZXQocHJpdmF0ZV9rZXlzLmtleXMoKSkKICAgIGNlcnRfZmluZ2VycHJpbnRzID0gc2V0KGNlcnRzLmtleXMoKSkKCiAgICBjb21tb25fZmluZ2VycHJpbnRzID0gc29ydGVkKGxpc3Qoa2V5X2ZpbmdlcnByaW50cyAmIGNlcnRfZmluZ2VycHJpbnRzKSkKCiAgICBrZXkgPSBOb25lCiAgICBjZXJ0ID0gTm9uZQogICAgb3RoZXJfY2VydHMgPSBbXQoKICAgIGlmIGxlbihjb21tb25fZmluZ2VycHJpbnRzKSA+PSAxOgogICAgICAgIGZpbmdlcnByaW50ID0gY29tbW9uX2ZpbmdlcnByaW50c1swXQogICAgICAgIGtleSA9IHByaXZhdGVfa2V5c1tmaW5nZXJwcmludF0KICAgICAgICBjZXJ0ID0gY2VydHNbZmluZ2VycHJpbnRdCiAgICAgICAgb3RoZXJfY2VydHMgPSBbY2VydHNbZl0gZm9yIGYgaW4gY2VydHMgaWYgZiAhPSBmaW5nZXJwcmludF0KICAgICAgICByZXR1cm4gKGtleSwgY2VydCwgb3RoZXJfY2VydHMpCgogICAgaWYgbGVuKHByaXZhdGVfa2V5cykgPiAwOgogICAgICAgIGZpcnN0X2tleSA9IHNvcnRlZChsaXN0KHByaXZhdGVfa2V5cy5rZXlzKCkpKVswXQogICAgICAgIGtleSA9IHByaXZhdGVfa2V5c1tmaXJzdF9rZXldCgogICAgaWYgbGVuKGNlcnRzKSA+IDA6CiAgICAgICAgZmlyc3Rfa2V5ID0gc29ydGVkKGxpc3QoY2VydHMua2V5cygpKSlbMF0KICAgICAgICBjZXJ0ID0gY2VydHNbZmlyc3Rfa2V5XQogICAgICAgIGRlbCBjZXJ0c1tmaXJzdF9rZXldCgogICAgaWYgbGVuKGNlcnRzKSA+IDA6CiAgICAgICAgb3RoZXJfY2VydHMgPSBzb3J0ZWQobGlzdChjZXJ0cy52YWx1ZXMoKSksIGtleT1sYW1iZGEgYzogYy5zdWJqZWN0Lmh1bWFuX2ZyaWVuZGx5KQoKICAgIHJldHVybiAoa2V5LCBjZXJ0LCBvdGhlcl9jZXJ0cykKCgpkZWYgX3BhcnNlX3NhZmVfY29udGVudHMoc2FmZV9jb250ZW50cywgY2VydHMsIHByaXZhdGVfa2V5cywgcGFzc3dvcmQsIGxvYWRfcHJpdmF0ZV9rZXkpOgogICAgIiIiCiAgICBQYXJzZXMgYSBTYWZlQ29udGVudHMgUEtDUyMxMiBBTlMuMSBzdHJ1Y3R1cmUgYW5kIGV4dHJhY3RzIGNlcnRzIGFuZCBrZXlzCgogICAgOnBhcmFtIHNhZmVfY29udGVudHM6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiBiZXItZW5jb2RlZCBTYWZlQ29udGVudHMsIG9yIGEgYXNuMWNyeXB0by5wa2NzMTIuU2FmZUNvbnRlbnRzCiAgICAgICAgcGFyc2VkIG9iamVjdAoKICAgIDpwYXJhbSBjZXJ0czoKICAgICAgICBBIGRpY3QgdG8gc3RvcmUgY2VydGlmaWNhdGVzIGluCgogICAgOnBhcmFtIGtleXM6CiAgICAgICAgQSBkaWN0IHRvIHN0b3JlIGtleXMgaW4KCiAgICA6cGFyYW0gcGFzc3dvcmQ6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgcGFzc3dvcmQgdG8gYW55IGVuY3J5cHRlZCBkYXRhCgogICAgOnBhcmFtIGxvYWRfcHJpdmF0ZV9rZXk6CiAgICAgICAgQSBjYWxsYWJsZSB0aGF0IHdpbGwgYWNjZXB0IGEgYnl0ZSBzdHJpbmcgYW5kIHJldHVybiBhbgogICAgICAgIG9zY3J5cHRvLmFzeW1tZXRyaWMuUHJpdmF0ZUtleSBvYmplY3QKICAgICIiIgoKICAgIGlmIGlzaW5zdGFuY2Uoc2FmZV9jb250ZW50cywgYnl0ZV9jbHMpOgogICAgICAgIHNhZmVfY29udGVudHMgPSBTYWZlQ29udGVudHMubG9hZChzYWZlX2NvbnRlbnRzKQoKICAgIGZvciBzYWZlX2JhZyBpbiBzYWZlX2NvbnRlbnRzOgogICAgICAgIGJhZ192YWx1ZSA9IHNhZmVfYmFnWydiYWdfdmFsdWUnXQoKICAgICAgICBpZiBpc2luc3RhbmNlKGJhZ192YWx1ZSwgQ2VydEJhZyk6CiAgICAgICAgICAgIGlmIGJhZ192YWx1ZVsnY2VydF9pZCddLm5hdGl2ZSA9PSAneDUwOSc6CiAgICAgICAgICAgICAgICBjZXJ0ID0gYmFnX3ZhbHVlWydjZXJ0X3ZhbHVlJ10ucGFyc2VkCiAgICAgICAgICAgICAgICBwdWJsaWNfa2V5X2luZm8gPSBjZXJ0Wyd0YnNfY2VydGlmaWNhdGUnXVsnc3ViamVjdF9wdWJsaWNfa2V5X2luZm8nXQogICAgICAgICAgICAgICAgY2VydHNbX2ZpbmdlcnByaW50KHB1YmxpY19rZXlfaW5mbywgTm9uZSldID0gYmFnX3ZhbHVlWydjZXJ0X3ZhbHVlJ10ucGFyc2VkCgogICAgICAgIGVsaWYgaXNpbnN0YW5jZShiYWdfdmFsdWUsIFByaXZhdGVLZXlJbmZvKToKICAgICAgICAgICAgcHJpdmF0ZV9rZXlzW19maW5nZXJwcmludChiYWdfdmFsdWUsIGxvYWRfcHJpdmF0ZV9rZXkpXSA9IGJhZ192YWx1ZQoKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoYmFnX3ZhbHVlLCBFbmNyeXB0ZWRQcml2YXRlS2V5SW5mbyk6CiAgICAgICAgICAgIGVuY3J5cHRpb25fYWxnb3JpdGhtX2luZm8gPSBiYWdfdmFsdWVbJ2VuY3J5cHRpb25fYWxnb3JpdGhtJ10KICAgICAgICAgICAgZW5jcnlwdGVkX2tleV9ieXRlcyA9IGJhZ192YWx1ZVsnZW5jcnlwdGVkX2RhdGEnXS5uYXRpdmUKICAgICAgICAgICAgZGVjcnlwdGVkX2tleV9ieXRlcyA9IF9kZWNyeXB0X2VuY3J5cHRlZF9kYXRhKGVuY3J5cHRpb25fYWxnb3JpdGhtX2luZm8sIGVuY3J5cHRlZF9rZXlfYnl0ZXMsIHBhc3N3b3JkKQogICAgICAgICAgICBwcml2YXRlX2tleSA9IFByaXZhdGVLZXlJbmZvLmxvYWQoZGVjcnlwdGVkX2tleV9ieXRlcykKICAgICAgICAgICAgcHJpdmF0ZV9rZXlzW19maW5nZXJwcmludChwcml2YXRlX2tleSwgbG9hZF9wcml2YXRlX2tleSldID0gcHJpdmF0ZV9rZXkKCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGJhZ192YWx1ZSwgU2FmZUNvbnRlbnRzKToKICAgICAgICAgICAgX3BhcnNlX3NhZmVfY29udGVudHMoYmFnX3ZhbHVlLCBjZXJ0cywgcHJpdmF0ZV9rZXlzLCBwYXNzd29yZCwgbG9hZF9wcml2YXRlX2tleSkKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBXZSBkb24ndCBjYXJlIGFib3V0IENSTCBiYWdzIG9yIHNlY3JldCBiYWdzCiAgICAgICAgICAgIHBhc3MKCgpkZWYgX2RlY3J5cHRfZW5jcnlwdGVkX2RhdGEoZW5jcnlwdGlvbl9hbGdvcml0aG1faW5mbywgZW5jcnlwdGVkX2NvbnRlbnQsIHBhc3N3b3JkKToKICAgICIiIgogICAgRGVjcnlwdHMgZW5jcnlwdGVkIEFTTi4xIGRhdGEKCiAgICA6cGFyYW0gZW5jcnlwdGlvbl9hbGdvcml0aG1faW5mbzoKICAgICAgICBBbiBpbnN0YW5jZSBvZiBhc24xY3J5cHRvLnBrY3M1LlBrY3M1RW5jcnlwdGlvbkFsZ29yaXRobQoKICAgIDpwYXJhbSBlbmNyeXB0ZWRfY29udGVudDoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBlbmNyeXB0ZWQgY29udGVudAoKICAgIDpwYXJhbSBwYXNzd29yZDoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBlbmNyeXB0ZWQgY29udGVudCdzIHBhc3N3b3JkCgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBkZWNyeXB0ZWQgcGxhaW50ZXh0CiAgICAiIiIKCiAgICBkZWNyeXB0X2Z1bmMgPSBjcnlwdG9fZnVuY3NbZW5jcnlwdGlvbl9hbGdvcml0aG1faW5mby5lbmNyeXB0aW9uX2NpcGhlcl0KCiAgICAjIE1vZGVybiwgUEtDUyM1IFBCRVMyLWJhc2VkIGVuY3J5cHRpb24KICAgIGlmIGVuY3J5cHRpb25fYWxnb3JpdGhtX2luZm8ua2RmID09ICdwYmtkZjInOgoKICAgICAgICBpZiBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmVuY3J5cHRpb25fY2lwaGVyID09ICdyYzUnOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBQQkVTMiBlbmNyeXB0aW9uIHNjaGVtZSB1dGlsaXppbmcgUkM1IGVuY3J5cHRpb24gaXMgbm90IHN1cHBvcnRlZAogICAgICAgICAgICAgICAgJycnCiAgICAgICAgICAgICkpCgogICAgICAgIGVuY19rZXkgPSBwYmtkZjIoCiAgICAgICAgICAgIGVuY3J5cHRpb25fYWxnb3JpdGhtX2luZm8ua2RmX2htYWMsCiAgICAgICAgICAgIHBhc3N3b3JkLAogICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtkZl9zYWx0LAogICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtkZl9pdGVyYXRpb25zLAogICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtleV9sZW5ndGgKICAgICAgICApCiAgICAgICAgZW5jX2l2ID0gZW5jcnlwdGlvbl9hbGdvcml0aG1faW5mby5lbmNyeXB0aW9uX2l2CgogICAgICAgIHBsYWludGV4dCA9IGRlY3J5cHRfZnVuYyhlbmNfa2V5LCBlbmNyeXB0ZWRfY29udGVudCwgZW5jX2l2KQoKICAgIGVsaWYgZW5jcnlwdGlvbl9hbGdvcml0aG1faW5mby5rZGYgPT0gJ3Bia2RmMSc6CiAgICAgICAgZGVyaXZlZF9vdXRwdXQgPSBwYmtkZjEoCiAgICAgICAgICAgIGVuY3J5cHRpb25fYWxnb3JpdGhtX2luZm8ua2RmX2htYWMsCiAgICAgICAgICAgIHBhc3N3b3JkLAogICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtkZl9zYWx0LAogICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtkZl9pdGVyYXRpb25zLAogICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtleV9sZW5ndGggKyA4CiAgICAgICAgKQogICAgICAgIGVuY19rZXkgPSBkZXJpdmVkX291dHB1dFswOjhdCiAgICAgICAgZW5jX2l2ID0gZGVyaXZlZF9vdXRwdXRbODoxNl0KCiAgICAgICAgcGxhaW50ZXh0ID0gZGVjcnlwdF9mdW5jKGVuY19rZXksIGVuY3J5cHRlZF9jb250ZW50LCBlbmNfaXYpCgogICAgZWxpZiBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtkZiA9PSAncGtjczEyX2tkZic6CiAgICAgICAgZW5jX2tleSA9IHBrY3MxMl9rZGYoCiAgICAgICAgICAgIGVuY3J5cHRpb25fYWxnb3JpdGhtX2luZm8ua2RmX2htYWMsCiAgICAgICAgICAgIHBhc3N3b3JkLAogICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtkZl9zYWx0LAogICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtkZl9pdGVyYXRpb25zLAogICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtleV9sZW5ndGgsCiAgICAgICAgICAgIDEgICMgSUQgMSBpcyBmb3IgZ2VuZXJhdGluZyBhIGtleQogICAgICAgICkKCiAgICAgICAgIyBTaW5jZSBSQzQgaXMgYSBzdHJlYW0gY2lwaGVyLCB3ZSBkb24ndCB1c2UgYW4gSVYKICAgICAgICBpZiBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmVuY3J5cHRpb25fY2lwaGVyID09ICdyYzQnOgogICAgICAgICAgICBwbGFpbnRleHQgPSBkZWNyeXB0X2Z1bmMoZW5jX2tleSwgZW5jcnlwdGVkX2NvbnRlbnQpCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGVuY19pdiA9IHBrY3MxMl9rZGYoCiAgICAgICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtkZl9obWFjLAogICAgICAgICAgICAgICAgcGFzc3dvcmQsCiAgICAgICAgICAgICAgICBlbmNyeXB0aW9uX2FsZ29yaXRobV9pbmZvLmtkZl9zYWx0LAogICAgICAgICAgICAgICAgZW5jcnlwdGlvbl9hbGdvcml0aG1faW5mby5rZGZfaXRlcmF0aW9ucywKICAgICAgICAgICAgICAgIGVuY3J5cHRpb25fYWxnb3JpdGhtX2luZm8uZW5jcnlwdGlvbl9ibG9ja19zaXplLAogICAgICAgICAgICAgICAgMiAgICMgSUQgMiBpcyBmb3IgZ2VuZXJhdGluZyBhbiBJVgogICAgICAgICAgICApCiAgICAgICAgICAgIHBsYWludGV4dCA9IGRlY3J5cHRfZnVuYyhlbmNfa2V5LCBlbmNyeXB0ZWRfY29udGVudCwgZW5jX2l2KQoKICAgIHJldHVybiBwbGFpbnRleHQK
