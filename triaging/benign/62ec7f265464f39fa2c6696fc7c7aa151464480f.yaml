statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/utils.py
  contents:
  - name: select_proxy
    score: 0.0
    code: |-
      def select_proxy(url, proxies):
          """Select a proxy for the url, if applicable.

          :param url: The url being for the request
          :param proxies: A dictionary of schemes or schemes and hosts to proxy URLs
          """
          proxies = proxies or {}
          urlparts = urlparse(url)
          if urlparts.hostname is None:
              return proxies.get(urlparts.scheme, proxies.get('all'))

          proxy_keys = [
              urlparts.scheme + '://' + urlparts.hostname,
              urlparts.scheme,
              'all://' + urlparts.hostname,
              'all',
          ]
          proxy = None
          for proxy_key in proxy_keys:
              if proxy_key in proxies:
                  proxy = proxies[proxy_key]
                  break

          return proxy
    tokens: resume load_fast proxies copy pop_jump_if_true TO_NUMBER pop_top build_map store_fast proxies load_global urlparse load_fast url call store_fast urlparts load_fast urlparts load_attr hostname pop_jump_if_not_none TO_NUMBER load_fast proxies load_attr get load_fast urlparts load_attr scheme load_fast proxies load_attr get load_const all call call return_value load_fast urlparts load_attr scheme load_const STRING_FILE_PATH binary_op + load_fast urlparts load_attr hostname binary_op + load_fast urlparts load_attr scheme load_const STRING_FILE_PATH load_fast urlparts load_attr hostname binary_op + load_const all build_list store_fast proxy_keys load_const store_fast proxy load_fast proxy_keys get_iter for_iter TO_NUMBER store_fast proxy_key load_fast proxy_key load_fast proxies contains_op pop_jump_if_true TO_NUMBER jump_backward TO_NUMBER load_fast proxies load_fast proxy_key binary_subscr store_fast proxy pop_top load_fast proxy return_value end_for load_fast proxy return_value
    hash: 1302b90afb2e5aede200d457212578612eed33efdd97d9cba4bb71a2eeb64fa4
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/utils.py
  : IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KCiIiIgpyZXF1ZXN0cy51dGlscwp+fn5+fn5+fn5+fn5+fgoKVGhpcyBtb2R1bGUgcHJvdmlkZXMgdXRpbGl0eSBmdW5jdGlvbnMgdGhhdCBhcmUgdXNlZCB3aXRoaW4gUmVxdWVzdHMKdGhhdCBhcmUgYWxzbyB1c2VmdWwgZm9yIGV4dGVybmFsIGNvbnN1bXB0aW9uLgoiIiIKCmltcG9ydCBjZ2kKaW1wb3J0IGNvZGVjcwppbXBvcnQgY29udGV4dGxpYgppbXBvcnQgaW8KaW1wb3J0IG9zCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgcmUKaW1wb3J0IHNvY2tldAppbXBvcnQgc3RydWN0CmltcG9ydCB3YXJuaW5ncwoKZnJvbSAuX192ZXJzaW9uX18gaW1wb3J0IF9fdmVyc2lvbl9fCmZyb20gLiBpbXBvcnQgY2VydHMKIyB0b19uYXRpdmVfc3RyaW5nIGlzIHVudXNlZCBoZXJlLCBidXQgaW1wb3J0ZWQgaGVyZSBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKZnJvbSAuX2ludGVybmFsX3V0aWxzIGltcG9ydCB0b19uYXRpdmVfc3RyaW5nCmZyb20gLmNvbXBhdCBpbXBvcnQgcGFyc2VfaHR0cF9saXN0IGFzIF9wYXJzZV9saXN0X2hlYWRlcgpmcm9tIC5jb21wYXQgaW1wb3J0ICgKICAgIHF1b3RlLCB1cmxwYXJzZSwgYnl0ZXMsIHN0ciwgT3JkZXJlZERpY3QsIHVucXVvdGUsIGdldHByb3hpZXMsCiAgICBwcm94eV9ieXBhc3MsIHVybHVucGFyc2UsIGJhc2VzdHJpbmcsIGludGVnZXJfdHlwZXMsIGlzX3B5MywKICAgIHByb3h5X2J5cGFzc19lbnZpcm9ubWVudCwgZ2V0cHJveGllc19lbnZpcm9ubWVudCwgTWFwcGluZykKZnJvbSAuY29va2llcyBpbXBvcnQgY29va2llamFyX2Zyb21fZGljdApmcm9tIC5zdHJ1Y3R1cmVzIGltcG9ydCBDYXNlSW5zZW5zaXRpdmVEaWN0CmZyb20gLmV4Y2VwdGlvbnMgaW1wb3J0ICgKICAgIEludmFsaWRVUkwsIEludmFsaWRIZWFkZXIsIEZpbGVNb2RlV2FybmluZywgVW5yZXdpbmRhYmxlQm9keUVycm9yKQoKTkVUUkNfRklMRVMgPSAoJy5uZXRyYycsICdfbmV0cmMnKQoKREVGQVVMVF9DQV9CVU5ETEVfUEFUSCA9IGNlcnRzLndoZXJlKCkKCgppZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6CiAgICAjIHByb3ZpZGUgYSBwcm94eV9ieXBhc3MgdmVyc2lvbiBvbiBXaW5kb3dzIHdpdGhvdXQgRE5TIGxvb2t1cHMKCiAgICBkZWYgcHJveHlfYnlwYXNzX3JlZ2lzdHJ5KGhvc3QpOgogICAgICAgIGlmIGlzX3B5MzoKICAgICAgICAgICAgaW1wb3J0IHdpbnJlZwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGltcG9ydCBfd2lucmVnIGFzIHdpbnJlZwogICAgICAgIHRyeToKICAgICAgICAgICAgaW50ZXJuZXRTZXR0aW5ncyA9IHdpbnJlZy5PcGVuS2V5KHdpbnJlZy5IS0VZX0NVUlJFTlRfVVNFUiwKICAgICAgICAgICAgICAgIHInU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cSW50ZXJuZXQgU2V0dGluZ3MnKQogICAgICAgICAgICBwcm94eUVuYWJsZSA9IHdpbnJlZy5RdWVyeVZhbHVlRXgoaW50ZXJuZXRTZXR0aW5ncywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdQcm94eUVuYWJsZScpWzBdCiAgICAgICAgICAgIHByb3h5T3ZlcnJpZGUgPSB3aW5yZWcuUXVlcnlWYWx1ZUV4KGludGVybmV0U2V0dGluZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdQcm94eU92ZXJyaWRlJylbMF0KICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgaWYgbm90IHByb3h5RW5hYmxlIG9yIG5vdCBwcm94eU92ZXJyaWRlOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgIyBtYWtlIGEgY2hlY2sgdmFsdWUgbGlzdCBmcm9tIHRoZSByZWdpc3RyeSBlbnRyeTogcmVwbGFjZSB0aGUKICAgICAgICAjICc8bG9jYWw+JyBzdHJpbmcgYnkgdGhlIGxvY2FsaG9zdCBlbnRyeSBhbmQgdGhlIGNvcnJlc3BvbmRpbmcKICAgICAgICAjIGNhbm9uaWNhbCBlbnRyeS4KICAgICAgICBwcm94eU92ZXJyaWRlID0gcHJveHlPdmVycmlkZS5zcGxpdCgnOycpCiAgICAgICAgIyBub3cgY2hlY2sgaWYgd2UgbWF0Y2ggb25lIG9mIHRoZSByZWdpc3RyeSB2YWx1ZXMuCiAgICAgICAgZm9yIHRlc3QgaW4gcHJveHlPdmVycmlkZToKICAgICAgICAgICAgaWYgdGVzdCA9PSAnPGxvY2FsPic6CiAgICAgICAgICAgICAgICBpZiAnLicgbm90IGluIGhvc3Q6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgdGVzdCA9IHRlc3QucmVwbGFjZSgiLiIsIHIiXC4iKSAgICAgIyBtYXNrIGRvdHMKICAgICAgICAgICAgdGVzdCA9IHRlc3QucmVwbGFjZSgiKiIsIHIiLioiKSAgICAgIyBjaGFuZ2UgZ2xvYiBzZXF1ZW5jZQogICAgICAgICAgICB0ZXN0ID0gdGVzdC5yZXBsYWNlKCI/IiwgciIuIikgICAgICAjIGNoYW5nZSBnbG9iIGNoYXIKICAgICAgICAgICAgaWYgcmUubWF0Y2godGVzdCwgaG9zdCwgcmUuSSk6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBwcm94eV9ieXBhc3MoaG9zdCk6ICAjIG5vcWEKICAgICAgICAiIiJSZXR1cm4gVHJ1ZSwgaWYgdGhlIGhvc3Qgc2hvdWxkIGJlIGJ5cGFzc2VkLgoKICAgICAgICBDaGVja3MgcHJveHkgc2V0dGluZ3MgZ2F0aGVyZWQgZnJvbSB0aGUgZW52aXJvbm1lbnQsIGlmIHNwZWNpZmllZCwKICAgICAgICBvciB0aGUgcmVnaXN0cnkuCiAgICAgICAgIiIiCiAgICAgICAgaWYgZ2V0cHJveGllc19lbnZpcm9ubWVudCgpOgogICAgICAgICAgICByZXR1cm4gcHJveHlfYnlwYXNzX2Vudmlyb25tZW50KGhvc3QpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHByb3h5X2J5cGFzc19yZWdpc3RyeShob3N0KQoKCmRlZiBkaWN0X3RvX3NlcXVlbmNlKGQpOgogICAgIiIiUmV0dXJucyBhbiBpbnRlcm5hbCBzZXF1ZW5jZSBkaWN0aW9uYXJ5IHVwZGF0ZS4iIiIKCiAgICBpZiBoYXNhdHRyKGQsICdpdGVtcycpOgogICAgICAgIGQgPSBkLml0ZW1zKCkKCiAgICByZXR1cm4gZAoKCmRlZiBzdXBlcl9sZW4obyk6CiAgICB0b3RhbF9sZW5ndGggPSBOb25lCiAgICBjdXJyZW50X3Bvc2l0aW9uID0gMAoKICAgIGlmIGhhc2F0dHIobywgJ19fbGVuX18nKToKICAgICAgICB0b3RhbF9sZW5ndGggPSBsZW4obykKCiAgICBlbGlmIGhhc2F0dHIobywgJ2xlbicpOgogICAgICAgIHRvdGFsX2xlbmd0aCA9IG8ubGVuCgogICAgZWxpZiBoYXNhdHRyKG8sICdmaWxlbm8nKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZpbGVubyA9IG8uZmlsZW5vKCkKICAgICAgICBleGNlcHQgaW8uVW5zdXBwb3J0ZWRPcGVyYXRpb246CiAgICAgICAgICAgIHBhc3MKICAgICAgICBlbHNlOgogICAgICAgICAgICB0b3RhbF9sZW5ndGggPSBvcy5mc3RhdChmaWxlbm8pLnN0X3NpemUKCiAgICAgICAgICAgICMgSGF2aW5nIHVzZWQgZnN0YXQgdG8gZGV0ZXJtaW5lIHRoZSBmaWxlIGxlbmd0aCwgd2UgbmVlZCB0bwogICAgICAgICAgICAjIGNvbmZpcm0gdGhhdCB0aGlzIGZpbGUgd2FzIG9wZW5lZCB1cCBpbiBiaW5hcnkgbW9kZS4KICAgICAgICAgICAgaWYgJ2InIG5vdCBpbiBvLm1vZGU6CiAgICAgICAgICAgICAgICB3YXJuaW5ncy53YXJuKCgKICAgICAgICAgICAgICAgICAgICAiUmVxdWVzdHMgaGFzIGRldGVybWluZWQgdGhlIGNvbnRlbnQtbGVuZ3RoIGZvciB0aGlzICIKICAgICAgICAgICAgICAgICAgICAicmVxdWVzdCB1c2luZyB0aGUgYmluYXJ5IHNpemUgb2YgdGhlIGZpbGU6IGhvd2V2ZXIsIHRoZSAiCiAgICAgICAgICAgICAgICAgICAgImZpbGUgaGFzIGJlZW4gb3BlbmVkIGluIHRleHQgbW9kZSAoaS5lLiB3aXRob3V0IHRoZSAnYicgIgogICAgICAgICAgICAgICAgICAgICJmbGFnIGluIHRoZSBtb2RlKS4gVGhpcyBtYXkgbGVhZCB0byBhbiBpbmNvcnJlY3QgIgogICAgICAgICAgICAgICAgICAgICJjb250ZW50LWxlbmd0aC4gSW4gUmVxdWVzdHMgMy4wLCBzdXBwb3J0IHdpbGwgYmUgcmVtb3ZlZCAiCiAgICAgICAgICAgICAgICAgICAgImZvciBmaWxlcyBpbiB0ZXh0IG1vZGUuIiksCiAgICAgICAgICAgICAgICAgICAgRmlsZU1vZGVXYXJuaW5nCiAgICAgICAgICAgICAgICApCgogICAgaWYgaGFzYXR0cihvLCAndGVsbCcpOgogICAgICAgIHRyeToKICAgICAgICAgICAgY3VycmVudF9wb3NpdGlvbiA9IG8udGVsbCgpCiAgICAgICAgZXhjZXB0IChPU0Vycm9yLCBJT0Vycm9yKToKICAgICAgICAgICAgIyBUaGlzIGNhbiBoYXBwZW4gaW4gc29tZSB3ZWlyZCBzaXR1YXRpb25zLCBzdWNoIGFzIHdoZW4gdGhlIGZpbGUKICAgICAgICAgICAgIyBpcyBhY3R1YWxseSBhIHNwZWNpYWwgZmlsZSBkZXNjcmlwdG9yIGxpa2Ugc3RkaW4uIEluIHRoaXMKICAgICAgICAgICAgIyBpbnN0YW5jZSwgd2UgZG9uJ3Qga25vdyB3aGF0IHRoZSBsZW5ndGggaXMsIHNvIHNldCBpdCB0byB6ZXJvIGFuZAogICAgICAgICAgICAjIGxldCByZXF1ZXN0cyBjaHVuayBpdCBpbnN0ZWFkLgogICAgICAgICAgICBpZiB0b3RhbF9sZW5ndGggaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBjdXJyZW50X3Bvc2l0aW9uID0gdG90YWxfbGVuZ3RoCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgaGFzYXR0cihvLCAnc2VlaycpIGFuZCB0b3RhbF9sZW5ndGggaXMgTm9uZToKICAgICAgICAgICAgICAgICMgU3RyaW5nSU8gYW5kIEJ5dGVzSU8gaGF2ZSBzZWVrIGJ1dCBubyB1c2VhYmxlIGZpbGVubwogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICMgc2VlayB0byBlbmQgb2YgZmlsZQogICAgICAgICAgICAgICAgICAgIG8uc2VlaygwLCAyKQogICAgICAgICAgICAgICAgICAgIHRvdGFsX2xlbmd0aCA9IG8udGVsbCgpCgogICAgICAgICAgICAgICAgICAgICMgc2VlayBiYWNrIHRvIGN1cnJlbnQgcG9zaXRpb24gdG8gc3VwcG9ydAogICAgICAgICAgICAgICAgICAgICMgcGFydGlhbGx5IHJlYWQgZmlsZS1saWtlIG9iamVjdHMKICAgICAgICAgICAgICAgICAgICBvLnNlZWsoY3VycmVudF9wb3NpdGlvbiBvciAwKQogICAgICAgICAgICAgICAgZXhjZXB0IChPU0Vycm9yLCBJT0Vycm9yKToKICAgICAgICAgICAgICAgICAgICB0b3RhbF9sZW5ndGggPSAwCgogICAgaWYgdG90YWxfbGVuZ3RoIGlzIE5vbmU6CiAgICAgICAgdG90YWxfbGVuZ3RoID0gMAoKICAgIHJldHVybiBtYXgoMCwgdG90YWxfbGVuZ3RoIC0gY3VycmVudF9wb3NpdGlvbikKCgpkZWYgZ2V0X25ldHJjX2F1dGgodXJsLCByYWlzZV9lcnJvcnM9RmFsc2UpOgogICAgIiIiUmV0dXJucyB0aGUgUmVxdWVzdHMgdHVwbGUgYXV0aCBmb3IgYSBnaXZlbiB1cmwgZnJvbSBuZXRyYy4iIiIKCiAgICB0cnk6CiAgICAgICAgZnJvbSBuZXRyYyBpbXBvcnQgbmV0cmMsIE5ldHJjUGFyc2VFcnJvcgoKICAgICAgICBuZXRyY19wYXRoID0gTm9uZQoKICAgICAgICBmb3IgZiBpbiBORVRSQ19GSUxFUzoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbG9jID0gb3MucGF0aC5leHBhbmR1c2VyKCd+L3swfScuZm9ybWF0KGYpKQogICAgICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgICAgICAjIG9zLnBhdGguZXhwYW5kdXNlciBjYW4gZmFpbCB3aGVuICRIT01FIGlzIHVuZGVmaW5lZCBhbmQKICAgICAgICAgICAgICAgICMgZ2V0cHd1aWQgZmFpbHMuIFNlZSBodHRwOi8vYnVncy5weXRob24ub3JnL2lzc3VlMjAxNjQgJgogICAgICAgICAgICAgICAgIyBodHRwczovL2dpdGh1Yi5jb20vcmVxdWVzdHMvcmVxdWVzdHMvaXNzdWVzLzE4NDYKICAgICAgICAgICAgICAgIHJldHVybgoKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMobG9jKToKICAgICAgICAgICAgICAgIG5ldHJjX3BhdGggPSBsb2MKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICMgQWJvcnQgZWFybHkgaWYgdGhlcmUgaXNuJ3Qgb25lLgogICAgICAgIGlmIG5ldHJjX3BhdGggaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHJpID0gdXJscGFyc2UodXJsKQoKICAgICAgICAjIFN0cmlwIHBvcnQgbnVtYmVycyBmcm9tIG5ldGxvYy4gVGhpcyB3ZWlyZCBgaWYuLi5lbmNvZGVgYCBkYW5jZSBpcwogICAgICAgICMgdXNlZCBmb3IgUHl0aG9uIDMuMiwgd2hpY2ggZG9lc24ndCBzdXBwb3J0IHVuaWNvZGUgbGl0ZXJhbHMuCiAgICAgICAgc3BsaXRzdHIgPSBiJzonCiAgICAgICAgaWYgaXNpbnN0YW5jZSh1cmwsIHN0cik6CiAgICAgICAgICAgIHNwbGl0c3RyID0gc3BsaXRzdHIuZGVjb2RlKCdhc2NpaScpCiAgICAgICAgaG9zdCA9IHJpLm5ldGxvYy5zcGxpdChzcGxpdHN0cilbMF0KCiAgICAgICAgdHJ5OgogICAgICAgICAgICBfbmV0cmMgPSBuZXRyYyhuZXRyY19wYXRoKS5hdXRoZW50aWNhdG9ycyhob3N0KQogICAgICAgICAgICBpZiBfbmV0cmM6CiAgICAgICAgICAgICAgICAjIFJldHVybiB3aXRoIGxvZ2luIC8gcGFzc3dvcmQKICAgICAgICAgICAgICAgIGxvZ2luX2kgPSAoMCBpZiBfbmV0cmNbMF0gZWxzZSAxKQogICAgICAgICAgICAgICAgcmV0dXJuIChfbmV0cmNbbG9naW5faV0sIF9uZXRyY1syXSkKICAgICAgICBleGNlcHQgKE5ldHJjUGFyc2VFcnJvciwgSU9FcnJvcik6CiAgICAgICAgICAgICMgSWYgdGhlcmUgd2FzIGEgcGFyc2luZyBlcnJvciBvciBhIHBlcm1pc3Npb25zIGlzc3VlIHJlYWRpbmcgdGhlIGZpbGUsCiAgICAgICAgICAgICMgd2UnbGwganVzdCBza2lwIG5ldHJjIGF1dGggdW5sZXNzIGV4cGxpY2l0bHkgYXNrZWQgdG8gcmFpc2UgZXJyb3JzLgogICAgICAgICAgICBpZiByYWlzZV9lcnJvcnM6CiAgICAgICAgICAgICAgICByYWlzZQoKICAgICMgQXBwRW5naW5lIGhhY2tpbmVzcy4KICAgIGV4Y2VwdCAoSW1wb3J0RXJyb3IsIEF0dHJpYnV0ZUVycm9yKToKICAgICAgICBwYXNzCgoKZGVmIGd1ZXNzX2ZpbGVuYW1lKG9iaik6CiAgICAiIiJUcmllcyB0byBndWVzcyB0aGUgZmlsZW5hbWUgb2YgdGhlIGdpdmVuIG9iamVjdC4iIiIKICAgIG5hbWUgPSBnZXRhdHRyKG9iaiwgJ25hbWUnLCBOb25lKQogICAgaWYgKG5hbWUgYW5kIGlzaW5zdGFuY2UobmFtZSwgYmFzZXN0cmluZykgYW5kIG5hbWVbMF0gIT0gJzwnIGFuZAogICAgICAgICAgICBuYW1lWy0xXSAhPSAnPicpOgogICAgICAgIHJldHVybiBvcy5wYXRoLmJhc2VuYW1lKG5hbWUpCgoKZGVmIGZyb21fa2V5X3ZhbF9saXN0KHZhbHVlKToKICAgICIiIlRha2UgYW4gb2JqZWN0IGFuZCB0ZXN0IHRvIHNlZSBpZiBpdCBjYW4gYmUgcmVwcmVzZW50ZWQgYXMgYQogICAgZGljdGlvbmFyeS4gVW5sZXNzIGl0IGNhbiBub3QgYmUgcmVwcmVzZW50ZWQgYXMgc3VjaCwgcmV0dXJuIGFuCiAgICBPcmRlcmVkRGljdCwgZS5nLiwKCiAgICA6OgoKICAgICAgICA+Pj4gZnJvbV9rZXlfdmFsX2xpc3QoWygna2V5JywgJ3ZhbCcpXSkKICAgICAgICBPcmRlcmVkRGljdChbKCdrZXknLCAndmFsJyldKQogICAgICAgID4+PiBmcm9tX2tleV92YWxfbGlzdCgnc3RyaW5nJykKICAgICAgICBWYWx1ZUVycm9yOiBuZWVkIG1vcmUgdGhhbiAxIHZhbHVlIHRvIHVucGFjawogICAgICAgID4+PiBmcm9tX2tleV92YWxfbGlzdCh7J2tleSc6ICd2YWwnfSkKICAgICAgICBPcmRlcmVkRGljdChbKCdrZXknLCAndmFsJyldKQoKICAgIDpydHlwZTogT3JkZXJlZERpY3QKICAgICIiIgogICAgaWYgdmFsdWUgaXMgTm9uZToKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIChzdHIsIGJ5dGVzLCBib29sLCBpbnQpKToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdjYW5ub3QgZW5jb2RlIG9iamVjdHMgdGhhdCBhcmUgbm90IDItdHVwbGVzJykKCiAgICByZXR1cm4gT3JkZXJlZERpY3QodmFsdWUpCgoKZGVmIHRvX2tleV92YWxfbGlzdCh2YWx1ZSk6CiAgICAiIiJUYWtlIGFuIG9iamVjdCBhbmQgdGVzdCB0byBzZWUgaWYgaXQgY2FuIGJlIHJlcHJlc2VudGVkIGFzIGEKICAgIGRpY3Rpb25hcnkuIElmIGl0IGNhbiBiZSwgcmV0dXJuIGEgbGlzdCBvZiB0dXBsZXMsIGUuZy4sCgogICAgOjoKCiAgICAgICAgPj4+IHRvX2tleV92YWxfbGlzdChbKCdrZXknLCAndmFsJyldKQogICAgICAgIFsoJ2tleScsICd2YWwnKV0KICAgICAgICA+Pj4gdG9fa2V5X3ZhbF9saXN0KHsna2V5JzogJ3ZhbCd9KQogICAgICAgIFsoJ2tleScsICd2YWwnKV0KICAgICAgICA+Pj4gdG9fa2V5X3ZhbF9saXN0KCdzdHJpbmcnKQogICAgICAgIFZhbHVlRXJyb3I6IGNhbm5vdCBlbmNvZGUgb2JqZWN0cyB0aGF0IGFyZSBub3QgMi10dXBsZXMuCgogICAgOnJ0eXBlOiBsaXN0CiAgICAiIiIKICAgIGlmIHZhbHVlIGlzIE5vbmU6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCAoc3RyLCBieXRlcywgYm9vbCwgaW50KSk6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignY2Fubm90IGVuY29kZSBvYmplY3RzIHRoYXQgYXJlIG5vdCAyLXR1cGxlcycpCgogICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgTWFwcGluZyk6CiAgICAgICAgdmFsdWUgPSB2YWx1ZS5pdGVtcygpCgogICAgcmV0dXJuIGxpc3QodmFsdWUpCgoKIyBGcm9tIG1pdHN1aGlrby93ZXJremV1ZyAodXNlZCB3aXRoIHBlcm1pc3Npb24pLgpkZWYgcGFyc2VfbGlzdF9oZWFkZXIodmFsdWUpOgogICAgIiIiUGFyc2UgbGlzdHMgYXMgZGVzY3JpYmVkIGJ5IFJGQyAyMDY4IFNlY3Rpb24gMi4KCiAgICBJbiBwYXJ0aWN1bGFyLCBwYXJzZSBjb21tYS1zZXBhcmF0ZWQgbGlzdHMgd2hlcmUgdGhlIGVsZW1lbnRzIG9mCiAgICB0aGUgbGlzdCBtYXkgaW5jbHVkZSBxdW90ZWQtc3RyaW5ncy4gIEEgcXVvdGVkLXN0cmluZyBjb3VsZAogICAgY29udGFpbiBhIGNvbW1hLiAgQSBub24tcXVvdGVkIHN0cmluZyBjb3VsZCBoYXZlIHF1b3RlcyBpbiB0aGUKICAgIG1pZGRsZS4gIFF1b3RlcyBhcmUgcmVtb3ZlZCBhdXRvbWF0aWNhbGx5IGFmdGVyIHBhcnNpbmcuCgogICAgSXQgYmFzaWNhbGx5IHdvcmtzIGxpa2UgOmZ1bmM6YHBhcnNlX3NldF9oZWFkZXJgIGp1c3QgdGhhdCBpdGVtcwogICAgbWF5IGFwcGVhciBtdWx0aXBsZSB0aW1lcyBhbmQgY2FzZSBzZW5zaXRpdml0eSBpcyBwcmVzZXJ2ZWQuCgogICAgVGhlIHJldHVybiB2YWx1ZSBpcyBhIHN0YW5kYXJkIDpjbGFzczpgbGlzdGA6CgogICAgPj4+IHBhcnNlX2xpc3RfaGVhZGVyKCd0b2tlbiwgInF1b3RlZCB2YWx1ZSInKQogICAgWyd0b2tlbicsICdxdW90ZWQgdmFsdWUnXQoKICAgIFRvIGNyZWF0ZSBhIGhlYWRlciBmcm9tIHRoZSA6Y2xhc3M6YGxpc3RgIGFnYWluLCB1c2UgdGhlCiAgICA6ZnVuYzpgZHVtcF9oZWFkZXJgIGZ1bmN0aW9uLgoKICAgIDpwYXJhbSB2YWx1ZTogYSBzdHJpbmcgd2l0aCBhIGxpc3QgaGVhZGVyLgogICAgOnJldHVybjogOmNsYXNzOmBsaXN0YAogICAgOnJ0eXBlOiBsaXN0CiAgICAiIiIKICAgIHJlc3VsdCA9IFtdCiAgICBmb3IgaXRlbSBpbiBfcGFyc2VfbGlzdF9oZWFkZXIodmFsdWUpOgogICAgICAgIGlmIGl0ZW1bOjFdID09IGl0ZW1bLTE6XSA9PSAnIic6CiAgICAgICAgICAgIGl0ZW0gPSB1bnF1b3RlX2hlYWRlcl92YWx1ZShpdGVtWzE6LTFdKQogICAgICAgIHJlc3VsdC5hcHBlbmQoaXRlbSkKICAgIHJldHVybiByZXN1bHQKCgojIEZyb20gbWl0c3VoaWtvL3dlcmt6ZXVnICh1c2VkIHdpdGggcGVybWlzc2lvbikuCmRlZiBwYXJzZV9kaWN0X2hlYWRlcih2YWx1ZSk6CiAgICAiIiJQYXJzZSBsaXN0cyBvZiBrZXksIHZhbHVlIHBhaXJzIGFzIGRlc2NyaWJlZCBieSBSRkMgMjA2OCBTZWN0aW9uIDIgYW5kCiAgICBjb252ZXJ0IHRoZW0gaW50byBhIHB5dGhvbiBkaWN0OgoKICAgID4+PiBkID0gcGFyc2VfZGljdF9oZWFkZXIoJ2Zvbz0iaXMgYSBmaXNoIiwgYmFyPSJhcyB3ZWxsIicpCiAgICA+Pj4gdHlwZShkKSBpcyBkaWN0CiAgICBUcnVlCiAgICA+Pj4gc29ydGVkKGQuaXRlbXMoKSkKICAgIFsoJ2JhcicsICdhcyB3ZWxsJyksICgnZm9vJywgJ2lzIGEgZmlzaCcpXQoKICAgIElmIHRoZXJlIGlzIG5vIHZhbHVlIGZvciBhIGtleSBpdCB3aWxsIGJlIGBOb25lYDoKCiAgICA+Pj4gcGFyc2VfZGljdF9oZWFkZXIoJ2tleV93aXRob3V0X3ZhbHVlJykKICAgIHsna2V5X3dpdGhvdXRfdmFsdWUnOiBOb25lfQoKICAgIFRvIGNyZWF0ZSBhIGhlYWRlciBmcm9tIHRoZSA6Y2xhc3M6YGRpY3RgIGFnYWluLCB1c2UgdGhlCiAgICA6ZnVuYzpgZHVtcF9oZWFkZXJgIGZ1bmN0aW9uLgoKICAgIDpwYXJhbSB2YWx1ZTogYSBzdHJpbmcgd2l0aCBhIGRpY3QgaGVhZGVyLgogICAgOnJldHVybjogOmNsYXNzOmBkaWN0YAogICAgOnJ0eXBlOiBkaWN0CiAgICAiIiIKICAgIHJlc3VsdCA9IHt9CiAgICBmb3IgaXRlbSBpbiBfcGFyc2VfbGlzdF9oZWFkZXIodmFsdWUpOgogICAgICAgIGlmICc9JyBub3QgaW4gaXRlbToKICAgICAgICAgICAgcmVzdWx0W2l0ZW1dID0gTm9uZQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIG5hbWUsIHZhbHVlID0gaXRlbS5zcGxpdCgnPScsIDEpCiAgICAgICAgaWYgdmFsdWVbOjFdID09IHZhbHVlWy0xOl0gPT0gJyInOgogICAgICAgICAgICB2YWx1ZSA9IHVucXVvdGVfaGVhZGVyX3ZhbHVlKHZhbHVlWzE6LTFdKQogICAgICAgIHJlc3VsdFtuYW1lXSA9IHZhbHVlCiAgICByZXR1cm4gcmVzdWx0CgoKIyBGcm9tIG1pdHN1aGlrby93ZXJremV1ZyAodXNlZCB3aXRoIHBlcm1pc3Npb24pLgpkZWYgdW5xdW90ZV9oZWFkZXJfdmFsdWUodmFsdWUsIGlzX2ZpbGVuYW1lPUZhbHNlKToKICAgIHIiIiJVbnF1b3RlcyBhIGhlYWRlciB2YWx1ZS4gIChSZXZlcnNhbCBvZiA6ZnVuYzpgcXVvdGVfaGVhZGVyX3ZhbHVlYCkuCiAgICBUaGlzIGRvZXMgbm90IHVzZSB0aGUgcmVhbCB1bnF1b3RpbmcgYnV0IHdoYXQgYnJvd3NlcnMgYXJlIGFjdHVhbGx5CiAgICB1c2luZyBmb3IgcXVvdGluZy4KCiAgICA6cGFyYW0gdmFsdWU6IHRoZSBoZWFkZXIgdmFsdWUgdG8gdW5xdW90ZS4KICAgIDpydHlwZTogc3RyCiAgICAiIiIKICAgIGlmIHZhbHVlIGFuZCB2YWx1ZVswXSA9PSB2YWx1ZVstMV0gPT0gJyInOgogICAgICAgICMgdGhpcyBpcyBub3QgdGhlIHJlYWwgdW5xdW90aW5nLCBidXQgZml4aW5nIHRoaXMgc28gdGhhdCB0aGUKICAgICAgICAjIFJGQyBpcyBtZXQgd2lsbCByZXN1bHQgaW4gYnVncyB3aXRoIGludGVybmV0IGV4cGxvcmVyIGFuZAogICAgICAgICMgcHJvYmFibHkgc29tZSBvdGhlciBicm93c2VycyBhcyB3ZWxsLiAgSUUgZm9yIGV4YW1wbGUgaXMKICAgICAgICAjIHVwbG9hZGluZyBmaWxlcyB3aXRoICJDOlxmb29cYmFyLnR4dCIgYXMgZmlsZW5hbWUKICAgICAgICB2YWx1ZSA9IHZhbHVlWzE6LTFdCgogICAgICAgICMgaWYgdGhpcyBpcyBhIGZpbGVuYW1lIGFuZCB0aGUgc3RhcnRpbmcgY2hhcmFjdGVycyBsb29rIGxpa2UKICAgICAgICAjIGEgVU5DIHBhdGgsIHRoZW4ganVzdCByZXR1cm4gdGhlIHZhbHVlIHdpdGhvdXQgcXVvdGVzLiAgVXNpbmcgdGhlCiAgICAgICAgIyByZXBsYWNlIHNlcXVlbmNlIGJlbG93IG9uIGEgVU5DIHBhdGggaGFzIHRoZSBlZmZlY3Qgb2YgdHVybmluZwogICAgICAgICMgdGhlIGxlYWRpbmcgZG91YmxlIHNsYXNoIGludG8gYSBzaW5nbGUgc2xhc2ggYW5kIHRoZW4KICAgICAgICAjIF9maXhfaWVfZmlsZW5hbWUoKSBkb2Vzbid0IHdvcmsgY29ycmVjdGx5LiAgU2VlICM0NTguCiAgICAgICAgaWYgbm90IGlzX2ZpbGVuYW1lIG9yIHZhbHVlWzoyXSAhPSAnXFxcXCc6CiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKCdcXFxcJywgJ1xcJykucmVwbGFjZSgnXFwiJywgJyInKQogICAgcmV0dXJuIHZhbHVlCgoKZGVmIGRpY3RfZnJvbV9jb29raWVqYXIoY2opOgogICAgIiIiUmV0dXJucyBhIGtleS92YWx1ZSBkaWN0aW9uYXJ5IGZyb20gYSBDb29raWVKYXIuCgogICAgOnBhcmFtIGNqOiBDb29raWVKYXIgb2JqZWN0IHRvIGV4dHJhY3QgY29va2llcyBmcm9tLgogICAgOnJ0eXBlOiBkaWN0CiAgICAiIiIKCiAgICBjb29raWVfZGljdCA9IHt9CgogICAgZm9yIGNvb2tpZSBpbiBjajoKICAgICAgICBjb29raWVfZGljdFtjb29raWUubmFtZV0gPSBjb29raWUudmFsdWUKCiAgICByZXR1cm4gY29va2llX2RpY3QKCgpkZWYgYWRkX2RpY3RfdG9fY29va2llamFyKGNqLCBjb29raWVfZGljdCk6CiAgICAiIiJSZXR1cm5zIGEgQ29va2llSmFyIGZyb20gYSBrZXkvdmFsdWUgZGljdGlvbmFyeS4KCiAgICA6cGFyYW0gY2o6IENvb2tpZUphciB0byBpbnNlcnQgY29va2llcyBpbnRvLgogICAgOnBhcmFtIGNvb2tpZV9kaWN0OiBEaWN0IG9mIGtleS92YWx1ZXMgdG8gaW5zZXJ0IGludG8gQ29va2llSmFyLgogICAgOnJ0eXBlOiBDb29raWVKYXIKICAgICIiIgoKICAgIHJldHVybiBjb29raWVqYXJfZnJvbV9kaWN0KGNvb2tpZV9kaWN0LCBjaikKCgpkZWYgZ2V0X2VuY29kaW5nc19mcm9tX2NvbnRlbnQoY29udGVudCk6CiAgICAiIiJSZXR1cm5zIGVuY29kaW5ncyBmcm9tIGdpdmVuIGNvbnRlbnQgc3RyaW5nLgoKICAgIDpwYXJhbSBjb250ZW50OiBieXRlc3RyaW5nIHRvIGV4dHJhY3QgZW5jb2RpbmdzIGZyb20uCiAgICAiIiIKICAgIHdhcm5pbmdzLndhcm4oKAogICAgICAgICdJbiByZXF1ZXN0cyAzLjAsIGdldF9lbmNvZGluZ3NfZnJvbV9jb250ZW50IHdpbGwgYmUgcmVtb3ZlZC4gRm9yICcKICAgICAgICAnbW9yZSBpbmZvcm1hdGlvbiwgcGxlYXNlIHNlZSB0aGUgZGlzY3Vzc2lvbiBvbiBpc3N1ZSAjMjI2Ni4gKFRoaXMnCiAgICAgICAgJyB3YXJuaW5nIHNob3VsZCBvbmx5IGFwcGVhciBvbmNlLiknKSwKICAgICAgICBEZXByZWNhdGlvbldhcm5pbmcpCgogICAgY2hhcnNldF9yZSA9IHJlLmNvbXBpbGUocic8bWV0YS4qP2NoYXJzZXQ9WyJcJ10qKC4rPylbIlwnPl0nLCBmbGFncz1yZS5JKQogICAgcHJhZ21hX3JlID0gcmUuY29tcGlsZShyJzxtZXRhLio/Y29udGVudD1bIlwnXSo7P2NoYXJzZXQ9KC4rPylbIlwnPl0nLCBmbGFncz1yZS5JKQogICAgeG1sX3JlID0gcmUuY29tcGlsZShyJ148XD94bWwuKj9lbmNvZGluZz1bIlwnXSooLis/KVsiXCc+XScpCgogICAgcmV0dXJuIChjaGFyc2V0X3JlLmZpbmRhbGwoY29udGVudCkgKwogICAgICAgICAgICBwcmFnbWFfcmUuZmluZGFsbChjb250ZW50KSArCiAgICAgICAgICAgIHhtbF9yZS5maW5kYWxsKGNvbnRlbnQpKQoKCmRlZiBnZXRfZW5jb2RpbmdfZnJvbV9oZWFkZXJzKGhlYWRlcnMpOgogICAgIiIiUmV0dXJucyBlbmNvZGluZ3MgZnJvbSBnaXZlbiBIVFRQIEhlYWRlciBEaWN0LgoKICAgIDpwYXJhbSBoZWFkZXJzOiBkaWN0aW9uYXJ5IHRvIGV4dHJhY3QgZW5jb2RpbmcgZnJvbS4KICAgIDpydHlwZTogc3RyCiAgICAiIiIKCiAgICBjb250ZW50X3R5cGUgPSBoZWFkZXJzLmdldCgnY29udGVudC10eXBlJykKCiAgICBpZiBub3QgY29udGVudF90eXBlOgogICAgICAgIHJldHVybiBOb25lCgogICAgY29udGVudF90eXBlLCBwYXJhbXMgPSBjZ2kucGFyc2VfaGVhZGVyKGNvbnRlbnRfdHlwZSkKCiAgICBpZiAnY2hhcnNldCcgaW4gcGFyYW1zOgogICAgICAgIHJldHVybiBwYXJhbXNbJ2NoYXJzZXQnXS5zdHJpcCgiJ1wiIikKCiAgICBpZiAndGV4dCcgaW4gY29udGVudF90eXBlOgogICAgICAgIHJldHVybiAnSVNPLTg4NTktMScKCgpkZWYgc3RyZWFtX2RlY29kZV9yZXNwb25zZV91bmljb2RlKGl0ZXJhdG9yLCByKToKICAgICIiIlN0cmVhbSBkZWNvZGVzIGEgaXRlcmF0b3IuIiIiCgogICAgaWYgci5lbmNvZGluZyBpcyBOb25lOgogICAgICAgIGZvciBpdGVtIGluIGl0ZXJhdG9yOgogICAgICAgICAgICB5aWVsZCBpdGVtCiAgICAgICAgcmV0dXJuCgogICAgZGVjb2RlciA9IGNvZGVjcy5nZXRpbmNyZW1lbnRhbGRlY29kZXIoci5lbmNvZGluZykoZXJyb3JzPSdyZXBsYWNlJykKICAgIGZvciBjaHVuayBpbiBpdGVyYXRvcjoKICAgICAgICBydiA9IGRlY29kZXIuZGVjb2RlKGNodW5rKQogICAgICAgIGlmIHJ2OgogICAgICAgICAgICB5aWVsZCBydgogICAgcnYgPSBkZWNvZGVyLmRlY29kZShiJycsIGZpbmFsPVRydWUpCiAgICBpZiBydjoKICAgICAgICB5aWVsZCBydgoKCmRlZiBpdGVyX3NsaWNlcyhzdHJpbmcsIHNsaWNlX2xlbmd0aCk6CiAgICAiIiJJdGVyYXRlIG92ZXIgc2xpY2VzIG9mIGEgc3RyaW5nLiIiIgogICAgcG9zID0gMAogICAgaWYgc2xpY2VfbGVuZ3RoIGlzIE5vbmUgb3Igc2xpY2VfbGVuZ3RoIDw9IDA6CiAgICAgICAgc2xpY2VfbGVuZ3RoID0gbGVuKHN0cmluZykKICAgIHdoaWxlIHBvcyA8IGxlbihzdHJpbmcpOgogICAgICAgIHlpZWxkIHN0cmluZ1twb3M6cG9zICsgc2xpY2VfbGVuZ3RoXQogICAgICAgIHBvcyArPSBzbGljZV9sZW5ndGgKCgpkZWYgZ2V0X3VuaWNvZGVfZnJvbV9yZXNwb25zZShyKToKICAgICIiIlJldHVybnMgdGhlIHJlcXVlc3RlZCBjb250ZW50IGJhY2sgaW4gdW5pY29kZS4KCiAgICA6cGFyYW0gcjogUmVzcG9uc2Ugb2JqZWN0IHRvIGdldCB1bmljb2RlIGNvbnRlbnQgZnJvbS4KCiAgICBUcmllZDoKCiAgICAxLiBjaGFyc2V0IGZyb20gY29udGVudC10eXBlCiAgICAyLiBmYWxsIGJhY2sgYW5kIHJlcGxhY2UgYWxsIHVuaWNvZGUgY2hhcmFjdGVycwoKICAgIDpydHlwZTogc3RyCiAgICAiIiIKICAgIHdhcm5pbmdzLndhcm4oKAogICAgICAgICdJbiByZXF1ZXN0cyAzLjAsIGdldF91bmljb2RlX2Zyb21fcmVzcG9uc2Ugd2lsbCBiZSByZW1vdmVkLiBGb3IgJwogICAgICAgICdtb3JlIGluZm9ybWF0aW9uLCBwbGVhc2Ugc2VlIHRoZSBkaXNjdXNzaW9uIG9uIGlzc3VlICMyMjY2LiAoVGhpcycKICAgICAgICAnIHdhcm5pbmcgc2hvdWxkIG9ubHkgYXBwZWFyIG9uY2UuKScpLAogICAgICAgIERlcHJlY2F0aW9uV2FybmluZykKCiAgICB0cmllZF9lbmNvZGluZ3MgPSBbXQoKICAgICMgVHJ5IGNoYXJzZXQgZnJvbSBjb250ZW50LXR5cGUKICAgIGVuY29kaW5nID0gZ2V0X2VuY29kaW5nX2Zyb21faGVhZGVycyhyLmhlYWRlcnMpCgogICAgaWYgZW5jb2Rpbmc6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gc3RyKHIuY29udGVudCwgZW5jb2RpbmcpCiAgICAgICAgZXhjZXB0IFVuaWNvZGVFcnJvcjoKICAgICAgICAgICAgdHJpZWRfZW5jb2RpbmdzLmFwcGVuZChlbmNvZGluZykKCiAgICAjIEZhbGwgYmFjazoKICAgIHRyeToKICAgICAgICByZXR1cm4gc3RyKHIuY29udGVudCwgZW5jb2RpbmcsIGVycm9ycz0ncmVwbGFjZScpCiAgICBleGNlcHQgVHlwZUVycm9yOgogICAgICAgIHJldHVybiByLmNvbnRlbnQKCgojIFRoZSB1bnJlc2VydmVkIFVSSSBjaGFyYWN0ZXJzIChSRkMgMzk4NikKVU5SRVNFUlZFRF9TRVQgPSBmcm96ZW5zZXQoCiAgICAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiIgKyAiMDEyMzQ1Njc4OS0uX34iKQoKCmRlZiB1bnF1b3RlX3VucmVzZXJ2ZWQodXJpKToKICAgICIiIlVuLWVzY2FwZSBhbnkgcGVyY2VudC1lc2NhcGUgc2VxdWVuY2VzIGluIGEgVVJJIHRoYXQgYXJlIHVucmVzZXJ2ZWQKICAgIGNoYXJhY3RlcnMuIFRoaXMgbGVhdmVzIGFsbCByZXNlcnZlZCwgaWxsZWdhbCBhbmQgbm9uLUFTQ0lJIGJ5dGVzIGVuY29kZWQuCgogICAgOnJ0eXBlOiBzdHIKICAgICIiIgogICAgcGFydHMgPSB1cmkuc3BsaXQoJyUnKQogICAgZm9yIGkgaW4gcmFuZ2UoMSwgbGVuKHBhcnRzKSk6CiAgICAgICAgaCA9IHBhcnRzW2ldWzA6Ml0KICAgICAgICBpZiBsZW4oaCkgPT0gMiBhbmQgaC5pc2FsbnVtKCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGMgPSBjaHIoaW50KGgsIDE2KSkKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICByYWlzZSBJbnZhbGlkVVJMKCJJbnZhbGlkIHBlcmNlbnQtZXNjYXBlIHNlcXVlbmNlOiAnJXMnIiAlIGgpCgogICAgICAgICAgICBpZiBjIGluIFVOUkVTRVJWRURfU0VUOgogICAgICAgICAgICAgICAgcGFydHNbaV0gPSBjICsgcGFydHNbaV1bMjpdCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwYXJ0c1tpXSA9ICclJyArIHBhcnRzW2ldCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcGFydHNbaV0gPSAnJScgKyBwYXJ0c1tpXQogICAgcmV0dXJuICcnLmpvaW4ocGFydHMpCgoKZGVmIHJlcXVvdGVfdXJpKHVyaSk6CiAgICAiIiJSZS1xdW90ZSB0aGUgZ2l2ZW4gVVJJLgoKICAgIFRoaXMgZnVuY3Rpb24gcGFzc2VzIHRoZSBnaXZlbiBVUkkgdGhyb3VnaCBhbiB1bnF1b3RlL3F1b3RlIGN5Y2xlIHRvCiAgICBlbnN1cmUgdGhhdCBpdCBpcyBmdWxseSBhbmQgY29uc2lzdGVudGx5IHF1b3RlZC4KCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCiAgICBzYWZlX3dpdGhfcGVyY2VudCA9ICIhIyQlJicoKSorLC86Oz0/QFtdfiIKICAgIHNhZmVfd2l0aG91dF9wZXJjZW50ID0gIiEjJCYnKCkqKywvOjs9P0BbXX4iCiAgICB0cnk6CiAgICAgICAgIyBVbnF1b3RlIG9ubHkgdGhlIHVucmVzZXJ2ZWQgY2hhcmFjdGVycwogICAgICAgICMgVGhlbiBxdW90ZSBvbmx5IGlsbGVnYWwgY2hhcmFjdGVycyAoZG8gbm90IHF1b3RlIHJlc2VydmVkLAogICAgICAgICMgdW5yZXNlcnZlZCwgb3IgJyUnKQogICAgICAgIHJldHVybiBxdW90ZSh1bnF1b3RlX3VucmVzZXJ2ZWQodXJpKSwgc2FmZT1zYWZlX3dpdGhfcGVyY2VudCkKICAgIGV4Y2VwdCBJbnZhbGlkVVJMOgogICAgICAgICMgV2UgY291bGRuJ3QgdW5xdW90ZSB0aGUgZ2l2ZW4gVVJJLCBzbyBsZXQncyB0cnkgcXVvdGluZyBpdCwgYnV0CiAgICAgICAgIyB0aGVyZSBtYXkgYmUgdW5xdW90ZWQgJyUncyBpbiB0aGUgVVJJLiBXZSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGV5J3JlCiAgICAgICAgIyBwcm9wZXJseSBxdW90ZWQgc28gdGhleSBkbyBub3QgY2F1c2UgaXNzdWVzIGVsc2V3aGVyZS4KICAgICAgICByZXR1cm4gcXVvdGUodXJpLCBzYWZlPXNhZmVfd2l0aG91dF9wZXJjZW50KQoKCmRlZiBhZGRyZXNzX2luX25ldHdvcmsoaXAsIG5ldCk6CiAgICAiIiJUaGlzIGZ1bmN0aW9uIGFsbG93cyB5b3UgdG8gY2hlY2sgaWYgYW4gSVAgYmVsb25ncyB0byBhIG5ldHdvcmsgc3VibmV0CgogICAgRXhhbXBsZTogcmV0dXJucyBUcnVlIGlmIGlwID0gMTkyLjE2OC4xLjEgYW5kIG5ldCA9IDE5Mi4xNjguMS4wLzI0CiAgICAgICAgICAgICByZXR1cm5zIEZhbHNlIGlmIGlwID0gMTkyLjE2OC4xLjEgYW5kIG5ldCA9IDE5Mi4xNjguMTAwLjAvMjQKCiAgICA6cnR5cGU6IGJvb2wKICAgICIiIgogICAgaXBhZGRyID0gc3RydWN0LnVucGFjaygnPUwnLCBzb2NrZXQuaW5ldF9hdG9uKGlwKSlbMF0KICAgIG5ldGFkZHIsIGJpdHMgPSBuZXQuc3BsaXQoJy8nKQogICAgbmV0bWFzayA9IHN0cnVjdC51bnBhY2soJz1MJywgc29ja2V0LmluZXRfYXRvbihkb3R0ZWRfbmV0bWFzayhpbnQoYml0cykpKSlbMF0KICAgIG5ldHdvcmsgPSBzdHJ1Y3QudW5wYWNrKCc9TCcsIHNvY2tldC5pbmV0X2F0b24obmV0YWRkcikpWzBdICYgbmV0bWFzawogICAgcmV0dXJuIChpcGFkZHIgJiBuZXRtYXNrKSA9PSAobmV0d29yayAmIG5ldG1hc2spCgoKZGVmIGRvdHRlZF9uZXRtYXNrKG1hc2spOgogICAgIiIiQ29udmVydHMgbWFzayBmcm9tIC94eCBmb3JtYXQgdG8geHh4Lnh4eC54eHgueHh4CgogICAgRXhhbXBsZTogaWYgbWFzayBpcyAyNCBmdW5jdGlvbiByZXR1cm5zIDI1NS4yNTUuMjU1LjAKCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCiAgICBiaXRzID0gMHhmZmZmZmZmZiBeICgxIDw8IDMyIC0gbWFzaykgLSAxCiAgICByZXR1cm4gc29ja2V0LmluZXRfbnRvYShzdHJ1Y3QucGFjaygnPkknLCBiaXRzKSkKCgpkZWYgaXNfaXB2NF9hZGRyZXNzKHN0cmluZ19pcCk6CiAgICAiIiIKICAgIDpydHlwZTogYm9vbAogICAgIiIiCiAgICB0cnk6CiAgICAgICAgc29ja2V0LmluZXRfYXRvbihzdHJpbmdfaXApCiAgICBleGNlcHQgc29ja2V0LmVycm9yOgogICAgICAgIHJldHVybiBGYWxzZQogICAgcmV0dXJuIFRydWUKCgpkZWYgaXNfdmFsaWRfY2lkcihzdHJpbmdfbmV0d29yayk6CiAgICAiIiIKICAgIFZlcnkgc2ltcGxlIGNoZWNrIG9mIHRoZSBjaWRyIGZvcm1hdCBpbiBub19wcm94eSB2YXJpYWJsZS4KCiAgICA6cnR5cGU6IGJvb2wKICAgICIiIgogICAgaWYgc3RyaW5nX25ldHdvcmsuY291bnQoJy8nKSA9PSAxOgogICAgICAgIHRyeToKICAgICAgICAgICAgbWFzayA9IGludChzdHJpbmdfbmV0d29yay5zcGxpdCgnLycpWzFdKQogICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgaWYgbWFzayA8IDEgb3IgbWFzayA+IDMyOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzb2NrZXQuaW5ldF9hdG9uKHN0cmluZ19uZXR3b3JrLnNwbGl0KCcvJylbMF0pCiAgICAgICAgZXhjZXB0IHNvY2tldC5lcnJvcjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBlbHNlOgogICAgICAgIHJldHVybiBGYWxzZQogICAgcmV0dXJuIFRydWUKCgpAY29udGV4dGxpYi5jb250ZXh0bWFuYWdlcgpkZWYgc2V0X2Vudmlyb24oZW52X25hbWUsIHZhbHVlKToKICAgICIiIlNldCB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGUgJ2Vudl9uYW1lJyB0byAndmFsdWUnCgogICAgU2F2ZSBwcmV2aW91cyB2YWx1ZSwgeWllbGQsIGFuZCB0aGVuIHJlc3RvcmUgdGhlIHByZXZpb3VzIHZhbHVlIHN0b3JlZCBpbgogICAgdGhlIGVudmlyb25tZW50IHZhcmlhYmxlICdlbnZfbmFtZScuCgogICAgSWYgJ3ZhbHVlJyBpcyBOb25lLCBkbyBub3RoaW5nIiIiCiAgICB2YWx1ZV9jaGFuZ2VkID0gdmFsdWUgaXMgbm90IE5vbmUKICAgIGlmIHZhbHVlX2NoYW5nZWQ6CiAgICAgICAgb2xkX3ZhbHVlID0gb3MuZW52aXJvbi5nZXQoZW52X25hbWUpCiAgICAgICAgb3MuZW52aXJvbltlbnZfbmFtZV0gPSB2YWx1ZQogICAgdHJ5OgogICAgICAgIHlpZWxkCiAgICBmaW5hbGx5OgogICAgICAgIGlmIHZhbHVlX2NoYW5nZWQ6CiAgICAgICAgICAgIGlmIG9sZF92YWx1ZSBpcyBOb25lOgogICAgICAgICAgICAgICAgZGVsIG9zLmVudmlyb25bZW52X25hbWVdCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvcy5lbnZpcm9uW2Vudl9uYW1lXSA9IG9sZF92YWx1ZQoKCmRlZiBzaG91bGRfYnlwYXNzX3Byb3hpZXModXJsLCBub19wcm94eSk6CiAgICAiIiIKICAgIFJldHVybnMgd2hldGhlciB3ZSBzaG91bGQgYnlwYXNzIHByb3hpZXMgb3Igbm90LgoKICAgIDpydHlwZTogYm9vbAogICAgIiIiCiAgICBnZXRfcHJveHkgPSBsYW1iZGEgazogb3MuZW52aXJvbi5nZXQoaykgb3Igb3MuZW52aXJvbi5nZXQoay51cHBlcigpKQoKICAgICMgRmlyc3QgY2hlY2sgd2hldGhlciBub19wcm94eSBpcyBkZWZpbmVkLiBJZiBpdCBpcywgY2hlY2sgdGhhdCB0aGUgVVJMCiAgICAjIHdlJ3JlIGdldHRpbmcgaXNuJ3QgaW4gdGhlIG5vX3Byb3h5IGxpc3QuCiAgICBub19wcm94eV9hcmcgPSBub19wcm94eQogICAgaWYgbm9fcHJveHkgaXMgTm9uZToKICAgICAgICBub19wcm94eSA9IGdldF9wcm94eSgnbm9fcHJveHknKQogICAgbmV0bG9jID0gdXJscGFyc2UodXJsKS5uZXRsb2MKCiAgICBpZiBub19wcm94eToKICAgICAgICAjIFdlIG5lZWQgdG8gY2hlY2sgd2hldGhlciB3ZSBtYXRjaCBoZXJlLiBXZSBuZWVkIHRvIHNlZSBpZiB3ZSBtYXRjaAogICAgICAgICMgdGhlIGVuZCBvZiB0aGUgbmV0bG9jLCBib3RoIHdpdGggYW5kIHdpdGhvdXQgdGhlIHBvcnQuCiAgICAgICAgbm9fcHJveHkgPSAoCiAgICAgICAgICAgIGhvc3QgZm9yIGhvc3QgaW4gbm9fcHJveHkucmVwbGFjZSgnICcsICcnKS5zcGxpdCgnLCcpIGlmIGhvc3QKICAgICAgICApCgogICAgICAgIGlwID0gbmV0bG9jLnNwbGl0KCc6JylbMF0KICAgICAgICBpZiBpc19pcHY0X2FkZHJlc3MoaXApOgogICAgICAgICAgICBmb3IgcHJveHlfaXAgaW4gbm9fcHJveHk6CiAgICAgICAgICAgICAgICBpZiBpc192YWxpZF9jaWRyKHByb3h5X2lwKToKICAgICAgICAgICAgICAgICAgICBpZiBhZGRyZXNzX2luX25ldHdvcmsoaXAsIHByb3h5X2lwKToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIGVsaWYgaXAgPT0gcHJveHlfaXA6CiAgICAgICAgICAgICAgICAgICAgIyBJZiBub19wcm94eSBpcCB3YXMgZGVmaW5lZCBpbiBwbGFpbiBJUCBub3RhdGlvbiBpbnN0ZWFkIG9mIGNpZHIgbm90YXRpb24gJgogICAgICAgICAgICAgICAgICAgICMgbWF0Y2hlcyB0aGUgSVAgb2YgdGhlIGluZGV4CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICBmb3IgaG9zdCBpbiBub19wcm94eToKICAgICAgICAgICAgICAgIGlmIG5ldGxvYy5lbmRzd2l0aChob3N0KSBvciBuZXRsb2Muc3BsaXQoJzonKVswXS5lbmRzd2l0aChob3N0KToKICAgICAgICAgICAgICAgICAgICAjIFRoZSBVUkwgZG9lcyBtYXRjaCBzb21ldGhpbmcgaW4gbm9fcHJveHksIHNvIHdlIGRvbid0IHdhbnQKICAgICAgICAgICAgICAgICAgICAjIHRvIGFwcGx5IHRoZSBwcm94aWVzIG9uIHRoaXMgVVJMLgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgIyBJZiB0aGUgc3lzdGVtIHByb3h5IHNldHRpbmdzIGluZGljYXRlIHRoYXQgdGhpcyBVUkwgc2hvdWxkIGJlIGJ5cGFzc2VkLAogICAgIyBkb24ndCBwcm94eS4KICAgICMgVGhlIHByb3h5X2J5cGFzcyBmdW5jdGlvbiBpcyBpbmNyZWRpYmx5IGJ1Z2d5IG9uIE9TIFggaW4gZWFybHkgdmVyc2lvbnMKICAgICMgb2YgUHl0aG9uIDIuNiwgc28gYWxsb3cgdGhpcyBjYWxsIHRvIGZhaWwuIE9ubHkgY2F0Y2ggdGhlIHNwZWNpZmljCiAgICAjIGV4Y2VwdGlvbnMgd2UndmUgc2VlbiwgdGhvdWdoOiB0aGlzIGNhbGwgZmFpbGluZyBpbiBvdGhlciB3YXlzIGNhbiByZXZlYWwKICAgICMgbGVnaXRpbWF0ZSBwcm9ibGVtcy4KICAgIHdpdGggc2V0X2Vudmlyb24oJ25vX3Byb3h5Jywgbm9fcHJveHlfYXJnKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGJ5cGFzcyA9IHByb3h5X2J5cGFzcyhuZXRsb2MpCiAgICAgICAgZXhjZXB0IChUeXBlRXJyb3IsIHNvY2tldC5nYWllcnJvcik6CiAgICAgICAgICAgIGJ5cGFzcyA9IEZhbHNlCgogICAgaWYgYnlwYXNzOgogICAgICAgIHJldHVybiBUcnVlCgogICAgcmV0dXJuIEZhbHNlCgoKZGVmIGdldF9lbnZpcm9uX3Byb3hpZXModXJsLCBub19wcm94eT1Ob25lKToKICAgICIiIgogICAgUmV0dXJuIGEgZGljdCBvZiBlbnZpcm9ubWVudCBwcm94aWVzLgoKICAgIDpydHlwZTogZGljdAogICAgIiIiCiAgICBpZiBzaG91bGRfYnlwYXNzX3Byb3hpZXModXJsLCBub19wcm94eT1ub19wcm94eSk6CiAgICAgICAgcmV0dXJuIHt9CiAgICBlbHNlOgogICAgICAgIHJldHVybiBnZXRwcm94aWVzKCkKCgpkZWYgc2VsZWN0X3Byb3h5KHVybCwgcHJveGllcyk6CiAgICAiIiJTZWxlY3QgYSBwcm94eSBmb3IgdGhlIHVybCwgaWYgYXBwbGljYWJsZS4KCiAgICA6cGFyYW0gdXJsOiBUaGUgdXJsIGJlaW5nIGZvciB0aGUgcmVxdWVzdAogICAgOnBhcmFtIHByb3hpZXM6IEEgZGljdGlvbmFyeSBvZiBzY2hlbWVzIG9yIHNjaGVtZXMgYW5kIGhvc3RzIHRvIHByb3h5IFVSTHMKICAgICIiIgogICAgcHJveGllcyA9IHByb3hpZXMgb3Ige30KICAgIHVybHBhcnRzID0gdXJscGFyc2UodXJsKQogICAgaWYgdXJscGFydHMuaG9zdG5hbWUgaXMgTm9uZToKICAgICAgICByZXR1cm4gcHJveGllcy5nZXQodXJscGFydHMuc2NoZW1lLCBwcm94aWVzLmdldCgnYWxsJykpCgogICAgcHJveHlfa2V5cyA9IFsKICAgICAgICB1cmxwYXJ0cy5zY2hlbWUgKyAnOi8vJyArIHVybHBhcnRzLmhvc3RuYW1lLAogICAgICAgIHVybHBhcnRzLnNjaGVtZSwKICAgICAgICAnYWxsOi8vJyArIHVybHBhcnRzLmhvc3RuYW1lLAogICAgICAgICdhbGwnLAogICAgXQogICAgcHJveHkgPSBOb25lCiAgICBmb3IgcHJveHlfa2V5IGluIHByb3h5X2tleXM6CiAgICAgICAgaWYgcHJveHlfa2V5IGluIHByb3hpZXM6CiAgICAgICAgICAgIHByb3h5ID0gcHJveGllc1twcm94eV9rZXldCiAgICAgICAgICAgIGJyZWFrCgogICAgcmV0dXJuIHByb3h5CgoKZGVmIGRlZmF1bHRfdXNlcl9hZ2VudChuYW1lPSJweXRob24tcmVxdWVzdHMiKToKICAgICIiIgogICAgUmV0dXJuIGEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgZGVmYXVsdCB1c2VyIGFnZW50LgoKICAgIDpydHlwZTogc3RyCiAgICAiIiIKICAgIHJldHVybiAnJXMvJXMnICUgKG5hbWUsIF9fdmVyc2lvbl9fKQoKCmRlZiBkZWZhdWx0X2hlYWRlcnMoKToKICAgICIiIgogICAgOnJ0eXBlOiByZXF1ZXN0cy5zdHJ1Y3R1cmVzLkNhc2VJbnNlbnNpdGl2ZURpY3QKICAgICIiIgogICAgcmV0dXJuIENhc2VJbnNlbnNpdGl2ZURpY3QoewogICAgICAgICdVc2VyLUFnZW50JzogZGVmYXVsdF91c2VyX2FnZW50KCksCiAgICAgICAgJ0FjY2VwdC1FbmNvZGluZyc6ICcsICcuam9pbigoJ2d6aXAnLCAnZGVmbGF0ZScpKSwKICAgICAgICAnQWNjZXB0JzogJyovKicsCiAgICAgICAgJ0Nvbm5lY3Rpb24nOiAna2VlcC1hbGl2ZScsCiAgICB9KQoKCmRlZiBwYXJzZV9oZWFkZXJfbGlua3ModmFsdWUpOgogICAgIiIiUmV0dXJuIGEgZGljdCBvZiBwYXJzZWQgbGluayBoZWFkZXJzIHByb3hpZXMuCgogICAgaS5lLiBMaW5rOiA8aHR0cDovLi4uL2Zyb250LmpwZWc+OyByZWw9ZnJvbnQ7IHR5cGU9ImltYWdlL2pwZWciLDxodHRwOi8vLi4uL2JhY2suanBlZz47IHJlbD1iYWNrO3R5cGU9ImltYWdlL2pwZWciCgogICAgOnJ0eXBlOiBsaXN0CiAgICAiIiIKCiAgICBsaW5rcyA9IFtdCgogICAgcmVwbGFjZV9jaGFycyA9ICcgXCciJwoKICAgIGZvciB2YWwgaW4gcmUuc3BsaXQoJywgKjwnLCB2YWx1ZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB1cmwsIHBhcmFtcyA9IHZhbC5zcGxpdCgnOycsIDEpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHVybCwgcGFyYW1zID0gdmFsLCAnJwoKICAgICAgICBsaW5rID0geyd1cmwnOiB1cmwuc3RyaXAoJzw+IFwnIicpfQoKICAgICAgICBmb3IgcGFyYW0gaW4gcGFyYW1zLnNwbGl0KCc7Jyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGtleSwgdmFsdWUgPSBwYXJhbS5zcGxpdCgnPScpCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIGxpbmtba2V5LnN0cmlwKHJlcGxhY2VfY2hhcnMpXSA9IHZhbHVlLnN0cmlwKHJlcGxhY2VfY2hhcnMpCgogICAgICAgIGxpbmtzLmFwcGVuZChsaW5rKQoKICAgIHJldHVybiBsaW5rcwoKCiMgTnVsbCBieXRlczsgbm8gbmVlZCB0byByZWNyZWF0ZSB0aGVzZSBvbiBlYWNoIGNhbGwgdG8gZ3Vlc3NfanNvbl91dGYKX251bGwgPSAnXHgwMCcuZW5jb2RlKCdhc2NpaScpICAjIGVuY29kaW5nIHRvIEFTQ0lJIGZvciBQeXRob24gMwpfbnVsbDIgPSBfbnVsbCAqIDIKX251bGwzID0gX251bGwgKiAzCgoKZGVmIGd1ZXNzX2pzb25fdXRmKGRhdGEpOgogICAgIiIiCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCiAgICAjIEpTT04gYWx3YXlzIHN0YXJ0cyB3aXRoIHR3byBBU0NJSSBjaGFyYWN0ZXJzLCBzbyBkZXRlY3Rpb24gaXMgYXMKICAgICMgZWFzeSBhcyBjb3VudGluZyB0aGUgbnVsbHMgYW5kIGZyb20gdGhlaXIgbG9jYXRpb24gYW5kIGNvdW50CiAgICAjIGRldGVybWluZSB0aGUgZW5jb2RpbmcuIEFsc28gZGV0ZWN0IGEgQk9NLCBpZiBwcmVzZW50LgogICAgc2FtcGxlID0gZGF0YVs6NF0KICAgIGlmIHNhbXBsZSBpbiAoY29kZWNzLkJPTV9VVEYzMl9MRSwgY29kZWNzLkJPTV9VVEYzMl9CRSk6CiAgICAgICAgcmV0dXJuICd1dGYtMzInICAgICAjIEJPTSBpbmNsdWRlZAogICAgaWYgc2FtcGxlWzozXSA9PSBjb2RlY3MuQk9NX1VURjg6CiAgICAgICAgcmV0dXJuICd1dGYtOC1zaWcnICAjIEJPTSBpbmNsdWRlZCwgTVMgc3R5bGUgKGRpc2NvdXJhZ2VkKQogICAgaWYgc2FtcGxlWzoyXSBpbiAoY29kZWNzLkJPTV9VVEYxNl9MRSwgY29kZWNzLkJPTV9VVEYxNl9CRSk6CiAgICAgICAgcmV0dXJuICd1dGYtMTYnICAgICAjIEJPTSBpbmNsdWRlZAogICAgbnVsbGNvdW50ID0gc2FtcGxlLmNvdW50KF9udWxsKQogICAgaWYgbnVsbGNvdW50ID09IDA6CiAgICAgICAgcmV0dXJuICd1dGYtOCcKICAgIGlmIG51bGxjb3VudCA9PSAyOgogICAgICAgIGlmIHNhbXBsZVs6OjJdID09IF9udWxsMjogICAjIDFzdCBhbmQgM3JkIGFyZSBudWxsCiAgICAgICAgICAgIHJldHVybiAndXRmLTE2LWJlJwogICAgICAgIGlmIHNhbXBsZVsxOjoyXSA9PSBfbnVsbDI6ICAjIDJuZCBhbmQgNHRoIGFyZSBudWxsCiAgICAgICAgICAgIHJldHVybiAndXRmLTE2LWxlJwogICAgICAgICMgRGlkIG5vdCBkZXRlY3QgMiB2YWxpZCBVVEYtMTYgYXNjaWktcmFuZ2UgY2hhcmFjdGVycwogICAgaWYgbnVsbGNvdW50ID09IDM6CiAgICAgICAgaWYgc2FtcGxlWzozXSA9PSBfbnVsbDM6CiAgICAgICAgICAgIHJldHVybiAndXRmLTMyLWJlJwogICAgICAgIGlmIHNhbXBsZVsxOl0gPT0gX251bGwzOgogICAgICAgICAgICByZXR1cm4gJ3V0Zi0zMi1sZScKICAgICAgICAjIERpZCBub3QgZGV0ZWN0IGEgdmFsaWQgVVRGLTMyIGFzY2lpLXJhbmdlIGNoYXJhY3RlcgogICAgcmV0dXJuIE5vbmUKCgpkZWYgcHJlcGVuZF9zY2hlbWVfaWZfbmVlZGVkKHVybCwgbmV3X3NjaGVtZSk6CiAgICAiIiJHaXZlbiBhIFVSTCB0aGF0IG1heSBvciBtYXkgbm90IGhhdmUgYSBzY2hlbWUsIHByZXBlbmQgdGhlIGdpdmVuIHNjaGVtZS4KICAgIERvZXMgbm90IHJlcGxhY2UgYSBwcmVzZW50IHNjaGVtZSB3aXRoIHRoZSBvbmUgcHJvdmlkZWQgYXMgYW4gYXJndW1lbnQuCgogICAgOnJ0eXBlOiBzdHIKICAgICIiIgogICAgc2NoZW1lLCBuZXRsb2MsIHBhdGgsIHBhcmFtcywgcXVlcnksIGZyYWdtZW50ID0gdXJscGFyc2UodXJsLCBuZXdfc2NoZW1lKQoKICAgICMgdXJscGFyc2UgaXMgYSBmaW5pY2t5IGJlYXN0LCBhbmQgc29tZXRpbWVzIGRlY2lkZXMgdGhhdCB0aGVyZSBpc24ndCBhCiAgICAjIG5ldGxvYyBwcmVzZW50LiBBc3N1bWUgdGhhdCBpdCdzIGJlaW5nIG92ZXItY2F1dGlvdXMsIGFuZCBzd2l0Y2ggbmV0bG9jCiAgICAjIGFuZCBwYXRoIGlmIHVybHBhcnNlIGRlY2lkZWQgdGhlcmUgd2FzIG5vIG5ldGxvYy4KICAgIGlmIG5vdCBuZXRsb2M6CiAgICAgICAgbmV0bG9jLCBwYXRoID0gcGF0aCwgbmV0bG9jCgogICAgcmV0dXJuIHVybHVucGFyc2UoKHNjaGVtZSwgbmV0bG9jLCBwYXRoLCBwYXJhbXMsIHF1ZXJ5LCBmcmFnbWVudCkpCgoKZGVmIGdldF9hdXRoX2Zyb21fdXJsKHVybCk6CiAgICAiIiJHaXZlbiBhIHVybCB3aXRoIGF1dGhlbnRpY2F0aW9uIGNvbXBvbmVudHMsIGV4dHJhY3QgdGhlbSBpbnRvIGEgdHVwbGUgb2YKICAgIHVzZXJuYW1lLHBhc3N3b3JkLgoKICAgIDpydHlwZTogKHN0cixzdHIpCiAgICAiIiIKICAgIHBhcnNlZCA9IHVybHBhcnNlKHVybCkKCiAgICB0cnk6CiAgICAgICAgYXV0aCA9ICh1bnF1b3RlKHBhcnNlZC51c2VybmFtZSksIHVucXVvdGUocGFyc2VkLnBhc3N3b3JkKSkKICAgIGV4Y2VwdCAoQXR0cmlidXRlRXJyb3IsIFR5cGVFcnJvcik6CiAgICAgICAgYXV0aCA9ICgnJywgJycpCgogICAgcmV0dXJuIGF1dGgKCgojIE1vdmVkIG91dHNpZGUgb2YgZnVuY3Rpb24gdG8gYXZvaWQgcmVjb21waWxlIGV2ZXJ5IGNhbGwKX0NMRUFOX0hFQURFUl9SRUdFWF9CWVRFID0gcmUuY29tcGlsZShiJ15cXFNbXlxcclxcbl0qJHxeJCcpCl9DTEVBTl9IRUFERVJfUkVHRVhfU1RSID0gcmUuY29tcGlsZShyJ15cU1teXHJcbl0qJHxeJCcpCgoKZGVmIGNoZWNrX2hlYWRlcl92YWxpZGl0eShoZWFkZXIpOgogICAgIiIiVmVyaWZpZXMgdGhhdCBoZWFkZXIgdmFsdWUgaXMgYSBzdHJpbmcgd2hpY2ggZG9lc24ndCBjb250YWluCiAgICBsZWFkaW5nIHdoaXRlc3BhY2Ugb3IgcmV0dXJuIGNoYXJhY3RlcnMuIFRoaXMgcHJldmVudHMgdW5pbnRlbmRlZAogICAgaGVhZGVyIGluamVjdGlvbi4KCiAgICA6cGFyYW0gaGVhZGVyOiB0dXBsZSwgaW4gdGhlIGZvcm1hdCAobmFtZSwgdmFsdWUpLgogICAgIiIiCiAgICBuYW1lLCB2YWx1ZSA9IGhlYWRlcgoKICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIGJ5dGVzKToKICAgICAgICBwYXQgPSBfQ0xFQU5fSEVBREVSX1JFR0VYX0JZVEUKICAgIGVsc2U6CiAgICAgICAgcGF0ID0gX0NMRUFOX0hFQURFUl9SRUdFWF9TVFIKICAgIHRyeToKICAgICAgICBpZiBub3QgcGF0Lm1hdGNoKHZhbHVlKToKICAgICAgICAgICAgcmFpc2UgSW52YWxpZEhlYWRlcigiSW52YWxpZCByZXR1cm4gY2hhcmFjdGVyIG9yIGxlYWRpbmcgc3BhY2UgaW4gaGVhZGVyOiAlcyIgJSBuYW1lKQogICAgZXhjZXB0IFR5cGVFcnJvcjoKICAgICAgICByYWlzZSBJbnZhbGlkSGVhZGVyKCJIZWFkZXIgdmFsdWUgJXMgbXVzdCBiZSBvZiB0eXBlIHN0ciBvciBieXRlcywgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5vdCAlcyIgJSAodmFsdWUsIHR5cGUodmFsdWUpKSkKCgpkZWYgdXJsZGVmcmFnYXV0aCh1cmwpOgogICAgIiIiCiAgICBHaXZlbiBhIHVybCByZW1vdmUgdGhlIGZyYWdtZW50IGFuZCB0aGUgYXV0aGVudGljYXRpb24gcGFydC4KCiAgICA6cnR5cGU6IHN0cgogICAgIiIiCiAgICBzY2hlbWUsIG5ldGxvYywgcGF0aCwgcGFyYW1zLCBxdWVyeSwgZnJhZ21lbnQgPSB1cmxwYXJzZSh1cmwpCgogICAgIyBzZWUgZnVuYzpgcHJlcGVuZF9zY2hlbWVfaWZfbmVlZGVkYAogICAgaWYgbm90IG5ldGxvYzoKICAgICAgICBuZXRsb2MsIHBhdGggPSBwYXRoLCBuZXRsb2MKCiAgICBuZXRsb2MgPSBuZXRsb2MucnNwbGl0KCdAJywgMSlbLTFdCgogICAgcmV0dXJuIHVybHVucGFyc2UoKHNjaGVtZSwgbmV0bG9jLCBwYXRoLCBwYXJhbXMsIHF1ZXJ5LCAnJykpCgoKZGVmIHJld2luZF9ib2R5KHByZXBhcmVkX3JlcXVlc3QpOgogICAgIiIiTW92ZSBmaWxlIHBvaW50ZXIgYmFjayB0byBpdHMgcmVjb3JkZWQgc3RhcnRpbmcgcG9zaXRpb24KICAgIHNvIGl0IGNhbiBiZSByZWFkIGFnYWluIG9uIHJlZGlyZWN0LgogICAgIiIiCiAgICBib2R5X3NlZWsgPSBnZXRhdHRyKHByZXBhcmVkX3JlcXVlc3QuYm9keSwgJ3NlZWsnLCBOb25lKQogICAgaWYgYm9keV9zZWVrIGlzIG5vdCBOb25lIGFuZCBpc2luc3RhbmNlKHByZXBhcmVkX3JlcXVlc3QuX2JvZHlfcG9zaXRpb24sIGludGVnZXJfdHlwZXMpOgogICAgICAgIHRyeToKICAgICAgICAgICAgYm9keV9zZWVrKHByZXBhcmVkX3JlcXVlc3QuX2JvZHlfcG9zaXRpb24pCiAgICAgICAgZXhjZXB0IChJT0Vycm9yLCBPU0Vycm9yKToKICAgICAgICAgICAgcmFpc2UgVW5yZXdpbmRhYmxlQm9keUVycm9yKCJBbiBlcnJvciBvY2N1cnJlZCB3aGVuIHJld2luZGluZyByZXF1ZXN0ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJib2R5IGZvciByZWRpcmVjdC4iKQogICAgZWxzZToKICAgICAgICByYWlzZSBVbnJld2luZGFibGVCb2R5RXJyb3IoIlVuYWJsZSB0byByZXdpbmQgcmVxdWVzdCBib2R5IGZvciByZWRpcmVjdC4iKQo=
