statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/customizations/s3/results.py
  contents:
  - name: DownloadResultSubscriber
    score: 0.0
    code: |-
      def _get_src(self, fileobj):
              return '-'
    tokens: resume load_name __name__ store_name __module__ load_const STRING_BASE64_LEN_S_ENT_HIGH store_name __qualname__ load_const download store_name TRANSFER_TYPE load_const OBJECT make_function store_name _get_src_dest load_const OBJECT make_function store_name _get_dest return_const None
    hash: 8af1cbd2896e165fd6dd00dd8b7711feb211fbd71d59f535c01105754ea8d341
sources:
  .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/customizations/s3/results.py: IyBDb3B5cmlnaHQgMjAxNiBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLgojCiMgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIikuIFlvdQojIG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YKIyB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0CiMKIyAgICAgaHR0cDovL2F3cy5hbWF6b24uY29tL2FwYWNoZTIuMC8KIwojIG9yIGluIHRoZSAibGljZW5zZSIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMKIyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRgojIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYwojIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCmZyb20gX19mdXR1cmVfXyBpbXBvcnQgZGl2aXNpb24KaW1wb3J0IGxvZ2dpbmcKaW1wb3J0IHN5cwppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCB0aW1lCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IG5hbWVkdHVwbGUKZnJvbSBjb2xsZWN0aW9ucyBpbXBvcnQgZGVmYXVsdGRpY3QKCmZyb20gczN0cmFuc2Zlci5leGNlcHRpb25zIGltcG9ydCBDYW5jZWxsZWRFcnJvcgpmcm9tIHMzdHJhbnNmZXIuZXhjZXB0aW9ucyBpbXBvcnQgRmF0YWxFcnJvcgpmcm9tIHMzdHJhbnNmZXIuc3Vic2NyaWJlcnMgaW1wb3J0IEJhc2VTdWJzY3JpYmVyCgpmcm9tIGF3c2NsaS5jb21wYXQgaW1wb3J0IHF1ZXVlLCBlbnN1cmVfdGV4dF90eXBlCmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnV0aWxzIGltcG9ydCByZWxhdGl2ZV9wYXRoCmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnMzLnV0aWxzIGltcG9ydCBodW1hbl9yZWFkYWJsZV9zaXplCmZyb20gYXdzY2xpLmN1c3RvbWl6YXRpb25zLnV0aWxzIGltcG9ydCB1bmlfcHJpbnQKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMudXRpbHMgaW1wb3J0IFdhcm5pbmdSZXN1bHQKZnJvbSBhd3NjbGkuY3VzdG9taXphdGlvbnMuczMudXRpbHMgaW1wb3J0IE9uRG9uZUZpbHRlcmVkU3Vic2NyaWJlcgoKCkxPR0dFUiA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQoKCkJhc2VSZXN1bHQgPSBuYW1lZHR1cGxlKCdCYXNlUmVzdWx0JywgWyd0cmFuc2Zlcl90eXBlJywgJ3NyYycsICdkZXN0J10pCgoKZGVmIF9jcmVhdGVfbmV3X3Jlc3VsdF9jbHMobmFtZSwgZXh0cmFfZmllbGRzPU5vbmUsIGJhc2VfY2xzPUJhc2VSZXN1bHQpOgogICAgIyBDcmVhdGVzIGEgbmV3IG5hbWVkdHVwbGUgY2xhc3MgdGhhdCBzdWJjbGFzc2VzIGZyb20gQmFzZVJlc3VsdCBmb3IgdGhlCiAgICAjIGJlbmVmaXQgb2YgZmlsdGVyaW5nIGJ5IHR5cGUgYW5kIGVuc3VyaW5nIHBhcnRpY3VsYXIgYmFzZSBhdHRycy4KCiAgICAjIE5PVEU6IF9maWVsZHMgaXMgYSBwdWJsaWMgYXR0cmlidXRlIHRoYXQgaGFzIGFuIHVuZGVyc2NvcmUgdG8gYXZvaWQKICAgICMgbmFtaW5nIGNvbGxpc2lvbnMgZm9yIG5hbWVkdHVwbGVzOgogICAgIyBodHRwczovL2RvY3MucHl0aG9uLm9yZy8yL2xpYnJhcnkvY29sbGVjdGlvbnMuaHRtbCNjb2xsZWN0aW9ucy5zb21lbmFtZWR0dXBsZS5fZmllbGRzCiAgICBmaWVsZHMgPSBsaXN0KGJhc2VfY2xzLl9maWVsZHMpCiAgICBpZiBleHRyYV9maWVsZHM6CiAgICAgICAgZmllbGRzICs9IGV4dHJhX2ZpZWxkcwogICAgcmV0dXJuIHR5cGUobmFtZSwgKG5hbWVkdHVwbGUobmFtZSwgZmllbGRzKSwgYmFzZV9jbHMpLCB7fSkKCgpRdWV1ZWRSZXN1bHQgPSBfY3JlYXRlX25ld19yZXN1bHRfY2xzKCdRdWV1ZWRSZXN1bHQnLCBbJ3RvdGFsX3RyYW5zZmVyX3NpemUnXSkKClByb2dyZXNzUmVzdWx0ID0gX2NyZWF0ZV9uZXdfcmVzdWx0X2NscygKICAgICdQcm9ncmVzc1Jlc3VsdCcsIFsnYnl0ZXNfdHJhbnNmZXJyZWQnLCAndG90YWxfdHJhbnNmZXJfc2l6ZScsCiAgICAgICAgICAgICAgICAgICAgICAgJ3RpbWVzdGFtcCddKQoKU3VjY2Vzc1Jlc3VsdCA9IF9jcmVhdGVfbmV3X3Jlc3VsdF9jbHMoJ1N1Y2Nlc3NSZXN1bHQnKQoKRmFpbHVyZVJlc3VsdCA9IF9jcmVhdGVfbmV3X3Jlc3VsdF9jbHMoJ0ZhaWx1cmVSZXN1bHQnLCBbJ2V4Y2VwdGlvbiddKQoKRHJ5UnVuUmVzdWx0ID0gX2NyZWF0ZV9uZXdfcmVzdWx0X2NscygnRHJ5UnVuUmVzdWx0JykKCkVycm9yUmVzdWx0ID0gbmFtZWR0dXBsZSgnRXJyb3JSZXN1bHQnLCBbJ2V4Y2VwdGlvbiddKQoKQ3RybENSZXN1bHQgPSBfY3JlYXRlX25ld19yZXN1bHRfY2xzKCdDdHJsQ1Jlc3VsdCcsIGJhc2VfY2xzPUVycm9yUmVzdWx0KQoKQ29tbWFuZFJlc3VsdCA9IG5hbWVkdHVwbGUoCiAgICAnQ29tbWFuZFJlc3VsdCcsIFsnbnVtX3Rhc2tzX2ZhaWxlZCcsICdudW1fdGFza3Nfd2FybmVkJ10pCgpGaW5hbFRvdGFsU3VibWlzc2lvbnNSZXN1bHQgPSBuYW1lZHR1cGxlKAogICAgJ0ZpbmFsVG90YWxTdWJtaXNzaW9uc1Jlc3VsdCcsIFsndG90YWxfc3VibWlzc2lvbnMnXSkKCgpjbGFzcyBTaHV0ZG93blRocmVhZFJlcXVlc3Qob2JqZWN0KToKICAgIHBhc3MKCgpjbGFzcyBCYXNlUmVzdWx0U3Vic2NyaWJlcihPbkRvbmVGaWx0ZXJlZFN1YnNjcmliZXIpOgogICAgVFJBTlNGRVJfVFlQRSA9IE5vbmUKCiAgICBkZWYgX19pbml0X18oc2VsZiwgcmVzdWx0X3F1ZXVlLCB0cmFuc2Zlcl90eXBlPU5vbmUpOgogICAgICAgICIiIlN1YnNjcmliZXIgdG8gc2VuZCByZXN1bHQgbm90aWZpY2F0aW9ucyBkdXJpbmcgdHJhbnNmZXIgcHJvY2VzcwoKICAgICAgICA6cGFyYW0gcmVzdWx0X3F1ZXVlOiBUaGUgcXVldWUgdG8gcGxhY2UgcmVzdWx0cyB0byBiZSBwcm9jZXNzZWQgbGF0ZXIKICAgICAgICAgICAgb24uCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5fcmVzdWx0X3F1ZXVlID0gcmVzdWx0X3F1ZXVlCiAgICAgICAgc2VsZi5fcmVzdWx0X2t3YXJnc19jYWNoZSA9IHt9CiAgICAgICAgc2VsZi5fdHJhbnNmZXJfdHlwZSA9IHRyYW5zZmVyX3R5cGUKICAgICAgICBpZiB0cmFuc2Zlcl90eXBlIGlzIE5vbmU6CiAgICAgICAgICAgIHNlbGYuX3RyYW5zZmVyX3R5cGUgPSBzZWxmLlRSQU5TRkVSX1RZUEUKCiAgICBkZWYgb25fcXVldWVkKHNlbGYsIGZ1dHVyZSwgKiprd2FyZ3MpOgogICAgICAgIHNlbGYuX2FkZF90b19yZXN1bHRfa3dhcmdzX2NhY2hlKGZ1dHVyZSkKICAgICAgICByZXN1bHRfa3dhcmdzID0gc2VsZi5fcmVzdWx0X2t3YXJnc19jYWNoZVtmdXR1cmUubWV0YS50cmFuc2Zlcl9pZF0KICAgICAgICBxdWV1ZWRfcmVzdWx0ID0gUXVldWVkUmVzdWx0KCoqcmVzdWx0X2t3YXJncykKICAgICAgICBzZWxmLl9yZXN1bHRfcXVldWUucHV0KHF1ZXVlZF9yZXN1bHQpCgogICAgZGVmIG9uX3Byb2dyZXNzKHNlbGYsIGZ1dHVyZSwgYnl0ZXNfdHJhbnNmZXJyZWQsICoqa3dhcmdzKToKICAgICAgICByZXN1bHRfa3dhcmdzID0gc2VsZi5fcmVzdWx0X2t3YXJnc19jYWNoZVtmdXR1cmUubWV0YS50cmFuc2Zlcl9pZF0KICAgICAgICBwcm9ncmVzc19yZXN1bHQgPSBQcm9ncmVzc1Jlc3VsdCgKICAgICAgICAgICAgYnl0ZXNfdHJhbnNmZXJyZWQ9Ynl0ZXNfdHJhbnNmZXJyZWQsIHRpbWVzdGFtcD10aW1lLnRpbWUoKSwKICAgICAgICAgICAgKipyZXN1bHRfa3dhcmdzKQogICAgICAgIHNlbGYuX3Jlc3VsdF9xdWV1ZS5wdXQocHJvZ3Jlc3NfcmVzdWx0KQoKICAgIGRlZiBfb25fc3VjY2VzcyhzZWxmLCBmdXR1cmUpOgogICAgICAgIHJlc3VsdF9rd2FyZ3MgPSBzZWxmLl9vbl9kb25lX3BvcF9mcm9tX3Jlc3VsdF9rd2FyZ3NfY2FjaGUoZnV0dXJlKQogICAgICAgIHNlbGYuX3Jlc3VsdF9xdWV1ZS5wdXQoU3VjY2Vzc1Jlc3VsdCgqKnJlc3VsdF9rd2FyZ3MpKQoKICAgIGRlZiBfb25fZmFpbHVyZShzZWxmLCBmdXR1cmUsIGUpOgogICAgICAgIHJlc3VsdF9rd2FyZ3MgPSBzZWxmLl9vbl9kb25lX3BvcF9mcm9tX3Jlc3VsdF9rd2FyZ3NfY2FjaGUoZnV0dXJlKQogICAgICAgIGlmIGlzaW5zdGFuY2UoZSwgQ2FuY2VsbGVkRXJyb3IpOgogICAgICAgICAgICBlcnJvcl9yZXN1bHRfY2xzID0gQ3RybENSZXN1bHQKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLCBGYXRhbEVycm9yKToKICAgICAgICAgICAgICAgIGVycm9yX3Jlc3VsdF9jbHMgPSBFcnJvclJlc3VsdAogICAgICAgICAgICBzZWxmLl9yZXN1bHRfcXVldWUucHV0KGVycm9yX3Jlc3VsdF9jbHMoZXhjZXB0aW9uPWUpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuX3Jlc3VsdF9xdWV1ZS5wdXQoRmFpbHVyZVJlc3VsdChleGNlcHRpb249ZSwgKipyZXN1bHRfa3dhcmdzKSkKCiAgICBkZWYgX2FkZF90b19yZXN1bHRfa3dhcmdzX2NhY2hlKHNlbGYsIGZ1dHVyZSk6CiAgICAgICAgc3JjLCBkZXN0ID0gc2VsZi5fZ2V0X3NyY19kZXN0KGZ1dHVyZSkKICAgICAgICByZXN1bHRfa3dhcmdzID0gewogICAgICAgICAgICAndHJhbnNmZXJfdHlwZSc6IHNlbGYuX3RyYW5zZmVyX3R5cGUsCiAgICAgICAgICAgICdzcmMnOiBzcmMsCiAgICAgICAgICAgICdkZXN0JzogZGVzdCwKICAgICAgICAgICAgJ3RvdGFsX3RyYW5zZmVyX3NpemUnOiBmdXR1cmUubWV0YS5zaXplCiAgICAgICAgfQogICAgICAgIHNlbGYuX3Jlc3VsdF9rd2FyZ3NfY2FjaGVbZnV0dXJlLm1ldGEudHJhbnNmZXJfaWRdID0gcmVzdWx0X2t3YXJncwoKICAgIGRlZiBfb25fZG9uZV9wb3BfZnJvbV9yZXN1bHRfa3dhcmdzX2NhY2hlKHNlbGYsIGZ1dHVyZSk6CiAgICAgICAgcmVzdWx0X2t3YXJncyA9IHNlbGYuX3Jlc3VsdF9rd2FyZ3NfY2FjaGUucG9wKGZ1dHVyZS5tZXRhLnRyYW5zZmVyX2lkKQogICAgICAgIHJlc3VsdF9rd2FyZ3MucG9wKCd0b3RhbF90cmFuc2Zlcl9zaXplJykKICAgICAgICByZXR1cm4gcmVzdWx0X2t3YXJncwoKICAgIGRlZiBfZ2V0X3NyY19kZXN0KHNlbGYsIGZ1dHVyZSk6CiAgICAgICAgcmFpc2UgTm90SW1wbGVtZW50ZWRFcnJvcignX2dldF9zcmNfZGVzdCgpJykKCgpjbGFzcyBVcGxvYWRSZXN1bHRTdWJzY3JpYmVyKEJhc2VSZXN1bHRTdWJzY3JpYmVyKToKICAgIFRSQU5TRkVSX1RZUEUgPSAndXBsb2FkJwoKICAgIGRlZiBfZ2V0X3NyY19kZXN0KHNlbGYsIGZ1dHVyZSk6CiAgICAgICAgY2FsbF9hcmdzID0gZnV0dXJlLm1ldGEuY2FsbF9hcmdzCiAgICAgICAgc3JjID0gc2VsZi5fZ2V0X3NyYyhjYWxsX2FyZ3MuZmlsZW9iaikKICAgICAgICBkZXN0ID0gJ3MzOi8vJyArIGNhbGxfYXJncy5idWNrZXQgKyAnLycgKyBjYWxsX2FyZ3Mua2V5CiAgICAgICAgcmV0dXJuIHNyYywgZGVzdAoKICAgIGRlZiBfZ2V0X3NyYyhzZWxmLCBmaWxlb2JqKToKICAgICAgICByZXR1cm4gcmVsYXRpdmVfcGF0aChmaWxlb2JqKQoKCmNsYXNzIFVwbG9hZFN0cmVhbVJlc3VsdFN1YnNjcmliZXIoVXBsb2FkUmVzdWx0U3Vic2NyaWJlcik6CiAgICBkZWYgX2dldF9zcmMoc2VsZiwgZmlsZW9iaik6CiAgICAgICAgcmV0dXJuICctJwoKCmNsYXNzIERvd25sb2FkUmVzdWx0U3Vic2NyaWJlcihCYXNlUmVzdWx0U3Vic2NyaWJlcik6CiAgICBUUkFOU0ZFUl9UWVBFID0gJ2Rvd25sb2FkJwoKICAgIGRlZiBfZ2V0X3NyY19kZXN0KHNlbGYsIGZ1dHVyZSk6CiAgICAgICAgY2FsbF9hcmdzID0gZnV0dXJlLm1ldGEuY2FsbF9hcmdzCiAgICAgICAgc3JjID0gJ3MzOi8vJyArIGNhbGxfYXJncy5idWNrZXQgKyAnLycgKyBjYWxsX2FyZ3Mua2V5CiAgICAgICAgZGVzdCA9IHNlbGYuX2dldF9kZXN0KGNhbGxfYXJncy5maWxlb2JqKQogICAgICAgIHJldHVybiBzcmMsIGRlc3QKCiAgICBkZWYgX2dldF9kZXN0KHNlbGYsIGZpbGVvYmopOgogICAgICAgIHJldHVybiByZWxhdGl2ZV9wYXRoKGZpbGVvYmopCgoKY2xhc3MgRG93bmxvYWRTdHJlYW1SZXN1bHRTdWJzY3JpYmVyKERvd25sb2FkUmVzdWx0U3Vic2NyaWJlcik6CiAgICBkZWYgX2dldF9kZXN0KHNlbGYsIGZpbGVvYmopOgogICAgICAgIHJldHVybiAnLScKCgpjbGFzcyBDb3B5UmVzdWx0U3Vic2NyaWJlcihCYXNlUmVzdWx0U3Vic2NyaWJlcik6CiAgICBUUkFOU0ZFUl9UWVBFID0gJ2NvcHknCgogICAgZGVmIF9nZXRfc3JjX2Rlc3Qoc2VsZiwgZnV0dXJlKToKICAgICAgICBjYWxsX2FyZ3MgPSBmdXR1cmUubWV0YS5jYWxsX2FyZ3MKICAgICAgICBjb3B5X3NvdXJjZSA9IGNhbGxfYXJncy5jb3B5X3NvdXJjZQogICAgICAgIHNyYyA9ICdzMzovLycgKyBjb3B5X3NvdXJjZVsnQnVja2V0J10gKyAnLycgKyBjb3B5X3NvdXJjZVsnS2V5J10KICAgICAgICBkZXN0ID0gJ3MzOi8vJyArIGNhbGxfYXJncy5idWNrZXQgKyAnLycgKyBjYWxsX2FyZ3Mua2V5CiAgICAgICAgcmV0dXJuIHNyYywgZGVzdAoKCmNsYXNzIERlbGV0ZVJlc3VsdFN1YnNjcmliZXIoQmFzZVJlc3VsdFN1YnNjcmliZXIpOgogICAgVFJBTlNGRVJfVFlQRSA9ICdkZWxldGUnCgogICAgZGVmIF9nZXRfc3JjX2Rlc3Qoc2VsZiwgZnV0dXJlKToKICAgICAgICBjYWxsX2FyZ3MgPSBmdXR1cmUubWV0YS5jYWxsX2FyZ3MKICAgICAgICBzcmMgPSAnczM6Ly8nICsgY2FsbF9hcmdzLmJ1Y2tldCArICcvJyArIGNhbGxfYXJncy5rZXkKICAgICAgICByZXR1cm4gc3JjLCBOb25lCgoKY2xhc3MgQmFzZVJlc3VsdEhhbmRsZXIob2JqZWN0KToKICAgICIiIkJhc2UgaGFuZGxlciBjbGFzcyB0byBiZSBjYWxsZWQgaW4gdGhlIFJlc3VsdFByb2Nlc3NvciIiIgogICAgZGVmIF9fY2FsbF9fKHNlbGYsIHJlc3VsdCk6CiAgICAgICAgcmFpc2UgTm90SW1wbGVtZW50ZWRFcnJvcignX19jYWxsX18oKScpCgoKY2xhc3MgUmVzdWx0UmVjb3JkZXIoQmFzZVJlc3VsdEhhbmRsZXIpOgogICAgIiIiUmVjb3JkcyBhbmQgdHJhY2sgdHJhbnNmZXIgc3RhdGlzdGljcyBiYXNlZCBvbiByZXN1bHRzIHJlY2VpdmVkIiIiCiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5ieXRlc190cmFuc2ZlcnJlZCA9IDAKICAgICAgICBzZWxmLmJ5dGVzX2ZhaWxlZF90b190cmFuc2ZlciA9IDAKICAgICAgICBzZWxmLmZpbGVzX3RyYW5zZmVycmVkID0gMAogICAgICAgIHNlbGYuZmlsZXNfZmFpbGVkID0gMAogICAgICAgIHNlbGYuZmlsZXNfd2FybmVkID0gMAogICAgICAgIHNlbGYuZXJyb3JzID0gMAogICAgICAgIHNlbGYuZXhwZWN0ZWRfYnl0ZXNfdHJhbnNmZXJyZWQgPSAwCiAgICAgICAgc2VsZi5leHBlY3RlZF9maWxlc190cmFuc2ZlcnJlZCA9IDAKICAgICAgICBzZWxmLmZpbmFsX2V4cGVjdGVkX2ZpbGVzX3RyYW5zZmVycmVkID0gTm9uZQoKICAgICAgICBzZWxmLnN0YXJ0X3RpbWUgPSBOb25lCiAgICAgICAgc2VsZi5ieXRlc190cmFuc2Zlcl9zcGVlZCA9IDAKCiAgICAgICAgc2VsZi5fb25nb2luZ19wcm9ncmVzcyA9IGRlZmF1bHRkaWN0KGludCkKICAgICAgICBzZWxmLl9vbmdvaW5nX3RvdGFsX3NpemVzID0ge30KCiAgICAgICAgc2VsZi5fcmVzdWx0X2hhbmRsZXJfbWFwID0gewogICAgICAgICAgICBRdWV1ZWRSZXN1bHQ6IHNlbGYuX3JlY29yZF9xdWV1ZWRfcmVzdWx0LAogICAgICAgICAgICBQcm9ncmVzc1Jlc3VsdDogc2VsZi5fcmVjb3JkX3Byb2dyZXNzX3Jlc3VsdCwKICAgICAgICAgICAgU3VjY2Vzc1Jlc3VsdDogc2VsZi5fcmVjb3JkX3N1Y2Nlc3NfcmVzdWx0LAogICAgICAgICAgICBGYWlsdXJlUmVzdWx0OiBzZWxmLl9yZWNvcmRfZmFpbHVyZV9yZXN1bHQsCiAgICAgICAgICAgIFdhcm5pbmdSZXN1bHQ6IHNlbGYuX3JlY29yZF93YXJuaW5nX3Jlc3VsdCwKICAgICAgICAgICAgRXJyb3JSZXN1bHQ6IHNlbGYuX3JlY29yZF9lcnJvcl9yZXN1bHQsCiAgICAgICAgICAgIEN0cmxDUmVzdWx0OiBzZWxmLl9yZWNvcmRfZXJyb3JfcmVzdWx0LAogICAgICAgICAgICBGaW5hbFRvdGFsU3VibWlzc2lvbnNSZXN1bHQ6IHNlbGYuX3JlY29yZF9maW5hbF9leHBlY3RlZF9maWxlcywKICAgICAgICB9CgogICAgZGVmIGV4cGVjdGVkX3RvdGFsc19hcmVfZmluYWwoc2VsZik6CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgc2VsZi5maW5hbF9leHBlY3RlZF9maWxlc190cmFuc2ZlcnJlZCA9PQogICAgICAgICAgICBzZWxmLmV4cGVjdGVkX2ZpbGVzX3RyYW5zZmVycmVkCiAgICAgICAgKQoKICAgIGRlZiBfX2NhbGxfXyhzZWxmLCByZXN1bHQpOgogICAgICAgICIiIlJlY29yZCB0aGUgcmVzdWx0IG9mIGFuIGluZGl2aWR1YWwgUmVzdWx0IG9iamVjdCIiIgogICAgICAgIHNlbGYuX3Jlc3VsdF9oYW5kbGVyX21hcC5nZXQodHlwZShyZXN1bHQpLCBzZWxmLl9yZWNvcmRfbm9vcCkoCiAgICAgICAgICAgIHJlc3VsdD1yZXN1bHQpCgogICAgZGVmIF9nZXRfb25nb2luZ19kaWN0X2tleShzZWxmLCByZXN1bHQpOgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHJlc3VsdCwgQmFzZVJlc3VsdCk6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAnQW55IHJlc3VsdCB1c2luZyBfZ2V0X29uZ29pbmdfZGljdF9rZXkgbXVzdCBzdWJjbGFzcyBmcm9tICcKICAgICAgICAgICAgICAgICdCYXNlUmVzdWx0LiBQcm92aWRlZCByZXN1bHQgaXMgb2YgdHlwZTogJXMnICUgdHlwZShyZXN1bHQpCiAgICAgICAgICAgICkKICAgICAgICBrZXlfcGFydHMgPSBbXQogICAgICAgIGZvciByZXN1bHRfcHJvcGVydHkgaW4gW3Jlc3VsdC50cmFuc2Zlcl90eXBlLCByZXN1bHQuc3JjLCByZXN1bHQuZGVzdF06CiAgICAgICAgICAgIGlmIHJlc3VsdF9wcm9wZXJ0eSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGtleV9wYXJ0cy5hcHBlbmQoZW5zdXJlX3RleHRfdHlwZShyZXN1bHRfcHJvcGVydHkpKQogICAgICAgIHJldHVybiB1JzonLmpvaW4oa2V5X3BhcnRzKQoKICAgIGRlZiBfcG9wX3Jlc3VsdF9mcm9tX29uZ29pbmdfZGljdHMoc2VsZiwgcmVzdWx0KToKICAgICAgICBvbmdvaW5nX2tleSA9IHNlbGYuX2dldF9vbmdvaW5nX2RpY3Rfa2V5KHJlc3VsdCkKICAgICAgICB0b3RhbF9wcm9ncmVzcyA9IHNlbGYuX29uZ29pbmdfcHJvZ3Jlc3MucG9wKG9uZ29pbmdfa2V5LCAwKQogICAgICAgIHRvdGFsX2ZpbGVfc2l6ZSA9IHNlbGYuX29uZ29pbmdfdG90YWxfc2l6ZXMucG9wKG9uZ29pbmdfa2V5LCBOb25lKQogICAgICAgIHJldHVybiB0b3RhbF9wcm9ncmVzcywgdG90YWxfZmlsZV9zaXplCgogICAgZGVmIF9yZWNvcmRfbm9vcChzZWxmLCAqKmt3YXJncyk6CiAgICAgICAgIyBJZiB0aGUgcmVzdWx0IGRvZXMgbm90IGhhdmUgYSBoYW5kbGVyLCB0aGVuIGRvIG5vdGhpbmcgd2l0aCBpdC4KICAgICAgICBwYXNzCgogICAgZGVmIF9yZWNvcmRfcXVldWVkX3Jlc3VsdChzZWxmLCByZXN1bHQsICoqa3dhcmdzKToKICAgICAgICBpZiBzZWxmLnN0YXJ0X3RpbWUgaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5zdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB0b3RhbF90cmFuc2Zlcl9zaXplID0gcmVzdWx0LnRvdGFsX3RyYW5zZmVyX3NpemUKICAgICAgICBzZWxmLl9vbmdvaW5nX3RvdGFsX3NpemVzWwogICAgICAgICAgICBzZWxmLl9nZXRfb25nb2luZ19kaWN0X2tleShyZXN1bHQpXSA9IHRvdGFsX3RyYW5zZmVyX3NpemUKICAgICAgICAjIFRoZSB0b3RhbCB0cmFuc2ZlciBzaXplIGNhbiBiZSBOb25lIGlmIHdlIGRvIG5vdCBrbm93IHRoZSBzaXplCiAgICAgICAgIyBpbW1lZGlhdGVseSBzbyBkbyBub3QgYWRkIHRvIHRoZSB0b3RhbCByaWdodCBhd2F5LgogICAgICAgIGlmIHRvdGFsX3RyYW5zZmVyX3NpemU6CiAgICAgICAgICAgIHNlbGYuZXhwZWN0ZWRfYnl0ZXNfdHJhbnNmZXJyZWQgKz0gdG90YWxfdHJhbnNmZXJfc2l6ZQogICAgICAgIHNlbGYuZXhwZWN0ZWRfZmlsZXNfdHJhbnNmZXJyZWQgKz0gMQoKICAgIGRlZiBfcmVjb3JkX3Byb2dyZXNzX3Jlc3VsdChzZWxmLCByZXN1bHQsICoqa3dhcmdzKToKICAgICAgICBieXRlc190cmFuc2ZlcnJlZCA9IHJlc3VsdC5ieXRlc190cmFuc2ZlcnJlZAogICAgICAgIHNlbGYuX3VwZGF0ZV9vbmdvaW5nX3RyYW5zZmVyX3NpemVfaWZfdW5rbm93bihyZXN1bHQpCiAgICAgICAgc2VsZi5fb25nb2luZ19wcm9ncmVzc1sKICAgICAgICAgICAgc2VsZi5fZ2V0X29uZ29pbmdfZGljdF9rZXkocmVzdWx0KV0gKz0gYnl0ZXNfdHJhbnNmZXJyZWQKICAgICAgICBzZWxmLmJ5dGVzX3RyYW5zZmVycmVkICs9IGJ5dGVzX3RyYW5zZmVycmVkCiAgICAgICAgIyBTaW5jZSB0aGUgc3RhcnQgdGltZSBpcyBjYXB0dXJlZCBpbiB0aGUgcmVzdWx0IHJlY29yZGVyIGFuZAogICAgICAgICMgY2FwdHVyZSB0aW1lc3RhbXBzIGluIHRoZSBzdWJzY3JpYmVyLCB0aGVyZSBpcyBhIGNoYW5jZSB0aGF0IGlmCiAgICAgICAgIyBhIHByb2dyZXNzIHJlc3VsdCBnZXRzIGNyZWF0ZWQgcmlnaHQgYWZ0ZXIgdGhlIHF1ZXVlZCByZXN1bHQKICAgICAgICAjIGdldHMgY3JlYXRlZCB0aGF0IHRoZSB0aW1lc3RhbXAgb24gdGhlIHByb2dyZXNzIHJlc3VsdCBpcyBsZXNzCiAgICAgICAgIyB0aGFuIHRoZSB0aW1lc3RhbXAgb2Ygd2hlbiB0aGUgcmVzdWx0IHByb2Nlc3NvciBhY3R1YWxseQogICAgICAgICMgcHJvY2Vzc2VzIHRoYXQgaW5pdGlhbCBxdWV1ZWQgcmVzdWx0LiBTbyB0aGlzIHdpbGwgYXZvaWQKICAgICAgICAjIG5lZ2F0aXZlIHByb2dyZXNzIGJlaW5nIGRpc3BsYXllZCBvciB6ZXJvIGRpdmlzaW9uIG9jY3VycmluZy4KICAgICAgICBpZiByZXN1bHQudGltZXN0YW1wID4gc2VsZi5zdGFydF90aW1lOgogICAgICAgICAgICBzZWxmLmJ5dGVzX3RyYW5zZmVyX3NwZWVkID0gc2VsZi5ieXRlc190cmFuc2ZlcnJlZCAvICgKICAgICAgICAgICAgICAgIHJlc3VsdC50aW1lc3RhbXAgLSBzZWxmLnN0YXJ0X3RpbWUpCgogICAgZGVmIF91cGRhdGVfb25nb2luZ190cmFuc2Zlcl9zaXplX2lmX3Vua25vd24oc2VsZiwgcmVzdWx0KToKICAgICAgICAjIFRoaXMgaXMgYSBzcGVjaWFsIGNhc2Ugd2hlbiB0aGUgdHJhbnNmZXIgc2l6ZSB3YXMgcHJldmlvdXMgbm90CiAgICAgICAgIyBrbm93biBidXQgd2FzIHByb3ZpZGVkIGluIGEgcHJvZ3Jlc3MgcmVzdWx0LgogICAgICAgIG9uZ29pbmdfa2V5ID0gc2VsZi5fZ2V0X29uZ29pbmdfZGljdF9rZXkocmVzdWx0KQoKICAgICAgICAjIEZpcnN0LCBjaGVjayBpZiB0aGUgdG90YWwgc2l6ZSBpcyBOb25lLCBtZWFuaW5nIGl0cyBzaXplIGlzCiAgICAgICAgIyBjdXJyZW50bHkgdW5rbm93bi4KICAgICAgICBpZiBzZWxmLl9vbmdvaW5nX3RvdGFsX3NpemVzW29uZ29pbmdfa2V5XSBpcyBOb25lOgogICAgICAgICAgICB0b3RhbF90cmFuc2Zlcl9zaXplID0gcmVzdWx0LnRvdGFsX3RyYW5zZmVyX3NpemUKICAgICAgICAgICAgIyBJZiB0aGUgdG90YWwgc2l6ZSBpcyBubyBsb25nZXIgTm9uZSB0aGF0IG1lYW5zIHdlIGp1c3QgbGVhcm5lZAogICAgICAgICAgICAjIG9mIHRoZSBzaXplIHNvIGxldCdzIHVwZGF0ZSB0aGUgYXBwcm9wcmlhdGUgcGxhY2VzIHdpdGggdGhpcwogICAgICAgICAgICAjIGtub3dsZWRnZQogICAgICAgICAgICBpZiByZXN1bHQudG90YWxfdHJhbnNmZXJfc2l6ZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHNlbGYuX29uZ29pbmdfdG90YWxfc2l6ZXNbb25nb2luZ19rZXldID0gdG90YWxfdHJhbnNmZXJfc2l6ZQogICAgICAgICAgICAgICAgIyBGaWd1cmUgb3V0IGhvdyBtYW55IGJ5dGVzIGhhdmUgYmVlbiB1bmFjY291bnRlZCBmb3IgYXMKICAgICAgICAgICAgICAgICMgdGhlIHJlY29yZGVyIGhhcyBiZWVuIGtlZXBpbmcgdHJhY2sgb2YgaG93IG1hbnkgYnl0ZXMKICAgICAgICAgICAgICAgICMgaXQgaGFzIHNlZW4gc28gZmFyIGFuZCBhZGQgaXQgdG8gdGhlIHRvdGFsIGV4cGVjdGVkIGFtb3VudC4KICAgICAgICAgICAgICAgIG9uZ29pbmdfcHJvZ3Jlc3MgPSBzZWxmLl9vbmdvaW5nX3Byb2dyZXNzW29uZ29pbmdfa2V5XQogICAgICAgICAgICAgICAgdW5hY2NvdW50ZWRfYnl0ZXMgPSB0b3RhbF90cmFuc2Zlcl9zaXplIC0gb25nb2luZ19wcm9ncmVzcwogICAgICAgICAgICAgICAgc2VsZi5leHBlY3RlZF9ieXRlc190cmFuc2ZlcnJlZCArPSB1bmFjY291bnRlZF9ieXRlcwogICAgICAgICAgICAjIElmIHdlIHN0aWxsIGRvIG5vdCBrbm93IHdoYXQgdGhlIHRvdGFsIHRyYW5zZmVyIHNpemUgaXMKICAgICAgICAgICAgIyBqdXN0IHVwZGF0ZSB0aGUgZXhwZWN0ZWQgYnl0ZXMgd2l0aCB0aGUga25vdyBieXRlcyB0cmFuc2ZlcnJlZAogICAgICAgICAgICAjIGFzIHdlIGtub3cgYXQgdGhlIHZlcnkgbGVhc3QsIHRob3NlIGJ5dGVzIGFyZSBleHBlY3RlZC4KICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuZXhwZWN0ZWRfYnl0ZXNfdHJhbnNmZXJyZWQgKz0gcmVzdWx0LmJ5dGVzX3RyYW5zZmVycmVkCgogICAgZGVmIF9yZWNvcmRfc3VjY2Vzc19yZXN1bHQoc2VsZiwgcmVzdWx0LCAqKmt3YXJncyk6CiAgICAgICAgc2VsZi5fcG9wX3Jlc3VsdF9mcm9tX29uZ29pbmdfZGljdHMocmVzdWx0KQogICAgICAgIHNlbGYuZmlsZXNfdHJhbnNmZXJyZWQgKz0gMQoKICAgIGRlZiBfcmVjb3JkX2ZhaWx1cmVfcmVzdWx0KHNlbGYsIHJlc3VsdCwgKiprd2FyZ3MpOgogICAgICAgICMgSWYgdGhlcmUgd2FzIGEgZmFpbHVyZSwgd2Ugd2FudCB0byBhY2NvdW50IGZvciB0aGUgZmFpbHVyZSBpbgogICAgICAgICMgdGhlIGNvdW50IGZvciBieXRlcyB0cmFuc2ZlcnJlZCBieSBqdXN0IGFkZGluZyBvbiB0aGUgcmVtYWluaW5nIGJ5dGVzCiAgICAgICAgIyB0aGF0IGRpZCBub3QgZ2V0IHRyYW5zZmVycmVkLgogICAgICAgIHRvdGFsX3Byb2dyZXNzLCB0b3RhbF9maWxlX3NpemUgPSBzZWxmLl9wb3BfcmVzdWx0X2Zyb21fb25nb2luZ19kaWN0cygKICAgICAgICAgICAgcmVzdWx0KQogICAgICAgIGlmIHRvdGFsX2ZpbGVfc2l6ZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJvZ3Jlc3NfbGVmdCA9IHRvdGFsX2ZpbGVfc2l6ZSAtIHRvdGFsX3Byb2dyZXNzCiAgICAgICAgICAgIHNlbGYuYnl0ZXNfZmFpbGVkX3RvX3RyYW5zZmVyICs9IHByb2dyZXNzX2xlZnQKCiAgICAgICAgc2VsZi5maWxlc19mYWlsZWQgKz0gMQogICAgICAgIHNlbGYuZmlsZXNfdHJhbnNmZXJyZWQgKz0gMQoKICAgIGRlZiBfcmVjb3JkX3dhcm5pbmdfcmVzdWx0KHNlbGYsICoqa3dhcmdzKToKICAgICAgICBzZWxmLmZpbGVzX3dhcm5lZCArPSAxCgogICAgZGVmIF9yZWNvcmRfZXJyb3JfcmVzdWx0KHNlbGYsICoqa3dhcmdzKToKICAgICAgICBzZWxmLmVycm9ycyArPSAxCgogICAgZGVmIF9yZWNvcmRfZmluYWxfZXhwZWN0ZWRfZmlsZXMoc2VsZiwgcmVzdWx0LCAqKmt3YXJncyk6CiAgICAgICAgc2VsZi5maW5hbF9leHBlY3RlZF9maWxlc190cmFuc2ZlcnJlZCA9IHJlc3VsdC50b3RhbF9zdWJtaXNzaW9ucwoKCmNsYXNzIFJlc3VsdFByaW50ZXIoQmFzZVJlc3VsdEhhbmRsZXIpOgogICAgX0ZJTEVTX1JFTUFJTklORyA9ICJ7cmVtYWluaW5nX2ZpbGVzfSBmaWxlKHMpIHJlbWFpbmluZyIKICAgIF9FU1RJTUFURURfRVhQRUNURURfVE9UQUwgPSAifntleHBlY3RlZF90b3RhbH0iCiAgICBfU1RJTExfQ0FMQ1VMQVRJTkdfVE9UQUxTID0gIiAoY2FsY3VsYXRpbmcuLi4pIgogICAgQllURV9QUk9HUkVTU19GT1JNQVQgPSAoCiAgICAgICAgJ0NvbXBsZXRlZCB7Ynl0ZXNfY29tcGxldGVkfS97ZXhwZWN0ZWRfYnl0ZXNfY29tcGxldGVkfSAnCiAgICAgICAgJyh7dHJhbnNmZXJfc3BlZWR9KSB3aXRoICcgKyBfRklMRVNfUkVNQUlOSU5HCiAgICApCiAgICBGSUxFX1BST0dSRVNTX0ZPUk1BVCA9ICgKICAgICAgICAnQ29tcGxldGVkIHtmaWxlc19jb21wbGV0ZWR9IGZpbGUocykgd2l0aCAnICsgX0ZJTEVTX1JFTUFJTklORwogICAgKQogICAgU1VDQ0VTU19GT1JNQVQgPSAoCiAgICAgICAgdSd7dHJhbnNmZXJfdHlwZX06IHt0cmFuc2Zlcl9sb2NhdGlvbn0nCiAgICApCiAgICBEUllfUlVOX0ZPUk1BVCA9IHUnKGRyeXJ1bikgJyArIFNVQ0NFU1NfRk9STUFUCiAgICBGQUlMVVJFX0ZPUk1BVCA9ICgKICAgICAgICB1J3t0cmFuc2Zlcl90eXBlfSBmYWlsZWQ6IHt0cmFuc2Zlcl9sb2NhdGlvbn0ge2V4Y2VwdGlvbn0nCiAgICApCiAgICAjIFRPRE86IEFkZCAid2FybmluZzogIiBwcmVmaXggb25jZSBhbGwgY29tbWFuZHMgYXJlIGNvbnZlcnRlZCB0byB1c2luZwogICAgIyByZXN1bHQgcHJpbnRlciBhbmQgcmVtb3ZlICJ3YXJuaW5nOiAiIHByZWZpeCBmcm9tIGBgY3JlYXRlX3dhcm5pbmdgYC4KICAgIFdBUk5JTkdfRk9STUFUID0gKAogICAgICAgIHUne21lc3NhZ2V9JwogICAgKQogICAgRVJST1JfRk9STUFUID0gKAogICAgICAgIHUnZmF0YWwgZXJyb3I6IHtleGNlcHRpb259JwogICAgKQogICAgQ1RSTF9DX01TRyA9ICdjYW5jZWxsZWQ6IGN0cmwtYyByZWNlaXZlZCcKCiAgICBTUkNfREVTVF9UUkFOU0ZFUl9MT0NBVElPTl9GT1JNQVQgPSB1J3tzcmN9IHRvIHtkZXN0fScKICAgIFNSQ19UUkFOU0ZFUl9MT0NBVElPTl9GT1JNQVQgPSB1J3tzcmN9JwoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCByZXN1bHRfcmVjb3JkZXIsIG91dF9maWxlPU5vbmUsIGVycm9yX2ZpbGU9Tm9uZSk6CiAgICAgICAgIiIiUHJpbnRzIHN0YXR1cyBvZiBvbmdvaW5nIHRyYW5zZmVyCgogICAgICAgIDp0eXBlIHJlc3VsdF9yZWNvcmRlcjogUmVzdWx0UmVjb3JkZXIKICAgICAgICA6cGFyYW0gcmVzdWx0X3JlY29yZGVyOiBUaGUgYXNzb2NpYXRlZCByZXN1bHQgcmVjb3JkZXIKCiAgICAgICAgOnR5cGUgb3V0X2ZpbGU6IGZpbGUtbGlrZSBvYmoKICAgICAgICA6cGFyYW0gb3V0X2ZpbGU6IExvY2F0aW9uIHRvIHdyaXRlIHByb2dyZXNzIGFuZCBzdWNjZXNzIHN0YXRlbWVudHMuCiAgICAgICAgICAgIEJ5IGRlZmF1bHQsIHRoZSBsb2NhdGlvbiBpcyBzeXMuc3Rkb3V0LgoKICAgICAgICA6dHlwZSBlcnJvcl9maWxlOiBmaWxlLWxpa2Ugb2JqCiAgICAgICAgOnBhcmFtIGVycm9yX2ZpbGU6IExvY2F0aW9uIHRvIHdyaXRlIHdhcm5pbmdzIGFuZCBlcnJvcnMuCiAgICAgICAgICAgIEJ5IGRlZmF1bHQsIHRoZSBsb2NhdGlvbiBpcyBzeXMuc3RkZXJyLgogICAgICAgICIiIgogICAgICAgIHNlbGYuX3Jlc3VsdF9yZWNvcmRlciA9IHJlc3VsdF9yZWNvcmRlcgogICAgICAgIHNlbGYuX291dF9maWxlID0gb3V0X2ZpbGUKICAgICAgICBpZiBzZWxmLl9vdXRfZmlsZSBpcyBOb25lOgogICAgICAgICAgICBzZWxmLl9vdXRfZmlsZSA9IHN5cy5zdGRvdXQKICAgICAgICBzZWxmLl9lcnJvcl9maWxlID0gZXJyb3JfZmlsZQogICAgICAgIGlmIHNlbGYuX2Vycm9yX2ZpbGUgaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5fZXJyb3JfZmlsZSA9IHN5cy5zdGRlcnIKICAgICAgICBzZWxmLl9wcm9ncmVzc19sZW5ndGggPSAwCiAgICAgICAgc2VsZi5fcmVzdWx0X2hhbmRsZXJfbWFwID0gewogICAgICAgICAgICBQcm9ncmVzc1Jlc3VsdDogc2VsZi5fcHJpbnRfcHJvZ3Jlc3MsCiAgICAgICAgICAgIFN1Y2Nlc3NSZXN1bHQ6IHNlbGYuX3ByaW50X3N1Y2Nlc3MsCiAgICAgICAgICAgIEZhaWx1cmVSZXN1bHQ6IHNlbGYuX3ByaW50X2ZhaWx1cmUsCiAgICAgICAgICAgIFdhcm5pbmdSZXN1bHQ6IHNlbGYuX3ByaW50X3dhcm5pbmcsCiAgICAgICAgICAgIEVycm9yUmVzdWx0OiBzZWxmLl9wcmludF9lcnJvciwKICAgICAgICAgICAgQ3RybENSZXN1bHQ6IHNlbGYuX3ByaW50X2N0cmxfYywKICAgICAgICAgICAgRHJ5UnVuUmVzdWx0OiBzZWxmLl9wcmludF9kcnlfcnVuLAogICAgICAgICAgICBGaW5hbFRvdGFsU3VibWlzc2lvbnNSZXN1bHQ6CiAgICAgICAgICAgICAgICBzZWxmLl9jbGVhcl9wcm9ncmVzc19pZl9ub19tb3JlX2V4cGVjdGVkX3RyYW5zZmVycywKICAgICAgICB9CgogICAgZGVmIF9fY2FsbF9fKHNlbGYsIHJlc3VsdCk6CiAgICAgICAgIiIiUHJpbnQgdGhlIHByb2dyZXNzIG9mIHRoZSBvbmdvaW5nIHRyYW5zZmVyIGJhc2VkIG9uIGEgcmVzdWx0IiIiCiAgICAgICAgc2VsZi5fcmVzdWx0X2hhbmRsZXJfbWFwLmdldCh0eXBlKHJlc3VsdCksIHNlbGYuX3ByaW50X25vb3ApKAogICAgICAgICAgICByZXN1bHQ9cmVzdWx0KQoKICAgIGRlZiBfcHJpbnRfbm9vcChzZWxmLCAqKmt3YXJncyk6CiAgICAgICAgIyBJZiB0aGUgcmVzdWx0IGRvZXMgbm90IGhhdmUgYSBoYW5kbGVyLCB0aGVuIGRvIG5vdGhpbmcgd2l0aCBpdC4KICAgICAgICBwYXNzCgogICAgZGVmIF9wcmludF9kcnlfcnVuKHNlbGYsIHJlc3VsdCwgKiprd2FyZ3MpOgogICAgICAgIHN0YXRlbWVudCA9IHNlbGYuRFJZX1JVTl9GT1JNQVQuZm9ybWF0KAogICAgICAgICAgICB0cmFuc2Zlcl90eXBlPXJlc3VsdC50cmFuc2Zlcl90eXBlLAogICAgICAgICAgICB0cmFuc2Zlcl9sb2NhdGlvbj1zZWxmLl9nZXRfdHJhbnNmZXJfbG9jYXRpb24ocmVzdWx0KQogICAgICAgICkKICAgICAgICBzdGF0ZW1lbnQgPSBzZWxmLl9hZGp1c3Rfc3RhdGVtZW50X3BhZGRpbmcoc3RhdGVtZW50KQogICAgICAgIHNlbGYuX3ByaW50X3RvX291dF9maWxlKHN0YXRlbWVudCkKCiAgICBkZWYgX3ByaW50X3N1Y2Nlc3Moc2VsZiwgcmVzdWx0LCAqKmt3YXJncyk6CiAgICAgICAgc3VjY2Vzc19zdGF0ZW1lbnQgPSBzZWxmLlNVQ0NFU1NfRk9STUFULmZvcm1hdCgKICAgICAgICAgICAgdHJhbnNmZXJfdHlwZT1yZXN1bHQudHJhbnNmZXJfdHlwZSwKICAgICAgICAgICAgdHJhbnNmZXJfbG9jYXRpb249c2VsZi5fZ2V0X3RyYW5zZmVyX2xvY2F0aW9uKHJlc3VsdCkKICAgICAgICApCiAgICAgICAgc3VjY2Vzc19zdGF0ZW1lbnQgPSBzZWxmLl9hZGp1c3Rfc3RhdGVtZW50X3BhZGRpbmcoc3VjY2Vzc19zdGF0ZW1lbnQpCiAgICAgICAgc2VsZi5fcHJpbnRfdG9fb3V0X2ZpbGUoc3VjY2Vzc19zdGF0ZW1lbnQpCiAgICAgICAgc2VsZi5fcmVkaXNwbGF5X3Byb2dyZXNzKCkKCiAgICBkZWYgX3ByaW50X2ZhaWx1cmUoc2VsZiwgcmVzdWx0LCAqKmt3YXJncyk6CiAgICAgICAgZmFpbHVyZV9zdGF0ZW1lbnQgPSBzZWxmLkZBSUxVUkVfRk9STUFULmZvcm1hdCgKICAgICAgICAgICAgdHJhbnNmZXJfdHlwZT1yZXN1bHQudHJhbnNmZXJfdHlwZSwKICAgICAgICAgICAgdHJhbnNmZXJfbG9jYXRpb249c2VsZi5fZ2V0X3RyYW5zZmVyX2xvY2F0aW9uKHJlc3VsdCksCiAgICAgICAgICAgIGV4Y2VwdGlvbj1yZXN1bHQuZXhjZXB0aW9uCiAgICAgICAgKQogICAgICAgIGZhaWx1cmVfc3RhdGVtZW50ID0gc2VsZi5fYWRqdXN0X3N0YXRlbWVudF9wYWRkaW5nKGZhaWx1cmVfc3RhdGVtZW50KQogICAgICAgIHNlbGYuX3ByaW50X3RvX2Vycm9yX2ZpbGUoZmFpbHVyZV9zdGF0ZW1lbnQpCiAgICAgICAgc2VsZi5fcmVkaXNwbGF5X3Byb2dyZXNzKCkKCiAgICBkZWYgX3ByaW50X3dhcm5pbmcoc2VsZiwgcmVzdWx0LCAqKmt3YXJncyk6CiAgICAgICAgd2FybmluZ19zdGF0ZW1lbnQgPSBzZWxmLldBUk5JTkdfRk9STUFULmZvcm1hdChtZXNzYWdlPXJlc3VsdC5tZXNzYWdlKQogICAgICAgIHdhcm5pbmdfc3RhdGVtZW50ID0gc2VsZi5fYWRqdXN0X3N0YXRlbWVudF9wYWRkaW5nKHdhcm5pbmdfc3RhdGVtZW50KQogICAgICAgIHNlbGYuX3ByaW50X3RvX2Vycm9yX2ZpbGUod2FybmluZ19zdGF0ZW1lbnQpCiAgICAgICAgc2VsZi5fcmVkaXNwbGF5X3Byb2dyZXNzKCkKCiAgICBkZWYgX3ByaW50X2Vycm9yKHNlbGYsIHJlc3VsdCwgKiprd2FyZ3MpOgogICAgICAgIHNlbGYuX2ZsdXNoX2Vycm9yX3N0YXRlbWVudCgKICAgICAgICAgICAgc2VsZi5FUlJPUl9GT1JNQVQuZm9ybWF0KGV4Y2VwdGlvbj1yZXN1bHQuZXhjZXB0aW9uKSkKCiAgICBkZWYgX3ByaW50X2N0cmxfYyhzZWxmLCByZXN1bHQsICoqa3dhcmdzKToKICAgICAgICBzZWxmLl9mbHVzaF9lcnJvcl9zdGF0ZW1lbnQoc2VsZi5DVFJMX0NfTVNHKQoKICAgIGRlZiBfZmx1c2hfZXJyb3Jfc3RhdGVtZW50KHNlbGYsIGVycm9yX3N0YXRlbWVudCk6CiAgICAgICAgZXJyb3Jfc3RhdGVtZW50ID0gc2VsZi5fYWRqdXN0X3N0YXRlbWVudF9wYWRkaW5nKGVycm9yX3N0YXRlbWVudCkKICAgICAgICBzZWxmLl9wcmludF90b19lcnJvcl9maWxlKGVycm9yX3N0YXRlbWVudCkKCiAgICBkZWYgX2dldF90cmFuc2Zlcl9sb2NhdGlvbihzZWxmLCByZXN1bHQpOgogICAgICAgIGlmIHJlc3VsdC5kZXN0IGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmLlNSQ19UUkFOU0ZFUl9MT0NBVElPTl9GT1JNQVQuZm9ybWF0KHNyYz1yZXN1bHQuc3JjKQogICAgICAgIHJldHVybiBzZWxmLlNSQ19ERVNUX1RSQU5TRkVSX0xPQ0FUSU9OX0ZPUk1BVC5mb3JtYXQoCiAgICAgICAgICAgIHNyYz1yZXN1bHQuc3JjLCBkZXN0PXJlc3VsdC5kZXN0KQoKICAgIGRlZiBfcmVkaXNwbGF5X3Byb2dyZXNzKHNlbGYpOgogICAgICAgICMgUmVzZXQgdG8gemVybyBiZWNhdXNlIGRvbmUgc3RhdGVtZW50cyBhcmUgcHJpbnRlZCB3aXRoIG5ldyBsaW5lcwogICAgICAgICMgbWVhbmluZyB0aGVyZSBhcmUgbm8gY2FycmlhZ2UgcmV0dXJucyB0byB0YWtlIGludG8gYWNjb3VudCB3aGVuCiAgICAgICAgIyBwcmludGluZyB0aGUgbmV4dCBsaW5lLgogICAgICAgIHNlbGYuX3Byb2dyZXNzX2xlbmd0aCA9IDAKICAgICAgICBzZWxmLl9hZGRfcHJvZ3Jlc3NfaWZfbmVlZGVkKCkKCiAgICBkZWYgX2FkZF9wcm9ncmVzc19pZl9uZWVkZWQoc2VsZik6CiAgICAgICAgaWYgc2VsZi5faGFzX3JlbWFpbmluZ19wcm9ncmVzcygpOgogICAgICAgICAgICBzZWxmLl9wcmludF9wcm9ncmVzcygpCgogICAgZGVmIF9wcmludF9wcm9ncmVzcyhzZWxmLCAqKmt3YXJncyk6CiAgICAgICAgIyBHZXQgYWxsIG9mIHRoZSBzdGF0aXN0aWNzIGluIHRoZSBjb3JyZWN0IGZvcm0uCiAgICAgICAgcmVtYWluaW5nX2ZpbGVzID0gc2VsZi5fZ2V0X2V4cGVjdGVkX3RvdGFsKAogICAgICAgICAgICBzdHIoc2VsZi5fcmVzdWx0X3JlY29yZGVyLmV4cGVjdGVkX2ZpbGVzX3RyYW5zZmVycmVkIC0KICAgICAgICAgICAgICAgIHNlbGYuX3Jlc3VsdF9yZWNvcmRlci5maWxlc190cmFuc2ZlcnJlZCkKICAgICAgICApCgogICAgICAgICMgQ3JlYXRlIHRoZSBkaXNwbGF5IHN0YXRlbWVudC4KICAgICAgICBpZiBzZWxmLl9yZXN1bHRfcmVjb3JkZXIuZXhwZWN0ZWRfYnl0ZXNfdHJhbnNmZXJyZWQgPiAwOgogICAgICAgICAgICBieXRlc19jb21wbGV0ZWQgPSBodW1hbl9yZWFkYWJsZV9zaXplKAogICAgICAgICAgICAgICAgc2VsZi5fcmVzdWx0X3JlY29yZGVyLmJ5dGVzX3RyYW5zZmVycmVkICsKICAgICAgICAgICAgICAgIHNlbGYuX3Jlc3VsdF9yZWNvcmRlci5ieXRlc19mYWlsZWRfdG9fdHJhbnNmZXIKICAgICAgICAgICAgKQogICAgICAgICAgICBleHBlY3RlZF9ieXRlc19jb21wbGV0ZWQgPSBzZWxmLl9nZXRfZXhwZWN0ZWRfdG90YWwoCiAgICAgICAgICAgICAgICBodW1hbl9yZWFkYWJsZV9zaXplKAogICAgICAgICAgICAgICAgICAgIHNlbGYuX3Jlc3VsdF9yZWNvcmRlci5leHBlY3RlZF9ieXRlc190cmFuc2ZlcnJlZCkpCgogICAgICAgICAgICB0cmFuc2Zlcl9zcGVlZCA9IGh1bWFuX3JlYWRhYmxlX3NpemUoCiAgICAgICAgICAgICAgICBzZWxmLl9yZXN1bHRfcmVjb3JkZXIuYnl0ZXNfdHJhbnNmZXJfc3BlZWQpICsgJy9zJwogICAgICAgICAgICBwcm9ncmVzc19zdGF0ZW1lbnQgPSBzZWxmLkJZVEVfUFJPR1JFU1NfRk9STUFULmZvcm1hdCgKICAgICAgICAgICAgICAgIGJ5dGVzX2NvbXBsZXRlZD1ieXRlc19jb21wbGV0ZWQsCiAgICAgICAgICAgICAgICBleHBlY3RlZF9ieXRlc19jb21wbGV0ZWQ9ZXhwZWN0ZWRfYnl0ZXNfY29tcGxldGVkLAogICAgICAgICAgICAgICAgdHJhbnNmZXJfc3BlZWQ9dHJhbnNmZXJfc3BlZWQsCiAgICAgICAgICAgICAgICByZW1haW5pbmdfZmlsZXM9cmVtYWluaW5nX2ZpbGVzCiAgICAgICAgICAgICkKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIFdlJ3JlIG5vdCBleHBlY3RpbmcgYW55IGJ5dGVzIHRvIGJlIHRyYW5zZmVycmVkLCBzbyB3ZSBzaG91bGQKICAgICAgICAgICAgIyBvbmx5IHByaW50IG9mIGluZm9ybWF0aW9uIGFib3V0IG51bWJlciBvZiBmaWxlcyB0cmFuc2ZlcnJlZC4KICAgICAgICAgICAgcHJvZ3Jlc3Nfc3RhdGVtZW50ID0gc2VsZi5GSUxFX1BST0dSRVNTX0ZPUk1BVC5mb3JtYXQoCiAgICAgICAgICAgICAgICBmaWxlc19jb21wbGV0ZWQ9c2VsZi5fcmVzdWx0X3JlY29yZGVyLmZpbGVzX3RyYW5zZmVycmVkLAogICAgICAgICAgICAgICAgcmVtYWluaW5nX2ZpbGVzPXJlbWFpbmluZ19maWxlcwogICAgICAgICAgICApCgogICAgICAgIGlmIG5vdCBzZWxmLl9yZXN1bHRfcmVjb3JkZXIuZXhwZWN0ZWRfdG90YWxzX2FyZV9maW5hbCgpOgogICAgICAgICAgICBwcm9ncmVzc19zdGF0ZW1lbnQgKz0gc2VsZi5fU1RJTExfQ0FMQ1VMQVRJTkdfVE9UQUxTCgogICAgICAgICMgTWFrZSBzdXJlIHRoYXQgaXQgb3ZlcnJpZGVzIGFueSBwcmV2aW91cyBwcm9ncmVzcyBiYXIuCiAgICAgICAgcHJvZ3Jlc3Nfc3RhdGVtZW50ID0gc2VsZi5fYWRqdXN0X3N0YXRlbWVudF9wYWRkaW5nKAogICAgICAgICAgICAgICAgcHJvZ3Jlc3Nfc3RhdGVtZW50LCBlbmRpbmdfY2hhcj0nXHInKQogICAgICAgICMgV2UgZG8gbm90IHdhbnQgdG8gaW5jbHVkZSB0aGUgY2FycmlhZ2UgcmV0dXJuIGluIHRoaXMgY2FsY3VsYXRpb24KICAgICAgICAjIGFzIHByb2dyZXNzIGxlbmd0aCBpcyB1c2VkIGZvciBkZXRlcm1pbmluZyB3aGl0ZXNwYWNlIHBhZGRpbmcuCiAgICAgICAgIyBTbyB3ZSBzdWJ0cmFjdCBvbmUgb2ZmIG9mIHRoZSBsZW5ndGguCiAgICAgICAgc2VsZi5fcHJvZ3Jlc3NfbGVuZ3RoID0gbGVuKHByb2dyZXNzX3N0YXRlbWVudCkgLSAxCgogICAgICAgICMgUHJpbnQgdGhlIHByb2dyZXNzIG91dC4KICAgICAgICBzZWxmLl9wcmludF90b19vdXRfZmlsZShwcm9ncmVzc19zdGF0ZW1lbnQpCgogICAgZGVmIF9nZXRfZXhwZWN0ZWRfdG90YWwoc2VsZiwgZXhwZWN0ZWRfdG90YWwpOgogICAgICAgIGlmIG5vdCBzZWxmLl9yZXN1bHRfcmVjb3JkZXIuZXhwZWN0ZWRfdG90YWxzX2FyZV9maW5hbCgpOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fRVNUSU1BVEVEX0VYUEVDVEVEX1RPVEFMLmZvcm1hdCgKICAgICAgICAgICAgICAgIGV4cGVjdGVkX3RvdGFsPWV4cGVjdGVkX3RvdGFsKQogICAgICAgIHJldHVybiBleHBlY3RlZF90b3RhbAoKICAgIGRlZiBfYWRqdXN0X3N0YXRlbWVudF9wYWRkaW5nKHNlbGYsIHByaW50X3N0YXRlbWVudCwgZW5kaW5nX2NoYXI9J1xuJyk6CiAgICAgICAgcHJpbnRfc3RhdGVtZW50ID0gcHJpbnRfc3RhdGVtZW50LmxqdXN0KHNlbGYuX3Byb2dyZXNzX2xlbmd0aCwgJyAnKQogICAgICAgIHJldHVybiBwcmludF9zdGF0ZW1lbnQgKyBlbmRpbmdfY2hhcgoKICAgIGRlZiBfaGFzX3JlbWFpbmluZ19wcm9ncmVzcyhzZWxmKToKICAgICAgICBpZiBub3Qgc2VsZi5fcmVzdWx0X3JlY29yZGVyLmV4cGVjdGVkX3RvdGFsc19hcmVfZmluYWwoKToKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBhY3R1YWwgPSBzZWxmLl9yZXN1bHRfcmVjb3JkZXIuZmlsZXNfdHJhbnNmZXJyZWQKICAgICAgICBleHBlY3RlZCA9IHNlbGYuX3Jlc3VsdF9yZWNvcmRlci5leHBlY3RlZF9maWxlc190cmFuc2ZlcnJlZAogICAgICAgIHJldHVybiBhY3R1YWwgIT0gZXhwZWN0ZWQKCiAgICBkZWYgX3ByaW50X3RvX291dF9maWxlKHNlbGYsIHN0YXRlbWVudCk6CiAgICAgICAgdW5pX3ByaW50KHN0YXRlbWVudCwgc2VsZi5fb3V0X2ZpbGUpCgogICAgZGVmIF9wcmludF90b19lcnJvcl9maWxlKHNlbGYsIHN0YXRlbWVudCk6CiAgICAgICAgdW5pX3ByaW50KHN0YXRlbWVudCwgc2VsZi5fZXJyb3JfZmlsZSkKCiAgICBkZWYgX2NsZWFyX3Byb2dyZXNzX2lmX25vX21vcmVfZXhwZWN0ZWRfdHJhbnNmZXJzKHNlbGYsICoqa3dhcmdzKToKICAgICAgICBpZiBzZWxmLl9wcm9ncmVzc19sZW5ndGggYW5kIG5vdCBzZWxmLl9oYXNfcmVtYWluaW5nX3Byb2dyZXNzKCk6CiAgICAgICAgICAgIHVuaV9wcmludChzZWxmLl9hZGp1c3Rfc3RhdGVtZW50X3BhZGRpbmcoJycpLCBzZWxmLl9vdXRfZmlsZSkKCgpjbGFzcyBOb1Byb2dyZXNzUmVzdWx0UHJpbnRlcihSZXN1bHRQcmludGVyKToKICAgICIiIkEgcmVzdWx0IHByaW50ZXIgdGhhdCBkb2Vzbid0IHByaW50IHByb2dyZXNzIiIiCiAgICBkZWYgX3ByaW50X3Byb2dyZXNzKHNlbGYsICoqa3dhcmdzKToKICAgICAgICBwYXNzCgoKY2xhc3MgT25seVNob3dFcnJvcnNSZXN1bHRQcmludGVyKFJlc3VsdFByaW50ZXIpOgogICAgIiIiQSByZXN1bHQgcHJpbnRlciB0aGF0IG9ubHkgcHJpbnRzIG91dCBlcnJvcnMiIiIKICAgIGRlZiBfcHJpbnRfcHJvZ3Jlc3Moc2VsZiwgKiprd2FyZ3MpOgogICAgICAgIHBhc3MKCiAgICBkZWYgX3ByaW50X3N1Y2Nlc3Moc2VsZiwgcmVzdWx0LCAqKmt3YXJncyk6CiAgICAgICAgcGFzcwoKCmNsYXNzIFJlc3VsdFByb2Nlc3Nvcih0aHJlYWRpbmcuVGhyZWFkKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCByZXN1bHRfcXVldWUsIHJlc3VsdF9oYW5kbGVycz1Ob25lKToKICAgICAgICAiIiJUaHJlYWQgdG8gcHJvY2VzcyByZXN1bHRzIGZyb20gcmVzdWx0IHF1ZXVlCgogICAgICAgIFRoaXMgaW5jbHVkZXMgcmVjb3JkaW5nIHN0YXRpc3RpY3MgYW5kIHByaW50aW5nIHRyYW5zZmVyIHN0YXR1cwoKICAgICAgICA6cGFyYW0gcmVzdWx0X3F1ZXVlOiBUaGUgcmVzdWx0IHF1ZXVlIHRvIHByb2Nlc3MgcmVzdWx0cyBmcm9tCiAgICAgICAgOnBhcmFtIHJlc3VsdF9oYW5kbGVyczogQSBsaXN0IG9mIGNhbGxhYmxlcyB0aGF0IHRha2UgYSByZXN1bHQgaW4gYXMKICAgICAgICAgICAgYSBwYXJhbWV0ZXIgdG8gcHJvY2VzcyB0aGUgcmVzdWx0IGZvciB0aGF0IGhhbmRsZXIuCiAgICAgICAgIiIiCiAgICAgICAgdGhyZWFkaW5nLlRocmVhZC5fX2luaXRfXyhzZWxmKQogICAgICAgIHNlbGYuX3Jlc3VsdF9xdWV1ZSA9IHJlc3VsdF9xdWV1ZQogICAgICAgIHNlbGYuX3Jlc3VsdF9oYW5kbGVycyA9IHJlc3VsdF9oYW5kbGVycwogICAgICAgIGlmIHNlbGYuX3Jlc3VsdF9oYW5kbGVycyBpcyBOb25lOgogICAgICAgICAgICBzZWxmLl9yZXN1bHRfaGFuZGxlcnMgPSBbXQogICAgICAgIHNlbGYuX3Jlc3VsdF9oYW5kbGVyc19lbmFibGVkID0gVHJ1ZQoKICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi5fcmVzdWx0X3F1ZXVlLmdldChUcnVlKQogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXN1bHQsIFNodXRkb3duVGhyZWFkUmVxdWVzdCk6CiAgICAgICAgICAgICAgICAgICAgTE9HR0VSLmRlYnVnKAogICAgICAgICAgICAgICAgICAgICAgICAnU2h1dGRvd24gcmVxdWVzdCByZWNlaXZlZCBpbiByZXN1bHQgcHJvY2Vzc2luZyAnCiAgICAgICAgICAgICAgICAgICAgICAgICd0aHJlYWQsIHNodXR0aW5nIGRvd24gcmVzdWx0IHRocmVhZC4nKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBpZiBzZWxmLl9yZXN1bHRfaGFuZGxlcnNfZW5hYmxlZDoKICAgICAgICAgICAgICAgICAgICBzZWxmLl9wcm9jZXNzX3Jlc3VsdChyZXN1bHQpCiAgICAgICAgICAgICAgICAjIEVycm9yUmVzdWx0cyBhcmUgZmF0YWwgdG8gdGhlIGNvbW1hbmQuIElmIGEgZmF0YWwgZXJyb3IKICAgICAgICAgICAgICAgICMgaXMgc2Vlbiwgd2Uga25vdyB0aGF0IHRoZSBjb21tYW5kIGlzIHRyeWluZyB0byBzaHV0ZG93bgogICAgICAgICAgICAgICAgIyBzbyBkaXNhYmxlIGFsbCBvZiB0aGUgaGFuZGxlcnMgYW5kIHF1aWNrbHkgY29uc3VtZSBhbGwKICAgICAgICAgICAgICAgICMgb2YgdGhlIHJlc3VsdHMgaW4gdGhlIHJlc3VsdCBxdWV1ZSBpbiBvcmRlciB0byBnZXQgdG8KICAgICAgICAgICAgICAgICMgdGhlIHNodXRkb3duIHJlcXVlc3QgdG8gY2xlYW4gdXAgdGhlIHByb2Nlc3MuCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJlc3VsdCwgRXJyb3JSZXN1bHQpOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX3Jlc3VsdF9oYW5kbGVyc19lbmFibGVkID0gRmFsc2UKICAgICAgICAgICAgZXhjZXB0IHF1ZXVlLkVtcHR5OgogICAgICAgICAgICAgICAgcGFzcwoKICAgIGRlZiBfcHJvY2Vzc19yZXN1bHQoc2VsZiwgcmVzdWx0KToKICAgICAgICBmb3IgcmVzdWx0X2hhbmRsZXIgaW4gc2VsZi5fcmVzdWx0X2hhbmRsZXJzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXN1bHRfaGFuZGxlcihyZXN1bHQpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIExPR0dFUi5kZWJ1ZygKICAgICAgICAgICAgICAgICAgICAnRXJyb3IgcHJvY2Vzc2luZyByZXN1bHQgJXMgd2l0aCBoYW5kbGVyICVzOiAlcycsCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LCByZXN1bHRfaGFuZGxlciwgZSwgZXhjX2luZm89VHJ1ZSkKCgpjbGFzcyBDb21tYW5kUmVzdWx0UmVjb3JkZXIob2JqZWN0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCByZXN1bHRfcXVldWUsIHJlc3VsdF9yZWNvcmRlciwgcmVzdWx0X3Byb2Nlc3Nvcik6CiAgICAgICAgIiIiUmVjb3JkcyB0aGUgcmVzdWx0IGZvciBhbiBlbnRpcmUgY29tbWFuZAoKICAgICAgICBJdCB3aWxsIGZ1bGx5IHByb2Nlc3MgYWxsIHJlc3VsdHMgaW4gYSByZXN1bHQgcXVldWUgYW5kIGRldGVybWluZQogICAgICAgIGEgQ29tbWFuZFJlc3VsdCByZXByZXNlbnRpbmcgdGhlIGVudGlyZSBjb21tYW5kLgoKICAgICAgICA6dHlwZSByZXN1bHRfcXVldWU6IHF1ZXVlLlF1ZXVlCiAgICAgICAgOnBhcmFtIHJlc3VsdF9xdWV1ZTogVGhlIHJlc3VsdCBxdWV1ZSBpbiB3aGljaCByZXN1bHRzIGFyZSBwbGFjZWQgb24KICAgICAgICAgICAgYW5kIHByb2Nlc3NlZCBmcm9tCgogICAgICAgIDp0eXBlIHJlc3VsdF9yZWNvcmRlcjogUmVzdWx0UmVjb3JkZXIKICAgICAgICA6cGFyYW0gcmVzdWx0X3JlY29yZGVyOiBUaGUgcmVzdWx0IHJlY29yZGVyIHRvIHRyYWNrIHRoZSB2YXJpb3VzCiAgICAgICAgICAgIHJlc3VsdHMgc2VudCB0aHJvdWdoIHRoZSByZXN1bHQgcXVldWUKCiAgICAgICAgOnR5cGUgcmVzdWx0X3Byb2Nlc3NvcjogUmVzdWx0UHJvY2Vzc29yCiAgICAgICAgOnBhcmFtIHJlc3VsdF9wcm9jZXNzb3I6IFRoZSByZXN1bHQgcHJvY2Vzc29yIHRvIHByb2Nlc3MgcmVzdWx0cwogICAgICAgICAgICBwbGFjZWQgb24gdGhlIHF1ZXVlCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5yZXN1bHRfcXVldWUgPSByZXN1bHRfcXVldWUKICAgICAgICBzZWxmLl9yZXN1bHRfcmVjb3JkZXIgPSByZXN1bHRfcmVjb3JkZXIKICAgICAgICBzZWxmLl9yZXN1bHRfcHJvY2Vzc29yID0gcmVzdWx0X3Byb2Nlc3NvcgoKICAgIGRlZiBzdGFydChzZWxmKToKICAgICAgICBzZWxmLl9yZXN1bHRfcHJvY2Vzc29yLnN0YXJ0KCkKCiAgICBkZWYgc2h1dGRvd24oc2VsZik6CiAgICAgICAgc2VsZi5yZXN1bHRfcXVldWUucHV0KFNodXRkb3duVGhyZWFkUmVxdWVzdCgpKQogICAgICAgIHNlbGYuX3Jlc3VsdF9wcm9jZXNzb3Iuam9pbigpCgogICAgZGVmIGdldF9jb21tYW5kX3Jlc3VsdChzZWxmKToKICAgICAgICAiIiJHZXQgdGhlIENvbW1hbmRSZXN1bHQgcmVwcmVzZW50aW5nIHRoZSByZXN1bHQgb2YgYSBjb21tYW5kCgogICAgICAgIDpydHlwZTogQ29tbWFuZFJlc3VsdAogICAgICAgIDpyZXR1cm5zOiBUaGUgQ29tbWFuZFJlc3VsdCByZXByZXNlbnRpbmcgdGhlIHRvdGFsIHJlc3VsdCBmcm9tIHJ1bm5pbmcKICAgICAgICAgICAgYSBwYXJ0aWN1bGFyIGNvbW1hbmQKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gQ29tbWFuZFJlc3VsdCgKICAgICAgICAgICAgc2VsZi5fcmVzdWx0X3JlY29yZGVyLmZpbGVzX2ZhaWxlZCArIHNlbGYuX3Jlc3VsdF9yZWNvcmRlci5lcnJvcnMsCiAgICAgICAgICAgIHNlbGYuX3Jlc3VsdF9yZWNvcmRlci5maWxlc193YXJuZWQKICAgICAgICApCgogICAgZGVmIG5vdGlmeV90b3RhbF9zdWJtaXNzaW9ucyhzZWxmLCB0b3RhbCk6CiAgICAgICAgc2VsZi5yZXN1bHRfcXVldWUucHV0KEZpbmFsVG90YWxTdWJtaXNzaW9uc1Jlc3VsdCh0b3RhbCkpCgogICAgZGVmIF9fZW50ZXJfXyhzZWxmKToKICAgICAgICBzZWxmLnN0YXJ0KCkKICAgICAgICByZXR1cm4gc2VsZgoKICAgIGRlZiBfX2V4aXRfXyhzZWxmLCBleGNfdHlwZSwgZXhjX3ZhbHVlLCAqYXJncyk6CiAgICAgICAgaWYgZXhjX3R5cGU6CiAgICAgICAgICAgIExPR0dFUi5kZWJ1ZygnRXhjZXB0aW9uIGNhdWdodCBkdXJpbmcgY29tbWFuZCBleGVjdXRpb246ICVzJywKICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y192YWx1ZSwgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgc2VsZi5yZXN1bHRfcXVldWUucHV0KEVycm9yUmVzdWx0KGV4Y2VwdGlvbj1leGNfdmFsdWUpKQogICAgICAgICAgICBzZWxmLnNodXRkb3duKCkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBzZWxmLnNodXRkb3duKCkK
