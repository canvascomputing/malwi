statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_openssl/symmetric.py
  contents:
  - name: _calculate_aes_cipher
    score: 0.0
    code: |-
      def _calculate_aes_cipher(key):
          """
          Determines if the key is a valid AES 128, 192 or 256 key

          :param key:
              A byte string of the key to use

          :raises:
              ValueError - when an invalid key is provided

          :return:
              A unicode string of the AES variation - "aes128", "aes192" or "aes256"
          """

          if len(key) not in [16, 24, 32]:
              raise ValueError(pretty_message(
                  '''
                  key must be either 16, 24 or 32 bytes (128, 192 or 256 bits)
                  long - is %s
                  ''',
                  len(key)
              ))

          if len(key) == 16:
              cipher = 'aes128'
          elif len(key) == 24:
              cipher = 'aes192'
          elif len(key) == 32:
              cipher = 'aes256'

          return cipher
    tokens: resume load_global len load_fast key call load_const contains_op pop_jump_if_false TO_NUMBER load_global ValueError load_global pretty_message load_const STRING_LEN_S_ENT_HIGH load_global len load_fast key call call call raise_varargs load_global len load_fast key call load_const INTEGER compare_op == pop_jump_if_false TO_NUMBER load_const aes128 store_fast cipher load_fast cipher return_value load_global len load_fast key call load_const INTEGER compare_op == pop_jump_if_false TO_NUMBER load_const aes192 store_fast cipher load_fast cipher return_value load_global len load_fast key call load_const INTEGER compare_op == pop_jump_if_false TO_NUMBER load_const aes256 store_fast cipher load_fast_check cipher return_value
    hash: 42839dacd818819ca683594629226cfe01d931bcfa803bdeba3e8f6e440b65db
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/pycryptoenv/1.0.7/pycryptoenv-1.0.7/pycryptoenv-1.0.7/pycryptoenv/_openssl/symmetric.py
  : IyBjb2Rpbmc6IHV0Zi04CmZyb20gX19mdXR1cmVfXyBpbXBvcnQgdW5pY29kZV9saXRlcmFscywgZGl2aXNpb24sIGFic29sdXRlX2ltcG9ydCwgcHJpbnRfZnVuY3Rpb24KCmltcG9ydCBtYXRoCgpmcm9tIC4uX2Vycm9ycyBpbXBvcnQgcHJldHR5X21lc3NhZ2UKZnJvbSAuLl9mZmkgaW1wb3J0IG5ldywgbnVsbCwgaXNfbnVsbCwgYnVmZmVyX2Zyb21fYnl0ZXMsIGJ5dGVzX2Zyb21fYnVmZmVyLCBkZXJlZgpmcm9tIC5fbGliY3J5cHRvIGltcG9ydCBsaWJjcnlwdG8sIGxpYmNyeXB0b19sZWdhY3lfc3VwcG9ydCwgTGliY3J5cHRvQ29uc3QsIGhhbmRsZV9vcGVuc3NsX2Vycm9yCmZyb20gLi51dGlsIGltcG9ydCByYW5kX2J5dGVzCmZyb20gLi5fdHlwZXMgaW1wb3J0IHR5cGVfbmFtZSwgYnl0ZV9jbHMKCgpfX2FsbF9fID0gWwogICAgJ2Flc19jYmNfbm9fcGFkZGluZ19kZWNyeXB0JywKICAgICdhZXNfY2JjX25vX3BhZGRpbmdfZW5jcnlwdCcsCiAgICAnYWVzX2NiY19wa2NzN19kZWNyeXB0JywKICAgICdhZXNfY2JjX3BrY3M3X2VuY3J5cHQnLAogICAgJ2Rlc19jYmNfcGtjczVfZGVjcnlwdCcsCiAgICAnZGVzX2NiY19wa2NzNV9lbmNyeXB0JywKICAgICdyYzJfY2JjX3BrY3M1X2RlY3J5cHQnLAogICAgJ3JjMl9jYmNfcGtjczVfZW5jcnlwdCcsCiAgICAncmM0X2RlY3J5cHQnLAogICAgJ3JjNF9lbmNyeXB0JywKICAgICd0cmlwbGVkZXNfY2JjX3BrY3M1X2RlY3J5cHQnLAogICAgJ3RyaXBsZWRlc19jYmNfcGtjczVfZW5jcnlwdCcsCl0KCgpkZWYgYWVzX2NiY19ub19wYWRkaW5nX2VuY3J5cHQoa2V5LCBkYXRhLCBpdik6CiAgICAiIiIKICAgIEVuY3J5cHRzIHBsYWludGV4dCB1c2luZyBBRVMgaW4gQ0JDIG1vZGUgd2l0aCBhIDEyOCwgMTkyIG9yIDI1NiBiaXQga2V5IGFuZAogICAgbm8gcGFkZGluZy4gVGhpcyBtZWFucyB0aGUgY2lwaGVydGV4dCBtdXN0IGJlIGFuIGV4YWN0IG11bHRpcGxlIG9mIDE2IGJ5dGVzCiAgICBsb25nLgoKICAgIDpwYXJhbSBrZXk6CiAgICAgICAgVGhlIGVuY3J5cHRpb24ga2V5IC0gYSBieXRlIHN0cmluZyBlaXRoZXIgMTYsIDI0IG9yIDMyIGJ5dGVzIGxvbmcKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBUaGUgcGxhaW50ZXh0IC0gYSBieXRlIHN0cmluZwoKICAgIDpwYXJhbSBpdjoKICAgICAgICBUaGUgaW5pdGlhbGl6YXRpb24gdmVjdG9yIC0gZWl0aGVyIGEgYnl0ZSBzdHJpbmcgMTYtYnl0ZXMgbG9uZyBvciBOb25lCiAgICAgICAgdG8gZ2VuZXJhdGUgYW4gSVYKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSBPcGVuU1NMCgogICAgOnJldHVybjoKICAgICAgICBBIHR1cGxlIG9mIHR3byBieXRlIHN0cmluZ3MgKGl2LCBjaXBoZXJ0ZXh0KQogICAgIiIiCgogICAgY2lwaGVyID0gX2NhbGN1bGF0ZV9hZXNfY2lwaGVyKGtleSkKCiAgICBpZiBub3QgaXY6CiAgICAgICAgaXYgPSByYW5kX2J5dGVzKDE2KQogICAgZWxpZiBsZW4oaXYpICE9IDE2OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBpdiBtdXN0IGJlIDE2IGJ5dGVzIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihpdikKICAgICAgICApKQoKICAgIGlmIGxlbihkYXRhKSAlIDE2ICE9IDA6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGRhdGEgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDE2IGJ5dGVzIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihkYXRhKQogICAgICAgICkpCgogICAgcmV0dXJuIChpdiwgX2VuY3J5cHQoY2lwaGVyLCBrZXksIGRhdGEsIGl2LCBGYWxzZSkpCgoKZGVmIGFlc19jYmNfbm9fcGFkZGluZ19kZWNyeXB0KGtleSwgZGF0YSwgaXYpOgogICAgIiIiCiAgICBEZWNyeXB0cyBBRVMgY2lwaGVydGV4dCBpbiBDQkMgbW9kZSB1c2luZyBhIDEyOCwgMTkyIG9yIDI1NiBiaXQga2V5IGFuZCBubwogICAgcGFkZGluZy4KCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgZWl0aGVyIDE2LCAyNCBvciAzMiBieXRlcyBsb25nCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIGNpcGhlcnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgLSBhIGJ5dGUgc3RyaW5nIDE2LWJ5dGVzIGxvbmcKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSBPcGVuU1NMCgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBwbGFpbnRleHQKICAgICIiIgoKICAgIGNpcGhlciA9IF9jYWxjdWxhdGVfYWVzX2NpcGhlcihrZXkpCgogICAgaWYgbGVuKGl2KSAhPSAxNjoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgaXYgbXVzdCBiZSAxNiBieXRlcyBsb25nIC0gaXMgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oaXYpCiAgICAgICAgKSkKCiAgICByZXR1cm4gX2RlY3J5cHQoY2lwaGVyLCBrZXksIGRhdGEsIGl2LCBGYWxzZSkKCgpkZWYgYWVzX2NiY19wa2NzN19lbmNyeXB0KGtleSwgZGF0YSwgaXYpOgogICAgIiIiCiAgICBFbmNyeXB0cyBwbGFpbnRleHQgdXNpbmcgQUVTIGluIENCQyBtb2RlIHdpdGggYSAxMjgsIDE5MiBvciAyNTYgYml0IGtleSBhbmQKICAgIFBLQ1MjNyBwYWRkaW5nLgoKICAgIDpwYXJhbSBrZXk6CiAgICAgICAgVGhlIGVuY3J5cHRpb24ga2V5IC0gYSBieXRlIHN0cmluZyBlaXRoZXIgMTYsIDI0IG9yIDMyIGJ5dGVzIGxvbmcKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBUaGUgcGxhaW50ZXh0IC0gYSBieXRlIHN0cmluZwoKICAgIDpwYXJhbSBpdjoKICAgICAgICBUaGUgaW5pdGlhbGl6YXRpb24gdmVjdG9yIC0gZWl0aGVyIGEgYnl0ZSBzdHJpbmcgMTYtYnl0ZXMgbG9uZyBvciBOb25lCiAgICAgICAgdG8gZ2VuZXJhdGUgYW4gSVYKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSBPcGVuU1NMCgogICAgOnJldHVybjoKICAgICAgICBBIHR1cGxlIG9mIHR3byBieXRlIHN0cmluZ3MgKGl2LCBjaXBoZXJ0ZXh0KQogICAgIiIiCgogICAgY2lwaGVyID0gX2NhbGN1bGF0ZV9hZXNfY2lwaGVyKGtleSkKCiAgICBpZiBub3QgaXY6CiAgICAgICAgaXYgPSByYW5kX2J5dGVzKDE2KQogICAgZWxpZiBsZW4oaXYpICE9IDE2OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBpdiBtdXN0IGJlIDE2IGJ5dGVzIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihpdikKICAgICAgICApKQoKICAgIHJldHVybiAoaXYsIF9lbmNyeXB0KGNpcGhlciwga2V5LCBkYXRhLCBpdiwgVHJ1ZSkpCgoKZGVmIGFlc19jYmNfcGtjczdfZGVjcnlwdChrZXksIGRhdGEsIGl2KToKICAgICIiIgogICAgRGVjcnlwdHMgQUVTIGNpcGhlcnRleHQgaW4gQ0JDIG1vZGUgdXNpbmcgYSAxMjgsIDE5MiBvciAyNTYgYml0IGtleQoKICAgIDpwYXJhbSBrZXk6CiAgICAgICAgVGhlIGVuY3J5cHRpb24ga2V5IC0gYSBieXRlIHN0cmluZyBlaXRoZXIgMTYsIDI0IG9yIDMyIGJ5dGVzIGxvbmcKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBUaGUgY2lwaGVydGV4dCAtIGEgYnl0ZSBzdHJpbmcKCiAgICA6cGFyYW0gaXY6CiAgICAgICAgVGhlIGluaXRpYWxpemF0aW9uIHZlY3RvciAtIGEgYnl0ZSBzdHJpbmcgMTYtYnl0ZXMgbG9uZwoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IE9wZW5TU0wKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHBsYWludGV4dAogICAgIiIiCgogICAgY2lwaGVyID0gX2NhbGN1bGF0ZV9hZXNfY2lwaGVyKGtleSkKCiAgICBpZiBsZW4oaXYpICE9IDE2OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBpdiBtdXN0IGJlIDE2IGJ5dGVzIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihpdikKICAgICAgICApKQoKICAgIHJldHVybiBfZGVjcnlwdChjaXBoZXIsIGtleSwgZGF0YSwgaXYsIFRydWUpCgoKZGVmIF9jYWxjdWxhdGVfYWVzX2NpcGhlcihrZXkpOgogICAgIiIiCiAgICBEZXRlcm1pbmVzIGlmIHRoZSBrZXkgaXMgYSB2YWxpZCBBRVMgMTI4LCAxOTIgb3IgMjU2IGtleQoKICAgIDpwYXJhbSBrZXk6CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUga2V5IHRvIHVzZQoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW4gaW52YWxpZCBrZXkgaXMgcHJvdmlkZWQKCiAgICA6cmV0dXJuOgogICAgICAgIEEgdW5pY29kZSBzdHJpbmcgb2YgdGhlIEFFUyB2YXJpYXRpb24gLSAiYWVzMTI4IiwgImFlczE5MiIgb3IgImFlczI1NiIKICAgICIiIgoKICAgIGlmIGxlbihrZXkpIG5vdCBpbiBbMTYsIDI0LCAzMl06CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGtleSBtdXN0IGJlIGVpdGhlciAxNiwgMjQgb3IgMzIgYnl0ZXMgKDEyOCwgMTkyIG9yIDI1NiBiaXRzKQogICAgICAgICAgICBsb25nIC0gaXMgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oa2V5KQogICAgICAgICkpCgogICAgaWYgbGVuKGtleSkgPT0gMTY6CiAgICAgICAgY2lwaGVyID0gJ2FlczEyOCcKICAgIGVsaWYgbGVuKGtleSkgPT0gMjQ6CiAgICAgICAgY2lwaGVyID0gJ2FlczE5MicKICAgIGVsaWYgbGVuKGtleSkgPT0gMzI6CiAgICAgICAgY2lwaGVyID0gJ2FlczI1NicKCiAgICByZXR1cm4gY2lwaGVyCgoKZGVmIHJjNF9lbmNyeXB0KGtleSwgZGF0YSk6CiAgICAiIiIKICAgIEVuY3J5cHRzIHBsYWludGV4dCB1c2luZyBSQzQgd2l0aCBhIDQwLTEyOCBiaXQga2V5CgogICAgOnBhcmFtIGtleToKICAgICAgICBUaGUgZW5jcnlwdGlvbiBrZXkgLSBhIGJ5dGUgc3RyaW5nIDUtMTYgYnl0ZXMgbG9uZwoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIFRoZSBwbGFpbnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgT3BlblNTTAoKICAgIDpyZXR1cm46CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgY2lwaGVydGV4dAogICAgIiIiCgogICAgaWYgbm90IGxpYmNyeXB0b19sZWdhY3lfc3VwcG9ydDoKICAgICAgICByYWlzZSBFbnZpcm9ubWVudEVycm9yKCdPcGVuU1NMIGhhcyBiZWVuIGNvbXBpbGVkIHdpdGhvdXQgUkM0IHN1cHBvcnQnKQoKICAgIGlmIGxlbihrZXkpIDwgNSBvciBsZW4oa2V5KSA+IDE2OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSA1IHRvIDE2IGJ5dGVzICg0MCB0byAxMjggYml0cykgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGtleSkKICAgICAgICApKQoKICAgIHJldHVybiBfZW5jcnlwdCgncmM0Jywga2V5LCBkYXRhLCBOb25lLCBOb25lKQoKCmRlZiByYzRfZGVjcnlwdChrZXksIGRhdGEpOgogICAgIiIiCiAgICBEZWNyeXB0cyBSQzQgY2lwaGVydGV4dCB1c2luZyBhIDQwLTEyOCBiaXQga2V5CgogICAgOnBhcmFtIGtleToKICAgICAgICBUaGUgZW5jcnlwdGlvbiBrZXkgLSBhIGJ5dGUgc3RyaW5nIDUtMTYgYnl0ZXMgbG9uZwoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIFRoZSBjaXBoZXJ0ZXh0IC0gYSBieXRlIHN0cmluZwoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IE9wZW5TU0wKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHBsYWludGV4dAogICAgIiIiCgogICAgaWYgbm90IGxpYmNyeXB0b19sZWdhY3lfc3VwcG9ydDoKICAgICAgICByYWlzZSBFbnZpcm9ubWVudEVycm9yKCdPcGVuU1NMIGhhcyBiZWVuIGNvbXBpbGVkIHdpdGhvdXQgUkM0IHN1cHBvcnQnKQoKICAgIGlmIGxlbihrZXkpIDwgNSBvciBsZW4oa2V5KSA+IDE2OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSA1IHRvIDE2IGJ5dGVzICg0MCB0byAxMjggYml0cykgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGtleSkKICAgICAgICApKQoKICAgIHJldHVybiBfZGVjcnlwdCgncmM0Jywga2V5LCBkYXRhLCBOb25lLCBOb25lKQoKCmRlZiByYzJfY2JjX3BrY3M1X2VuY3J5cHQoa2V5LCBkYXRhLCBpdik6CiAgICAiIiIKICAgIEVuY3J5cHRzIHBsYWludGV4dCB1c2luZyBSQzIgaW4gQ0JDIG1vZGUgd2l0aCBhIDQwLTEyOCBiaXQga2V5IGFuZCBQS0NTIzUKICAgIHBhZGRpbmcuCgogICAgOnBhcmFtIGtleToKICAgICAgICBUaGUgZW5jcnlwdGlvbiBrZXkgLSBhIGJ5dGUgc3RyaW5nIDggYnl0ZXMgbG9uZwoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIFRoZSBwbGFpbnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgLSBhIGJ5dGUgc3RyaW5nIDgtYnl0ZXMgbG9uZyBvciBOb25lCiAgICAgICAgdG8gZ2VuZXJhdGUgYW4gSVYKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSBPcGVuU1NMCgogICAgOnJldHVybjoKICAgICAgICBBIHR1cGxlIG9mIHR3byBieXRlIHN0cmluZ3MgKGl2LCBjaXBoZXJ0ZXh0KQogICAgIiIiCgogICAgaWYgbm90IGxpYmNyeXB0b19sZWdhY3lfc3VwcG9ydDoKICAgICAgICByYWlzZSBFbnZpcm9ubWVudEVycm9yKCdPcGVuU1NMIGhhcyBiZWVuIGNvbXBpbGVkIHdpdGhvdXQgUkMyIHN1cHBvcnQnKQoKICAgIGlmIGxlbihrZXkpIDwgNSBvciBsZW4oa2V5KSA+IDE2OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSA1IHRvIDE2IGJ5dGVzICg0MCB0byAxMjggYml0cykgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGtleSkKICAgICAgICApKQoKICAgIGlmIG5vdCBpdjoKICAgICAgICBpdiA9IHJhbmRfYnl0ZXMoOCkKICAgIGVsaWYgbGVuKGl2KSAhPSA4OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBpdiBtdXN0IGJlIDggYnl0ZXMgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGl2KQogICAgICAgICkpCgogICAgcmV0dXJuIChpdiwgX2VuY3J5cHQoJ3JjMicsIGtleSwgZGF0YSwgaXYsIFRydWUpKQoKCmRlZiByYzJfY2JjX3BrY3M1X2RlY3J5cHQoa2V5LCBkYXRhLCBpdik6CiAgICAiIiIKICAgIERlY3J5cHRzIFJDMiBjaXBoZXJ0ZXh0IGliIENCQyBtb2RlIHVzaW5nIGEgNDAtMTI4IGJpdCBrZXkgYW5kIFBLQ1MjNQogICAgcGFkZGluZy4KCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgOCBieXRlcyBsb25nCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIGNpcGhlcnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgLSBhIGJ5dGUgc3RyaW5nIDggYnl0ZXMgbG9uZwoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IE9wZW5TU0wKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHBsYWludGV4dAogICAgIiIiCgogICAgaWYgbm90IGxpYmNyeXB0b19sZWdhY3lfc3VwcG9ydDoKICAgICAgICByYWlzZSBFbnZpcm9ubWVudEVycm9yKCdPcGVuU1NMIGhhcyBiZWVuIGNvbXBpbGVkIHdpdGhvdXQgUkMyIHN1cHBvcnQnKQoKICAgIGlmIGxlbihrZXkpIDwgNSBvciBsZW4oa2V5KSA+IDE2OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSA1IHRvIDE2IGJ5dGVzICg0MCB0byAxMjggYml0cykgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGtleSkKICAgICAgICApKQoKICAgIGlmIGxlbihpdikgIT0gODoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgaXYgbXVzdCBiZSA4IGJ5dGVzIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihpdikKICAgICAgICApKQoKICAgIHJldHVybiBfZGVjcnlwdCgncmMyJywga2V5LCBkYXRhLCBpdiwgVHJ1ZSkKCgpkZWYgdHJpcGxlZGVzX2NiY19wa2NzNV9lbmNyeXB0KGtleSwgZGF0YSwgaXYpOgogICAgIiIiCiAgICBFbmNyeXB0cyBwbGFpbnRleHQgdXNpbmcgM0RFUyBpbiBDQkMgbW9kZSB1c2luZyBlaXRoZXIgdGhlIDIgb3IgMyBrZXkKICAgIHZhcmlhbnQgKDE2IG9yIDI0IGJ5dGUgbG9uZyBrZXkpIGFuZCBQS0NTIzUgcGFkZGluZy4KCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgMTYgb3IgMjQgYnl0ZXMgbG9uZyAoMiBvciAzIGtleSBtb2RlKQoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIFRoZSBwbGFpbnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgLSBhIGJ5dGUgc3RyaW5nIDgtYnl0ZXMgbG9uZyBvciBOb25lCiAgICAgICAgdG8gZ2VuZXJhdGUgYW4gSVYKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSBPcGVuU1NMCgogICAgOnJldHVybjoKICAgICAgICBBIHR1cGxlIG9mIHR3byBieXRlIHN0cmluZ3MgKGl2LCBjaXBoZXJ0ZXh0KQogICAgIiIiCgogICAgaWYgbGVuKGtleSkgIT0gMTYgYW5kIGxlbihrZXkpICE9IDI0OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSAxNiBieXRlcyAoMiBrZXkpIG9yIDI0IGJ5dGVzICgzIGtleSkgbG9uZyAtICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGtleSkKICAgICAgICApKQoKICAgIGlmIG5vdCBpdjoKICAgICAgICBpdiA9IHJhbmRfYnl0ZXMoOCkKICAgIGVsaWYgbGVuKGl2KSAhPSA4OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBpdiBtdXN0IGJlIDggYnl0ZXMgbG9uZyAtICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGl2KQogICAgICAgICkpCgogICAgY2lwaGVyID0gJ3RyaXBsZWRlc18za2V5JwogICAgIyBFeHBhbmQgMi1rZXkgdG8gYWN0dWFsIDI0IGJ5dGUgYnl0ZSBzdHJpbmcgdXNlZCBieSBjaXBoZXIKICAgIGlmIGxlbihrZXkpID09IDE2OgogICAgICAgIGtleSA9IGtleSArIGtleVswOjhdCiAgICAgICAgY2lwaGVyID0gJ3RyaXBsZWRlc18ya2V5JwoKICAgIHJldHVybiAoaXYsIF9lbmNyeXB0KGNpcGhlciwga2V5LCBkYXRhLCBpdiwgVHJ1ZSkpCgoKZGVmIHRyaXBsZWRlc19jYmNfcGtjczVfZGVjcnlwdChrZXksIGRhdGEsIGl2KToKICAgICIiIgogICAgRGVjcnlwdHMgM0RFUyBjaXBoZXJ0ZXh0IGluIENCQyBtb2RlIHVzaW5nIGVpdGhlciB0aGUgMiBvciAzIGtleSB2YXJpYW50CiAgICAoMTYgb3IgMjQgYnl0ZSBsb25nIGtleSkgYW5kIFBLQ1MjNSBwYWRkaW5nLgoKICAgIDpwYXJhbSBrZXk6CiAgICAgICAgVGhlIGVuY3J5cHRpb24ga2V5IC0gYSBieXRlIHN0cmluZyAxNiBvciAyNCBieXRlcyBsb25nICgyIG9yIDMga2V5IG1vZGUpCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIGNpcGhlcnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgLSBhIGJ5dGUgc3RyaW5nIDgtYnl0ZXMgbG9uZwoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IE9wZW5TU0wKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIHBsYWludGV4dAogICAgIiIiCgogICAgaWYgbGVuKGtleSkgIT0gMTYgYW5kIGxlbihrZXkpICE9IDI0OgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IocHJldHR5X21lc3NhZ2UoCiAgICAgICAgICAgICcnJwogICAgICAgICAgICBrZXkgbXVzdCBiZSAxNiBieXRlcyAoMiBrZXkpIG9yIDI0IGJ5dGVzICgzIGtleSkgbG9uZyAtIGlzICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgbGVuKGtleSkKICAgICAgICApKQoKICAgIGlmIGxlbihpdikgIT0gODoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgaXYgbXVzdCBiZSA4IGJ5dGVzIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihpdikKICAgICAgICApKQoKICAgIGNpcGhlciA9ICd0cmlwbGVkZXNfM2tleScKICAgICMgRXhwYW5kIDIta2V5IHRvIGFjdHVhbCAyNCBieXRlIGJ5dGUgc3RyaW5nIHVzZWQgYnkgY2lwaGVyCiAgICBpZiBsZW4oa2V5KSA9PSAxNjoKICAgICAgICBrZXkgPSBrZXkgKyBrZXlbMDo4XQogICAgICAgIGNpcGhlciA9ICd0cmlwbGVkZXNfMmtleScKCiAgICByZXR1cm4gX2RlY3J5cHQoY2lwaGVyLCBrZXksIGRhdGEsIGl2LCBUcnVlKQoKCmRlZiBkZXNfY2JjX3BrY3M1X2VuY3J5cHQoa2V5LCBkYXRhLCBpdik6CiAgICAiIiIKICAgIEVuY3J5cHRzIHBsYWludGV4dCB1c2luZyBERVMgaW4gQ0JDIG1vZGUgd2l0aCBhIDU2IGJpdCBrZXkgYW5kIFBLQ1MjNQogICAgcGFkZGluZy4KCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgOCBieXRlcyBsb25nIChpbmNsdWRlcyBlcnJvciBjb3JyZWN0aW9uIGJpdHMpCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIHBsYWludGV4dCAtIGEgYnl0ZSBzdHJpbmcKCiAgICA6cGFyYW0gaXY6CiAgICAgICAgVGhlIGluaXRpYWxpemF0aW9uIHZlY3RvciAtIGEgYnl0ZSBzdHJpbmcgOC1ieXRlcyBsb25nIG9yIE5vbmUKICAgICAgICB0byBnZW5lcmF0ZSBhbiBJVgoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IE9wZW5TU0wKCiAgICA6cmV0dXJuOgogICAgICAgIEEgdHVwbGUgb2YgdHdvIGJ5dGUgc3RyaW5ncyAoaXYsIGNpcGhlcnRleHQpCiAgICAiIiIKCiAgICBpZiBub3QgbGliY3J5cHRvX2xlZ2FjeV9zdXBwb3J0OgogICAgICAgIHJhaXNlIEVudmlyb25tZW50RXJyb3IoJ09wZW5TU0wgaGFzIGJlZW4gY29tcGlsZWQgd2l0aG91dCBERVMgc3VwcG9ydCcpCgogICAgaWYgbGVuKGtleSkgIT0gODoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAga2V5IG11c3QgYmUgOCBieXRlcyAoNTYgYml0cyArIDggcGFyaXR5IGJpdHMpIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihrZXkpCiAgICAgICAgKSkKCiAgICBpZiBub3QgaXY6CiAgICAgICAgaXYgPSByYW5kX2J5dGVzKDgpCiAgICBlbGlmIGxlbihpdikgIT0gODoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgaXYgbXVzdCBiZSA4IGJ5dGVzIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihpdikKICAgICAgICApKQoKICAgIHJldHVybiAoaXYsIF9lbmNyeXB0KCdkZXMnLCBrZXksIGRhdGEsIGl2LCBUcnVlKSkKCgpkZWYgZGVzX2NiY19wa2NzNV9kZWNyeXB0KGtleSwgZGF0YSwgaXYpOgogICAgIiIiCiAgICBEZWNyeXB0cyBERVMgY2lwaGVydGV4dCBpbiBDQkMgbW9kZSB1c2luZyBhIDU2IGJpdCBrZXkgYW5kIFBLQ1MjNSBwYWRkaW5nLgoKICAgIDpwYXJhbSBrZXk6CiAgICAgICAgVGhlIGVuY3J5cHRpb24ga2V5IC0gYSBieXRlIHN0cmluZyA4IGJ5dGVzIGxvbmcgKGluY2x1ZGVzIGVycm9yIGNvcnJlY3Rpb24gYml0cykKCiAgICA6cGFyYW0gZGF0YToKICAgICAgICBUaGUgY2lwaGVydGV4dCAtIGEgYnl0ZSBzdHJpbmcKCiAgICA6cGFyYW0gaXY6CiAgICAgICAgVGhlIGluaXRpYWxpemF0aW9uIHZlY3RvciAtIGEgYnl0ZSBzdHJpbmcgOC1ieXRlcyBsb25nCgogICAgOnJhaXNlczoKICAgICAgICBWYWx1ZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgY29udGFpbiBhbiBpbnZhbGlkIHZhbHVlCiAgICAgICAgVHlwZUVycm9yIC0gd2hlbiBhbnkgb2YgdGhlIHBhcmFtZXRlcnMgYXJlIG9mIHRoZSB3cm9uZyB0eXBlCiAgICAgICAgT1NFcnJvciAtIHdoZW4gYW4gZXJyb3IgaXMgcmV0dXJuZWQgYnkgT3BlblNTTAoKICAgIDpyZXR1cm46CiAgICAgICAgQSBieXRlIHN0cmluZyBvZiB0aGUgcGxhaW50ZXh0CiAgICAiIiIKCiAgICBpZiBub3QgbGliY3J5cHRvX2xlZ2FjeV9zdXBwb3J0OgogICAgICAgIHJhaXNlIEVudmlyb25tZW50RXJyb3IoJ09wZW5TU0wgaGFzIGJlZW4gY29tcGlsZWQgd2l0aG91dCBERVMgc3VwcG9ydCcpCgogICAgaWYgbGVuKGtleSkgIT0gODoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAga2V5IG11c3QgYmUgOCBieXRlcyAoNTYgYml0cyArIDggcGFyaXR5IGJpdHMpIGxvbmcgLSBpcyAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIGxlbihrZXkpCiAgICAgICAgKSkKCiAgICBpZiBsZW4oaXYpICE9IDg6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGl2IG11c3QgYmUgOCBieXRlcyBsb25nIC0gaXMgJXMKICAgICAgICAgICAgJycnLAogICAgICAgICAgICBsZW4oaXYpCiAgICAgICAgKSkKCiAgICByZXR1cm4gX2RlY3J5cHQoJ2RlcycsIGtleSwgZGF0YSwgaXYsIFRydWUpCgoKZGVmIF9lbmNyeXB0KGNpcGhlciwga2V5LCBkYXRhLCBpdiwgcGFkZGluZyk6CiAgICAiIiIKICAgIEVuY3J5cHRzIHBsYWludGV4dAoKICAgIDpwYXJhbSBjaXBoZXI6CiAgICAgICAgQSB1bmljb2RlIHN0cmluZyBvZiAiYWVzMTI4IiwgImFlczE5MiIsICJhZXMyNTYiLCAiZGVzIiwKICAgICAgICAidHJpcGxlZGVzXzJrZXkiLCAidHJpcGxlZGVzXzNrZXkiLCAicmMyIiwgInJjNCIKCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgNS0zMiBieXRlcyBsb25nCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIHBsYWludGV4dCAtIGEgYnl0ZSBzdHJpbmcKCiAgICA6cGFyYW0gaXY6CiAgICAgICAgVGhlIGluaXRpYWxpemF0aW9uIHZlY3RvciAtIGEgYnl0ZSBzdHJpbmcgLSB1bnVzZWQgZm9yIFJDNAoKICAgIDpwYXJhbSBwYWRkaW5nOgogICAgICAgIEJvb2xlYW4sIGlmIHBhZGRpbmcgc2hvdWxkIGJlIHVzZWQgLSB1bnVzZWQgZm9yIFJDNAoKICAgIDpyYWlzZXM6CiAgICAgICAgVmFsdWVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gaW52YWxpZCB2YWx1ZQogICAgICAgIFR5cGVFcnJvciAtIHdoZW4gYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBvZiB0aGUgd3JvbmcgdHlwZQogICAgICAgIE9TRXJyb3IgLSB3aGVuIGFuIGVycm9yIGlzIHJldHVybmVkIGJ5IE9wZW5TU0wKCiAgICA6cmV0dXJuOgogICAgICAgIEEgYnl0ZSBzdHJpbmcgb2YgdGhlIGNpcGhlcnRleHQKICAgICIiIgoKICAgIGlmIG5vdCBpc2luc3RhbmNlKGtleSwgYnl0ZV9jbHMpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGtleSBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShrZXkpCiAgICAgICAgKSkKCiAgICBpZiBub3QgaXNpbnN0YW5jZShkYXRhLCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgZGF0YSBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShkYXRhKQogICAgICAgICkpCgogICAgaWYgY2lwaGVyICE9ICdyYzQnIGFuZCBub3QgaXNpbnN0YW5jZShpdiwgYnl0ZV9jbHMpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGl2IG11c3QgYmUgYSBieXRlIHN0cmluZywgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKGl2KQogICAgICAgICkpCgogICAgaWYgY2lwaGVyICE9ICdyYzQnIGFuZCBub3QgcGFkZGluZzoKICAgICAgICAjIEFFUyBpbiBDQkMgbW9kZSBjYW4gYmUgYWxsb3dlZCB3aXRoIG5vIHBhZGRpbmcgaWYKICAgICAgICAjIHRoZSBkYXRhIGlzIGFuIGV4YWN0IG11bHRpcGxlIG9mIHRoZSBibG9jayBzaXplCiAgICAgICAgaXNfYWVzID0gY2lwaGVyIGluIHNldChbJ2FlczEyOCcsICdhZXMxOTInLCAnYWVzMjU2J10pCiAgICAgICAgaWYgbm90IGlzX2FlcyBvciAoaXNfYWVzIGFuZCAobGVuKGRhdGEpICUgMTYpICE9IDApOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdwYWRkaW5nIG11c3QgYmUgc3BlY2lmaWVkJykKCiAgICBldnBfY2lwaGVyX2N0eCA9IE5vbmUKCiAgICB0cnk6CiAgICAgICAgZXZwX2NpcGhlcl9jdHggPSBsaWJjcnlwdG8uRVZQX0NJUEhFUl9DVFhfbmV3KCkKICAgICAgICBpZiBpc19udWxsKGV2cF9jaXBoZXJfY3R4KToKICAgICAgICAgICAgaGFuZGxlX29wZW5zc2xfZXJyb3IoMCkKCiAgICAgICAgZXZwX2NpcGhlciwgYnVmZmVyX3NpemUgPSBfc2V0dXBfZXZwX2VuY3J5cHRfZGVjcnlwdChjaXBoZXIsIGRhdGEpCgogICAgICAgIGlmIGl2IGlzIE5vbmU6CiAgICAgICAgICAgIGl2ID0gbnVsbCgpCgogICAgICAgIGlmIGNpcGhlciBpbiBzZXQoWydyYzInLCAncmM0J10pOgogICAgICAgICAgICByZXMgPSBsaWJjcnlwdG8uRVZQX0VuY3J5cHRJbml0X2V4KGV2cF9jaXBoZXJfY3R4LCBldnBfY2lwaGVyLCBudWxsKCksIG51bGwoKSwgbnVsbCgpKQogICAgICAgICAgICBoYW5kbGVfb3BlbnNzbF9lcnJvcihyZXMpCiAgICAgICAgICAgIHJlcyA9IGxpYmNyeXB0by5FVlBfQ0lQSEVSX0NUWF9zZXRfa2V5X2xlbmd0aChldnBfY2lwaGVyX2N0eCwgbGVuKGtleSkpCiAgICAgICAgICAgIGhhbmRsZV9vcGVuc3NsX2Vycm9yKHJlcykKICAgICAgICAgICAgaWYgY2lwaGVyID09ICdyYzInOgogICAgICAgICAgICAgICAgcmVzID0gbGliY3J5cHRvLkVWUF9DSVBIRVJfQ1RYX2N0cmwoCiAgICAgICAgICAgICAgICAgICAgZXZwX2NpcGhlcl9jdHgsCiAgICAgICAgICAgICAgICAgICAgTGliY3J5cHRvQ29uc3QuRVZQX0NUUkxfU0VUX1JDMl9LRVlfQklUUywKICAgICAgICAgICAgICAgICAgICBsZW4oa2V5KSAqIDgsCiAgICAgICAgICAgICAgICAgICAgbnVsbCgpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBoYW5kbGVfb3BlbnNzbF9lcnJvcihyZXMpCiAgICAgICAgICAgIGV2cF9jaXBoZXIgPSBudWxsKCkKCiAgICAgICAgcmVzID0gbGliY3J5cHRvLkVWUF9FbmNyeXB0SW5pdF9leChldnBfY2lwaGVyX2N0eCwgZXZwX2NpcGhlciwgbnVsbCgpLCBrZXksIGl2KQogICAgICAgIGhhbmRsZV9vcGVuc3NsX2Vycm9yKHJlcykKCiAgICAgICAgaWYgcGFkZGluZyBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmVzID0gbGliY3J5cHRvLkVWUF9DSVBIRVJfQ1RYX3NldF9wYWRkaW5nKGV2cF9jaXBoZXJfY3R4LCBpbnQocGFkZGluZykpCiAgICAgICAgICAgIGhhbmRsZV9vcGVuc3NsX2Vycm9yKHJlcykKCiAgICAgICAgYnVmZmVyID0gYnVmZmVyX2Zyb21fYnl0ZXMoYnVmZmVyX3NpemUpCiAgICAgICAgb3V0cHV0X2xlbmd0aCA9IG5ldyhsaWJjcnlwdG8sICdpbnQgKicpCgogICAgICAgIHJlcyA9IGxpYmNyeXB0by5FVlBfRW5jcnlwdFVwZGF0ZShldnBfY2lwaGVyX2N0eCwgYnVmZmVyLCBvdXRwdXRfbGVuZ3RoLCBkYXRhLCBsZW4oZGF0YSkpCiAgICAgICAgaGFuZGxlX29wZW5zc2xfZXJyb3IocmVzKQoKICAgICAgICBvdXRwdXQgPSBieXRlc19mcm9tX2J1ZmZlcihidWZmZXIsIGRlcmVmKG91dHB1dF9sZW5ndGgpKQoKICAgICAgICByZXMgPSBsaWJjcnlwdG8uRVZQX0VuY3J5cHRGaW5hbF9leChldnBfY2lwaGVyX2N0eCwgYnVmZmVyLCBvdXRwdXRfbGVuZ3RoKQogICAgICAgIGhhbmRsZV9vcGVuc3NsX2Vycm9yKHJlcykKCiAgICAgICAgb3V0cHV0ICs9IGJ5dGVzX2Zyb21fYnVmZmVyKGJ1ZmZlciwgZGVyZWYob3V0cHV0X2xlbmd0aCkpCgogICAgICAgIHJldHVybiBvdXRwdXQKCiAgICBmaW5hbGx5OgogICAgICAgIGlmIGV2cF9jaXBoZXJfY3R4OgogICAgICAgICAgICBsaWJjcnlwdG8uRVZQX0NJUEhFUl9DVFhfZnJlZShldnBfY2lwaGVyX2N0eCkKCgpkZWYgX2RlY3J5cHQoY2lwaGVyLCBrZXksIGRhdGEsIGl2LCBwYWRkaW5nKToKICAgICIiIgogICAgRGVjcnlwdHMgQUVTL1JDNC9SQzIvM0RFUy9ERVMgY2lwaGVydGV4dAoKICAgIDpwYXJhbSBjaXBoZXI6CiAgICAgICAgQSB1bmljb2RlIHN0cmluZyBvZiAiYWVzMTI4IiwgImFlczE5MiIsICJhZXMyNTYiLCAiZGVzIiwKICAgICAgICAidHJpcGxlZGVzXzJrZXkiLCAidHJpcGxlZGVzXzNrZXkiLCAicmMyIiwgInJjNCIKCiAgICA6cGFyYW0ga2V5OgogICAgICAgIFRoZSBlbmNyeXB0aW9uIGtleSAtIGEgYnl0ZSBzdHJpbmcgNS0zMiBieXRlcyBsb25nCgogICAgOnBhcmFtIGRhdGE6CiAgICAgICAgVGhlIGNpcGhlcnRleHQgLSBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIGl2OgogICAgICAgIFRoZSBpbml0aWFsaXphdGlvbiB2ZWN0b3IgLSBhIGJ5dGUgc3RyaW5nIC0gdW51c2VkIGZvciBSQzQKCiAgICA6cGFyYW0gcGFkZGluZzoKICAgICAgICBCb29sZWFuLCBpZiBwYWRkaW5nIHNob3VsZCBiZSB1c2VkIC0gdW51c2VkIGZvciBSQzQKCiAgICA6cmFpc2VzOgogICAgICAgIFZhbHVlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBjb250YWluIGFuIGludmFsaWQgdmFsdWUKICAgICAgICBUeXBlRXJyb3IgLSB3aGVuIGFueSBvZiB0aGUgcGFyYW1ldGVycyBhcmUgb2YgdGhlIHdyb25nIHR5cGUKICAgICAgICBPU0Vycm9yIC0gd2hlbiBhbiBlcnJvciBpcyByZXR1cm5lZCBieSBPcGVuU1NMCgogICAgOnJldHVybjoKICAgICAgICBBIGJ5dGUgc3RyaW5nIG9mIHRoZSBwbGFpbnRleHQKICAgICIiIgoKICAgIGlmIG5vdCBpc2luc3RhbmNlKGtleSwgYnl0ZV9jbHMpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGtleSBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShrZXkpCiAgICAgICAgKSkKCiAgICBpZiBub3QgaXNpbnN0YW5jZShkYXRhLCBieXRlX2Nscyk6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKHByZXR0eV9tZXNzYWdlKAogICAgICAgICAgICAnJycKICAgICAgICAgICAgZGF0YSBtdXN0IGJlIGEgYnl0ZSBzdHJpbmcsIG5vdCAlcwogICAgICAgICAgICAnJycsCiAgICAgICAgICAgIHR5cGVfbmFtZShkYXRhKQogICAgICAgICkpCgogICAgaWYgY2lwaGVyICE9ICdyYzQnIGFuZCBub3QgaXNpbnN0YW5jZShpdiwgYnl0ZV9jbHMpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihwcmV0dHlfbWVzc2FnZSgKICAgICAgICAgICAgJycnCiAgICAgICAgICAgIGl2IG11c3QgYmUgYSBieXRlIHN0cmluZywgbm90ICVzCiAgICAgICAgICAgICcnJywKICAgICAgICAgICAgdHlwZV9uYW1lKGl2KQogICAgICAgICkpCgogICAgaWYgY2lwaGVyIG5vdCBpbiBzZXQoWydyYzQnLCAnYWVzMTI4JywgJ2FlczE5MicsICdhZXMyNTYnXSkgYW5kIG5vdCBwYWRkaW5nOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ3BhZGRpbmcgbXVzdCBiZSBzcGVjaWZpZWQnKQoKICAgIGV2cF9jaXBoZXJfY3R4ID0gTm9uZQoKICAgIHRyeToKICAgICAgICBldnBfY2lwaGVyX2N0eCA9IGxpYmNyeXB0by5FVlBfQ0lQSEVSX0NUWF9uZXcoKQogICAgICAgIGlmIGlzX251bGwoZXZwX2NpcGhlcl9jdHgpOgogICAgICAgICAgICBoYW5kbGVfb3BlbnNzbF9lcnJvcigwKQoKICAgICAgICBldnBfY2lwaGVyLCBidWZmZXJfc2l6ZSA9IF9zZXR1cF9ldnBfZW5jcnlwdF9kZWNyeXB0KGNpcGhlciwgZGF0YSkKCiAgICAgICAgaWYgaXYgaXMgTm9uZToKICAgICAgICAgICAgaXYgPSBudWxsKCkKCiAgICAgICAgaWYgY2lwaGVyIGluIHNldChbJ3JjMicsICdyYzQnXSk6CiAgICAgICAgICAgIHJlcyA9IGxpYmNyeXB0by5FVlBfRGVjcnlwdEluaXRfZXgoZXZwX2NpcGhlcl9jdHgsIGV2cF9jaXBoZXIsIG51bGwoKSwgbnVsbCgpLCBudWxsKCkpCiAgICAgICAgICAgIGhhbmRsZV9vcGVuc3NsX2Vycm9yKHJlcykKICAgICAgICAgICAgcmVzID0gbGliY3J5cHRvLkVWUF9DSVBIRVJfQ1RYX3NldF9rZXlfbGVuZ3RoKGV2cF9jaXBoZXJfY3R4LCBsZW4oa2V5KSkKICAgICAgICAgICAgaGFuZGxlX29wZW5zc2xfZXJyb3IocmVzKQogICAgICAgICAgICBpZiBjaXBoZXIgPT0gJ3JjMic6CiAgICAgICAgICAgICAgICByZXMgPSBsaWJjcnlwdG8uRVZQX0NJUEhFUl9DVFhfY3RybCgKICAgICAgICAgICAgICAgICAgICBldnBfY2lwaGVyX2N0eCwKICAgICAgICAgICAgICAgICAgICBMaWJjcnlwdG9Db25zdC5FVlBfQ1RSTF9TRVRfUkMyX0tFWV9CSVRTLAogICAgICAgICAgICAgICAgICAgIGxlbihrZXkpICogOCwKICAgICAgICAgICAgICAgICAgICBudWxsKCkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGhhbmRsZV9vcGVuc3NsX2Vycm9yKHJlcykKICAgICAgICAgICAgZXZwX2NpcGhlciA9IG51bGwoKQoKICAgICAgICByZXMgPSBsaWJjcnlwdG8uRVZQX0RlY3J5cHRJbml0X2V4KGV2cF9jaXBoZXJfY3R4LCBldnBfY2lwaGVyLCBudWxsKCksIGtleSwgaXYpCiAgICAgICAgaGFuZGxlX29wZW5zc2xfZXJyb3IocmVzKQoKICAgICAgICBpZiBwYWRkaW5nIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXMgPSBsaWJjcnlwdG8uRVZQX0NJUEhFUl9DVFhfc2V0X3BhZGRpbmcoZXZwX2NpcGhlcl9jdHgsIGludChwYWRkaW5nKSkKICAgICAgICAgICAgaGFuZGxlX29wZW5zc2xfZXJyb3IocmVzKQoKICAgICAgICBidWZmZXIgPSBidWZmZXJfZnJvbV9ieXRlcyhidWZmZXJfc2l6ZSkKICAgICAgICBvdXRwdXRfbGVuZ3RoID0gbmV3KGxpYmNyeXB0bywgJ2ludCAqJykKCiAgICAgICAgcmVzID0gbGliY3J5cHRvLkVWUF9EZWNyeXB0VXBkYXRlKGV2cF9jaXBoZXJfY3R4LCBidWZmZXIsIG91dHB1dF9sZW5ndGgsIGRhdGEsIGxlbihkYXRhKSkKICAgICAgICBoYW5kbGVfb3BlbnNzbF9lcnJvcihyZXMpCgogICAgICAgIG91dHB1dCA9IGJ5dGVzX2Zyb21fYnVmZmVyKGJ1ZmZlciwgZGVyZWYob3V0cHV0X2xlbmd0aCkpCgogICAgICAgIHJlcyA9IGxpYmNyeXB0by5FVlBfRGVjcnlwdEZpbmFsX2V4KGV2cF9jaXBoZXJfY3R4LCBidWZmZXIsIG91dHB1dF9sZW5ndGgpCiAgICAgICAgaGFuZGxlX29wZW5zc2xfZXJyb3IocmVzKQoKICAgICAgICBvdXRwdXQgKz0gYnl0ZXNfZnJvbV9idWZmZXIoYnVmZmVyLCBkZXJlZihvdXRwdXRfbGVuZ3RoKSkKCiAgICAgICAgcmV0dXJuIG91dHB1dAoKICAgIGZpbmFsbHk6CiAgICAgICAgaWYgZXZwX2NpcGhlcl9jdHg6CiAgICAgICAgICAgIGxpYmNyeXB0by5FVlBfQ0lQSEVSX0NUWF9mcmVlKGV2cF9jaXBoZXJfY3R4KQoKCmRlZiBfc2V0dXBfZXZwX2VuY3J5cHRfZGVjcnlwdChjaXBoZXIsIGRhdGEpOgogICAgIiIiCiAgICBDcmVhdGVzIGFuIEVWUF9DSVBIRVIgcG9pbnRlciBvYmplY3QgYW5kIGRldGVybWluZXMgdGhlIGJ1ZmZlciBzaXplCiAgICBuZWNlc3NhcnkgZm9yIHRoZSBwYXJhbWV0ZXIgc3BlY2lmaWVkLgoKICAgIDpwYXJhbSBldnBfY2lwaGVyX2N0eDoKICAgICAgICBBbiBFVlBfQ0lQSEVSX0NUWCBwb2ludGVyCgogICAgOnBhcmFtIGNpcGhlcjoKICAgICAgICBBIHVuaWNvZGUgc3RyaW5nIG9mICJhZXMxMjgiLCAiYWVzMTkyIiwgImFlczI1NiIsICJkZXMiLAogICAgICAgICJ0cmlwbGVkZXNfMmtleSIsICJ0cmlwbGVkZXNfM2tleSIsICJyYzIiLCAicmM0IgoKICAgIDpwYXJhbSBrZXk6CiAgICAgICAgVGhlIGtleSBieXRlIHN0cmluZwoKICAgIDpwYXJhbSBkYXRhOgogICAgICAgIFRoZSBwbGFpbnRleHQgb3IgY2lwaGVydGV4dCBhcyBhIGJ5dGUgc3RyaW5nCgogICAgOnBhcmFtIHBhZGRpbmc6CiAgICAgICAgSWYgcGFkZGluZyBpcyB0byBiZSB1c2VkCgogICAgOnJldHVybjoKICAgICAgICBBIDItZWxlbWVudCB0dXBsZSB3aXRoIHRoZSBmaXJzdCBlbGVtZW50IGJlaW5nIGFuIEVWUF9DSVBIRVIgcG9pbnRlcgogICAgICAgIGFuZCB0aGUgc2Vjb25kIGJlaW5nIGFuIGludGVnZXIgdGhhdCBpcyB0aGUgcmVxdWlyZWQgYnVmZmVyIHNpemUKICAgICIiIgoKICAgIGV2cF9jaXBoZXIgPSB7CiAgICAgICAgJ2FlczEyOCc6IGxpYmNyeXB0by5FVlBfYWVzXzEyOF9jYmMsCiAgICAgICAgJ2FlczE5Mic6IGxpYmNyeXB0by5FVlBfYWVzXzE5Ml9jYmMsCiAgICAgICAgJ2FlczI1Nic6IGxpYmNyeXB0by5FVlBfYWVzXzI1Nl9jYmMsCiAgICAgICAgJ3JjMic6IGxpYmNyeXB0by5FVlBfcmMyX2NiYywKICAgICAgICAncmM0JzogbGliY3J5cHRvLkVWUF9yYzQsCiAgICAgICAgJ2Rlcyc6IGxpYmNyeXB0by5FVlBfZGVzX2NiYywKICAgICAgICAndHJpcGxlZGVzXzJrZXknOiBsaWJjcnlwdG8uRVZQX2Rlc19lZGVfY2JjLAogICAgICAgICd0cmlwbGVkZXNfM2tleSc6IGxpYmNyeXB0by5FVlBfZGVzX2VkZTNfY2JjLAogICAgfVtjaXBoZXJdKCkKCiAgICBpZiBjaXBoZXIgPT0gJ3JjNCc6CiAgICAgICAgYnVmZmVyX3NpemUgPSBsZW4oZGF0YSkKICAgIGVsc2U6CiAgICAgICAgYmxvY2tfc2l6ZSA9IHsKICAgICAgICAgICAgJ2FlczEyOCc6IDE2LAogICAgICAgICAgICAnYWVzMTkyJzogMTYsCiAgICAgICAgICAgICdhZXMyNTYnOiAxNiwKICAgICAgICAgICAgJ3JjMic6IDgsCiAgICAgICAgICAgICdkZXMnOiA4LAogICAgICAgICAgICAndHJpcGxlZGVzXzJrZXknOiA4LAogICAgICAgICAgICAndHJpcGxlZGVzXzNrZXknOiA4LAogICAgICAgIH1bY2lwaGVyXQogICAgICAgIGJ1ZmZlcl9zaXplID0gYmxvY2tfc2l6ZSAqIGludChtYXRoLmNlaWwobGVuKGRhdGEpIC8gYmxvY2tfc2l6ZSkpCgogICAgcmV0dXJuIChldnBfY2lwaGVyLCBidWZmZXJfc2l6ZSkK
