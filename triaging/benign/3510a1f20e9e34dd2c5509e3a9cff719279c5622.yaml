statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/contrib/appengine.py
  contents:
  - name: <module>
    score: 0.0
    code: |-
      """
      This module provides a pool manager that uses Google App Engine's
      `URLFetch Service <https://cloud.google.com/appengine/docs/python/urlfetch>`_.

      Example usage::

          from urllib3 import PoolManager
          from urllib3.contrib.appengine import AppEngineManager, is_appengine_sandbox

          if is_appengine_sandbox():
              # AppEngineManager uses AppEngine's URLFetch API behind the scenes
              http = AppEngineManager()
          else:
              # PoolManager uses a socket-level API behind the scenes
              http = PoolManager()

          r = http.request('GET', 'https://google.com/')

      There are `limitations <https://cloud.google.com/appengine/docs/python/\
      urlfetch/#Python_Quotas_and_limits>`_ to the URLFetch service and it may not be
      the best choice for your application. There are three options for using
      urllib3 on Google App Engine:

      1. You can use :class:`AppEngineManager` with URLFetch. URLFetch is
         cost-effective in many circumstances as long as your usage is within the
         limitations.
      2. You can use a normal :class:`~urllib3.PoolManager` by enabling sockets.
         Sockets also have `limitations and restrictions
         <https://cloud.google.com/appengine/docs/python/sockets/\
         #limitations-and-restrictions>`_ and have a lower free quota than URLFetch.
         To use sockets, be sure to specify the following in your ``app.yaml``::

              env_variables:
                  GAE_USE_SOCKETS_HTTPLIB : 'true'

      3. If you are using `App Engine Flexible
      <https://cloud.google.com/appengine/docs/flexible/>`_, you can use the standard
      :class:`PoolManager` without any configuration or special environment variables.
      """

      from __future__ import absolute_import
      import io
      import logging
      import warnings
      from ..packages.six.moves.urllib.parse import urljoin

      from ..exceptions import (
          HTTPError,
          HTTPWarning,
          MaxRetryError,
          ProtocolError,
          TimeoutError,
          SSLError
      )

      from ..request import RequestMethods
      from ..response import HTTPResponse
      from ..util.timeout import Timeout
      from ..util.retry import Retry
      from . import _appengine_environ

      try:
          from google.appengine.api import urlfetch
      except ImportError:
          urlfetch = None


      log = logging.getLogger(__name__)


      class AppEnginePlatformWarning(HTTPWarning):
          pass
    tokens: resume load_const STRING_FILE_PATH store_name __doc__ load_const INTEGER load_const import_name __future__ import_from absolute_import store_name absolute_import pop_top load_const INTEGER load_const import_name io store_name io load_const INTEGER load_const import_name logging store_name logging load_const INTEGER load_const import_name warnings store_name warnings load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from urljoin store_name urljoin pop_top load_const INTEGER load_const import_name exceptions import_from HTTPError store_name HTTPError import_from HTTPWarning store_name HTTPWarning import_from MaxRetryError store_name MaxRetryError import_from ProtocolError store_name ProtocolError import_from TimeoutError store_name TimeoutError import_from SSLError store_name SSLError pop_top load_const INTEGER load_const import_name request import_from RequestMethods store_name RequestMethods pop_top load_const INTEGER load_const import_name response import_from HTTPResponse store_name HTTPResponse pop_top load_const INTEGER load_const import_name util.timeout import_from Timeout store_name Timeout pop_top load_const INTEGER load_const import_name util.retry import_from Retry store_name Retry pop_top load_const INTEGER load_const import_name import_from STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH pop_top nop load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from urlfetch store_name urlfetch pop_top push_null load_name logging load_attr getLogger load_name __name__ call store_name log push_null load_build_class load_const OBJECT make_function load_const STRING_BASE64_LEN_S_ENT_HIGH load_name HTTPWarning call store_name STRING_BASE64_LEN_S_ENT_HIGH push_null load_build_class load_const OBJECT make_function load_const STRING_LEN_S_ENT_HIGH load_name HTTPError call store_name STRING_LEN_S_ENT_HIGH push_null load_build_class load_const OBJECT make_function load_const STRING_BASE64_LEN_S_ENT_HIGH load_name RequestMethods call store_name STRING_BASE64_LEN_S_ENT_HIGH load_name STRING_LEN_S_ENT_HIGH load_attr is_appengine store_name is_appengine load_name STRING_LEN_S_ENT_HIGH load_attr STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH load_name STRING_LEN_S_ENT_HIGH load_attr STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH load_name STRING_LEN_S_ENT_HIGH load_attr STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH load_name STRING_LEN_S_ENT_HIGH load_attr STRING_LEN_S_ENT_HIGH store_name STRING_LEN_S_ENT_HIGH return_const None push_exc_info load_name ImportError check_exc_match pop_jump_if_false TO_NUMBER pop_top load_const store_name urlfetch pop_except jump_backward TO_NUMBER reraise copy pop_except reraise
    hash: 5ac063aafc360c9be72c8a4b243211164aab33e79197e4219ee27c13667fe49e
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/contrib/appengine.py
  : IiIiClRoaXMgbW9kdWxlIHByb3ZpZGVzIGEgcG9vbCBtYW5hZ2VyIHRoYXQgdXNlcyBHb29nbGUgQXBwIEVuZ2luZSdzCmBVUkxGZXRjaCBTZXJ2aWNlIDxodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vYXBwZW5naW5lL2RvY3MvcHl0aG9uL3VybGZldGNoPmBfLgoKRXhhbXBsZSB1c2FnZTo6CgogICAgZnJvbSB1cmxsaWIzIGltcG9ydCBQb29sTWFuYWdlcgogICAgZnJvbSB1cmxsaWIzLmNvbnRyaWIuYXBwZW5naW5lIGltcG9ydCBBcHBFbmdpbmVNYW5hZ2VyLCBpc19hcHBlbmdpbmVfc2FuZGJveAoKICAgIGlmIGlzX2FwcGVuZ2luZV9zYW5kYm94KCk6CiAgICAgICAgIyBBcHBFbmdpbmVNYW5hZ2VyIHVzZXMgQXBwRW5naW5lJ3MgVVJMRmV0Y2ggQVBJIGJlaGluZCB0aGUgc2NlbmVzCiAgICAgICAgaHR0cCA9IEFwcEVuZ2luZU1hbmFnZXIoKQogICAgZWxzZToKICAgICAgICAjIFBvb2xNYW5hZ2VyIHVzZXMgYSBzb2NrZXQtbGV2ZWwgQVBJIGJlaGluZCB0aGUgc2NlbmVzCiAgICAgICAgaHR0cCA9IFBvb2xNYW5hZ2VyKCkKCiAgICByID0gaHR0cC5yZXF1ZXN0KCdHRVQnLCAnaHR0cHM6Ly9nb29nbGUuY29tLycpCgpUaGVyZSBhcmUgYGxpbWl0YXRpb25zIDxodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vYXBwZW5naW5lL2RvY3MvcHl0aG9uL1wKdXJsZmV0Y2gvI1B5dGhvbl9RdW90YXNfYW5kX2xpbWl0cz5gXyB0byB0aGUgVVJMRmV0Y2ggc2VydmljZSBhbmQgaXQgbWF5IG5vdCBiZQp0aGUgYmVzdCBjaG9pY2UgZm9yIHlvdXIgYXBwbGljYXRpb24uIFRoZXJlIGFyZSB0aHJlZSBvcHRpb25zIGZvciB1c2luZwp1cmxsaWIzIG9uIEdvb2dsZSBBcHAgRW5naW5lOgoKMS4gWW91IGNhbiB1c2UgOmNsYXNzOmBBcHBFbmdpbmVNYW5hZ2VyYCB3aXRoIFVSTEZldGNoLiBVUkxGZXRjaCBpcwogICBjb3N0LWVmZmVjdGl2ZSBpbiBtYW55IGNpcmN1bXN0YW5jZXMgYXMgbG9uZyBhcyB5b3VyIHVzYWdlIGlzIHdpdGhpbiB0aGUKICAgbGltaXRhdGlvbnMuCjIuIFlvdSBjYW4gdXNlIGEgbm9ybWFsIDpjbGFzczpgfnVybGxpYjMuUG9vbE1hbmFnZXJgIGJ5IGVuYWJsaW5nIHNvY2tldHMuCiAgIFNvY2tldHMgYWxzbyBoYXZlIGBsaW1pdGF0aW9ucyBhbmQgcmVzdHJpY3Rpb25zCiAgIDxodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vYXBwZW5naW5lL2RvY3MvcHl0aG9uL3NvY2tldHMvXAogICAjbGltaXRhdGlvbnMtYW5kLXJlc3RyaWN0aW9ucz5gXyBhbmQgaGF2ZSBhIGxvd2VyIGZyZWUgcXVvdGEgdGhhbiBVUkxGZXRjaC4KICAgVG8gdXNlIHNvY2tldHMsIGJlIHN1cmUgdG8gc3BlY2lmeSB0aGUgZm9sbG93aW5nIGluIHlvdXIgYGBhcHAueWFtbGBgOjoKCiAgICAgICAgZW52X3ZhcmlhYmxlczoKICAgICAgICAgICAgR0FFX1VTRV9TT0NLRVRTX0hUVFBMSUIgOiAndHJ1ZScKCjMuIElmIHlvdSBhcmUgdXNpbmcgYEFwcCBFbmdpbmUgRmxleGlibGUKPGh0dHBzOi8vY2xvdWQuZ29vZ2xlLmNvbS9hcHBlbmdpbmUvZG9jcy9mbGV4aWJsZS8+YF8sIHlvdSBjYW4gdXNlIHRoZSBzdGFuZGFyZAo6Y2xhc3M6YFBvb2xNYW5hZ2VyYCB3aXRob3V0IGFueSBjb25maWd1cmF0aW9uIG9yIHNwZWNpYWwgZW52aXJvbm1lbnQgdmFyaWFibGVzLgoiIiIKCmZyb20gX19mdXR1cmVfXyBpbXBvcnQgYWJzb2x1dGVfaW1wb3J0CmltcG9ydCBpbwppbXBvcnQgbG9nZ2luZwppbXBvcnQgd2FybmluZ3MKZnJvbSAuLnBhY2thZ2VzLnNpeC5tb3Zlcy51cmxsaWIucGFyc2UgaW1wb3J0IHVybGpvaW4KCmZyb20gLi5leGNlcHRpb25zIGltcG9ydCAoCiAgICBIVFRQRXJyb3IsCiAgICBIVFRQV2FybmluZywKICAgIE1heFJldHJ5RXJyb3IsCiAgICBQcm90b2NvbEVycm9yLAogICAgVGltZW91dEVycm9yLAogICAgU1NMRXJyb3IKKQoKZnJvbSAuLnJlcXVlc3QgaW1wb3J0IFJlcXVlc3RNZXRob2RzCmZyb20gLi5yZXNwb25zZSBpbXBvcnQgSFRUUFJlc3BvbnNlCmZyb20gLi51dGlsLnRpbWVvdXQgaW1wb3J0IFRpbWVvdXQKZnJvbSAuLnV0aWwucmV0cnkgaW1wb3J0IFJldHJ5CmZyb20gLiBpbXBvcnQgX2FwcGVuZ2luZV9lbnZpcm9uCgp0cnk6CiAgICBmcm9tIGdvb2dsZS5hcHBlbmdpbmUuYXBpIGltcG9ydCB1cmxmZXRjaApleGNlcHQgSW1wb3J0RXJyb3I6CiAgICB1cmxmZXRjaCA9IE5vbmUKCgpsb2cgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCgpjbGFzcyBBcHBFbmdpbmVQbGF0Zm9ybVdhcm5pbmcoSFRUUFdhcm5pbmcpOgogICAgcGFzcwoKCmNsYXNzIEFwcEVuZ2luZVBsYXRmb3JtRXJyb3IoSFRUUEVycm9yKToKICAgIHBhc3MKCgpjbGFzcyBBcHBFbmdpbmVNYW5hZ2VyKFJlcXVlc3RNZXRob2RzKToKICAgICIiIgogICAgQ29ubmVjdGlvbiBtYW5hZ2VyIGZvciBHb29nbGUgQXBwIEVuZ2luZSBzYW5kYm94IGFwcGxpY2F0aW9ucy4KCiAgICBUaGlzIG1hbmFnZXIgdXNlcyB0aGUgVVJMRmV0Y2ggc2VydmljZSBkaXJlY3RseSBpbnN0ZWFkIG9mIHVzaW5nIHRoZQogICAgZW11bGF0ZWQgaHR0cGxpYiwgYW5kIGlzIHN1YmplY3QgdG8gVVJMRmV0Y2ggbGltaXRhdGlvbnMgYXMgZGVzY3JpYmVkIGluCiAgICB0aGUgQXBwIEVuZ2luZSBkb2N1bWVudGF0aW9uIGBoZXJlCiAgICA8aHR0cHM6Ly9jbG91ZC5nb29nbGUuY29tL2FwcGVuZ2luZS9kb2NzL3B5dGhvbi91cmxmZXRjaD5gXy4KCiAgICBOb3RhYmx5IGl0IHdpbGwgcmFpc2UgYW4gOmNsYXNzOmBBcHBFbmdpbmVQbGF0Zm9ybUVycm9yYCBpZjoKICAgICAgICAqIFVSTEZldGNoIGlzIG5vdCBhdmFpbGFibGUuCiAgICAgICAgKiBJZiB5b3UgYXR0ZW1wdCB0byB1c2UgdGhpcyBvbiBBcHAgRW5naW5lIEZsZXhpYmxlLCBhcyBmdWxsIHNvY2tldAogICAgICAgICAgc3VwcG9ydCBpcyBhdmFpbGFibGUuCiAgICAgICAgKiBJZiBhIHJlcXVlc3Qgc2l6ZSBpcyBtb3JlIHRoYW4gMTAgbWVnYWJ5dGVzLgogICAgICAgICogSWYgYSByZXNwb25zZSBzaXplIGlzIG1vcmUgdGhhbiAzMiBtZWdhYnR5ZXMuCiAgICAgICAgKiBJZiB5b3UgdXNlIGFuIHVuc3VwcG9ydGVkIHJlcXVlc3QgbWV0aG9kIHN1Y2ggYXMgT1BUSU9OUy4KCiAgICBCZXlvbmQgdGhvc2UgY2FzZXMsIGl0IHdpbGwgcmFpc2Ugbm9ybWFsIHVybGxpYjMgZXJyb3JzLgogICAgIiIiCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGhlYWRlcnM9Tm9uZSwgcmV0cmllcz1Ob25lLCB2YWxpZGF0ZV9jZXJ0aWZpY2F0ZT1UcnVlLAogICAgICAgICAgICAgICAgIHVybGZldGNoX3JldHJpZXM9VHJ1ZSk6CiAgICAgICAgaWYgbm90IHVybGZldGNoOgogICAgICAgICAgICByYWlzZSBBcHBFbmdpbmVQbGF0Zm9ybUVycm9yKAogICAgICAgICAgICAgICAgIlVSTEZldGNoIGlzIG5vdCBhdmFpbGFibGUgaW4gdGhpcyBlbnZpcm9ubWVudC4iKQoKICAgICAgICBpZiBpc19wcm9kX2FwcGVuZ2luZV9tdm1zKCk6CiAgICAgICAgICAgIHJhaXNlIEFwcEVuZ2luZVBsYXRmb3JtRXJyb3IoCiAgICAgICAgICAgICAgICAiVXNlIG5vcm1hbCB1cmxsaWIzLlBvb2xNYW5hZ2VyIGluc3RlYWQgb2YgQXBwRW5naW5lTWFuYWdlciIKICAgICAgICAgICAgICAgICJvbiBNYW5hZ2VkIFZNcywgYXMgdXNpbmcgVVJMRmV0Y2ggaXMgbm90IG5lY2Vzc2FyeSBpbiAiCiAgICAgICAgICAgICAgICAidGhpcyBlbnZpcm9ubWVudC4iKQoKICAgICAgICB3YXJuaW5ncy53YXJuKAogICAgICAgICAgICAidXJsbGliMyBpcyB1c2luZyBVUkxGZXRjaCBvbiBHb29nbGUgQXBwIEVuZ2luZSBzYW5kYm94IGluc3RlYWQgIgogICAgICAgICAgICAib2Ygc29ja2V0cy4gVG8gdXNlIHNvY2tldHMgZGlyZWN0bHkgaW5zdGVhZCBvZiBVUkxGZXRjaCBzZWUgIgogICAgICAgICAgICAiaHR0cHM6Ly91cmxsaWIzLnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC9yZWZlcmVuY2UvdXJsbGliMy5jb250cmliLmh0bWwuIiwKICAgICAgICAgICAgQXBwRW5naW5lUGxhdGZvcm1XYXJuaW5nKQoKICAgICAgICBSZXF1ZXN0TWV0aG9kcy5fX2luaXRfXyhzZWxmLCBoZWFkZXJzKQogICAgICAgIHNlbGYudmFsaWRhdGVfY2VydGlmaWNhdGUgPSB2YWxpZGF0ZV9jZXJ0aWZpY2F0ZQogICAgICAgIHNlbGYudXJsZmV0Y2hfcmV0cmllcyA9IHVybGZldGNoX3JldHJpZXMKCiAgICAgICAgc2VsZi5yZXRyaWVzID0gcmV0cmllcyBvciBSZXRyeS5ERUZBVUxUCgogICAgZGVmIF9fZW50ZXJfXyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZgoKICAgIGRlZiBfX2V4aXRfXyhzZWxmLCBleGNfdHlwZSwgZXhjX3ZhbCwgZXhjX3RiKToKICAgICAgICAjIFJldHVybiBGYWxzZSB0byByZS1yYWlzZSBhbnkgcG90ZW50aWFsIGV4Y2VwdGlvbnMKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgdXJsb3BlbihzZWxmLCBtZXRob2QsIHVybCwgYm9keT1Ob25lLCBoZWFkZXJzPU5vbmUsCiAgICAgICAgICAgICAgICByZXRyaWVzPU5vbmUsIHJlZGlyZWN0PVRydWUsIHRpbWVvdXQ9VGltZW91dC5ERUZBVUxUX1RJTUVPVVQsCiAgICAgICAgICAgICAgICAqKnJlc3BvbnNlX2t3KToKCiAgICAgICAgcmV0cmllcyA9IHNlbGYuX2dldF9yZXRyaWVzKHJldHJpZXMsIHJlZGlyZWN0KQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZvbGxvd19yZWRpcmVjdHMgPSAoCiAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3QgYW5kCiAgICAgICAgICAgICAgICAgICAgcmV0cmllcy5yZWRpcmVjdCAhPSAwIGFuZAogICAgICAgICAgICAgICAgICAgIHJldHJpZXMudG90YWwpCiAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsZmV0Y2guZmV0Y2goCiAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICBwYXlsb2FkPWJvZHksCiAgICAgICAgICAgICAgICBtZXRob2Q9bWV0aG9kLAogICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzIG9yIHt9LAogICAgICAgICAgICAgICAgYWxsb3dfdHJ1bmNhdGVkPUZhbHNlLAogICAgICAgICAgICAgICAgZm9sbG93X3JlZGlyZWN0cz1zZWxmLnVybGZldGNoX3JldHJpZXMgYW5kIGZvbGxvd19yZWRpcmVjdHMsCiAgICAgICAgICAgICAgICBkZWFkbGluZT1zZWxmLl9nZXRfYWJzb2x1dGVfdGltZW91dCh0aW1lb3V0KSwKICAgICAgICAgICAgICAgIHZhbGlkYXRlX2NlcnRpZmljYXRlPXNlbGYudmFsaWRhdGVfY2VydGlmaWNhdGUsCiAgICAgICAgICAgICkKICAgICAgICBleGNlcHQgdXJsZmV0Y2guRGVhZGxpbmVFeGNlZWRlZEVycm9yIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIFRpbWVvdXRFcnJvcihzZWxmLCBlKQoKICAgICAgICBleGNlcHQgdXJsZmV0Y2guSW52YWxpZFVSTEVycm9yIGFzIGU6CiAgICAgICAgICAgIGlmICd0b28gbGFyZ2UnIGluIHN0cihlKToKICAgICAgICAgICAgICAgIHJhaXNlIEFwcEVuZ2luZVBsYXRmb3JtRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgIlVSTEZldGNoIHJlcXVlc3QgdG9vIGxhcmdlLCBVUkxGZXRjaCBvbmx5ICIKICAgICAgICAgICAgICAgICAgICAic3VwcG9ydHMgcmVxdWVzdHMgdXAgdG8gMTBtYiBpbiBzaXplLiIsIGUpCiAgICAgICAgICAgIHJhaXNlIFByb3RvY29sRXJyb3IoZSkKCiAgICAgICAgZXhjZXB0IHVybGZldGNoLkRvd25sb2FkRXJyb3IgYXMgZToKICAgICAgICAgICAgaWYgJ1RvbyBtYW55IHJlZGlyZWN0cycgaW4gc3RyKGUpOgogICAgICAgICAgICAgICAgcmFpc2UgTWF4UmV0cnlFcnJvcihzZWxmLCB1cmwsIHJlYXNvbj1lKQogICAgICAgICAgICByYWlzZSBQcm90b2NvbEVycm9yKGUpCgogICAgICAgIGV4Y2VwdCB1cmxmZXRjaC5SZXNwb25zZVRvb0xhcmdlRXJyb3IgYXMgZToKICAgICAgICAgICAgcmFpc2UgQXBwRW5naW5lUGxhdGZvcm1FcnJvcigKICAgICAgICAgICAgICAgICJVUkxGZXRjaCByZXNwb25zZSB0b28gbGFyZ2UsIFVSTEZldGNoIG9ubHkgc3VwcG9ydHMiCiAgICAgICAgICAgICAgICAicmVzcG9uc2VzIHVwIHRvIDMybWIgaW4gc2l6ZS4iLCBlKQoKICAgICAgICBleGNlcHQgdXJsZmV0Y2guU1NMQ2VydGlmaWNhdGVFcnJvciBhcyBlOgogICAgICAgICAgICByYWlzZSBTU0xFcnJvcihlKQoKICAgICAgICBleGNlcHQgdXJsZmV0Y2guSW52YWxpZE1ldGhvZEVycm9yIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIEFwcEVuZ2luZVBsYXRmb3JtRXJyb3IoCiAgICAgICAgICAgICAgICAiVVJMRmV0Y2ggZG9lcyBub3Qgc3VwcG9ydCBtZXRob2Q6ICVzIiAlIG1ldGhvZCwgZSkKCiAgICAgICAgaHR0cF9yZXNwb25zZSA9IHNlbGYuX3VybGZldGNoX3Jlc3BvbnNlX3RvX2h0dHBfcmVzcG9uc2UoCiAgICAgICAgICAgIHJlc3BvbnNlLCByZXRyaWVzPXJldHJpZXMsICoqcmVzcG9uc2Vfa3cpCgogICAgICAgICMgSGFuZGxlIHJlZGlyZWN0PwogICAgICAgIHJlZGlyZWN0X2xvY2F0aW9uID0gcmVkaXJlY3QgYW5kIGh0dHBfcmVzcG9uc2UuZ2V0X3JlZGlyZWN0X2xvY2F0aW9uKCkKICAgICAgICBpZiByZWRpcmVjdF9sb2NhdGlvbjoKICAgICAgICAgICAgIyBDaGVjayBmb3IgcmVkaXJlY3QgcmVzcG9uc2UKICAgICAgICAgICAgaWYgKHNlbGYudXJsZmV0Y2hfcmV0cmllcyBhbmQgcmV0cmllcy5yYWlzZV9vbl9yZWRpcmVjdCk6CiAgICAgICAgICAgICAgICByYWlzZSBNYXhSZXRyeUVycm9yKHNlbGYsIHVybCwgInRvbyBtYW55IHJlZGlyZWN0cyIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBodHRwX3Jlc3BvbnNlLnN0YXR1cyA9PSAzMDM6CiAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gJ0dFVCcKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmV0cmllcyA9IHJldHJpZXMuaW5jcmVtZW50KG1ldGhvZCwgdXJsLCByZXNwb25zZT1odHRwX3Jlc3BvbnNlLCBfcG9vbD1zZWxmKQogICAgICAgICAgICAgICAgZXhjZXB0IE1heFJldHJ5RXJyb3I6CiAgICAgICAgICAgICAgICAgICAgaWYgcmV0cmllcy5yYWlzZV9vbl9yZWRpcmVjdDoKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgTWF4UmV0cnlFcnJvcihzZWxmLCB1cmwsICJ0b28gbWFueSByZWRpcmVjdHMiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBodHRwX3Jlc3BvbnNlCgogICAgICAgICAgICAgICAgcmV0cmllcy5zbGVlcF9mb3JfcmV0cnkoaHR0cF9yZXNwb25zZSkKICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygiUmVkaXJlY3RpbmcgJXMgLT4gJXMiLCB1cmwsIHJlZGlyZWN0X2xvY2F0aW9uKQogICAgICAgICAgICAgICAgcmVkaXJlY3RfdXJsID0gdXJsam9pbih1cmwsIHJlZGlyZWN0X2xvY2F0aW9uKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudXJsb3BlbigKICAgICAgICAgICAgICAgICAgICBtZXRob2QsIHJlZGlyZWN0X3VybCwgYm9keSwgaGVhZGVycywKICAgICAgICAgICAgICAgICAgICByZXRyaWVzPXJldHJpZXMsIHJlZGlyZWN0PXJlZGlyZWN0LAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dCwgKipyZXNwb25zZV9rdykKCiAgICAgICAgIyBDaGVjayBpZiB3ZSBzaG91bGQgcmV0cnkgdGhlIEhUVFAgcmVzcG9uc2UuCiAgICAgICAgaGFzX3JldHJ5X2FmdGVyID0gYm9vbChodHRwX3Jlc3BvbnNlLmdldGhlYWRlcignUmV0cnktQWZ0ZXInKSkKICAgICAgICBpZiByZXRyaWVzLmlzX3JldHJ5KG1ldGhvZCwgaHR0cF9yZXNwb25zZS5zdGF0dXMsIGhhc19yZXRyeV9hZnRlcik6CiAgICAgICAgICAgIHJldHJpZXMgPSByZXRyaWVzLmluY3JlbWVudCgKICAgICAgICAgICAgICAgIG1ldGhvZCwgdXJsLCByZXNwb25zZT1odHRwX3Jlc3BvbnNlLCBfcG9vbD1zZWxmKQogICAgICAgICAgICBsb2cuZGVidWcoIlJldHJ5OiAlcyIsIHVybCkKICAgICAgICAgICAgcmV0cmllcy5zbGVlcChodHRwX3Jlc3BvbnNlKQogICAgICAgICAgICByZXR1cm4gc2VsZi51cmxvcGVuKAogICAgICAgICAgICAgICAgbWV0aG9kLCB1cmwsCiAgICAgICAgICAgICAgICBib2R5PWJvZHksIGhlYWRlcnM9aGVhZGVycywKICAgICAgICAgICAgICAgIHJldHJpZXM9cmV0cmllcywgcmVkaXJlY3Q9cmVkaXJlY3QsCiAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQsICoqcmVzcG9uc2Vfa3cpCgogICAgICAgIHJldHVybiBodHRwX3Jlc3BvbnNlCgogICAgZGVmIF91cmxmZXRjaF9yZXNwb25zZV90b19odHRwX3Jlc3BvbnNlKHNlbGYsIHVybGZldGNoX3Jlc3AsICoqcmVzcG9uc2Vfa3cpOgoKICAgICAgICBpZiBpc19wcm9kX2FwcGVuZ2luZSgpOgogICAgICAgICAgICAjIFByb2R1Y3Rpb24gR0FFIGhhbmRsZXMgZGVmbGF0ZSBlbmNvZGluZyBhdXRvbWF0aWNhbGx5LCBidXQgZG9lcwogICAgICAgICAgICAjIG5vdCByZW1vdmUgdGhlIGVuY29kaW5nIGhlYWRlci4KICAgICAgICAgICAgY29udGVudF9lbmNvZGluZyA9IHVybGZldGNoX3Jlc3AuaGVhZGVycy5nZXQoJ2NvbnRlbnQtZW5jb2RpbmcnKQoKICAgICAgICAgICAgaWYgY29udGVudF9lbmNvZGluZyA9PSAnZGVmbGF0ZSc6CiAgICAgICAgICAgICAgICBkZWwgdXJsZmV0Y2hfcmVzcC5oZWFkZXJzWydjb250ZW50LWVuY29kaW5nJ10KCiAgICAgICAgdHJhbnNmZXJfZW5jb2RpbmcgPSB1cmxmZXRjaF9yZXNwLmhlYWRlcnMuZ2V0KCd0cmFuc2Zlci1lbmNvZGluZycpCiAgICAgICAgIyBXZSBoYXZlIGEgZnVsbCByZXNwb25zZSdzIGNvbnRlbnQsCiAgICAgICAgIyBzbyBsZXQncyBtYWtlIHN1cmUgd2UgZG9uJ3QgcmVwb3J0IG91cnNlbHZlcyBhcyBjaHVua2VkIGRhdGEuCiAgICAgICAgaWYgdHJhbnNmZXJfZW5jb2RpbmcgPT0gJ2NodW5rZWQnOgogICAgICAgICAgICBlbmNvZGluZ3MgPSB0cmFuc2Zlcl9lbmNvZGluZy5zcGxpdCgiLCIpCiAgICAgICAgICAgIGVuY29kaW5ncy5yZW1vdmUoJ2NodW5rZWQnKQogICAgICAgICAgICB1cmxmZXRjaF9yZXNwLmhlYWRlcnNbJ3RyYW5zZmVyLWVuY29kaW5nJ10gPSAnLCcuam9pbihlbmNvZGluZ3MpCgogICAgICAgIG9yaWdpbmFsX3Jlc3BvbnNlID0gSFRUUFJlc3BvbnNlKAogICAgICAgICAgICAjIEluIG9yZGVyIGZvciBkZWNvZGluZyB0byB3b3JrLCB3ZSBtdXN0IHByZXNlbnQgdGhlIGNvbnRlbnQgYXMKICAgICAgICAgICAgIyBhIGZpbGUtbGlrZSBvYmplY3QuCiAgICAgICAgICAgIGJvZHk9aW8uQnl0ZXNJTyh1cmxmZXRjaF9yZXNwLmNvbnRlbnQpLAogICAgICAgICAgICBtc2c9dXJsZmV0Y2hfcmVzcC5oZWFkZXJfbXNnLAogICAgICAgICAgICBoZWFkZXJzPXVybGZldGNoX3Jlc3AuaGVhZGVycywKICAgICAgICAgICAgc3RhdHVzPXVybGZldGNoX3Jlc3Auc3RhdHVzX2NvZGUsCiAgICAgICAgICAgICoqcmVzcG9uc2Vfa3cKICAgICAgICApCgogICAgICAgIHJldHVybiBIVFRQUmVzcG9uc2UoCiAgICAgICAgICAgIGJvZHk9aW8uQnl0ZXNJTyh1cmxmZXRjaF9yZXNwLmNvbnRlbnQpLAogICAgICAgICAgICBoZWFkZXJzPXVybGZldGNoX3Jlc3AuaGVhZGVycywKICAgICAgICAgICAgc3RhdHVzPXVybGZldGNoX3Jlc3Auc3RhdHVzX2NvZGUsCiAgICAgICAgICAgIG9yaWdpbmFsX3Jlc3BvbnNlPW9yaWdpbmFsX3Jlc3BvbnNlLAogICAgICAgICAgICAqKnJlc3BvbnNlX2t3CiAgICAgICAgKQoKICAgIGRlZiBfZ2V0X2Fic29sdXRlX3RpbWVvdXQoc2VsZiwgdGltZW91dCk6CiAgICAgICAgaWYgdGltZW91dCBpcyBUaW1lb3V0LkRFRkFVTFRfVElNRU9VVDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUgICMgRGVmZXIgdG8gVVJMRmV0Y2gncyBkZWZhdWx0LgogICAgICAgIGlmIGlzaW5zdGFuY2UodGltZW91dCwgVGltZW91dCk6CiAgICAgICAgICAgIGlmIHRpbWVvdXQuX3JlYWQgaXMgbm90IE5vbmUgb3IgdGltZW91dC5fY29ubmVjdCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHdhcm5pbmdzLndhcm4oCiAgICAgICAgICAgICAgICAgICAgIlVSTEZldGNoIGRvZXMgbm90IHN1cHBvcnQgZ3JhbnVsYXIgdGltZW91dCBzZXR0aW5ncywgIgogICAgICAgICAgICAgICAgICAgICJyZXZlcnRpbmcgdG8gdG90YWwgb3IgZGVmYXVsdCBVUkxGZXRjaCB0aW1lb3V0LiIsCiAgICAgICAgICAgICAgICAgICAgQXBwRW5naW5lUGxhdGZvcm1XYXJuaW5nKQogICAgICAgICAgICByZXR1cm4gdGltZW91dC50b3RhbAogICAgICAgIHJldHVybiB0aW1lb3V0CgogICAgZGVmIF9nZXRfcmV0cmllcyhzZWxmLCByZXRyaWVzLCByZWRpcmVjdCk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UocmV0cmllcywgUmV0cnkpOgogICAgICAgICAgICByZXRyaWVzID0gUmV0cnkuZnJvbV9pbnQoCiAgICAgICAgICAgICAgICByZXRyaWVzLCByZWRpcmVjdD1yZWRpcmVjdCwgZGVmYXVsdD1zZWxmLnJldHJpZXMpCgogICAgICAgIGlmIHJldHJpZXMuY29ubmVjdCBvciByZXRyaWVzLnJlYWQgb3IgcmV0cmllcy5yZWRpcmVjdDoKICAgICAgICAgICAgd2FybmluZ3Mud2FybigKICAgICAgICAgICAgICAgICJVUkxGZXRjaCBvbmx5IHN1cHBvcnRzIHRvdGFsIHJldHJpZXMgYW5kIGRvZXMgbm90ICIKICAgICAgICAgICAgICAgICJyZWNvZ25pemUgY29ubmVjdCwgcmVhZCwgb3IgcmVkaXJlY3QgcmV0cnkgcGFyYW1ldGVycy4iLAogICAgICAgICAgICAgICAgQXBwRW5naW5lUGxhdGZvcm1XYXJuaW5nKQoKICAgICAgICByZXR1cm4gcmV0cmllcwoKCiMgQWxpYXMgbWV0aG9kcyBmcm9tIF9hcHBlbmdpbmVfZW52aXJvbiB0byBtYWludGFpbiBwdWJsaWMgQVBJIGludGVyZmFjZS4KCmlzX2FwcGVuZ2luZSA9IF9hcHBlbmdpbmVfZW52aXJvbi5pc19hcHBlbmdpbmUKaXNfYXBwZW5naW5lX3NhbmRib3ggPSBfYXBwZW5naW5lX2Vudmlyb24uaXNfYXBwZW5naW5lX3NhbmRib3gKaXNfbG9jYWxfYXBwZW5naW5lID0gX2FwcGVuZ2luZV9lbnZpcm9uLmlzX2xvY2FsX2FwcGVuZ2luZQppc19wcm9kX2FwcGVuZ2luZSA9IF9hcHBlbmdpbmVfZW52aXJvbi5pc19wcm9kX2FwcGVuZ2luZQppc19wcm9kX2FwcGVuZ2luZV9tdm1zID0gX2FwcGVuZ2luZV9lbnZpcm9uLmlzX3Byb2RfYXBwZW5naW5lX212bXMK
