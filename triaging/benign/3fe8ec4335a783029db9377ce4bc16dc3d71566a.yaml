statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/typesutil/1.9.4/typesutil-1.9.4/typesutil-1.9.4/typesutil/__init__.py
  contents:
  - name: Date.__ne__
    score: 0.0
    code: |-
      def __ne__(self, other):
              if isinstance(other, Date):
                  return self.day_count != other.day_count
              elif hasattr(other, "day_count"):
                  return NotImplemented
              else:
                  return True
    tokens: TARGETED_FILE resume load_global isinstance load_fast other load_global Date call pop_jump_if_false TO_NUMBER load_fast self load_attr day_count load_fast other load_attr day_count compare_op != return_value load_global REFLECTION_DYNAMIC_READ load_fast other load_const day_count call pop_jump_if_false TO_NUMBER load_global NotImplemented return_value return_const True
    hash: 0eca9d3e896d4b20d388150466fbcfbf15bdaddd6b08b9e60f65c08e72ad04e9
sources:
  .repo_cache/malicious_repos/pypi_malregistry/typesutil/1.9.4/typesutil-1.9.4/typesutil-1.9.4/typesutil/__init__.py: X19hdXRob3JfXyA9ICJGcmFuY2VzY28gUmljY2lhcmRpIDxmcmFuY2VzY29yMjAxMCBhdCB5YWhvby5pdD4iCgoKaW1wb3J0IG51bWJlcnMKaW1wb3J0IHRpbWUKZnJvbSBkZWNpbWFsIGltcG9ydCBEZWNpbWFsCmZyb20gZnJhY3Rpb25zIGltcG9ydCBGcmFjdGlvbgpmcm9tIG1hdGggaW1wb3J0IGZsb29yCgpmcm9tIC5jb21tb24gaW1wb3J0IHZlcmlmeV9mcmFjdGlvbmFsX3ZhbHVlLCB2ZXJpZnlfZnJhY3Rpb25hbF92YWx1ZV9udW1fZGVuCmZyb20gLiBpbXBvcnQgd2VzdGVybiwgbW9kZXJuCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgT1MgZGVwZW5kZW50IGZ1bmN0aW9ucwojCmRlZiBnZXRfbW9tZW50X2NvbXBsZXRlKCk6CiAgICAiIiJSZXR1cm4gbG9jYWwgZGF0ZSBhbmQgdGltZSBhcyBkYXlfY291bnQsIGxvY2FsIHRpbWUgYXMgZGF5IGZyYWN0aW9uLCBhbmQsCiAgICBpZiBwb3NzaWJsZSwgZGlzdGFuY2UgZnJvbSBVVEMgYXMgZnJhY3Rpb24gb2YgYSBkYXkuIiIiCiAgICB0cnk6CiAgICAgICAgbW9tZW50X25zID0gKHRpbWUudGltZV9ucygpKSAgIyB0aW1lIGluIG5zIGZyb20gZXBvY2g7IG5vdGUgZXBvY2ggaXMgcGxhdGZvcm0gZGVwZW5kZW50CiAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgbW9tZW50X25zID0gaW50KHRpbWUudGltZSgpICogMV8wMDBfMDAwXzAwMCkgICMgdGltZSgpIHJldHVybnMgYSBmbG9hdCBpbiBzZWNvbmQKICAgICMgZm9yIHRoZSBtb21lbnQgd2UgYXJlIHVzaW5nIHRpbWUgbW9kdWxlJ3MgZnVuY3Rpb25zIHRvIGdldCBsb2NhbHRpbWUKICAgICMgVE9ETzogY2hlY2sgaWYgcG9zc2libGUgdG8gaW1wbGVtZW50IHNvbWV0aGluZyBpbmRlcGVuZGVudCBmcm9tIHRpbWUgbW9kdWxlLCBzZWUgZS5nLiB0emxvY2FsCiAgICBzZWNvbmRzLCBuYW5vc2Vjb25kcyA9IGRpdm1vZChtb21lbnRfbnMsIDFfMDAwXzAwMF8wMDApCiAgICBtb21lbnQgPSB0aW1lLmxvY2FsdGltZShzZWNvbmRzKQogICAgeWVhciA9IG1vbWVudC50bV95ZWFyCiAgICBkYXlzX2JlZm9yZV95ZWFyID0gKCh5ZWFyIC0gMSkgKiAzNjUgKyAoeWVhciAtIDEpIC8vIDQgLSAoeWVhciAtIDEpIC8vIDEwMCArICh5ZWFyIC0gMSkgLy8gNDAwKQogICAgZGF5X2NvdW50ID0gZGF5c19iZWZvcmVfeWVhciArIG1vbWVudC50bV95ZGF5CiAgICBkYXlfZnJhYyA9IChGcmFjdGlvbihtb21lbnQudG1faG91ciwgMjQpICAgKyBGcmFjdGlvbihtb21lbnQudG1fbWluLCAxNDQwKSArCiAgICAgICAgICAgICAgICBGcmFjdGlvbihtb21lbnQudG1fc2VjLCA4NjQwMCkgKyBGcmFjdGlvbihuYW5vc2Vjb25kcywgODZfNDAwXzAwMF8wMDBfMDAwKSkKICAgIHV0Y29mZnNldCA9IEZyYWN0aW9uKG1vbWVudC50bV9nbXRvZmYsIDg2NDAwKQogICAgcmV0dXJuIGRheV9jb3VudCwgZGF5X2ZyYWMsIHV0Y29mZnNldAoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgRGF0ZQojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCmNsYXNzIERhdGU6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZGF5X2NvdW50KToKICAgICAgICAjIFRPRE86IGNvbnNpZGVyIHVzaW5nIHRoZSBudW1iZXIgaGllcmFyY2h5CiAgICAgICAgaWYgaXNpbnN0YW5jZShkYXlfY291bnQsIGludCk6CiAgICAgICAgICAgIHNlbGYuX2RheV9jb3VudCA9IGRheV9jb3VudAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiZGF5X2NvdW50IGFyZ3VtZW50IGZvciBEYXRlIG11c3QgYmUgYW4gaW50ZWdlci4iKQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIHRvZGF5KGNscyk6CiAgICAgICAgcmV0dXJuIGNscyhnZXRfbW9tZW50X2NvbXBsZXRlKClbMF0pCgogICAgQHByb3BlcnR5CiAgICBkZWYgZGF5X2NvdW50KHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9kYXlfY291bnQKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgcmV0dXJuIGYidHlwZXN1dGlsLnt0eXBlKHNlbGYpLl9fbmFtZV9ffSh7c2VsZi5kYXlfY291bnR9KSIKCiAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gZiJSLkQuIHtzZWxmLmRheV9jb3VudH0iCgogICAgZGVmIF9fYWRkX18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWVEZWx0YSk6CiAgICAgICAgICAgIGlmIG5vdCBvdGhlci5pc19pbnRlZ2VyKCk6CiAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJEYXRlIG9iamVjdCBjYW5ub3QgYmUgYWRkZWQgdG8gbm9uIGludGVncmFsIFRpbWVEZWx0YS4iKQogICAgICAgICAgICByZXR1cm4gdHlwZShzZWxmKShzZWxmLmRheV9jb3VudCArIGludChvdGhlci5mcmFjdGlvbmFsX2RheXMpKSAgICMgbm90ZTogZnJhY3Rpb25hbCBkYXlzIGlzIGEgRnJhY3Rpb24KICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKCiAgICBfX3JhZGRfXyA9IF9fYWRkX18KCiAgICBkZWYgX19zdWJfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgRGF0ZSk6CiAgICAgICAgICAgIHJldHVybiBUaW1lRGVsdGEoc2VsZi5kYXlfY291bnQgLSBvdGhlci5kYXlfY291bnQpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lRGVsdGEpOgogICAgICAgICAgICBpZiBub3Qgb3RoZXIuaXNfaW50ZWdlcigpOgogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm9uIGludGVncmFsIFRpbWVEZWx0YSBjYW5ub3QgYmUgc3VidHJhY3RlZCBmcm9tIERhdGUuIikKICAgICAgICAgICAgcmV0dXJuIHR5cGUoc2VsZikoc2VsZi5kYXlfY291bnQgLSBpbnQob3RoZXIuZnJhY3Rpb25hbF9kYXlzKSkgICAjIG5vdGU6IGZyYWN0aW9uYWwgZGF5cyBpcyBhIEZyYWN0aW9uCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCgogICAgIyBDb21wYXJpc29uIG9wZXJhdG9ycwogICAgZGVmIF9fZXFfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgRGF0ZSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9jb3VudCA9PSBvdGhlci5kYXlfY291bnQKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJkYXlfY291bnQiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9fbmVfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgRGF0ZSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9jb3VudCAhPSBvdGhlci5kYXlfY291bnQKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJkYXlfY291bnQiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgX19ndF9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBEYXRlKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2NvdW50ID4gb3RoZXIuZGF5X2NvdW50CiAgICAgICAgZWxpZiBoYXNhdHRyKG90aGVyLCAiZGF5X2NvdW50Iik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihmIllvdSBjYW5ub3QgY29tcGFyZSAne3R5cGUoc2VsZikhc30nIHdpdGggJ3t0eXBlKG90aGVyKSFzfScuIikKCiAgICBkZWYgX19nZV9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBEYXRlKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGF5X2NvdW50ID49IG90aGVyLmRheV9jb3VudAogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImRheV9jb3VudCIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoZiJZb3UgY2Fubm90IGNvbXBhcmUgJ3t0eXBlKHNlbGYpIXN9JyB3aXRoICd7dHlwZShvdGhlcikhc30nLiIpCgogICAgZGVmIF9fbHRfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgRGF0ZSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9jb3VudCA8IG90aGVyLmRheV9jb3VudAogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImRheV9jb3VudCIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoZiJZb3UgY2Fubm90IGNvbXBhcmUgJ3t0eXBlKHNlbGYpIXN9JyB3aXRoICd7dHlwZShvdGhlcikhc30nLiIpCgogICAgZGVmIF9fbGVfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgRGF0ZSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9jb3VudCA8PSBvdGhlci5kYXlfY291bnQKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJkYXlfY291bnQiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKGYiWW91IGNhbm5vdCBjb21wYXJlICd7dHlwZShzZWxmKSFzfScgd2l0aCAne3R5cGUob3RoZXIpIXN9Jy4iKQoKICAgICMgaGFzaCB2YWx1ZQogICAgZGVmIF9faGFzaF9fKHNlbGYpOgogICAgICAgIHJldHVybiBoYXNoKHNlbGYuX2RheV9jb3VudCkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiByZWdpc3Rlcl9uZXdfY2FsZW5kYXIoY2xzLCBhdHRyaWJ1dGVfbmFtZSwgY2FsZW5kYXJfY2xhc3MpOgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGF0dHJpYnV0ZV9uYW1lLCBzdHIpIG9yIG5vdCBhdHRyaWJ1dGVfbmFtZS5pc2lkZW50aWZpZXIoKToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmIkludmFsaWQgY2FsZW5kYXIgYXR0cmlidXRlIG5hbWU6IHthdHRyaWJ1dGVfbmFtZX0uIikKICAgICAgICBpZiBoYXNhdHRyKGNscywgYXR0cmlidXRlX25hbWUpOgogICAgICAgICAgICByYWlzZSBBdHRyaWJ1dGVFcnJvcihmIkNhbGVuZGFyIGF0dHJpYnV0ZSBhbHJlYWR5IGV4aXN0aW5nOiB7YXR0cmlidXRlX25hbWV9LiIpCiAgICAgICAgaWYgbm90IGhhc2F0dHIoY2FsZW5kYXJfY2xhc3MsICJmcm9tX3JhdGFfZGllIik6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiQ2FsZW5kYXIgY2xhc3MgZG9lcyBub3QgaGF2ZSBtZXRob2QgZnJvbV9yYXRhX2RpZS4iKQogICAgICAgIGlmIG5vdCBoYXNhdHRyKGNhbGVuZGFyX2NsYXNzLCAidG9fcmF0YV9kaWUiKToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJDYWxlbmRhciBjbGFzcyBkb2VzIG5vdCBoYXZlIG1ldGhvZCB0b19yYXRhX2RpZS4iKQoKICAgICAgICBjbGFzcyBNb2RpZmllZENsYXNzKHR5cGUpOgogICAgICAgICAgICBkZWYgX19jYWxsX18oa2xhc3MsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgICAgICAgICBjYWxlbmRhcl9vYmogPSBzdXBlcigpLl9fY2FsbF9fKCphcmdzLCAqKmt3YXJncykKICAgICAgICAgICAgICAgIGRhdGVfb2JqID0gY2xzKGNhbGVuZGFyX29iai50b19yYXRhX2RpZSgpKQogICAgICAgICAgICAgICAgc2V0YXR0cihkYXRlX29iaiwgYXR0cmlidXRlX25hbWUsIGNhbGVuZGFyX29iaikKICAgICAgICAgICAgICAgIHJldHVybiBkYXRlX29iagoKICAgICAgICAjIENyZWF0ZSB0aGUgbW9kaWZpZWQgY2FsZW5kYXIgY2xhc3MKICAgICAgICBuZXdfY2xhc3NfbmFtZSA9IGYie2NhbGVuZGFyX2NsYXNzLl9fbmFtZV9ffUlue2Nscy5fX25hbWVfX30iCiAgICAgICAgbW9kaWZpZWRfY2FsZW5kYXJfY2xhc3MgPSBNb2RpZmllZENsYXNzKG5ld19jbGFzc19uYW1lLCAoY2FsZW5kYXJfY2xhc3MsKSwge30pCgogICAgICAgIGNsYXNzIENhbGVuZGFyQXR0cmlidXRlOgogICAgICAgICAgICAjIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGNvbnRleHQgZGVwZW5kZW50IGF0dHJpYnV0ZQogICAgICAgICAgICBkZWYgX19pbml0X18oc2VsZiwgYXR0cl9uYW1lLCBtb2RpZl9jYWxlbmRhcl9jbGFzcyk6CiAgICAgICAgICAgICAgICBzZWxmLmF0dHJpYnV0ZV9uYW1lID0gYXR0cl9uYW1lCiAgICAgICAgICAgICAgICBzZWxmLm1vZGlmaWVkX2NhbGVuZGFyX2NsYXNzID0gbW9kaWZfY2FsZW5kYXJfY2xhc3MKCiAgICAgICAgICAgIGRlZiBfX2dldF9fKHNlbGYsIGluc3RhbmNlLCBvd25lcik6CiAgICAgICAgICAgICAgICBpZiBpbnN0YW5jZSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLm1vZGlmaWVkX2NhbGVuZGFyX2NsYXNzCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGFzc2VydCBzZWxmLmF0dHJpYnV0ZV9uYW1lIG5vdCBpbiBpbnN0YW5jZS5fX2RpY3RfXwogICAgICAgICAgICAgICAgICAgIGRhdGVfb2JqID0gc2VsZi5tb2RpZmllZF9jYWxlbmRhcl9jbGFzcy5mcm9tX3JhdGFfZGllKGluc3RhbmNlLmRheV9jb3VudCkKICAgICAgICAgICAgICAgICAgICBjYWxlbmRhcl9vYmogPSBnZXRhdHRyKGRhdGVfb2JqLCBzZWxmLmF0dHJpYnV0ZV9uYW1lKQogICAgICAgICAgICAgICAgICAgIHNldGF0dHIoaW5zdGFuY2UsIHNlbGYuYXR0cmlidXRlX25hbWUsIGNhbGVuZGFyX29iaikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsZW5kYXJfb2JqCgogICAgICAgIHNldGF0dHIoY2xzLCBhdHRyaWJ1dGVfbmFtZSwgQ2FsZW5kYXJBdHRyaWJ1dGUoYXR0cmlidXRlX25hbWUsIG1vZGlmaWVkX2NhbGVuZGFyX2NsYXNzKSkKCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBSZWdpc3RlciBjdXJyZW50IGNhbGVuZGFycwojCkRhdGUucmVnaXN0ZXJfbmV3X2NhbGVuZGFyKCJncmVnb3JpYW4iLCB3ZXN0ZXJuLkdyZWdvcmlhbkNhbGVuZGFyKQpEYXRlLnJlZ2lzdGVyX25ld19jYWxlbmRhcigiaXNvIiwgbW9kZXJuLklzb0NhbGVuZGFyKQoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgVGltZQojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCmNsYXNzIFRpbWU6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbnVtZXJhdG9yLCBkZW5vbWluYXRvcj1Ob25lLCAqLCB1dGNvZmZzZXQ9Tm9uZSk6CiAgICAgICAgaWYgZGVub21pbmF0b3IgaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5fZGF5X2ZyYWMgPSB2ZXJpZnlfZnJhY3Rpb25hbF92YWx1ZShudW1lcmF0b3IsIG1pbj0wLCBtYXhfZXhjbD0xKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuX2RheV9mcmFjID0gdmVyaWZ5X2ZyYWN0aW9uYWxfdmFsdWVfbnVtX2RlbihudW1lcmF0b3IsIGRlbm9taW5hdG9yLCBtaW49MCwgbWF4X2V4Y2w9MSkKICAgICAgICBpZiB1dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgIyBuYWl2ZSBpbnN0YW5jZQogICAgICAgICAgICBzZWxmLl91dGNvZmZzZXQgPSBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBhd2FyZSBpbnN0YW5jZQogICAgICAgICAgICBzZWxmLl91dGNvZmZzZXQgPSB2ZXJpZnlfZnJhY3Rpb25hbF92YWx1ZSh1dGNvZmZzZXQsIG1pbj0tMSwgbWF4PTEpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgbm93KGNscywgdXRjb2Zmc2V0PU5vbmUpOgogICAgICAgIGN1cnJlbnRfbW9tZW50ID0gZ2V0X21vbWVudF9jb21wbGV0ZSgpCiAgICAgICAgaWYgdXRjb2Zmc2V0IGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBjbHMoY3VycmVudF9tb21lbnRbMV0sIHV0Y29mZnNldD1jdXJyZW50X21vbWVudFsyXSkKICAgICAgICBlbHNlOgogICAgICAgICAgICB2YWxpZF91dGNvZmZzZXQgPSB2ZXJpZnlfZnJhY3Rpb25hbF92YWx1ZSh1dGNvZmZzZXQsIG1pbj0tMSwgbWF4PTEpCiAgICAgICAgICAgIGRlbHRhID0gY3VycmVudF9tb21lbnRbMl0gLSB2YWxpZF91dGNvZmZzZXQKICAgICAgICAgICAgZGF5X2ZyYWNfdGVtcCA9IGN1cnJlbnRfbW9tZW50WzFdIC0gZGVsdGEgKyAyICAjICsyIG5lZWRlZCB0byBhdm9pZCB1bmRlcnJ1bnMKICAgICAgICAgICAgbmV3X2RheV9mcmFjID0gZGF5X2ZyYWNfdGVtcCAtIGludChkYXlfZnJhY190ZW1wKSAgIyBhcyBzbyB3ZSBlbGltaW5hdGUgdGhlICsyIGFib3ZlCiAgICAgICAgICAgIHJldHVybiBjbHMobmV3X2RheV9mcmFjLCB1dGNvZmZzZXQ9dmFsaWRfdXRjb2Zmc2V0KQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIGxvY2Fsbm93KGNscyk6CiAgICAgICAgY3VycmVudF9tb21lbnQgPSBnZXRfbW9tZW50X2NvbXBsZXRlKCkKICAgICAgICByZXR1cm4gY2xzKGN1cnJlbnRfbW9tZW50WzFdKQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIHV0Y25vdyhjbHMpOgogICAgICAgIGN1cnJlbnRfbW9tZW50ID0gZ2V0X21vbWVudF9jb21wbGV0ZSgpCiAgICAgICAgdXRjbm93ID0gY3VycmVudF9tb21lbnRbMV0gLSBjdXJyZW50X21vbWVudFsyXQogICAgICAgIGlmIHV0Y25vdyA8IDA6CiAgICAgICAgICAgIHV0Y25vdyArPSAxCiAgICAgICAgZWxpZiB1dGNub3cgPj0gMToKICAgICAgICAgICAgdXRjbm93IC09IDEKICAgICAgICByZXR1cm4gY2xzKHV0Y25vdykKCiAgICBAcHJvcGVydHkKICAgIGRlZiBkYXlfZnJhYyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5fZGF5X2ZyYWMKCiAgICBAcHJvcGVydHkKICAgIGRlZiB1dGNvZmZzZXQoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX3V0Y29mZnNldAoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICBpZiBzZWxmLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gZiJ0eXBlc3V0aWwue3R5cGUoc2VsZikuX19uYW1lX199KCd7c2VsZi5kYXlfZnJhYyFzfScpIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBmInR5cGVzdXRpbC57dHlwZShzZWxmKS5fX25hbWVfX30oJ3tzZWxmLmRheV9mcmFjIXN9JywgdXRjb2Zmc2V0PSd7c2VsZi51dGNvZmZzZXQhc30nKSIKCiAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICBpZiBzZWxmLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gZiJ7c2VsZi5kYXlfZnJhYyFzfSBvZiBhIGRheSIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gZiJ7c2VsZi5kYXlfZnJhYyFzfSBvZiBhIGRheSwge3NlbGYudXRjb2Zmc2V0IXN9IG9mIGEgZGF5IGZyb20gVVRDIgoKICAgICMgTWF0aCBvcGVyYXRvcnMKICAgIGRlZiBfX2FkZF9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lRGVsdGEpOgogICAgICAgICAgICB0b3RhbCA9IHNlbGYuZGF5X2ZyYWMgKyBvdGhlci5mcmFjdGlvbmFsX2RheXMKICAgICAgICAgICAgcmV0dXJuIHR5cGUoc2VsZikodG90YWwgLSBmbG9vcih0b3RhbCksIHV0Y29mZnNldD1zZWxmLnV0Y29mZnNldCkKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKCiAgICBfX3JhZGRfXyA9IF9fYWRkX18KCiAgICBkZWYgX19zdWJfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZSk6CiAgICAgICAgICAgIGlmIHNlbGYudXRjb2Zmc2V0OgogICAgICAgICAgICAgICAgaWYgb3RoZXIudXRjb2Zmc2V0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiWW91IGNhbm5vdCBtaXggbmFpdmUgYW5kIGF3YXJlIGluc3RhbmNlcy4iKQogICAgICAgICAgICAgICAgc2VsZl91dGMgPSBzZWxmLmRheV9mcmFjIC0gc2VsZi51dGNvZmZzZXQKICAgICAgICAgICAgICAgIG90aGVyX3V0YyA9IG90aGVyLmRheV9mcmFjIC0gIG90aGVyLnV0Y29mZnNldAogICAgICAgICAgICAgICAgZGVsdGEgPSBzZWxmX3V0YyAtIG90aGVyX3V0YwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgb3RoZXIudXRjb2Zmc2V0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIllvdSBjYW5ub3QgbWl4IG5haXZlIGFuZCBhd2FyZSBpbnN0YW5jZXMuIikKICAgICAgICAgICAgICAgIGRlbHRhID0gc2VsZi5kYXlfZnJhYyAtIG90aGVyLmRheV9mcmFjCiAgICAgICAgICAgIGlmIGRlbHRhIDw9IEZyYWN0aW9uKC0xLCAyKToKICAgICAgICAgICAgICAgIGRlbHRhICs9IDEKICAgICAgICAgICAgICAgIHdoaWxlIGRlbHRhIDw9IEZyYWN0aW9uKC0xLCAyKToKICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSAxCiAgICAgICAgICAgIGVsaWYgZGVsdGEgPiBGcmFjdGlvbigxLCAyKToKICAgICAgICAgICAgICAgIGRlbHRhIC09IDEKICAgICAgICAgICAgICAgIHdoaWxlIGRlbHRhID4gRnJhY3Rpb24oMSwgMik6CiAgICAgICAgICAgICAgICAgICAgZGVsdGEgLT0gMQogICAgICAgICAgICByZXR1cm4gVGltZURlbHRhKGRlbHRhKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgdG90YWwgPSBzZWxmLmRheV9mcmFjIC0gb3RoZXIuZnJhY3Rpb25hbF9kYXlzCiAgICAgICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHRvdGFsIC0gZmxvb3IodG90YWwpLCB1dGNvZmZzZXQ9c2VsZi51dGNvZmZzZXQpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCgogICAgIyBDb21wYXJpc29uIG9wZXJhdG9ycwogICAgZGVmIF9fZXFfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZSk6CiAgICAgICAgICAgIGlmIHNlbGYudXRjb2Zmc2V0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5kYXlfZnJhYyA9PSBvdGhlci5kYXlfZnJhYwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIG90aGVyLnV0Y29mZnNldCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5kYXlfZnJhYyAtIHNlbGYudXRjb2Zmc2V0ID09IG90aGVyLmRheV9mcmFjIC0gb3RoZXIudXRjb2Zmc2V0CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImRheV9mcmFjIikgYW5kIGhhc2F0dHIob3RoZXIsICJ1dGNvZmZzZXQiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9fbmVfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZSk6CiAgICAgICAgICAgIGlmIHNlbGYudXRjb2Zmc2V0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5kYXlfZnJhYyAhPSBvdGhlci5kYXlfZnJhYwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgb3RoZXIudXRjb2Zmc2V0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjIC0gc2VsZi51dGNvZmZzZXQgIT0gb3RoZXIuZGF5X2ZyYWMgLSBvdGhlci51dGNvZmZzZXQKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJkYXlfZnJhYyIpIGFuZCBoYXNhdHRyKG90aGVyLCAidXRjb2Zmc2V0Iik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIF9fZ3RfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZSk6CiAgICAgICAgICAgIGlmIHNlbGYudXRjb2Zmc2V0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5kYXlfZnJhYyA+IG90aGVyLmRheV9mcmFjCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiWW91IGNhbm5vdCBjb21wYXJlIGEgbmFpdmUgVGltZSBpbnN0YW5jZSB3aXRoIGFuIGF3YXJlIG9uZS4iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgb3RoZXIudXRjb2Zmc2V0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjIC0gc2VsZi51dGNvZmZzZXQgPiBvdGhlci5kYXlfZnJhYyAtIG90aGVyLnV0Y29mZnNldAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoIllvdSBjYW5ub3QgY29tcGFyZSBhbiBhd2FyZSBUaW1lIGluc3RhbmNlIHdpdGggYSBuYWl2ZSBvbmUuIikKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJkYXlfZnJhYyIpIGFuZCBoYXNhdHRyKG90aGVyLCAidXRjb2Zmc2V0Iik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihmIllvdSBjYW5ub3QgY29tcGFyZSAne3R5cGUoc2VsZikhc30nIHdpdGggJ3t0eXBlKG90aGVyKSFzfScuIikKCiAgICBkZWYgX19nZV9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lKToKICAgICAgICAgICAgaWYgc2VsZi51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgIGlmIG90aGVyLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjID49IG90aGVyLmRheV9mcmFjCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiWW91IGNhbm5vdCBjb21wYXJlIGEgbmFpdmUgVGltZSBpbnN0YW5jZSB3aXRoIGFuIGF3YXJlIG9uZS4iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgb3RoZXIudXRjb2Zmc2V0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjIC0gc2VsZi51dGNvZmZzZXQgPj0gb3RoZXIuZGF5X2ZyYWMgLSBvdGhlci51dGNvZmZzZXQKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJZb3UgY2Fubm90IGNvbXBhcmUgYW4gYXdhcmUgVGltZSBpbnN0YW5jZSB3aXRoIGEgbmFpdmUgb25lLiIpCiAgICAgICAgZWxpZiBoYXNhdHRyKG90aGVyLCAiZGF5X2ZyYWMiKSBhbmQgaGFzYXR0cihvdGhlciwgInV0Y29mZnNldCIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoZiJZb3UgY2Fubm90IGNvbXBhcmUgJ3t0eXBlKHNlbGYpIXN9JyB3aXRoICd7dHlwZShvdGhlcikhc30nLiIpCgogICAgZGVmIF9fbHRfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZSk6CiAgICAgICAgICAgIGlmIHNlbGYudXRjb2Zmc2V0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICBpZiBvdGhlci51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5kYXlfZnJhYyA8IG90aGVyLmRheV9mcmFjCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiWW91IGNhbm5vdCBjb21wYXJlIGEgbmFpdmUgVGltZSBpbnN0YW5jZSB3aXRoIGFuIGF3YXJlIG9uZS4iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgb3RoZXIudXRjb2Zmc2V0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjIC0gc2VsZi51dGNvZmZzZXQgPCBvdGhlci5kYXlfZnJhYyAtIG90aGVyLnV0Y29mZnNldAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoIllvdSBjYW5ub3QgY29tcGFyZSBhbiBhd2FyZSBUaW1lIGluc3RhbmNlIHdpdGggYSBuYWl2ZSBvbmUuIikKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJkYXlfZnJhYyIpIGFuZCBoYXNhdHRyKG90aGVyLCAidXRjb2Zmc2V0Iik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihmIllvdSBjYW5ub3QgY29tcGFyZSAne3R5cGUoc2VsZikhc30nIHdpdGggJ3t0eXBlKG90aGVyKSFzfScuIikKCiAgICBkZWYgX19sZV9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lKToKICAgICAgICAgICAgaWYgc2VsZi51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgICAgIGlmIG90aGVyLnV0Y29mZnNldCBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjIDw9IG90aGVyLmRheV9mcmFjCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiWW91IGNhbm5vdCBjb21wYXJlIGEgbmFpdmUgVGltZSBpbnN0YW5jZSB3aXRoIGFuIGF3YXJlIG9uZS4iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgb3RoZXIudXRjb2Zmc2V0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRheV9mcmFjIC0gc2VsZi51dGNvZmZzZXQgPD0gb3RoZXIuZGF5X2ZyYWMgLSBvdGhlci51dGNvZmZzZXQKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJZb3UgY2Fubm90IGNvbXBhcmUgYW4gYXdhcmUgVGltZSBpbnN0YW5jZSB3aXRoIGEgbmFpdmUgb25lLiIpCiAgICAgICAgZWxpZiBoYXNhdHRyKG90aGVyLCAiZGF5X2ZyYWMiKSBhbmQgaGFzYXR0cihvdGhlciwgInV0Y29mZnNldCIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoZiJZb3UgY2Fubm90IGNvbXBhcmUgJ3t0eXBlKHNlbGYpIXN9JyB3aXRoICd7dHlwZShvdGhlcikhc30nLiIpCgogICAgIyBoYXNoIHZhbHVlCiAgICBkZWYgX19oYXNoX18oc2VsZik6CiAgICAgICAgaWYgc2VsZi51dGNvZmZzZXQgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIGhhc2goKHNlbGYuZGF5X2ZyYWMsIE5vbmUpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBoYXNoKHNlbGYuZGF5X2ZyYWMgLSBzZWxmLnV0Y29mZnNldCkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiByZWdpc3Rlcl9uZXdfdGltZShjbHMsIGF0dHJpYnV0ZV9uYW1lLCB0aW1lX3JlcHJfY2xhc3MpOgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGF0dHJpYnV0ZV9uYW1lLCBzdHIpIG9yIG5vdCBhdHRyaWJ1dGVfbmFtZS5pc2lkZW50aWZpZXIoKToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmIkludmFsaWQgYXR0cmlidXRlIG5hbWUgKCd7YXR0cmlidXRlX25hbWV9JykgZm9yIHRpbWUgcmVwcmVzZW50YXRpb24uIikKICAgICAgICBpZiBoYXNhdHRyKGNscywgYXR0cmlidXRlX25hbWUpOgogICAgICAgICAgICByYWlzZSBBdHRyaWJ1dGVFcnJvcihmIlRpbWUgcmVwcmVzZW50YXRpb24gYXR0cmlidXRlIGFscmVhZHkgZXhpc3Rpbmc6IHthdHRyaWJ1dGVfbmFtZX0uIikKICAgICAgICBpZiBub3QgaGFzYXR0cih0aW1lX3JlcHJfY2xhc3MsICJmcm9tX3RpbWVfcGFpciIpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoIlRpbWUgcmVwcmVzZW50YXRpb24gY2xhc3MgZG9lcyBub3QgaGF2ZSBtZXRob2QgZnJvbV90aW1lX3BhaXIuIikKICAgICAgICBpZiBub3QgaGFzYXR0cih0aW1lX3JlcHJfY2xhc3MsICJ0b190aW1lX3BhaXIiKToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJUaW1lIHJlcHJlc2VudGF0aW9uIGNsYXNzIGRvZXMgbm90IGhhdmUgbWV0aG9kIHRvX3RpbWVfcGFpci4iKQoKICAgICAgICBjbGFzcyBNb2RpZmllZENsYXNzKHR5cGUpOgogICAgICAgICAgICBkZWYgX19jYWxsX18oa2xhc3MsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgICAgICAgICB0aW1lX3JlcHJfb2JqID0gc3VwZXIoKS5fX2NhbGxfXygqYXJncywgKiprd2FyZ3MpCiAgICAgICAgICAgICAgICBkYXlfZnJhYywgdXRjb2Zmc2V0ID0gdGltZV9yZXByX29iai50b190aW1lX3BhaXIoKQogICAgICAgICAgICAgICAgdGltZV9vYmogPSBjbHMoZGF5X2ZyYWMsIHV0Y29mZnNldD11dGNvZmZzZXQpCiAgICAgICAgICAgICAgICBzZXRhdHRyKHRpbWVfb2JqLCBhdHRyaWJ1dGVfbmFtZSwgdGltZV9yZXByX29iaikKICAgICAgICAgICAgICAgIHJldHVybiB0aW1lX29iagoKICAgICAgICAjIENyZWF0ZSB0aGUgbW9kaWZpZWQgY2FsZW5kYXIgY2xhc3MKICAgICAgICBuZXdfY2xhc3NfbmFtZSA9IGYie3RpbWVfcmVwcl9jbGFzcy5fX25hbWVfX31JbntjbHMuX19uYW1lX199IgogICAgICAgIG1vZGlmaWVkX3RpbWVfcmVwcl9jbGFzcyA9IE1vZGlmaWVkQ2xhc3MobmV3X2NsYXNzX25hbWUsICh0aW1lX3JlcHJfY2xhc3MsKSwge30pCgogICAgICAgIGNsYXNzIFRpbWVSZXByQXR0cmlidXRlOgogICAgICAgICAgICAjIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGNvbnRleHQgZGVwZW5kZW50IGF0dHJpYnV0ZQogICAgICAgICAgICBkZWYgX19pbml0X18oc2VsZiwgYXR0cl9uYW1lLCBtb2RpZl90aW1lX3JlcHJfY2xhc3MpOgogICAgICAgICAgICAgICAgc2VsZi5hdHRyX25hbWUgPSBhdHRyX25hbWUKICAgICAgICAgICAgICAgIHNlbGYubW9kaWZpZWRfdGltZV9yZXByX2NsYXNzID0gbW9kaWZfdGltZV9yZXByX2NsYXNzCgogICAgICAgICAgICBkZWYgX19nZXRfXyhzZWxmLCBpbnN0YW5jZSwgb3duZXIpOgogICAgICAgICAgICAgICAgaWYgaW5zdGFuY2UgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5tb2RpZmllZF90aW1lX3JlcHJfY2xhc3MKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0IHNlbGYuYXR0cl9uYW1lIG5vdCBpbiBpbnN0YW5jZS5fX2RpY3RfXwogICAgICAgICAgICAgICAgICAgIHRpbWVfb2JqID0gc2VsZi5tb2RpZmllZF90aW1lX3JlcHJfY2xhc3MuZnJvbV90aW1lX3BhaXIoaW5zdGFuY2UuZGF5X2ZyYWMsIHV0Y29mZnNldD1pbnN0YW5jZS51dGNvZmZzZXQpCiAgICAgICAgICAgICAgICAgICAgdGltZV9yZXByX29iaiA9IGdldGF0dHIodGltZV9vYmosIHNlbGYuYXR0cl9uYW1lKQogICAgICAgICAgICAgICAgICAgIHNldGF0dHIoaW5zdGFuY2UsIHNlbGYuYXR0cl9uYW1lLCB0aW1lX3JlcHJfb2JqKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aW1lX3JlcHJfb2JqCgogICAgICAgIHNldGF0dHIoY2xzLCBhdHRyaWJ1dGVfbmFtZSwgVGltZVJlcHJBdHRyaWJ1dGUoYXR0cmlidXRlX25hbWUsIG1vZGlmaWVkX3RpbWVfcmVwcl9jbGFzcykpCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgUmVnaXN0ZXIgY3VycmVudCB0aW1lIHJlcHJlc2VudGF0aW9ucwojClRpbWUucmVnaXN0ZXJfbmV3X3RpbWUoIndlc3Rlcm4iLCB3ZXN0ZXJuLldlc3Rlcm5UaW1lKQpUaW1lLnJlZ2lzdGVyX25ld190aW1lKCJpbnRlcm5ldCIsIG1vZGVybi5JbnRlcm5ldFRpbWUpCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyBUaW1lRGVsdGEKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCgpjbGFzcyBUaW1lRGVsdGE6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbnVtZXJhdG9yLCBkZW5vbWluYXRvcj1Ob25lKToKICAgICAgICBpZiBkZW5vbWluYXRvciBpcyBOb25lOgogICAgICAgICAgICBzZWxmLl9mcmFjdGlvbmFsX2RheXMgPSB2ZXJpZnlfZnJhY3Rpb25hbF92YWx1ZShudW1lcmF0b3IpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5fZnJhY3Rpb25hbF9kYXlzID0gdmVyaWZ5X2ZyYWN0aW9uYWxfdmFsdWVfbnVtX2RlbihudW1lcmF0b3IsIGRlbm9taW5hdG9yKQogICAgICAgIHNlbGYuX2ludF9wYXJ0ID0gaW50KHNlbGYuX2ZyYWN0aW9uYWxfZGF5cykKICAgICAgICBzZWxmLl9mcmFjX3BhcnQgPSBzZWxmLl9mcmFjdGlvbmFsX2RheXMgLSBzZWxmLl9pbnRfcGFydAoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGZyYWN0aW9uYWxfZGF5cyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5fZnJhY3Rpb25hbF9kYXlzCgogICAgQHByb3BlcnR5CiAgICBkZWYgaW50X3BhcnQoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2ludF9wYXJ0CgogICAgQHByb3BlcnR5CiAgICBkZWYgZnJhY19wYXJ0KHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9mcmFjX3BhcnQKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgcmV0dXJuIGYidHlwZXN1dGlsLnt0eXBlKHNlbGYpLl9fbmFtZV9ffSgne3NlbGYuZnJhY3Rpb25hbF9kYXlzIXN9JykiCgogICAgZGVmIF9fc3RyX18oc2VsZik6CiAgICAgICAgaWYgc2VsZi5fZnJhY3Rpb25hbF9kYXlzID09IDA6CiAgICAgICAgICAgIHJldHVybiAiMCBkYXlzIgogICAgICAgIGludF9zdHJpbmcgPSBmIntzZWxmLmludF9wYXJ0IXN9IGRheXsncycgaWYgc2VsZi5fZnJhY3Rpb25hbF9kYXlzICE9IDEgYW5kIHNlbGYuX2ZyYWN0aW9uYWxfZGF5cyAhPSAtMSBlbHNlICcnfSIgaWYgc2VsZi5pbnRfcGFydCBlbHNlICIiCiAgICAgICAgZnJhY19zdHJpbmcgPSBmIntzZWxmLl9mcmFjX3BhcnQhc30gb2YgYSBkYXkiIGlmIHNlbGYuX2ZyYWNfcGFydCBlbHNlICIiCiAgICAgICAgaWYgaW50X3N0cmluZyBhbmQgZnJhY19zdHJpbmc6CiAgICAgICAgICAgIHJldHVybiBmIntpbnRfc3RyaW5nfSBhbmQge2ZyYWNfc3RyaW5nfSIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gaW50X3N0cmluZyArIGZyYWNfc3RyaW5nCgogICAgIyBNYXRoIG9wZXJhdG9ycwogICAgZGVmIGludChzZWxmKToKICAgICAgICByZXR1cm4gdHlwZShzZWxmKShzZWxmLmludF9wYXJ0KQoKICAgIGRlZiBmcmFjKHNlbGYpOgogICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHNlbGYuZnJhY19wYXJ0KQoKICAgIGRlZiBfX2FkZF9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lRGVsdGEpOgogICAgICAgICAgICByZXR1cm4gdHlwZShzZWxmKShzZWxmLmZyYWN0aW9uYWxfZGF5cyArIG90aGVyLmZyYWN0aW9uYWxfZGF5cykKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKCiAgICBkZWYgX19wb3NfXyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZgoKICAgIGRlZiBfX25lZ19fKHNlbGYpOgogICAgICAgIHJldHVybiBUaW1lRGVsdGEoLXNlbGYuZnJhY3Rpb25hbF9kYXlzKQoKICAgIGRlZiBfX2Fic19fKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmIGlmIHNlbGYuZnJhY3Rpb25hbF9kYXlzID49IDAgZWxzZSAtc2VsZgoKICAgIGRlZiBfX3N1Yl9fKHNlbGYsIG90aGVyKToKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBUaW1lRGVsdGEpOgogICAgICAgICAgICByZXR1cm4gdHlwZShzZWxmKShzZWxmLmZyYWN0aW9uYWxfZGF5cyAtIG90aGVyLmZyYWN0aW9uYWxfZGF5cykKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKCiAgICBkZWYgX19tdWxfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgKG51bWJlcnMuUmVhbCwgRGVjaW1hbCkpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZShzZWxmKShzZWxmLmZyYWN0aW9uYWxfZGF5cyAqIEZyYWN0aW9uKG90aGVyKSkKICAgICAgICAgICAgZXhjZXB0IChPdmVyZmxvd0Vycm9yLCBWYWx1ZUVycm9yKSBhcyBleGM6CiAgICAgICAgICAgICAgICByZWFzb24gPSBzdHIoZXhjKQogICAgICAgICAgICAgICAgaWYgcmVhc29uLnN0YXJ0c3dpdGgoImNhbm5vdCBjb252ZXJ0IikgYW5kIHJlYXNvbi5lbmRzd2l0aCgidG8gaW50ZWdlciByYXRpbyIpOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvciBmcm9tIGV4YwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAoKICAgIF9fcm11bF9fID0gX19tdWxfXwoKICAgIGRlZiBfX3RydWVkaXZfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZnJhY3Rpb25hbF9kYXlzIC8gb3RoZXIuZnJhY3Rpb25hbF9kYXlzCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG90aGVyLCAobnVtYmVycy5SZWFsLCBEZWNpbWFsKSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHNlbGYuZnJhY3Rpb25hbF9kYXlzIC8gRnJhY3Rpb24ob3RoZXIpKQogICAgICAgICAgICBleGNlcHQgKE92ZXJmbG93RXJyb3IsIFZhbHVlRXJyb3IpIGFzIGV4YzoKICAgICAgICAgICAgICAgIHJlYXNvbiA9IHN0cihleGMpCiAgICAgICAgICAgICAgICBpZiByZWFzb24uc3RhcnRzd2l0aCgiY2Fubm90IGNvbnZlcnQiKSBhbmQgcmVhc29uLmVuZHN3aXRoKCJ0byBpbnRlZ2VyIHJhdGlvIik6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yIGZyb20gZXhjCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCgogICAgZGVmIF9fZmxvb3JkaXZfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZnJhY3Rpb25hbF9kYXlzIC8vIG90aGVyLmZyYWN0aW9uYWxfZGF5cwogICAgICAgIGVsaWYgaXNpbnN0YW5jZShvdGhlciwgKG51bWJlcnMuUmVhbCwgRGVjaW1hbCkpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZShzZWxmKShzZWxmLmZyYWN0aW9uYWxfZGF5cyAvLyBGcmFjdGlvbihvdGhlcikpCiAgICAgICAgICAgIGV4Y2VwdCAoT3ZlcmZsb3dFcnJvciwgVmFsdWVFcnJvcikgYXMgZXhjOgogICAgICAgICAgICAgICAgcmVhc29uID0gc3RyKGV4YykKICAgICAgICAgICAgICAgIGlmIHJlYXNvbi5zdGFydHN3aXRoKCJjYW5ub3QgY29udmVydCIpIGFuZCByZWFzb24uZW5kc3dpdGgoInRvIGludGVnZXIgcmF0aW8iKToKICAgICAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IgZnJvbSBleGMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKCiAgICBkZWYgX19tb2RfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZnJhY3Rpb25hbF9kYXlzICUgb3RoZXIuZnJhY3Rpb25hbF9kYXlzCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKG90aGVyLCAobnVtYmVycy5SZWFsLCBEZWNpbWFsKSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlKHNlbGYpKHNlbGYuZnJhY3Rpb25hbF9kYXlzICUgRnJhY3Rpb24ob3RoZXIpKQogICAgICAgICAgICBleGNlcHQgKE92ZXJmbG93RXJyb3IsIFZhbHVlRXJyb3IpIGFzIGV4YzoKICAgICAgICAgICAgICAgIHJlYXNvbiA9IHN0cihleGMpCiAgICAgICAgICAgICAgICBpZiByZWFzb24uc3RhcnRzd2l0aCgiY2Fubm90IGNvbnZlcnQiKSBhbmQgcmVhc29uLmVuZHN3aXRoKCJ0byBpbnRlZ2VyIHJhdGlvIik6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yIGZyb20gZXhjCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCgogICAgZGVmIGRpdm1vZChzZWxmLCBvdGhlcik6CiAgICAgICAgcmV0dXJuIHNlbGYgLy8gb3RoZXIsIHNlbGYgJSBvdGhlcgoKICAgICMgYm9vbGVhbiBhbmQgdGVzdAogICAgZGVmIF9fYm9vbF9fKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9mcmFjdGlvbmFsX2RheXMgIT0gMAoKICAgIGRlZiBpc19pbnRlZ2VyKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9mcmFjX3BhcnQgPT0gMAoKICAgICMgY29tcGFyaXNvbnMKICAgIGRlZiBfX2VxX18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWVEZWx0YSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9mcmFjdGlvbmFsX2RheXMgPT0gb3RoZXIuZnJhY3Rpb25hbF9kYXlzCiAgICAgICAgZWxpZiBoYXNhdHRyKG90aGVyLCAiZnJhY3Rpb25hbF9kYXlzIik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfX25lX18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWVEZWx0YSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9mcmFjdGlvbmFsX2RheXMgIT0gb3RoZXIuZnJhY3Rpb25hbF9kYXlzCiAgICAgICAgZWxpZiBoYXNhdHRyKG90aGVyLCAiZnJhY3Rpb25hbF9kYXlzIik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIF9fZ3RfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2ZyYWN0aW9uYWxfZGF5cyA+IG90aGVyLmZyYWN0aW9uYWxfZGF5cwogICAgICAgIGVsaWYgaGFzYXR0cihvdGhlciwgImZyYWN0aW9uYWxfZGF5cyIpOgogICAgICAgICAgICByZXR1cm4gTm90SW1wbGVtZW50ZWQKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoZiJZb3UgY2Fubm90IGNvbXBhcmUgJ3t0eXBlKHNlbGYpIXN9JyB3aXRoICd7dHlwZShvdGhlcikhc30nLiIpCgogICAgZGVmIF9fZ2VfXyhzZWxmLCBvdGhlcik6CiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgVGltZURlbHRhKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2ZyYWN0aW9uYWxfZGF5cyA+PSBvdGhlci5mcmFjdGlvbmFsX2RheXMKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJmcmFjdGlvbmFsX2RheXMiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKGYiWW91IGNhbm5vdCBjb21wYXJlICd7dHlwZShzZWxmKSFzfScgd2l0aCAne3R5cGUob3RoZXIpIXN9Jy4iKQoKICAgIGRlZiBfX2x0X18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWVEZWx0YSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9mcmFjdGlvbmFsX2RheXMgPCBvdGhlci5mcmFjdGlvbmFsX2RheXMKICAgICAgICBlbGlmIGhhc2F0dHIob3RoZXIsICJmcmFjdGlvbmFsX2RheXMiKToKICAgICAgICAgICAgcmV0dXJuIE5vdEltcGxlbWVudGVkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKGYiWW91IGNhbm5vdCBjb21wYXJlICd7dHlwZShzZWxmKSFzfScgd2l0aCAne3R5cGUob3RoZXIpIXN9Jy4iKQoKICAgIGRlZiBfX2xlX18oc2VsZiwgb3RoZXIpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIFRpbWVEZWx0YSk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9mcmFjdGlvbmFsX2RheXMgPD0gb3RoZXIuZnJhY3Rpb25hbF9kYXlzCiAgICAgICAgZWxpZiBoYXNhdHRyKG90aGVyLCAiZnJhY3Rpb25hbF9kYXlzIik6CiAgICAgICAgICAgIHJldHVybiBOb3RJbXBsZW1lbnRlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcihmIllvdSBjYW5ub3QgY29tcGFyZSAne3R5cGUoc2VsZikhc30nIHdpdGggJ3t0eXBlKG90aGVyKSFzfScuIikKCiAgICAjIGhhc2ggdmFsdWUKICAgIGRlZiBfX2hhc2hfXyhzZWxmKToKICAgICAgICByZXR1cm4gaGFzaChzZWxmLl9mcmFjdGlvbmFsX2RheXMpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgcmVnaXN0ZXJfbmV3X3RpbWVfaW50ZXJ2YWwoY2xzLCBhdHRyaWJ1dGVfbmFtZSwgdGltZV9pbnRlcnZhbF9jbGFzcyk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UoYXR0cmlidXRlX25hbWUsIHN0cikgb3Igbm90IGF0dHJpYnV0ZV9uYW1lLmlzaWRlbnRpZmllcigpOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYiSW52YWxpZCB0aW1lIGludGVydmFsIGF0dHJpYnV0ZSBuYW1lOiB7YXR0cmlidXRlX25hbWV9LiIpCiAgICAgICAgaWYgaGFzYXR0cihjbHMsIGF0dHJpYnV0ZV9uYW1lKToKICAgICAgICAgICAgcmFpc2UgQXR0cmlidXRlRXJyb3IoZiJUaW1lIGludGVydmFsIGF0dHJpYnV0ZSBhbHJlYWR5IGV4aXN0aW5nOiB7YXR0cmlidXRlX25hbWV9LiIpCiAgICAgICAgaWYgbm90IGhhc2F0dHIodGltZV9pbnRlcnZhbF9jbGFzcywgImZyb21fZnJhY3Rpb25hbF9kYXlzIik6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiVGltZSBpbnRlcnZhbCBjbGFzcyBkb2VzIG5vdCBoYXZlIG1ldGhvZCBmcm9tX2ZyYWN0aW9uYWxfZGF5cy4iKQogICAgICAgIGlmIG5vdCBoYXNhdHRyKHRpbWVfaW50ZXJ2YWxfY2xhc3MsICJ0b19mcmFjdGlvbmFsX2RheXMiKToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJUaW1lIGludGVydmFsIGNsYXNzIGRvZXMgbm90IGhhdmUgbWV0aG9kIHRvX2ZyYWN0aW9uYWxfZGF5cy4iKQoKICAgICAgICBjbGFzcyBNb2RpZmllZENsYXNzKHR5cGUpOgogICAgICAgICAgICBkZWYgX19jYWxsX18oa2xhc3MsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgICAgICAgICB0aW1lX2ludGVydmFsX29iaiA9IHN1cGVyKCkuX19jYWxsX18oKmFyZ3MsICoqa3dhcmdzKQogICAgICAgICAgICAgICAgZGF0ZV9vYmogPSBjbHModGltZV9pbnRlcnZhbF9vYmoudG9fZnJhY3Rpb25hbF9kYXlzKCkpCiAgICAgICAgICAgICAgICBzZXRhdHRyKGRhdGVfb2JqLCBhdHRyaWJ1dGVfbmFtZSwgdGltZV9pbnRlcnZhbF9vYmopCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZV9vYmoKCiAgICAgICAgIyBDcmVhdGUgdGhlIG1vZGlmaWVkIGNhbGVuZGFyIGNsYXNzCiAgICAgICAgbmV3X2NsYXNzX25hbWUgPSBmInt0aW1lX2ludGVydmFsX2NsYXNzLl9fbmFtZV9ffUlue2Nscy5fX25hbWVfX30iCiAgICAgICAgbW9kaWZpZWRfdGltZV9pbnRlcnZhbF9jbGFzcyA9IE1vZGlmaWVkQ2xhc3MobmV3X2NsYXNzX25hbWUsICh0aW1lX2ludGVydmFsX2NsYXNzLCksIHt9KQoKICAgICAgICBjbGFzcyBUaW1lSW50ZXJ2YWxBdHRyaWJ1dGU6CiAgICAgICAgICAgICMgVGhpcyBjbGFzcyBpbXBsZW1lbnRzIGEgY29udGV4dCBkZXBlbmRlbnQgYXR0cmlidXRlCiAgICAgICAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBhdHRyX25hbWUsIG1vZGlmX3RpbWVfaW50ZXJ2YWxfY2xhc3MpOgogICAgICAgICAgICAgICAgc2VsZi5hdHRyaWJ1dGVfbmFtZSA9IGF0dHJfbmFtZQogICAgICAgICAgICAgICAgc2VsZi5tb2RpZmllZF90aW1lX2ludGVydmFsX2NsYXNzID0gbW9kaWZfdGltZV9pbnRlcnZhbF9jbGFzcwoKICAgICAgICAgICAgZGVmIF9fZ2V0X18oc2VsZiwgaW5zdGFuY2UsIG93bmVyKToKICAgICAgICAgICAgICAgIGlmIGluc3RhbmNlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYubW9kaWZpZWRfdGltZV9pbnRlcnZhbF9jbGFzcwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBhc3NlcnQgc2VsZi5hdHRyaWJ1dGVfbmFtZSBub3QgaW4gaW5zdGFuY2UuX19kaWN0X18KICAgICAgICAgICAgICAgICAgICB0aW1lZGVsdGEgPSBzZWxmLm1vZGlmaWVkX3RpbWVfaW50ZXJ2YWxfY2xhc3MuZnJvbV9mcmFjdGlvbmFsX2RheXMoaW5zdGFuY2UuZnJhY3Rpb25hbF9kYXlzKQogICAgICAgICAgICAgICAgICAgIHRpbWVfaW50ZXJ2YWxfb2JqID0gZ2V0YXR0cih0aW1lZGVsdGEsIHNlbGYuYXR0cmlidXRlX25hbWUpCiAgICAgICAgICAgICAgICAgICAgc2V0YXR0cihpbnN0YW5jZSwgc2VsZi5hdHRyaWJ1dGVfbmFtZSwgdGltZV9pbnRlcnZhbF9vYmopCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRpbWVfaW50ZXJ2YWxfb2JqCgogICAgICAgIHNldGF0dHIoY2xzLCBhdHRyaWJ1dGVfbmFtZSwgVGltZUludGVydmFsQXR0cmlidXRlKGF0dHJpYnV0ZV9uYW1lLCBtb2RpZmllZF90aW1lX2ludGVydmFsX2NsYXNzKSkKCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBSZWdpc3RlciBjdXJyZW50IGNhbGVuZGFycwojClRpbWVEZWx0YS5yZWdpc3Rlcl9uZXdfdGltZV9pbnRlcnZhbCgid2VzdGVybiIsIHdlc3Rlcm4uV2VzdGVyblRpbWVEZWx0YSkKCgo=
