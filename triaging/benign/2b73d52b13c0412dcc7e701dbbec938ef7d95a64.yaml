statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/embeds.py
  contents:
  - name: Embed.image
    score: 0.0
    code: |-
      @property
          def image(self):
              """Union[:class:`EmbedProxy`, :attr:`Empty`]: Returns an ``EmbedProxy`` denoting the image contents.

              Possible attributes you can access are:

              - ``url``
              - ``proxy_url``
              - ``width``
              - ``height``

              If the attribute has no value then :attr:`Empty` is returned.
              """
              return EmbedProxy(getattr(self, '_image', {}))
    tokens: resume load_global EmbedProxy load_global REFLECTION_DYNAMIC_READ load_fast self load_const _image build_map call call return_value
    hash: 6e26a726c96654aeb4fcca2cef64d31c904f189e351f6f7af22605f17c5396ac
sources:
  .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/embeds.py: IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KCiIiIgpUaGUgTUlUIExpY2Vuc2UgKE1JVCkKCkNvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50IFJhcHB0egoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgp0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlClNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCk9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwpGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSCkRFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KIiIiCgppbXBvcnQgZGF0ZXRpbWUKCmZyb20gLiBpbXBvcnQgdXRpbHMKZnJvbSAuY29sb3VyIGltcG9ydCBDb2xvdXIKCmNsYXNzIF9FbXB0eUVtYmVkOgogICAgZGVmIF9fYm9vbF9fKHNlbGYpOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gJ0VtYmVkLkVtcHR5JwoKICAgIGRlZiBfX2xlbl9fKHNlbGYpOgogICAgICAgIHJldHVybiAwCgpFbXB0eUVtYmVkID0gX0VtcHR5RW1iZWQoKQoKY2xhc3MgRW1iZWRQcm94eToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBsYXllcik6CiAgICAgICAgc2VsZi5fX2RpY3RfXy51cGRhdGUobGF5ZXIpCgogICAgZGVmIF9fbGVuX18oc2VsZik6CiAgICAgICAgcmV0dXJuIGxlbihzZWxmLl9fZGljdF9fKQoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gJ0VtYmVkUHJveHkoJXMpJyAlICcsICcuam9pbigoJyVzPSVyJyAlIChrLCB2KSBmb3IgaywgdiBpbiBzZWxmLl9fZGljdF9fLml0ZW1zKCkgaWYgbm90IGsuc3RhcnRzd2l0aCgnXycpKSkKCiAgICBkZWYgX19nZXRhdHRyX18oc2VsZiwgYXR0cik6CiAgICAgICAgcmV0dXJuIEVtcHR5RW1iZWQKCmNsYXNzIEVtYmVkOgogICAgIiIiUmVwcmVzZW50cyBhIERpc2NvcmQgZW1iZWQuCgogICAgLi4gY29udGFpbmVyOjogb3BlcmF0aW9ucwoKICAgICAgICAuLiBkZXNjcmliZTo6IGxlbih4KQoKICAgICAgICAgICAgUmV0dXJucyB0aGUgdG90YWwgc2l6ZSBvZiB0aGUgZW1iZWQuCiAgICAgICAgICAgIFVzZWZ1bCBmb3IgY2hlY2tpbmcgaWYgaXQncyB3aXRoaW4gdGhlIDYwMDAgY2hhcmFjdGVyIGxpbWl0LgoKICAgIENlcnRhaW4gcHJvcGVydGllcyByZXR1cm4gYW4gYGBFbWJlZFByb3h5YGAsIGEgdHlwZQogICAgdGhhdCBhY3RzIHNpbWlsYXIgdG8gYSByZWd1bGFyIDpjbGFzczpgZGljdGAgZXhjZXB0IHVzaW5nIGRvdHRlZCBhY2Nlc3MsCiAgICBlLmcuIGBgZW1iZWQuYXV0aG9yLmljb25fdXJsYGAuIElmIHRoZSBhdHRyaWJ1dGUKICAgIGlzIGludmFsaWQgb3IgZW1wdHksIHRoZW4gYSBzcGVjaWFsIHNlbnRpbmVsIHZhbHVlIGlzIHJldHVybmVkLAogICAgOmF0dHI6YEVtYmVkLkVtcHR5YC4KCiAgICBGb3IgZWFzZSBvZiB1c2UsIGFsbCBwYXJhbWV0ZXJzIHRoYXQgZXhwZWN0IGEgOmNsYXNzOmBzdHJgIGFyZSBpbXBsaWNpdGx5CiAgICBjYXN0ZWQgdG8gOmNsYXNzOmBzdHJgIGZvciB5b3UuCgogICAgQXR0cmlidXRlcwogICAgLS0tLS0tLS0tLS0KICAgIHRpdGxlOiA6Y2xhc3M6YHN0cmAKICAgICAgICBUaGUgdGl0bGUgb2YgdGhlIGVtYmVkLgogICAgICAgIFRoaXMgY2FuIGJlIHNldCBkdXJpbmcgaW5pdGlhbGlzYXRpb24uCiAgICB0eXBlOiA6Y2xhc3M6YHN0cmAKICAgICAgICBUaGUgdHlwZSBvZiBlbWJlZC4gVXN1YWxseSAicmljaCIuCiAgICAgICAgVGhpcyBjYW4gYmUgc2V0IGR1cmluZyBpbml0aWFsaXNhdGlvbi4KICAgICAgICBQb3NzaWJsZSBzdHJpbmdzIGZvciBlbWJlZCB0eXBlcyBjYW4gYmUgZm91bmQgb24gZGlzY29yZCdzCiAgICAgICAgYGFwaSBkb2NzIDxodHRwczovL2Rpc2NvcmQuY29tL2RldmVsb3BlcnMvZG9jcy9yZXNvdXJjZXMvY2hhbm5lbCNlbWJlZC1vYmplY3QtZW1iZWQtdHlwZXM+YF8KICAgIGRlc2NyaXB0aW9uOiA6Y2xhc3M6YHN0cmAKICAgICAgICBUaGUgZGVzY3JpcHRpb24gb2YgdGhlIGVtYmVkLgogICAgICAgIFRoaXMgY2FuIGJlIHNldCBkdXJpbmcgaW5pdGlhbGlzYXRpb24uCiAgICB1cmw6IDpjbGFzczpgc3RyYAogICAgICAgIFRoZSBVUkwgb2YgdGhlIGVtYmVkLgogICAgICAgIFRoaXMgY2FuIGJlIHNldCBkdXJpbmcgaW5pdGlhbGlzYXRpb24uCiAgICB0aW1lc3RhbXA6IDpjbGFzczpgZGF0ZXRpbWUuZGF0ZXRpbWVgCiAgICAgICAgVGhlIHRpbWVzdGFtcCBvZiB0aGUgZW1iZWQgY29udGVudC4gVGhpcyBjb3VsZCBiZSBhIG5haXZlIG9yIGF3YXJlIGRhdGV0aW1lLgogICAgY29sb3VyOiBVbmlvbls6Y2xhc3M6YENvbG91cmAsIDpjbGFzczpgaW50YF0KICAgICAgICBUaGUgY29sb3VyIGNvZGUgb2YgdGhlIGVtYmVkLiBBbGlhc2VkIHRvIGBgY29sb3JgYCBhcyB3ZWxsLgogICAgICAgIFRoaXMgY2FuIGJlIHNldCBkdXJpbmcgaW5pdGlhbGlzYXRpb24uCiAgICBFbXB0eQogICAgICAgIEEgc3BlY2lhbCBzZW50aW5lbCB2YWx1ZSB1c2VkIGJ5IGBgRW1iZWRQcm94eWBgIGFuZCB0aGlzIGNsYXNzCiAgICAgICAgdG8gZGVub3RlIHRoYXQgdGhlIHZhbHVlIG9yIGF0dHJpYnV0ZSBpcyBlbXB0eS4KICAgICIiIgoKICAgIF9fc2xvdHNfXyA9ICgndGl0bGUnLCAndXJsJywgJ3R5cGUnLCAnX3RpbWVzdGFtcCcsICdfY29sb3VyJywgJ19mb290ZXInLAogICAgICAgICAgICAgICAgICdfaW1hZ2UnLCAnX3RodW1ibmFpbCcsICdfdmlkZW8nLCAnX3Byb3ZpZGVyJywgJ19hdXRob3InLAogICAgICAgICAgICAgICAgICdfZmllbGRzJywgJ2Rlc2NyaXB0aW9uJykKCiAgICBFbXB0eSA9IEVtcHR5RW1iZWQKCiAgICBkZWYgX19pbml0X18oc2VsZiwgKiprd2FyZ3MpOgogICAgICAgICMgc3dhcCB0aGUgY29sb3VyL2NvbG9yIGFsaWFzZXMKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbG91ciA9IGt3YXJnc1snY29sb3VyJ10KICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIGNvbG91ciA9IGt3YXJncy5nZXQoJ2NvbG9yJywgRW1wdHlFbWJlZCkKCiAgICAgICAgc2VsZi5jb2xvdXIgPSBjb2xvdXIKICAgICAgICBzZWxmLnRpdGxlID0ga3dhcmdzLmdldCgndGl0bGUnLCBFbXB0eUVtYmVkKQogICAgICAgIHNlbGYudHlwZSA9IGt3YXJncy5nZXQoJ3R5cGUnLCAncmljaCcpCiAgICAgICAgc2VsZi51cmwgPSBrd2FyZ3MuZ2V0KCd1cmwnLCBFbXB0eUVtYmVkKQogICAgICAgIHNlbGYuZGVzY3JpcHRpb24gPSBrd2FyZ3MuZ2V0KCdkZXNjcmlwdGlvbicsIEVtcHR5RW1iZWQpCgogICAgICAgIGlmIHNlbGYudGl0bGUgaXMgbm90IEVtcHR5RW1iZWQ6CiAgICAgICAgICAgIHNlbGYudGl0bGUgPSBzdHIoc2VsZi50aXRsZSkKCiAgICAgICAgaWYgc2VsZi5kZXNjcmlwdGlvbiBpcyBub3QgRW1wdHlFbWJlZDoKICAgICAgICAgICAgc2VsZi5kZXNjcmlwdGlvbiA9IHN0cihzZWxmLmRlc2NyaXB0aW9uKQoKICAgICAgICBpZiBzZWxmLnVybCBpcyBub3QgRW1wdHlFbWJlZDoKICAgICAgICAgICAgc2VsZi51cmwgPSBzdHIoc2VsZi51cmwpCgogICAgICAgIHRyeToKICAgICAgICAgICAgdGltZXN0YW1wID0ga3dhcmdzWyd0aW1lc3RhbXAnXQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYudGltZXN0YW1wID0gdGltZXN0YW1wCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgZnJvbV9kaWN0KGNscywgZGF0YSk6CiAgICAgICAgIiIiQ29udmVydHMgYSA6Y2xhc3M6YGRpY3RgIHRvIGEgOmNsYXNzOmBFbWJlZGAgcHJvdmlkZWQgaXQgaXMgaW4gdGhlCiAgICAgICAgZm9ybWF0IHRoYXQgRGlzY29yZCBleHBlY3RzIGl0IHRvIGJlIGluLgoKICAgICAgICBZb3UgY2FuIGZpbmQgb3V0IGFib3V0IHRoaXMgZm9ybWF0IGluIHRoZSBgb2ZmaWNpYWwgRGlzY29yZCBkb2N1bWVudGF0aW9uYF9fLgoKICAgICAgICAuLiBfRGlzY29yZERvY3M6IGh0dHBzOi8vZGlzY29yZC5jb20vZGV2ZWxvcGVycy9kb2NzL3Jlc291cmNlcy9jaGFubmVsI2VtYmVkLW9iamVjdAoKICAgICAgICBfXyBEaXNjb3JkRG9jc18KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgZGF0YTogOmNsYXNzOmBkaWN0YAogICAgICAgICAgICBUaGUgZGljdGlvbmFyeSB0byBjb252ZXJ0IGludG8gYW4gZW1iZWQuCiAgICAgICAgIiIiCiAgICAgICAgIyB3ZSBhcmUgYnlwYXNzaW5nIF9faW5pdF9fIGhlcmUgc2luY2UgaXQgZG9lc24ndCBhcHBseSBoZXJlCiAgICAgICAgc2VsZiA9IGNscy5fX25ld19fKGNscykKCiAgICAgICAgIyBmaWxsIGluIHRoZSBiYXNpYyBmaWVsZHMKCiAgICAgICAgc2VsZi50aXRsZSA9IGRhdGEuZ2V0KCd0aXRsZScsIEVtcHR5RW1iZWQpCiAgICAgICAgc2VsZi50eXBlID0gZGF0YS5nZXQoJ3R5cGUnLCBFbXB0eUVtYmVkKQogICAgICAgIHNlbGYuZGVzY3JpcHRpb24gPSBkYXRhLmdldCgnZGVzY3JpcHRpb24nLCBFbXB0eUVtYmVkKQogICAgICAgIHNlbGYudXJsID0gZGF0YS5nZXQoJ3VybCcsIEVtcHR5RW1iZWQpCgogICAgICAgIGlmIHNlbGYudGl0bGUgaXMgbm90IEVtcHR5RW1iZWQ6CiAgICAgICAgICAgIHNlbGYudGl0bGUgPSBzdHIoc2VsZi50aXRsZSkKCiAgICAgICAgaWYgc2VsZi5kZXNjcmlwdGlvbiBpcyBub3QgRW1wdHlFbWJlZDoKICAgICAgICAgICAgc2VsZi5kZXNjcmlwdGlvbiA9IHN0cihzZWxmLmRlc2NyaXB0aW9uKQoKICAgICAgICBpZiBzZWxmLnVybCBpcyBub3QgRW1wdHlFbWJlZDoKICAgICAgICAgICAgc2VsZi51cmwgPSBzdHIoc2VsZi51cmwpCgogICAgICAgICMgdHJ5IHRvIGZpbGwgaW4gdGhlIG1vcmUgcmljaCBmaWVsZHMKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLl9jb2xvdXIgPSBDb2xvdXIodmFsdWU9ZGF0YVsnY29sb3InXSkKICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLl90aW1lc3RhbXAgPSB1dGlscy5wYXJzZV90aW1lKGRhdGFbJ3RpbWVzdGFtcCddKQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcGFzcwoKICAgICAgICBmb3IgYXR0ciBpbiAoJ3RodW1ibmFpbCcsICd2aWRlbycsICdwcm92aWRlcicsICdhdXRob3InLCAnZmllbGRzJywgJ2ltYWdlJywgJ2Zvb3RlcicpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGRhdGFbYXR0cl0KICAgICAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNldGF0dHIoc2VsZiwgJ18nICsgYXR0ciwgdmFsdWUpCgogICAgICAgIHJldHVybiBzZWxmCgogICAgZGVmIGNvcHkoc2VsZik6CiAgICAgICAgIiIiUmV0dXJucyBhIHNoYWxsb3cgY29weSBvZiB0aGUgZW1iZWQuIiIiCiAgICAgICAgcmV0dXJuIEVtYmVkLmZyb21fZGljdChzZWxmLnRvX2RpY3QoKSkKCiAgICBkZWYgX19sZW5fXyhzZWxmKToKICAgICAgICB0b3RhbCA9IGxlbihzZWxmLnRpdGxlKSArIGxlbihzZWxmLmRlc2NyaXB0aW9uKQogICAgICAgIGZvciBmaWVsZCBpbiBnZXRhdHRyKHNlbGYsICdfZmllbGRzJywgW10pOgogICAgICAgICAgICB0b3RhbCArPSBsZW4oZmllbGRbJ25hbWUnXSkgKyBsZW4oZmllbGRbJ3ZhbHVlJ10pCgogICAgICAgIHRyeToKICAgICAgICAgICAgZm9vdGVyID0gc2VsZi5fZm9vdGVyCiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICAgICBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdG90YWwgKz0gbGVuKGZvb3RlclsndGV4dCddKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGF1dGhvciA9IHNlbGYuX2F1dGhvcgogICAgICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRvdGFsICs9IGxlbihhdXRob3JbJ25hbWUnXSkKCiAgICAgICAgcmV0dXJuIHRvdGFsCgogICAgQHByb3BlcnR5CiAgICBkZWYgY29sb3VyKHNlbGYpOgogICAgICAgIHJldHVybiBnZXRhdHRyKHNlbGYsICdfY29sb3VyJywgRW1wdHlFbWJlZCkKCiAgICBAY29sb3VyLnNldHRlcgogICAgZGVmIGNvbG91cihzZWxmLCB2YWx1ZSk6CiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgKENvbG91ciwgX0VtcHR5RW1iZWQpKToKICAgICAgICAgICAgc2VsZi5fY29sb3VyID0gdmFsdWUKICAgICAgICBlbGlmIGlzaW5zdGFuY2UodmFsdWUsIGludCk6CiAgICAgICAgICAgIHNlbGYuX2NvbG91ciA9IENvbG91cih2YWx1ZT12YWx1ZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ0V4cGVjdGVkIGRpc2NvcmQuQ29sb3VyLCBpbnQsIG9yIEVtYmVkLkVtcHR5IGJ1dCByZWNlaXZlZCAlcyBpbnN0ZWFkLicgJSB2YWx1ZS5fX2NsYXNzX18uX19uYW1lX18pCgogICAgY29sb3IgPSBjb2xvdXIKCiAgICBAcHJvcGVydHkKICAgIGRlZiB0aW1lc3RhbXAoc2VsZik6CiAgICAgICAgcmV0dXJuIGdldGF0dHIoc2VsZiwgJ190aW1lc3RhbXAnLCBFbXB0eUVtYmVkKQoKICAgIEB0aW1lc3RhbXAuc2V0dGVyCiAgICBkZWYgdGltZXN0YW1wKHNlbGYsIHZhbHVlKToKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCAoZGF0ZXRpbWUuZGF0ZXRpbWUsIF9FbXB0eUVtYmVkKSk6CiAgICAgICAgICAgIHNlbGYuX3RpbWVzdGFtcCA9IHZhbHVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJFeHBlY3RlZCBkYXRldGltZS5kYXRldGltZSBvciBFbWJlZC5FbXB0eSByZWNlaXZlZCAlcyBpbnN0ZWFkIiAlIHZhbHVlLl9fY2xhc3NfXy5fX25hbWVfXykKCiAgICBAcHJvcGVydHkKICAgIGRlZiBmb290ZXIoc2VsZik6CiAgICAgICAgIiIiVW5pb25bOmNsYXNzOmBFbWJlZFByb3h5YCwgOmF0dHI6YEVtcHR5YF06IFJldHVybnMgYW4gYGBFbWJlZFByb3h5YGAgZGVub3RpbmcgdGhlIGZvb3RlciBjb250ZW50cy4KCiAgICAgICAgU2VlIDptZXRoOmBzZXRfZm9vdGVyYCBmb3IgcG9zc2libGUgdmFsdWVzIHlvdSBjYW4gYWNjZXNzLgoKICAgICAgICBJZiB0aGUgYXR0cmlidXRlIGhhcyBubyB2YWx1ZSB0aGVuIDphdHRyOmBFbXB0eWAgaXMgcmV0dXJuZWQuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIEVtYmVkUHJveHkoZ2V0YXR0cihzZWxmLCAnX2Zvb3RlcicsIHt9KSkKCiAgICBkZWYgc2V0X2Zvb3RlcihzZWxmLCAqLCB0ZXh0PUVtcHR5RW1iZWQsIGljb25fdXJsPUVtcHR5RW1iZWQpOgogICAgICAgICIiIlNldHMgdGhlIGZvb3RlciBmb3IgdGhlIGVtYmVkIGNvbnRlbnQuCgogICAgICAgIFRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgY2xhc3MgaW5zdGFuY2UgdG8gYWxsb3cgZm9yIGZsdWVudC1zdHlsZQogICAgICAgIGNoYWluaW5nLgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICB0ZXh0OiA6Y2xhc3M6YHN0cmAKICAgICAgICAgICAgVGhlIGZvb3RlciB0ZXh0LgogICAgICAgIGljb25fdXJsOiA6Y2xhc3M6YHN0cmAKICAgICAgICAgICAgVGhlIFVSTCBvZiB0aGUgZm9vdGVyIGljb24uIE9ubHkgSFRUUChTKSBpcyBzdXBwb3J0ZWQuCiAgICAgICAgIiIiCgogICAgICAgIHNlbGYuX2Zvb3RlciA9IHt9CiAgICAgICAgaWYgdGV4dCBpcyBub3QgRW1wdHlFbWJlZDoKICAgICAgICAgICAgc2VsZi5fZm9vdGVyWyd0ZXh0J10gPSBzdHIodGV4dCkKCiAgICAgICAgaWYgaWNvbl91cmwgaXMgbm90IEVtcHR5RW1iZWQ6CiAgICAgICAgICAgIHNlbGYuX2Zvb3RlclsnaWNvbl91cmwnXSA9IHN0cihpY29uX3VybCkKCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBAcHJvcGVydHkKICAgIGRlZiBpbWFnZShzZWxmKToKICAgICAgICAiIiJVbmlvbls6Y2xhc3M6YEVtYmVkUHJveHlgLCA6YXR0cjpgRW1wdHlgXTogUmV0dXJucyBhbiBgYEVtYmVkUHJveHlgYCBkZW5vdGluZyB0aGUgaW1hZ2UgY29udGVudHMuCgogICAgICAgIFBvc3NpYmxlIGF0dHJpYnV0ZXMgeW91IGNhbiBhY2Nlc3MgYXJlOgoKICAgICAgICAtIGBgdXJsYGAKICAgICAgICAtIGBgcHJveHlfdXJsYGAKICAgICAgICAtIGBgd2lkdGhgYAogICAgICAgIC0gYGBoZWlnaHRgYAoKICAgICAgICBJZiB0aGUgYXR0cmlidXRlIGhhcyBubyB2YWx1ZSB0aGVuIDphdHRyOmBFbXB0eWAgaXMgcmV0dXJuZWQuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIEVtYmVkUHJveHkoZ2V0YXR0cihzZWxmLCAnX2ltYWdlJywge30pKQoKICAgIGRlZiBzZXRfaW1hZ2Uoc2VsZiwgKiwgdXJsKToKICAgICAgICAiIiJTZXRzIHRoZSBpbWFnZSBmb3IgdGhlIGVtYmVkIGNvbnRlbnQuCgogICAgICAgIFRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgY2xhc3MgaW5zdGFuY2UgdG8gYWxsb3cgZm9yIGZsdWVudC1zdHlsZQogICAgICAgIGNoYWluaW5nLgoKICAgICAgICAuLiB2ZXJzaW9uY2hhbmdlZDo6IDEuNAogICAgICAgICAgICBQYXNzaW5nIDphdHRyOmBFbXB0eWAgcmVtb3ZlcyB0aGUgaW1hZ2UuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIHVybDogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSBzb3VyY2UgVVJMIGZvciB0aGUgaW1hZ2UuIE9ubHkgSFRUUChTKSBpcyBzdXBwb3J0ZWQuCiAgICAgICAgIiIiCgogICAgICAgIGlmIHVybCBpcyBFbXB0eUVtYmVkOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZWwgc2VsZi5faW1hZ2UKICAgICAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuX2ltYWdlID0gewogICAgICAgICAgICAgICAgJ3VybCc6IHN0cih1cmwpCiAgICAgICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBAcHJvcGVydHkKICAgIGRlZiB0aHVtYm5haWwoc2VsZik6CiAgICAgICAgIiIiVW5pb25bOmNsYXNzOmBFbWJlZFByb3h5YCwgOmF0dHI6YEVtcHR5YF06IFJldHVybnMgYW4gYGBFbWJlZFByb3h5YGAgZGVub3RpbmcgdGhlIHRodW1ibmFpbCBjb250ZW50cy4KCiAgICAgICAgUG9zc2libGUgYXR0cmlidXRlcyB5b3UgY2FuIGFjY2VzcyBhcmU6CgogICAgICAgIC0gYGB1cmxgYAogICAgICAgIC0gYGBwcm94eV91cmxgYAogICAgICAgIC0gYGB3aWR0aGBgCiAgICAgICAgLSBgYGhlaWdodGBgCgogICAgICAgIElmIHRoZSBhdHRyaWJ1dGUgaGFzIG5vIHZhbHVlIHRoZW4gOmF0dHI6YEVtcHR5YCBpcyByZXR1cm5lZC4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gRW1iZWRQcm94eShnZXRhdHRyKHNlbGYsICdfdGh1bWJuYWlsJywge30pKQoKICAgIGRlZiBzZXRfdGh1bWJuYWlsKHNlbGYsICosIHVybCk6CiAgICAgICAgIiIiU2V0cyB0aGUgdGh1bWJuYWlsIGZvciB0aGUgZW1iZWQgY29udGVudC4KCiAgICAgICAgVGhpcyBmdW5jdGlvbiByZXR1cm5zIHRoZSBjbGFzcyBpbnN0YW5jZSB0byBhbGxvdyBmb3IgZmx1ZW50LXN0eWxlCiAgICAgICAgY2hhaW5pbmcuCgogICAgICAgIC4uIHZlcnNpb25jaGFuZ2VkOjogMS40CiAgICAgICAgICAgIFBhc3NpbmcgOmF0dHI6YEVtcHR5YCByZW1vdmVzIHRoZSB0aHVtYm5haWwuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIHVybDogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSBzb3VyY2UgVVJMIGZvciB0aGUgdGh1bWJuYWlsLiBPbmx5IEhUVFAoUykgaXMgc3VwcG9ydGVkLgogICAgICAgICIiIgoKICAgICAgICBpZiB1cmwgaXMgRW1wdHlFbWJlZDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGVsIHNlbGYuX3RodW1ibmFpbAogICAgICAgICAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5fdGh1bWJuYWlsID0gewogICAgICAgICAgICAgICAgJ3VybCc6IHN0cih1cmwpCiAgICAgICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBAcHJvcGVydHkKICAgIGRlZiB2aWRlbyhzZWxmKToKICAgICAgICAiIiJVbmlvbls6Y2xhc3M6YEVtYmVkUHJveHlgLCA6YXR0cjpgRW1wdHlgXTogUmV0dXJucyBhbiBgYEVtYmVkUHJveHlgYCBkZW5vdGluZyB0aGUgdmlkZW8gY29udGVudHMuCgogICAgICAgIFBvc3NpYmxlIGF0dHJpYnV0ZXMgaW5jbHVkZToKCiAgICAgICAgLSBgYHVybGBgIGZvciB0aGUgdmlkZW8gVVJMLgogICAgICAgIC0gYGBoZWlnaHRgYCBmb3IgdGhlIHZpZGVvIGhlaWdodC4KICAgICAgICAtIGBgd2lkdGhgYCBmb3IgdGhlIHZpZGVvIHdpZHRoLgoKICAgICAgICBJZiB0aGUgYXR0cmlidXRlIGhhcyBubyB2YWx1ZSB0aGVuIDphdHRyOmBFbXB0eWAgaXMgcmV0dXJuZWQuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIEVtYmVkUHJveHkoZ2V0YXR0cihzZWxmLCAnX3ZpZGVvJywge30pKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHByb3ZpZGVyKHNlbGYpOgogICAgICAgICIiIlVuaW9uWzpjbGFzczpgRW1iZWRQcm94eWAsIDphdHRyOmBFbXB0eWBdOiBSZXR1cm5zIGFuIGBgRW1iZWRQcm94eWBgIGRlbm90aW5nIHRoZSBwcm92aWRlciBjb250ZW50cy4KCiAgICAgICAgVGhlIG9ubHkgYXR0cmlidXRlcyB0aGF0IG1pZ2h0IGJlIGFjY2Vzc2VkIGFyZSBgYG5hbWVgYCBhbmQgYGB1cmxgYC4KCiAgICAgICAgSWYgdGhlIGF0dHJpYnV0ZSBoYXMgbm8gdmFsdWUgdGhlbiA6YXR0cjpgRW1wdHlgIGlzIHJldHVybmVkLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBFbWJlZFByb3h5KGdldGF0dHIoc2VsZiwgJ19wcm92aWRlcicsIHt9KSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBhdXRob3Ioc2VsZik6CiAgICAgICAgIiIiVW5pb25bOmNsYXNzOmBFbWJlZFByb3h5YCwgOmF0dHI6YEVtcHR5YF06IFJldHVybnMgYW4gYGBFbWJlZFByb3h5YGAgZGVub3RpbmcgdGhlIGF1dGhvciBjb250ZW50cy4KCiAgICAgICAgU2VlIDptZXRoOmBzZXRfYXV0aG9yYCBmb3IgcG9zc2libGUgdmFsdWVzIHlvdSBjYW4gYWNjZXNzLgoKICAgICAgICBJZiB0aGUgYXR0cmlidXRlIGhhcyBubyB2YWx1ZSB0aGVuIDphdHRyOmBFbXB0eWAgaXMgcmV0dXJuZWQuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIEVtYmVkUHJveHkoZ2V0YXR0cihzZWxmLCAnX2F1dGhvcicsIHt9KSkKCiAgICBkZWYgc2V0X2F1dGhvcihzZWxmLCAqLCBuYW1lLCB1cmw9RW1wdHlFbWJlZCwgaWNvbl91cmw9RW1wdHlFbWJlZCk6CiAgICAgICAgIiIiU2V0cyB0aGUgYXV0aG9yIGZvciB0aGUgZW1iZWQgY29udGVudC4KCiAgICAgICAgVGhpcyBmdW5jdGlvbiByZXR1cm5zIHRoZSBjbGFzcyBpbnN0YW5jZSB0byBhbGxvdyBmb3IgZmx1ZW50LXN0eWxlCiAgICAgICAgY2hhaW5pbmcuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIG5hbWU6IDpjbGFzczpgc3RyYAogICAgICAgICAgICBUaGUgbmFtZSBvZiB0aGUgYXV0aG9yLgogICAgICAgIHVybDogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSBVUkwgZm9yIHRoZSBhdXRob3IuCiAgICAgICAgaWNvbl91cmw6IDpjbGFzczpgc3RyYAogICAgICAgICAgICBUaGUgVVJMIG9mIHRoZSBhdXRob3IgaWNvbi4gT25seSBIVFRQKFMpIGlzIHN1cHBvcnRlZC4KICAgICAgICAiIiIKCiAgICAgICAgc2VsZi5fYXV0aG9yID0gewogICAgICAgICAgICAnbmFtZSc6IHN0cihuYW1lKQogICAgICAgIH0KCiAgICAgICAgaWYgdXJsIGlzIG5vdCBFbXB0eUVtYmVkOgogICAgICAgICAgICBzZWxmLl9hdXRob3JbJ3VybCddID0gc3RyKHVybCkKCiAgICAgICAgaWYgaWNvbl91cmwgaXMgbm90IEVtcHR5RW1iZWQ6CiAgICAgICAgICAgIHNlbGYuX2F1dGhvclsnaWNvbl91cmwnXSA9IHN0cihpY29uX3VybCkKCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBkZWYgcmVtb3ZlX2F1dGhvcihzZWxmKToKICAgICAgICAiIiJDbGVhcnMgZW1iZWQncyBhdXRob3IgaW5mb3JtYXRpb24uCgogICAgICAgIFRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgY2xhc3MgaW5zdGFuY2UgdG8gYWxsb3cgZm9yIGZsdWVudC1zdHlsZQogICAgICAgIGNoYWluaW5nLgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjQKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRlbCBzZWxmLl9hdXRob3IKICAgICAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBAcHJvcGVydHkKICAgIGRlZiBmaWVsZHMoc2VsZik6CiAgICAgICAgIiIiTGlzdFtVbmlvbltgYEVtYmVkUHJveHlgYCwgOmF0dHI6YEVtcHR5YF1dOiBSZXR1cm5zIGEgOmNsYXNzOmBsaXN0YCBvZiBgYEVtYmVkUHJveHlgYCBkZW5vdGluZyB0aGUgZmllbGQgY29udGVudHMuCgogICAgICAgIFNlZSA6bWV0aDpgYWRkX2ZpZWxkYCBmb3IgcG9zc2libGUgdmFsdWVzIHlvdSBjYW4gYWNjZXNzLgoKICAgICAgICBJZiB0aGUgYXR0cmlidXRlIGhhcyBubyB2YWx1ZSB0aGVuIDphdHRyOmBFbXB0eWAgaXMgcmV0dXJuZWQuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIFtFbWJlZFByb3h5KGQpIGZvciBkIGluIGdldGF0dHIoc2VsZiwgJ19maWVsZHMnLCBbXSldCgogICAgZGVmIGFkZF9maWVsZChzZWxmLCAqLCBuYW1lLCB2YWx1ZSwgaW5saW5lPVRydWUpOgogICAgICAgICIiIkFkZHMgYSBmaWVsZCB0byB0aGUgZW1iZWQgb2JqZWN0LgoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHJldHVybnMgdGhlIGNsYXNzIGluc3RhbmNlIHRvIGFsbG93IGZvciBmbHVlbnQtc3R5bGUKICAgICAgICBjaGFpbmluZy4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgbmFtZTogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSBuYW1lIG9mIHRoZSBmaWVsZC4KICAgICAgICB2YWx1ZTogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSB2YWx1ZSBvZiB0aGUgZmllbGQuCiAgICAgICAgaW5saW5lOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgdGhlIGZpZWxkIHNob3VsZCBiZSBkaXNwbGF5ZWQgaW5saW5lLgogICAgICAgICIiIgoKICAgICAgICBmaWVsZCA9IHsKICAgICAgICAgICAgJ2lubGluZSc6IGlubGluZSwKICAgICAgICAgICAgJ25hbWUnOiBzdHIobmFtZSksCiAgICAgICAgICAgICd2YWx1ZSc6IHN0cih2YWx1ZSkKICAgICAgICB9CgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5fZmllbGRzLmFwcGVuZChmaWVsZCkKICAgICAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgICAgIHNlbGYuX2ZpZWxkcyA9IFtmaWVsZF0KCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBkZWYgaW5zZXJ0X2ZpZWxkX2F0KHNlbGYsIGluZGV4LCAqLCBuYW1lLCB2YWx1ZSwgaW5saW5lPVRydWUpOgogICAgICAgICIiIkluc2VydHMgYSBmaWVsZCBiZWZvcmUgYSBzcGVjaWZpZWQgaW5kZXggdG8gdGhlIGVtYmVkLgoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHJldHVybnMgdGhlIGNsYXNzIGluc3RhbmNlIHRvIGFsbG93IGZvciBmbHVlbnQtc3R5bGUKICAgICAgICBjaGFpbmluZy4KCiAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS4yCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIGluZGV4OiA6Y2xhc3M6YGludGAKICAgICAgICAgICAgVGhlIGluZGV4IG9mIHdoZXJlIHRvIGluc2VydCB0aGUgZmllbGQuCiAgICAgICAgbmFtZTogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSBuYW1lIG9mIHRoZSBmaWVsZC4KICAgICAgICB2YWx1ZTogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSB2YWx1ZSBvZiB0aGUgZmllbGQuCiAgICAgICAgaW5saW5lOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgdGhlIGZpZWxkIHNob3VsZCBiZSBkaXNwbGF5ZWQgaW5saW5lLgogICAgICAgICIiIgoKICAgICAgICBmaWVsZCA9IHsKICAgICAgICAgICAgJ2lubGluZSc6IGlubGluZSwKICAgICAgICAgICAgJ25hbWUnOiBzdHIobmFtZSksCiAgICAgICAgICAgICd2YWx1ZSc6IHN0cih2YWx1ZSkKICAgICAgICB9CgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5fZmllbGRzLmluc2VydChpbmRleCwgZmllbGQpCiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICAgICBzZWxmLl9maWVsZHMgPSBbZmllbGRdCgogICAgICAgIHJldHVybiBzZWxmCgogICAgZGVmIGNsZWFyX2ZpZWxkcyhzZWxmKToKICAgICAgICAiIiJSZW1vdmVzIGFsbCBmaWVsZHMgZnJvbSB0aGlzIGVtYmVkLiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5fZmllbGRzLmNsZWFyKCkKICAgICAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgICAgIHNlbGYuX2ZpZWxkcyA9IFtdCgogICAgZGVmIHJlbW92ZV9maWVsZChzZWxmLCBpbmRleCk6CiAgICAgICAgIiIiUmVtb3ZlcyBhIGZpZWxkIGF0IGEgc3BlY2lmaWVkIGluZGV4LgoKICAgICAgICBJZiB0aGUgaW5kZXggaXMgaW52YWxpZCBvciBvdXQgb2YgYm91bmRzIHRoZW4gdGhlIGVycm9yIGlzCiAgICAgICAgc2lsZW50bHkgc3dhbGxvd2VkLgoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFdoZW4gZGVsZXRpbmcgYSBmaWVsZCBieSBpbmRleCwgdGhlIGluZGV4IG9mIHRoZSBvdGhlciBmaWVsZHMKICAgICAgICAgICAgc2hpZnQgdG8gZmlsbCB0aGUgZ2FwIGp1c3QgbGlrZSBhIHJlZ3VsYXIgbGlzdC4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgaW5kZXg6IDpjbGFzczpgaW50YAogICAgICAgICAgICBUaGUgaW5kZXggb2YgdGhlIGZpZWxkIHRvIHJlbW92ZS4KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRlbCBzZWxmLl9maWVsZHNbaW5kZXhdCiAgICAgICAgZXhjZXB0IChBdHRyaWJ1dGVFcnJvciwgSW5kZXhFcnJvcik6CiAgICAgICAgICAgIHBhc3MKCiAgICBkZWYgc2V0X2ZpZWxkX2F0KHNlbGYsIGluZGV4LCAqLCBuYW1lLCB2YWx1ZSwgaW5saW5lPVRydWUpOgogICAgICAgICIiIk1vZGlmaWVzIGEgZmllbGQgdG8gdGhlIGVtYmVkIG9iamVjdC4KCiAgICAgICAgVGhlIGluZGV4IG11c3QgcG9pbnQgdG8gYSB2YWxpZCBwcmUtZXhpc3RpbmcgZmllbGQuCgogICAgICAgIFRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgY2xhc3MgaW5zdGFuY2UgdG8gYWxsb3cgZm9yIGZsdWVudC1zdHlsZQogICAgICAgIGNoYWluaW5nLgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICBpbmRleDogOmNsYXNzOmBpbnRgCiAgICAgICAgICAgIFRoZSBpbmRleCBvZiB0aGUgZmllbGQgdG8gbW9kaWZ5LgogICAgICAgIG5hbWU6IDpjbGFzczpgc3RyYAogICAgICAgICAgICBUaGUgbmFtZSBvZiB0aGUgZmllbGQuCiAgICAgICAgdmFsdWU6IDpjbGFzczpgc3RyYAogICAgICAgICAgICBUaGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogICAgICAgIGlubGluZTogOmNsYXNzOmBib29sYAogICAgICAgICAgICBXaGV0aGVyIHRoZSBmaWVsZCBzaG91bGQgYmUgZGlzcGxheWVkIGlubGluZS4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIEluZGV4RXJyb3IKICAgICAgICAgICAgQW4gaW52YWxpZCBpbmRleCB3YXMgcHJvdmlkZWQuCiAgICAgICAgIiIiCgogICAgICAgIHRyeToKICAgICAgICAgICAgZmllbGQgPSBzZWxmLl9maWVsZHNbaW5kZXhdCiAgICAgICAgZXhjZXB0IChUeXBlRXJyb3IsIEluZGV4RXJyb3IsIEF0dHJpYnV0ZUVycm9yKToKICAgICAgICAgICAgcmFpc2UgSW5kZXhFcnJvcignZmllbGQgaW5kZXggb3V0IG9mIHJhbmdlJykKCiAgICAgICAgZmllbGRbJ25hbWUnXSA9IHN0cihuYW1lKQogICAgICAgIGZpZWxkWyd2YWx1ZSddID0gc3RyKHZhbHVlKQogICAgICAgIGZpZWxkWydpbmxpbmUnXSA9IGlubGluZQogICAgICAgIHJldHVybiBzZWxmCgogICAgZGVmIHRvX2RpY3Qoc2VsZik6CiAgICAgICAgIiIiQ29udmVydHMgdGhpcyBlbWJlZCBvYmplY3QgaW50byBhIGRpY3QuIiIiCgogICAgICAgICMgYWRkIGluIHRoZSByYXcgZGF0YSBpbnRvIHRoZSBkaWN0CiAgICAgICAgcmVzdWx0ID0gewogICAgICAgICAgICBrZXlbMTpdOiBnZXRhdHRyKHNlbGYsIGtleSkKICAgICAgICAgICAgZm9yIGtleSBpbiBzZWxmLl9fc2xvdHNfXwogICAgICAgICAgICBpZiBrZXlbMF0gPT0gJ18nIGFuZCBoYXNhdHRyKHNlbGYsIGtleSkKICAgICAgICB9CgogICAgICAgICMgZGVhbCB3aXRoIGJhc2ljIGNvbnZlbmllbmNlIHdyYXBwZXJzCgogICAgICAgIHRyeToKICAgICAgICAgICAgY29sb3VyID0gcmVzdWx0LnBvcCgnY29sb3VyJykKICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBjb2xvdXI6CiAgICAgICAgICAgICAgICByZXN1bHRbJ2NvbG9yJ10gPSBjb2xvdXIudmFsdWUKCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0aW1lc3RhbXAgPSByZXN1bHQucG9wKCd0aW1lc3RhbXAnKQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIHRpbWVzdGFtcDoKICAgICAgICAgICAgICAgIGlmIHRpbWVzdGFtcC50emluZm86CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Wyd0aW1lc3RhbXAnXSA9IHRpbWVzdGFtcC5hc3RpbWV6b25lKHR6PWRhdGV0aW1lLnRpbWV6b25lLnV0YykuaXNvZm9ybWF0KCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Wyd0aW1lc3RhbXAnXSA9IHRpbWVzdGFtcC5yZXBsYWNlKHR6aW5mbz1kYXRldGltZS50aW1lem9uZS51dGMpLmlzb2Zvcm1hdCgpCgogICAgICAgICMgYWRkIGluIHRoZSBub24gcmF3IGF0dHJpYnV0ZSBvbmVzCiAgICAgICAgaWYgc2VsZi50eXBlOgogICAgICAgICAgICByZXN1bHRbJ3R5cGUnXSA9IHNlbGYudHlwZQoKICAgICAgICBpZiBzZWxmLmRlc2NyaXB0aW9uOgogICAgICAgICAgICByZXN1bHRbJ2Rlc2NyaXB0aW9uJ10gPSBzZWxmLmRlc2NyaXB0aW9uCgogICAgICAgIGlmIHNlbGYudXJsOgogICAgICAgICAgICByZXN1bHRbJ3VybCddID0gc2VsZi51cmwKCiAgICAgICAgaWYgc2VsZi50aXRsZToKICAgICAgICAgICAgcmVzdWx0Wyd0aXRsZSddID0gc2VsZi50aXRsZQoKICAgICAgICByZXR1cm4gcmVzdWx0Cg==
