statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/contrib/pyopenssl.py
  contents:
  - name: PyOpenSSLContext
    score: 0.0
    code: |-
      def makefile(self, mode, bufsize=-1):
              self._makefile_refs += 1
              return _fileobject(self, mode, bufsize, close=True)
    tokens: resume load_name __name__ store_name __module__ load_const STRING_BASE64_LEN_S_ENT_HIGH store_name __qualname__ load_const STRING_LEN_M_ENT_HIGH store_name __doc__ load_const OBJECT make_function store_name __init__ load_name property load_const OBJECT make_function call store_name options load_name options load_attr setter load_const OBJECT make_function call store_name options load_name property load_const OBJECT make_function call store_name verify_mode load_name verify_mode load_attr setter load_const OBJECT make_function call store_name verify_mode load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name set_ciphers load_const load_const OBJECT make_function defaults store_name STRING_LEN_S_ENT_HIGH load_const load_const OBJECT make_function defaults store_name load_cert_chain nop nop nop load_const load_const OBJECT make_function defaults store_name wrap_socket return_const None
    hash: f59ed784cfd95ba2c11e42d491172f5d4ecb33a1994787d4a074a4300898c165
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/contrib/pyopenssl.py
  : IiIiClNTTCB3aXRoIFNOSV8tc3VwcG9ydCBmb3IgUHl0aG9uIDIuIEZvbGxvdyB0aGVzZSBpbnN0cnVjdGlvbnMgaWYgeW91IHdvdWxkCmxpa2UgdG8gdmVyaWZ5IFNTTCBjZXJ0aWZpY2F0ZXMgaW4gUHl0aG9uIDIuIE5vdGUsIHRoZSBkZWZhdWx0IGxpYnJhcmllcyBkbwoqbm90KiBkbyBjZXJ0aWZpY2F0ZSBjaGVja2luZzsgeW91IG5lZWQgdG8gZG8gYWRkaXRpb25hbCB3b3JrIHRvIHZhbGlkYXRlCmNlcnRpZmljYXRlcyB5b3Vyc2VsZi4KClRoaXMgbmVlZHMgdGhlIGZvbGxvd2luZyBwYWNrYWdlcyBpbnN0YWxsZWQ6CgoqIHB5T3BlblNTTCAodGVzdGVkIHdpdGggMTYuMC4wKQoqIGNyeXB0b2dyYXBoeSAobWluaW11bSAxLjMuNCwgZnJvbSBweW9wZW5zc2wpCiogaWRuYSAobWluaW11bSAyLjAsIGZyb20gY3J5cHRvZ3JhcGh5KQoKSG93ZXZlciwgcHlvcGVuc3NsIGRlcGVuZHMgb24gY3J5cHRvZ3JhcGh5LCB3aGljaCBkZXBlbmRzIG9uIGlkbmEsIHNvIHdoaWxlIHdlCnVzZSBhbGwgdGhyZWUgZGlyZWN0bHkgaGVyZSB3ZSBlbmQgdXAgaGF2aW5nIHJlbGF0aXZlbHkgZmV3IHBhY2thZ2VzIHJlcXVpcmVkLgoKWW91IGNhbiBpbnN0YWxsIHRoZW0gd2l0aCB0aGUgZm9sbG93aW5nIGNvbW1hbmQ6CgogICAgcGlwIGluc3RhbGwgcHlvcGVuc3NsIGNyeXB0b2dyYXBoeSBpZG5hCgpUbyBhY3RpdmF0ZSBjZXJ0aWZpY2F0ZSBjaGVja2luZywgY2FsbAo6ZnVuYzpgfnVybGxpYjMuY29udHJpYi5weW9wZW5zc2wuaW5qZWN0X2ludG9fdXJsbGliM2AgZnJvbSB5b3VyIFB5dGhvbiBjb2RlCmJlZm9yZSB5b3UgYmVnaW4gbWFraW5nIEhUVFAgcmVxdWVzdHMuIFRoaXMgY2FuIGJlIGRvbmUgaW4gYSBgYHNpdGVjdXN0b21pemVgYAptb2R1bGUsIG9yIGF0IGFueSBvdGhlciB0aW1lIGJlZm9yZSB5b3VyIGFwcGxpY2F0aW9uIGJlZ2lucyB1c2luZyBgYHVybGxpYjNgYCwKbGlrZSB0aGlzOjoKCiAgICB0cnk6CiAgICAgICAgaW1wb3J0IHVybGxpYjMuY29udHJpYi5weW9wZW5zc2wKICAgICAgICB1cmxsaWIzLmNvbnRyaWIucHlvcGVuc3NsLmluamVjdF9pbnRvX3VybGxpYjMoKQogICAgZXhjZXB0IEltcG9ydEVycm9yOgogICAgICAgIHBhc3MKCk5vdyB5b3UgY2FuIHVzZSA6bW9kOmB1cmxsaWIzYCBhcyB5b3Ugbm9ybWFsbHkgd291bGQsIGFuZCBpdCB3aWxsIHN1cHBvcnQgU05JCndoZW4gdGhlIHJlcXVpcmVkIG1vZHVsZXMgYXJlIGluc3RhbGxlZC4KCkFjdGl2YXRpbmcgdGhpcyBtb2R1bGUgYWxzbyBoYXMgdGhlIHBvc2l0aXZlIHNpZGUgZWZmZWN0IG9mIGRpc2FibGluZyBTU0wvVExTCmNvbXByZXNzaW9uIGluIFB5dGhvbiAyIChzZWUgYENSSU1FIGF0dGFja2BfKS4KCklmIHlvdSB3YW50IHRvIGNvbmZpZ3VyZSB0aGUgZGVmYXVsdCBsaXN0IG9mIHN1cHBvcnRlZCBjaXBoZXIgc3VpdGVzLCB5b3UgY2FuCnNldCB0aGUgYGB1cmxsaWIzLmNvbnRyaWIucHlvcGVuc3NsLkRFRkFVTFRfU1NMX0NJUEhFUl9MSVNUYGAgdmFyaWFibGUuCgouLiBfc25pOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TZXJ2ZXJfTmFtZV9JbmRpY2F0aW9uCi4uIF9jcmltZSBhdHRhY2s6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NSSU1FXyhzZWN1cml0eV9leHBsb2l0KQoiIiIKZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBhYnNvbHV0ZV9pbXBvcnQKCmltcG9ydCBPcGVuU1NMLlNTTApmcm9tIGNyeXB0b2dyYXBoeSBpbXBvcnQgeDUwOQpmcm9tIGNyeXB0b2dyYXBoeS5oYXptYXQuYmFja2VuZHMub3BlbnNzbCBpbXBvcnQgYmFja2VuZCBhcyBvcGVuc3NsX2JhY2tlbmQKZnJvbSBjcnlwdG9ncmFwaHkuaGF6bWF0LmJhY2tlbmRzLm9wZW5zc2wueDUwOSBpbXBvcnQgX0NlcnRpZmljYXRlCnRyeToKICAgIGZyb20gY3J5cHRvZ3JhcGh5Lng1MDkgaW1wb3J0IFVuc3VwcG9ydGVkRXh0ZW5zaW9uCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICMgVW5zdXBwb3J0ZWRFeHRlbnNpb24gaXMgZ29uZSBpbiBjcnlwdG9ncmFwaHkgPj0gMi4xLjAKICAgIGNsYXNzIFVuc3VwcG9ydGVkRXh0ZW5zaW9uKEV4Y2VwdGlvbik6CiAgICAgICAgcGFzcwoKZnJvbSBzb2NrZXQgaW1wb3J0IHRpbWVvdXQsIGVycm9yIGFzIFNvY2tldEVycm9yCmZyb20gaW8gaW1wb3J0IEJ5dGVzSU8KCnRyeTogICMgUGxhdGZvcm0tc3BlY2lmaWM6IFB5dGhvbiAyCiAgICBmcm9tIHNvY2tldCBpbXBvcnQgX2ZpbGVvYmplY3QKZXhjZXB0IEltcG9ydEVycm9yOiAgIyBQbGF0Zm9ybS1zcGVjaWZpYzogUHl0aG9uIDMKICAgIF9maWxlb2JqZWN0ID0gTm9uZQogICAgZnJvbSAuLnBhY2thZ2VzLmJhY2twb3J0cy5tYWtlZmlsZSBpbXBvcnQgYmFja3BvcnRfbWFrZWZpbGUKCmltcG9ydCBsb2dnaW5nCmltcG9ydCBzc2wKZnJvbSAuLnBhY2thZ2VzIGltcG9ydCBzaXgKaW1wb3J0IHN5cwoKZnJvbSAuLiBpbXBvcnQgdXRpbAoKX19hbGxfXyA9IFsnaW5qZWN0X2ludG9fdXJsbGliMycsICdleHRyYWN0X2Zyb21fdXJsbGliMyddCgojIFNOSSBhbHdheXMgd29ya3MuCkhBU19TTkkgPSBUcnVlCgojIE1hcCBmcm9tIHVybGxpYjMgdG8gUHlPcGVuU1NMIGNvbXBhdGlibGUgcGFyYW1ldGVyLXZhbHVlcy4KX29wZW5zc2xfdmVyc2lvbnMgPSB7CiAgICBzc2wuUFJPVE9DT0xfU1NMdjIzOiBPcGVuU1NMLlNTTC5TU0x2MjNfTUVUSE9ELAogICAgc3NsLlBST1RPQ09MX1RMU3YxOiBPcGVuU1NMLlNTTC5UTFN2MV9NRVRIT0QsCn0KCmlmIGhhc2F0dHIoc3NsLCAnUFJPVE9DT0xfVExTdjFfMScpIGFuZCBoYXNhdHRyKE9wZW5TU0wuU1NMLCAnVExTdjFfMV9NRVRIT0QnKToKICAgIF9vcGVuc3NsX3ZlcnNpb25zW3NzbC5QUk9UT0NPTF9UTFN2MV8xXSA9IE9wZW5TU0wuU1NMLlRMU3YxXzFfTUVUSE9ECgppZiBoYXNhdHRyKHNzbCwgJ1BST1RPQ09MX1RMU3YxXzInKSBhbmQgaGFzYXR0cihPcGVuU1NMLlNTTCwgJ1RMU3YxXzJfTUVUSE9EJyk6CiAgICBfb3BlbnNzbF92ZXJzaW9uc1tzc2wuUFJPVE9DT0xfVExTdjFfMl0gPSBPcGVuU1NMLlNTTC5UTFN2MV8yX01FVEhPRAoKdHJ5OgogICAgX29wZW5zc2xfdmVyc2lvbnMudXBkYXRlKHtzc2wuUFJPVE9DT0xfU1NMdjM6IE9wZW5TU0wuU1NMLlNTTHYzX01FVEhPRH0pCmV4Y2VwdCBBdHRyaWJ1dGVFcnJvcjoKICAgIHBhc3MKCl9zdGRsaWJfdG9fb3BlbnNzbF92ZXJpZnkgPSB7CiAgICBzc2wuQ0VSVF9OT05FOiBPcGVuU1NMLlNTTC5WRVJJRllfTk9ORSwKICAgIHNzbC5DRVJUX09QVElPTkFMOiBPcGVuU1NMLlNTTC5WRVJJRllfUEVFUiwKICAgIHNzbC5DRVJUX1JFUVVJUkVEOgogICAgICAgIE9wZW5TU0wuU1NMLlZFUklGWV9QRUVSICsgT3BlblNTTC5TU0wuVkVSSUZZX0ZBSUxfSUZfTk9fUEVFUl9DRVJULAp9Cl9vcGVuc3NsX3RvX3N0ZGxpYl92ZXJpZnkgPSBkaWN0KAogICAgKHYsIGspIGZvciBrLCB2IGluIF9zdGRsaWJfdG9fb3BlbnNzbF92ZXJpZnkuaXRlbXMoKQopCgojIE9wZW5TU0wgd2lsbCBvbmx5IHdyaXRlIDE2SyBhdCBhIHRpbWUKU1NMX1dSSVRFX0JMT0NLU0laRSA9IDE2Mzg0CgpvcmlnX3V0aWxfSEFTX1NOSSA9IHV0aWwuSEFTX1NOSQpvcmlnX3V0aWxfU1NMQ29udGV4dCA9IHV0aWwuc3NsXy5TU0xDb250ZXh0CgoKbG9nID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pCgoKZGVmIGluamVjdF9pbnRvX3VybGxpYjMoKToKICAgICdNb25rZXktcGF0Y2ggdXJsbGliMyB3aXRoIFB5T3BlblNTTC1iYWNrZWQgU1NMLXN1cHBvcnQuJwoKICAgIF92YWxpZGF0ZV9kZXBlbmRlbmNpZXNfbWV0KCkKCiAgICB1dGlsLnNzbF8uU1NMQ29udGV4dCA9IFB5T3BlblNTTENvbnRleHQKICAgIHV0aWwuSEFTX1NOSSA9IEhBU19TTkkKICAgIHV0aWwuc3NsXy5IQVNfU05JID0gSEFTX1NOSQogICAgdXRpbC5JU19QWU9QRU5TU0wgPSBUcnVlCiAgICB1dGlsLnNzbF8uSVNfUFlPUEVOU1NMID0gVHJ1ZQoKCmRlZiBleHRyYWN0X2Zyb21fdXJsbGliMygpOgogICAgJ1VuZG8gbW9ua2V5LXBhdGNoaW5nIGJ5IDpmdW5jOmBpbmplY3RfaW50b191cmxsaWIzYC4nCgogICAgdXRpbC5zc2xfLlNTTENvbnRleHQgPSBvcmlnX3V0aWxfU1NMQ29udGV4dAogICAgdXRpbC5IQVNfU05JID0gb3JpZ191dGlsX0hBU19TTkkKICAgIHV0aWwuc3NsXy5IQVNfU05JID0gb3JpZ191dGlsX0hBU19TTkkKICAgIHV0aWwuSVNfUFlPUEVOU1NMID0gRmFsc2UKICAgIHV0aWwuc3NsXy5JU19QWU9QRU5TU0wgPSBGYWxzZQoKCmRlZiBfdmFsaWRhdGVfZGVwZW5kZW5jaWVzX21ldCgpOgogICAgIiIiCiAgICBWZXJpZmllcyB0aGF0IFB5T3BlblNTTCdzIHBhY2thZ2UtbGV2ZWwgZGVwZW5kZW5jaWVzIGhhdmUgYmVlbiBtZXQuCiAgICBUaHJvd3MgYEltcG9ydEVycm9yYCBpZiB0aGV5IGFyZSBub3QgbWV0LgogICAgIiIiCiAgICAjIE1ldGhvZCBhZGRlZCBpbiBgY3J5cHRvZ3JhcGh5PT0xLjFgOyBub3QgYXZhaWxhYmxlIGluIG9sZGVyIHZlcnNpb25zCiAgICBmcm9tIGNyeXB0b2dyYXBoeS54NTA5LmV4dGVuc2lvbnMgaW1wb3J0IEV4dGVuc2lvbnMKICAgIGlmIGdldGF0dHIoRXh0ZW5zaW9ucywgImdldF9leHRlbnNpb25fZm9yX2NsYXNzIiwgTm9uZSkgaXMgTm9uZToKICAgICAgICByYWlzZSBJbXBvcnRFcnJvcigiJ2NyeXB0b2dyYXBoeScgbW9kdWxlIG1pc3NpbmcgcmVxdWlyZWQgZnVuY3Rpb25hbGl0eS4gICIKICAgICAgICAgICAgICAgICAgICAgICAgICAiVHJ5IHVwZ3JhZGluZyB0byB2MS4zLjQgb3IgbmV3ZXIuIikKCiAgICAjIHB5T3BlblNTTCAwLjE0IGFuZCBhYm92ZSB1c2UgY3J5cHRvZ3JhcGh5IGZvciBPcGVuU1NMIGJpbmRpbmdzLiBUaGUgX3g1MDkKICAgICMgYXR0cmlidXRlIGlzIG9ubHkgcHJlc2VudCBvbiB0aG9zZSB2ZXJzaW9ucy4KICAgIGZyb20gT3BlblNTTC5jcnlwdG8gaW1wb3J0IFg1MDkKICAgIHg1MDkgPSBYNTA5KCkKICAgIGlmIGdldGF0dHIoeDUwOSwgIl94NTA5IiwgTm9uZSkgaXMgTm9uZToKICAgICAgICByYWlzZSBJbXBvcnRFcnJvcigiJ3B5T3BlblNTTCcgbW9kdWxlIG1pc3NpbmcgcmVxdWlyZWQgZnVuY3Rpb25hbGl0eS4gIgogICAgICAgICAgICAgICAgICAgICAgICAgICJUcnkgdXBncmFkaW5nIHRvIHYwLjE0IG9yIG5ld2VyLiIpCgoKZGVmIF9kbnNuYW1lX3RvX3N0ZGxpYihuYW1lKToKICAgICIiIgogICAgQ29udmVydHMgYSBkTlNOYW1lIFN1YmplY3RBbHRlcm5hdGl2ZU5hbWUgZmllbGQgdG8gdGhlIGZvcm0gdXNlZCBieSB0aGUKICAgIHN0YW5kYXJkIGxpYnJhcnkgb24gdGhlIGdpdmVuIFB5dGhvbiB2ZXJzaW9uLgoKICAgIENyeXB0b2dyYXBoeSBwcm9kdWNlcyBhIGROU05hbWUgYXMgYSB1bmljb2RlIHN0cmluZyB0aGF0IHdhcyBpZG5hLWRlY29kZWQKICAgIGZyb20gQVNDSUkgYnl0ZXMuIFdlIG5lZWQgdG8gaWRuYS1lbmNvZGUgdGhhdCBzdHJpbmcgdG8gZ2V0IGl0IGJhY2ssIGFuZAogICAgdGhlbiBvbiBQeXRob24gMyB3ZSBhbHNvIG5lZWQgdG8gY29udmVydCB0byB1bmljb2RlIHZpYSBVVEYtOCAodGhlIHN0ZGxpYgogICAgdXNlcyBQeVVuaWNvZGVfRnJvbVN0cmluZ0FuZFNpemUgb24gaXQsIHdoaWNoIGRlY29kZXMgdmlhIFVURi04KS4KCiAgICBJZiB0aGUgbmFtZSBjYW5ub3QgYmUgaWRuYS1lbmNvZGVkIHRoZW4gd2UgcmV0dXJuIE5vbmUgc2lnbmFsbGluZyB0aGF0CiAgICB0aGUgbmFtZSBnaXZlbiBzaG91bGQgYmUgc2tpcHBlZC4KICAgICIiIgogICAgZGVmIGlkbmFfZW5jb2RlKG5hbWUpOgogICAgICAgICIiIgogICAgICAgIEJvcnJvd2VkIHdob2xlc2FsZSBmcm9tIHRoZSBQeXRob24gQ3J5cHRvZ3JhcGh5IFByb2plY3QuIEl0IHR1cm5zIG91dAogICAgICAgIHRoYXQgd2UgY2FuJ3QganVzdCBzYWZlbHkgY2FsbCBgaWRuYS5lbmNvZGVgOiBpdCBjYW4gZXhwbG9kZSBmb3IKICAgICAgICB3aWxkY2FyZCBuYW1lcy4gVGhpcyBhdm9pZHMgdGhhdCBwcm9ibGVtLgogICAgICAgICIiIgogICAgICAgIGltcG9ydCBpZG5hCgogICAgICAgIHRyeToKICAgICAgICAgICAgZm9yIHByZWZpeCBpbiBbdScqLicsIHUnLiddOgogICAgICAgICAgICAgICAgaWYgbmFtZS5zdGFydHN3aXRoKHByZWZpeCk6CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IG5hbWVbbGVuKHByZWZpeCk6XQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmVmaXguZW5jb2RlKCdhc2NpaScpICsgaWRuYS5lbmNvZGUobmFtZSkKICAgICAgICAgICAgcmV0dXJuIGlkbmEuZW5jb2RlKG5hbWUpCiAgICAgICAgZXhjZXB0IGlkbmEuY29yZS5JRE5BRXJyb3I6CiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgaWYgJzonIGluIG5hbWU6CiAgICAgICAgcmV0dXJuIG5hbWUKCiAgICBuYW1lID0gaWRuYV9lbmNvZGUobmFtZSkKICAgIGlmIG5hbWUgaXMgTm9uZToKICAgICAgICByZXR1cm4gTm9uZQogICAgZWxpZiBzeXMudmVyc2lvbl9pbmZvID49ICgzLCAwKToKICAgICAgICBuYW1lID0gbmFtZS5kZWNvZGUoJ3V0Zi04JykKICAgIHJldHVybiBuYW1lCgoKZGVmIGdldF9zdWJqX2FsdF9uYW1lKHBlZXJfY2VydCk6CiAgICAiIiIKICAgIEdpdmVuIGFuIFB5T3BlblNTTCBjZXJ0aWZpY2F0ZSwgcHJvdmlkZXMgYWxsIHRoZSBzdWJqZWN0IGFsdGVybmF0aXZlIG5hbWVzLgogICAgIiIiCiAgICAjIFBhc3MgdGhlIGNlcnQgdG8gY3J5cHRvZ3JhcGh5LCB3aGljaCBoYXMgbXVjaCBiZXR0ZXIgQVBJcyBmb3IgdGhpcy4KICAgIGlmIGhhc2F0dHIocGVlcl9jZXJ0LCAidG9fY3J5cHRvZ3JhcGh5Iik6CiAgICAgICAgY2VydCA9IHBlZXJfY2VydC50b19jcnlwdG9ncmFwaHkoKQogICAgZWxzZToKICAgICAgICAjIFRoaXMgaXMgdGVjaG5pY2FsbHkgdXNpbmcgcHJpdmF0ZSBBUElzLCBidXQgc2hvdWxkIHdvcmsgYWNyb3NzIGFsbAogICAgICAgICMgcmVsZXZhbnQgdmVyc2lvbnMgYmVmb3JlIFB5T3BlblNTTCBnb3QgYSBwcm9wZXIgQVBJIGZvciB0aGlzLgogICAgICAgIGNlcnQgPSBfQ2VydGlmaWNhdGUob3BlbnNzbF9iYWNrZW5kLCBwZWVyX2NlcnQuX3g1MDkpCgogICAgIyBXZSB3YW50IHRvIGZpbmQgdGhlIFNBTiBleHRlbnNpb24uIEFzayBDcnlwdG9ncmFwaHkgdG8gbG9jYXRlIGl0IChpdCdzCiAgICAjIGZhc3RlciB0aGFuIGxvb3BpbmcgaW4gUHl0aG9uKQogICAgdHJ5OgogICAgICAgIGV4dCA9IGNlcnQuZXh0ZW5zaW9ucy5nZXRfZXh0ZW5zaW9uX2Zvcl9jbGFzcygKICAgICAgICAgICAgeDUwOS5TdWJqZWN0QWx0ZXJuYXRpdmVOYW1lCiAgICAgICAgKS52YWx1ZQogICAgZXhjZXB0IHg1MDkuRXh0ZW5zaW9uTm90Rm91bmQ6CiAgICAgICAgIyBObyBzdWNoIGV4dGVuc2lvbiwgcmV0dXJuIHRoZSBlbXB0eSBsaXN0LgogICAgICAgIHJldHVybiBbXQogICAgZXhjZXB0ICh4NTA5LkR1cGxpY2F0ZUV4dGVuc2lvbiwgVW5zdXBwb3J0ZWRFeHRlbnNpb24sCiAgICAgICAgICAgIHg1MDkuVW5zdXBwb3J0ZWRHZW5lcmFsTmFtZVR5cGUsIFVuaWNvZGVFcnJvcikgYXMgZToKICAgICAgICAjIEEgcHJvYmxlbSBoYXMgYmVlbiBmb3VuZCB3aXRoIHRoZSBxdWFsaXR5IG9mIHRoZSBjZXJ0aWZpY2F0ZS4gQXNzdW1lCiAgICAgICAgIyBubyBTQU4gZmllbGQgaXMgcHJlc2VudC4KICAgICAgICBsb2cud2FybmluZygKICAgICAgICAgICAgIkEgcHJvYmxlbSB3YXMgZW5jb3VudGVyZWQgd2l0aCB0aGUgY2VydGlmaWNhdGUgdGhhdCBwcmV2ZW50ZWQgIgogICAgICAgICAgICAidXJsbGliMyBmcm9tIGZpbmRpbmcgdGhlIFN1YmplY3RBbHRlcm5hdGl2ZU5hbWUgZmllbGQuIFRoaXMgY2FuICIKICAgICAgICAgICAgImFmZmVjdCBjZXJ0aWZpY2F0ZSB2YWxpZGF0aW9uLiBUaGUgZXJyb3Igd2FzICVzIiwKICAgICAgICAgICAgZSwKICAgICAgICApCiAgICAgICAgcmV0dXJuIFtdCgogICAgIyBXZSB3YW50IHRvIHJldHVybiBkTlNOYW1lIGFuZCBpUEFkZHJlc3MgZmllbGRzLiBXZSBuZWVkIHRvIGNhc3QgdGhlIElQcwogICAgIyBiYWNrIHRvIHN0cmluZ3MgYmVjYXVzZSB0aGUgbWF0Y2hfaG9zdG5hbWUgZnVuY3Rpb24gd2FudHMgdGhlbSBhcwogICAgIyBzdHJpbmdzLgogICAgIyBTYWRseSB0aGUgRE5TIG5hbWVzIG5lZWQgdG8gYmUgaWRuYSBlbmNvZGVkIGFuZCB0aGVuLCBvbiBQeXRob24gMywgVVRGLTgKICAgICMgZGVjb2RlZC4gVGhpcyBpcyBwcmV0dHkgZnJ1c3RyYXRpbmcsIGJ1dCB0aGF0J3Mgd2hhdCB0aGUgc3RhbmRhcmQgbGlicmFyeQogICAgIyBkb2VzIHdpdGggY2VydGlmaWNhdGVzLCBhbmQgc28gd2UgbmVlZCB0byBhdHRlbXB0IHRvIGRvIHRoZSBzYW1lLgogICAgIyBXZSBhbHNvIHdhbnQgdG8gc2tpcCBvdmVyIG5hbWVzIHdoaWNoIGNhbm5vdCBiZSBpZG5hIGVuY29kZWQuCiAgICBuYW1lcyA9IFsKICAgICAgICAoJ0ROUycsIG5hbWUpIGZvciBuYW1lIGluIG1hcChfZG5zbmFtZV90b19zdGRsaWIsIGV4dC5nZXRfdmFsdWVzX2Zvcl90eXBlKHg1MDkuRE5TTmFtZSkpCiAgICAgICAgaWYgbmFtZSBpcyBub3QgTm9uZQogICAgXQogICAgbmFtZXMuZXh0ZW5kKAogICAgICAgICgnSVAgQWRkcmVzcycsIHN0cihuYW1lKSkKICAgICAgICBmb3IgbmFtZSBpbiBleHQuZ2V0X3ZhbHVlc19mb3JfdHlwZSh4NTA5LklQQWRkcmVzcykKICAgICkKCiAgICByZXR1cm4gbmFtZXMKCgpjbGFzcyBXcmFwcGVkU29ja2V0KG9iamVjdCk6CiAgICAnJydBUEktY29tcGF0aWJpbGl0eSB3cmFwcGVyIGZvciBQeXRob24gT3BlblNTTCdzIENvbm5lY3Rpb24tY2xhc3MuCgogICAgTm90ZTogX21ha2VmaWxlX3JlZnMsIF9kcm9wKCkgYW5kIF9yZXVzZSgpIGFyZSBuZWVkZWQgZm9yIHRoZSBnYXJiYWdlCiAgICBjb2xsZWN0b3Igb2YgcHlweS4KICAgICcnJwoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb25uZWN0aW9uLCBzb2NrZXQsIHN1cHByZXNzX3JhZ2dlZF9lb2ZzPVRydWUpOgogICAgICAgIHNlbGYuY29ubmVjdGlvbiA9IGNvbm5lY3Rpb24KICAgICAgICBzZWxmLnNvY2tldCA9IHNvY2tldAogICAgICAgIHNlbGYuc3VwcHJlc3NfcmFnZ2VkX2VvZnMgPSBzdXBwcmVzc19yYWdnZWRfZW9mcwogICAgICAgIHNlbGYuX21ha2VmaWxlX3JlZnMgPSAwCiAgICAgICAgc2VsZi5fY2xvc2VkID0gRmFsc2UKCiAgICBkZWYgZmlsZW5vKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLnNvY2tldC5maWxlbm8oKQoKICAgICMgQ29weS1wYXN0ZWQgZnJvbSBQeXRob24gMy41IHNvdXJjZSBjb2RlCiAgICBkZWYgX2RlY3JlZl9zb2NrZXRpb3Moc2VsZik6CiAgICAgICAgaWYgc2VsZi5fbWFrZWZpbGVfcmVmcyA+IDA6CiAgICAgICAgICAgIHNlbGYuX21ha2VmaWxlX3JlZnMgLT0gMQogICAgICAgIGlmIHNlbGYuX2Nsb3NlZDoKICAgICAgICAgICAgc2VsZi5jbG9zZSgpCgogICAgZGVmIHJlY3Yoc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRhdGEgPSBzZWxmLmNvbm5lY3Rpb24ucmVjdigqYXJncywgKiprd2FyZ3MpCiAgICAgICAgZXhjZXB0IE9wZW5TU0wuU1NMLlN5c0NhbGxFcnJvciBhcyBlOgogICAgICAgICAgICBpZiBzZWxmLnN1cHByZXNzX3JhZ2dlZF9lb2ZzIGFuZCBlLmFyZ3MgPT0gKC0xLCAnVW5leHBlY3RlZCBFT0YnKToKICAgICAgICAgICAgICAgIHJldHVybiBiJycKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJhaXNlIFNvY2tldEVycm9yKHN0cihlKSkKICAgICAgICBleGNlcHQgT3BlblNTTC5TU0wuWmVyb1JldHVybkVycm9yOgogICAgICAgICAgICBpZiBzZWxmLmNvbm5lY3Rpb24uZ2V0X3NodXRkb3duKCkgPT0gT3BlblNTTC5TU0wuUkVDRUlWRURfU0hVVERPV046CiAgICAgICAgICAgICAgICByZXR1cm4gYicnCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByYWlzZQogICAgICAgIGV4Y2VwdCBPcGVuU1NMLlNTTC5XYW50UmVhZEVycm9yOgogICAgICAgICAgICBpZiBub3QgdXRpbC53YWl0X2Zvcl9yZWFkKHNlbGYuc29ja2V0LCBzZWxmLnNvY2tldC5nZXR0aW1lb3V0KCkpOgogICAgICAgICAgICAgICAgcmFpc2UgdGltZW91dCgnVGhlIHJlYWQgb3BlcmF0aW9uIHRpbWVkIG91dCcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5yZWN2KCphcmdzLCAqKmt3YXJncykKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gZGF0YQoKICAgIGRlZiByZWN2X2ludG8oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbm5lY3Rpb24ucmVjdl9pbnRvKCphcmdzLCAqKmt3YXJncykKICAgICAgICBleGNlcHQgT3BlblNTTC5TU0wuU3lzQ2FsbEVycm9yIGFzIGU6CiAgICAgICAgICAgIGlmIHNlbGYuc3VwcHJlc3NfcmFnZ2VkX2VvZnMgYW5kIGUuYXJncyA9PSAoLTEsICdVbmV4cGVjdGVkIEVPRicpOgogICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJhaXNlIFNvY2tldEVycm9yKHN0cihlKSkKICAgICAgICBleGNlcHQgT3BlblNTTC5TU0wuWmVyb1JldHVybkVycm9yOgogICAgICAgICAgICBpZiBzZWxmLmNvbm5lY3Rpb24uZ2V0X3NodXRkb3duKCkgPT0gT3BlblNTTC5TU0wuUkVDRUlWRURfU0hVVERPV046CiAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICBleGNlcHQgT3BlblNTTC5TU0wuV2FudFJlYWRFcnJvcjoKICAgICAgICAgICAgaWYgbm90IHV0aWwud2FpdF9mb3JfcmVhZChzZWxmLnNvY2tldCwgc2VsZi5zb2NrZXQuZ2V0dGltZW91dCgpKToKICAgICAgICAgICAgICAgIHJhaXNlIHRpbWVvdXQoJ1RoZSByZWFkIG9wZXJhdGlvbiB0aW1lZCBvdXQnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmVjdl9pbnRvKCphcmdzLCAqKmt3YXJncykKCiAgICBkZWYgc2V0dGltZW91dChzZWxmLCB0aW1lb3V0KToKICAgICAgICByZXR1cm4gc2VsZi5zb2NrZXQuc2V0dGltZW91dCh0aW1lb3V0KQoKICAgIGRlZiBfc2VuZF91bnRpbF9kb25lKHNlbGYsIGRhdGEpOgogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbm5lY3Rpb24uc2VuZChkYXRhKQogICAgICAgICAgICBleGNlcHQgT3BlblNTTC5TU0wuV2FudFdyaXRlRXJyb3I6CiAgICAgICAgICAgICAgICBpZiBub3QgdXRpbC53YWl0X2Zvcl93cml0ZShzZWxmLnNvY2tldCwgc2VsZi5zb2NrZXQuZ2V0dGltZW91dCgpKToKICAgICAgICAgICAgICAgICAgICByYWlzZSB0aW1lb3V0KCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGV4Y2VwdCBPcGVuU1NMLlNTTC5TeXNDYWxsRXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIHJhaXNlIFNvY2tldEVycm9yKHN0cihlKSkKCiAgICBkZWYgc2VuZGFsbChzZWxmLCBkYXRhKToKICAgICAgICB0b3RhbF9zZW50ID0gMAogICAgICAgIHdoaWxlIHRvdGFsX3NlbnQgPCBsZW4oZGF0YSk6CiAgICAgICAgICAgIHNlbnQgPSBzZWxmLl9zZW5kX3VudGlsX2RvbmUoZGF0YVt0b3RhbF9zZW50OnRvdGFsX3NlbnQgKyBTU0xfV1JJVEVfQkxPQ0tTSVpFXSkKICAgICAgICAgICAgdG90YWxfc2VudCArPSBzZW50CgogICAgZGVmIHNodXRkb3duKHNlbGYpOgogICAgICAgICMgRklYTUUgcmV0aHJvdyBjb21wYXRpYmxlIGV4Y2VwdGlvbnMgc2hvdWxkIHdlIGV2ZXIgdXNlIHRoaXMKICAgICAgICBzZWxmLmNvbm5lY3Rpb24uc2h1dGRvd24oKQoKICAgIGRlZiBjbG9zZShzZWxmKToKICAgICAgICBpZiBzZWxmLl9tYWtlZmlsZV9yZWZzIDwgMToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5fY2xvc2VkID0gVHJ1ZQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29ubmVjdGlvbi5jbG9zZSgpCiAgICAgICAgICAgIGV4Y2VwdCBPcGVuU1NMLlNTTC5FcnJvcjoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuX21ha2VmaWxlX3JlZnMgLT0gMQoKICAgIGRlZiBnZXRwZWVyY2VydChzZWxmLCBiaW5hcnlfZm9ybT1GYWxzZSk6CiAgICAgICAgeDUwOSA9IHNlbGYuY29ubmVjdGlvbi5nZXRfcGVlcl9jZXJ0aWZpY2F0ZSgpCgogICAgICAgIGlmIG5vdCB4NTA5OgogICAgICAgICAgICByZXR1cm4geDUwOQoKICAgICAgICBpZiBiaW5hcnlfZm9ybToKICAgICAgICAgICAgcmV0dXJuIE9wZW5TU0wuY3J5cHRvLmR1bXBfY2VydGlmaWNhdGUoCiAgICAgICAgICAgICAgICBPcGVuU1NMLmNyeXB0by5GSUxFVFlQRV9BU04xLAogICAgICAgICAgICAgICAgeDUwOSkKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ3N1YmplY3QnOiAoCiAgICAgICAgICAgICAgICAoKCdjb21tb25OYW1lJywgeDUwOS5nZXRfc3ViamVjdCgpLkNOKSwpLAogICAgICAgICAgICApLAogICAgICAgICAgICAnc3ViamVjdEFsdE5hbWUnOiBnZXRfc3Vial9hbHRfbmFtZSh4NTA5KQogICAgICAgIH0KCiAgICBkZWYgX3JldXNlKHNlbGYpOgogICAgICAgIHNlbGYuX21ha2VmaWxlX3JlZnMgKz0gMQoKICAgIGRlZiBfZHJvcChzZWxmKToKICAgICAgICBpZiBzZWxmLl9tYWtlZmlsZV9yZWZzIDwgMToKICAgICAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5fbWFrZWZpbGVfcmVmcyAtPSAxCgoKaWYgX2ZpbGVvYmplY3Q6ICAjIFBsYXRmb3JtLXNwZWNpZmljOiBQeXRob24gMgogICAgZGVmIG1ha2VmaWxlKHNlbGYsIG1vZGUsIGJ1ZnNpemU9LTEpOgogICAgICAgIHNlbGYuX21ha2VmaWxlX3JlZnMgKz0gMQogICAgICAgIHJldHVybiBfZmlsZW9iamVjdChzZWxmLCBtb2RlLCBidWZzaXplLCBjbG9zZT1UcnVlKQplbHNlOiAgIyBQbGF0Zm9ybS1zcGVjaWZpYzogUHl0aG9uIDMKICAgIG1ha2VmaWxlID0gYmFja3BvcnRfbWFrZWZpbGUKCldyYXBwZWRTb2NrZXQubWFrZWZpbGUgPSBtYWtlZmlsZQoKCmNsYXNzIFB5T3BlblNTTENvbnRleHQob2JqZWN0KToKICAgICIiIgogICAgSSBhbSBhIHdyYXBwZXIgY2xhc3MgZm9yIHRoZSBQeU9wZW5TU0wgYGBDb250ZXh0YGAgb2JqZWN0LiBJIGFtIHJlc3BvbnNpYmxlCiAgICBmb3IgdHJhbnNsYXRpbmcgdGhlIGludGVyZmFjZSBvZiB0aGUgc3RhbmRhcmQgbGlicmFyeSBgYFNTTENvbnRleHRgYCBvYmplY3QKICAgIHRvIGNhbGxzIGludG8gUHlPcGVuU1NMLgogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgcHJvdG9jb2wpOgogICAgICAgIHNlbGYucHJvdG9jb2wgPSBfb3BlbnNzbF92ZXJzaW9uc1twcm90b2NvbF0KICAgICAgICBzZWxmLl9jdHggPSBPcGVuU1NMLlNTTC5Db250ZXh0KHNlbGYucHJvdG9jb2wpCiAgICAgICAgc2VsZi5fb3B0aW9ucyA9IDAKICAgICAgICBzZWxmLmNoZWNrX2hvc3RuYW1lID0gRmFsc2UKCiAgICBAcHJvcGVydHkKICAgIGRlZiBvcHRpb25zKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9vcHRpb25zCgogICAgQG9wdGlvbnMuc2V0dGVyCiAgICBkZWYgb3B0aW9ucyhzZWxmLCB2YWx1ZSk6CiAgICAgICAgc2VsZi5fb3B0aW9ucyA9IHZhbHVlCiAgICAgICAgc2VsZi5fY3R4LnNldF9vcHRpb25zKHZhbHVlKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHZlcmlmeV9tb2RlKHNlbGYpOgogICAgICAgIHJldHVybiBfb3BlbnNzbF90b19zdGRsaWJfdmVyaWZ5W3NlbGYuX2N0eC5nZXRfdmVyaWZ5X21vZGUoKV0KCiAgICBAdmVyaWZ5X21vZGUuc2V0dGVyCiAgICBkZWYgdmVyaWZ5X21vZGUoc2VsZiwgdmFsdWUpOgogICAgICAgIHNlbGYuX2N0eC5zZXRfdmVyaWZ5KAogICAgICAgICAgICBfc3RkbGliX3RvX29wZW5zc2xfdmVyaWZ5W3ZhbHVlXSwKICAgICAgICAgICAgX3ZlcmlmeV9jYWxsYmFjawogICAgICAgICkKCiAgICBkZWYgc2V0X2RlZmF1bHRfdmVyaWZ5X3BhdGhzKHNlbGYpOgogICAgICAgIHNlbGYuX2N0eC5zZXRfZGVmYXVsdF92ZXJpZnlfcGF0aHMoKQoKICAgIGRlZiBzZXRfY2lwaGVycyhzZWxmLCBjaXBoZXJzKToKICAgICAgICBpZiBpc2luc3RhbmNlKGNpcGhlcnMsIHNpeC50ZXh0X3R5cGUpOgogICAgICAgICAgICBjaXBoZXJzID0gY2lwaGVycy5lbmNvZGUoJ3V0Zi04JykKICAgICAgICBzZWxmLl9jdHguc2V0X2NpcGhlcl9saXN0KGNpcGhlcnMpCgogICAgZGVmIGxvYWRfdmVyaWZ5X2xvY2F0aW9ucyhzZWxmLCBjYWZpbGU9Tm9uZSwgY2FwYXRoPU5vbmUsIGNhZGF0YT1Ob25lKToKICAgICAgICBpZiBjYWZpbGUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGNhZmlsZSA9IGNhZmlsZS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICBpZiBjYXBhdGggaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGNhcGF0aCA9IGNhcGF0aC5lbmNvZGUoJ3V0Zi04JykKICAgICAgICBzZWxmLl9jdHgubG9hZF92ZXJpZnlfbG9jYXRpb25zKGNhZmlsZSwgY2FwYXRoKQogICAgICAgIGlmIGNhZGF0YSBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5fY3R4LmxvYWRfdmVyaWZ5X2xvY2F0aW9ucyhCeXRlc0lPKGNhZGF0YSkpCgogICAgZGVmIGxvYWRfY2VydF9jaGFpbihzZWxmLCBjZXJ0ZmlsZSwga2V5ZmlsZT1Ob25lLCBwYXNzd29yZD1Ob25lKToKICAgICAgICBzZWxmLl9jdHgudXNlX2NlcnRpZmljYXRlX2NoYWluX2ZpbGUoY2VydGZpbGUpCiAgICAgICAgaWYgcGFzc3dvcmQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuX2N0eC5zZXRfcGFzc3dkX2NiKGxhbWJkYSBtYXhfbGVuZ3RoLCBwcm9tcHRfdHdpY2UsIHVzZXJkYXRhOiBwYXNzd29yZCkKICAgICAgICBzZWxmLl9jdHgudXNlX3ByaXZhdGVrZXlfZmlsZShrZXlmaWxlIG9yIGNlcnRmaWxlKQoKICAgIGRlZiB3cmFwX3NvY2tldChzZWxmLCBzb2NrLCBzZXJ2ZXJfc2lkZT1GYWxzZSwKICAgICAgICAgICAgICAgICAgICBkb19oYW5kc2hha2Vfb25fY29ubmVjdD1UcnVlLCBzdXBwcmVzc19yYWdnZWRfZW9mcz1UcnVlLAogICAgICAgICAgICAgICAgICAgIHNlcnZlcl9ob3N0bmFtZT1Ob25lKToKICAgICAgICBjbnggPSBPcGVuU1NMLlNTTC5Db25uZWN0aW9uKHNlbGYuX2N0eCwgc29jaykKCiAgICAgICAgaWYgaXNpbnN0YW5jZShzZXJ2ZXJfaG9zdG5hbWUsIHNpeC50ZXh0X3R5cGUpOiAgIyBQbGF0Zm9ybS1zcGVjaWZpYzogUHl0aG9uIDMKICAgICAgICAgICAgc2VydmVyX2hvc3RuYW1lID0gc2VydmVyX2hvc3RuYW1lLmVuY29kZSgndXRmLTgnKQoKICAgICAgICBpZiBzZXJ2ZXJfaG9zdG5hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGNueC5zZXRfdGxzZXh0X2hvc3RfbmFtZShzZXJ2ZXJfaG9zdG5hbWUpCgogICAgICAgIGNueC5zZXRfY29ubmVjdF9zdGF0ZSgpCgogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGNueC5kb19oYW5kc2hha2UoKQogICAgICAgICAgICBleGNlcHQgT3BlblNTTC5TU0wuV2FudFJlYWRFcnJvcjoKICAgICAgICAgICAgICAgIGlmIG5vdCB1dGlsLndhaXRfZm9yX3JlYWQoc29jaywgc29jay5nZXR0aW1lb3V0KCkpOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIHRpbWVvdXQoJ3NlbGVjdCB0aW1lZCBvdXQnKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZXhjZXB0IE9wZW5TU0wuU1NMLkVycm9yIGFzIGU6CiAgICAgICAgICAgICAgICByYWlzZSBzc2wuU1NMRXJyb3IoJ2JhZCBoYW5kc2hha2U6ICVyJyAlIGUpCiAgICAgICAgICAgIGJyZWFrCgogICAgICAgIHJldHVybiBXcmFwcGVkU29ja2V0KGNueCwgc29jaykKCgpkZWYgX3ZlcmlmeV9jYWxsYmFjayhjbngsIHg1MDksIGVycl9ubywgZXJyX2RlcHRoLCByZXR1cm5fY29kZSk6CiAgICByZXR1cm4gZXJyX25vID09IDAK
