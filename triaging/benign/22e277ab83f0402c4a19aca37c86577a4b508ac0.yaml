statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/botaa3/1.0.0/botaa3-1.0.0/boto3-1.20.7/boto3/s3/transfer.py
  contents:
  - name: S3Transfer.upload_file
    score: 0.0
    code: |-
      def upload_file(self, filename, bucket, key,
                          callback=None, extra_args=None):
              """Upload a file to an S3 object.

              Variants have also been injected into S3 client, Bucket and Object.
              You don't have to use S3Transfer.upload_file() directly.

              .. seealso::
                  :py:meth:`S3.Client.upload_file`
                  :py:meth:`S3.Client.upload_fileobj`
              """
              if not isinstance(filename, six.string_types):
                  raise ValueError('Filename must be a string')

              subscribers = self._get_subscribers(callback)
              future = self._manager.upload(
                  filename, bucket, key, extra_args, subscribers)
              try:
                  future.result()
              # If a client error was raised, add the backwards compatibility layer
              # that raises a S3UploadFailedError. These specific errors were only
              # ever thrown for upload_parts but now can be thrown for any related
              # client error.
              except ClientError as e:
                  raise S3UploadFailedError(
                      "Failed to upload %s to %s: %s" % (
                          filename, '/'.join([bucket, key]), e))
    tokens: 'resume load_global isinstance load_fast filename load_global six load_attr string_types call pop_jump_if_true TO_NUMBER load_global ValueError load_const STRING_LEN_S_ENT_HIGH call raise_varargs load_fast self load_attr STRING_LEN_S_ENT_HIGH load_fast callback call store_fast subscribers load_fast self load_attr _manager load_attr upload load_fast filename load_fast bucket load_fast key load_fast extra_args load_fast subscribers call store_fast future nop load_fast future load_attr result call pop_top return_const None push_exc_info load_global ClientError check_exc_match pop_jump_if_false TO_NUMBER store_fast e load_global STRING_LEN_S_ENT_HIGH load_const STRING_LEN_S_ENT_HIGH load_fast filename format_value INTEGER load_const to load_const / load_attr join load_fast bucket load_fast key build_list call format_value INTEGER load_const : load_fast e format_value INTEGER build_string call raise_varargs load_const store_fast e delete_fast e reraise reraise copy pop_except reraise'
    hash: 1005b1460c796ca995b2f7766b42f1a49c2944acda2a7805d4f7bc465b381cd0
sources:
  .repo_cache/malicious_repos/pypi_malregistry/botaa3/1.0.0/botaa3-1.0.0/boto3-1.20.7/boto3/s3/transfer.py: IyBDb3B5cmlnaHQgMjAxNSBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLgojCiMgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIikuIFlvdQojIG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YKIyB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0CiMKIyBodHRwczovL2F3cy5hbWF6b24uY29tL2FwYWNoZTIuMC8KIwojIG9yIGluIHRoZSAibGljZW5zZSIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMKIyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRgojIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYwojIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiIiIkFic3RyYWN0aW9ucyBvdmVyIFMzJ3MgdXBsb2FkL2Rvd25sb2FkIG9wZXJhdGlvbnMuCgpUaGlzIG1vZHVsZSBwcm92aWRlcyBoaWdoIGxldmVsIGFic3RyYWN0aW9ucyBmb3IgZWZmaWNpZW50CnVwbG9hZHMvZG93bmxvYWRzLiAgSXQgaGFuZGxlcyBzZXZlcmFsIHRoaW5ncyBmb3IgdGhlIHVzZXI6CgoqIEF1dG9tYXRpY2FsbHkgc3dpdGNoaW5nIHRvIG11bHRpcGFydCB0cmFuc2ZlcnMgd2hlbgogIGEgZmlsZSBpcyBvdmVyIGEgc3BlY2lmaWMgc2l6ZSB0aHJlc2hvbGQKKiBVcGxvYWRpbmcvZG93bmxvYWRpbmcgYSBmaWxlIGluIHBhcmFsbGVsCiogUHJvZ3Jlc3MgY2FsbGJhY2tzIHRvIG1vbml0b3IgdHJhbnNmZXJzCiogUmV0cmllcy4gIFdoaWxlIGJvdG9jb3JlIGhhbmRsZXMgcmV0cmllcyBmb3Igc3RyZWFtaW5nIHVwbG9hZHMsCiAgaXQgaXMgbm90IHBvc3NpYmxlIGZvciBpdCB0byBoYW5kbGUgcmV0cmllcyBmb3Igc3RyZWFtaW5nCiAgZG93bmxvYWRzLiAgVGhpcyBtb2R1bGUgaGFuZGxlcyByZXRyaWVzIGZvciBib3RoIGNhc2VzIHNvCiAgeW91IGRvbid0IG5lZWQgdG8gaW1wbGVtZW50IGFueSByZXRyeSBsb2dpYyB5b3Vyc2VsZi4KClRoaXMgbW9kdWxlIGhhcyBhIHJlYXNvbmFibGUgc2V0IG9mIGRlZmF1bHRzLiAgSXQgYWxzbyBhbGxvd3MgeW91CnRvIGNvbmZpZ3VyZSBtYW55IGFzcGVjdHMgb2YgdGhlIHRyYW5zZmVyIHByb2Nlc3MgaW5jbHVkaW5nOgoKKiBNdWx0aXBhcnQgdGhyZXNob2xkIHNpemUKKiBNYXggcGFyYWxsZWwgZG93bmxvYWRzCiogU29ja2V0IHRpbWVvdXRzCiogUmV0cnkgYW1vdW50cwoKVGhlcmUgaXMgbm8gc3VwcG9ydCBmb3IgczMtPnMzIG11bHRpcGFydCBjb3BpZXMgYXQgdGhpcwp0aW1lLgoKCi4uIF9yZWZfczN0cmFuc2Zlcl91c2FnZToKClVzYWdlCj09PT09CgpUaGUgc2ltcGxlc3Qgd2F5IHRvIHVzZSB0aGlzIG1vZHVsZSBpczoKCi4uIGNvZGUtYmxvY2s6OiBweXRob24KCiAgICBjbGllbnQgPSBib3RvMy5jbGllbnQoJ3MzJywgJ3VzLXdlc3QtMicpCiAgICB0cmFuc2ZlciA9IFMzVHJhbnNmZXIoY2xpZW50KQogICAgIyBVcGxvYWQgL3RtcC9teWZpbGUgdG8gczM6Ly9idWNrZXQva2V5CiAgICB0cmFuc2Zlci51cGxvYWRfZmlsZSgnL3RtcC9teWZpbGUnLCAnYnVja2V0JywgJ2tleScpCgogICAgIyBEb3dubG9hZCBzMzovL2J1Y2tldC9rZXkgdG8gL3RtcC9teWZpbGUKICAgIHRyYW5zZmVyLmRvd25sb2FkX2ZpbGUoJ2J1Y2tldCcsICdrZXknLCAnL3RtcC9teWZpbGUnKQoKVGhlIGBgdXBsb2FkX2ZpbGVgYCBhbmQgYGBkb3dubG9hZF9maWxlYGAgbWV0aG9kcyBhbHNvIGFjY2VwdApgYCoqa3dhcmdzYGAsIHdoaWNoIHdpbGwgYmUgZm9yd2FyZGVkIHRocm91Z2ggdG8gdGhlIGNvcnJlc3BvbmRpbmcKY2xpZW50IG9wZXJhdGlvbi4gIEhlcmUgYXJlIGEgZmV3IGV4YW1wbGVzIHVzaW5nIGBgdXBsb2FkX2ZpbGVgYDo6CgogICAgIyBNYWtpbmcgdGhlIG9iamVjdCBwdWJsaWMKICAgIHRyYW5zZmVyLnVwbG9hZF9maWxlKCcvdG1wL215ZmlsZScsICdidWNrZXQnLCAna2V5JywKICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhX2FyZ3M9eydBQ0wnOiAncHVibGljLXJlYWQnfSkKCiAgICAjIFNldHRpbmcgbWV0YWRhdGEKICAgIHRyYW5zZmVyLnVwbG9hZF9maWxlKCcvdG1wL215ZmlsZScsICdidWNrZXQnLCAna2V5JywKICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhX2FyZ3M9eydNZXRhZGF0YSc6IHsnYSc6ICdiJywgJ2MnOiAnZCd9fSkKCiAgICAjIFNldHRpbmcgY29udGVudCB0eXBlCiAgICB0cmFuc2Zlci51cGxvYWRfZmlsZSgnL3RtcC9teWZpbGUuanNvbicsICdidWNrZXQnLCAna2V5JywKICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhX2FyZ3M9eydDb250ZW50VHlwZSc6ICJhcHBsaWNhdGlvbi9qc29uIn0pCgoKVGhlIGBgUzNUcmFuc2ZlcmBgIGNsYXNzIGFsc28gc3VwcG9ydHMgcHJvZ3Jlc3MgY2FsbGJhY2tzIHNvIHlvdSBjYW4KcHJvdmlkZSB0cmFuc2ZlciBwcm9ncmVzcyB0byB1c2Vycy4gIEJvdGggdGhlIGBgdXBsb2FkX2ZpbGVgYCBhbmQKYGBkb3dubG9hZF9maWxlYGAgbWV0aG9kcyB0YWtlIGFuIG9wdGlvbmFsIGBgY2FsbGJhY2tgYCBwYXJhbWV0ZXIuCkhlcmUncyBhbiBleGFtcGxlIG9mIGhvdyB0byBwcmludCBhIHNpbXBsZSBwcm9ncmVzcyBwZXJjZW50YWdlCnRvIHRoZSB1c2VyOgoKLi4gY29kZS1ibG9jazo6IHB5dGhvbgoKICAgIGNsYXNzIFByb2dyZXNzUGVyY2VudGFnZShvYmplY3QpOgogICAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmaWxlbmFtZSk6CiAgICAgICAgICAgIHNlbGYuX2ZpbGVuYW1lID0gZmlsZW5hbWUKICAgICAgICAgICAgc2VsZi5fc2l6ZSA9IGZsb2F0KG9zLnBhdGguZ2V0c2l6ZShmaWxlbmFtZSkpCiAgICAgICAgICAgIHNlbGYuX3NlZW5fc29fZmFyID0gMAogICAgICAgICAgICBzZWxmLl9sb2NrID0gdGhyZWFkaW5nLkxvY2soKQoKICAgICAgICBkZWYgX19jYWxsX18oc2VsZiwgYnl0ZXNfYW1vdW50KToKICAgICAgICAgICAgIyBUbyBzaW1wbGlmeSB3ZSdsbCBhc3N1bWUgdGhpcyBpcyBob29rZWQgdXAKICAgICAgICAgICAgIyB0byBhIHNpbmdsZSBmaWxlbmFtZS4KICAgICAgICAgICAgd2l0aCBzZWxmLl9sb2NrOgogICAgICAgICAgICAgICAgc2VsZi5fc2Vlbl9zb19mYXIgKz0gYnl0ZXNfYW1vdW50CiAgICAgICAgICAgICAgICBwZXJjZW50YWdlID0gKHNlbGYuX3NlZW5fc29fZmFyIC8gc2VsZi5fc2l6ZSkgKiAxMDAKICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoCiAgICAgICAgICAgICAgICAgICAgIlxyJXMgICVzIC8gJXMgICglLjJmJSUpIiAlICgKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fZmlsZW5hbWUsIHNlbGYuX3NlZW5fc29fZmFyLCBzZWxmLl9zaXplLAogICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlKSkKICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQoKCiAgICB0cmFuc2ZlciA9IFMzVHJhbnNmZXIoYm90bzMuY2xpZW50KCdzMycsICd1cy13ZXN0LTInKSkKICAgICMgVXBsb2FkIC90bXAvbXlmaWxlIHRvIHMzOi8vYnVja2V0L2tleSBhbmQgcHJpbnQgdXBsb2FkIHByb2dyZXNzLgogICAgdHJhbnNmZXIudXBsb2FkX2ZpbGUoJy90bXAvbXlmaWxlJywgJ2J1Y2tldCcsICdrZXknLAogICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s9UHJvZ3Jlc3NQZXJjZW50YWdlKCcvdG1wL215ZmlsZScpKQoKCgpZb3UgY2FuIGFsc28gcHJvdmlkZSBhIFRyYW5zZmVyQ29uZmlnIG9iamVjdCB0byB0aGUgUzNUcmFuc2ZlcgpvYmplY3QgdGhhdCBnaXZlcyB5b3UgbW9yZSBmaW5lIGdyYWluZWQgY29udHJvbCBvdmVyIHRoZQp0cmFuc2Zlci4gIEZvciBleGFtcGxlOgoKLi4gY29kZS1ibG9jazo6IHB5dGhvbgoKICAgIGNsaWVudCA9IGJvdG8zLmNsaWVudCgnczMnLCAndXMtd2VzdC0yJykKICAgIGNvbmZpZyA9IFRyYW5zZmVyQ29uZmlnKAogICAgICAgIG11bHRpcGFydF90aHJlc2hvbGQ9OCAqIDEwMjQgKiAxMDI0LAogICAgICAgIG1heF9jb25jdXJyZW5jeT0xMCwKICAgICAgICBudW1fZG93bmxvYWRfYXR0ZW1wdHM9MTAsCiAgICApCiAgICB0cmFuc2ZlciA9IFMzVHJhbnNmZXIoY2xpZW50LCBjb25maWcpCiAgICB0cmFuc2Zlci51cGxvYWRfZmlsZSgnL3RtcC9mb28nLCAnYnVja2V0JywgJ2tleScpCgoKIiIiCmZyb20gYm90b2NvcmUuZXhjZXB0aW9ucyBpbXBvcnQgQ2xpZW50RXJyb3IKZnJvbSBib3RvY29yZS5jb21wYXQgaW1wb3J0IHNpeApmcm9tIHMzdHJhbnNmZXIuZXhjZXB0aW9ucyBpbXBvcnQgUmV0cmllc0V4Y2VlZGVkRXJyb3IgYXMgXAogICAgUzNUcmFuc2ZlclJldHJpZXNFeGNlZWRlZEVycm9yCmZyb20gczN0cmFuc2Zlci5tYW5hZ2VyIGltcG9ydCBUcmFuc2ZlckNvbmZpZyBhcyBTM1RyYW5zZmVyQ29uZmlnCmZyb20gczN0cmFuc2Zlci5tYW5hZ2VyIGltcG9ydCBUcmFuc2Zlck1hbmFnZXIKZnJvbSBzM3RyYW5zZmVyLmZ1dHVyZXMgaW1wb3J0IE5vblRocmVhZGVkRXhlY3V0b3IKZnJvbSBzM3RyYW5zZmVyLnN1YnNjcmliZXJzIGltcG9ydCBCYXNlU3Vic2NyaWJlcgpmcm9tIHMzdHJhbnNmZXIudXRpbHMgaW1wb3J0IE9TVXRpbHMKCmZyb20gYm90bzMuZXhjZXB0aW9ucyBpbXBvcnQgUmV0cmllc0V4Y2VlZGVkRXJyb3IsIFMzVXBsb2FkRmFpbGVkRXJyb3IKCgpLQiA9IDEwMjQKTUIgPSBLQiAqIEtCCgoKZGVmIGNyZWF0ZV90cmFuc2Zlcl9tYW5hZ2VyKGNsaWVudCwgY29uZmlnLCBvc3V0aWw9Tm9uZSk6CiAgICAiIiJDcmVhdGVzIGEgdHJhbnNmZXIgbWFuYWdlciBiYXNlZCBvbiBjb25maWd1cmF0aW9uCgogICAgOnR5cGUgY2xpZW50OiBib3RvMy5jbGllbnQKICAgIDpwYXJhbSBjbGllbnQ6IFRoZSBTMyBjbGllbnQgdG8gdXNlCgogICAgOnR5cGUgY29uZmlnOiBib3RvMy5zMy50cmFuc2Zlci5UcmFuc2ZlckNvbmZpZwogICAgOnBhcmFtIGNvbmZpZzogVGhlIHRyYW5zZmVyIGNvbmZpZyB0byB1c2UKCiAgICA6dHlwZSBvc3V0aWw6IHMzdHJhbnNmZXIudXRpbHMuT1NVdGlscwogICAgOnBhcmFtIG9zdXRpbDogVGhlIG9zIHV0aWxpdHkgdG8gdXNlCgogICAgOnJ0eXBlOiBzM3RyYW5zZmVyLm1hbmFnZXIuVHJhbnNmZXJNYW5hZ2VyCiAgICA6cmV0dXJuczogQSB0cmFuc2ZlciBtYW5hZ2VyIGJhc2VkIG9uIHBhcmFtZXRlcnMgcHJvdmlkZWQKICAgICIiIgogICAgZXhlY3V0b3JfY2xzID0gTm9uZQogICAgaWYgbm90IGNvbmZpZy51c2VfdGhyZWFkczoKICAgICAgICBleGVjdXRvcl9jbHMgPSBOb25UaHJlYWRlZEV4ZWN1dG9yCiAgICByZXR1cm4gVHJhbnNmZXJNYW5hZ2VyKGNsaWVudCwgY29uZmlnLCBvc3V0aWwsIGV4ZWN1dG9yX2NscykKCgpjbGFzcyBUcmFuc2ZlckNvbmZpZyhTM1RyYW5zZmVyQ29uZmlnKToKICAgIEFMSUFTID0gewogICAgICAgICdtYXhfY29uY3VycmVuY3knOiAnbWF4X3JlcXVlc3RfY29uY3VycmVuY3knLAogICAgICAgICdtYXhfaW9fcXVldWUnOiAnbWF4X2lvX3F1ZXVlX3NpemUnCiAgICB9CgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsCiAgICAgICAgbXVsdGlwYXJ0X3RocmVzaG9sZD04ICogTUIsCiAgICAgICAgbWF4X2NvbmN1cnJlbmN5PTEwLAogICAgICAgIG11bHRpcGFydF9jaHVua3NpemU9OCAqIE1CLAogICAgICAgIG51bV9kb3dubG9hZF9hdHRlbXB0cz01LAogICAgICAgIG1heF9pb19xdWV1ZT0xMDAsCiAgICAgICAgaW9fY2h1bmtzaXplPTI1NiAqIEtCLAogICAgICAgIHVzZV90aHJlYWRzPVRydWUsCiAgICAgICAgbWF4X2JhbmR3aWR0aD1Ob25lLAogICAgKToKICAgICAgICAiIiJDb25maWd1cmF0aW9uIG9iamVjdCBmb3IgbWFuYWdlZCBTMyB0cmFuc2ZlcnMKCiAgICAgICAgOnBhcmFtIG11bHRpcGFydF90aHJlc2hvbGQ6IFRoZSB0cmFuc2ZlciBzaXplIHRocmVzaG9sZCBmb3Igd2hpY2gKICAgICAgICAgICAgbXVsdGlwYXJ0IHVwbG9hZHMsIGRvd25sb2FkcywgYW5kIGNvcGllcyB3aWxsIGF1dG9tYXRpY2FsbHkgYmUKICAgICAgICAgICAgdHJpZ2dlcmVkLgoKICAgICAgICA6cGFyYW0gbWF4X2NvbmN1cnJlbmN5OiBUaGUgbWF4aW11bSBudW1iZXIgb2YgdGhyZWFkcyB0aGF0IHdpbGwgYmUKICAgICAgICAgICAgbWFraW5nIHJlcXVlc3RzIHRvIHBlcmZvcm0gYSB0cmFuc2Zlci4gSWYgYGB1c2VfdGhyZWFkc2BgIGlzCiAgICAgICAgICAgIHNldCB0byBgYEZhbHNlYGAsIHRoZSB2YWx1ZSBwcm92aWRlZCBpcyBpZ25vcmVkIGFzIHRoZSB0cmFuc2ZlcgogICAgICAgICAgICB3aWxsIG9ubHkgZXZlciB1c2UgdGhlIG1haW4gdGhyZWFkLgoKICAgICAgICA6cGFyYW0gbXVsdGlwYXJ0X2NodW5rc2l6ZTogVGhlIHBhcnRpdGlvbiBzaXplIG9mIGVhY2ggcGFydCBmb3IgYQogICAgICAgICAgICBtdWx0aXBhcnQgdHJhbnNmZXIuCgogICAgICAgIDpwYXJhbSBudW1fZG93bmxvYWRfYXR0ZW1wdHM6IFRoZSBudW1iZXIgb2YgZG93bmxvYWQgYXR0ZW1wdHMgdGhhdAogICAgICAgICAgICB3aWxsIGJlIHJldHJpZWQgdXBvbiBlcnJvcnMgd2l0aCBkb3dubG9hZGluZyBhbiBvYmplY3QgaW4gUzMuCiAgICAgICAgICAgIE5vdGUgdGhhdCB0aGVzZSByZXRyaWVzIGFjY291bnQgZm9yIGVycm9ycyB0aGF0IG9jY3VyIHdoZW4KICAgICAgICAgICAgc3RyZWFtaW5nICBkb3duIHRoZSBkYXRhIGZyb20gczMgKGkuZS4gc29ja2V0IGVycm9ycyBhbmQgcmVhZAogICAgICAgICAgICB0aW1lb3V0cyB0aGF0IG9jY3VyIGFmdGVyIHJlY2VpdmluZyBhbiBPSyByZXNwb25zZSBmcm9tIHMzKS4KICAgICAgICAgICAgT3RoZXIgcmV0cnlhYmxlIGV4Y2VwdGlvbnMgc3VjaCBhcyB0aHJvdHRsaW5nIGVycm9ycyBhbmQgNXh4CiAgICAgICAgICAgIGVycm9ycyBhcmUgYWxyZWFkeSByZXRyaWVkIGJ5IGJvdG9jb3JlICh0aGlzIGRlZmF1bHQgaXMgNSkuIFRoaXMKICAgICAgICAgICAgZG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIG51bWJlciBvZiBleGNlcHRpb25zIHJldHJpZWQgYnkKICAgICAgICAgICAgYm90b2NvcmUuCgogICAgICAgIDpwYXJhbSBtYXhfaW9fcXVldWU6IFRoZSBtYXhpbXVtIGFtb3VudCBvZiByZWFkIHBhcnRzIHRoYXQgY2FuIGJlCiAgICAgICAgICAgIHF1ZXVlZCBpbiBtZW1vcnkgdG8gYmUgd3JpdHRlbiBmb3IgYSBkb3dubG9hZC4gVGhlIHNpemUgb2YgZWFjaAogICAgICAgICAgICBvZiB0aGVzZSByZWFkIHBhcnRzIGlzIGF0IG1vc3QgdGhlIHNpemUgb2YgYGBpb19jaHVua3NpemVgYC4KCiAgICAgICAgOnBhcmFtIGlvX2NodW5rc2l6ZTogVGhlIG1heCBzaXplIG9mIGVhY2ggY2h1bmsgaW4gdGhlIGlvIHF1ZXVlLgogICAgICAgICAgICBDdXJyZW50bHksIHRoaXMgaXMgc2l6ZSB1c2VkIHdoZW4gYGByZWFkYGAgaXMgY2FsbGVkIG9uIHRoZQogICAgICAgICAgICBkb3dubG9hZGVkIHN0cmVhbSBhcyB3ZWxsLgoKICAgICAgICA6cGFyYW0gdXNlX3RocmVhZHM6IElmIFRydWUsIHRocmVhZHMgd2lsbCBiZSB1c2VkIHdoZW4gcGVyZm9ybWluZwogICAgICAgICAgICBTMyB0cmFuc2ZlcnMuIElmIEZhbHNlLCBubyB0aHJlYWRzIHdpbGwgYmUgdXNlZCBpbgogICAgICAgICAgICBwZXJmb3JtaW5nIHRyYW5zZmVyczogYWxsIGxvZ2ljIHdpbGwgYmUgcmFuIGluIHRoZSBtYWluIHRocmVhZC4KCiAgICAgICAgOnBhcmFtIG1heF9iYW5kd2lkdGg6IFRoZSBtYXhpbXVtIGJhbmR3aWR0aCB0aGF0IHdpbGwgYmUgY29uc3VtZWQKICAgICAgICAgICAgaW4gdXBsb2FkaW5nIGFuZCBkb3dubG9hZGluZyBmaWxlIGNvbnRlbnQuIFRoZSB2YWx1ZSBpcyBhbiBpbnRlZ2VyCiAgICAgICAgICAgIGluIHRlcm1zIG9mIGJ5dGVzIHBlciBzZWNvbmQuCiAgICAgICAgIiIiCiAgICAgICAgc3VwZXIoVHJhbnNmZXJDb25maWcsIHNlbGYpLl9faW5pdF9fKAogICAgICAgICAgICBtdWx0aXBhcnRfdGhyZXNob2xkPW11bHRpcGFydF90aHJlc2hvbGQsCiAgICAgICAgICAgIG1heF9yZXF1ZXN0X2NvbmN1cnJlbmN5PW1heF9jb25jdXJyZW5jeSwKICAgICAgICAgICAgbXVsdGlwYXJ0X2NodW5rc2l6ZT1tdWx0aXBhcnRfY2h1bmtzaXplLAogICAgICAgICAgICBudW1fZG93bmxvYWRfYXR0ZW1wdHM9bnVtX2Rvd25sb2FkX2F0dGVtcHRzLAogICAgICAgICAgICBtYXhfaW9fcXVldWVfc2l6ZT1tYXhfaW9fcXVldWUsCiAgICAgICAgICAgIGlvX2NodW5rc2l6ZT1pb19jaHVua3NpemUsCiAgICAgICAgICAgIG1heF9iYW5kd2lkdGg9bWF4X2JhbmR3aWR0aCwKICAgICAgICApCiAgICAgICAgIyBTb21lIG9mIHRoZSBhcmd1bWVudCBuYW1lcyBhcmUgbm90IHRoZSBzYW1lIGFzIHRoZSBpbmhlcml0ZWQKICAgICAgICAjIFMzVHJhbnNmZXJDb25maWcgc28gd2UgYWRkIGFsaWFzZXMgc28geW91IGNhbiBzdGlsbCBhY2Nlc3MgdGhlCiAgICAgICAgIyBvbGQgdmVyc2lvbiBvZiB0aGUgbmFtZXMuCiAgICAgICAgZm9yIGFsaWFzIGluIHNlbGYuQUxJQVM6CiAgICAgICAgICAgIHNldGF0dHIoc2VsZiwgYWxpYXMsIGdldGF0dHIoc2VsZiwgc2VsZi5BTElBU1thbGlhc10pKQogICAgICAgIHNlbGYudXNlX3RocmVhZHMgPSB1c2VfdGhyZWFkcwoKICAgIGRlZiBfX3NldGF0dHJfXyhzZWxmLCBuYW1lLCB2YWx1ZSk6CiAgICAgICAgIyBJZiB0aGUgYWxpYXMgbmFtZSBpcyB1c2VkLCBtYWtlIHN1cmUgd2Ugc2V0IHRoZSBuYW1lIHRoYXQgaXQgcG9pbnRzCiAgICAgICAgIyB0byBhcyB0aGF0IGlzIHdoYXQgYWN0dWFsbHkgaXMgdXNlZCBpbiBnb3Zlcm5pbmcgdGhlIFRyYW5zZmVyTWFuYWdlci4KICAgICAgICBpZiBuYW1lIGluIHNlbGYuQUxJQVM6CiAgICAgICAgICAgIHN1cGVyKFRyYW5zZmVyQ29uZmlnLCBzZWxmKS5fX3NldGF0dHJfXyhzZWxmLkFMSUFTW25hbWVdLCB2YWx1ZSkKICAgICAgICAjIEFsd2F5cyBzZXQgdGhlIHZhbHVlIG9mIHRoZSBhY3R1YWwgbmFtZSBwcm92aWRlZC4KICAgICAgICBzdXBlcihUcmFuc2ZlckNvbmZpZywgc2VsZikuX19zZXRhdHRyX18obmFtZSwgdmFsdWUpCgoKY2xhc3MgUzNUcmFuc2ZlcihvYmplY3QpOgogICAgQUxMT1dFRF9ET1dOTE9BRF9BUkdTID0gVHJhbnNmZXJNYW5hZ2VyLkFMTE9XRURfRE9XTkxPQURfQVJHUwogICAgQUxMT1dFRF9VUExPQURfQVJHUyA9IFRyYW5zZmVyTWFuYWdlci5BTExPV0VEX1VQTE9BRF9BUkdTCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGNsaWVudD1Ob25lLCBjb25maWc9Tm9uZSwgb3N1dGlsPU5vbmUsIG1hbmFnZXI9Tm9uZSk6CiAgICAgICAgaWYgbm90IGNsaWVudCBhbmQgbm90IG1hbmFnZXI6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAnRWl0aGVyIGEgYm90bzMuQ2xpZW50IG9yIHMzdHJhbnNmZXIubWFuYWdlci5UcmFuc2Zlck1hbmFnZXIgJwogICAgICAgICAgICAgICAgJ211c3QgYmUgcHJvdmlkZWQnCiAgICAgICAgICAgICkKICAgICAgICBpZiBtYW5hZ2VyIGFuZCBhbnkoW2NsaWVudCwgY29uZmlnLCBvc3V0aWxdKToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgICdNYW5hZ2VyIGNhbm5vdCBiZSBwcm92aWRlZCB3aXRoIGNsaWVudCwgY29uZmlnLCAnCiAgICAgICAgICAgICAgICAnbm9yIG9zdXRpbC4gVGhlc2UgcGFyYW1ldGVycyBhcmUgbXV0dWFsbHkgZXhjbHVzaXZlLicKICAgICAgICAgICAgKQogICAgICAgIGlmIGNvbmZpZyBpcyBOb25lOgogICAgICAgICAgICBjb25maWcgPSBUcmFuc2ZlckNvbmZpZygpCiAgICAgICAgaWYgb3N1dGlsIGlzIE5vbmU6CiAgICAgICAgICAgIG9zdXRpbCA9IE9TVXRpbHMoKQogICAgICAgIGlmIG1hbmFnZXI6CiAgICAgICAgICAgIHNlbGYuX21hbmFnZXIgPSBtYW5hZ2VyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5fbWFuYWdlciA9IGNyZWF0ZV90cmFuc2Zlcl9tYW5hZ2VyKGNsaWVudCwgY29uZmlnLCBvc3V0aWwpCgogICAgZGVmIHVwbG9hZF9maWxlKHNlbGYsIGZpbGVuYW1lLCBidWNrZXQsIGtleSwKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaz1Ob25lLCBleHRyYV9hcmdzPU5vbmUpOgogICAgICAgICIiIlVwbG9hZCBhIGZpbGUgdG8gYW4gUzMgb2JqZWN0LgoKICAgICAgICBWYXJpYW50cyBoYXZlIGFsc28gYmVlbiBpbmplY3RlZCBpbnRvIFMzIGNsaWVudCwgQnVja2V0IGFuZCBPYmplY3QuCiAgICAgICAgWW91IGRvbid0IGhhdmUgdG8gdXNlIFMzVHJhbnNmZXIudXBsb2FkX2ZpbGUoKSBkaXJlY3RseS4KCiAgICAgICAgLi4gc2VlYWxzbzo6CiAgICAgICAgICAgIDpweTptZXRoOmBTMy5DbGllbnQudXBsb2FkX2ZpbGVgCiAgICAgICAgICAgIDpweTptZXRoOmBTMy5DbGllbnQudXBsb2FkX2ZpbGVvYmpgCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UoZmlsZW5hbWUsIHNpeC5zdHJpbmdfdHlwZXMpOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdGaWxlbmFtZSBtdXN0IGJlIGEgc3RyaW5nJykKCiAgICAgICAgc3Vic2NyaWJlcnMgPSBzZWxmLl9nZXRfc3Vic2NyaWJlcnMoY2FsbGJhY2spCiAgICAgICAgZnV0dXJlID0gc2VsZi5fbWFuYWdlci51cGxvYWQoCiAgICAgICAgICAgIGZpbGVuYW1lLCBidWNrZXQsIGtleSwgZXh0cmFfYXJncywgc3Vic2NyaWJlcnMpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmdXR1cmUucmVzdWx0KCkKICAgICAgICAjIElmIGEgY2xpZW50IGVycm9yIHdhcyByYWlzZWQsIGFkZCB0aGUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgbGF5ZXIKICAgICAgICAjIHRoYXQgcmFpc2VzIGEgUzNVcGxvYWRGYWlsZWRFcnJvci4gVGhlc2Ugc3BlY2lmaWMgZXJyb3JzIHdlcmUgb25seQogICAgICAgICMgZXZlciB0aHJvd24gZm9yIHVwbG9hZF9wYXJ0cyBidXQgbm93IGNhbiBiZSB0aHJvd24gZm9yIGFueSByZWxhdGVkCiAgICAgICAgIyBjbGllbnQgZXJyb3IuCiAgICAgICAgZXhjZXB0IENsaWVudEVycm9yIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIFMzVXBsb2FkRmFpbGVkRXJyb3IoCiAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIHVwbG9hZCAlcyB0byAlczogJXMiICUgKAogICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lLCAnLycuam9pbihbYnVja2V0LCBrZXldKSwgZSkpCgogICAgZGVmIGRvd25sb2FkX2ZpbGUoc2VsZiwgYnVja2V0LCBrZXksIGZpbGVuYW1lLCBleHRyYV9hcmdzPU5vbmUsCiAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaz1Ob25lKToKICAgICAgICAiIiJEb3dubG9hZCBhbiBTMyBvYmplY3QgdG8gYSBmaWxlLgoKICAgICAgICBWYXJpYW50cyBoYXZlIGFsc28gYmVlbiBpbmplY3RlZCBpbnRvIFMzIGNsaWVudCwgQnVja2V0IGFuZCBPYmplY3QuCiAgICAgICAgWW91IGRvbid0IGhhdmUgdG8gdXNlIFMzVHJhbnNmZXIuZG93bmxvYWRfZmlsZSgpIGRpcmVjdGx5LgoKICAgICAgICAuLiBzZWVhbHNvOjoKICAgICAgICAgICAgOnB5Om1ldGg6YFMzLkNsaWVudC5kb3dubG9hZF9maWxlYAogICAgICAgICAgICA6cHk6bWV0aDpgUzMuQ2xpZW50LmRvd25sb2FkX2ZpbGVvYmpgCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UoZmlsZW5hbWUsIHNpeC5zdHJpbmdfdHlwZXMpOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdGaWxlbmFtZSBtdXN0IGJlIGEgc3RyaW5nJykKCiAgICAgICAgc3Vic2NyaWJlcnMgPSBzZWxmLl9nZXRfc3Vic2NyaWJlcnMoY2FsbGJhY2spCiAgICAgICAgZnV0dXJlID0gc2VsZi5fbWFuYWdlci5kb3dubG9hZCgKICAgICAgICAgICAgYnVja2V0LCBrZXksIGZpbGVuYW1lLCBleHRyYV9hcmdzLCBzdWJzY3JpYmVycykKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICMgVGhpcyBpcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2hlcmUgd2hlbiByZXRyaWVzIGFyZQogICAgICAgICMgZXhjZWVkZWQgd2UgbmVlZCB0byB0aHJvdyB0aGUgc2FtZSBlcnJvciBmcm9tIGJvdG8zIGluc3RlYWQgb2YKICAgICAgICAjIHMzdHJhbnNmZXIncyBidWlsdCBpbiBSZXRyaWVzRXhjZWVkZWRFcnJvciBhcyBjdXJyZW50IHVzZXJzIGFyZQogICAgICAgICMgY2F0Y2hpbmcgdGhlIGJvdG8zIG9uZSBpbnN0ZWFkIG9mIHRoZSBzM3RyYW5zZmVyIGV4Y2VwdGlvbiB0byBkbwogICAgICAgICMgdGhlaXIgb3duIHJldHJpZXMuCiAgICAgICAgZXhjZXB0IFMzVHJhbnNmZXJSZXRyaWVzRXhjZWVkZWRFcnJvciBhcyBlOgogICAgICAgICAgICByYWlzZSBSZXRyaWVzRXhjZWVkZWRFcnJvcihlLmxhc3RfZXhjZXB0aW9uKQoKICAgIGRlZiBfZ2V0X3N1YnNjcmliZXJzKHNlbGYsIGNhbGxiYWNrKToKICAgICAgICBpZiBub3QgY2FsbGJhY2s6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgcmV0dXJuIFtQcm9ncmVzc0NhbGxiYWNrSW52b2tlcihjYWxsYmFjayldCgogICAgZGVmIF9fZW50ZXJfXyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZgoKICAgIGRlZiBfX2V4aXRfXyhzZWxmLCAqYXJncyk6CiAgICAgICAgc2VsZi5fbWFuYWdlci5fX2V4aXRfXygqYXJncykKCgpjbGFzcyBQcm9ncmVzc0NhbGxiYWNrSW52b2tlcihCYXNlU3Vic2NyaWJlcik6CiAgICAiIiJBIGJhY2stY29tcGF0IHdyYXBwZXIgdG8gaW52b2tlIGEgcHJvdmlkZWQgY2FsbGJhY2sgdmlhIGEgc3Vic2NyaWJlcgoKICAgIDpwYXJhbSBjYWxsYmFjazogQSBjYWxsYWJsZSB0aGF0IHRha2VzIGEgc2luZ2xlIHBvc2l0aW9uYWwgYXJndW1lbnQgZm9yCiAgICAgICAgaG93IG1hbnkgYnl0ZXMgd2VyZSB0cmFuc2ZlcnJlZC4KICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGNhbGxiYWNrKToKICAgICAgICBzZWxmLl9jYWxsYmFjayA9IGNhbGxiYWNrCgogICAgZGVmIG9uX3Byb2dyZXNzKHNlbGYsIGJ5dGVzX3RyYW5zZmVycmVkLCAqKmt3YXJncyk6CiAgICAgICAgc2VsZi5fY2FsbGJhY2soYnl0ZXNfdHJhbnNmZXJyZWQpCg==
