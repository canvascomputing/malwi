statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/message.py
  contents:
  - name: PartialMessage.__init__
    score: 0.0
    code: |-
      def __init__(self, *, channel, id):
              if channel.type not in (ChannelType.text, ChannelType.news, ChannelType.private):
                  raise TypeError('Expected TextChannel or DMChannel not %r' % type(channel))

              self.channel = channel
              self._state = channel._state
              self.id = id
    tokens: resume load_fast channel load_attr type load_global ChannelType load_attr text load_global ChannelType load_attr news load_global ChannelType load_attr private build_tuple contains_op pop_jump_if_false TO_NUMBER load_global TypeError load_const STRING_LEN_S_ENT_HIGH load_global type load_fast channel call binary_op % call raise_varargs load_fast channel load_fast self store_attr channel load_fast channel load_attr _state load_fast self store_attr _state load_fast id load_fast self store_attr id return_const None
    hash: d801147607b53334a53984d3924fd07d83fc1e8241d09c32f6b679a9584ed0d9
sources:
  .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/message.py: IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KCiIiIgpUaGUgTUlUIExpY2Vuc2UgKE1JVCkKCkNvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50IFJhcHB0egoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgp0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlClNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCk9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwpGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSCkRFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KIiIiCgppbXBvcnQgYXN5bmNpbwppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHJlCmltcG9ydCBpbwoKZnJvbSAuIGltcG9ydCB1dGlscwpmcm9tIC5yZWFjdGlvbiBpbXBvcnQgUmVhY3Rpb24KZnJvbSAuZW1vamkgaW1wb3J0IEVtb2ppCmZyb20gLnBhcnRpYWxfZW1vamkgaW1wb3J0IFBhcnRpYWxFbW9qaQpmcm9tIC5jYWxscyBpbXBvcnQgQ2FsbE1lc3NhZ2UKZnJvbSAuZW51bXMgaW1wb3J0IE1lc3NhZ2VUeXBlLCBDaGFubmVsVHlwZSwgdHJ5X2VudW0KZnJvbSAuZXJyb3JzIGltcG9ydCBJbnZhbGlkQXJndW1lbnQsIENsaWVudEV4Y2VwdGlvbiwgSFRUUEV4Y2VwdGlvbgpmcm9tIC5lbWJlZHMgaW1wb3J0IEVtYmVkCmZyb20gLm1lbWJlciBpbXBvcnQgTWVtYmVyCmZyb20gLmZsYWdzIGltcG9ydCBNZXNzYWdlRmxhZ3MKZnJvbSAuZmlsZSBpbXBvcnQgRmlsZQpmcm9tIC51dGlscyBpbXBvcnQgZXNjYXBlX21lbnRpb25zCmZyb20gLmd1aWxkIGltcG9ydCBHdWlsZApmcm9tIC5taXhpbnMgaW1wb3J0IEhhc2hhYmxlCmZyb20gLnN0aWNrZXIgaW1wb3J0IFN0aWNrZXIKCl9fYWxsX18gPSAoCiAgICAnQXR0YWNobWVudCcsCiAgICAnTWVzc2FnZScsCiAgICAnUGFydGlhbE1lc3NhZ2UnLAogICAgJ01lc3NhZ2VSZWZlcmVuY2UnLAogICAgJ0RlbGV0ZWRSZWZlcmVuY2VkTWVzc2FnZScsCikKCmRlZiBjb252ZXJ0X2Vtb2ppX3JlYWN0aW9uKGVtb2ppKToKICAgIGlmIGlzaW5zdGFuY2UoZW1vamksIFJlYWN0aW9uKToKICAgICAgICBlbW9qaSA9IGVtb2ppLmVtb2ppCgogICAgaWYgaXNpbnN0YW5jZShlbW9qaSwgRW1vamkpOgogICAgICAgIHJldHVybiAnJXM6JXMnICUgKGVtb2ppLm5hbWUsIGVtb2ppLmlkKQogICAgaWYgaXNpbnN0YW5jZShlbW9qaSwgUGFydGlhbEVtb2ppKToKICAgICAgICByZXR1cm4gZW1vamkuX2FzX3JlYWN0aW9uKCkKICAgIGlmIGlzaW5zdGFuY2UoZW1vamksIHN0cik6CiAgICAgICAgIyBSZWFjdGlvbnMgY2FuIGJlIGluIDpuYW1lOmlkIGZvcm1hdCwgYnV0IG5vdCA8Om5hbWU6aWQ+LgogICAgICAgICMgTm8gZXhpc3RpbmcgZW1vamlzIGhhdmUgPD4gaW4gdGhlbSwgc28gdGhpcyBzaG91bGQgYmUgb2theS4KICAgICAgICByZXR1cm4gZW1vamkuc3RyaXAoJzw+JykKCiAgICByYWlzZSBJbnZhbGlkQXJndW1lbnQoJ2Vtb2ppIGFyZ3VtZW50IG11c3QgYmUgc3RyLCBFbW9qaSwgb3IgUmVhY3Rpb24gbm90IHsuX19jbGFzc19fLl9fbmFtZV9ffS4nLmZvcm1hdChlbW9qaSkpCgpjbGFzcyBBdHRhY2htZW50KEhhc2hhYmxlKToKICAgICIiIlJlcHJlc2VudHMgYW4gYXR0YWNobWVudCBmcm9tIERpc2NvcmQuCgogICAgLi4gY29udGFpbmVyOjogb3BlcmF0aW9ucwoKICAgICAgICAuLiBkZXNjcmliZTo6IHN0cih4KQoKICAgICAgICAgICAgUmV0dXJucyB0aGUgVVJMIG9mIHRoZSBhdHRhY2htZW50LgoKICAgICAgICAuLiBkZXNjcmliZTo6IHggPT0geQoKICAgICAgICAgICAgQ2hlY2tzIGlmIHRoZSBhdHRhY2htZW50IGlzIGVxdWFsIHRvIGFub3RoZXIgYXR0YWNobWVudC4KCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4ICE9IHkKCiAgICAgICAgICAgIENoZWNrcyBpZiB0aGUgYXR0YWNobWVudCBpcyBub3QgZXF1YWwgdG8gYW5vdGhlciBhdHRhY2htZW50LgoKICAgICAgICAuLiBkZXNjcmliZTo6IGhhc2goeCkKCiAgICAgICAgICAgIFJldHVybnMgdGhlIGhhc2ggb2YgdGhlIGF0dGFjaG1lbnQuCgogICAgLi4gdmVyc2lvbmNoYW5nZWQ6OiAxLjcKICAgICAgICBBdHRhY2htZW50IGNhbiBub3cgYmUgY2FzdGVkIHRvIDpjbGFzczpgc3RyYCBhbmQgaXMgaGFzaGFibGUuCgogICAgQXR0cmlidXRlcwogICAgLS0tLS0tLS0tLS0tCiAgICBpZDogOmNsYXNzOmBpbnRgCiAgICAgICAgVGhlIGF0dGFjaG1lbnQgSUQuCiAgICBzaXplOiA6Y2xhc3M6YGludGAKICAgICAgICBUaGUgYXR0YWNobWVudCBzaXplIGluIGJ5dGVzLgogICAgaGVpZ2h0OiBPcHRpb25hbFs6Y2xhc3M6YGludGBdCiAgICAgICAgVGhlIGF0dGFjaG1lbnQncyBoZWlnaHQsIGluIHBpeGVscy4gT25seSBhcHBsaWNhYmxlIHRvIGltYWdlcyBhbmQgdmlkZW9zLgogICAgd2lkdGg6IE9wdGlvbmFsWzpjbGFzczpgaW50YF0KICAgICAgICBUaGUgYXR0YWNobWVudCdzIHdpZHRoLCBpbiBwaXhlbHMuIE9ubHkgYXBwbGljYWJsZSB0byBpbWFnZXMgYW5kIHZpZGVvcy4KICAgIGZpbGVuYW1lOiA6Y2xhc3M6YHN0cmAKICAgICAgICBUaGUgYXR0YWNobWVudCdzIGZpbGVuYW1lLgogICAgdXJsOiA6Y2xhc3M6YHN0cmAKICAgICAgICBUaGUgYXR0YWNobWVudCBVUkwuIElmIHRoZSBtZXNzYWdlIHRoaXMgYXR0YWNobWVudCB3YXMgYXR0YWNoZWQKICAgICAgICB0byBpcyBkZWxldGVkLCB0aGVuIHRoaXMgd2lsbCA0MDQuCiAgICBwcm94eV91cmw6IDpjbGFzczpgc3RyYAogICAgICAgIFRoZSBwcm94eSBVUkwuIFRoaXMgaXMgYSBjYWNoZWQgdmVyc2lvbiBvZiB0aGUgOmF0dHI6YH5BdHRhY2htZW50LnVybGAgaW4gdGhlCiAgICAgICAgY2FzZSBvZiBpbWFnZXMuIFdoZW4gdGhlIG1lc3NhZ2UgaXMgZGVsZXRlZCwgdGhpcyBVUkwgbWlnaHQgYmUgdmFsaWQgZm9yIGEgZmV3CiAgICAgICAgbWludXRlcyBvciBub3QgdmFsaWQgYXQgYWxsLgogICAgY29udGVudF90eXBlOiBPcHRpb25hbFs6Y2xhc3M6YHN0cmBdCiAgICAgICAgVGhlIGF0dGFjaG1lbnQncyBgbWVkaWEgdHlwZSA8aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTWVkaWFfdHlwZT5gXwoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjcKICAgICIiIgoKICAgIF9fc2xvdHNfXyA9ICgnaWQnLCAnc2l6ZScsICdoZWlnaHQnLCAnd2lkdGgnLCAnZmlsZW5hbWUnLCAndXJsJywgJ3Byb3h5X3VybCcsICdfaHR0cCcsICdjb250ZW50X3R5cGUnKQoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqLCBkYXRhLCBzdGF0ZSk6CiAgICAgICAgc2VsZi5pZCA9IGludChkYXRhWydpZCddKQogICAgICAgIHNlbGYuc2l6ZSA9IGRhdGFbJ3NpemUnXQogICAgICAgIHNlbGYuaGVpZ2h0ID0gZGF0YS5nZXQoJ2hlaWdodCcpCiAgICAgICAgc2VsZi53aWR0aCA9IGRhdGEuZ2V0KCd3aWR0aCcpCiAgICAgICAgc2VsZi5maWxlbmFtZSA9IGRhdGFbJ2ZpbGVuYW1lJ10KICAgICAgICBzZWxmLnVybCA9IGRhdGEuZ2V0KCd1cmwnKQogICAgICAgIHNlbGYucHJveHlfdXJsID0gZGF0YS5nZXQoJ3Byb3h5X3VybCcpCiAgICAgICAgc2VsZi5faHR0cCA9IHN0YXRlLmh0dHAKICAgICAgICBzZWxmLmNvbnRlbnRfdHlwZSA9IGRhdGEuZ2V0KCdjb250ZW50X3R5cGUnKQoKICAgIGRlZiBpc19zcG9pbGVyKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IFdoZXRoZXIgdGhpcyBhdHRhY2htZW50IGNvbnRhaW5zIGEgc3BvaWxlci4iIiIKICAgICAgICByZXR1cm4gc2VsZi5maWxlbmFtZS5zdGFydHN3aXRoKCdTUE9JTEVSXycpCgogICAgZGVmIF9fcmVwcl9fKHNlbGYpOgogICAgICAgIHJldHVybiAnPEF0dGFjaG1lbnQgaWQ9ezAuaWR9IGZpbGVuYW1lPXswLmZpbGVuYW1lIXJ9IHVybD17MC51cmwhcn0+Jy5mb3JtYXQoc2VsZikKCiAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi51cmwgb3IgJycKCiAgICBhc3luYyBkZWYgc2F2ZShzZWxmLCBmcCwgKiwgc2Vla19iZWdpbj1UcnVlLCB1c2VfY2FjaGVkPUZhbHNlKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgU2F2ZXMgdGhpcyBhdHRhY2htZW50IGludG8gYSBmaWxlLWxpa2Ugb2JqZWN0LgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICBmcDogVW5pb25bOmNsYXNzOmBpby5CdWZmZXJlZElPQmFzZWAsIDpjbGFzczpgb3MuUGF0aExpa2VgXQogICAgICAgICAgICBUaGUgZmlsZS1saWtlIG9iamVjdCB0byBzYXZlIHRoaXMgYXR0YWNobWVudCB0byBvciB0aGUgZmlsZW5hbWUKICAgICAgICAgICAgdG8gdXNlLiBJZiBhIGZpbGVuYW1lIGlzIHBhc3NlZCB0aGVuIGEgZmlsZSBpcyBjcmVhdGVkIHdpdGggdGhhdAogICAgICAgICAgICBmaWxlbmFtZSBhbmQgdXNlZCBpbnN0ZWFkLgogICAgICAgIHNlZWtfYmVnaW46IDpjbGFzczpgYm9vbGAKICAgICAgICAgICAgV2hldGhlciB0byBzZWVrIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGZpbGUgYWZ0ZXIgc2F2aW5nIGlzCiAgICAgICAgICAgIHN1Y2Nlc3NmdWxseSBkb25lLgogICAgICAgIHVzZV9jYWNoZWQ6IDpjbGFzczpgYm9vbGAKICAgICAgICAgICAgV2hldGhlciB0byB1c2UgOmF0dHI6YHByb3h5X3VybGAgcmF0aGVyIHRoYW4gOmF0dHI6YHVybGAgd2hlbiBkb3dubG9hZGluZwogICAgICAgICAgICB0aGUgYXR0YWNobWVudC4gVGhpcyB3aWxsIGFsbG93IGF0dGFjaG1lbnRzIHRvIGJlIHNhdmVkIGFmdGVyIGRlbGV0aW9uCiAgICAgICAgICAgIG1vcmUgb2Z0ZW4sIGNvbXBhcmVkIHRvIHRoZSByZWd1bGFyIFVSTCB3aGljaCBpcyBnZW5lcmFsbHkgZGVsZXRlZCByaWdodAogICAgICAgICAgICBhZnRlciB0aGUgbWVzc2FnZSBpcyBkZWxldGVkLiBOb3RlIHRoYXQgdGhpcyBjYW4gc3RpbGwgZmFpbCB0byBkb3dubG9hZAogICAgICAgICAgICBkZWxldGVkIGF0dGFjaG1lbnRzIGlmIHRvbyBtdWNoIHRpbWUgaGFzIHBhc3NlZCBhbmQgaXQgZG9lcyBub3Qgd29yawogICAgICAgICAgICBvbiBzb21lIHR5cGVzIG9mIGF0dGFjaG1lbnRzLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tLQogICAgICAgIEhUVFBFeGNlcHRpb24KICAgICAgICAgICAgU2F2aW5nIHRoZSBhdHRhY2htZW50IGZhaWxlZC4KICAgICAgICBOb3RGb3VuZAogICAgICAgICAgICBUaGUgYXR0YWNobWVudCB3YXMgZGVsZXRlZC4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgOmNsYXNzOmBpbnRgCiAgICAgICAgICAgIFRoZSBudW1iZXIgb2YgYnl0ZXMgd3JpdHRlbi4KICAgICAgICAiIiIKICAgICAgICBkYXRhID0gYXdhaXQgc2VsZi5yZWFkKHVzZV9jYWNoZWQ9dXNlX2NhY2hlZCkKICAgICAgICBpZiBpc2luc3RhbmNlKGZwLCBpby5JT0Jhc2UpIGFuZCBmcC53cml0YWJsZSgpOgogICAgICAgICAgICB3cml0dGVuID0gZnAud3JpdGUoZGF0YSkKICAgICAgICAgICAgaWYgc2Vla19iZWdpbjoKICAgICAgICAgICAgICAgIGZwLnNlZWsoMCkKICAgICAgICAgICAgcmV0dXJuIHdyaXR0ZW4KICAgICAgICBlbHNlOgogICAgICAgICAgICB3aXRoIG9wZW4oZnAsICd3YicpIGFzIGY6CiAgICAgICAgICAgICAgICByZXR1cm4gZi53cml0ZShkYXRhKQoKICAgIGFzeW5jIGRlZiByZWFkKHNlbGYsICosIHVzZV9jYWNoZWQ9RmFsc2UpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBSZXRyaWV2ZXMgdGhlIGNvbnRlbnQgb2YgdGhpcyBhdHRhY2htZW50IGFzIGEgOmNsYXNzOmBieXRlc2Agb2JqZWN0LgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjEKCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgdXNlX2NhY2hlZDogOmNsYXNzOmBib29sYAogICAgICAgICAgICBXaGV0aGVyIHRvIHVzZSA6YXR0cjpgcHJveHlfdXJsYCByYXRoZXIgdGhhbiA6YXR0cjpgdXJsYCB3aGVuIGRvd25sb2FkaW5nCiAgICAgICAgICAgIHRoZSBhdHRhY2htZW50LiBUaGlzIHdpbGwgYWxsb3cgYXR0YWNobWVudHMgdG8gYmUgc2F2ZWQgYWZ0ZXIgZGVsZXRpb24KICAgICAgICAgICAgbW9yZSBvZnRlbiwgY29tcGFyZWQgdG8gdGhlIHJlZ3VsYXIgVVJMIHdoaWNoIGlzIGdlbmVyYWxseSBkZWxldGVkIHJpZ2h0CiAgICAgICAgICAgIGFmdGVyIHRoZSBtZXNzYWdlIGlzIGRlbGV0ZWQuIE5vdGUgdGhhdCB0aGlzIGNhbiBzdGlsbCBmYWlsIHRvIGRvd25sb2FkCiAgICAgICAgICAgIGRlbGV0ZWQgYXR0YWNobWVudHMgaWYgdG9vIG11Y2ggdGltZSBoYXMgcGFzc2VkIGFuZCBpdCBkb2VzIG5vdCB3b3JrCiAgICAgICAgICAgIG9uIHNvbWUgdHlwZXMgb2YgYXR0YWNobWVudHMuCgogICAgICAgIFJhaXNlcwogICAgICAgIC0tLS0tLQogICAgICAgIEhUVFBFeGNlcHRpb24KICAgICAgICAgICAgRG93bmxvYWRpbmcgdGhlIGF0dGFjaG1lbnQgZmFpbGVkLgogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbnMgdG8gYWNjZXNzIHRoaXMgYXR0YWNobWVudAogICAgICAgIE5vdEZvdW5kCiAgICAgICAgICAgIFRoZSBhdHRhY2htZW50IHdhcyBkZWxldGVkLgoKICAgICAgICBSZXR1cm5zCiAgICAgICAgLS0tLS0tLQogICAgICAgIDpjbGFzczpgYnl0ZXNgCiAgICAgICAgICAgIFRoZSBjb250ZW50cyBvZiB0aGUgYXR0YWNobWVudC4KICAgICAgICAiIiIKICAgICAgICB1cmwgPSBzZWxmLnByb3h5X3VybCBpZiB1c2VfY2FjaGVkIGVsc2Ugc2VsZi51cmwKICAgICAgICBkYXRhID0gYXdhaXQgc2VsZi5faHR0cC5nZXRfZnJvbV9jZG4odXJsKQogICAgICAgIHJldHVybiBkYXRhCgogICAgYXN5bmMgZGVmIHRvX2ZpbGUoc2VsZiwgKiwgdXNlX2NhY2hlZD1GYWxzZSwgc3BvaWxlcj1GYWxzZSk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIENvbnZlcnRzIHRoZSBhdHRhY2htZW50IGludG8gYSA6Y2xhc3M6YEZpbGVgIHN1aXRhYmxlIGZvciBzZW5kaW5nIHZpYQogICAgICAgIDptZXRoOmBhYmMuTWVzc2FnZWFibGUuc2VuZGAuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuMwoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICB1c2VfY2FjaGVkOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgdG8gdXNlIDphdHRyOmBwcm94eV91cmxgIHJhdGhlciB0aGFuIDphdHRyOmB1cmxgIHdoZW4gZG93bmxvYWRpbmcKICAgICAgICAgICAgdGhlIGF0dGFjaG1lbnQuIFRoaXMgd2lsbCBhbGxvdyBhdHRhY2htZW50cyB0byBiZSBzYXZlZCBhZnRlciBkZWxldGlvbgogICAgICAgICAgICBtb3JlIG9mdGVuLCBjb21wYXJlZCB0byB0aGUgcmVndWxhciBVUkwgd2hpY2ggaXMgZ2VuZXJhbGx5IGRlbGV0ZWQgcmlnaHQKICAgICAgICAgICAgYWZ0ZXIgdGhlIG1lc3NhZ2UgaXMgZGVsZXRlZC4gTm90ZSB0aGF0IHRoaXMgY2FuIHN0aWxsIGZhaWwgdG8gZG93bmxvYWQKICAgICAgICAgICAgZGVsZXRlZCBhdHRhY2htZW50cyBpZiB0b28gbXVjaCB0aW1lIGhhcyBwYXNzZWQgYW5kIGl0IGRvZXMgbm90IHdvcmsKICAgICAgICAgICAgb24gc29tZSB0eXBlcyBvZiBhdHRhY2htZW50cy4KCiAgICAgICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNAogICAgICAgIHNwb2lsZXI6IDpjbGFzczpgYm9vbGAKICAgICAgICAgICAgV2hldGhlciB0aGUgZmlsZSBpcyBhIHNwb2lsZXIuCgogICAgICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjQKCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tCiAgICAgICAgSFRUUEV4Y2VwdGlvbgogICAgICAgICAgICBEb3dubG9hZGluZyB0aGUgYXR0YWNobWVudCBmYWlsZWQuCiAgICAgICAgRm9yYmlkZGVuCiAgICAgICAgICAgIFlvdSBkbyBub3QgaGF2ZSBwZXJtaXNzaW9ucyB0byBhY2Nlc3MgdGhpcyBhdHRhY2htZW50CiAgICAgICAgTm90Rm91bmQKICAgICAgICAgICAgVGhlIGF0dGFjaG1lbnQgd2FzIGRlbGV0ZWQuCgogICAgICAgIFJldHVybnMKICAgICAgICAtLS0tLS0tCiAgICAgICAgOmNsYXNzOmBGaWxlYAogICAgICAgICAgICBUaGUgYXR0YWNobWVudCBhcyBhIGZpbGUgc3VpdGFibGUgZm9yIHNlbmRpbmcuCiAgICAgICAgIiIiCgogICAgICAgIGRhdGEgPSBhd2FpdCBzZWxmLnJlYWQodXNlX2NhY2hlZD11c2VfY2FjaGVkKQogICAgICAgIHJldHVybiBGaWxlKGlvLkJ5dGVzSU8oZGF0YSksIGZpbGVuYW1lPXNlbGYuZmlsZW5hbWUsIHNwb2lsZXI9c3BvaWxlcikKCmNsYXNzIERlbGV0ZWRSZWZlcmVuY2VkTWVzc2FnZToKICAgICIiIkEgc3BlY2lhbCBzZW50aW5lbCB0eXBlIHRoYXQgZGVub3RlcyB3aGV0aGVyIHRoZQogICAgcmVzb2x2ZWQgbWVzc2FnZSByZWZlcmVuY2VkIG1lc3NhZ2UgaGFkIHNpbmNlIGJlZW4gZGVsZXRlZC4KCiAgICBUaGUgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGlzIHRvIHNlcGFyYXRlIHJlZmVyZW5jZWQgbWVzc2FnZXMgdGhhdCBjb3VsZCBub3QgYmUKICAgIGZldGNoZWQgYW5kIHRob3NlIHRoYXQgd2VyZSBwcmV2aW91c2x5IGZldGNoZWQgYnV0IGhhdmUgc2luY2UgYmVlbiBkZWxldGVkLgoKICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNgogICAgIiIiCgogICAgX19zbG90c19fID0gKCdfcGFyZW50JykKCiAgICBkZWYgX19pbml0X18oc2VsZiwgcGFyZW50KToKICAgICAgICBzZWxmLl9wYXJlbnQgPSBwYXJlbnQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBpZChzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGludGA6IFRoZSBtZXNzYWdlIElEIG9mIHRoZSBkZWxldGVkIHJlZmVyZW5jZWQgbWVzc2FnZS4iIiIKICAgICAgICByZXR1cm4gc2VsZi5fcGFyZW50Lm1lc3NhZ2VfaWQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBjaGFubmVsX2lkKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgaW50YDogVGhlIGNoYW5uZWwgSUQgb2YgdGhlIGRlbGV0ZWQgcmVmZXJlbmNlZCBtZXNzYWdlLiIiIgogICAgICAgIHJldHVybiBzZWxmLl9wYXJlbnQuY2hhbm5lbF9pZAoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGd1aWxkX2lkKHNlbGYpOgogICAgICAgICIiIk9wdGlvbmFsWzpjbGFzczpgaW50YF06IFRoZSBndWlsZCBJRCBvZiB0aGUgZGVsZXRlZCByZWZlcmVuY2VkIG1lc3NhZ2UuIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX3BhcmVudC5ndWlsZF9pZAoKCmNsYXNzIE1lc3NhZ2VSZWZlcmVuY2U6CiAgICAiIiJSZXByZXNlbnRzIGEgcmVmZXJlbmNlIHRvIGEgOmNsYXNzOmB+ZGlzY29yZC5NZXNzYWdlYC4KCiAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjUKCiAgICAuLiB2ZXJzaW9uY2hhbmdlZDo6IDEuNgogICAgICAgIFRoaXMgY2xhc3MgY2FuIG5vdyBiZSBjb25zdHJ1Y3RlZCBieSB1c2Vycy4KCiAgICBBdHRyaWJ1dGVzCiAgICAtLS0tLS0tLS0tLQogICAgbWVzc2FnZV9pZDogT3B0aW9uYWxbOmNsYXNzOmBpbnRgXQogICAgICAgIFRoZSBpZCBvZiB0aGUgbWVzc2FnZSByZWZlcmVuY2VkLgogICAgY2hhbm5lbF9pZDogOmNsYXNzOmBpbnRgCiAgICAgICAgVGhlIGNoYW5uZWwgaWQgb2YgdGhlIG1lc3NhZ2UgcmVmZXJlbmNlZC4KICAgIGd1aWxkX2lkOiBPcHRpb25hbFs6Y2xhc3M6YGludGBdCiAgICAgICAgVGhlIGd1aWxkIGlkIG9mIHRoZSBtZXNzYWdlIHJlZmVyZW5jZWQuCiAgICBmYWlsX2lmX25vdF9leGlzdHM6IDpjbGFzczpgYm9vbGAKICAgICAgICBXaGV0aGVyIHJlcGx5aW5nIHRvIHRoZSByZWZlcmVuY2VkIG1lc3NhZ2Ugc2hvdWxkIHJhaXNlIDpjbGFzczpgSFRUUEV4Y2VwdGlvbmAKICAgICAgICBpZiB0aGUgbWVzc2FnZSBubyBsb25nZXIgZXhpc3RzIG9yIERpc2NvcmQgY291bGQgbm90IGZldGNoIHRoZSBtZXNzYWdlLgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjcKCiAgICByZXNvbHZlZDogT3B0aW9uYWxbVW5pb25bOmNsYXNzOmBNZXNzYWdlYCwgOmNsYXNzOmBEZWxldGVkUmVmZXJlbmNlZE1lc3NhZ2VgXV0KICAgICAgICBUaGUgbWVzc2FnZSB0aGF0IHRoaXMgcmVmZXJlbmNlIHJlc29sdmVkIHRvLiBJZiB0aGlzIGlzIGBgTm9uZWBgCiAgICAgICAgdGhlbiB0aGUgb3JpZ2luYWwgbWVzc2FnZSB3YXMgbm90IGZldGNoZWQgZWl0aGVyIGR1ZSB0byB0aGUgRGlzY29yZCBBUEkKICAgICAgICBub3QgYXR0ZW1wdGluZyB0byByZXNvbHZlIGl0IG9yIGl0IG5vdCBiZWluZyBhdmFpbGFibGUgYXQgdGhlIHRpbWUgb2YgY3JlYXRpb24uCiAgICAgICAgSWYgdGhlIG1lc3NhZ2Ugd2FzIHJlc29sdmVkIGF0IGEgcHJpb3IgcG9pbnQgYnV0IGhhcyBzaW5jZSBiZWVuIGRlbGV0ZWQgdGhlbgogICAgICAgIHRoaXMgd2lsbCBiZSBvZiB0eXBlIDpjbGFzczpgRGVsZXRlZFJlZmVyZW5jZWRNZXNzYWdlYC4KCiAgICAgICAgQ3VycmVudGx5LCB0aGlzIGlzIG1haW5seSB0aGUgcmVwbGllZCB0byBtZXNzYWdlIHdoZW4gYSB1c2VyIHJlcGxpZXMgdG8gYSBtZXNzYWdlLgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjYKICAgICIiIgoKICAgIF9fc2xvdHNfXyA9ICgnbWVzc2FnZV9pZCcsICdjaGFubmVsX2lkJywgJ2d1aWxkX2lkJywgJ2ZhaWxfaWZfbm90X2V4aXN0cycsICdyZXNvbHZlZCcsICdfc3RhdGUnKQoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqLCBtZXNzYWdlX2lkLCBjaGFubmVsX2lkLCBndWlsZF9pZD1Ob25lLCBmYWlsX2lmX25vdF9leGlzdHM9VHJ1ZSk6CiAgICAgICAgc2VsZi5fc3RhdGUgPSBOb25lCiAgICAgICAgc2VsZi5yZXNvbHZlZCA9IE5vbmUKICAgICAgICBzZWxmLm1lc3NhZ2VfaWQgPSBtZXNzYWdlX2lkCiAgICAgICAgc2VsZi5jaGFubmVsX2lkID0gY2hhbm5lbF9pZAogICAgICAgIHNlbGYuZ3VpbGRfaWQgPSBndWlsZF9pZAogICAgICAgIHNlbGYuZmFpbF9pZl9ub3RfZXhpc3RzID0gZmFpbF9pZl9ub3RfZXhpc3RzCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgd2l0aF9zdGF0ZShjbHMsIHN0YXRlLCBkYXRhKToKICAgICAgICBzZWxmID0gY2xzLl9fbmV3X18oY2xzKQogICAgICAgIHNlbGYubWVzc2FnZV9pZCA9IHV0aWxzLl9nZXRfYXNfc25vd2ZsYWtlKGRhdGEsICdtZXNzYWdlX2lkJykKICAgICAgICBzZWxmLmNoYW5uZWxfaWQgPSBpbnQoZGF0YS5wb3AoJ2NoYW5uZWxfaWQnKSkKICAgICAgICBzZWxmLmd1aWxkX2lkID0gdXRpbHMuX2dldF9hc19zbm93Zmxha2UoZGF0YSwgJ2d1aWxkX2lkJykKICAgICAgICBzZWxmLmZhaWxfaWZfbm90X2V4aXN0cyA9IGRhdGEuZ2V0KCdmYWlsX2lmX25vdF9leGlzdHMnLCBUcnVlKQogICAgICAgIHNlbGYuX3N0YXRlID0gc3RhdGUKICAgICAgICBzZWxmLnJlc29sdmVkID0gTm9uZQogICAgICAgIHJldHVybiBzZWxmCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgZnJvbV9tZXNzYWdlKGNscywgbWVzc2FnZSwgKiwgZmFpbF9pZl9ub3RfZXhpc3RzPVRydWUpOgogICAgICAgICIiIkNyZWF0ZXMgYSA6Y2xhc3M6YE1lc3NhZ2VSZWZlcmVuY2VgIGZyb20gYW4gZXhpc3RpbmcgOmNsYXNzOmB+ZGlzY29yZC5NZXNzYWdlYC4KCiAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS42CgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tCiAgICAgICAgbWVzc2FnZTogOmNsYXNzOmB+ZGlzY29yZC5NZXNzYWdlYAogICAgICAgICAgICBUaGUgbWVzc2FnZSB0byBiZSBjb252ZXJ0ZWQgaW50byBhIHJlZmVyZW5jZS4KICAgICAgICBmYWlsX2lmX25vdF9leGlzdHM6IDpjbGFzczpgYm9vbGAKICAgICAgICAgICAgV2hldGhlciByZXBseWluZyB0byB0aGUgcmVmZXJlbmNlZCBtZXNzYWdlIHNob3VsZCByYWlzZSA6Y2xhc3M6YEhUVFBFeGNlcHRpb25gCiAgICAgICAgICAgIGlmIHRoZSBtZXNzYWdlIG5vIGxvbmdlciBleGlzdHMgb3IgRGlzY29yZCBjb3VsZCBub3QgZmV0Y2ggdGhlIG1lc3NhZ2UuCgogICAgICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjcKCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0KICAgICAgICA6Y2xhc3M6YE1lc3NhZ2VSZWZlcmVuY2VgCiAgICAgICAgICAgIEEgcmVmZXJlbmNlIHRvIHRoZSBtZXNzYWdlLgogICAgICAgICIiIgogICAgICAgIHNlbGYgPSBjbHMobWVzc2FnZV9pZD1tZXNzYWdlLmlkLCBjaGFubmVsX2lkPW1lc3NhZ2UuY2hhbm5lbC5pZCwgZ3VpbGRfaWQ9Z2V0YXR0cihtZXNzYWdlLmd1aWxkLCAnaWQnLCBOb25lKSwgZmFpbF9pZl9ub3RfZXhpc3RzPWZhaWxfaWZfbm90X2V4aXN0cykKICAgICAgICBzZWxmLl9zdGF0ZSA9IG1lc3NhZ2UuX3N0YXRlCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBAcHJvcGVydHkKICAgIGRlZiBjYWNoZWRfbWVzc2FnZShzZWxmKToKICAgICAgICAiIiJPcHRpb25hbFs6Y2xhc3M6YH5kaXNjb3JkLk1lc3NhZ2VgXTogVGhlIGNhY2hlZCBtZXNzYWdlLCBpZiBmb3VuZCBpbiB0aGUgaW50ZXJuYWwgbWVzc2FnZSBjYWNoZS4iIiIKICAgICAgICByZXR1cm4gc2VsZi5fc3RhdGUuX2dldF9tZXNzYWdlKHNlbGYubWVzc2FnZV9pZCkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBqdW1wX3VybChzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YHN0cmA6IFJldHVybnMgYSBVUkwgdGhhdCBhbGxvd3MgdGhlIGNsaWVudCB0byBqdW1wIHRvIHRoZSByZWZlcmVuY2VkIG1lc3NhZ2UuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNwogICAgICAgICIiIgogICAgICAgIGd1aWxkX2lkID0gc2VsZi5ndWlsZF9pZCBpZiBzZWxmLmd1aWxkX2lkIGlzIG5vdCBOb25lIGVsc2UgJ0BtZScKICAgICAgICByZXR1cm4gJ2h0dHBzOi8vZGlzY29yZC5jb20vY2hhbm5lbHMvezB9L3sxLmNoYW5uZWxfaWR9L3sxLm1lc3NhZ2VfaWR9Jy5mb3JtYXQoZ3VpbGRfaWQsIHNlbGYpCgogICAgZGVmIF9fcmVwcl9fKHNlbGYpOgogICAgICAgIHJldHVybiAnPE1lc3NhZ2VSZWZlcmVuY2UgbWVzc2FnZV9pZD17MC5tZXNzYWdlX2lkIXJ9IGNoYW5uZWxfaWQ9ezAuY2hhbm5lbF9pZCFyfSBndWlsZF9pZD17MC5ndWlsZF9pZCFyfT4nLmZvcm1hdChzZWxmKQoKICAgIGRlZiB0b19kaWN0KHNlbGYpOgogICAgICAgIHJlc3VsdCA9IHsnbWVzc2FnZV9pZCc6IHNlbGYubWVzc2FnZV9pZH0gaWYgc2VsZi5tZXNzYWdlX2lkIGlzIG5vdCBOb25lIGVsc2Uge30KICAgICAgICByZXN1bHRbJ2NoYW5uZWxfaWQnXSA9IHNlbGYuY2hhbm5lbF9pZAogICAgICAgIGlmIHNlbGYuZ3VpbGRfaWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJlc3VsdFsnZ3VpbGRfaWQnXSA9IHNlbGYuZ3VpbGRfaWQKICAgICAgICBpZiBzZWxmLmZhaWxfaWZfbm90X2V4aXN0cyBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmVzdWx0WydmYWlsX2lmX25vdF9leGlzdHMnXSA9IHNlbGYuZmFpbF9pZl9ub3RfZXhpc3RzCiAgICAgICAgcmV0dXJuIHJlc3VsdAoKICAgIHRvX21lc3NhZ2VfcmVmZXJlbmNlX2RpY3QgPSB0b19kaWN0CgpkZWYgZmxhdHRlbl9oYW5kbGVycyhjbHMpOgogICAgcHJlZml4ID0gbGVuKCdfaGFuZGxlXycpCiAgICBoYW5kbGVycyA9IFsKICAgICAgICAoa2V5W3ByZWZpeDpdLCB2YWx1ZSkKICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBjbHMuX19kaWN0X18uaXRlbXMoKQogICAgICAgIGlmIGtleS5zdGFydHN3aXRoKCdfaGFuZGxlXycpIGFuZCBrZXkgIT0gJ19oYW5kbGVfbWVtYmVyJwogICAgXQoKICAgICMgc3RvcmUgX2hhbmRsZV9tZW1iZXIgbGFzdAogICAgaGFuZGxlcnMuYXBwZW5kKCgnbWVtYmVyJywgY2xzLl9oYW5kbGVfbWVtYmVyKSkKICAgIGNscy5fSEFORExFUlMgPSBoYW5kbGVycwogICAgY2xzLl9DQUNIRURfU0xPVFMgPSBbCiAgICAgICAgYXR0ciBmb3IgYXR0ciBpbiBjbHMuX19zbG90c19fIGlmIGF0dHIuc3RhcnRzd2l0aCgnX2NzXycpCiAgICBdCiAgICByZXR1cm4gY2xzCgpAZmxhdHRlbl9oYW5kbGVycwpjbGFzcyBNZXNzYWdlKEhhc2hhYmxlKToKICAgIHIiIiJSZXByZXNlbnRzIGEgbWVzc2FnZSBmcm9tIERpc2NvcmQuCgogICAgLi4gY29udGFpbmVyOjogb3BlcmF0aW9ucwoKICAgICAgICAuLiBkZXNjcmliZTo6IHggPT0geQoKICAgICAgICAgICAgQ2hlY2tzIGlmIHR3byBtZXNzYWdlcyBhcmUgZXF1YWwuCgogICAgICAgIC4uIGRlc2NyaWJlOjogeCAhPSB5CgogICAgICAgICAgICBDaGVja3MgaWYgdHdvIG1lc3NhZ2VzIGFyZSBub3QgZXF1YWwuCgogICAgICAgIC4uIGRlc2NyaWJlOjogaGFzaCh4KQoKICAgICAgICAgICAgUmV0dXJucyB0aGUgbWVzc2FnZSdzIGhhc2guCgogICAgQXR0cmlidXRlcwogICAgLS0tLS0tLS0tLS0KICAgIHR0czogOmNsYXNzOmBib29sYAogICAgICAgIFNwZWNpZmllcyBpZiB0aGUgbWVzc2FnZSB3YXMgZG9uZSB3aXRoIHRleHQtdG8tc3BlZWNoLgogICAgICAgIFRoaXMgY2FuIG9ubHkgYmUgYWNjdXJhdGVseSByZWNlaXZlZCBpbiA6ZnVuYzpgb25fbWVzc2FnZWAgZHVlIHRvCiAgICAgICAgYSBkaXNjb3JkIGxpbWl0YXRpb24uCiAgICB0eXBlOiA6Y2xhc3M6YE1lc3NhZ2VUeXBlYAogICAgICAgIFRoZSB0eXBlIG9mIG1lc3NhZ2UuIEluIG1vc3QgY2FzZXMgdGhpcyBzaG91bGQgbm90IGJlIGNoZWNrZWQsIGJ1dCBpdCBpcyBoZWxwZnVsCiAgICAgICAgaW4gY2FzZXMgd2hlcmUgaXQgbWlnaHQgYmUgYSBzeXN0ZW0gbWVzc2FnZSBmb3IgOmF0dHI6YHN5c3RlbV9jb250ZW50YC4KICAgIGF1dGhvcjogOmNsYXNzOmBhYmMuVXNlcmAKICAgICAgICBBIDpjbGFzczpgTWVtYmVyYCB0aGF0IHNlbnQgdGhlIG1lc3NhZ2UuIElmIDphdHRyOmBjaGFubmVsYCBpcyBhCiAgICAgICAgcHJpdmF0ZSBjaGFubmVsIG9yIHRoZSB1c2VyIGhhcyB0aGUgbGVmdCB0aGUgZ3VpbGQsIHRoZW4gaXQgaXMgYSA6Y2xhc3M6YFVzZXJgIGluc3RlYWQuCiAgICBjb250ZW50OiA6Y2xhc3M6YHN0cmAKICAgICAgICBUaGUgYWN0dWFsIGNvbnRlbnRzIG9mIHRoZSBtZXNzYWdlLgogICAgbm9uY2UKICAgICAgICBUaGUgdmFsdWUgdXNlZCBieSB0aGUgZGlzY29yZCBndWlsZCBhbmQgdGhlIGNsaWVudCB0byB2ZXJpZnkgdGhhdCB0aGUgbWVzc2FnZSBpcyBzdWNjZXNzZnVsbHkgc2VudC4KICAgICAgICBUaGlzIGlzIG5vdCBzdG9yZWQgbG9uZyB0ZXJtIHdpdGhpbiBEaXNjb3JkJ3Mgc2VydmVycyBhbmQgaXMgb25seSB1c2VkIGVwaGVtZXJhbGx5LgogICAgZW1iZWRzOiBMaXN0WzpjbGFzczpgRW1iZWRgXQogICAgICAgIEEgbGlzdCBvZiBlbWJlZHMgdGhlIG1lc3NhZ2UgaGFzLgogICAgY2hhbm5lbDogVW5pb25bOmNsYXNzOmBhYmMuTWVzc2FnZWFibGVgXQogICAgICAgIFRoZSA6Y2xhc3M6YFRleHRDaGFubmVsYCB0aGF0IHRoZSBtZXNzYWdlIHdhcyBzZW50IGZyb20uCiAgICAgICAgQ291bGQgYmUgYSA6Y2xhc3M6YERNQ2hhbm5lbGAgb3IgOmNsYXNzOmBHcm91cENoYW5uZWxgIGlmIGl0J3MgYSBwcml2YXRlIG1lc3NhZ2UuCiAgICBjYWxsOiBPcHRpb25hbFs6Y2xhc3M6YENhbGxNZXNzYWdlYF0KICAgICAgICBUaGUgY2FsbCB0aGF0IHRoZSBtZXNzYWdlIHJlZmVycyB0by4gVGhpcyBpcyBvbmx5IGFwcGxpY2FibGUgdG8gbWVzc2FnZXMgb2YgdHlwZQogICAgICAgIDphdHRyOmBNZXNzYWdlVHlwZS5jYWxsYC4KCiAgICAgICAgLi4gZGVwcmVjYXRlZDo6IDEuNwoKICAgIHJlZmVyZW5jZTogT3B0aW9uYWxbOmNsYXNzOmB+ZGlzY29yZC5NZXNzYWdlUmVmZXJlbmNlYF0KICAgICAgICBUaGUgbWVzc2FnZSB0aGF0IHRoaXMgbWVzc2FnZSByZWZlcmVuY2VzLiBUaGlzIGlzIG9ubHkgYXBwbGljYWJsZSB0byBtZXNzYWdlcyBvZgogICAgICAgIHR5cGUgOmF0dHI6YE1lc3NhZ2VUeXBlLnBpbnNfYWRkYCwgY3Jvc3Nwb3N0ZWQgbWVzc2FnZXMgY3JlYXRlZCBieSBhCiAgICAgICAgZm9sbG93ZWQgY2hhbm5lbCBpbnRlZ3JhdGlvbiwgb3IgbWVzc2FnZSByZXBsaWVzLgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjUKCiAgICBtZW50aW9uX2V2ZXJ5b25lOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgU3BlY2lmaWVzIGlmIHRoZSBtZXNzYWdlIG1lbnRpb25zIGV2ZXJ5b25lLgoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgZG9lcyBub3QgY2hlY2sgaWYgdGhlIGBgQGV2ZXJ5b25lYGAgb3IgdGhlIGBgQGhlcmVgYCB0ZXh0IGlzIGluIHRoZSBtZXNzYWdlIGl0c2VsZi4KICAgICAgICAgICAgUmF0aGVyIHRoaXMgYm9vbGVhbiBpbmRpY2F0ZXMgaWYgZWl0aGVyIHRoZSBgYEBldmVyeW9uZWBgIG9yIHRoZSBgYEBoZXJlYGAgdGV4dCBpcyBpbiB0aGUgbWVzc2FnZQogICAgICAgICAgICAqKmFuZCoqIGl0IGRpZCBlbmQgdXAgbWVudGlvbmluZy4KICAgIG1lbnRpb25zOiBMaXN0WzpjbGFzczpgYWJjLlVzZXJgXQogICAgICAgIEEgbGlzdCBvZiA6Y2xhc3M6YE1lbWJlcmAgdGhhdCB3ZXJlIG1lbnRpb25lZC4gSWYgdGhlIG1lc3NhZ2UgaXMgaW4gYSBwcml2YXRlIG1lc3NhZ2UKICAgICAgICB0aGVuIHRoZSBsaXN0IHdpbGwgYmUgb2YgOmNsYXNzOmBVc2VyYCBpbnN0ZWFkLiBGb3IgbWVzc2FnZXMgdGhhdCBhcmUgbm90IG9mIHR5cGUKICAgICAgICA6YXR0cjpgTWVzc2FnZVR5cGUuZGVmYXVsdGBcLCB0aGlzIGFycmF5IGNhbiBiZSB1c2VkIHRvIGFpZCBpbiBzeXN0ZW0gbWVzc2FnZXMuCiAgICAgICAgRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZSA6YXR0cjpgc3lzdGVtX2NvbnRlbnRgLgoKICAgICAgICAuLiB3YXJuaW5nOjoKCiAgICAgICAgICAgIFRoZSBvcmRlciBvZiB0aGUgbWVudGlvbnMgbGlzdCBpcyBub3QgaW4gYW55IHBhcnRpY3VsYXIgb3JkZXIgc28geW91IHNob3VsZAogICAgICAgICAgICBub3QgcmVseSBvbiBpdC4gVGhpcyBpcyBhIERpc2NvcmQgbGltaXRhdGlvbiwgbm90IG9uZSB3aXRoIHRoZSBsaWJyYXJ5LgogICAgY2hhbm5lbF9tZW50aW9uczogTGlzdFs6Y2xhc3M6YGFiYy5HdWlsZENoYW5uZWxgXQogICAgICAgIEEgbGlzdCBvZiA6Y2xhc3M6YGFiYy5HdWlsZENoYW5uZWxgIHRoYXQgd2VyZSBtZW50aW9uZWQuIElmIHRoZSBtZXNzYWdlIGlzIGluIGEgcHJpdmF0ZSBtZXNzYWdlCiAgICAgICAgdGhlbiB0aGUgbGlzdCBpcyBhbHdheXMgZW1wdHkuCiAgICByb2xlX21lbnRpb25zOiBMaXN0WzpjbGFzczpgUm9sZWBdCiAgICAgICAgQSBsaXN0IG9mIDpjbGFzczpgUm9sZWAgdGhhdCB3ZXJlIG1lbnRpb25lZC4gSWYgdGhlIG1lc3NhZ2UgaXMgaW4gYSBwcml2YXRlIG1lc3NhZ2UKICAgICAgICB0aGVuIHRoZSBsaXN0IGlzIGFsd2F5cyBlbXB0eS4KICAgIGlkOiA6Y2xhc3M6YGludGAKICAgICAgICBUaGUgbWVzc2FnZSBJRC4KICAgIHdlYmhvb2tfaWQ6IE9wdGlvbmFsWzpjbGFzczpgaW50YF0KICAgICAgICBJZiB0aGlzIG1lc3NhZ2Ugd2FzIHNlbnQgYnkgYSB3ZWJob29rLCB0aGVuIHRoaXMgaXMgdGhlIHdlYmhvb2sgSUQncyB0aGF0IHNlbnQgdGhpcwogICAgICAgIG1lc3NhZ2UuCiAgICBhdHRhY2htZW50czogTGlzdFs6Y2xhc3M6YEF0dGFjaG1lbnRgXQogICAgICAgIEEgbGlzdCBvZiBhdHRhY2htZW50cyBnaXZlbiB0byBhIG1lc3NhZ2UuCiAgICBwaW5uZWQ6IDpjbGFzczpgYm9vbGAKICAgICAgICBTcGVjaWZpZXMgaWYgdGhlIG1lc3NhZ2UgaXMgY3VycmVudGx5IHBpbm5lZC4KICAgIGZsYWdzOiA6Y2xhc3M6YE1lc3NhZ2VGbGFnc2AKICAgICAgICBFeHRyYSBmZWF0dXJlcyBvZiB0aGUgbWVzc2FnZS4KCiAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS4zCgogICAgcmVhY3Rpb25zIDogTGlzdFs6Y2xhc3M6YFJlYWN0aW9uYF0KICAgICAgICBSZWFjdGlvbnMgdG8gYSBtZXNzYWdlLiBSZWFjdGlvbnMgY2FuIGJlIGVpdGhlciBjdXN0b20gZW1vamkgb3Igc3RhbmRhcmQgdW5pY29kZSBlbW9qaS4KICAgIGFjdGl2aXR5OiBPcHRpb25hbFs6Y2xhc3M6YGRpY3RgXQogICAgICAgIFRoZSBhY3Rpdml0eSBhc3NvY2lhdGVkIHdpdGggdGhpcyBtZXNzYWdlLiBTZW50IHdpdGggUmljaC1QcmVzZW5jZSByZWxhdGVkIG1lc3NhZ2VzIHRoYXQgZm9yCiAgICAgICAgZXhhbXBsZSwgcmVxdWVzdCBqb2luaW5nLCBzcGVjdGF0aW5nLCBvciBsaXN0ZW5pbmcgdG8gb3Igd2l0aCBhbm90aGVyIG1lbWJlci4KCiAgICAgICAgSXQgaXMgYSBkaWN0aW9uYXJ5IHdpdGggdGhlIGZvbGxvd2luZyBvcHRpb25hbCBrZXlzOgoKICAgICAgICAtIGBgdHlwZWBgOiBBbiBpbnRlZ2VyIGRlbm90aW5nIHRoZSB0eXBlIG9mIG1lc3NhZ2UgYWN0aXZpdHkgYmVpbmcgcmVxdWVzdGVkLgogICAgICAgIC0gYGBwYXJ0eV9pZGBgOiBUaGUgcGFydHkgSUQgYXNzb2NpYXRlZCB3aXRoIHRoZSBwYXJ0eS4KICAgIGFwcGxpY2F0aW9uOiBPcHRpb25hbFs6Y2xhc3M6YGRpY3RgXQogICAgICAgIFRoZSByaWNoIHByZXNlbmNlIGVuYWJsZWQgYXBwbGljYXRpb24gYXNzb2NpYXRlZCB3aXRoIHRoaXMgbWVzc2FnZS4KCiAgICAgICAgSXQgaXMgYSBkaWN0aW9uYXJ5IHdpdGggdGhlIGZvbGxvd2luZyBrZXlzOgoKICAgICAgICAtIGBgaWRgYDogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBhcHBsaWNhdGlvbidzIElELgogICAgICAgIC0gYGBuYW1lYGA6IEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgYXBwbGljYXRpb24ncyBuYW1lLgogICAgICAgIC0gYGBkZXNjcmlwdGlvbmBgOiBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGFwcGxpY2F0aW9uJ3MgZGVzY3JpcHRpb24uCiAgICAgICAgLSBgYGljb25gYDogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBpY29uIElEIG9mIHRoZSBhcHBsaWNhdGlvbi4KICAgICAgICAtIGBgY292ZXJfaW1hZ2VgYDogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBlbWJlZCdzIGltYWdlIGFzc2V0IElELgogICAgc3RpY2tlcnM6IExpc3RbOmNsYXNzOmBTdGlja2VyYF0KICAgICAgICBBIGxpc3Qgb2Ygc3RpY2tlcnMgZ2l2ZW4gdG8gdGhlIG1lc3NhZ2UuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNgogICAgIiIiCgogICAgX19zbG90c19fID0gKCdfZWRpdGVkX3RpbWVzdGFtcCcsICd0dHMnLCAnY29udGVudCcsICdjaGFubmVsJywgJ3dlYmhvb2tfaWQnLAogICAgICAgICAgICAgICAgICdtZW50aW9uX2V2ZXJ5b25lJywgJ2VtYmVkcycsICdpZCcsICdtZW50aW9ucycsICdhdXRob3InLAogICAgICAgICAgICAgICAgICdfY3NfY2hhbm5lbF9tZW50aW9ucycsICdfY3NfcmF3X21lbnRpb25zJywgJ2F0dGFjaG1lbnRzJywKICAgICAgICAgICAgICAgICAnX2NzX2NsZWFuX2NvbnRlbnQnLCAnX2NzX3Jhd19jaGFubmVsX21lbnRpb25zJywgJ25vbmNlJywgJ3Bpbm5lZCcsCiAgICAgICAgICAgICAgICAgJ3JvbGVfbWVudGlvbnMnLCAnX2NzX3Jhd19yb2xlX21lbnRpb25zJywgJ3R5cGUnLCAnY2FsbCcsICdmbGFncycsCiAgICAgICAgICAgICAgICAgJ19jc19zeXN0ZW1fY29udGVudCcsICdfY3NfZ3VpbGQnLCAnX3N0YXRlJywgJ3JlYWN0aW9ucycsICdyZWZlcmVuY2UnLAogICAgICAgICAgICAgICAgICdhcHBsaWNhdGlvbicsICdhY3Rpdml0eScsICdzdGlja2VycycpCgogICAgZGVmIF9faW5pdF9fKHNlbGYsICosIHN0YXRlLCBjaGFubmVsLCBkYXRhKToKICAgICAgICBzZWxmLl9zdGF0ZSA9IHN0YXRlCiAgICAgICAgc2VsZi5pZCA9IGludChkYXRhWydpZCddKQogICAgICAgIHNlbGYud2ViaG9va19pZCA9IHV0aWxzLl9nZXRfYXNfc25vd2ZsYWtlKGRhdGEsICd3ZWJob29rX2lkJykKICAgICAgICBzZWxmLnJlYWN0aW9ucyA9IFtSZWFjdGlvbihtZXNzYWdlPXNlbGYsIGRhdGE9ZCkgZm9yIGQgaW4gZGF0YS5nZXQoJ3JlYWN0aW9ucycsIFtdKV0KICAgICAgICBzZWxmLmF0dGFjaG1lbnRzID0gW0F0dGFjaG1lbnQoZGF0YT1hLCBzdGF0ZT1zZWxmLl9zdGF0ZSkgZm9yIGEgaW4gZGF0YVsnYXR0YWNobWVudHMnXV0KICAgICAgICBzZWxmLmVtYmVkcyA9IFtFbWJlZC5mcm9tX2RpY3QoYSkgZm9yIGEgaW4gZGF0YVsnZW1iZWRzJ11dCiAgICAgICAgc2VsZi5hcHBsaWNhdGlvbiA9IGRhdGEuZ2V0KCdhcHBsaWNhdGlvbicpCiAgICAgICAgc2VsZi5hY3Rpdml0eSA9IGRhdGEuZ2V0KCdhY3Rpdml0eScpCiAgICAgICAgc2VsZi5jaGFubmVsID0gY2hhbm5lbAogICAgICAgIHNlbGYuY2FsbCA9IE5vbmUKICAgICAgICBzZWxmLl9lZGl0ZWRfdGltZXN0YW1wID0gdXRpbHMucGFyc2VfdGltZShkYXRhWydlZGl0ZWRfdGltZXN0YW1wJ10pCiAgICAgICAgc2VsZi50eXBlID0gdHJ5X2VudW0oTWVzc2FnZVR5cGUsIGRhdGFbJ3R5cGUnXSkKICAgICAgICBzZWxmLnBpbm5lZCA9IGRhdGFbJ3Bpbm5lZCddCiAgICAgICAgc2VsZi5mbGFncyA9IE1lc3NhZ2VGbGFncy5fZnJvbV92YWx1ZShkYXRhLmdldCgnZmxhZ3MnLCAwKSkKICAgICAgICBzZWxmLm1lbnRpb25fZXZlcnlvbmUgPSBkYXRhWydtZW50aW9uX2V2ZXJ5b25lJ10KICAgICAgICBzZWxmLnR0cyA9IGRhdGFbJ3R0cyddCiAgICAgICAgc2VsZi5jb250ZW50ID0gZGF0YVsnY29udGVudCddCiAgICAgICAgc2VsZi5ub25jZSA9IGRhdGEuZ2V0KCdub25jZScpCiAgICAgICAgc2VsZi5zdGlja2VycyA9IFtTdGlja2VyKGRhdGE9ZGF0YSwgc3RhdGU9c3RhdGUpIGZvciBkYXRhIGluIGRhdGEuZ2V0KCdzdGlja2VycycsIFtdKV0KCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZWYgPSBkYXRhWydtZXNzYWdlX3JlZmVyZW5jZSddCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICBzZWxmLnJlZmVyZW5jZSA9IE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLnJlZmVyZW5jZSA9IHJlZiA9IE1lc3NhZ2VSZWZlcmVuY2Uud2l0aF9zdGF0ZShzdGF0ZSwgcmVmKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXNvbHZlZCA9IGRhdGFbJ3JlZmVyZW5jZWRfbWVzc2FnZSddCiAgICAgICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIHJlc29sdmVkIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmVmLnJlc29sdmVkID0gRGVsZXRlZFJlZmVyZW5jZWRNZXNzYWdlKHJlZikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBSaWdodCBub3cgdGhlIGNoYW5uZWwgSURzIG1hdGNoIGJ1dCBtYXliZSBpbiB0aGUgZnV0dXJlIHRoZXkgd29uJ3QuCiAgICAgICAgICAgICAgICAgICAgaWYgcmVmLmNoYW5uZWxfaWQgPT0gY2hhbm5lbC5pZDoKICAgICAgICAgICAgICAgICAgICAgICAgY2hhbiA9IGNoYW5uZWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBjaGFuLCBfID0gc3RhdGUuX2dldF9ndWlsZF9jaGFubmVsKHJlc29sdmVkKQoKICAgICAgICAgICAgICAgICAgICByZWYucmVzb2x2ZWQgPSBzZWxmLl9fY2xhc3NfXyhjaGFubmVsPWNoYW4sIGRhdGE9cmVzb2x2ZWQsIHN0YXRlPXN0YXRlKQoKICAgICAgICBmb3IgaGFuZGxlciBpbiAoJ2F1dGhvcicsICdtZW1iZXInLCAnbWVudGlvbnMnLCAnbWVudGlvbl9yb2xlcycsICdjYWxsJywgJ2ZsYWdzJyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGdldGF0dHIoc2VsZiwgJ19oYW5kbGVfJXMnICUgaGFuZGxlcikoZGF0YVtoYW5kbGVyXSkKICAgICAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgcmV0dXJuICc8TWVzc2FnZSBpZD17MC5pZH0gY2hhbm5lbD17MC5jaGFubmVsIXJ9IHR5cGU9ezAudHlwZSFyfSBhdXRob3I9ezAuYXV0aG9yIXJ9IGZsYWdzPXswLmZsYWdzIXJ9PicuZm9ybWF0KHNlbGYpCgogICAgZGVmIF90cnlfcGF0Y2goc2VsZiwgZGF0YSwga2V5LCB0cmFuc2Zvcm09Tm9uZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB2YWx1ZSA9IGRhdGFba2V5XQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIHRyYW5zZm9ybSBpcyBOb25lOgogICAgICAgICAgICAgICAgc2V0YXR0cihzZWxmLCBrZXksIHZhbHVlKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2V0YXR0cihzZWxmLCBrZXksIHRyYW5zZm9ybSh2YWx1ZSkpCgogICAgZGVmIF9hZGRfcmVhY3Rpb24oc2VsZiwgZGF0YSwgZW1vamksIHVzZXJfaWQpOgogICAgICAgIHJlYWN0aW9uID0gdXRpbHMuZmluZChsYW1iZGEgcjogci5lbW9qaSA9PSBlbW9qaSwgc2VsZi5yZWFjdGlvbnMpCiAgICAgICAgaXNfbWUgPSBkYXRhWydtZSddID0gdXNlcl9pZCA9PSBzZWxmLl9zdGF0ZS5zZWxmX2lkCgogICAgICAgIGlmIHJlYWN0aW9uIGlzIE5vbmU6CiAgICAgICAgICAgIHJlYWN0aW9uID0gUmVhY3Rpb24obWVzc2FnZT1zZWxmLCBkYXRhPWRhdGEsIGVtb2ppPWVtb2ppKQogICAgICAgICAgICBzZWxmLnJlYWN0aW9ucy5hcHBlbmQocmVhY3Rpb24pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmVhY3Rpb24uY291bnQgKz0gMQogICAgICAgICAgICBpZiBpc19tZToKICAgICAgICAgICAgICAgIHJlYWN0aW9uLm1lID0gaXNfbWUKCiAgICAgICAgcmV0dXJuIHJlYWN0aW9uCgogICAgZGVmIF9yZW1vdmVfcmVhY3Rpb24oc2VsZiwgZGF0YSwgZW1vamksIHVzZXJfaWQpOgogICAgICAgIHJlYWN0aW9uID0gdXRpbHMuZmluZChsYW1iZGEgcjogci5lbW9qaSA9PSBlbW9qaSwgc2VsZi5yZWFjdGlvbnMpCgogICAgICAgIGlmIHJlYWN0aW9uIGlzIE5vbmU6CiAgICAgICAgICAgICMgYWxyZWFkeSByZW1vdmVkPwogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdFbW9qaSBhbHJlYWR5IHJlbW92ZWQ/JykKCiAgICAgICAgIyBpZiByZWFjdGlvbiBpc24ndCBpbiB0aGUgbGlzdCwgd2UgY3Jhc2guIFRoaXMgbWVhbnMgZGlzY29yZAogICAgICAgICMgc2VudCBiYWQgZGF0YSwgb3Igd2Ugc3RvcmVkIGltcHJvcGVybHkKICAgICAgICByZWFjdGlvbi5jb3VudCAtPSAxCgogICAgICAgIGlmIHVzZXJfaWQgPT0gc2VsZi5fc3RhdGUuc2VsZl9pZDoKICAgICAgICAgICAgcmVhY3Rpb24ubWUgPSBGYWxzZQogICAgICAgIGlmIHJlYWN0aW9uLmNvdW50ID09IDA6CiAgICAgICAgICAgICMgdGhpcyByYWlzZXMgVmFsdWVFcnJvciBpZiBzb21ldGhpbmcgd2VudCB3cm9uZyBhcyB3ZWxsLgogICAgICAgICAgICBzZWxmLnJlYWN0aW9ucy5yZW1vdmUocmVhY3Rpb24pCgogICAgICAgIHJldHVybiByZWFjdGlvbgoKICAgIGRlZiBfY2xlYXJfZW1vamkoc2VsZiwgZW1vamkpOgogICAgICAgIHRvX2NoZWNrID0gc3RyKGVtb2ppKQogICAgICAgIGZvciBpbmRleCwgcmVhY3Rpb24gaW4gZW51bWVyYXRlKHNlbGYucmVhY3Rpb25zKToKICAgICAgICAgICAgaWYgc3RyKHJlYWN0aW9uLmVtb2ppKSA9PSB0b19jaGVjazoKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBkaWRuJ3QgZmluZCBhbnl0aGluZyBzbyBqdXN0IHJldHVybgogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgZGVsIHNlbGYucmVhY3Rpb25zW2luZGV4XQogICAgICAgIHJldHVybiByZWFjdGlvbgoKICAgIGRlZiBfdXBkYXRlKHNlbGYsIGRhdGEpOgogICAgICAgICMgSW4gYW4gdXBkYXRlIHNjaGVtZSwgJ2F1dGhvcicga2V5IGhhcyB0byBiZSBoYW5kbGVkIGJlZm9yZSAnbWVtYmVyJwogICAgICAgICMgb3RoZXJ3aXNlIHRoZXkgb3ZlcndyaXRlIGVhY2ggb3RoZXIgd2hpY2ggaXMgdW5kZXNpcmFibGUuCiAgICAgICAgIyBTaW5jZSB0aGVyZSdzIG5vIGdvb2Qgd2F5IHRvIGRvIHRoaXMgd2UgaGF2ZSB0byBpdGVyYXRlIG92ZXIgZXZlcnkKICAgICAgICAjIGhhbmRsZXIgcmF0aGVyIHRoYW4gaXRlcmF0aW5nIG92ZXIgdGhlIGtleXMgd2hpY2ggaXMgYSBsaXR0bGUgc2xvd2VyCiAgICAgICAgZm9yIGtleSwgaGFuZGxlciBpbiBzZWxmLl9IQU5ETEVSUzoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdmFsdWUgPSBkYXRhW2tleV0KICAgICAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGhhbmRsZXIoc2VsZiwgdmFsdWUpCgogICAgICAgICMgY2xlYXIgdGhlIGNhY2hlZCBwcm9wZXJ0aWVzCiAgICAgICAgZm9yIGF0dHIgaW4gc2VsZi5fQ0FDSEVEX1NMT1RTOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZWxhdHRyKHNlbGYsIGF0dHIpCiAgICAgICAgICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvcjoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICBkZWYgX2hhbmRsZV9lZGl0ZWRfdGltZXN0YW1wKHNlbGYsIHZhbHVlKToKICAgICAgICBzZWxmLl9lZGl0ZWRfdGltZXN0YW1wID0gdXRpbHMucGFyc2VfdGltZSh2YWx1ZSkKCiAgICBkZWYgX2hhbmRsZV9waW5uZWQoc2VsZiwgdmFsdWUpOgogICAgICAgIHNlbGYucGlubmVkID0gdmFsdWUKCiAgICBkZWYgX2hhbmRsZV9mbGFncyhzZWxmLCB2YWx1ZSk6CiAgICAgICAgc2VsZi5mbGFncyA9IE1lc3NhZ2VGbGFncy5fZnJvbV92YWx1ZSh2YWx1ZSkKCiAgICBkZWYgX2hhbmRsZV9hcHBsaWNhdGlvbihzZWxmLCB2YWx1ZSk6CiAgICAgICAgc2VsZi5hcHBsaWNhdGlvbiA9IHZhbHVlCgogICAgZGVmIF9oYW5kbGVfYWN0aXZpdHkoc2VsZiwgdmFsdWUpOgogICAgICAgIHNlbGYuYWN0aXZpdHkgPSB2YWx1ZQoKICAgIGRlZiBfaGFuZGxlX21lbnRpb25fZXZlcnlvbmUoc2VsZiwgdmFsdWUpOgogICAgICAgIHNlbGYubWVudGlvbl9ldmVyeW9uZSA9IHZhbHVlCgogICAgZGVmIF9oYW5kbGVfdHRzKHNlbGYsIHZhbHVlKToKICAgICAgICBzZWxmLnR0cyA9IHZhbHVlCgogICAgZGVmIF9oYW5kbGVfdHlwZShzZWxmLCB2YWx1ZSk6CiAgICAgICAgc2VsZi50eXBlID0gdHJ5X2VudW0oTWVzc2FnZVR5cGUsIHZhbHVlKQoKICAgIGRlZiBfaGFuZGxlX2NvbnRlbnQoc2VsZiwgdmFsdWUpOgogICAgICAgIHNlbGYuY29udGVudCA9IHZhbHVlCgogICAgZGVmIF9oYW5kbGVfYXR0YWNobWVudHMoc2VsZiwgdmFsdWUpOgogICAgICAgIHNlbGYuYXR0YWNobWVudHMgPSBbQXR0YWNobWVudChkYXRhPWEsIHN0YXRlPXNlbGYuX3N0YXRlKSBmb3IgYSBpbiB2YWx1ZV0KCiAgICBkZWYgX2hhbmRsZV9lbWJlZHMoc2VsZiwgdmFsdWUpOgogICAgICAgIHNlbGYuZW1iZWRzID0gW0VtYmVkLmZyb21fZGljdChkYXRhKSBmb3IgZGF0YSBpbiB2YWx1ZV0KCiAgICBkZWYgX2hhbmRsZV9ub25jZShzZWxmLCB2YWx1ZSk6CiAgICAgICAgc2VsZi5ub25jZSA9IHZhbHVlCgogICAgZGVmIF9oYW5kbGVfYXV0aG9yKHNlbGYsIGF1dGhvcik6CiAgICAgICAgc2VsZi5hdXRob3IgPSBzZWxmLl9zdGF0ZS5zdG9yZV91c2VyKGF1dGhvcikKICAgICAgICBpZiBpc2luc3RhbmNlKHNlbGYuZ3VpbGQsIEd1aWxkKToKICAgICAgICAgICAgZm91bmQgPSBzZWxmLmd1aWxkLmdldF9tZW1iZXIoc2VsZi5hdXRob3IuaWQpCiAgICAgICAgICAgIGlmIGZvdW5kIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5hdXRob3IgPSBmb3VuZAoKICAgIGRlZiBfaGFuZGxlX21lbWJlcihzZWxmLCBtZW1iZXIpOgogICAgICAgICMgVGhlIGdhdGV3YXkgbm93IGdpdmVzIHVzIGZ1bGwgTWVtYmVyIG9iamVjdHMgc29tZXRpbWVzIHdpdGggdGhlIGZvbGxvd2luZyBrZXlzCiAgICAgICAgIyBkZWFmLCBtdXRlLCBqb2luZWRfYXQsIHJvbGVzCiAgICAgICAgIyBGb3IgdGhlIHNha2Ugb2YgcGVyZm9ybWFuY2UgSSdtIGdvaW5nIHRvIGFzc3VtZSB0aGF0IHRoZSBvbmx5CiAgICAgICAgIyBmaWVsZCB0aGF0IG5lZWRzICp1cGRhdGluZyogd291bGQgYmUgdGhlIGpvaW5lZF9hdCBmaWVsZC4KICAgICAgICAjIElmIHRoZXJlIGlzIG5vIE1lbWJlciBvYmplY3QgKGZvciBzb21lIHN0cmFuZ2UgcmVhc29uKSwgdGhlbiB3ZSBjYW4gdXBncmFkZQogICAgICAgICMgb3Vyc2VsdmVzIHRvIGEgbW9yZSAicGFydGlhbCIgbWVtYmVyIG9iamVjdC4KICAgICAgICBhdXRob3IgPSBzZWxmLmF1dGhvcgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBVcGRhdGUgbWVtYmVyIHJlZmVyZW5jZQogICAgICAgICAgICBhdXRob3IuX3VwZGF0ZV9mcm9tX21lc3NhZ2UobWVtYmVyKQogICAgICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvcjoKICAgICAgICAgICAgIyBJdCdzIGEgdXNlciBoZXJlCiAgICAgICAgICAgICMgVE9ETzogY29uc2lkZXIgYWRkaW5nIHRvIGNhY2hlIGhlcmUKICAgICAgICAgICAgc2VsZi5hdXRob3IgPSBNZW1iZXIuX2Zyb21fbWVzc2FnZShtZXNzYWdlPXNlbGYsIGRhdGE9bWVtYmVyKQoKICAgIGRlZiBfaGFuZGxlX21lbnRpb25zKHNlbGYsIG1lbnRpb25zKToKICAgICAgICBzZWxmLm1lbnRpb25zID0gciA9IFtdCiAgICAgICAgZ3VpbGQgPSBzZWxmLmd1aWxkCiAgICAgICAgc3RhdGUgPSBzZWxmLl9zdGF0ZQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGd1aWxkLCBHdWlsZCk6CiAgICAgICAgICAgIHNlbGYubWVudGlvbnMgPSBbc3RhdGUuc3RvcmVfdXNlcihtKSBmb3IgbSBpbiBtZW50aW9uc10KICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGZvciBtZW50aW9uIGluIGZpbHRlcihOb25lLCBtZW50aW9ucyk6CiAgICAgICAgICAgIGlkX3NlYXJjaCA9IGludChtZW50aW9uWydpZCddKQogICAgICAgICAgICBtZW1iZXIgPSBndWlsZC5nZXRfbWVtYmVyKGlkX3NlYXJjaCkKICAgICAgICAgICAgaWYgbWVtYmVyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgci5hcHBlbmQobWVtYmVyKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgci5hcHBlbmQoTWVtYmVyLl90cnlfdXBncmFkZShkYXRhPW1lbnRpb24sIGd1aWxkPWd1aWxkLCBzdGF0ZT1zdGF0ZSkpCgogICAgZGVmIF9oYW5kbGVfbWVudGlvbl9yb2xlcyhzZWxmLCByb2xlX21lbnRpb25zKToKICAgICAgICBzZWxmLnJvbGVfbWVudGlvbnMgPSBbXQogICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZi5ndWlsZCwgR3VpbGQpOgogICAgICAgICAgICBmb3Igcm9sZV9pZCBpbiBtYXAoaW50LCByb2xlX21lbnRpb25zKToKICAgICAgICAgICAgICAgIHJvbGUgPSBzZWxmLmd1aWxkLmdldF9yb2xlKHJvbGVfaWQpCiAgICAgICAgICAgICAgICBpZiByb2xlIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHNlbGYucm9sZV9tZW50aW9ucy5hcHBlbmQocm9sZSkKCiAgICBkZWYgX2hhbmRsZV9jYWxsKHNlbGYsIGNhbGwpOgogICAgICAgIGlmIGNhbGwgaXMgTm9uZSBvciBzZWxmLnR5cGUgaXMgbm90IE1lc3NhZ2VUeXBlLmNhbGw6CiAgICAgICAgICAgIHNlbGYuY2FsbCA9IE5vbmUKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICMgd2UgZ2V0IHRoZSBwYXJ0aWNpcGFudCBzb3VyY2UgZnJvbSB0aGUgbWVudGlvbnMgYXJyYXkgb3IKICAgICAgICAjIHRoZSBhdXRob3IKCiAgICAgICAgcGFydGljaXBhbnRzID0gW10KICAgICAgICBmb3IgdWlkIGluIG1hcChpbnQsIGNhbGwuZ2V0KCdwYXJ0aWNpcGFudHMnLCBbXSkpOgogICAgICAgICAgICBpZiB1aWQgPT0gc2VsZi5hdXRob3IuaWQ6CiAgICAgICAgICAgICAgICBwYXJ0aWNpcGFudHMuYXBwZW5kKHNlbGYuYXV0aG9yKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdXNlciA9IHV0aWxzLmZpbmQobGFtYmRhIHU6IHUuaWQgPT0gdWlkLCBzZWxmLm1lbnRpb25zKQogICAgICAgICAgICAgICAgaWYgdXNlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBwYXJ0aWNpcGFudHMuYXBwZW5kKHVzZXIpCgogICAgICAgIGNhbGxbJ3BhcnRpY2lwYW50cyddID0gcGFydGljaXBhbnRzCiAgICAgICAgc2VsZi5jYWxsID0gQ2FsbE1lc3NhZ2UobWVzc2FnZT1zZWxmLCAqKmNhbGwpCgogICAgZGVmIF9yZWJpbmRfY2hhbm5lbF9yZWZlcmVuY2Uoc2VsZiwgbmV3X2NoYW5uZWwpOgogICAgICAgIHNlbGYuY2hhbm5lbCA9IG5ld19jaGFubmVsCgogICAgICAgIHRyeToKICAgICAgICAgICAgZGVsIHNlbGYuX2NzX2d1aWxkCiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICAgICBwYXNzCgogICAgQHV0aWxzLmNhY2hlZF9zbG90X3Byb3BlcnR5KCdfY3NfZ3VpbGQnKQogICAgZGVmIGd1aWxkKHNlbGYpOgogICAgICAgICIiIk9wdGlvbmFsWzpjbGFzczpgR3VpbGRgXTogVGhlIGd1aWxkIHRoYXQgdGhlIG1lc3NhZ2UgYmVsb25ncyB0bywgaWYgYXBwbGljYWJsZS4iIiIKICAgICAgICByZXR1cm4gZ2V0YXR0cihzZWxmLmNoYW5uZWwsICdndWlsZCcsIE5vbmUpCgogICAgQHV0aWxzLmNhY2hlZF9zbG90X3Byb3BlcnR5KCdfY3NfcmF3X21lbnRpb25zJykKICAgIGRlZiByYXdfbWVudGlvbnMoc2VsZik6CiAgICAgICAgIiIiTGlzdFs6Y2xhc3M6YGludGBdOiBBIHByb3BlcnR5IHRoYXQgcmV0dXJucyBhbiBhcnJheSBvZiB1c2VyIElEcyBtYXRjaGVkIHdpdGgKICAgICAgICB0aGUgc3ludGF4IG9mIGBgPEB1c2VyX2lkPmBgIGluIHRoZSBtZXNzYWdlIGNvbnRlbnQuCgogICAgICAgIFRoaXMgYWxsb3dzIHlvdSB0byByZWNlaXZlIHRoZSB1c2VyIElEcyBvZiBtZW50aW9uZWQgdXNlcnMKICAgICAgICBldmVuIGluIGEgcHJpdmF0ZSBtZXNzYWdlIGNvbnRleHQuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIFtpbnQoeCkgZm9yIHggaW4gcmUuZmluZGFsbChyJzxAIT8oWzAtOV0rKT4nLCBzZWxmLmNvbnRlbnQpXQoKICAgIEB1dGlscy5jYWNoZWRfc2xvdF9wcm9wZXJ0eSgnX2NzX3Jhd19jaGFubmVsX21lbnRpb25zJykKICAgIGRlZiByYXdfY2hhbm5lbF9tZW50aW9ucyhzZWxmKToKICAgICAgICAiIiJMaXN0WzpjbGFzczpgaW50YF06IEEgcHJvcGVydHkgdGhhdCByZXR1cm5zIGFuIGFycmF5IG9mIGNoYW5uZWwgSURzIG1hdGNoZWQgd2l0aAogICAgICAgIHRoZSBzeW50YXggb2YgYGA8I2NoYW5uZWxfaWQ+YGAgaW4gdGhlIG1lc3NhZ2UgY29udGVudC4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gW2ludCh4KSBmb3IgeCBpbiByZS5maW5kYWxsKHInPCMoWzAtOV0rKT4nLCBzZWxmLmNvbnRlbnQpXQoKICAgIEB1dGlscy5jYWNoZWRfc2xvdF9wcm9wZXJ0eSgnX2NzX3Jhd19yb2xlX21lbnRpb25zJykKICAgIGRlZiByYXdfcm9sZV9tZW50aW9ucyhzZWxmKToKICAgICAgICAiIiJMaXN0WzpjbGFzczpgaW50YF06IEEgcHJvcGVydHkgdGhhdCByZXR1cm5zIGFuIGFycmF5IG9mIHJvbGUgSURzIG1hdGNoZWQgd2l0aAogICAgICAgIHRoZSBzeW50YXggb2YgYGA8QCZyb2xlX2lkPmBgIGluIHRoZSBtZXNzYWdlIGNvbnRlbnQuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIFtpbnQoeCkgZm9yIHggaW4gcmUuZmluZGFsbChyJzxAJihbMC05XSspPicsIHNlbGYuY29udGVudCldCgogICAgQHV0aWxzLmNhY2hlZF9zbG90X3Byb3BlcnR5KCdfY3NfY2hhbm5lbF9tZW50aW9ucycpCiAgICBkZWYgY2hhbm5lbF9tZW50aW9ucyhzZWxmKToKICAgICAgICBpZiBzZWxmLmd1aWxkIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgIGl0ID0gZmlsdGVyKE5vbmUsIG1hcChzZWxmLmd1aWxkLmdldF9jaGFubmVsLCBzZWxmLnJhd19jaGFubmVsX21lbnRpb25zKSkKICAgICAgICByZXR1cm4gdXRpbHMuX3VuaXF1ZShpdCkKCiAgICBAdXRpbHMuY2FjaGVkX3Nsb3RfcHJvcGVydHkoJ19jc19jbGVhbl9jb250ZW50JykKICAgIGRlZiBjbGVhbl9jb250ZW50KHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgc3RyYDogQSBwcm9wZXJ0eSB0aGF0IHJldHVybnMgdGhlIGNvbnRlbnQgaW4gYSAiY2xlYW5lZCB1cCIKICAgICAgICBtYW5uZXIuIFRoaXMgYmFzaWNhbGx5IG1lYW5zIHRoYXQgbWVudGlvbnMgYXJlIHRyYW5zZm9ybWVkCiAgICAgICAgaW50byB0aGUgd2F5IHRoZSBjbGllbnQgc2hvd3MgaXQuIGUuZy4gYGA8I2lkPmBgIHdpbGwgdHJhbnNmb3JtCiAgICAgICAgaW50byBgYCNuYW1lYGAuCgogICAgICAgIFRoaXMgd2lsbCBhbHNvIHRyYW5zZm9ybSBAZXZlcnlvbmUgYW5kIEBoZXJlIG1lbnRpb25zIGludG8KICAgICAgICBub24tbWVudGlvbnMuCgogICAgICAgIC4uIG5vdGU6OgoKICAgICAgICAgICAgVGhpcyAqZG9lcyBub3QqIGFmZmVjdCBtYXJrZG93bi4gSWYgeW91IHdhbnQgdG8gZXNjYXBlCiAgICAgICAgICAgIG9yIHJlbW92ZSBtYXJrZG93biB0aGVuIHVzZSA6ZnVuYzpgdXRpbHMuZXNjYXBlX21hcmtkb3duYCBvciA6ZnVuYzpgdXRpbHMucmVtb3ZlX21hcmtkb3duYCAKICAgICAgICAgICAgcmVzcGVjdGl2ZWx5LCBhbG9uZyB3aXRoIHRoaXMgZnVuY3Rpb24uCiAgICAgICAgIiIiCgogICAgICAgIHRyYW5zZm9ybWF0aW9ucyA9IHsKICAgICAgICAgICAgcmUuZXNjYXBlKCc8IyVzPicgJSBjaGFubmVsLmlkKTogJyMnICsgY2hhbm5lbC5uYW1lCiAgICAgICAgICAgIGZvciBjaGFubmVsIGluIHNlbGYuY2hhbm5lbF9tZW50aW9ucwogICAgICAgIH0KCiAgICAgICAgbWVudGlvbl90cmFuc2Zvcm1zID0gewogICAgICAgICAgICByZS5lc2NhcGUoJzxAJXM+JyAlIG1lbWJlci5pZCk6ICdAJyArIG1lbWJlci5kaXNwbGF5X25hbWUKICAgICAgICAgICAgZm9yIG1lbWJlciBpbiBzZWxmLm1lbnRpb25zCiAgICAgICAgfQoKICAgICAgICAjIGFkZCB0aGUgPEAhdXNlcl9pZD4gY2FzZXMgYXMgd2VsbC4uCiAgICAgICAgc2Vjb25kX21lbnRpb25fdHJhbnNmb3JtcyA9IHsKICAgICAgICAgICAgcmUuZXNjYXBlKCc8QCElcz4nICUgbWVtYmVyLmlkKTogJ0AnICsgbWVtYmVyLmRpc3BsYXlfbmFtZQogICAgICAgICAgICBmb3IgbWVtYmVyIGluIHNlbGYubWVudGlvbnMKICAgICAgICB9CgogICAgICAgIHRyYW5zZm9ybWF0aW9ucy51cGRhdGUobWVudGlvbl90cmFuc2Zvcm1zKQogICAgICAgIHRyYW5zZm9ybWF0aW9ucy51cGRhdGUoc2Vjb25kX21lbnRpb25fdHJhbnNmb3JtcykKCiAgICAgICAgaWYgc2VsZi5ndWlsZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcm9sZV90cmFuc2Zvcm1zID0gewogICAgICAgICAgICAgICAgcmUuZXNjYXBlKCc8QCYlcz4nICUgcm9sZS5pZCk6ICdAJyArIHJvbGUubmFtZQogICAgICAgICAgICAgICAgZm9yIHJvbGUgaW4gc2VsZi5yb2xlX21lbnRpb25zCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJhbnNmb3JtYXRpb25zLnVwZGF0ZShyb2xlX3RyYW5zZm9ybXMpCgogICAgICAgIGRlZiByZXBsKG9iaik6CiAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm1hdGlvbnMuZ2V0KHJlLmVzY2FwZShvYmouZ3JvdXAoMCkpLCAnJykKCiAgICAgICAgcGF0dGVybiA9IHJlLmNvbXBpbGUoJ3wnLmpvaW4odHJhbnNmb3JtYXRpb25zLmtleXMoKSkpCiAgICAgICAgcmVzdWx0ID0gcGF0dGVybi5zdWIocmVwbCwgc2VsZi5jb250ZW50KQogICAgICAgIHJldHVybiBlc2NhcGVfbWVudGlvbnMocmVzdWx0KQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNyZWF0ZWRfYXQoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBkYXRldGltZS5kYXRldGltZWA6IFRoZSBtZXNzYWdlJ3MgY3JlYXRpb24gdGltZSBpbiBVVEMuIiIiCiAgICAgICAgcmV0dXJuIHV0aWxzLnNub3dmbGFrZV90aW1lKHNlbGYuaWQpCgogICAgQHByb3BlcnR5CiAgICBkZWYgZWRpdGVkX2F0KHNlbGYpOgogICAgICAgICIiIk9wdGlvbmFsWzpjbGFzczpgZGF0ZXRpbWUuZGF0ZXRpbWVgXTogQSBuYWl2ZSBVVEMgZGF0ZXRpbWUgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGVkaXRlZCB0aW1lIG9mIHRoZSBtZXNzYWdlLiIiIgogICAgICAgIHJldHVybiBzZWxmLl9lZGl0ZWRfdGltZXN0YW1wCgogICAgQHByb3BlcnR5CiAgICBkZWYganVtcF91cmwoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBzdHJgOiBSZXR1cm5zIGEgVVJMIHRoYXQgYWxsb3dzIHRoZSBjbGllbnQgdG8ganVtcCB0byB0aGlzIG1lc3NhZ2UuIiIiCiAgICAgICAgZ3VpbGRfaWQgPSBnZXRhdHRyKHNlbGYuZ3VpbGQsICdpZCcsICdAbWUnKQogICAgICAgIHJldHVybiAnaHR0cHM6Ly9kaXNjb3JkLmNvbS9jaGFubmVscy97MH0vezEuY2hhbm5lbC5pZH0vezEuaWR9Jy5mb3JtYXQoZ3VpbGRfaWQsIHNlbGYpCgogICAgZGVmIGlzX3N5c3RlbShzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGJvb2xgOiBXaGV0aGVyIHRoZSBtZXNzYWdlIGlzIGEgc3lzdGVtIG1lc3NhZ2UuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuMwogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLnR5cGUgaXMgbm90IE1lc3NhZ2VUeXBlLmRlZmF1bHQKCiAgICBAdXRpbHMuY2FjaGVkX3Nsb3RfcHJvcGVydHkoJ19jc19zeXN0ZW1fY29udGVudCcpCiAgICBkZWYgc3lzdGVtX2NvbnRlbnQoc2VsZik6CiAgICAgICAgciIiIjpjbGFzczpgc3RyYDogQSBwcm9wZXJ0eSB0aGF0IHJldHVybnMgdGhlIGNvbnRlbnQgdGhhdCBpcyByZW5kZXJlZAogICAgICAgIHJlZ2FyZGxlc3Mgb2YgdGhlIDphdHRyOmBNZXNzYWdlLnR5cGVgLgoKICAgICAgICBJbiB0aGUgY2FzZSBvZiA6YXR0cjpgTWVzc2FnZVR5cGUuZGVmYXVsdGBcLCB0aGlzIGp1c3QgcmV0dXJucyB0aGUKICAgICAgICByZWd1bGFyIDphdHRyOmBNZXNzYWdlLmNvbnRlbnRgLiBPdGhlcndpc2UgdGhpcyByZXR1cm5zIGFuIEVuZ2xpc2gKICAgICAgICBtZXNzYWdlIGRlbm90aW5nIHRoZSBjb250ZW50cyBvZiB0aGUgc3lzdGVtIG1lc3NhZ2UuCiAgICAgICAgIiIiCgogICAgICAgIGlmIHNlbGYudHlwZSBpcyBNZXNzYWdlVHlwZS5kZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gc2VsZi5jb250ZW50CgogICAgICAgIGlmIHNlbGYudHlwZSBpcyBNZXNzYWdlVHlwZS5waW5zX2FkZDoKICAgICAgICAgICAgcmV0dXJuICd7MC5uYW1lfSBwaW5uZWQgYSBtZXNzYWdlIHRvIHRoaXMgY2hhbm5lbC4nLmZvcm1hdChzZWxmLmF1dGhvcikKCiAgICAgICAgaWYgc2VsZi50eXBlIGlzIE1lc3NhZ2VUeXBlLnJlY2lwaWVudF9hZGQ6CiAgICAgICAgICAgIHJldHVybiAnezAubmFtZX0gYWRkZWQgezEubmFtZX0gdG8gdGhlIGdyb3VwLicuZm9ybWF0KHNlbGYuYXV0aG9yLCBzZWxmLm1lbnRpb25zWzBdKQoKICAgICAgICBpZiBzZWxmLnR5cGUgaXMgTWVzc2FnZVR5cGUucmVjaXBpZW50X3JlbW92ZToKICAgICAgICAgICAgcmV0dXJuICd7MC5uYW1lfSByZW1vdmVkIHsxLm5hbWV9IGZyb20gdGhlIGdyb3VwLicuZm9ybWF0KHNlbGYuYXV0aG9yLCBzZWxmLm1lbnRpb25zWzBdKQoKICAgICAgICBpZiBzZWxmLnR5cGUgaXMgTWVzc2FnZVR5cGUuY2hhbm5lbF9uYW1lX2NoYW5nZToKICAgICAgICAgICAgcmV0dXJuICd7MC5hdXRob3IubmFtZX0gY2hhbmdlZCB0aGUgY2hhbm5lbCBuYW1lOiB7MC5jb250ZW50fScuZm9ybWF0KHNlbGYpCgogICAgICAgIGlmIHNlbGYudHlwZSBpcyBNZXNzYWdlVHlwZS5jaGFubmVsX2ljb25fY2hhbmdlOgogICAgICAgICAgICByZXR1cm4gJ3swLmF1dGhvci5uYW1lfSBjaGFuZ2VkIHRoZSBjaGFubmVsIGljb24uJy5mb3JtYXQoc2VsZikKCiAgICAgICAgaWYgc2VsZi50eXBlIGlzIE1lc3NhZ2VUeXBlLm5ld19tZW1iZXI6CiAgICAgICAgICAgIGZvcm1hdHMgPSBbCiAgICAgICAgICAgICAgICAiezB9IGpvaW5lZCB0aGUgcGFydHkuIiwKICAgICAgICAgICAgICAgICJ7MH0gaXMgaGVyZS4iLAogICAgICAgICAgICAgICAgIldlbGNvbWUsIHswfS4gV2UgaG9wZSB5b3UgYnJvdWdodCBwaXp6YS4iLAogICAgICAgICAgICAgICAgIkEgd2lsZCB7MH0gYXBwZWFyZWQuIiwKICAgICAgICAgICAgICAgICJ7MH0ganVzdCBsYW5kZWQuIiwKICAgICAgICAgICAgICAgICJ7MH0ganVzdCBzbGlkIGludG8gdGhlIHNlcnZlci4iLAogICAgICAgICAgICAgICAgInswfSBqdXN0IHNob3dlZCB1cCEiLAogICAgICAgICAgICAgICAgIldlbGNvbWUgezB9LiBTYXkgaGkhIiwKICAgICAgICAgICAgICAgICJ7MH0gaG9wcGVkIGludG8gdGhlIHNlcnZlci4iLAogICAgICAgICAgICAgICAgIkV2ZXJ5b25lIHdlbGNvbWUgezB9ISIsCiAgICAgICAgICAgICAgICAiR2xhZCB5b3UncmUgaGVyZSwgezB9LiIsCiAgICAgICAgICAgICAgICAiR29vZCB0byBzZWUgeW91LCB7MH0uIiwKICAgICAgICAgICAgICAgICJZYXkgeW91IG1hZGUgaXQsIHswfSEiLAogICAgICAgICAgICBdCgogICAgICAgICAgICAjIG1hbnVhbGx5IHJlY29uc3RydWN0IHRoZSBlcG9jaCB3aXRoIG1pbGxpc2Vjb25kIHByZWNpc2lvbiwgYmVjYXVzZQogICAgICAgICAgICAjIGRhdGV0aW1lLmRhdGV0aW1lLnRpbWVzdGFtcCgpIGRvZXNuJ3QgcmV0dXJuIHRoZSBleGFjdCBwb3NpeAogICAgICAgICAgICAjIHRpbWVzdGFtcCB3aXRoIHRoZSBwcmVjaXNpb24gdGhhdCB3ZSBuZWVkCiAgICAgICAgICAgIGNyZWF0ZWRfYXRfbXMgPSBpbnQoKHNlbGYuY3JlYXRlZF9hdCAtIGRhdGV0aW1lLmRhdGV0aW1lKDE5NzAsIDEsIDEpKS50b3RhbF9zZWNvbmRzKCkgKiAxMDAwKQogICAgICAgICAgICByZXR1cm4gZm9ybWF0c1tjcmVhdGVkX2F0X21zICUgbGVuKGZvcm1hdHMpXS5mb3JtYXQoc2VsZi5hdXRob3IubmFtZSkKCiAgICAgICAgaWYgc2VsZi50eXBlIGlzIE1lc3NhZ2VUeXBlLmNhbGw6CiAgICAgICAgICAgICMgd2UncmUgYXQgdGhlIGNhbGwgbWVzc2FnZSB0eXBlIG5vdywgd2hpY2ggaXMgYSBiaXQgbW9yZSBjb21wbGljYXRlZC4KICAgICAgICAgICAgIyB3ZSBjYW4gbWFrZSB0aGUgYXNzdW1wdGlvbiB0aGF0IE1lc3NhZ2UuY2hhbm5lbCBpcyBhIFByaXZhdGVDaGFubmVsCiAgICAgICAgICAgICMgd2l0aCB0aGUgdHlwZSBDaGFubmVsVHlwZS5ncm91cCBvciBDaGFubmVsVHlwZS5wcml2YXRlCiAgICAgICAgICAgIGNhbGxfZW5kZWQgPSBzZWxmLmNhbGwuZW5kZWRfdGltZXN0YW1wIGlzIG5vdCBOb25lCgogICAgICAgICAgICBpZiBzZWxmLmNoYW5uZWwubWUgaW4gc2VsZi5jYWxsLnBhcnRpY2lwYW50czoKICAgICAgICAgICAgICAgIHJldHVybiAnezAuYXV0aG9yLm5hbWV9IHN0YXJ0ZWQgYSBjYWxsLicuZm9ybWF0KHNlbGYpCiAgICAgICAgICAgIGVsaWYgY2FsbF9lbmRlZDoKICAgICAgICAgICAgICAgIHJldHVybiAnWW91IG1pc3NlZCBhIGNhbGwgZnJvbSB7MC5hdXRob3IubmFtZX0nLmZvcm1hdChzZWxmKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuICd7MC5hdXRob3IubmFtZX0gc3RhcnRlZCBhIGNhbGwgXE57RU0gREFTSH0gSm9pbiB0aGUgY2FsbC4nLmZvcm1hdChzZWxmKQoKICAgICAgICBpZiBzZWxmLnR5cGUgaXMgTWVzc2FnZVR5cGUucHJlbWl1bV9ndWlsZF9zdWJzY3JpcHRpb246CiAgICAgICAgICAgIHJldHVybiAnezAuYXV0aG9yLm5hbWV9IGp1c3QgYm9vc3RlZCB0aGUgc2VydmVyIScuZm9ybWF0KHNlbGYpCgogICAgICAgIGlmIHNlbGYudHlwZSBpcyBNZXNzYWdlVHlwZS5wcmVtaXVtX2d1aWxkX3RpZXJfMToKICAgICAgICAgICAgcmV0dXJuICd7MC5hdXRob3IubmFtZX0ganVzdCBib29zdGVkIHRoZSBzZXJ2ZXIhIHswLmd1aWxkfSBoYXMgYWNoaWV2ZWQgKipMZXZlbCAxISoqJy5mb3JtYXQoc2VsZikKCiAgICAgICAgaWYgc2VsZi50eXBlIGlzIE1lc3NhZ2VUeXBlLnByZW1pdW1fZ3VpbGRfdGllcl8yOgogICAgICAgICAgICByZXR1cm4gJ3swLmF1dGhvci5uYW1lfSBqdXN0IGJvb3N0ZWQgdGhlIHNlcnZlciEgezAuZ3VpbGR9IGhhcyBhY2hpZXZlZCAqKkxldmVsIDIhKionLmZvcm1hdChzZWxmKQoKICAgICAgICBpZiBzZWxmLnR5cGUgaXMgTWVzc2FnZVR5cGUucHJlbWl1bV9ndWlsZF90aWVyXzM6CiAgICAgICAgICAgIHJldHVybiAnezAuYXV0aG9yLm5hbWV9IGp1c3QgYm9vc3RlZCB0aGUgc2VydmVyISB7MC5ndWlsZH0gaGFzIGFjaGlldmVkICoqTGV2ZWwgMyEqKicuZm9ybWF0KHNlbGYpCgogICAgICAgIGlmIHNlbGYudHlwZSBpcyBNZXNzYWdlVHlwZS5jaGFubmVsX2ZvbGxvd19hZGQ6CiAgICAgICAgICAgIHJldHVybiAnezAuYXV0aG9yLm5hbWV9IGhhcyBhZGRlZCB7MC5jb250ZW50fSB0byB0aGlzIGNoYW5uZWwnLmZvcm1hdChzZWxmKQoKICAgICAgICBpZiBzZWxmLnR5cGUgaXMgTWVzc2FnZVR5cGUuZ3VpbGRfc3RyZWFtOgogICAgICAgICAgICByZXR1cm4gJ3swLmF1dGhvci5uYW1lfSBpcyBsaXZlISBOb3cgc3RyZWFtaW5nIHswLmF1dGhvci5hY3Rpdml0eS5uYW1lfScuZm9ybWF0KHNlbGYpCgogICAgICAgIGlmIHNlbGYudHlwZSBpcyBNZXNzYWdlVHlwZS5ndWlsZF9kaXNjb3ZlcnlfZGlzcXVhbGlmaWVkOgogICAgICAgICAgICByZXR1cm4gJ1RoaXMgc2VydmVyIGhhcyBiZWVuIHJlbW92ZWQgZnJvbSBTZXJ2ZXIgRGlzY292ZXJ5IGJlY2F1c2UgaXQgbm8gbG9uZ2VyIHBhc3NlcyBhbGwgdGhlIHJlcXVpcmVtZW50cy4gQ2hlY2sgU2VydmVyIFNldHRpbmdzIGZvciBtb3JlIGRldGFpbHMuJwoKICAgICAgICBpZiBzZWxmLnR5cGUgaXMgTWVzc2FnZVR5cGUuZ3VpbGRfZGlzY292ZXJ5X3JlcXVhbGlmaWVkOgogICAgICAgICAgICByZXR1cm4gJ1RoaXMgc2VydmVyIGlzIGVsaWdpYmxlIGZvciBTZXJ2ZXIgRGlzY292ZXJ5IGFnYWluIGFuZCBoYXMgYmVlbiBhdXRvbWF0aWNhbGx5IHJlbGlzdGVkIScKCiAgICAgICAgaWYgc2VsZi50eXBlIGlzIE1lc3NhZ2VUeXBlLmd1aWxkX2Rpc2NvdmVyeV9ncmFjZV9wZXJpb2RfaW5pdGlhbF93YXJuaW5nOgogICAgICAgICAgICByZXR1cm4gJ1RoaXMgc2VydmVyIGhhcyBmYWlsZWQgRGlzY292ZXJ5IGFjdGl2aXR5IHJlcXVpcmVtZW50cyBmb3IgMSB3ZWVrLiBJZiB0aGlzIHNlcnZlciBmYWlscyBmb3IgNCB3ZWVrcyBpbiBhIHJvdywgaXQgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IHJlbW92ZWQgZnJvbSBEaXNjb3ZlcnkuJwoKICAgICAgICBpZiBzZWxmLnR5cGUgaXMgTWVzc2FnZVR5cGUuZ3VpbGRfZGlzY292ZXJ5X2dyYWNlX3BlcmlvZF9maW5hbF93YXJuaW5nOgogICAgICAgICAgICByZXR1cm4gJ1RoaXMgc2VydmVyIGhhcyBmYWlsZWQgRGlzY292ZXJ5IGFjdGl2aXR5IHJlcXVpcmVtZW50cyBmb3IgMyB3ZWVrcyBpbiBhIHJvdy4gSWYgdGhpcyBzZXJ2ZXIgZmFpbHMgZm9yIDEgbW9yZSB3ZWVrLCBpdCB3aWxsIGJlIHJlbW92ZWQgZnJvbSBEaXNjb3ZlcnkuJwoKICAgIGFzeW5jIGRlZiBkZWxldGUoc2VsZiwgKiwgZGVsYXk9Tm9uZSk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIERlbGV0ZXMgdGhlIG1lc3NhZ2UuCgogICAgICAgIFlvdXIgb3duIG1lc3NhZ2VzIGNvdWxkIGJlIGRlbGV0ZWQgd2l0aG91dCBhbnkgcHJvcGVyIHBlcm1pc3Npb25zLiBIb3dldmVyIHRvCiAgICAgICAgZGVsZXRlIG90aGVyIHBlb3BsZSdzIG1lc3NhZ2VzLCB5b3UgbmVlZCB0aGUgOmF0dHI6YH5QZXJtaXNzaW9ucy5tYW5hZ2VfbWVzc2FnZXNgCiAgICAgICAgcGVybWlzc2lvbi4KCiAgICAgICAgLi4gdmVyc2lvbmNoYW5nZWQ6OiAxLjEKICAgICAgICAgICAgQWRkZWQgdGhlIG5ldyBgYGRlbGF5YGAga2V5d29yZC1vbmx5IHBhcmFtZXRlci4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgZGVsYXk6IE9wdGlvbmFsWzpjbGFzczpgZmxvYXRgXQogICAgICAgICAgICBJZiBwcm92aWRlZCwgdGhlIG51bWJlciBvZiBzZWNvbmRzIHRvIHdhaXQgaW4gdGhlIGJhY2tncm91bmQKICAgICAgICAgICAgYmVmb3JlIGRlbGV0aW5nIHRoZSBtZXNzYWdlLiBJZiB0aGUgZGVsZXRpb24gZmFpbHMgdGhlbiBpdCBpcyBzaWxlbnRseSBpZ25vcmVkLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0KICAgICAgICBGb3JiaWRkZW4KICAgICAgICAgICAgWW91IGRvIG5vdCBoYXZlIHByb3BlciBwZXJtaXNzaW9ucyB0byBkZWxldGUgdGhlIG1lc3NhZ2UuCiAgICAgICAgTm90Rm91bmQKICAgICAgICAgICAgVGhlIG1lc3NhZ2Ugd2FzIGRlbGV0ZWQgYWxyZWFkeQogICAgICAgIEhUVFBFeGNlcHRpb24KICAgICAgICAgICAgRGVsZXRpbmcgdGhlIG1lc3NhZ2UgZmFpbGVkLgogICAgICAgICIiIgogICAgICAgIGlmIGRlbGF5IGlzIG5vdCBOb25lOgogICAgICAgICAgICBhc3luYyBkZWYgZGVsZXRlKCk6CiAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKGRlbGF5KQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuX3N0YXRlLmh0dHAuZGVsZXRlX21lc3NhZ2Uoc2VsZi5jaGFubmVsLmlkLCBzZWxmLmlkKQogICAgICAgICAgICAgICAgZXhjZXB0IEhUVFBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICAgICAgYXN5bmNpby5lbnN1cmVfZnV0dXJlKGRlbGV0ZSgpLCBsb29wPXNlbGYuX3N0YXRlLmxvb3ApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXdhaXQgc2VsZi5fc3RhdGUuaHR0cC5kZWxldGVfbWVzc2FnZShzZWxmLmNoYW5uZWwuaWQsIHNlbGYuaWQpCgogICAgYXN5bmMgZGVmIGVkaXQoc2VsZiwgKipmaWVsZHMpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBFZGl0cyB0aGUgbWVzc2FnZS4KCiAgICAgICAgVGhlIGNvbnRlbnQgbXVzdCBiZSBhYmxlIHRvIGJlIHRyYW5zZm9ybWVkIGludG8gYSBzdHJpbmcgdmlhIGBgc3RyKGNvbnRlbnQpYGAuCgogICAgICAgIC4uIHZlcnNpb25jaGFuZ2VkOjogMS4zCiAgICAgICAgICAgIFRoZSBgYHN1cHByZXNzYGAga2V5d29yZC1vbmx5IHBhcmFtZXRlciB3YXMgYWRkZWQuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIGNvbnRlbnQ6IE9wdGlvbmFsWzpjbGFzczpgc3RyYF0KICAgICAgICAgICAgVGhlIG5ldyBjb250ZW50IHRvIHJlcGxhY2UgdGhlIG1lc3NhZ2Ugd2l0aC4KICAgICAgICAgICAgQ291bGQgYmUgYGBOb25lYGAgdG8gcmVtb3ZlIHRoZSBjb250ZW50LgogICAgICAgIGVtYmVkOiBPcHRpb25hbFs6Y2xhc3M6YEVtYmVkYF0KICAgICAgICAgICAgVGhlIG5ldyBlbWJlZCB0byByZXBsYWNlIHRoZSBvcmlnaW5hbCB3aXRoLgogICAgICAgICAgICBDb3VsZCBiZSBgYE5vbmVgYCB0byByZW1vdmUgdGhlIGVtYmVkLgogICAgICAgIHN1cHByZXNzOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgdG8gc3VwcHJlc3MgZW1iZWRzIGZvciB0aGUgbWVzc2FnZS4gVGhpcyByZW1vdmVzCiAgICAgICAgICAgIGFsbCB0aGUgZW1iZWRzIGlmIHNldCB0byBgYFRydWVgYC4gSWYgc2V0IHRvIGBgRmFsc2VgYAogICAgICAgICAgICB0aGlzIGJyaW5ncyB0aGUgZW1iZWRzIGJhY2sgaWYgdGhleSB3ZXJlIHN1cHByZXNzZWQuCiAgICAgICAgICAgIFVzaW5nIHRoaXMgcGFyYW1ldGVyIHJlcXVpcmVzIDphdHRyOmB+LlBlcm1pc3Npb25zLm1hbmFnZV9tZXNzYWdlc2AuCiAgICAgICAgZGVsZXRlX2FmdGVyOiBPcHRpb25hbFs6Y2xhc3M6YGZsb2F0YF0KICAgICAgICAgICAgSWYgcHJvdmlkZWQsIHRoZSBudW1iZXIgb2Ygc2Vjb25kcyB0byB3YWl0IGluIHRoZSBiYWNrZ3JvdW5kCiAgICAgICAgICAgIGJlZm9yZSBkZWxldGluZyB0aGUgbWVzc2FnZSB3ZSBqdXN0IGVkaXRlZC4gSWYgdGhlIGRlbGV0aW9uIGZhaWxzLAogICAgICAgICAgICB0aGVuIGl0IGlzIHNpbGVudGx5IGlnbm9yZWQuCiAgICAgICAgYWxsb3dlZF9tZW50aW9uczogT3B0aW9uYWxbOmNsYXNzOmB+ZGlzY29yZC5BbGxvd2VkTWVudGlvbnNgXQogICAgICAgICAgICBDb250cm9scyB0aGUgbWVudGlvbnMgYmVpbmcgcHJvY2Vzc2VkIGluIHRoaXMgbWVzc2FnZS4gSWYgdGhpcyBpcwogICAgICAgICAgICBwYXNzZWQsIHRoZW4gdGhlIG9iamVjdCBpcyBtZXJnZWQgd2l0aCA6YXR0cjpgfmRpc2NvcmQuQ2xpZW50LmFsbG93ZWRfbWVudGlvbnNgLgogICAgICAgICAgICBUaGUgbWVyZ2luZyBiZWhhdmlvdXIgb25seSBvdmVycmlkZXMgYXR0cmlidXRlcyB0aGF0IGhhdmUgYmVlbiBleHBsaWNpdGx5IHBhc3NlZAogICAgICAgICAgICB0byB0aGUgb2JqZWN0LCBvdGhlcndpc2UgaXQgdXNlcyB0aGUgYXR0cmlidXRlcyBzZXQgaW4gOmF0dHI6YH5kaXNjb3JkLkNsaWVudC5hbGxvd2VkX21lbnRpb25zYC4KICAgICAgICAgICAgSWYgbm8gb2JqZWN0IGlzIHBhc3NlZCBhdCBhbGwgdGhlbiB0aGUgZGVmYXVsdHMgZ2l2ZW4gYnkgOmF0dHI6YH5kaXNjb3JkLkNsaWVudC5hbGxvd2VkX21lbnRpb25zYAogICAgICAgICAgICBhcmUgdXNlZCBpbnN0ZWFkLgoKICAgICAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS40CgogICAgICAgIFJhaXNlcwogICAgICAgIC0tLS0tLS0KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIEVkaXRpbmcgdGhlIG1lc3NhZ2UgZmFpbGVkLgogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBUcmllZCB0byBzdXBwcmVzcyBhIG1lc3NhZ2Ugd2l0aG91dCBwZXJtaXNzaW9ucyBvcgogICAgICAgICAgICBlZGl0ZWQgYSBtZXNzYWdlJ3MgY29udGVudCBvciBlbWJlZCB0aGF0IGlzbid0IHlvdXJzLgogICAgICAgICIiIgoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbnRlbnQgPSBmaWVsZHNbJ2NvbnRlbnQnXQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGNvbnRlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBmaWVsZHNbJ2NvbnRlbnQnXSA9IHN0cihjb250ZW50KQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGVtYmVkID0gZmllbGRzWydlbWJlZCddCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgZW1iZWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBmaWVsZHNbJ2VtYmVkJ10gPSBlbWJlZC50b19kaWN0KCkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzdXBwcmVzcyA9IGZpZWxkcy5wb3AoJ3N1cHByZXNzJykKICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBlbHNlOgogICAgICAgICAgICAgZmxhZ3MgPSBNZXNzYWdlRmxhZ3MuX2Zyb21fdmFsdWUoc2VsZi5mbGFncy52YWx1ZSkKICAgICAgICAgICAgIGZsYWdzLnN1cHByZXNzX2VtYmVkcyA9IHN1cHByZXNzCiAgICAgICAgICAgICBmaWVsZHNbJ2ZsYWdzJ10gPSBmbGFncy52YWx1ZQoKICAgICAgICBkZWxldGVfYWZ0ZXIgPSBmaWVsZHMucG9wKCdkZWxldGVfYWZ0ZXInLCBOb25lKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGFsbG93ZWRfbWVudGlvbnMgPSBmaWVsZHMucG9wKCdhbGxvd2VkX21lbnRpb25zJykKICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBhbGxvd2VkX21lbnRpb25zIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgaWYgc2VsZi5fc3RhdGUuYWxsb3dlZF9tZW50aW9ucyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBhbGxvd2VkX21lbnRpb25zID0gc2VsZi5fc3RhdGUuYWxsb3dlZF9tZW50aW9ucy5tZXJnZShhbGxvd2VkX21lbnRpb25zKS50b19kaWN0KCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgYWxsb3dlZF9tZW50aW9ucyA9IGFsbG93ZWRfbWVudGlvbnMudG9fZGljdCgpCiAgICAgICAgICAgICAgICBmaWVsZHNbJ2FsbG93ZWRfbWVudGlvbnMnXSA9IGFsbG93ZWRfbWVudGlvbnMKCiAgICAgICAgaWYgZmllbGRzOgogICAgICAgICAgICBkYXRhID0gYXdhaXQgc2VsZi5fc3RhdGUuaHR0cC5lZGl0X21lc3NhZ2Uoc2VsZi5jaGFubmVsLmlkLCBzZWxmLmlkLCAqKmZpZWxkcykKICAgICAgICAgICAgc2VsZi5fdXBkYXRlKGRhdGEpCgogICAgICAgIGlmIGRlbGV0ZV9hZnRlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgYXdhaXQgc2VsZi5kZWxldGUoZGVsYXk9ZGVsZXRlX2FmdGVyKQoKICAgIGFzeW5jIGRlZiBwdWJsaXNoKHNlbGYpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBQdWJsaXNoZXMgdGhpcyBtZXNzYWdlIHRvIHlvdXIgYW5ub3VuY2VtZW50IGNoYW5uZWwuCgogICAgICAgIFlvdSBtdXN0IGhhdmUgdGhlIDphdHRyOmB+UGVybWlzc2lvbnMuc2VuZF9tZXNzYWdlc2AgcGVybWlzc2lvbiB0byBkbyB0aGlzLgoKICAgICAgICBJZiB0aGUgbWVzc2FnZSBpcyBub3QgeW91ciBvd24gdGhlbiB0aGUgOmF0dHI6YH5QZXJtaXNzaW9ucy5tYW5hZ2VfbWVzc2FnZXNgCiAgICAgICAgcGVybWlzc2lvbiBpcyBhbHNvIG5lZWRlZC4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBZb3UgZG8gbm90IGhhdmUgdGhlIHByb3BlciBwZXJtaXNzaW9ucyB0byBwdWJsaXNoIHRoaXMgbWVzc2FnZS4KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIFB1Ymxpc2hpbmcgdGhlIG1lc3NhZ2UgZmFpbGVkLgogICAgICAgICIiIgoKICAgICAgICBhd2FpdCBzZWxmLl9zdGF0ZS5odHRwLnB1Ymxpc2hfbWVzc2FnZShzZWxmLmNoYW5uZWwuaWQsIHNlbGYuaWQpCgogICAgYXN5bmMgZGVmIHBpbihzZWxmLCAqLCByZWFzb249Tm9uZSk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIFBpbnMgdGhlIG1lc3NhZ2UuCgogICAgICAgIFlvdSBtdXN0IGhhdmUgdGhlIDphdHRyOmB+UGVybWlzc2lvbnMubWFuYWdlX21lc3NhZ2VzYCBwZXJtaXNzaW9uIHRvIGRvCiAgICAgICAgdGhpcyBpbiBhIG5vbi1wcml2YXRlIGNoYW5uZWwgY29udGV4dC4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgcmVhc29uOiBPcHRpb25hbFs6Y2xhc3M6YHN0cmBdCiAgICAgICAgICAgIFRoZSByZWFzb24gZm9yIHBpbm5pbmcgdGhlIG1lc3NhZ2UuIFNob3dzIHVwIG9uIHRoZSBhdWRpdCBsb2cuCgogICAgICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjQKCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbnMgdG8gcGluIHRoZSBtZXNzYWdlLgogICAgICAgIE5vdEZvdW5kCiAgICAgICAgICAgIFRoZSBtZXNzYWdlIG9yIGNoYW5uZWwgd2FzIG5vdCBmb3VuZCBvciBkZWxldGVkLgogICAgICAgIEhUVFBFeGNlcHRpb24KICAgICAgICAgICAgUGlubmluZyB0aGUgbWVzc2FnZSBmYWlsZWQsIHByb2JhYmx5IGR1ZSB0byB0aGUgY2hhbm5lbAogICAgICAgICAgICBoYXZpbmcgbW9yZSB0aGFuIDUwIHBpbm5lZCBtZXNzYWdlcy4KICAgICAgICAiIiIKCiAgICAgICAgYXdhaXQgc2VsZi5fc3RhdGUuaHR0cC5waW5fbWVzc2FnZShzZWxmLmNoYW5uZWwuaWQsIHNlbGYuaWQsIHJlYXNvbj1yZWFzb24pCiAgICAgICAgc2VsZi5waW5uZWQgPSBUcnVlCgogICAgYXN5bmMgZGVmIHVucGluKHNlbGYsICosIHJlYXNvbj1Ob25lKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgVW5waW5zIHRoZSBtZXNzYWdlLgoKICAgICAgICBZb3UgbXVzdCBoYXZlIHRoZSA6YXR0cjpgflBlcm1pc3Npb25zLm1hbmFnZV9tZXNzYWdlc2AgcGVybWlzc2lvbiB0byBkbwogICAgICAgIHRoaXMgaW4gYSBub24tcHJpdmF0ZSBjaGFubmVsIGNvbnRleHQuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIHJlYXNvbjogT3B0aW9uYWxbOmNsYXNzOmBzdHJgXQogICAgICAgICAgICBUaGUgcmVhc29uIGZvciB1bnBpbm5pbmcgdGhlIG1lc3NhZ2UuIFNob3dzIHVwIG9uIHRoZSBhdWRpdCBsb2cuCgogICAgICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjQKCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbnMgdG8gdW5waW4gdGhlIG1lc3NhZ2UuCiAgICAgICAgTm90Rm91bmQKICAgICAgICAgICAgVGhlIG1lc3NhZ2Ugb3IgY2hhbm5lbCB3YXMgbm90IGZvdW5kIG9yIGRlbGV0ZWQuCiAgICAgICAgSFRUUEV4Y2VwdGlvbgogICAgICAgICAgICBVbnBpbm5pbmcgdGhlIG1lc3NhZ2UgZmFpbGVkLgogICAgICAgICIiIgoKICAgICAgICBhd2FpdCBzZWxmLl9zdGF0ZS5odHRwLnVucGluX21lc3NhZ2Uoc2VsZi5jaGFubmVsLmlkLCBzZWxmLmlkLCByZWFzb249cmVhc29uKQogICAgICAgIHNlbGYucGlubmVkID0gRmFsc2UKCiAgICBhc3luYyBkZWYgYWRkX3JlYWN0aW9uKHNlbGYsIGVtb2ppKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgQWRkIGEgcmVhY3Rpb24gdG8gdGhlIG1lc3NhZ2UuCgogICAgICAgIFRoZSBlbW9qaSBtYXkgYmUgYSB1bmljb2RlIGVtb2ppIG9yIGEgY3VzdG9tIGd1aWxkIDpjbGFzczpgRW1vamlgLgoKICAgICAgICBZb3UgbXVzdCBoYXZlIHRoZSA6YXR0cjpgflBlcm1pc3Npb25zLnJlYWRfbWVzc2FnZV9oaXN0b3J5YCBwZXJtaXNzaW9uCiAgICAgICAgdG8gdXNlIHRoaXMuIElmIG5vYm9keSBlbHNlIGhhcyByZWFjdGVkIHRvIHRoZSBtZXNzYWdlIHVzaW5nIHRoaXMKICAgICAgICBlbW9qaSwgdGhlIDphdHRyOmB+UGVybWlzc2lvbnMuYWRkX3JlYWN0aW9uc2AgcGVybWlzc2lvbiBpcyByZXF1aXJlZC4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tLQogICAgICAgIGVtb2ppOiBVbmlvbls6Y2xhc3M6YEVtb2ppYCwgOmNsYXNzOmBSZWFjdGlvbmAsIDpjbGFzczpgUGFydGlhbEVtb2ppYCwgOmNsYXNzOmBzdHJgXQogICAgICAgICAgICBUaGUgZW1vamkgdG8gcmVhY3Qgd2l0aC4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLS0KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIEFkZGluZyB0aGUgcmVhY3Rpb24gZmFpbGVkLgogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBZb3UgZG8gbm90IGhhdmUgdGhlIHByb3BlciBwZXJtaXNzaW9ucyB0byByZWFjdCB0byB0aGUgbWVzc2FnZS4KICAgICAgICBOb3RGb3VuZAogICAgICAgICAgICBUaGUgZW1vamkgeW91IHNwZWNpZmllZCB3YXMgbm90IGZvdW5kLgogICAgICAgIEludmFsaWRBcmd1bWVudAogICAgICAgICAgICBUaGUgZW1vamkgcGFyYW1ldGVyIGlzIGludmFsaWQuCiAgICAgICAgIiIiCgogICAgICAgIGVtb2ppID0gY29udmVydF9lbW9qaV9yZWFjdGlvbihlbW9qaSkKICAgICAgICBhd2FpdCBzZWxmLl9zdGF0ZS5odHRwLmFkZF9yZWFjdGlvbihzZWxmLmNoYW5uZWwuaWQsIHNlbGYuaWQsIGVtb2ppKQoKICAgIGFzeW5jIGRlZiByZW1vdmVfcmVhY3Rpb24oc2VsZiwgZW1vamksIG1lbWJlcik6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIFJlbW92ZSBhIHJlYWN0aW9uIGJ5IHRoZSBtZW1iZXIgZnJvbSB0aGUgbWVzc2FnZS4KCiAgICAgICAgVGhlIGVtb2ppIG1heSBiZSBhIHVuaWNvZGUgZW1vamkgb3IgYSBjdXN0b20gZ3VpbGQgOmNsYXNzOmBFbW9qaWAuCgogICAgICAgIElmIHRoZSByZWFjdGlvbiBpcyBub3QgeW91ciBvd24gKGkuZS4gYGBtZW1iZXJgYCBwYXJhbWV0ZXIgaXMgbm90IHlvdSkgdGhlbgogICAgICAgIHRoZSA6YXR0cjpgflBlcm1pc3Npb25zLm1hbmFnZV9tZXNzYWdlc2AgcGVybWlzc2lvbiBpcyBuZWVkZWQuCgogICAgICAgIFRoZSBgYG1lbWJlcmBgIHBhcmFtZXRlciBtdXN0IHJlcHJlc2VudCBhIG1lbWJlciBhbmQgbWVldAogICAgICAgIHRoZSA6Y2xhc3M6YGFiYy5Tbm93Zmxha2VgIGFiYy4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tLQogICAgICAgIGVtb2ppOiBVbmlvbls6Y2xhc3M6YEVtb2ppYCwgOmNsYXNzOmBSZWFjdGlvbmAsIDpjbGFzczpgUGFydGlhbEVtb2ppYCwgOmNsYXNzOmBzdHJgXQogICAgICAgICAgICBUaGUgZW1vamkgdG8gcmVtb3ZlLgogICAgICAgIG1lbWJlcjogOmNsYXNzOmBhYmMuU25vd2ZsYWtlYAogICAgICAgICAgICBUaGUgbWVtYmVyIGZvciB3aGljaCB0byByZW1vdmUgdGhlIHJlYWN0aW9uLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tLQogICAgICAgIEhUVFBFeGNlcHRpb24KICAgICAgICAgICAgUmVtb3ZpbmcgdGhlIHJlYWN0aW9uIGZhaWxlZC4KICAgICAgICBGb3JiaWRkZW4KICAgICAgICAgICAgWW91IGRvIG5vdCBoYXZlIHRoZSBwcm9wZXIgcGVybWlzc2lvbnMgdG8gcmVtb3ZlIHRoZSByZWFjdGlvbi4KICAgICAgICBOb3RGb3VuZAogICAgICAgICAgICBUaGUgbWVtYmVyIG9yIGVtb2ppIHlvdSBzcGVjaWZpZWQgd2FzIG5vdCBmb3VuZC4KICAgICAgICBJbnZhbGlkQXJndW1lbnQKICAgICAgICAgICAgVGhlIGVtb2ppIHBhcmFtZXRlciBpcyBpbnZhbGlkLgogICAgICAgICIiIgoKICAgICAgICBlbW9qaSA9IGNvbnZlcnRfZW1vamlfcmVhY3Rpb24oZW1vamkpCgogICAgICAgIGlmIG1lbWJlci5pZCA9PSBzZWxmLl9zdGF0ZS5zZWxmX2lkOgogICAgICAgICAgICBhd2FpdCBzZWxmLl9zdGF0ZS5odHRwLnJlbW92ZV9vd25fcmVhY3Rpb24oc2VsZi5jaGFubmVsLmlkLCBzZWxmLmlkLCBlbW9qaSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBhd2FpdCBzZWxmLl9zdGF0ZS5odHRwLnJlbW92ZV9yZWFjdGlvbihzZWxmLmNoYW5uZWwuaWQsIHNlbGYuaWQsIGVtb2ppLCBtZW1iZXIuaWQpCgogICAgYXN5bmMgZGVmIGNsZWFyX3JlYWN0aW9uKHNlbGYsIGVtb2ppKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgQ2xlYXJzIGEgc3BlY2lmaWMgcmVhY3Rpb24gZnJvbSB0aGUgbWVzc2FnZS4KCiAgICAgICAgVGhlIGVtb2ppIG1heSBiZSBhIHVuaWNvZGUgZW1vamkgb3IgYSBjdXN0b20gZ3VpbGQgOmNsYXNzOmBFbW9qaWAuCgogICAgICAgIFlvdSBuZWVkIHRoZSA6YXR0cjpgflBlcm1pc3Npb25zLm1hbmFnZV9tZXNzYWdlc2AgcGVybWlzc2lvbiB0byB1c2UgdGhpcy4KCiAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS4zCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIGVtb2ppOiBVbmlvbls6Y2xhc3M6YEVtb2ppYCwgOmNsYXNzOmBSZWFjdGlvbmAsIDpjbGFzczpgUGFydGlhbEVtb2ppYCwgOmNsYXNzOmBzdHJgXQogICAgICAgICAgICBUaGUgZW1vamkgdG8gY2xlYXIuCgogICAgICAgIFJhaXNlcwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgSFRUUEV4Y2VwdGlvbgogICAgICAgICAgICBDbGVhcmluZyB0aGUgcmVhY3Rpb24gZmFpbGVkLgogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBZb3UgZG8gbm90IGhhdmUgdGhlIHByb3BlciBwZXJtaXNzaW9ucyB0byBjbGVhciB0aGUgcmVhY3Rpb24uCiAgICAgICAgTm90Rm91bmQKICAgICAgICAgICAgVGhlIGVtb2ppIHlvdSBzcGVjaWZpZWQgd2FzIG5vdCBmb3VuZC4KICAgICAgICBJbnZhbGlkQXJndW1lbnQKICAgICAgICAgICAgVGhlIGVtb2ppIHBhcmFtZXRlciBpcyBpbnZhbGlkLgogICAgICAgICIiIgoKICAgICAgICBlbW9qaSA9IGNvbnZlcnRfZW1vamlfcmVhY3Rpb24oZW1vamkpCiAgICAgICAgYXdhaXQgc2VsZi5fc3RhdGUuaHR0cC5jbGVhcl9zaW5nbGVfcmVhY3Rpb24oc2VsZi5jaGFubmVsLmlkLCBzZWxmLmlkLCBlbW9qaSkKCiAgICBhc3luYyBkZWYgY2xlYXJfcmVhY3Rpb25zKHNlbGYpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBSZW1vdmVzIGFsbCB0aGUgcmVhY3Rpb25zIGZyb20gdGhlIG1lc3NhZ2UuCgogICAgICAgIFlvdSBuZWVkIHRoZSA6YXR0cjpgflBlcm1pc3Npb25zLm1hbmFnZV9tZXNzYWdlc2AgcGVybWlzc2lvbiB0byB1c2UgdGhpcy4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLS0KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIFJlbW92aW5nIHRoZSByZWFjdGlvbnMgZmFpbGVkLgogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBZb3UgZG8gbm90IGhhdmUgdGhlIHByb3BlciBwZXJtaXNzaW9ucyB0byByZW1vdmUgYWxsIHRoZSByZWFjdGlvbnMuCiAgICAgICAgIiIiCiAgICAgICAgYXdhaXQgc2VsZi5fc3RhdGUuaHR0cC5jbGVhcl9yZWFjdGlvbnMoc2VsZi5jaGFubmVsLmlkLCBzZWxmLmlkKQoKICAgIEB1dGlscy5kZXByZWNhdGVkKCkKICAgIGFzeW5jIGRlZiBhY2soc2VsZik6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIE1hcmtzIHRoaXMgbWVzc2FnZSBhcyByZWFkLgoKICAgICAgICBUaGUgdXNlciBtdXN0IG5vdCBiZSBhIGJvdCB1c2VyLgoKICAgICAgICAuLiBkZXByZWNhdGVkOjogMS43CgogICAgICAgIFJhaXNlcwogICAgICAgIC0tLS0tLS0KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIEFja2luZyBmYWlsZWQuCiAgICAgICAgQ2xpZW50RXhjZXB0aW9uCiAgICAgICAgICAgIFlvdSBtdXN0IG5vdCBiZSBhIGJvdCB1c2VyLgogICAgICAgICIiIgoKICAgICAgICBzdGF0ZSA9IHNlbGYuX3N0YXRlCiAgICAgICAgaWYgc3RhdGUuaXNfYm90OgogICAgICAgICAgICByYWlzZSBDbGllbnRFeGNlcHRpb24oJ011c3Qgbm90IGJlIGEgYm90IGFjY291bnQgdG8gYWNrIG1lc3NhZ2VzLicpCiAgICAgICAgcmV0dXJuIGF3YWl0IHN0YXRlLmh0dHAuYWNrX21lc3NhZ2Uoc2VsZi5jaGFubmVsLmlkLCBzZWxmLmlkKQoKICAgIGFzeW5jIGRlZiByZXBseShzZWxmLCBjb250ZW50PU5vbmUsICoqa3dhcmdzKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgQSBzaG9ydGN1dCBtZXRob2QgdG8gOm1ldGg6YC5hYmMuTWVzc2FnZWFibGUuc2VuZGAgdG8gcmVwbHkgdG8gdGhlCiAgICAgICAgOmNsYXNzOmAuTWVzc2FnZWAuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tLQogICAgICAgIH5kaXNjb3JkLkhUVFBFeGNlcHRpb24KICAgICAgICAgICAgU2VuZGluZyB0aGUgbWVzc2FnZSBmYWlsZWQuCiAgICAgICAgfmRpc2NvcmQuRm9yYmlkZGVuCiAgICAgICAgICAgIFlvdSBkbyBub3QgaGF2ZSB0aGUgcHJvcGVyIHBlcm1pc3Npb25zIHRvIHNlbmQgdGhlIG1lc3NhZ2UuCiAgICAgICAgfmRpc2NvcmQuSW52YWxpZEFyZ3VtZW50CiAgICAgICAgICAgIFRoZSBgYGZpbGVzYGAgbGlzdCBpcyBub3Qgb2YgdGhlIGFwcHJvcHJpYXRlIHNpemUgb3IKICAgICAgICAgICAgeW91IHNwZWNpZmllZCBib3RoIGBgZmlsZWBgIGFuZCBgYGZpbGVzYGAuCgogICAgICAgIFJldHVybnMKICAgICAgICAtLS0tLS0tLS0KICAgICAgICA6Y2xhc3M6YC5NZXNzYWdlYAogICAgICAgICAgICBUaGUgbWVzc2FnZSB0aGF0IHdhcyBzZW50LgogICAgICAgICIiIgoKICAgICAgICByZXR1cm4gYXdhaXQgc2VsZi5jaGFubmVsLnNlbmQoY29udGVudCwgcmVmZXJlbmNlPXNlbGYsICoqa3dhcmdzKQoKICAgIGRlZiB0b19yZWZlcmVuY2Uoc2VsZiwgKiwgZmFpbF9pZl9ub3RfZXhpc3RzPVRydWUpOgogICAgICAgICIiIkNyZWF0ZXMgYSA6Y2xhc3M6YH5kaXNjb3JkLk1lc3NhZ2VSZWZlcmVuY2VgIGZyb20gdGhlIGN1cnJlbnQgbWVzc2FnZS4KCiAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS42CgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tCiAgICAgICAgZmFpbF9pZl9ub3RfZXhpc3RzOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgcmVwbHlpbmcgdXNpbmcgdGhlIG1lc3NhZ2UgcmVmZXJlbmNlIHNob3VsZCByYWlzZSA6Y2xhc3M6YEhUVFBFeGNlcHRpb25gCiAgICAgICAgICAgIGlmIHRoZSBtZXNzYWdlIG5vIGxvbmdlciBleGlzdHMgb3IgRGlzY29yZCBjb3VsZCBub3QgZmV0Y2ggdGhlIG1lc3NhZ2UuCgogICAgICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjcKCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tLQogICAgICAgIDpjbGFzczpgfmRpc2NvcmQuTWVzc2FnZVJlZmVyZW5jZWAKICAgICAgICAgICAgVGhlIHJlZmVyZW5jZSB0byB0aGlzIG1lc3NhZ2UuCiAgICAgICAgIiIiCgogICAgICAgIHJldHVybiBNZXNzYWdlUmVmZXJlbmNlLmZyb21fbWVzc2FnZShzZWxmLCBmYWlsX2lmX25vdF9leGlzdHM9ZmFpbF9pZl9ub3RfZXhpc3RzKQoKICAgIGRlZiB0b19tZXNzYWdlX3JlZmVyZW5jZV9kaWN0KHNlbGYpOgogICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICdtZXNzYWdlX2lkJzogc2VsZi5pZCwKICAgICAgICAgICAgJ2NoYW5uZWxfaWQnOiBzZWxmLmNoYW5uZWwuaWQsCiAgICAgICAgfQoKICAgICAgICBpZiBzZWxmLmd1aWxkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBkYXRhWydndWlsZF9pZCddID0gc2VsZi5ndWlsZC5pZAoKICAgICAgICByZXR1cm4gZGF0YQoKZGVmIGltcGxlbWVudF9wYXJ0aWFsX21ldGhvZHMoY2xzKToKICAgIG1zZyA9IE1lc3NhZ2UKICAgIGZvciBuYW1lIGluIGNscy5fZXhwb3J0ZWRfbmFtZXM6CiAgICAgICAgZnVuYyA9IGdldGF0dHIobXNnLCBuYW1lKQogICAgICAgIHNldGF0dHIoY2xzLCBuYW1lLCBmdW5jKQogICAgcmV0dXJuIGNscwoKQGltcGxlbWVudF9wYXJ0aWFsX21ldGhvZHMKY2xhc3MgUGFydGlhbE1lc3NhZ2UoSGFzaGFibGUpOgogICAgIiIiUmVwcmVzZW50cyBhIHBhcnRpYWwgbWVzc2FnZSB0byBhaWQgd2l0aCB3b3JraW5nIG1lc3NhZ2VzIHdoZW4gb25seQogICAgYSBtZXNzYWdlIGFuZCBjaGFubmVsIElEIGFyZSBwcmVzZW50LgoKICAgIFRoZXJlIGFyZSB0d28gd2F5cyB0byBjb25zdHJ1Y3QgdGhpcyBjbGFzcy4gVGhlIGZpcnN0IG9uZSBpcyB0aHJvdWdoCiAgICB0aGUgY29uc3RydWN0b3IgaXRzZWxmLCBhbmQgdGhlIHNlY29uZCBpcyB2aWEKICAgIDptZXRoOmBUZXh0Q2hhbm5lbC5nZXRfcGFydGlhbF9tZXNzYWdlYCBvciA6bWV0aDpgRE1DaGFubmVsLmdldF9wYXJ0aWFsX21lc3NhZ2VgLgoKICAgIE5vdGUgdGhhdCB0aGlzIGNsYXNzIGlzIHRyaW1tZWQgZG93biBhbmQgaGFzIG5vIHJpY2ggYXR0cmlidXRlcy4KCiAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjYKCiAgICAuLiBjb250YWluZXI6OiBvcGVyYXRpb25zCgogICAgICAgIC4uIGRlc2NyaWJlOjogeCA9PSB5CgogICAgICAgICAgICBDaGVja3MgaWYgdHdvIHBhcnRpYWwgbWVzc2FnZXMgYXJlIGVxdWFsLgoKICAgICAgICAuLiBkZXNjcmliZTo6IHggIT0geQoKICAgICAgICAgICAgQ2hlY2tzIGlmIHR3byBwYXJ0aWFsIG1lc3NhZ2VzIGFyZSBub3QgZXF1YWwuCgogICAgICAgIC4uIGRlc2NyaWJlOjogaGFzaCh4KQoKICAgICAgICAgICAgUmV0dXJucyB0aGUgcGFydGlhbCBtZXNzYWdlJ3MgaGFzaC4KCiAgICBBdHRyaWJ1dGVzCiAgICAtLS0tLS0tLS0tLQogICAgY2hhbm5lbDogVW5pb25bOmNsYXNzOmBUZXh0Q2hhbm5lbGAsIDpjbGFzczpgRE1DaGFubmVsYF0KICAgICAgICBUaGUgY2hhbm5lbCBhc3NvY2lhdGVkIHdpdGggdGhpcyBwYXJ0aWFsIG1lc3NhZ2UuCiAgICBpZDogOmNsYXNzOmBpbnRgCiAgICAgICAgVGhlIG1lc3NhZ2UgSUQuCiAgICAiIiIKCiAgICBfX3Nsb3RzX18gPSAoJ2NoYW5uZWwnLCAnaWQnLCAnX2NzX2d1aWxkJywgJ19zdGF0ZScpCgogICAgX2V4cG9ydGVkX25hbWVzID0gKAogICAgICAgICdqdW1wX3VybCcsCiAgICAgICAgJ2RlbGV0ZScsCiAgICAgICAgJ3B1Ymxpc2gnLAogICAgICAgICdwaW4nLAogICAgICAgICd1bnBpbicsCiAgICAgICAgJ2FkZF9yZWFjdGlvbicsCiAgICAgICAgJ3JlbW92ZV9yZWFjdGlvbicsCiAgICAgICAgJ2NsZWFyX3JlYWN0aW9uJywKICAgICAgICAnY2xlYXJfcmVhY3Rpb25zJywKICAgICAgICAncmVwbHknLAogICAgICAgICd0b19yZWZlcmVuY2UnLAogICAgICAgICd0b19tZXNzYWdlX3JlZmVyZW5jZV9kaWN0JywKICAgICkKCiAgICBkZWYgX19pbml0X18oc2VsZiwgKiwgY2hhbm5lbCwgaWQpOgogICAgICAgIGlmIGNoYW5uZWwudHlwZSBub3QgaW4gKENoYW5uZWxUeXBlLnRleHQsIENoYW5uZWxUeXBlLm5ld3MsIENoYW5uZWxUeXBlLnByaXZhdGUpOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ0V4cGVjdGVkIFRleHRDaGFubmVsIG9yIERNQ2hhbm5lbCBub3QgJXInICUgdHlwZShjaGFubmVsKSkKCiAgICAgICAgc2VsZi5jaGFubmVsID0gY2hhbm5lbAogICAgICAgIHNlbGYuX3N0YXRlID0gY2hhbm5lbC5fc3RhdGUKICAgICAgICBzZWxmLmlkID0gaWQKCiAgICBkZWYgX3VwZGF0ZShzZWxmLCBkYXRhKToKICAgICAgICAjIFRoaXMgaXMgdXNlZCBmb3IgZHVjayB0eXBpbmcgcHVycG9zZXMuCiAgICAgICAgIyBKdXN0IGRvIG5vdGhpbmcgd2l0aCB0aGUgZGF0YS4KICAgICAgICBwYXNzCgogICAgIyBBbHNvIG5lZWRlZCBmb3IgZHVjayB0eXBpbmcgcHVycG9zZXMKICAgICMgbi5iLiBub3QgZXhwb3NlZAogICAgcGlubmVkID0gcHJvcGVydHkoTm9uZSwgbGFtYmRhIHgsIHk6IC4uLikKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgcmV0dXJuICc8UGFydGlhbE1lc3NhZ2UgaWQ9ezAuaWR9IGNoYW5uZWw9ezAuY2hhbm5lbCFyfT4nLmZvcm1hdChzZWxmKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNyZWF0ZWRfYXQoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBkYXRldGltZS5kYXRldGltZWA6IFRoZSBwYXJ0aWFsIG1lc3NhZ2UncyBjcmVhdGlvbiB0aW1lIGluIFVUQy4iIiIKICAgICAgICByZXR1cm4gdXRpbHMuc25vd2ZsYWtlX3RpbWUoc2VsZi5pZCkKCiAgICBAdXRpbHMuY2FjaGVkX3Nsb3RfcHJvcGVydHkoJ19jc19ndWlsZCcpCiAgICBkZWYgZ3VpbGQoc2VsZik6CiAgICAgICAgIiIiT3B0aW9uYWxbOmNsYXNzOmBHdWlsZGBdOiBUaGUgZ3VpbGQgdGhhdCB0aGUgcGFydGlhbCBtZXNzYWdlIGJlbG9uZ3MgdG8sIGlmIGFwcGxpY2FibGUuIiIiCiAgICAgICAgcmV0dXJuIGdldGF0dHIoc2VsZi5jaGFubmVsLCAnZ3VpbGQnLCBOb25lKQoKICAgIGFzeW5jIGRlZiBmZXRjaChzZWxmKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgRmV0Y2hlcyB0aGUgcGFydGlhbCBtZXNzYWdlIHRvIGEgZnVsbCA6Y2xhc3M6YE1lc3NhZ2VgLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tLQogICAgICAgIE5vdEZvdW5kCiAgICAgICAgICAgIFRoZSBtZXNzYWdlIHdhcyBub3QgZm91bmQuCiAgICAgICAgRm9yYmlkZGVuCiAgICAgICAgICAgIFlvdSBkbyBub3QgaGF2ZSB0aGUgcGVybWlzc2lvbnMgcmVxdWlyZWQgdG8gZ2V0IGEgbWVzc2FnZS4KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIFJldHJpZXZpbmcgdGhlIG1lc3NhZ2UgZmFpbGVkLgoKICAgICAgICBSZXR1cm5zCiAgICAgICAgLS0tLS0tLS0KICAgICAgICA6Y2xhc3M6YE1lc3NhZ2VgCiAgICAgICAgICAgIFRoZSBmdWxsIG1lc3NhZ2UuCiAgICAgICAgIiIiCgogICAgICAgIGRhdGEgPSBhd2FpdCBzZWxmLl9zdGF0ZS5odHRwLmdldF9tZXNzYWdlKHNlbGYuY2hhbm5lbC5pZCwgc2VsZi5pZCkKICAgICAgICByZXR1cm4gc2VsZi5fc3RhdGUuY3JlYXRlX21lc3NhZ2UoY2hhbm5lbD1zZWxmLmNoYW5uZWwsIGRhdGE9ZGF0YSkKCiAgICBhc3luYyBkZWYgZWRpdChzZWxmLCAqKmZpZWxkcyk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIEVkaXRzIHRoZSBtZXNzYWdlLgoKICAgICAgICBUaGUgY29udGVudCBtdXN0IGJlIGFibGUgdG8gYmUgdHJhbnNmb3JtZWQgaW50byBhIHN0cmluZyB2aWEgYGBzdHIoY29udGVudClgYC4KCiAgICAgICAgLi4gdmVyc2lvbmNoYW5nZWQ6OiAxLjcKICAgICAgICAgICAgOmNsYXNzOmBkaXNjb3JkLk1lc3NhZ2VgIGlzIHJldHVybmVkIGluc3RlYWQgb2YgYGBOb25lYGAgaWYgYW4gZWRpdCB0b29rIHBsYWNlLgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICBjb250ZW50OiBPcHRpb25hbFs6Y2xhc3M6YHN0cmBdCiAgICAgICAgICAgIFRoZSBuZXcgY29udGVudCB0byByZXBsYWNlIHRoZSBtZXNzYWdlIHdpdGguCiAgICAgICAgICAgIENvdWxkIGJlIGBgTm9uZWBgIHRvIHJlbW92ZSB0aGUgY29udGVudC4KICAgICAgICBlbWJlZDogT3B0aW9uYWxbOmNsYXNzOmBFbWJlZGBdCiAgICAgICAgICAgIFRoZSBuZXcgZW1iZWQgdG8gcmVwbGFjZSB0aGUgb3JpZ2luYWwgd2l0aC4KICAgICAgICAgICAgQ291bGQgYmUgYGBOb25lYGAgdG8gcmVtb3ZlIHRoZSBlbWJlZC4KICAgICAgICBzdXBwcmVzczogOmNsYXNzOmBib29sYAogICAgICAgICAgICBXaGV0aGVyIHRvIHN1cHByZXNzIGVtYmVkcyBmb3IgdGhlIG1lc3NhZ2UuIFRoaXMgcmVtb3ZlcwogICAgICAgICAgICBhbGwgdGhlIGVtYmVkcyBpZiBzZXQgdG8gYGBUcnVlYGAuIElmIHNldCB0byBgYEZhbHNlYGAKICAgICAgICAgICAgdGhpcyBicmluZ3MgdGhlIGVtYmVkcyBiYWNrIGlmIHRoZXkgd2VyZSBzdXBwcmVzc2VkLgogICAgICAgICAgICBVc2luZyB0aGlzIHBhcmFtZXRlciByZXF1aXJlcyA6YXR0cjpgfi5QZXJtaXNzaW9ucy5tYW5hZ2VfbWVzc2FnZXNgLgogICAgICAgIGRlbGV0ZV9hZnRlcjogT3B0aW9uYWxbOmNsYXNzOmBmbG9hdGBdCiAgICAgICAgICAgIElmIHByb3ZpZGVkLCB0aGUgbnVtYmVyIG9mIHNlY29uZHMgdG8gd2FpdCBpbiB0aGUgYmFja2dyb3VuZAogICAgICAgICAgICBiZWZvcmUgZGVsZXRpbmcgdGhlIG1lc3NhZ2Ugd2UganVzdCBlZGl0ZWQuIElmIHRoZSBkZWxldGlvbiBmYWlscywKICAgICAgICAgICAgdGhlbiBpdCBpcyBzaWxlbnRseSBpZ25vcmVkLgogICAgICAgIGFsbG93ZWRfbWVudGlvbnM6IE9wdGlvbmFsWzpjbGFzczpgfmRpc2NvcmQuQWxsb3dlZE1lbnRpb25zYF0KICAgICAgICAgICAgQ29udHJvbHMgdGhlIG1lbnRpb25zIGJlaW5nIHByb2Nlc3NlZCBpbiB0aGlzIG1lc3NhZ2UuIElmIHRoaXMgaXMKICAgICAgICAgICAgcGFzc2VkLCB0aGVuIHRoZSBvYmplY3QgaXMgbWVyZ2VkIHdpdGggOmF0dHI6YH5kaXNjb3JkLkNsaWVudC5hbGxvd2VkX21lbnRpb25zYC4KICAgICAgICAgICAgVGhlIG1lcmdpbmcgYmVoYXZpb3VyIG9ubHkgb3ZlcnJpZGVzIGF0dHJpYnV0ZXMgdGhhdCBoYXZlIGJlZW4gZXhwbGljaXRseSBwYXNzZWQKICAgICAgICAgICAgdG8gdGhlIG9iamVjdCwgb3RoZXJ3aXNlIGl0IHVzZXMgdGhlIGF0dHJpYnV0ZXMgc2V0IGluIDphdHRyOmB+ZGlzY29yZC5DbGllbnQuYWxsb3dlZF9tZW50aW9uc2AuCiAgICAgICAgICAgIElmIG5vIG9iamVjdCBpcyBwYXNzZWQgYXQgYWxsIHRoZW4gdGhlIGRlZmF1bHRzIGdpdmVuIGJ5IDphdHRyOmB+ZGlzY29yZC5DbGllbnQuYWxsb3dlZF9tZW50aW9uc2AKICAgICAgICAgICAgYXJlIHVzZWQgaW5zdGVhZC4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIE5vdEZvdW5kCiAgICAgICAgICAgIFRoZSBtZXNzYWdlIHdhcyBub3QgZm91bmQuCiAgICAgICAgSFRUUEV4Y2VwdGlvbgogICAgICAgICAgICBFZGl0aW5nIHRoZSBtZXNzYWdlIGZhaWxlZC4KICAgICAgICBGb3JiaWRkZW4KICAgICAgICAgICAgVHJpZWQgdG8gc3VwcHJlc3MgYSBtZXNzYWdlIHdpdGhvdXQgcGVybWlzc2lvbnMgb3IKICAgICAgICAgICAgZWRpdGVkIGEgbWVzc2FnZSdzIGNvbnRlbnQgb3IgZW1iZWQgdGhhdCBpc24ndCB5b3Vycy4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tLQogICAgICAgIE9wdGlvbmFsWzpjbGFzczpgTWVzc2FnZWBdCiAgICAgICAgICAgIFRoZSBtZXNzYWdlIHRoYXQgd2FzIGVkaXRlZC4KICAgICAgICAiIiIKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb250ZW50ID0gZmllbGRzWydjb250ZW50J10KICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBjb250ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgZmllbGRzWydjb250ZW50J10gPSBzdHIoY29udGVudCkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBlbWJlZCA9IGZpZWxkc1snZW1iZWQnXQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGVtYmVkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgZmllbGRzWydlbWJlZCddID0gZW1iZWQudG9fZGljdCgpCgogICAgICAgIHRyeToKICAgICAgICAgICAgc3VwcHJlc3MgPSBmaWVsZHMucG9wKCdzdXBwcmVzcycpCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIGZsYWdzID0gTWVzc2FnZUZsYWdzLl9mcm9tX3ZhbHVlKDApCiAgICAgICAgICAgICBmbGFncy5zdXBwcmVzc19lbWJlZHMgPSBzdXBwcmVzcwogICAgICAgICAgICAgZmllbGRzWydmbGFncyddID0gZmxhZ3MudmFsdWUKCiAgICAgICAgZGVsZXRlX2FmdGVyID0gZmllbGRzLnBvcCgnZGVsZXRlX2FmdGVyJywgTm9uZSkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBhbGxvd2VkX21lbnRpb25zID0gZmllbGRzLnBvcCgnYWxsb3dlZF9tZW50aW9ucycpCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgYWxsb3dlZF9tZW50aW9ucyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3N0YXRlLmFsbG93ZWRfbWVudGlvbnMgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgYWxsb3dlZF9tZW50aW9ucyA9IHNlbGYuX3N0YXRlLmFsbG93ZWRfbWVudGlvbnMubWVyZ2UoYWxsb3dlZF9tZW50aW9ucykudG9fZGljdCgpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGFsbG93ZWRfbWVudGlvbnMgPSBhbGxvd2VkX21lbnRpb25zLnRvX2RpY3QoKQogICAgICAgICAgICAgICAgZmllbGRzWydhbGxvd2VkX21lbnRpb25zJ10gPSBhbGxvd2VkX21lbnRpb25zCgogICAgICAgIGlmIGZpZWxkczoKICAgICAgICAgICAgZGF0YSA9IGF3YWl0IHNlbGYuX3N0YXRlLmh0dHAuZWRpdF9tZXNzYWdlKHNlbGYuY2hhbm5lbC5pZCwgc2VsZi5pZCwgKipmaWVsZHMpCgogICAgICAgIGlmIGRlbGV0ZV9hZnRlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgYXdhaXQgc2VsZi5kZWxldGUoZGVsYXk9ZGVsZXRlX2FmdGVyKQoKICAgICAgICBpZiBmaWVsZHM6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zdGF0ZS5jcmVhdGVfbWVzc2FnZShjaGFubmVsPXNlbGYuY2hhbm5lbCwgZGF0YT1kYXRhKQo=
