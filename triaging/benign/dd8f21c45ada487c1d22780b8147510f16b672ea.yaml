statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/user.py
  contents:
  - name: User.remove_friend
    score: 0.0
    code: |-
      @deprecated()
          async def remove_friend(self):
              """|coro|

              Removes the user as a friend.

              .. deprecated:: 1.7

              .. note::

                  This can only be used by non-bot accounts.

              Raises
              -------
              Forbidden
                  Not allowed to remove this user as a friend.
              HTTPException
                  Removing the user as a friend failed.
              """
              await self._state.http.remove_relationship(self.id)
    tokens: return_generator pop_top resume load_fast self load_attr _state load_attr http load_attr STRING_LEN_S_ENT_HIGH load_fast self load_attr id call get_awaitable load_const send TO_NUMBER yield_value resume jump_backward_no_interrupt TO_NUMBER end_send pop_top return_const None cleanup_throw jump_backward TO_NUMBER call_intrinsic_1 INTRINSIC_STOPITERATION_ERROR reraise
    hash: 95a32f1430ec3f58dc28fa3829c1e3efde6010bebe512171fc0b939245ab4cfd
sources:
  .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/user.py: IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KCiIiIgpUaGUgTUlUIExpY2Vuc2UgKE1JVCkKCkNvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50IFJhcHB0egoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgp0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlClNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCk9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwpGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSCkRFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KIiIiCgpmcm9tIGNvbGxlY3Rpb25zIGltcG9ydCBuYW1lZHR1cGxlCgppbXBvcnQgZGlzY29yZC5hYmMKZnJvbSAuZmxhZ3MgaW1wb3J0IFB1YmxpY1VzZXJGbGFncwpmcm9tIC51dGlscyBpbXBvcnQgc25vd2ZsYWtlX3RpbWUsIF9ieXRlc190b19iYXNlNjRfZGF0YSwgcGFyc2VfdGltZQpmcm9tIC5lbnVtcyBpbXBvcnQgRGVmYXVsdEF2YXRhciwgUmVsYXRpb25zaGlwVHlwZSwgVXNlckZsYWdzLCBIeXBlU3F1YWRIb3VzZSwgUHJlbWl1bVR5cGUsIHRyeV9lbnVtCmZyb20gLmVycm9ycyBpbXBvcnQgQ2xpZW50RXhjZXB0aW9uCmZyb20gLmNvbG91ciBpbXBvcnQgQ29sb3VyCmZyb20gLmFzc2V0IGltcG9ydCBBc3NldApmcm9tIC51dGlscyBpbXBvcnQgZGVwcmVjYXRlZAoKY2xhc3MgUHJvZmlsZShuYW1lZHR1cGxlKCdQcm9maWxlJywgJ2ZsYWdzIHVzZXIgbXV0dWFsX2d1aWxkcyBjb25uZWN0ZWRfYWNjb3VudHMgcHJlbWl1bV9zaW5jZScpKToKICAgIF9fc2xvdHNfXyA9ICgpCgogICAgQHByb3BlcnR5CiAgICBkZWYgbml0cm8oc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYucHJlbWl1bV9zaW5jZSBpcyBub3QgTm9uZQoKICAgIHByZW1pdW0gPSBuaXRybwoKICAgIGRlZiBfaGFzX2ZsYWcoc2VsZiwgbyk6CiAgICAgICAgdiA9IG8udmFsdWUKICAgICAgICByZXR1cm4gKHNlbGYuZmxhZ3MgJiB2KSA9PSB2CgogICAgQHByb3BlcnR5CiAgICBkZWYgc3RhZmYoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2hhc19mbGFnKFVzZXJGbGFncy5zdGFmZikKCiAgICBAcHJvcGVydHkKICAgIGRlZiBwYXJ0bmVyKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9oYXNfZmxhZyhVc2VyRmxhZ3MucGFydG5lcikKCiAgICBAcHJvcGVydHkKICAgIGRlZiBidWdfaHVudGVyKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9oYXNfZmxhZyhVc2VyRmxhZ3MuYnVnX2h1bnRlcikKCiAgICBAcHJvcGVydHkKICAgIGRlZiBlYXJseV9zdXBwb3J0ZXIoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2hhc19mbGFnKFVzZXJGbGFncy5lYXJseV9zdXBwb3J0ZXIpCgogICAgQHByb3BlcnR5CiAgICBkZWYgaHlwZXNxdWFkKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9oYXNfZmxhZyhVc2VyRmxhZ3MuaHlwZXNxdWFkKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGh5cGVzcXVhZF9ob3VzZXMoc2VsZik6CiAgICAgICAgZmxhZ3MgPSAoVXNlckZsYWdzLmh5cGVzcXVhZF9icmF2ZXJ5LCBVc2VyRmxhZ3MuaHlwZXNxdWFkX2JyaWxsaWFuY2UsIFVzZXJGbGFncy5oeXBlc3F1YWRfYmFsYW5jZSkKICAgICAgICByZXR1cm4gW2hvdXNlIGZvciBob3VzZSwgZmxhZyBpbiB6aXAoSHlwZVNxdWFkSG91c2UsIGZsYWdzKSBpZiBzZWxmLl9oYXNfZmxhZyhmbGFnKV0KCiAgICBAcHJvcGVydHkKICAgIGRlZiB0ZWFtX3VzZXIoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2hhc19mbGFnKFVzZXJGbGFncy50ZWFtX3VzZXIpCgogICAgQHByb3BlcnR5CiAgICBkZWYgc3lzdGVtKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9oYXNfZmxhZyhVc2VyRmxhZ3Muc3lzdGVtKQoKX0Jhc2VVc2VyID0gZGlzY29yZC5hYmMuVXNlcgoKY2xhc3MgQmFzZVVzZXIoX0Jhc2VVc2VyKToKICAgIF9fc2xvdHNfXyA9ICgnbmFtZScsICdpZCcsICdkaXNjcmltaW5hdG9yJywgJ2F2YXRhcicsICdib3QnLCAnc3lzdGVtJywgJ19wdWJsaWNfZmxhZ3MnLCAnX3N0YXRlJykKCiAgICBkZWYgX19pbml0X18oc2VsZiwgKiwgc3RhdGUsIGRhdGEpOgogICAgICAgIHNlbGYuX3N0YXRlID0gc3RhdGUKICAgICAgICBzZWxmLl91cGRhdGUoZGF0YSkKCiAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gJ3swLm5hbWV9I3swLmRpc2NyaW1pbmF0b3J9Jy5mb3JtYXQoc2VsZikKCiAgICBkZWYgX19lcV9fKHNlbGYsIG90aGVyKToKICAgICAgICByZXR1cm4gaXNpbnN0YW5jZShvdGhlciwgX0Jhc2VVc2VyKSBhbmQgb3RoZXIuaWQgPT0gc2VsZi5pZAoKICAgIGRlZiBfX25lX18oc2VsZiwgb3RoZXIpOgogICAgICAgIHJldHVybiBub3Qgc2VsZi5fX2VxX18ob3RoZXIpCgogICAgZGVmIF9faGFzaF9fKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLmlkID4+IDIyCgogICAgZGVmIF91cGRhdGUoc2VsZiwgZGF0YSk6CiAgICAgICAgc2VsZi5uYW1lID0gZGF0YVsndXNlcm5hbWUnXQogICAgICAgIHNlbGYuaWQgPSBpbnQoZGF0YVsnaWQnXSkKICAgICAgICBzZWxmLmRpc2NyaW1pbmF0b3IgPSBkYXRhWydkaXNjcmltaW5hdG9yJ10KICAgICAgICBzZWxmLmF2YXRhciA9IGRhdGFbJ2F2YXRhciddCiAgICAgICAgc2VsZi5fcHVibGljX2ZsYWdzID0gZGF0YS5nZXQoJ3B1YmxpY19mbGFncycsIDApCiAgICAgICAgc2VsZi5ib3QgPSBkYXRhLmdldCgnYm90JywgRmFsc2UpCiAgICAgICAgc2VsZi5zeXN0ZW0gPSBkYXRhLmdldCgnc3lzdGVtJywgRmFsc2UpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgX2NvcHkoY2xzLCB1c2VyKToKICAgICAgICBzZWxmID0gY2xzLl9fbmV3X18oY2xzKSAjIGJ5cGFzcyBfX2luaXRfXwoKICAgICAgICBzZWxmLm5hbWUgPSB1c2VyLm5hbWUKICAgICAgICBzZWxmLmlkID0gdXNlci5pZAogICAgICAgIHNlbGYuZGlzY3JpbWluYXRvciA9IHVzZXIuZGlzY3JpbWluYXRvcgogICAgICAgIHNlbGYuYXZhdGFyID0gdXNlci5hdmF0YXIKICAgICAgICBzZWxmLmJvdCA9IHVzZXIuYm90CiAgICAgICAgc2VsZi5fc3RhdGUgPSB1c2VyLl9zdGF0ZQogICAgICAgIHNlbGYuX3B1YmxpY19mbGFncyA9IHVzZXIuX3B1YmxpY19mbGFncwoKICAgICAgICByZXR1cm4gc2VsZgoKICAgIGRlZiBfdG9fbWluaW1hbF91c2VyX2pzb24oc2VsZik6CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ3VzZXJuYW1lJzogc2VsZi5uYW1lLAogICAgICAgICAgICAnaWQnOiBzZWxmLmlkLAogICAgICAgICAgICAnYXZhdGFyJzogc2VsZi5hdmF0YXIsCiAgICAgICAgICAgICdkaXNjcmltaW5hdG9yJzogc2VsZi5kaXNjcmltaW5hdG9yLAogICAgICAgICAgICAnYm90Jzogc2VsZi5ib3QsCiAgICAgICAgfQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHB1YmxpY19mbGFncyhzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YFB1YmxpY1VzZXJGbGFnc2A6IFRoZSBwdWJsaWNseSBhdmFpbGFibGUgZmxhZ3MgdGhlIHVzZXIgaGFzLiIiIgogICAgICAgIHJldHVybiBQdWJsaWNVc2VyRmxhZ3MuX2Zyb21fdmFsdWUoc2VsZi5fcHVibGljX2ZsYWdzKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGF2YXRhcl91cmwoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBBc3NldGA6IFJldHVybnMgYW4gOmNsYXNzOmBBc3NldGAgZm9yIHRoZSBhdmF0YXIgdGhlIHVzZXIgaGFzLgoKICAgICAgICBJZiB0aGUgdXNlciBkb2VzIG5vdCBoYXZlIGEgdHJhZGl0aW9uYWwgYXZhdGFyLCBhbiBhc3NldCBmb3IKICAgICAgICB0aGUgZGVmYXVsdCBhdmF0YXIgaXMgcmV0dXJuZWQgaW5zdGVhZC4KCiAgICAgICAgVGhpcyBpcyBlcXVpdmFsZW50IHRvIGNhbGxpbmcgOm1ldGg6YGF2YXRhcl91cmxfYXNgIHdpdGgKICAgICAgICB0aGUgZGVmYXVsdCBwYXJhbWV0ZXJzIChpLmUuIHdlYnAvZ2lmIGRldGVjdGlvbiBhbmQgYSBzaXplIG9mIDEwMjQpLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLmF2YXRhcl91cmxfYXMoZm9ybWF0PU5vbmUsIHNpemU9MTAyNCkKCiAgICBkZWYgaXNfYXZhdGFyX2FuaW1hdGVkKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IEluZGljYXRlcyBpZiB0aGUgdXNlciBoYXMgYW4gYW5pbWF0ZWQgYXZhdGFyLiIiIgogICAgICAgIHJldHVybiBib29sKHNlbGYuYXZhdGFyIGFuZCBzZWxmLmF2YXRhci5zdGFydHN3aXRoKCdhXycpKQoKICAgIGRlZiBhdmF0YXJfdXJsX2FzKHNlbGYsICosIGZvcm1hdD1Ob25lLCBzdGF0aWNfZm9ybWF0PSd3ZWJwJywgc2l6ZT0xMDI0KToKICAgICAgICAiIiJSZXR1cm5zIGFuIDpjbGFzczpgQXNzZXRgIGZvciB0aGUgYXZhdGFyIHRoZSB1c2VyIGhhcy4KCiAgICAgICAgSWYgdGhlIHVzZXIgZG9lcyBub3QgaGF2ZSBhIHRyYWRpdGlvbmFsIGF2YXRhciwgYW4gYXNzZXQgZm9yCiAgICAgICAgdGhlIGRlZmF1bHQgYXZhdGFyIGlzIHJldHVybmVkIGluc3RlYWQuCgogICAgICAgIFRoZSBmb3JtYXQgbXVzdCBiZSBvbmUgb2YgJ3dlYnAnLCAnanBlZycsICdqcGcnLCAncG5nJyBvciAnZ2lmJywgYW5kCiAgICAgICAgJ2dpZicgaXMgb25seSB2YWxpZCBmb3IgYW5pbWF0ZWQgYXZhdGFycy4gVGhlIHNpemUgbXVzdCBiZSBhIHBvd2VyIG9mIDIKICAgICAgICBiZXR3ZWVuIDE2IGFuZCA0MDk2LgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICBmb3JtYXQ6IE9wdGlvbmFsWzpjbGFzczpgc3RyYF0KICAgICAgICAgICAgVGhlIGZvcm1hdCB0byBhdHRlbXB0IHRvIGNvbnZlcnQgdGhlIGF2YXRhciB0by4KICAgICAgICAgICAgSWYgdGhlIGZvcm1hdCBpcyBgYE5vbmVgYCwgdGhlbiBpdCBpcyBhdXRvbWF0aWNhbGx5CiAgICAgICAgICAgIGRldGVjdGVkIGludG8gZWl0aGVyICdnaWYnIG9yIHN0YXRpY19mb3JtYXQgZGVwZW5kaW5nIG9uIHRoZQogICAgICAgICAgICBhdmF0YXIgYmVpbmcgYW5pbWF0ZWQgb3Igbm90LgogICAgICAgIHN0YXRpY19mb3JtYXQ6IE9wdGlvbmFsWzpjbGFzczpgc3RyYF0KICAgICAgICAgICAgRm9ybWF0IHRvIGF0dGVtcHQgdG8gY29udmVydCBvbmx5IG5vbi1hbmltYXRlZCBhdmF0YXJzIHRvLgogICAgICAgICAgICBEZWZhdWx0cyB0byAnd2VicCcKICAgICAgICBzaXplOiA6Y2xhc3M6YGludGAKICAgICAgICAgICAgVGhlIHNpemUgb2YgdGhlIGltYWdlIHRvIGRpc3BsYXkuCgogICAgICAgIFJhaXNlcwogICAgICAgIC0tLS0tLQogICAgICAgIEludmFsaWRBcmd1bWVudAogICAgICAgICAgICBCYWQgaW1hZ2UgZm9ybWF0IHBhc3NlZCB0byBgYGZvcm1hdGBgIG9yIGBgc3RhdGljX2Zvcm1hdGBgLCBvcgogICAgICAgICAgICBpbnZhbGlkIGBgc2l6ZWBgLgoKICAgICAgICBSZXR1cm5zCiAgICAgICAgLS0tLS0tLS0KICAgICAgICA6Y2xhc3M6YEFzc2V0YAogICAgICAgICAgICBUaGUgcmVzdWx0aW5nIENETiBhc3NldC4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gQXNzZXQuX2Zyb21fYXZhdGFyKHNlbGYuX3N0YXRlLCBzZWxmLCBmb3JtYXQ9Zm9ybWF0LCBzdGF0aWNfZm9ybWF0PXN0YXRpY19mb3JtYXQsIHNpemU9c2l6ZSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBkZWZhdWx0X2F2YXRhcihzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YERlZmF1bHRBdmF0YXJgOiBSZXR1cm5zIHRoZSBkZWZhdWx0IGF2YXRhciBmb3IgYSBnaXZlbiB1c2VyLiBUaGlzIGlzIGNhbGN1bGF0ZWQgYnkgdGhlIHVzZXIncyBkaXNjcmltaW5hdG9yLiIiIgogICAgICAgIHJldHVybiB0cnlfZW51bShEZWZhdWx0QXZhdGFyLCBpbnQoc2VsZi5kaXNjcmltaW5hdG9yKSAlIGxlbihEZWZhdWx0QXZhdGFyKSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBkZWZhdWx0X2F2YXRhcl91cmwoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBBc3NldGA6IFJldHVybnMgYSBVUkwgZm9yIGEgdXNlcidzIGRlZmF1bHQgYXZhdGFyLiIiIgogICAgICAgIHJldHVybiBBc3NldChzZWxmLl9zdGF0ZSwgJy9lbWJlZC9hdmF0YXJzL3t9LnBuZycuZm9ybWF0KHNlbGYuZGVmYXVsdF9hdmF0YXIudmFsdWUpKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNvbG91cihzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YENvbG91cmA6IEEgcHJvcGVydHkgdGhhdCByZXR1cm5zIGEgY29sb3VyIGRlbm90aW5nIHRoZSByZW5kZXJlZCBjb2xvdXIKICAgICAgICBmb3IgdGhlIHVzZXIuIFRoaXMgYWx3YXlzIHJldHVybnMgOm1ldGg6YENvbG91ci5kZWZhdWx0YC4KCiAgICAgICAgVGhlcmUgaXMgYW4gYWxpYXMgZm9yIHRoaXMgbmFtZWQgOmF0dHI6YGNvbG9yYC4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gQ29sb3VyLmRlZmF1bHQoKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNvbG9yKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgQ29sb3VyYDogQSBwcm9wZXJ0eSB0aGF0IHJldHVybnMgYSBjb2xvciBkZW5vdGluZyB0aGUgcmVuZGVyZWQgY29sb3IKICAgICAgICBmb3IgdGhlIHVzZXIuIFRoaXMgYWx3YXlzIHJldHVybnMgOm1ldGg6YENvbG91ci5kZWZhdWx0YC4KCiAgICAgICAgVGhlcmUgaXMgYW4gYWxpYXMgZm9yIHRoaXMgbmFtZWQgOmF0dHI6YGNvbG91cmAuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuY29sb3VyCgogICAgQHByb3BlcnR5CiAgICBkZWYgbWVudGlvbihzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YHN0cmA6IFJldHVybnMgYSBzdHJpbmcgdGhhdCBhbGxvd3MgeW91IHRvIG1lbnRpb24gdGhlIGdpdmVuIHVzZXIuIiIiCiAgICAgICAgcmV0dXJuICc8QHswLmlkfT4nLmZvcm1hdChzZWxmKQoKICAgIGRlZiBwZXJtaXNzaW9uc19pbihzZWxmLCBjaGFubmVsKToKICAgICAgICAiIiJBbiBhbGlhcyBmb3IgOm1ldGg6YGFiYy5HdWlsZENoYW5uZWwucGVybWlzc2lvbnNfZm9yYC4KCiAgICAgICAgQmFzaWNhbGx5IGVxdWl2YWxlbnQgdG86CgogICAgICAgIC4uIGNvZGUtYmxvY2s6OiBweXRob24zCgogICAgICAgICAgICBjaGFubmVsLnBlcm1pc3Npb25zX2ZvcihzZWxmKQoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICBjaGFubmVsOiA6Y2xhc3M6YGFiYy5HdWlsZENoYW5uZWxgCiAgICAgICAgICAgIFRoZSBjaGFubmVsIHRvIGNoZWNrIHlvdXIgcGVybWlzc2lvbnMgZm9yLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBjaGFubmVsLnBlcm1pc3Npb25zX2ZvcihzZWxmKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNyZWF0ZWRfYXQoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBkYXRldGltZS5kYXRldGltZWA6IFJldHVybnMgdGhlIHVzZXIncyBjcmVhdGlvbiB0aW1lIGluIFVUQy4KCiAgICAgICAgVGhpcyBpcyB3aGVuIHRoZSB1c2VyJ3MgRGlzY29yZCBhY2NvdW50IHdhcyBjcmVhdGVkLiIiIgogICAgICAgIHJldHVybiBzbm93Zmxha2VfdGltZShzZWxmLmlkKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGRpc3BsYXlfbmFtZShzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YHN0cmA6IFJldHVybnMgdGhlIHVzZXIncyBkaXNwbGF5IG5hbWUuCgogICAgICAgIEZvciByZWd1bGFyIHVzZXJzIHRoaXMgaXMganVzdCB0aGVpciB1c2VybmFtZSwgYnV0CiAgICAgICAgaWYgdGhleSBoYXZlIGEgZ3VpbGQgc3BlY2lmaWMgbmlja25hbWUgdGhlbiB0aGF0CiAgICAgICAgaXMgcmV0dXJuZWQgaW5zdGVhZC4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5uYW1lCgogICAgZGVmIG1lbnRpb25lZF9pbihzZWxmLCBtZXNzYWdlKToKICAgICAgICAiIiJDaGVja3MgaWYgdGhlIHVzZXIgaXMgbWVudGlvbmVkIGluIHRoZSBzcGVjaWZpZWQgbWVzc2FnZS4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgbWVzc2FnZTogOmNsYXNzOmBNZXNzYWdlYAogICAgICAgICAgICBUaGUgbWVzc2FnZSB0byBjaGVjayBpZiB5b3UncmUgbWVudGlvbmVkIGluLgoKICAgICAgICBSZXR1cm5zCiAgICAgICAgLS0tLS0tLQogICAgICAgIDpjbGFzczpgYm9vbGAKICAgICAgICAgICAgSW5kaWNhdGVzIGlmIHRoZSB1c2VyIGlzIG1lbnRpb25lZCBpbiB0aGUgbWVzc2FnZS4KICAgICAgICAiIiIKCiAgICAgICAgaWYgbWVzc2FnZS5tZW50aW9uX2V2ZXJ5b25lOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQoKICAgICAgICByZXR1cm4gYW55KHVzZXIuaWQgPT0gc2VsZi5pZCBmb3IgdXNlciBpbiBtZXNzYWdlLm1lbnRpb25zKQoKY2xhc3MgQ2xpZW50VXNlcihCYXNlVXNlcik6CiAgICAiIiJSZXByZXNlbnRzIHlvdXIgRGlzY29yZCB1c2VyLgoKICAgIC4uIGNvbnRhaW5lcjo6IG9wZXJhdGlvbnMKCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4ID09IHkKCiAgICAgICAgICAgIENoZWNrcyBpZiB0d28gdXNlcnMgYXJlIGVxdWFsLgoKICAgICAgICAuLiBkZXNjcmliZTo6IHggIT0geQoKICAgICAgICAgICAgQ2hlY2tzIGlmIHR3byB1c2VycyBhcmUgbm90IGVxdWFsLgoKICAgICAgICAuLiBkZXNjcmliZTo6IGhhc2goeCkKCiAgICAgICAgICAgIFJldHVybiB0aGUgdXNlcidzIGhhc2guCgogICAgICAgIC4uIGRlc2NyaWJlOjogc3RyKHgpCgogICAgICAgICAgICBSZXR1cm5zIHRoZSB1c2VyJ3MgbmFtZSB3aXRoIGRpc2NyaW1pbmF0b3IuCgogICAgQXR0cmlidXRlcwogICAgLS0tLS0tLS0tLS0KICAgIG5hbWU6IDpjbGFzczpgc3RyYAogICAgICAgIFRoZSB1c2VyJ3MgdXNlcm5hbWUuCiAgICBpZDogOmNsYXNzOmBpbnRgCiAgICAgICAgVGhlIHVzZXIncyB1bmlxdWUgSUQuCiAgICBkaXNjcmltaW5hdG9yOiA6Y2xhc3M6YHN0cmAKICAgICAgICBUaGUgdXNlcidzIGRpc2NyaW1pbmF0b3IuIFRoaXMgaXMgZ2l2ZW4gd2hlbiB0aGUgdXNlcm5hbWUgaGFzIGNvbmZsaWN0cy4KICAgIGF2YXRhcjogT3B0aW9uYWxbOmNsYXNzOmBzdHJgXQogICAgICAgIFRoZSBhdmF0YXIgaGFzaCB0aGUgdXNlciBoYXMuIENvdWxkIGJlIGBgTm9uZWBgLgogICAgYm90OiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgU3BlY2lmaWVzIGlmIHRoZSB1c2VyIGlzIGEgYm90IGFjY291bnQuCiAgICBzeXN0ZW06IDpjbGFzczpgYm9vbGAKICAgICAgICBTcGVjaWZpZXMgaWYgdGhlIHVzZXIgaXMgYSBzeXN0ZW0gdXNlciAoaS5lLiByZXByZXNlbnRzIERpc2NvcmQgb2ZmaWNpYWxseSkuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuMwoKICAgIHZlcmlmaWVkOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgU3BlY2lmaWVzIGlmIHRoZSB1c2VyJ3MgZW1haWwgaXMgdmVyaWZpZWQuCiAgICBlbWFpbDogT3B0aW9uYWxbOmNsYXNzOmBzdHJgXQogICAgICAgIFRoZSBlbWFpbCB0aGUgdXNlciB1c2VkIHdoZW4gcmVnaXN0ZXJpbmcuCgogICAgICAgIC4uIGRlcHJlY2F0ZWQ6OiAxLjcKCiAgICBsb2NhbGU6IE9wdGlvbmFsWzpjbGFzczpgc3RyYF0KICAgICAgICBUaGUgSUVURiBsYW5ndWFnZSB0YWcgdXNlZCB0byBpZGVudGlmeSB0aGUgbGFuZ3VhZ2UgdGhlIHVzZXIgaXMgdXNpbmcuCiAgICBtZmFfZW5hYmxlZDogOmNsYXNzOmBib29sYAogICAgICAgIFNwZWNpZmllcyBpZiB0aGUgdXNlciBoYXMgTUZBIHR1cm5lZCBvbiBhbmQgd29ya2luZy4KICAgIHByZW1pdW06IDpjbGFzczpgYm9vbGAKICAgICAgICBTcGVjaWZpZXMgaWYgdGhlIHVzZXIgaXMgYSBwcmVtaXVtIHVzZXIgKGUuZy4gaGFzIERpc2NvcmQgTml0cm8pLgoKICAgICAgICAuLiBkZXByZWNhdGVkOjogMS43CgogICAgcHJlbWl1bV90eXBlOiBPcHRpb25hbFs6Y2xhc3M6YFByZW1pdW1UeXBlYF0KICAgICAgICBTcGVjaWZpZXMgdGhlIHR5cGUgb2YgcHJlbWl1bSBhIHVzZXIgaGFzIChlLmcuIE5pdHJvIG9yIE5pdHJvIENsYXNzaWMpLiBDb3VsZCBiZSBOb25lIGlmIHRoZSB1c2VyIGlzIG5vdCBwcmVtaXVtLgoKICAgICAgICAuLiBkZXByZWNhdGVkOjogMS43CiAgICAiIiIKICAgIF9fc2xvdHNfXyA9IEJhc2VVc2VyLl9fc2xvdHNfXyArIFwKICAgICAgICAgICAgICAgICgnZW1haWwnLCAnbG9jYWxlJywgJ19mbGFncycsICd2ZXJpZmllZCcsICdtZmFfZW5hYmxlZCcsCiAgICAgICAgICAgICAgICAgJ3ByZW1pdW0nLCAncHJlbWl1bV90eXBlJywgJ19yZWxhdGlvbnNoaXBzJywgJ19fd2Vha3JlZl9fJykKCiAgICBkZWYgX19pbml0X18oc2VsZiwgKiwgc3RhdGUsIGRhdGEpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oc3RhdGU9c3RhdGUsIGRhdGE9ZGF0YSkKICAgICAgICBzZWxmLl9yZWxhdGlvbnNoaXBzID0ge30KCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgcmV0dXJuICc8Q2xpZW50VXNlciBpZD17MC5pZH0gbmFtZT17MC5uYW1lIXJ9IGRpc2NyaW1pbmF0b3I9ezAuZGlzY3JpbWluYXRvciFyfScgXAogICAgICAgICAgICAgICAnIGJvdD17MC5ib3R9IHZlcmlmaWVkPXswLnZlcmlmaWVkfSBtZmFfZW5hYmxlZD17MC5tZmFfZW5hYmxlZH0+Jy5mb3JtYXQoc2VsZikKCiAgICBkZWYgX3VwZGF0ZShzZWxmLCBkYXRhKToKICAgICAgICBzdXBlcigpLl91cGRhdGUoZGF0YSkKICAgICAgICAjIFRoZXJlJ3MgYWN0dWFsbHkgYW4gT3B0aW9uYWxbc3RyXSBwaG9uZSBmaWVsZCBhcyB3ZWxsIGJ1dCBJIHdvbid0IHVzZSBpdAogICAgICAgIHNlbGYudmVyaWZpZWQgPSBkYXRhLmdldCgndmVyaWZpZWQnLCBGYWxzZSkKICAgICAgICBzZWxmLmVtYWlsID0gZGF0YS5nZXQoJ2VtYWlsJykKICAgICAgICBzZWxmLmxvY2FsZSA9IGRhdGEuZ2V0KCdsb2NhbGUnKQogICAgICAgIHNlbGYuX2ZsYWdzID0gZGF0YS5nZXQoJ2ZsYWdzJywgMCkKICAgICAgICBzZWxmLm1mYV9lbmFibGVkID0gZGF0YS5nZXQoJ21mYV9lbmFibGVkJywgRmFsc2UpCiAgICAgICAgc2VsZi5wcmVtaXVtID0gZGF0YS5nZXQoJ3ByZW1pdW0nLCBGYWxzZSkKICAgICAgICBzZWxmLnByZW1pdW1fdHlwZSA9IHRyeV9lbnVtKFByZW1pdW1UeXBlLCBkYXRhLmdldCgncHJlbWl1bV90eXBlJywgTm9uZSkpCgogICAgQGRlcHJlY2F0ZWQoKQogICAgZGVmIGdldF9yZWxhdGlvbnNoaXAoc2VsZiwgdXNlcl9pZCk6CiAgICAgICAgIiIiUmV0cmlldmVzIHRoZSA6Y2xhc3M6YFJlbGF0aW9uc2hpcGAgaWYgYXBwbGljYWJsZS4KCiAgICAgICAgLi4gZGVwcmVjYXRlZDo6IDEuNwoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgY2FuIG9ubHkgYmUgdXNlZCBieSBub24tYm90IGFjY291bnRzLgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICB1c2VyX2lkOiA6Y2xhc3M6YGludGAKICAgICAgICAgICAgVGhlIHVzZXIgSUQgdG8gY2hlY2sgaWYgd2UgaGF2ZSBhIHJlbGF0aW9uc2hpcCB3aXRoIHRoZW0uCgogICAgICAgIFJldHVybnMKICAgICAgICAtLS0tLS0tLQogICAgICAgIE9wdGlvbmFsWzpjbGFzczpgUmVsYXRpb25zaGlwYF0KICAgICAgICAgICAgVGhlIHJlbGF0aW9uc2hpcCBpZiBhdmFpbGFibGUgb3IgYGBOb25lYGAuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX3JlbGF0aW9uc2hpcHMuZ2V0KHVzZXJfaWQpCgogICAgQHByb3BlcnR5CiAgICBkZWYgcmVsYXRpb25zaGlwcyhzZWxmKToKICAgICAgICAiIiJMaXN0WzpjbGFzczpgVXNlcmBdOiBSZXR1cm5zIGFsbCB0aGUgcmVsYXRpb25zaGlwcyB0aGF0IHRoZSB1c2VyIGhhcy4KCiAgICAgICAgLi4gZGVwcmVjYXRlZDo6IDEuNwoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgY2FuIG9ubHkgYmUgdXNlZCBieSBub24tYm90IGFjY291bnRzLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBsaXN0KHNlbGYuX3JlbGF0aW9uc2hpcHMudmFsdWVzKCkpCgogICAgQHByb3BlcnR5CiAgICBkZWYgZnJpZW5kcyhzZWxmKToKICAgICAgICByIiIiTGlzdFs6Y2xhc3M6YFVzZXJgXTogUmV0dXJucyBhbGwgdGhlIHVzZXJzIHRoYXQgdGhlIHVzZXIgaXMgZnJpZW5kcyB3aXRoLgoKICAgICAgICAuLiBkZXByZWNhdGVkOjogMS43CgogICAgICAgIC4uIG5vdGU6OgoKICAgICAgICAgICAgVGhpcyBjYW4gb25seSBiZSB1c2VkIGJ5IG5vbi1ib3QgYWNjb3VudHMuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIFtyLnVzZXIgZm9yIHIgaW4gc2VsZi5fcmVsYXRpb25zaGlwcy52YWx1ZXMoKSBpZiByLnR5cGUgaXMgUmVsYXRpb25zaGlwVHlwZS5mcmllbmRdCgogICAgQHByb3BlcnR5CiAgICBkZWYgYmxvY2tlZChzZWxmKToKICAgICAgICByIiIiTGlzdFs6Y2xhc3M6YFVzZXJgXTogUmV0dXJucyBhbGwgdGhlIHVzZXJzIHRoYXQgdGhlIHVzZXIgaGFzIGJsb2NrZWQuCgogICAgICAgIC4uIGRlcHJlY2F0ZWQ6OiAxLjcKCiAgICAgICAgLi4gbm90ZTo6CgogICAgICAgICAgICBUaGlzIGNhbiBvbmx5IGJlIHVzZWQgYnkgbm9uLWJvdCBhY2NvdW50cy4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gW3IudXNlciBmb3IgciBpbiBzZWxmLl9yZWxhdGlvbnNoaXBzLnZhbHVlcygpIGlmIHIudHlwZSBpcyBSZWxhdGlvbnNoaXBUeXBlLmJsb2NrZWRdCgogICAgYXN5bmMgZGVmIGVkaXQoc2VsZiwgKipmaWVsZHMpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBFZGl0cyB0aGUgY3VycmVudCBwcm9maWxlIG9mIHRoZSBjbGllbnQuCgogICAgICAgIElmIGEgYm90IGFjY291bnQgaXMgdXNlZCB0aGVuIGEgcGFzc3dvcmQgZmllbGQgaXMgb3B0aW9uYWwsCiAgICAgICAgb3RoZXJ3aXNlIGl0IGlzIHJlcXVpcmVkLgoKICAgICAgICAuLiB3YXJuaW5nOjoKCiAgICAgICAgICAgIFRoZSB1c2VyIGFjY291bnQtb25seSBmaWVsZHMgYXJlIGRlcHJlY2F0ZWQuCgogICAgICAgIC4uIG5vdGU6OgoKICAgICAgICAgICAgVG8gdXBsb2FkIGFuIGF2YXRhciwgYSA6dGVybTpgcHk6Ynl0ZXMtbGlrZSBvYmplY3RgIG11c3QgYmUgcGFzc2VkIGluIHRoYXQKICAgICAgICAgICAgcmVwcmVzZW50cyB0aGUgaW1hZ2UgYmVpbmcgdXBsb2FkZWQuIElmIHRoaXMgaXMgZG9uZSB0aHJvdWdoIGEgZmlsZQogICAgICAgICAgICB0aGVuIHRoZSBmaWxlIG11c3QgYmUgb3BlbmVkIHZpYSBgYG9wZW4oJ3NvbWVfZmlsZW5hbWUnLCAncmInKWBgIGFuZAogICAgICAgICAgICB0aGUgOnRlcm06YHB5OmJ5dGVzLWxpa2Ugb2JqZWN0YCBpcyBnaXZlbiB0aHJvdWdoIHRoZSB1c2Ugb2YgYGBmcC5yZWFkKClgYC4KCiAgICAgICAgICAgIFRoZSBvbmx5IGltYWdlIGZvcm1hdHMgc3VwcG9ydGVkIGZvciB1cGxvYWRpbmcgaXMgSlBFRyBhbmQgUE5HLgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICBwYXNzd29yZDogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSBjdXJyZW50IHBhc3N3b3JkIGZvciB0aGUgY2xpZW50J3MgYWNjb3VudC4KICAgICAgICAgICAgT25seSBhcHBsaWNhYmxlIHRvIHVzZXIgYWNjb3VudHMuCiAgICAgICAgbmV3X3Bhc3N3b3JkOiA6Y2xhc3M6YHN0cmAKICAgICAgICAgICAgVGhlIG5ldyBwYXNzd29yZCB5b3Ugd2lzaCB0byBjaGFuZ2UgdG8uCiAgICAgICAgICAgIE9ubHkgYXBwbGljYWJsZSB0byB1c2VyIGFjY291bnRzLgogICAgICAgIGVtYWlsOiA6Y2xhc3M6YHN0cmAKICAgICAgICAgICAgVGhlIG5ldyBlbWFpbCB5b3Ugd2lzaCB0byBjaGFuZ2UgdG8uCiAgICAgICAgICAgIE9ubHkgYXBwbGljYWJsZSB0byB1c2VyIGFjY291bnRzLgogICAgICAgIGhvdXNlOiBPcHRpb25hbFs6Y2xhc3M6YEh5cGVTcXVhZEhvdXNlYF0KICAgICAgICAgICAgVGhlIGh5cGVzcXVhZCBob3VzZSB5b3Ugd2lzaCB0byBjaGFuZ2UgdG8uCiAgICAgICAgICAgIENvdWxkIGJlIGBgTm9uZWBgIHRvIGxlYXZlIHRoZSBjdXJyZW50IGhvdXNlLgogICAgICAgICAgICBPbmx5IGFwcGxpY2FibGUgdG8gdXNlciBhY2NvdW50cy4KICAgICAgICB1c2VybmFtZTogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSBuZXcgdXNlcm5hbWUgeW91IHdpc2ggdG8gY2hhbmdlIHRvLgogICAgICAgIGF2YXRhcjogOmNsYXNzOmBieXRlc2AKICAgICAgICAgICAgQSA6dGVybTpgcHk6Ynl0ZXMtbGlrZSBvYmplY3RgIHJlcHJlc2VudGluZyB0aGUgaW1hZ2UgdG8gdXBsb2FkLgogICAgICAgICAgICBDb3VsZCBiZSBgYE5vbmVgYCB0byBkZW5vdGUgbm8gYXZhdGFyLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIEVkaXRpbmcgeW91ciBwcm9maWxlIGZhaWxlZC4KICAgICAgICBJbnZhbGlkQXJndW1lbnQKICAgICAgICAgICAgV3JvbmcgaW1hZ2UgZm9ybWF0IHBhc3NlZCBmb3IgYGBhdmF0YXJgYC4KICAgICAgICBDbGllbnRFeGNlcHRpb24KICAgICAgICAgICAgUGFzc3dvcmQgaXMgcmVxdWlyZWQgZm9yIG5vbi1ib3QgYWNjb3VudHMuCiAgICAgICAgICAgIEhvdXNlIGZpZWxkIHdhcyBub3QgYSBIeXBlU3F1YWRIb3VzZS4KICAgICAgICAiIiIKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBhdmF0YXJfYnl0ZXMgPSBmaWVsZHNbJ2F2YXRhciddCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICBhdmF0YXIgPSBzZWxmLmF2YXRhcgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGF2YXRhcl9ieXRlcyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGF2YXRhciA9IF9ieXRlc190b19iYXNlNjRfZGF0YShhdmF0YXJfYnl0ZXMpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhdmF0YXIgPSBOb25lCgogICAgICAgIG5vdF9ib3RfYWNjb3VudCA9IG5vdCBzZWxmLmJvdAogICAgICAgIHBhc3N3b3JkID0gZmllbGRzLmdldCgncGFzc3dvcmQnKQogICAgICAgIGlmIG5vdF9ib3RfYWNjb3VudCBhbmQgcGFzc3dvcmQgaXMgTm9uZToKICAgICAgICAgICAgcmFpc2UgQ2xpZW50RXhjZXB0aW9uKCdQYXNzd29yZCBpcyByZXF1aXJlZCBmb3Igbm9uLWJvdCBhY2NvdW50cy4nKQoKICAgICAgICBhcmdzID0gewogICAgICAgICAgICAncGFzc3dvcmQnOiBwYXNzd29yZCwKICAgICAgICAgICAgJ3VzZXJuYW1lJzogZmllbGRzLmdldCgndXNlcm5hbWUnLCBzZWxmLm5hbWUpLAogICAgICAgICAgICAnYXZhdGFyJzogYXZhdGFyCiAgICAgICAgfQoKICAgICAgICBpZiBub3RfYm90X2FjY291bnQ6CiAgICAgICAgICAgIGFyZ3NbJ2VtYWlsJ10gPSBmaWVsZHMuZ2V0KCdlbWFpbCcsIHNlbGYuZW1haWwpCgogICAgICAgICAgICBpZiAnbmV3X3Bhc3N3b3JkJyBpbiBmaWVsZHM6CiAgICAgICAgICAgICAgICBhcmdzWyduZXdfcGFzc3dvcmQnXSA9IGZpZWxkc1snbmV3X3Bhc3N3b3JkJ10KCiAgICAgICAgaHR0cCA9IHNlbGYuX3N0YXRlLmh0dHAKCiAgICAgICAgaWYgJ2hvdXNlJyBpbiBmaWVsZHM6CiAgICAgICAgICAgIGhvdXNlID0gZmllbGRzWydob3VzZSddCiAgICAgICAgICAgIGlmIGhvdXNlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBhd2FpdCBodHRwLmxlYXZlX2h5cGVzcXVhZF9ob3VzZSgpCiAgICAgICAgICAgIGVsaWYgbm90IGlzaW5zdGFuY2UoaG91c2UsIEh5cGVTcXVhZEhvdXNlKToKICAgICAgICAgICAgICAgIHJhaXNlIENsaWVudEV4Y2VwdGlvbignYGhvdXNlYCBwYXJhbWV0ZXIgd2FzIG5vdCBhIEh5cGVTcXVhZEhvdXNlJykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHZhbHVlID0gaG91c2UudmFsdWUKCiAgICAgICAgICAgIGF3YWl0IGh0dHAuY2hhbmdlX2h5cGVzcXVhZF9ob3VzZSh2YWx1ZSkKCiAgICAgICAgZGF0YSA9IGF3YWl0IGh0dHAuZWRpdF9wcm9maWxlKCoqYXJncykKICAgICAgICBpZiBub3RfYm90X2FjY291bnQ6CiAgICAgICAgICAgIHNlbGYuZW1haWwgPSBkYXRhWydlbWFpbCddCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGh0dHAuX3Rva2VuKGRhdGFbJ3Rva2VuJ10sIGJvdD1GYWxzZSkKICAgICAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICBzZWxmLl91cGRhdGUoZGF0YSkKCiAgICBAZGVwcmVjYXRlZCgpCiAgICBhc3luYyBkZWYgY3JlYXRlX2dyb3VwKHNlbGYsICpyZWNpcGllbnRzKToKICAgICAgICByIiIifGNvcm98CgogICAgICAgIENyZWF0ZXMgYSBncm91cCBkaXJlY3QgbWVzc2FnZSB3aXRoIHRoZSByZWNpcGllbnRzCiAgICAgICAgcHJvdmlkZWQuIFRoZXNlIHJlY2lwaWVudHMgbXVzdCBiZSBoYXZlIGEgcmVsYXRpb25zaGlwCiAgICAgICAgb2YgdHlwZSA6YXR0cjpgUmVsYXRpb25zaGlwVHlwZS5mcmllbmRgLgoKICAgICAgICAuLiBkZXByZWNhdGVkOjogMS43CgogICAgICAgIC4uIG5vdGU6OgoKICAgICAgICAgICAgVGhpcyBjYW4gb25seSBiZSB1c2VkIGJ5IG5vbi1ib3QgYWNjb3VudHMuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIFwqcmVjaXBpZW50czogOmNsYXNzOmBVc2VyYAogICAgICAgICAgICBBbiBhcmd1bWVudCA6Y2xhc3M6YGxpc3RgIG9mIDpjbGFzczpgVXNlcmAgdG8gaGF2ZSBpbgogICAgICAgICAgICB5b3VyIGdyb3VwLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tCiAgICAgICAgSFRUUEV4Y2VwdGlvbgogICAgICAgICAgICBGYWlsZWQgdG8gY3JlYXRlIHRoZSBncm91cCBkaXJlY3QgbWVzc2FnZS4KICAgICAgICBDbGllbnRFeGNlcHRpb24KICAgICAgICAgICAgQXR0ZW1wdGVkIHRvIGNyZWF0ZSBhIGdyb3VwIHdpdGggb25seSBvbmUgcmVjaXBpZW50LgogICAgICAgICAgICBUaGlzIGRvZXMgbm90IGluY2x1ZGUgeW91cnNlbGYuCgogICAgICAgIFJldHVybnMKICAgICAgICAtLS0tLS0tCiAgICAgICAgOmNsYXNzOmBHcm91cENoYW5uZWxgCiAgICAgICAgICAgIFRoZSBuZXcgZ3JvdXAgY2hhbm5lbC4KICAgICAgICAiIiIKCiAgICAgICAgZnJvbSAuY2hhbm5lbCBpbXBvcnQgR3JvdXBDaGFubmVsCgogICAgICAgIGlmIGxlbihyZWNpcGllbnRzKSA8IDI6CiAgICAgICAgICAgIHJhaXNlIENsaWVudEV4Y2VwdGlvbignWW91IG11c3QgaGF2ZSB0d28gb3IgbW9yZSByZWNpcGllbnRzIHRvIGNyZWF0ZSBhIGdyb3VwLicpCgogICAgICAgIHVzZXJzID0gW3N0cih1LmlkKSBmb3IgdSBpbiByZWNpcGllbnRzXQogICAgICAgIGRhdGEgPSBhd2FpdCBzZWxmLl9zdGF0ZS5odHRwLnN0YXJ0X2dyb3VwKHNlbGYuaWQsIHVzZXJzKQogICAgICAgIHJldHVybiBHcm91cENoYW5uZWwobWU9c2VsZiwgZGF0YT1kYXRhLCBzdGF0ZT1zZWxmLl9zdGF0ZSkKCiAgICBAZGVwcmVjYXRlZCgpCiAgICBhc3luYyBkZWYgZWRpdF9zZXR0aW5ncyhzZWxmLCAqKmt3YXJncyk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIEVkaXRzIHRoZSBjbGllbnQgdXNlcidzIHNldHRpbmdzLgoKICAgICAgICAuLiBkZXByZWNhdGVkOjogMS43CgogICAgICAgIC4uIG5vdGU6OgoKICAgICAgICAgICAgVGhpcyBjYW4gb25seSBiZSB1c2VkIGJ5IG5vbi1ib3QgYWNjb3VudHMuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tCiAgICAgICAgYWZrX3RpbWVvdXQ6IDpjbGFzczpgaW50YAogICAgICAgICAgICBIb3cgbG9uZyAoaW4gc2Vjb25kcykgdGhlIHVzZXIgbmVlZHMgdG8gYmUgQUZLIHVudGlsIERpc2NvcmQKICAgICAgICAgICAgc2VuZHMgcHVzaCBub3RpZmljYXRpb25zIHRvIHlvdXIgbW9iaWxlIGRldmljZS4KICAgICAgICBhbmltYXRlX2Vtb2ppczogOmNsYXNzOmBib29sYAogICAgICAgICAgICBXaGV0aGVyIG9yIG5vdCB0byBhbmltYXRlIGVtb2ppcyBpbiB0aGUgY2hhdC4KICAgICAgICBjb252ZXJ0X2Vtb3RpY29uczogOmNsYXNzOmBib29sYAogICAgICAgICAgICBXaGV0aGVyIG9yIG5vdCB0byBhdXRvbWF0aWNhbGx5IGNvbnZlcnQgZW1vdGljb25zIGludG8gZW1vamlzLgogICAgICAgICAgICBlLmcuIDotKSAtPiDwn5iDCiAgICAgICAgZGVmYXVsdF9ndWlsZHNfcmVzdHJpY3RlZDogOmNsYXNzOmBib29sYAogICAgICAgICAgICBXaGV0aGVyIG9yIG5vdCB0byBhdXRvbWF0aWNhbGx5IGRpc2FibGUgRE1zIGJldHdlZW4geW91IGFuZAogICAgICAgICAgICBtZW1iZXJzIG9mIG5ldyBndWlsZHMgeW91IGpvaW4uCiAgICAgICAgZGV0ZWN0X3BsYXRmb3JtX2FjY291bnRzOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgb3Igbm90IHRvIGF1dG9tYXRpY2FsbHkgZGV0ZWN0IGFjY291bnRzIGZyb20gc2VydmljZXMKICAgICAgICAgICAgbGlrZSBTdGVhbSBhbmQgQmxpenphcmQgd2hlbiB5b3Ugb3BlbiB0aGUgRGlzY29yZCBjbGllbnQuCiAgICAgICAgZGV2ZWxvcGVyX21vZGU6IDpjbGFzczpgYm9vbGAKICAgICAgICAgICAgV2hldGhlciBvciBub3QgdG8gZW5hYmxlIGRldmVsb3BlciBtb2RlLgogICAgICAgIGRpc2FibGVfZ2FtZXNfdGFiOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgb3Igbm90IHRvIGRpc2FibGUgdGhlIHNob3dpbmcgb2YgdGhlIEdhbWVzIHRhYi4KICAgICAgICBlbmFibGVfdHRzX2NvbW1hbmQ6IDpjbGFzczpgYm9vbGAKICAgICAgICAgICAgV2hldGhlciBvciBub3QgdG8gYWxsb3cgdHRzIG1lc3NhZ2VzIHRvIGJlIHBsYXllZC9zZW50LgogICAgICAgIGV4cGxpY2l0X2NvbnRlbnRfZmlsdGVyOiA6Y2xhc3M6YFVzZXJDb250ZW50RmlsdGVyYAogICAgICAgICAgICBUaGUgZmlsdGVyIGZvciBleHBsaWNpdCBjb250ZW50IGluIGFsbCBtZXNzYWdlcy4KICAgICAgICBmcmllbmRfc291cmNlX2ZsYWdzOiA6Y2xhc3M6YEZyaWVuZEZsYWdzYAogICAgICAgICAgICBXaG8gY2FuIGFkZCB5b3UgYXMgYSBmcmllbmQuCiAgICAgICAgZ2lmX2F1dG9fcGxheTogOmNsYXNzOmBib29sYAogICAgICAgICAgICBXaGV0aGVyIG9yIG5vdCB0byBhdXRvbWF0aWNhbGx5IHBsYXkgZ2lmcyB0aGF0IGFyZSBpbiB0aGUgY2hhdC4KICAgICAgICBndWlsZF9wb3NpdGlvbnM6IExpc3RbOmNsYXNzOmBhYmMuU25vd2ZsYWtlYF0KICAgICAgICAgICAgQSBsaXN0IG9mIGd1aWxkcyBpbiBvcmRlciBvZiB0aGUgZ3VpbGQvZ3VpbGQgaWNvbnMgdGhhdCBhcmUgb24KICAgICAgICAgICAgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBVSS4KICAgICAgICBpbmxpbmVfYXR0YWNobWVudF9tZWRpYTogOmNsYXNzOmBib29sYAogICAgICAgICAgICBXaGV0aGVyIG9yIG5vdCB0byBkaXNwbGF5IGF0dGFjaG1lbnRzIHdoZW4gdGhleSBhcmUgdXBsb2FkZWQgaW4gY2hhdC4KICAgICAgICBpbmxpbmVfZW1iZWRfbWVkaWE6IDpjbGFzczpgYm9vbGAKICAgICAgICAgICAgV2hldGhlciBvciBub3QgdG8gZGlzcGxheSB2aWRlb3MgYW5kIGltYWdlcyBmcm9tIGxpbmtzIHBvc3RlZCBpbiBjaGF0LgogICAgICAgIGxvY2FsZTogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSA6cmZjOmAzMDY2YCBsYW5ndWFnZSBpZGVudGlmaWVyIG9mIHRoZSBsb2NhbGUgdG8gdXNlIGZvciB0aGUgbGFuZ3VhZ2UKICAgICAgICAgICAgb2YgdGhlIERpc2NvcmQgY2xpZW50LgogICAgICAgIG1lc3NhZ2VfZGlzcGxheV9jb21wYWN0OiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgb3Igbm90IHRvIHVzZSB0aGUgY29tcGFjdCBEaXNjb3JkIGRpc3BsYXkgbW9kZS4KICAgICAgICByZW5kZXJfZW1iZWRzOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgb3Igbm90IHRvIHJlbmRlciBlbWJlZHMgdGhhdCBhcmUgc2VudCBpbiB0aGUgY2hhdC4KICAgICAgICByZW5kZXJfcmVhY3Rpb25zOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgb3Igbm90IHRvIHJlbmRlciByZWFjdGlvbnMgdGhhdCBhcmUgYWRkZWQgdG8gbWVzc2FnZXMuCiAgICAgICAgcmVzdHJpY3RlZF9ndWlsZHM6IExpc3RbOmNsYXNzOmBhYmMuU25vd2ZsYWtlYF0KICAgICAgICAgICAgQSBsaXN0IG9mIGd1aWxkcyB0aGF0IHlvdSB3aWxsIG5vdCByZWNlaXZlIERNcyBmcm9tLgogICAgICAgIHNob3dfY3VycmVudF9nYW1lOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgb3Igbm90IHRvIGRpc3BsYXkgdGhlIGdhbWUgdGhhdCB5b3UgYXJlIGN1cnJlbnRseSBwbGF5aW5nLgogICAgICAgIHN0YXR1czogOmNsYXNzOmBTdGF0dXNgCiAgICAgICAgICAgIFRoZSBjbGllbnRzIHN0YXR1cyB0aGF0IGlzIHNob3duIHRvIG90aGVycy4KICAgICAgICB0aGVtZTogOmNsYXNzOmBUaGVtZWAKICAgICAgICAgICAgVGhlIHRoZW1lIG9mIHRoZSBEaXNjb3JkIFVJLgogICAgICAgIHRpbWV6b25lX29mZnNldDogOmNsYXNzOmBpbnRgCiAgICAgICAgICAgIFRoZSB0aW1lem9uZSBvZmZzZXQgdG8gdXNlLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tCiAgICAgICAgSFRUUEV4Y2VwdGlvbgogICAgICAgICAgICBFZGl0aW5nIHRoZSBzZXR0aW5ncyBmYWlsZWQuCiAgICAgICAgRm9yYmlkZGVuCiAgICAgICAgICAgIFRoZSBjbGllbnQgaXMgYSBib3QgdXNlciBhbmQgbm90IGEgdXNlciBhY2NvdW50LgoKICAgICAgICBSZXR1cm5zCiAgICAgICAgLS0tLS0tLQogICAgICAgIDpjbGFzczpgZGljdGAKICAgICAgICAgICAgVGhlIGNsaWVudCB1c2VyJ3MgdXBkYXRlZCBzZXR0aW5ncy4KICAgICAgICAiIiIKICAgICAgICBwYXlsb2FkID0ge30KCiAgICAgICAgY29udGVudF9maWx0ZXIgPSBrd2FyZ3MucG9wKCdleHBsaWNpdF9jb250ZW50X2ZpbHRlcicsIE5vbmUpCiAgICAgICAgaWYgY29udGVudF9maWx0ZXI6CiAgICAgICAgICAgIHBheWxvYWQudXBkYXRlKHsnZXhwbGljaXRfY29udGVudF9maWx0ZXInOiBjb250ZW50X2ZpbHRlci52YWx1ZX0pCgogICAgICAgIGZyaWVuZF9mbGFncyA9IGt3YXJncy5wb3AoJ2ZyaWVuZF9zb3VyY2VfZmxhZ3MnLCBOb25lKQogICAgICAgIGlmIGZyaWVuZF9mbGFnczoKICAgICAgICAgICAgZGljdHMgPSBbe30sIHsnbXV0dWFsX2d1aWxkcyc6IFRydWV9LCB7J211dHVhbF9mcmllbmRzJzogVHJ1ZX0sCiAgICAgICAgICAgIHsnbXV0dWFsX2d1aWxkcyc6IFRydWUsICdtdXR1YWxfZnJpZW5kcyc6IFRydWV9LCB7J2FsbCc6IFRydWV9XQogICAgICAgICAgICBwYXlsb2FkLnVwZGF0ZSh7J2ZyaWVuZF9zb3VyY2VfZmxhZ3MnOiBkaWN0c1tmcmllbmRfZmxhZ3MudmFsdWVdfSkKCiAgICAgICAgZ3VpbGRfcG9zaXRpb25zID0ga3dhcmdzLnBvcCgnZ3VpbGRfcG9zaXRpb25zJywgTm9uZSkKICAgICAgICBpZiBndWlsZF9wb3NpdGlvbnM6CiAgICAgICAgICAgIGd1aWxkX3Bvc2l0aW9ucyA9IFtzdHIoeC5pZCkgZm9yIHggaW4gZ3VpbGRfcG9zaXRpb25zXQogICAgICAgICAgICBwYXlsb2FkLnVwZGF0ZSh7J2d1aWxkX3Bvc2l0aW9ucyc6IGd1aWxkX3Bvc2l0aW9uc30pCgogICAgICAgIHJlc3RyaWN0ZWRfZ3VpbGRzID0ga3dhcmdzLnBvcCgncmVzdHJpY3RlZF9ndWlsZHMnLCBOb25lKQogICAgICAgIGlmIHJlc3RyaWN0ZWRfZ3VpbGRzOgogICAgICAgICAgICByZXN0cmljdGVkX2d1aWxkcyA9IFtzdHIoeC5pZCkgZm9yIHggaW4gcmVzdHJpY3RlZF9ndWlsZHNdCiAgICAgICAgICAgIHBheWxvYWQudXBkYXRlKHsncmVzdHJpY3RlZF9ndWlsZHMnOiByZXN0cmljdGVkX2d1aWxkc30pCgogICAgICAgIHN0YXR1cyA9IGt3YXJncy5wb3AoJ3N0YXR1cycsIE5vbmUpCiAgICAgICAgaWYgc3RhdHVzOgogICAgICAgICAgICBwYXlsb2FkLnVwZGF0ZSh7J3N0YXR1cyc6IHN0YXR1cy52YWx1ZX0pCgogICAgICAgIHRoZW1lID0ga3dhcmdzLnBvcCgndGhlbWUnLCBOb25lKQogICAgICAgIGlmIHRoZW1lOgogICAgICAgICAgICBwYXlsb2FkLnVwZGF0ZSh7J3RoZW1lJzogdGhlbWUudmFsdWV9KQoKICAgICAgICBwYXlsb2FkLnVwZGF0ZShrd2FyZ3MpCgogICAgICAgIGRhdGEgPSBhd2FpdCBzZWxmLl9zdGF0ZS5odHRwLmVkaXRfc2V0dGluZ3MoKipwYXlsb2FkKQogICAgICAgIHJldHVybiBkYXRhCgpjbGFzcyBVc2VyKEJhc2VVc2VyLCBkaXNjb3JkLmFiYy5NZXNzYWdlYWJsZSk6CiAgICAiIiJSZXByZXNlbnRzIGEgRGlzY29yZCB1c2VyLgoKICAgIC4uIGNvbnRhaW5lcjo6IG9wZXJhdGlvbnMKCiAgICAgICAgLi4gZGVzY3JpYmU6OiB4ID09IHkKCiAgICAgICAgICAgIENoZWNrcyBpZiB0d28gdXNlcnMgYXJlIGVxdWFsLgoKICAgICAgICAuLiBkZXNjcmliZTo6IHggIT0geQoKICAgICAgICAgICAgQ2hlY2tzIGlmIHR3byB1c2VycyBhcmUgbm90IGVxdWFsLgoKICAgICAgICAuLiBkZXNjcmliZTo6IGhhc2goeCkKCiAgICAgICAgICAgIFJldHVybiB0aGUgdXNlcidzIGhhc2guCgogICAgICAgIC4uIGRlc2NyaWJlOjogc3RyKHgpCgogICAgICAgICAgICBSZXR1cm5zIHRoZSB1c2VyJ3MgbmFtZSB3aXRoIGRpc2NyaW1pbmF0b3IuCgogICAgQXR0cmlidXRlcwogICAgLS0tLS0tLS0tLS0KICAgIG5hbWU6IDpjbGFzczpgc3RyYAogICAgICAgIFRoZSB1c2VyJ3MgdXNlcm5hbWUuCiAgICBpZDogOmNsYXNzOmBpbnRgCiAgICAgICAgVGhlIHVzZXIncyB1bmlxdWUgSUQuCiAgICBkaXNjcmltaW5hdG9yOiA6Y2xhc3M6YHN0cmAKICAgICAgICBUaGUgdXNlcidzIGRpc2NyaW1pbmF0b3IuIFRoaXMgaXMgZ2l2ZW4gd2hlbiB0aGUgdXNlcm5hbWUgaGFzIGNvbmZsaWN0cy4KICAgIGF2YXRhcjogT3B0aW9uYWxbOmNsYXNzOmBzdHJgXQogICAgICAgIFRoZSBhdmF0YXIgaGFzaCB0aGUgdXNlciBoYXMuIENvdWxkIGJlIE5vbmUuCiAgICBib3Q6IDpjbGFzczpgYm9vbGAKICAgICAgICBTcGVjaWZpZXMgaWYgdGhlIHVzZXIgaXMgYSBib3QgYWNjb3VudC4KICAgIHN5c3RlbTogOmNsYXNzOmBib29sYAogICAgICAgIFNwZWNpZmllcyBpZiB0aGUgdXNlciBpcyBhIHN5c3RlbSB1c2VyIChpLmUuIHJlcHJlc2VudHMgRGlzY29yZCBvZmZpY2lhbGx5KS4KICAgICIiIgoKICAgIF9fc2xvdHNfXyA9IEJhc2VVc2VyLl9fc2xvdHNfXyArICgnX193ZWFrcmVmX18nLCkKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgcmV0dXJuICc8VXNlciBpZD17MC5pZH0gbmFtZT17MC5uYW1lIXJ9IGRpc2NyaW1pbmF0b3I9ezAuZGlzY3JpbWluYXRvciFyfSBib3Q9ezAuYm90fT4nLmZvcm1hdChzZWxmKQoKICAgIGFzeW5jIGRlZiBfZ2V0X2NoYW5uZWwoc2VsZik6CiAgICAgICAgY2ggPSBhd2FpdCBzZWxmLmNyZWF0ZV9kbSgpCiAgICAgICAgcmV0dXJuIGNoCgogICAgQHByb3BlcnR5CiAgICBkZWYgZG1fY2hhbm5lbChzZWxmKToKICAgICAgICAiIiJPcHRpb25hbFs6Y2xhc3M6YERNQ2hhbm5lbGBdOiBSZXR1cm5zIHRoZSBjaGFubmVsIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHVzZXIgaWYgaXQgZXhpc3RzLgoKICAgICAgICBJZiB0aGlzIHJldHVybnMgYGBOb25lYGAsIHlvdSBjYW4gY3JlYXRlIGEgRE0gY2hhbm5lbCBieSBjYWxsaW5nIHRoZQogICAgICAgIDptZXRoOmBjcmVhdGVfZG1gIGNvcm91dGluZSBmdW5jdGlvbi4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fc3RhdGUuX2dldF9wcml2YXRlX2NoYW5uZWxfYnlfdXNlcihzZWxmLmlkKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIG11dHVhbF9ndWlsZHMoc2VsZik6CiAgICAgICAgIiIiTGlzdFs6Y2xhc3M6YEd1aWxkYF06IFRoZSBndWlsZHMgdGhhdCB0aGUgdXNlciBzaGFyZXMgd2l0aCB0aGUgY2xpZW50LgoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgd2lsbCBvbmx5IHJldHVybiBtdXR1YWwgZ3VpbGRzIHdpdGhpbiB0aGUgY2xpZW50J3MgaW50ZXJuYWwgY2FjaGUuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNwogICAgICAgICIiIgogICAgICAgIHJldHVybiBbZ3VpbGQgZm9yIGd1aWxkIGluIHNlbGYuX3N0YXRlLl9ndWlsZHMudmFsdWVzKCkgaWYgZ3VpbGQuZ2V0X21lbWJlcihzZWxmLmlkKV0KCiAgICBhc3luYyBkZWYgY3JlYXRlX2RtKHNlbGYpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBDcmVhdGVzIGEgOmNsYXNzOmBETUNoYW5uZWxgIHdpdGggdGhpcyB1c2VyLgoKICAgICAgICBUaGlzIHNob3VsZCBiZSByYXJlbHkgY2FsbGVkLCBhcyB0aGlzIGlzIGRvbmUgdHJhbnNwYXJlbnRseSBmb3IgbW9zdAogICAgICAgIHBlb3BsZS4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0KICAgICAgICA6Y2xhc3M6YC5ETUNoYW5uZWxgCiAgICAgICAgICAgIFRoZSBjaGFubmVsIHRoYXQgd2FzIGNyZWF0ZWQuCiAgICAgICAgIiIiCiAgICAgICAgZm91bmQgPSBzZWxmLmRtX2NoYW5uZWwKICAgICAgICBpZiBmb3VuZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0dXJuIGZvdW5kCgogICAgICAgIHN0YXRlID0gc2VsZi5fc3RhdGUKICAgICAgICBkYXRhID0gYXdhaXQgc3RhdGUuaHR0cC5zdGFydF9wcml2YXRlX21lc3NhZ2Uoc2VsZi5pZCkKICAgICAgICByZXR1cm4gc3RhdGUuYWRkX2RtX2NoYW5uZWwoZGF0YSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiByZWxhdGlvbnNoaXAoc2VsZik6CiAgICAgICAgIiIiT3B0aW9uYWxbOmNsYXNzOmBSZWxhdGlvbnNoaXBgXTogUmV0dXJucyB0aGUgOmNsYXNzOmBSZWxhdGlvbnNoaXBgIHdpdGggdGhpcyB1c2VyIGlmIGFwcGxpY2FibGUsIGBgTm9uZWBgIG90aGVyd2lzZS4KCiAgICAgICAgLi4gZGVwcmVjYXRlZDo6IDEuNwoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgY2FuIG9ubHkgYmUgdXNlZCBieSBub24tYm90IGFjY291bnRzLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9zdGF0ZS51c2VyLmdldF9yZWxhdGlvbnNoaXAoc2VsZi5pZCkKCiAgICBAZGVwcmVjYXRlZCgpCiAgICBhc3luYyBkZWYgbXV0dWFsX2ZyaWVuZHMoc2VsZik6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIEdldHMgYWxsIG11dHVhbCBmcmllbmRzIG9mIHRoaXMgdXNlci4KCiAgICAgICAgLi4gZGVwcmVjYXRlZDo6IDEuNwoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgY2FuIG9ubHkgYmUgdXNlZCBieSBub24tYm90IGFjY291bnRzLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tCiAgICAgICAgRm9yYmlkZGVuCiAgICAgICAgICAgIE5vdCBhbGxvd2VkIHRvIGdldCBtdXR1YWwgZnJpZW5kcyBvZiB0aGlzIHVzZXIuCiAgICAgICAgSFRUUEV4Y2VwdGlvbgogICAgICAgICAgICBHZXR0aW5nIG11dHVhbCBmcmllbmRzIGZhaWxlZC4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0KICAgICAgICBMaXN0WzpjbGFzczpgVXNlcmBdCiAgICAgICAgICAgIFRoZSB1c2VycyB0aGF0IGFyZSBtdXR1YWwgZnJpZW5kcy4KICAgICAgICAiIiIKICAgICAgICBzdGF0ZSA9IHNlbGYuX3N0YXRlCiAgICAgICAgbXV0dWFscyA9IGF3YWl0IHN0YXRlLmh0dHAuZ2V0X211dHVhbF9mcmllbmRzKHNlbGYuaWQpCiAgICAgICAgcmV0dXJuIFtVc2VyKHN0YXRlPXN0YXRlLCBkYXRhPWZyaWVuZCkgZm9yIGZyaWVuZCBpbiBtdXR1YWxzXQoKICAgIEBkZXByZWNhdGVkKCkKICAgIGRlZiBpc19mcmllbmQoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogQ2hlY2tzIGlmIHRoZSB1c2VyIGlzIHlvdXIgZnJpZW5kLgoKICAgICAgICAuLiBkZXByZWNhdGVkOjogMS43CgogICAgICAgIC4uIG5vdGU6OgoKICAgICAgICAgICAgVGhpcyBjYW4gb25seSBiZSB1c2VkIGJ5IG5vbi1ib3QgYWNjb3VudHMuCiAgICAgICAgIiIiCiAgICAgICAgciA9IHNlbGYucmVsYXRpb25zaGlwCiAgICAgICAgaWYgciBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICByZXR1cm4gci50eXBlIGlzIFJlbGF0aW9uc2hpcFR5cGUuZnJpZW5kCgogICAgQGRlcHJlY2F0ZWQoKQogICAgZGVmIGlzX2Jsb2NrZWQoc2VsZik6CiAgICAgICAgIiIiOmNsYXNzOmBib29sYDogQ2hlY2tzIGlmIHRoZSB1c2VyIGlzIGJsb2NrZWQuCgogICAgICAgIC4uIGRlcHJlY2F0ZWQ6OiAxLjcKCiAgICAgICAgLi4gbm90ZTo6CgogICAgICAgICAgICBUaGlzIGNhbiBvbmx5IGJlIHVzZWQgYnkgbm9uLWJvdCBhY2NvdW50cy4KICAgICAgICAiIiIKICAgICAgICByID0gc2VsZi5yZWxhdGlvbnNoaXAKICAgICAgICBpZiByIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIHJldHVybiByLnR5cGUgaXMgUmVsYXRpb25zaGlwVHlwZS5ibG9ja2VkCgogICAgQGRlcHJlY2F0ZWQoKQogICAgYXN5bmMgZGVmIGJsb2NrKHNlbGYpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBCbG9ja3MgdGhlIHVzZXIuCgogICAgICAgIC4uIGRlcHJlY2F0ZWQ6OiAxLjcKCiAgICAgICAgLi4gbm90ZTo6CgogICAgICAgICAgICBUaGlzIGNhbiBvbmx5IGJlIHVzZWQgYnkgbm9uLWJvdCBhY2NvdW50cy4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBOb3QgYWxsb3dlZCB0byBibG9jayB0aGlzIHVzZXIuCiAgICAgICAgSFRUUEV4Y2VwdGlvbgogICAgICAgICAgICBCbG9ja2luZyB0aGUgdXNlciBmYWlsZWQuCiAgICAgICAgIiIiCgogICAgICAgIGF3YWl0IHNlbGYuX3N0YXRlLmh0dHAuYWRkX3JlbGF0aW9uc2hpcChzZWxmLmlkLCB0eXBlPVJlbGF0aW9uc2hpcFR5cGUuYmxvY2tlZC52YWx1ZSkKCiAgICBAZGVwcmVjYXRlZCgpCiAgICBhc3luYyBkZWYgdW5ibG9jayhzZWxmKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgVW5ibG9ja3MgdGhlIHVzZXIuCgogICAgICAgIC4uIGRlcHJlY2F0ZWQ6OiAxLjcKCiAgICAgICAgLi4gbm90ZTo6CgogICAgICAgICAgICBUaGlzIGNhbiBvbmx5IGJlIHVzZWQgYnkgbm9uLWJvdCBhY2NvdW50cy4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBOb3QgYWxsb3dlZCB0byB1bmJsb2NrIHRoaXMgdXNlci4KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIFVuYmxvY2tpbmcgdGhlIHVzZXIgZmFpbGVkLgogICAgICAgICIiIgogICAgICAgIGF3YWl0IHNlbGYuX3N0YXRlLmh0dHAucmVtb3ZlX3JlbGF0aW9uc2hpcChzZWxmLmlkKQoKICAgIEBkZXByZWNhdGVkKCkKICAgIGFzeW5jIGRlZiByZW1vdmVfZnJpZW5kKHNlbGYpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBSZW1vdmVzIHRoZSB1c2VyIGFzIGEgZnJpZW5kLgoKICAgICAgICAuLiBkZXByZWNhdGVkOjogMS43CgogICAgICAgIC4uIG5vdGU6OgoKICAgICAgICAgICAgVGhpcyBjYW4gb25seSBiZSB1c2VkIGJ5IG5vbi1ib3QgYWNjb3VudHMuCgogICAgICAgIFJhaXNlcwogICAgICAgIC0tLS0tLS0KICAgICAgICBGb3JiaWRkZW4KICAgICAgICAgICAgTm90IGFsbG93ZWQgdG8gcmVtb3ZlIHRoaXMgdXNlciBhcyBhIGZyaWVuZC4KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIFJlbW92aW5nIHRoZSB1c2VyIGFzIGEgZnJpZW5kIGZhaWxlZC4KICAgICAgICAiIiIKICAgICAgICBhd2FpdCBzZWxmLl9zdGF0ZS5odHRwLnJlbW92ZV9yZWxhdGlvbnNoaXAoc2VsZi5pZCkKCiAgICBAZGVwcmVjYXRlZCgpCiAgICBhc3luYyBkZWYgc2VuZF9mcmllbmRfcmVxdWVzdChzZWxmKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgU2VuZHMgdGhlIHVzZXIgYSBmcmllbmQgcmVxdWVzdC4KCiAgICAgICAgLi4gZGVwcmVjYXRlZDo6IDEuNwoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgY2FuIG9ubHkgYmUgdXNlZCBieSBub24tYm90IGFjY291bnRzLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tCiAgICAgICAgRm9yYmlkZGVuCiAgICAgICAgICAgIE5vdCBhbGxvd2VkIHRvIHNlbmQgYSBmcmllbmQgcmVxdWVzdCB0byB0aGUgdXNlci4KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIFNlbmRpbmcgdGhlIGZyaWVuZCByZXF1ZXN0IGZhaWxlZC4KICAgICAgICAiIiIKICAgICAgICBhd2FpdCBzZWxmLl9zdGF0ZS5odHRwLnNlbmRfZnJpZW5kX3JlcXVlc3QodXNlcm5hbWU9c2VsZi5uYW1lLCBkaXNjcmltaW5hdG9yPXNlbGYuZGlzY3JpbWluYXRvcikKCiAgICBAZGVwcmVjYXRlZCgpCiAgICBhc3luYyBkZWYgcHJvZmlsZShzZWxmKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgR2V0cyB0aGUgdXNlcidzIHByb2ZpbGUuCgogICAgICAgIC4uIGRlcHJlY2F0ZWQ6OiAxLjcKCiAgICAgICAgLi4gbm90ZTo6CgogICAgICAgICAgICBUaGlzIGNhbiBvbmx5IGJlIHVzZWQgYnkgbm9uLWJvdCBhY2NvdW50cy4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIEZvcmJpZGRlbgogICAgICAgICAgICBOb3QgYWxsb3dlZCB0byBmZXRjaCBwcm9maWxlcy4KICAgICAgICBIVFRQRXhjZXB0aW9uCiAgICAgICAgICAgIEZldGNoaW5nIHRoZSBwcm9maWxlIGZhaWxlZC4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgOmNsYXNzOmBQcm9maWxlYAogICAgICAgICAgICBUaGUgcHJvZmlsZSBvZiB0aGUgdXNlci4KICAgICAgICAiIiIKCiAgICAgICAgc3RhdGUgPSBzZWxmLl9zdGF0ZQogICAgICAgIGRhdGEgPSBhd2FpdCBzdGF0ZS5odHRwLmdldF91c2VyX3Byb2ZpbGUoc2VsZi5pZCkKCiAgICAgICAgZGVmIHRyYW5zZm9ybShkKToKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLl9nZXRfZ3VpbGQoaW50KGRbJ2lkJ10pKQoKICAgICAgICBzaW5jZSA9IGRhdGEuZ2V0KCdwcmVtaXVtX3NpbmNlJykKICAgICAgICBtdXR1YWxfZ3VpbGRzID0gbGlzdChmaWx0ZXIoTm9uZSwgbWFwKHRyYW5zZm9ybSwgZGF0YS5nZXQoJ211dHVhbF9ndWlsZHMnLCBbXSkpKSkKICAgICAgICByZXR1cm4gUHJvZmlsZShmbGFncz1kYXRhWyd1c2VyJ10uZ2V0KCdmbGFncycsIDApLAogICAgICAgICAgICAgICAgICAgICAgIHByZW1pdW1fc2luY2U9cGFyc2VfdGltZShzaW5jZSksCiAgICAgICAgICAgICAgICAgICAgICAgbXV0dWFsX2d1aWxkcz1tdXR1YWxfZ3VpbGRzLAogICAgICAgICAgICAgICAgICAgICAgIHVzZXI9c2VsZiwKICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0ZWRfYWNjb3VudHM9ZGF0YVsnY29ubmVjdGVkX2FjY291bnRzJ10pCg==
