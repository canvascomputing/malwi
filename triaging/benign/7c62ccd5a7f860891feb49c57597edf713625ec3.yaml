statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/urlib3/1.21.1/urlib3-1.21.1/urlib3-1.21.1/test/test_retry.py
  contents:
  - name: RetryTest.test_backoff_reset_after_redirect
    score: 0.0
    code: |-
      def test_backoff_reset_after_redirect(self):
              retry = Retry(total=100, redirect=5, backoff_factor=0.2)
              retry = retry.increment(method='GET')
              retry = retry.increment(method='GET')
              self.assertEqual(retry.get_backoff_time(), 0.4)
              redirect_response = HTTPResponse(status=302, headers={'location': 'test'})
              retry = retry.increment(method='GET', response=redirect_response)
              self.assertEqual(retry.get_backoff_time(), 0)
              retry = retry.increment(method='GET')
              retry = retry.increment(method='GET')
              self.assertEqual(retry.get_backoff_time(), 0.4)
    tokens: resume load_global Retry load_const INTEGER load_const INTEGER load_const FLOAT kw_names backoff_factor redirect total call store_fast retry load_fast retry load_attr increment load_const GET kw_names method call store_fast retry load_fast retry load_attr increment load_const GET kw_names method call store_fast retry load_fast self load_attr assertEqual load_fast retry load_attr STRING_LEN_S_ENT_HIGH call load_const FLOAT call pop_top load_global HTTPResponse load_const INTEGER load_const location load_const test build_map kw_names headers status call store_fast STRING_LEN_S_ENT_HIGH load_fast retry load_attr increment load_const GET load_fast STRING_LEN_S_ENT_HIGH kw_names method response call store_fast retry load_fast self load_attr assertEqual load_fast retry load_attr STRING_LEN_S_ENT_HIGH call load_const INTEGER call pop_top load_fast retry load_attr increment load_const GET kw_names method call store_fast retry load_fast retry load_attr increment load_const GET kw_names method call store_fast retry load_fast self load_attr assertEqual load_fast retry load_attr STRING_LEN_S_ENT_HIGH call load_const FLOAT call pop_top return_const None
    hash: 52129072cf1305183c5288361ad4175509a549ba7f25efc7c2441d49701f5f2e
sources:
  .repo_cache/malicious_repos/pypi_malregistry/urlib3/1.21.1/urlib3-1.21.1/urlib3-1.21.1/test/test_retry.py: aW1wb3J0IHVuaXR0ZXN0Cgpmcm9tIHVybGxpYjMucmVzcG9uc2UgaW1wb3J0IEhUVFBSZXNwb25zZQpmcm9tIHVybGxpYjMucGFja2FnZXMuc2l4Lm1vdmVzIGltcG9ydCB4cmFuZ2UKZnJvbSB1cmxsaWIzLnV0aWwucmV0cnkgaW1wb3J0IFJldHJ5LCBSZXF1ZXN0SGlzdG9yeQpmcm9tIHVybGxpYjMuZXhjZXB0aW9ucyBpbXBvcnQgKAogICAgQ29ubmVjdFRpbWVvdXRFcnJvciwKICAgIE1heFJldHJ5RXJyb3IsCiAgICBSZWFkVGltZW91dEVycm9yLAogICAgUmVzcG9uc2VFcnJvciwKKQoKCmNsYXNzIFJldHJ5VGVzdCh1bml0dGVzdC5UZXN0Q2FzZSk6CgogICAgZGVmIHRlc3Rfc3RyaW5nKHNlbGYpOgogICAgICAgICIiIiBSZXRyeSBzdHJpbmcgcmVwcmVzZW50YXRpb24gbG9va3MgdGhlIHdheSB3ZSBleHBlY3QgIiIiCiAgICAgICAgcmV0cnkgPSBSZXRyeSgpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChzdHIocmV0cnkpLAogICAgICAgICAgICAgICAgICAgICAgICAgJ1JldHJ5KHRvdGFsPTEwLCBjb25uZWN0PU5vbmUsIHJlYWQ9Tm9uZSwgcmVkaXJlY3Q9Tm9uZSwgc3RhdHVzPU5vbmUpJykKICAgICAgICBmb3IgXyBpbiByYW5nZSgzKToKICAgICAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoc3RyKHJldHJ5KSwKICAgICAgICAgICAgICAgICAgICAgICAgICdSZXRyeSh0b3RhbD03LCBjb25uZWN0PU5vbmUsIHJlYWQ9Tm9uZSwgcmVkaXJlY3Q9Tm9uZSwgc3RhdHVzPU5vbmUpJykKCiAgICBkZWYgdGVzdF9yZXRyeV9ib3RoX3NwZWNpZmllZChzZWxmKToKICAgICAgICAiIiJUb3RhbCBjYW4gd2luIGlmIGl0J3MgbG93ZXIgdGhhbiB0aGUgY29ubmVjdCB2YWx1ZSIiIgogICAgICAgIGVycm9yID0gQ29ubmVjdFRpbWVvdXRFcnJvcigpCiAgICAgICAgcmV0cnkgPSBSZXRyeShjb25uZWN0PTMsIHRvdGFsPTIpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQoZXJyb3I9ZXJyb3IpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQoZXJyb3I9ZXJyb3IpCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXRyeS5pbmNyZW1lbnQoZXJyb3I9ZXJyb3IpCiAgICAgICAgICAgIHNlbGYuZmFpbCgiRmFpbGVkIHRvIHJhaXNlIGVycm9yLiIpCiAgICAgICAgZXhjZXB0IE1heFJldHJ5RXJyb3IgYXMgZToKICAgICAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChlLnJlYXNvbiwgZXJyb3IpCgogICAgZGVmIHRlc3RfcmV0cnlfaGlnaGVyX3RvdGFsX2xvc2VzKHNlbGYpOgogICAgICAgICIiIiBBIGxvd2VyIGNvbm5lY3QgdGltZW91dCB0aGFuIHRoZSB0b3RhbCBpcyBob25vcmVkICIiIgogICAgICAgIGVycm9yID0gQ29ubmVjdFRpbWVvdXRFcnJvcigpCiAgICAgICAgcmV0cnkgPSBSZXRyeShjb25uZWN0PTIsIHRvdGFsPTMpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQoZXJyb3I9ZXJyb3IpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQoZXJyb3I9ZXJyb3IpCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoTWF4UmV0cnlFcnJvciwgcmV0cnkuaW5jcmVtZW50LCBlcnJvcj1lcnJvcikKCiAgICBkZWYgdGVzdF9yZXRyeV9oaWdoZXJfdG90YWxfbG9zZXNfdnNfcmVhZChzZWxmKToKICAgICAgICAiIiIgQSBsb3dlciByZWFkIHRpbWVvdXQgdGhhbiB0aGUgdG90YWwgaXMgaG9ub3JlZCAiIiIKICAgICAgICBlcnJvciA9IFJlYWRUaW1lb3V0RXJyb3IoTm9uZSwgIi8iLCAicmVhZCB0aW1lZCBvdXQiKQogICAgICAgIHJldHJ5ID0gUmV0cnkocmVhZD0yLCB0b3RhbD0zKQogICAgICAgIHJldHJ5ID0gcmV0cnkuaW5jcmVtZW50KG1ldGhvZD0nR0VUJywgZXJyb3I9ZXJyb3IpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnLCBlcnJvcj1lcnJvcikKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhNYXhSZXRyeUVycm9yLCByZXRyeS5pbmNyZW1lbnQsIG1ldGhvZD0nR0VUJywgZXJyb3I9ZXJyb3IpCgogICAgZGVmIHRlc3RfcmV0cnlfdG90YWxfbm9uZShzZWxmKToKICAgICAgICAiIiIgaWYgVG90YWwgaXMgbm9uZSwgY29ubmVjdCBlcnJvciBzaG91bGQgdGFrZSBwcmVjZWRlbmNlICIiIgogICAgICAgIGVycm9yID0gQ29ubmVjdFRpbWVvdXRFcnJvcigpCiAgICAgICAgcmV0cnkgPSBSZXRyeShjb25uZWN0PTIsIHRvdGFsPU5vbmUpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQoZXJyb3I9ZXJyb3IpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQoZXJyb3I9ZXJyb3IpCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXRyeS5pbmNyZW1lbnQoZXJyb3I9ZXJyb3IpCiAgICAgICAgICAgIHNlbGYuZmFpbCgiRmFpbGVkIHRvIHJhaXNlIGVycm9yLiIpCiAgICAgICAgZXhjZXB0IE1heFJldHJ5RXJyb3IgYXMgZToKICAgICAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChlLnJlYXNvbiwgZXJyb3IpCgogICAgICAgIGVycm9yID0gUmVhZFRpbWVvdXRFcnJvcihOb25lLCAiLyIsICJyZWFkIHRpbWVkIG91dCIpCiAgICAgICAgcmV0cnkgPSBSZXRyeShjb25uZWN0PTIsIHRvdGFsPU5vbmUpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnLCBlcnJvcj1lcnJvcikKICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudChtZXRob2Q9J0dFVCcsIGVycm9yPWVycm9yKQogICAgICAgIHJldHJ5ID0gcmV0cnkuaW5jcmVtZW50KG1ldGhvZD0nR0VUJywgZXJyb3I9ZXJyb3IpCiAgICAgICAgc2VsZi5hc3NlcnRGYWxzZShyZXRyeS5pc19leGhhdXN0ZWQoKSkKCiAgICBkZWYgdGVzdF9yZXRyeV9kZWZhdWx0KHNlbGYpOgogICAgICAgICIiIiBJZiBubyB2YWx1ZSBpcyBzcGVjaWZpZWQsIHNob3VsZCByZXRyeSBjb25uZWN0cyAzIHRpbWVzICIiIgogICAgICAgIHJldHJ5ID0gUmV0cnkoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkudG90YWwsIDEwKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkuY29ubmVjdCwgTm9uZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJldHJ5LnJlYWQsIE5vbmUpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXRyeS5yZWRpcmVjdCwgTm9uZSkKCiAgICAgICAgZXJyb3IgPSBDb25uZWN0VGltZW91dEVycm9yKCkKICAgICAgICByZXRyeSA9IFJldHJ5KGNvbm5lY3Q9MSkKICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudChlcnJvcj1lcnJvcikKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhNYXhSZXRyeUVycm9yLCByZXRyeS5pbmNyZW1lbnQsIGVycm9yPWVycm9yKQoKICAgICAgICByZXRyeSA9IFJldHJ5KGNvbm5lY3Q9MSkKICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudChlcnJvcj1lcnJvcikKICAgICAgICBzZWxmLmFzc2VydEZhbHNlKHJldHJ5LmlzX2V4aGF1c3RlZCgpKQoKICAgICAgICBzZWxmLmFzc2VydFRydWUoUmV0cnkoMCkucmFpc2Vfb25fcmVkaXJlY3QpCiAgICAgICAgc2VsZi5hc3NlcnRGYWxzZShSZXRyeShGYWxzZSkucmFpc2Vfb25fcmVkaXJlY3QpCgogICAgZGVmIHRlc3RfcmV0cnlfcmVhZF96ZXJvKHNlbGYpOgogICAgICAgICIiIiBObyBzZWNvbmQgY2hhbmNlcyBvbiByZWFkIHRpbWVvdXRzLCBieSBkZWZhdWx0ICIiIgogICAgICAgIGVycm9yID0gUmVhZFRpbWVvdXRFcnJvcihOb25lLCAiLyIsICJyZWFkIHRpbWVkIG91dCIpCiAgICAgICAgcmV0cnkgPSBSZXRyeShyZWFkPTApCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnLCBlcnJvcj1lcnJvcikKICAgICAgICAgICAgc2VsZi5mYWlsKCJGYWlsZWQgdG8gcmFpc2UgZXJyb3IuIikKICAgICAgICBleGNlcHQgTWF4UmV0cnlFcnJvciBhcyBlOgogICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKGUucmVhc29uLCBlcnJvcikKCiAgICBkZWYgdGVzdF9zdGF0dXNfY291bnRlcihzZWxmKToKICAgICAgICByZXNwID0gSFRUUFJlc3BvbnNlKHN0YXR1cz00MDApCiAgICAgICAgcmV0cnkgPSBSZXRyeShzdGF0dXM9MikKICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudChyZXNwb25zZT1yZXNwKQogICAgICAgIHJldHJ5ID0gcmV0cnkuaW5jcmVtZW50KHJlc3BvbnNlPXJlc3ApCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXRyeS5pbmNyZW1lbnQocmVzcG9uc2U9cmVzcCkKICAgICAgICAgICAgc2VsZi5mYWlsKCJGYWlsZWQgdG8gcmFpc2UgZXJyb3IuIikKICAgICAgICBleGNlcHQgTWF4UmV0cnlFcnJvciBhcyBlOgogICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHN0cihlLnJlYXNvbiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2VFcnJvci5TUEVDSUZJQ19FUlJPUi5mb3JtYXQoc3RhdHVzX2NvZGU9NDAwKSkKCiAgICBkZWYgdGVzdF9iYWNrb2ZmKHNlbGYpOgogICAgICAgICIiIiBCYWNrb2ZmIGlzIGNvbXB1dGVkIGNvcnJlY3RseSAiIiIKICAgICAgICBtYXhfYmFja29mZiA9IFJldHJ5LkJBQ0tPRkZfTUFYCgogICAgICAgIHJldHJ5ID0gUmV0cnkodG90YWw9MTAwLCBiYWNrb2ZmX2ZhY3Rvcj0wLjIpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXRyeS5nZXRfYmFja29mZl90aW1lKCksIDApICAjIEZpcnN0IHJlcXVlc3QKCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkuZ2V0X2JhY2tvZmZfdGltZSgpLCAwKSAgIyBGaXJzdCByZXRyeQoKICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudChtZXRob2Q9J0dFVCcpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXRyeS5iYWNrb2ZmX2ZhY3RvciwgMC4yKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkudG90YWwsIDk4KQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkuZ2V0X2JhY2tvZmZfdGltZSgpLCAwLjQpICAjIFN0YXJ0IGJhY2tvZmYKCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkuZ2V0X2JhY2tvZmZfdGltZSgpLCAwLjgpCgogICAgICAgIHJldHJ5ID0gcmV0cnkuaW5jcmVtZW50KG1ldGhvZD0nR0VUJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJldHJ5LmdldF9iYWNrb2ZmX3RpbWUoKSwgMS42KQoKICAgICAgICBmb3IgaSBpbiB4cmFuZ2UoMTApOgogICAgICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudChtZXRob2Q9J0dFVCcpCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkuZ2V0X2JhY2tvZmZfdGltZSgpLCBtYXhfYmFja29mZikKCiAgICBkZWYgdGVzdF96ZXJvX2JhY2tvZmYoc2VsZik6CiAgICAgICAgcmV0cnkgPSBSZXRyeSgpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXRyeS5nZXRfYmFja29mZl90aW1lKCksIDApCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnKQogICAgICAgIHJldHJ5ID0gcmV0cnkuaW5jcmVtZW50KG1ldGhvZD0nR0VUJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJldHJ5LmdldF9iYWNrb2ZmX3RpbWUoKSwgMCkKCiAgICBkZWYgdGVzdF9iYWNrb2ZmX3Jlc2V0X2FmdGVyX3JlZGlyZWN0KHNlbGYpOgogICAgICAgIHJldHJ5ID0gUmV0cnkodG90YWw9MTAwLCByZWRpcmVjdD01LCBiYWNrb2ZmX2ZhY3Rvcj0wLjIpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnKQogICAgICAgIHJldHJ5ID0gcmV0cnkuaW5jcmVtZW50KG1ldGhvZD0nR0VUJykKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJldHJ5LmdldF9iYWNrb2ZmX3RpbWUoKSwgMC40KQogICAgICAgIHJlZGlyZWN0X3Jlc3BvbnNlID0gSFRUUFJlc3BvbnNlKHN0YXR1cz0zMDIsIGhlYWRlcnM9eydsb2NhdGlvbic6ICd0ZXN0J30pCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnLCByZXNwb25zZT1yZWRpcmVjdF9yZXNwb25zZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJldHJ5LmdldF9iYWNrb2ZmX3RpbWUoKSwgMCkKICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudChtZXRob2Q9J0dFVCcpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkuZ2V0X2JhY2tvZmZfdGltZSgpLCAwLjQpCgogICAgZGVmIHRlc3Rfc2xlZXAoc2VsZik6CiAgICAgICAgIyBzbGVlcCBhIHZlcnkgc21hbGwgYW1vdW50IG9mIHRpbWUgc28gb3VyIGNvZGUgY292ZXJhZ2UgaXMgaGFwcHkKICAgICAgICByZXRyeSA9IFJldHJ5KGJhY2tvZmZfZmFjdG9yPTAuMDAwMSkKICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudChtZXRob2Q9J0dFVCcpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnKQogICAgICAgIHJldHJ5LnNsZWVwKCkKCiAgICBkZWYgdGVzdF9zdGF0dXNfZm9yY2VsaXN0KHNlbGYpOgogICAgICAgIHJldHJ5ID0gUmV0cnkoc3RhdHVzX2ZvcmNlbGlzdD14cmFuZ2UoNTAwLCA2MDApKQogICAgICAgIHNlbGYuYXNzZXJ0RmFsc2UocmV0cnkuaXNfcmV0cnkoJ0dFVCcsIHN0YXR1c19jb2RlPTIwMCkpCiAgICAgICAgc2VsZi5hc3NlcnRGYWxzZShyZXRyeS5pc19yZXRyeSgnR0VUJywgc3RhdHVzX2NvZGU9NDAwKSkKICAgICAgICBzZWxmLmFzc2VydFRydWUocmV0cnkuaXNfcmV0cnkoJ0dFVCcsIHN0YXR1c19jb2RlPTUwMCkpCgogICAgICAgIHJldHJ5ID0gUmV0cnkodG90YWw9MSwgc3RhdHVzX2ZvcmNlbGlzdD1bNDE4XSkKICAgICAgICBzZWxmLmFzc2VydEZhbHNlKHJldHJ5LmlzX3JldHJ5KCdHRVQnLCBzdGF0dXNfY29kZT00MDApKQogICAgICAgIHNlbGYuYXNzZXJ0VHJ1ZShyZXRyeS5pc19yZXRyeSgnR0VUJywgc3RhdHVzX2NvZGU9NDE4KSkKCiAgICAgICAgIyBTdHJpbmcgc3RhdHVzIGNvZGVzIGFyZSBub3QgbWF0Y2hlZC4KICAgICAgICByZXRyeSA9IFJldHJ5KHRvdGFsPTEsIHN0YXR1c19mb3JjZWxpc3Q9Wyc0MTgnXSkKICAgICAgICBzZWxmLmFzc2VydEZhbHNlKHJldHJ5LmlzX3JldHJ5KCdHRVQnLCBzdGF0dXNfY29kZT00MTgpKQoKICAgIGRlZiB0ZXN0X21ldGhvZF93aGl0ZWxpc3Rfd2l0aF9zdGF0dXNfZm9yY2VsaXN0KHNlbGYpOgogICAgICAgICMgRmFsc2V5IG1ldGhvZF93aGl0ZWxpc3QgbWVhbnMgdG8gcmV0cnkgb24gYW55IG1ldGhvZC4KICAgICAgICByZXRyeSA9IFJldHJ5KHN0YXR1c19mb3JjZWxpc3Q9WzUwMF0sIG1ldGhvZF93aGl0ZWxpc3Q9Tm9uZSkKICAgICAgICBzZWxmLmFzc2VydFRydWUocmV0cnkuaXNfcmV0cnkoJ0dFVCcsIHN0YXR1c19jb2RlPTUwMCkpCiAgICAgICAgc2VsZi5hc3NlcnRUcnVlKHJldHJ5LmlzX3JldHJ5KCdQT1NUJywgc3RhdHVzX2NvZGU9NTAwKSkKCiAgICAgICAgIyBDcml0ZXJpYSBvZiBtZXRob2Rfd2hpdGVsaXN0IGFuZCBzdGF0dXNfZm9yY2VsaXN0IGFyZSBBTkRlZC4KICAgICAgICByZXRyeSA9IFJldHJ5KHN0YXR1c19mb3JjZWxpc3Q9WzUwMF0sIG1ldGhvZF93aGl0ZWxpc3Q9WydQT1NUJ10pCiAgICAgICAgc2VsZi5hc3NlcnRGYWxzZShyZXRyeS5pc19yZXRyeSgnR0VUJywgc3RhdHVzX2NvZGU9NTAwKSkKICAgICAgICBzZWxmLmFzc2VydFRydWUocmV0cnkuaXNfcmV0cnkoJ1BPU1QnLCBzdGF0dXNfY29kZT01MDApKQoKICAgIGRlZiB0ZXN0X2V4aGF1c3RlZChzZWxmKToKICAgICAgICBzZWxmLmFzc2VydEZhbHNlKFJldHJ5KDApLmlzX2V4aGF1c3RlZCgpKQogICAgICAgIHNlbGYuYXNzZXJ0VHJ1ZShSZXRyeSgtMSkuaXNfZXhoYXVzdGVkKCkpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChSZXRyeSgxKS5pbmNyZW1lbnQobWV0aG9kPSdHRVQnKS50b3RhbCwgMCkKCiAgICBkZWYgdGVzdF9kaXNhYmxlZChzZWxmKToKICAgICAgICBzZWxmLmFzc2VydFJhaXNlcyhNYXhSZXRyeUVycm9yLCBSZXRyeSgtMSkuaW5jcmVtZW50LCBtZXRob2Q9J0dFVCcpCiAgICAgICAgc2VsZi5hc3NlcnRSYWlzZXMoTWF4UmV0cnlFcnJvciwgUmV0cnkoMCkuaW5jcmVtZW50LCBtZXRob2Q9J0dFVCcpCgogICAgZGVmIHRlc3RfZXJyb3JfbWVzc2FnZShzZWxmKToKICAgICAgICByZXRyeSA9IFJldHJ5KHRvdGFsPTApCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudChtZXRob2Q9J0dFVCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yPVJlYWRUaW1lb3V0RXJyb3IoTm9uZSwgIi8iLCAicmVhZCB0aW1lZCBvdXQiKSkKICAgICAgICAgICAgcmFpc2UgQXNzZXJ0aW9uRXJyb3IoIlNob3VsZCBoYXZlIHJhaXNlZCBhIE1heFJldHJ5RXJyb3IiKQogICAgICAgIGV4Y2VwdCBNYXhSZXRyeUVycm9yIGFzIGU6CiAgICAgICAgICAgIGFzc2VydCAnQ2F1c2VkIGJ5IHJlZGlyZWN0JyBub3QgaW4gc3RyKGUpCiAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoc3RyKGUucmVhc29uKSwgJ05vbmU6IHJlYWQgdGltZWQgb3V0JykKCiAgICAgICAgcmV0cnkgPSBSZXRyeSh0b3RhbD0xKQogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQoJ1BPU1QnLCAnLycpCiAgICAgICAgICAgIHJldHJ5ID0gcmV0cnkuaW5jcmVtZW50KCdQT1NUJywgJy8nKQogICAgICAgICAgICByYWlzZSBBc3NlcnRpb25FcnJvcigiU2hvdWxkIGhhdmUgcmFpc2VkIGEgTWF4UmV0cnlFcnJvciIpCiAgICAgICAgZXhjZXB0IE1heFJldHJ5RXJyb3IgYXMgZToKICAgICAgICAgICAgYXNzZXJ0ICdDYXVzZWQgYnkgcmVkaXJlY3QnIG5vdCBpbiBzdHIoZSkKICAgICAgICAgICAgc2VsZi5hc3NlcnRUcnVlKGlzaW5zdGFuY2UoZS5yZWFzb24sIFJlc3BvbnNlRXJyb3IpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiVzIHNob3VsZCBiZSBhIFJlc3BvbnNlRXJyb3IiICUgZS5yZWFzb24pCiAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoc3RyKGUucmVhc29uKSwgUmVzcG9uc2VFcnJvci5HRU5FUklDX0VSUk9SKQoKICAgICAgICByZXRyeSA9IFJldHJ5KHRvdGFsPTEpCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IEhUVFBSZXNwb25zZShzdGF0dXM9NTAwKQogICAgICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudCgnUE9TVCcsICcvJywgcmVzcG9uc2U9cmVzcG9uc2UpCiAgICAgICAgICAgIHJldHJ5ID0gcmV0cnkuaW5jcmVtZW50KCdQT1NUJywgJy8nLCByZXNwb25zZT1yZXNwb25zZSkKICAgICAgICAgICAgcmFpc2UgQXNzZXJ0aW9uRXJyb3IoIlNob3VsZCBoYXZlIHJhaXNlZCBhIE1heFJldHJ5RXJyb3IiKQogICAgICAgIGV4Y2VwdCBNYXhSZXRyeUVycm9yIGFzIGU6CiAgICAgICAgICAgIGFzc2VydCAnQ2F1c2VkIGJ5IHJlZGlyZWN0JyBub3QgaW4gc3RyKGUpCiAgICAgICAgICAgIG1zZyA9IFJlc3BvbnNlRXJyb3IuU1BFQ0lGSUNfRVJST1IuZm9ybWF0KHN0YXR1c19jb2RlPTUwMCkKICAgICAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChzdHIoZS5yZWFzb24pLCBtc2cpCgogICAgICAgIHJldHJ5ID0gUmV0cnkoY29ubmVjdD0xKQogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQoZXJyb3I9Q29ubmVjdFRpbWVvdXRFcnJvcignY29ubnRpbWVvdXQnKSkKICAgICAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQoZXJyb3I9Q29ubmVjdFRpbWVvdXRFcnJvcignY29ubnRpbWVvdXQnKSkKICAgICAgICAgICAgcmFpc2UgQXNzZXJ0aW9uRXJyb3IoIlNob3VsZCBoYXZlIHJhaXNlZCBhIE1heFJldHJ5RXJyb3IiKQogICAgICAgIGV4Y2VwdCBNYXhSZXRyeUVycm9yIGFzIGU6CiAgICAgICAgICAgIGFzc2VydCAnQ2F1c2VkIGJ5IHJlZGlyZWN0JyBub3QgaW4gc3RyKGUpCiAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoc3RyKGUucmVhc29uKSwgJ2Nvbm50aW1lb3V0JykKCiAgICBkZWYgdGVzdF9oaXN0b3J5KHNlbGYpOgogICAgICAgIHJldHJ5ID0gUmV0cnkodG90YWw9MTAsIG1ldGhvZF93aGl0ZWxpc3Q9ZnJvemVuc2V0KFsnR0VUJywgJ1BPU1QnXSkpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXRyeS5oaXN0b3J5LCB0dXBsZSgpKQogICAgICAgIGNvbm5lY3Rpb25fZXJyb3IgPSBDb25uZWN0VGltZW91dEVycm9yKCdjb25udGltZW91dCcpCiAgICAgICAgcmV0cnkgPSByZXRyeS5pbmNyZW1lbnQoJ0dFVCcsICcvdGVzdDEnLCBOb25lLCBjb25uZWN0aW9uX2Vycm9yKQogICAgICAgIGhpc3RvcnkgPSAoUmVxdWVzdEhpc3RvcnkoJ0dFVCcsICcvdGVzdDEnLCBjb25uZWN0aW9uX2Vycm9yLCBOb25lLCBOb25lKSwpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXRyeS5oaXN0b3J5LCBoaXN0b3J5KQoKICAgICAgICByZWFkX2Vycm9yID0gUmVhZFRpbWVvdXRFcnJvcihOb25lLCAiL3Rlc3QyIiwgInJlYWQgdGltZWQgb3V0IikKICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudCgnUE9TVCcsICcvdGVzdDInLCBOb25lLCByZWFkX2Vycm9yKQogICAgICAgIGhpc3RvcnkgPSAoUmVxdWVzdEhpc3RvcnkoJ0dFVCcsICcvdGVzdDEnLCBjb25uZWN0aW9uX2Vycm9yLCBOb25lLCBOb25lKSwKICAgICAgICAgICAgICAgICAgIFJlcXVlc3RIaXN0b3J5KCdQT1NUJywgJy90ZXN0MicsIHJlYWRfZXJyb3IsIE5vbmUsIE5vbmUpKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkuaGlzdG9yeSwgaGlzdG9yeSkKCiAgICAgICAgcmVzcG9uc2UgPSBIVFRQUmVzcG9uc2Uoc3RhdHVzPTUwMCkKICAgICAgICByZXRyeSA9IHJldHJ5LmluY3JlbWVudCgnR0VUJywgJy90ZXN0MycsIHJlc3BvbnNlLCBOb25lKQogICAgICAgIGhpc3RvcnkgPSAoUmVxdWVzdEhpc3RvcnkoJ0dFVCcsICcvdGVzdDEnLCBjb25uZWN0aW9uX2Vycm9yLCBOb25lLCBOb25lKSwKICAgICAgICAgICAgICAgICAgIFJlcXVlc3RIaXN0b3J5KCdQT1NUJywgJy90ZXN0MicsIHJlYWRfZXJyb3IsIE5vbmUsIE5vbmUpLAogICAgICAgICAgICAgICAgICAgUmVxdWVzdEhpc3RvcnkoJ0dFVCcsICcvdGVzdDMnLCBOb25lLCA1MDAsIE5vbmUpKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmV0cnkuaGlzdG9yeSwgaGlzdG9yeSkKCiAgICBkZWYgdGVzdF9yZXRyeV9tZXRob2Rfbm90X2luX3doaXRlbGlzdChzZWxmKToKICAgICAgICBlcnJvciA9IFJlYWRUaW1lb3V0RXJyb3IoTm9uZSwgIi8iLCAicmVhZCB0aW1lZCBvdXQiKQogICAgICAgIHJldHJ5ID0gUmV0cnkoKQogICAgICAgIHNlbGYuYXNzZXJ0UmFpc2VzKFJlYWRUaW1lb3V0RXJyb3IsIHJldHJ5LmluY3JlbWVudCwgbWV0aG9kPSdQT1NUJywgZXJyb3I9ZXJyb3IpCg==
