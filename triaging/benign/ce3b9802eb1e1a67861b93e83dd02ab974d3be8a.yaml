statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/client.py
  contents:
  - name: Client.cached_messages
    score: 0.0
    code: |-
      @property
          def cached_messages(self):
              """Sequence[:class:`.Message`]: Read-only list of messages the connected client has cached.

              .. versionadded:: 1.1
              """
              return utils.SequenceProxy(self._connection._messages or [])
    tokens: resume load_global utils load_attr SequenceProxy load_fast self load_attr _connection load_attr _messages copy pop_jump_if_true TO_NUMBER pop_top build_list call return_value
    hash: d5350fa0afda2ccdb42d4006746c5b1ea65ccdcc27a14e8997c5dc6827d5658b
sources:
  .repo_cache/malicious_repos/pypi_malregistry/discord-py-v13/1.3/discord_py_v13-1.3-py3-none-any/discord-py-v13/client.py: IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KCiIiIgpUaGUgTUlUIExpY2Vuc2UgKE1JVCkKCkNvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50IFJhcHB0egoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgp0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlClNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCk9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwpGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSCkRFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KIiIiCgppbXBvcnQgYXN5bmNpbwppbXBvcnQgbG9nZ2luZwppbXBvcnQgc2lnbmFsCmltcG9ydCBzeXMKaW1wb3J0IHRyYWNlYmFjawoKaW1wb3J0IGFpb2h0dHAKCmZyb20gLnVzZXIgaW1wb3J0IFVzZXIsIFByb2ZpbGUKZnJvbSAuaW52aXRlIGltcG9ydCBJbnZpdGUKZnJvbSAudGVtcGxhdGUgaW1wb3J0IFRlbXBsYXRlCmZyb20gLndpZGdldCBpbXBvcnQgV2lkZ2V0CmZyb20gLmd1aWxkIGltcG9ydCBHdWlsZApmcm9tIC5jaGFubmVsIGltcG9ydCBfY2hhbm5lbF9mYWN0b3J5CmZyb20gLmVudW1zIGltcG9ydCBDaGFubmVsVHlwZQpmcm9tIC5tZW50aW9ucyBpbXBvcnQgQWxsb3dlZE1lbnRpb25zCmZyb20gLmVycm9ycyBpbXBvcnQgKgpmcm9tIC5lbnVtcyBpbXBvcnQgU3RhdHVzLCBWb2ljZVJlZ2lvbgpmcm9tIC5nYXRld2F5IGltcG9ydCAqCmZyb20gLmFjdGl2aXR5IGltcG9ydCBCYXNlQWN0aXZpdHksIGNyZWF0ZV9hY3Rpdml0eQpmcm9tIC52b2ljZV9jbGllbnQgaW1wb3J0IFZvaWNlQ2xpZW50CmZyb20gLmh0dHAgaW1wb3J0IEhUVFBDbGllbnQKZnJvbSAuc3RhdGUgaW1wb3J0IENvbm5lY3Rpb25TdGF0ZQpmcm9tIC4gaW1wb3J0IHV0aWxzCmZyb20gLm9iamVjdCBpbXBvcnQgT2JqZWN0CmZyb20gLmJhY2tvZmYgaW1wb3J0IEV4cG9uZW50aWFsQmFja29mZgpmcm9tIC53ZWJob29rIGltcG9ydCBXZWJob29rCmZyb20gLml0ZXJhdG9ycyBpbXBvcnQgR3VpbGRJdGVyYXRvcgpmcm9tIC5hcHBpbmZvIGltcG9ydCBBcHBJbmZvCgpsb2cgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCmRlZiBfY2FuY2VsX3Rhc2tzKGxvb3ApOgogICAgdHJ5OgogICAgICAgIHRhc2tfcmV0cmlldmVyID0gYXN5bmNpby5UYXNrLmFsbF90YXNrcwogICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICMgZnV0dXJlIHByb29maW5nIGZvciAzLjkgSSBndWVzcwogICAgICAgIHRhc2tfcmV0cmlldmVyID0gYXN5bmNpby5hbGxfdGFza3MKCiAgICB0YXNrcyA9IHt0IGZvciB0IGluIHRhc2tfcmV0cmlldmVyKGxvb3A9bG9vcCkgaWYgbm90IHQuZG9uZSgpfQoKICAgIGlmIG5vdCB0YXNrczoKICAgICAgICByZXR1cm4KCiAgICBsb2cuaW5mbygnQ2xlYW5pbmcgdXAgYWZ0ZXIgJWQgdGFza3MuJywgbGVuKHRhc2tzKSkKICAgIGZvciB0YXNrIGluIHRhc2tzOgogICAgICAgIHRhc2suY2FuY2VsKCkKCiAgICBsb29wLnJ1bl91bnRpbF9jb21wbGV0ZShhc3luY2lvLmdhdGhlcigqdGFza3MsIHJldHVybl9leGNlcHRpb25zPVRydWUpKQogICAgbG9nLmluZm8oJ0FsbCB0YXNrcyBmaW5pc2hlZCBjYW5jZWxsaW5nLicpCgogICAgZm9yIHRhc2sgaW4gdGFza3M6CiAgICAgICAgaWYgdGFzay5jYW5jZWxsZWQoKToKICAgICAgICAgICAgY29udGludWUKICAgICAgICBpZiB0YXNrLmV4Y2VwdGlvbigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBsb29wLmNhbGxfZXhjZXB0aW9uX2hhbmRsZXIoewogICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnVW5oYW5kbGVkIGV4Y2VwdGlvbiBkdXJpbmcgQ2xpZW50LnJ1biBzaHV0ZG93bi4nLAogICAgICAgICAgICAgICAgJ2V4Y2VwdGlvbic6IHRhc2suZXhjZXB0aW9uKCksCiAgICAgICAgICAgICAgICAndGFzayc6IHRhc2sKICAgICAgICAgICAgfSkKCmRlZiBfY2xlYW51cF9sb29wKGxvb3ApOgogICAgdHJ5OgogICAgICAgIF9jYW5jZWxfdGFza3MobG9vcCkKICAgICAgICBpZiBzeXMudmVyc2lvbl9pbmZvID49ICgzLCA2KToKICAgICAgICAgICAgbG9vcC5ydW5fdW50aWxfY29tcGxldGUobG9vcC5zaHV0ZG93bl9hc3luY2dlbnMoKSkKICAgIGZpbmFsbHk6CiAgICAgICAgbG9nLmluZm8oJ0Nsb3NpbmcgdGhlIGV2ZW50IGxvb3AuJykKICAgICAgICBsb29wLmNsb3NlKCkKCmNsYXNzIF9DbGllbnRFdmVudFRhc2soYXN5bmNpby5UYXNrKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBvcmlnaW5hbF9jb3JvLCBldmVudF9uYW1lLCBjb3JvLCAqLCBsb29wKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGNvcm8sIGxvb3A9bG9vcCkKICAgICAgICBzZWxmLl9fZXZlbnRfbmFtZSA9IGV2ZW50X25hbWUKICAgICAgICBzZWxmLl9fb3JpZ2luYWxfY29ybyA9IG9yaWdpbmFsX2Nvcm8KCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgaW5mbyA9IFsKICAgICAgICAgICAgKCdzdGF0ZScsIHNlbGYuX3N0YXRlLmxvd2VyKCkpLAogICAgICAgICAgICAoJ2V2ZW50Jywgc2VsZi5fX2V2ZW50X25hbWUpLAogICAgICAgICAgICAoJ2Nvcm8nLCByZXByKHNlbGYuX19vcmlnaW5hbF9jb3JvKSksCiAgICAgICAgXQogICAgICAgIGlmIHNlbGYuX2V4Y2VwdGlvbiBpcyBub3QgTm9uZToKICAgICAgICAgICAgaW5mby5hcHBlbmQoKCdleGNlcHRpb24nLCByZXByKHNlbGYuX2V4Y2VwdGlvbikpKQogICAgICAgIHJldHVybiAnPENsaWVudEV2ZW50VGFzayB7fT4nLmZvcm1hdCgnICcuam9pbignJXM9JXMnICUgdCBmb3IgdCBpbiBpbmZvKSkKCmNsYXNzIENsaWVudDoKICAgIHIiIiJSZXByZXNlbnRzIGEgY2xpZW50IGNvbm5lY3Rpb24gdGhhdCBjb25uZWN0cyB0byBEaXNjb3JkLgogICAgVGhpcyBjbGFzcyBpcyB1c2VkIHRvIGludGVyYWN0IHdpdGggdGhlIERpc2NvcmQgV2ViU29ja2V0IGFuZCBBUEkuCgogICAgQSBudW1iZXIgb2Ygb3B0aW9ucyBjYW4gYmUgcGFzc2VkIHRvIHRoZSA6Y2xhc3M6YENsaWVudGAuCgogICAgUGFyYW1ldGVycwogICAgLS0tLS0tLS0tLS0KICAgIG1heF9tZXNzYWdlczogT3B0aW9uYWxbOmNsYXNzOmBpbnRgXQogICAgICAgIFRoZSBtYXhpbXVtIG51bWJlciBvZiBtZXNzYWdlcyB0byBzdG9yZSBpbiB0aGUgaW50ZXJuYWwgbWVzc2FnZSBjYWNoZS4KICAgICAgICBUaGlzIGRlZmF1bHRzIHRvIGBgMTAwMGBgLiBQYXNzaW5nIGluIGBgTm9uZWBgIGRpc2FibGVzIHRoZSBtZXNzYWdlIGNhY2hlLgoKICAgICAgICAuLiB2ZXJzaW9uY2hhbmdlZDo6IDEuMwogICAgICAgICAgICBBbGxvdyBkaXNhYmxpbmcgdGhlIG1lc3NhZ2UgY2FjaGUgYW5kIGNoYW5nZSB0aGUgZGVmYXVsdCBzaXplIHRvIGBgMTAwMGBgLgogICAgbG9vcDogT3B0aW9uYWxbOmNsYXNzOmBhc3luY2lvLkFic3RyYWN0RXZlbnRMb29wYF0KICAgICAgICBUaGUgOmNsYXNzOmBhc3luY2lvLkFic3RyYWN0RXZlbnRMb29wYCB0byB1c2UgZm9yIGFzeW5jaHJvbm91cyBvcGVyYXRpb25zLgogICAgICAgIERlZmF1bHRzIHRvIGBgTm9uZWBgLCBpbiB3aGljaCBjYXNlIHRoZSBkZWZhdWx0IGV2ZW50IGxvb3AgaXMgdXNlZCB2aWEKICAgICAgICA6ZnVuYzpgYXN5bmNpby5nZXRfZXZlbnRfbG9vcCgpYC4KICAgIGNvbm5lY3RvcjogOmNsYXNzOmBhaW9odHRwLkJhc2VDb25uZWN0b3JgCiAgICAgICAgVGhlIGNvbm5lY3RvciB0byB1c2UgZm9yIGNvbm5lY3Rpb24gcG9vbGluZy4KICAgIHByb3h5OiBPcHRpb25hbFs6Y2xhc3M6YHN0cmBdCiAgICAgICAgUHJveHkgVVJMLgogICAgcHJveHlfYXV0aDogT3B0aW9uYWxbOmNsYXNzOmBhaW9odHRwLkJhc2ljQXV0aGBdCiAgICAgICAgQW4gb2JqZWN0IHRoYXQgcmVwcmVzZW50cyBwcm94eSBIVFRQIEJhc2ljIEF1dGhvcml6YXRpb24uCiAgICBzaGFyZF9pZDogT3B0aW9uYWxbOmNsYXNzOmBpbnRgXQogICAgICAgIEludGVnZXIgc3RhcnRpbmcgYXQgYGAwYGAgYW5kIGxlc3MgdGhhbiA6YXR0cjpgLnNoYXJkX2NvdW50YC4KICAgIHNoYXJkX2NvdW50OiBPcHRpb25hbFs6Y2xhc3M6YGludGBdCiAgICAgICAgVGhlIHRvdGFsIG51bWJlciBvZiBzaGFyZHMuCiAgICBpbnRlbnRzOiA6Y2xhc3M6YEludGVudHNgCiAgICAgICAgVGhlIGludGVudHMgdGhhdCB5b3Ugd2FudCB0byBlbmFibGUgZm9yIHRoZSBzZXNzaW9uLiBUaGlzIGlzIGEgd2F5IG9mCiAgICAgICAgZGlzYWJsaW5nIGFuZCBlbmFibGluZyBjZXJ0YWluIGdhdGV3YXkgZXZlbnRzIGZyb20gdHJpZ2dlcmluZyBhbmQgYmVpbmcgc2VudC4KICAgICAgICBJZiBub3QgZ2l2ZW4sIGRlZmF1bHRzIHRvIGEgcmVndWxhcmx5IGNvbnN0cnVjdGVkIDpjbGFzczpgSW50ZW50c2AgY2xhc3MuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNQogICAgbWVtYmVyX2NhY2hlX2ZsYWdzOiA6Y2xhc3M6YE1lbWJlckNhY2hlRmxhZ3NgCiAgICAgICAgQWxsb3dzIGZvciBmaW5lciBjb250cm9sIG92ZXIgaG93IHRoZSBsaWJyYXJ5IGNhY2hlcyBtZW1iZXJzLgogICAgICAgIElmIG5vdCBnaXZlbiwgZGVmYXVsdHMgdG8gY2FjaGUgYXMgbXVjaCBhcyBwb3NzaWJsZSB3aXRoIHRoZQogICAgICAgIGN1cnJlbnRseSBzZWxlY3RlZCBpbnRlbnRzLgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjUKICAgIGZldGNoX29mZmxpbmVfbWVtYmVyczogOmNsYXNzOmBib29sYAogICAgICAgIEEgZGVwcmVjYXRlZCBhbGlhcyBvZiBgYGNodW5rX2d1aWxkc19hdF9zdGFydHVwYGAuCiAgICBjaHVua19ndWlsZHNfYXRfc3RhcnR1cDogOmNsYXNzOmBib29sYAogICAgICAgIEluZGljYXRlcyBpZiA6ZnVuYzpgLm9uX3JlYWR5YCBzaG91bGQgYmUgZGVsYXllZCB0byBjaHVuayBhbGwgZ3VpbGRzCiAgICAgICAgYXQgc3RhcnQtdXAgaWYgbmVjZXNzYXJ5LiBUaGlzIG9wZXJhdGlvbiBpcyBpbmNyZWRpYmx5IHNsb3cgZm9yIGxhcmdlCiAgICAgICAgYW1vdW50cyBvZiBndWlsZHMuIFRoZSBkZWZhdWx0IGlzIGBgVHJ1ZWBgIGlmIDphdHRyOmBJbnRlbnRzLm1lbWJlcnNgCiAgICAgICAgaXMgYGBUcnVlYGAuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNQogICAgc3RhdHVzOiBPcHRpb25hbFs6Y2xhc3M6YC5TdGF0dXNgXQogICAgICAgIEEgc3RhdHVzIHRvIHN0YXJ0IHlvdXIgcHJlc2VuY2Ugd2l0aCB1cG9uIGxvZ2dpbmcgb24gdG8gRGlzY29yZC4KICAgIGFjdGl2aXR5OiBPcHRpb25hbFs6Y2xhc3M6YC5CYXNlQWN0aXZpdHlgXQogICAgICAgIEFuIGFjdGl2aXR5IHRvIHN0YXJ0IHlvdXIgcHJlc2VuY2Ugd2l0aCB1cG9uIGxvZ2dpbmcgb24gdG8gRGlzY29yZC4KICAgIGFsbG93ZWRfbWVudGlvbnM6IE9wdGlvbmFsWzpjbGFzczpgQWxsb3dlZE1lbnRpb25zYF0KICAgICAgICBDb250cm9sIGhvdyB0aGUgY2xpZW50IGhhbmRsZXMgbWVudGlvbnMgYnkgZGVmYXVsdCBvbiBldmVyeSBtZXNzYWdlIHNlbnQuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNAogICAgaGVhcnRiZWF0X3RpbWVvdXQ6IDpjbGFzczpgZmxvYXRgCiAgICAgICAgVGhlIG1heGltdW0gbnVtYmVycyBvZiBzZWNvbmRzIGJlZm9yZSB0aW1pbmcgb3V0IGFuZCByZXN0YXJ0aW5nIHRoZQogICAgICAgIFdlYlNvY2tldCBpbiB0aGUgY2FzZSBvZiBub3QgcmVjZWl2aW5nIGEgSEVBUlRCRUFUX0FDSy4gVXNlZnVsIGlmCiAgICAgICAgcHJvY2Vzc2luZyB0aGUgaW5pdGlhbCBwYWNrZXRzIHRha2UgdG9vIGxvbmcgdG8gdGhlIHBvaW50IG9mIGRpc2Nvbm5lY3RpbmcKICAgICAgICB5b3UuIFRoZSBkZWZhdWx0IHRpbWVvdXQgaXMgNjAgc2Vjb25kcy4KICAgIGd1aWxkX3JlYWR5X3RpbWVvdXQ6IDpjbGFzczpgZmxvYXRgCiAgICAgICAgVGhlIG1heGltdW0gbnVtYmVyIG9mIHNlY29uZHMgdG8gd2FpdCBmb3IgdGhlIEdVSUxEX0NSRUFURSBzdHJlYW0gdG8gZW5kIGJlZm9yZQogICAgICAgIHByZXBhcmluZyB0aGUgbWVtYmVyIGNhY2hlIGFuZCBmaXJpbmcgUkVBRFkuIFRoZSBkZWZhdWx0IHRpbWVvdXQgaXMgMiBzZWNvbmRzLgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjQKICAgIGd1aWxkX3N1YnNjcmlwdGlvbnM6IDpjbGFzczpgYm9vbGAKICAgICAgICBXaGV0aGVyIHRvIGRpc3BhdGNoIHByZXNlbmNlIG9yIHR5cGluZyBldmVudHMuIERlZmF1bHRzIHRvIGBgVHJ1ZWBgLgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjMKCiAgICAgICAgLi4gd2FybmluZzo6CgogICAgICAgICAgICBJZiB0aGlzIGlzIHNldCB0byBgYEZhbHNlYGAgdGhlbiB0aGUgZm9sbG93aW5nIGZlYXR1cmVzIHdpbGwgYmUgZGlzYWJsZWQ6CgogICAgICAgICAgICAgICAgLSBObyB1c2VyIHJlbGF0ZWQgdXBkYXRlcyAoOmZ1bmM6YG9uX3VzZXJfdXBkYXRlYCB3aWxsIG5vdCBkaXNwYXRjaCkKICAgICAgICAgICAgICAgIC0gQWxsIG1lbWJlciByZWxhdGVkIGV2ZW50cyB3aWxsIGJlIGRpc2FibGVkLgogICAgICAgICAgICAgICAgICAgIC0gOmZ1bmM6YG9uX21lbWJlcl91cGRhdGVgCiAgICAgICAgICAgICAgICAgICAgLSA6ZnVuYzpgb25fbWVtYmVyX2pvaW5gCiAgICAgICAgICAgICAgICAgICAgLSA6ZnVuYzpgb25fbWVtYmVyX3JlbW92ZWAKCiAgICAgICAgICAgICAgICAtIFR5cGluZyBldmVudHMgd2lsbCBiZSBkaXNhYmxlZCAoOmZ1bmM6YG9uX3R5cGluZ2ApLgogICAgICAgICAgICAgICAgLSBJZiBgYGZldGNoX29mZmxpbmVfbWVtYmVyc2BgIGlzIHNldCB0byBgYEZhbHNlYGAgdGhlbiB0aGUgdXNlciBjYWNoZSB3aWxsIG5vdCBleGlzdC4KICAgICAgICAgICAgICAgICAgVGhpcyBtYWtlcyBpdCBkaWZmaWN1bHQgb3IgaW1wb3NzaWJsZSB0byBkbyBtYW55IHRoaW5ncywgZm9yIGV4YW1wbGU6CgogICAgICAgICAgICAgICAgICAgIC0gQ29tcHV0aW5nIHBlcm1pc3Npb25zCiAgICAgICAgICAgICAgICAgICAgLSBRdWVyeWluZyBtZW1iZXJzIGluIGEgdm9pY2UgY2hhbm5lbCB2aWEgOmF0dHI6YFZvaWNlQ2hhbm5lbC5tZW1iZXJzYCB3aWxsIGJlIGVtcHR5LgogICAgICAgICAgICAgICAgICAgIC0gTW9zdCBmb3JtcyBvZiByZWNlaXZpbmcgOmNsYXNzOmBNZW1iZXJgIHdpbGwgYmUKICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmluZyA6Y2xhc3M6YFVzZXJgIGluc3RlYWQsIGV4Y2VwdCBmb3IgbWVzc2FnZSBldmVudHMuCiAgICAgICAgICAgICAgICAgICAgLSA6YXR0cjpgR3VpbGQub3duZXJgIHdpbGwgdXN1YWxseSByZXNvbHZlIHRvIGBgTm9uZWBgLgogICAgICAgICAgICAgICAgICAgIC0gOm1ldGg6YEd1aWxkLmdldF9tZW1iZXJgIHdpbGwgdXN1YWxseSBiZSB1bmF2YWlsYWJsZS4KICAgICAgICAgICAgICAgICAgICAtIEFueXRoaW5nIHRoYXQgaW52b2x2ZXMgdXNpbmcgOmNsYXNzOmBNZW1iZXJgLgogICAgICAgICAgICAgICAgICAgIC0gOmF0dHI6YHVzZXJzYCB3aWxsIG5vdCBiZSBhcyBwb3B1bGF0ZWQuCiAgICAgICAgICAgICAgICAgICAgLSBldGMuCgogICAgICAgICAgICBJbiBzaG9ydCwgdGhpcyBtYWtlcyBpdCBzbyB0aGUgb25seSBtZW1iZXIgeW91IGNhbiByZWxpYWJseSBxdWVyeSBpcyB0aGUKICAgICAgICAgICAgbWVzc2FnZSBhdXRob3IuIFVzZWZ1bCBmb3IgYm90cyB0aGF0IGRvIG5vdCByZXF1aXJlIGFueSBzdGF0ZS4KICAgIGFzc3VtZV91bnN5bmNfY2xvY2s6IDpjbGFzczpgYm9vbGAKICAgICAgICBXaGV0aGVyIHRvIGFzc3VtZSB0aGUgc3lzdGVtIGNsb2NrIGlzIHVuc3luY2VkLiBUaGlzIGFwcGxpZXMgdG8gdGhlIHJhdGVsaW1pdCBoYW5kbGluZwogICAgICAgIGNvZGUuIElmIHRoaXMgaXMgc2V0IHRvIGBgVHJ1ZWBgLCB0aGUgZGVmYXVsdCwgdGhlbiB0aGUgbGlicmFyeSB1c2VzIHRoZSB0aW1lIHRvIHJlc2V0CiAgICAgICAgYSByYXRlIGxpbWl0IGJ1Y2tldCBnaXZlbiBieSBEaXNjb3JkLiBJZiB0aGlzIGlzIGBgRmFsc2VgYCB0aGVuIHlvdXIgc3lzdGVtIGNsb2NrIGlzCiAgICAgICAgdXNlZCB0byBjYWxjdWxhdGUgaG93IGxvbmcgdG8gc2xlZXAgZm9yLiBJZiB0aGlzIGlzIHNldCB0byBgYEZhbHNlYGAgaXQgaXMgcmVjb21tZW5kZWQgdG8KICAgICAgICBzeW5jIHlvdXIgc3lzdGVtIGNsb2NrIHRvIEdvb2dsZSdzIE5UUCBzZXJ2ZXIuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuMwoKICAgIEF0dHJpYnV0ZXMKICAgIC0tLS0tLS0tLS0tCiAgICB3cwogICAgICAgIFRoZSB3ZWJzb2NrZXQgZ2F0ZXdheSB0aGUgY2xpZW50IGlzIGN1cnJlbnRseSBjb25uZWN0ZWQgdG8uIENvdWxkIGJlIGBgTm9uZWBgLgogICAgbG9vcDogOmNsYXNzOmBhc3luY2lvLkFic3RyYWN0RXZlbnRMb29wYAogICAgICAgIFRoZSBldmVudCBsb29wIHRoYXQgdGhlIGNsaWVudCB1c2VzIGZvciBIVFRQIHJlcXVlc3RzIGFuZCB3ZWJzb2NrZXQgb3BlcmF0aW9ucy4KICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsICosIGxvb3A9Tm9uZSwgKipvcHRpb25zKToKICAgICAgICBzZWxmLndzID0gTm9uZQogICAgICAgIHNlbGYubG9vcCA9IGFzeW5jaW8uZ2V0X2V2ZW50X2xvb3AoKSBpZiBsb29wIGlzIE5vbmUgZWxzZSBsb29wCiAgICAgICAgc2VsZi5fbGlzdGVuZXJzID0ge30KICAgICAgICBzZWxmLnNoYXJkX2lkID0gb3B0aW9ucy5nZXQoJ3NoYXJkX2lkJykKICAgICAgICBzZWxmLnNoYXJkX2NvdW50ID0gb3B0aW9ucy5nZXQoJ3NoYXJkX2NvdW50JykKCiAgICAgICAgY29ubmVjdG9yID0gb3B0aW9ucy5wb3AoJ2Nvbm5lY3RvcicsIE5vbmUpCiAgICAgICAgcHJveHkgPSBvcHRpb25zLnBvcCgncHJveHknLCBOb25lKQogICAgICAgIHByb3h5X2F1dGggPSBvcHRpb25zLnBvcCgncHJveHlfYXV0aCcsIE5vbmUpCiAgICAgICAgdW5zeW5jX2Nsb2NrID0gb3B0aW9ucy5wb3AoJ2Fzc3VtZV91bnN5bmNfY2xvY2snLCBUcnVlKQogICAgICAgIHNlbGYuaHR0cCA9IEhUVFBDbGllbnQoY29ubmVjdG9yLCBwcm94eT1wcm94eSwgcHJveHlfYXV0aD1wcm94eV9hdXRoLCB1bnN5bmNfY2xvY2s9dW5zeW5jX2Nsb2NrLCBsb29wPXNlbGYubG9vcCkKCiAgICAgICAgc2VsZi5faGFuZGxlcnMgPSB7CiAgICAgICAgICAgICdyZWFkeSc6IHNlbGYuX2hhbmRsZV9yZWFkeQogICAgICAgIH0KCiAgICAgICAgc2VsZi5faG9va3MgPSB7CiAgICAgICAgICAgICdiZWZvcmVfaWRlbnRpZnknOiBzZWxmLl9jYWxsX2JlZm9yZV9pZGVudGlmeV9ob29rCiAgICAgICAgfQoKICAgICAgICBzZWxmLl9jb25uZWN0aW9uID0gc2VsZi5fZ2V0X3N0YXRlKCoqb3B0aW9ucykKICAgICAgICBzZWxmLl9jb25uZWN0aW9uLnNoYXJkX2NvdW50ID0gc2VsZi5zaGFyZF9jb3VudAogICAgICAgIHNlbGYuX2Nsb3NlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5fcmVhZHkgPSBhc3luY2lvLkV2ZW50KCkKICAgICAgICBzZWxmLl9jb25uZWN0aW9uLl9nZXRfd2Vic29ja2V0ID0gc2VsZi5fZ2V0X3dlYnNvY2tldAogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24uX2dldF9jbGllbnQgPSBsYW1iZGE6IHNlbGYKCiAgICAgICAgaWYgVm9pY2VDbGllbnQud2Fybl9uYWNsOgogICAgICAgICAgICBWb2ljZUNsaWVudC53YXJuX25hY2wgPSBGYWxzZQogICAgICAgICAgICBsb2cud2FybmluZygiUHlOYUNsIGlzIG5vdCBpbnN0YWxsZWQsIHZvaWNlIHdpbGwgTk9UIGJlIHN1cHBvcnRlZCIpCgogICAgIyBpbnRlcm5hbHMKCiAgICBkZWYgX2dldF93ZWJzb2NrZXQoc2VsZiwgZ3VpbGRfaWQ9Tm9uZSwgKiwgc2hhcmRfaWQ9Tm9uZSk6CiAgICAgICAgcmV0dXJuIHNlbGYud3MKCiAgICBkZWYgX2dldF9zdGF0ZShzZWxmLCAqKm9wdGlvbnMpOgogICAgICAgIHJldHVybiBDb25uZWN0aW9uU3RhdGUoZGlzcGF0Y2g9c2VsZi5kaXNwYXRjaCwgaGFuZGxlcnM9c2VsZi5faGFuZGxlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob29rcz1zZWxmLl9ob29rcywgc3luY2VyPXNlbGYuX3N5bmNlciwgaHR0cD1zZWxmLmh0dHAsIGxvb3A9c2VsZi5sb29wLCAqKm9wdGlvbnMpCgogICAgYXN5bmMgZGVmIF9zeW5jZXIoc2VsZiwgZ3VpbGRzKToKICAgICAgICBhd2FpdCBzZWxmLndzLnJlcXVlc3Rfc3luYyhndWlsZHMpCgogICAgZGVmIF9oYW5kbGVfcmVhZHkoc2VsZik6CiAgICAgICAgc2VsZi5fcmVhZHkuc2V0KCkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBsYXRlbmN5KHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgZmxvYXRgOiBNZWFzdXJlcyBsYXRlbmN5IGJldHdlZW4gYSBIRUFSVEJFQVQgYW5kIGEgSEVBUlRCRUFUX0FDSyBpbiBzZWNvbmRzLgoKICAgICAgICBUaGlzIGNvdWxkIGJlIHJlZmVycmVkIHRvIGFzIHRoZSBEaXNjb3JkIFdlYlNvY2tldCBwcm90b2NvbCBsYXRlbmN5LgogICAgICAgICIiIgogICAgICAgIHdzID0gc2VsZi53cwogICAgICAgIHJldHVybiBmbG9hdCgnbmFuJykgaWYgbm90IHdzIGVsc2Ugd3MubGF0ZW5jeQoKICAgIGRlZiBpc193c19yYXRlbGltaXRlZChzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGJvb2xgOiBXaGV0aGVyIHRoZSB3ZWJzb2NrZXQgaXMgY3VycmVudGx5IHJhdGUgbGltaXRlZC4KCiAgICAgICAgVGhpcyBjYW4gYmUgdXNlZnVsIHRvIGtub3cgd2hlbiBkZWNpZGluZyB3aGV0aGVyIHlvdSBzaG91bGQgcXVlcnkgbWVtYmVycwogICAgICAgIHVzaW5nIEhUVFAgb3IgdmlhIHRoZSBnYXRld2F5LgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjYKICAgICAgICAiIiIKICAgICAgICBpZiBzZWxmLndzOgogICAgICAgICAgICByZXR1cm4gc2VsZi53cy5pc19yYXRlbGltaXRlZCgpCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgQHByb3BlcnR5CiAgICBkZWYgdXNlcihzZWxmKToKICAgICAgICAiIiJPcHRpb25hbFs6Y2xhc3M6YC5DbGllbnRVc2VyYF06IFJlcHJlc2VudHMgdGhlIGNvbm5lY3RlZCBjbGllbnQuIGBgTm9uZWBgIGlmIG5vdCBsb2dnZWQgaW4uIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX2Nvbm5lY3Rpb24udXNlcgoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGd1aWxkcyhzZWxmKToKICAgICAgICAiIiJMaXN0WzpjbGFzczpgLkd1aWxkYF06IFRoZSBndWlsZHMgdGhhdCB0aGUgY29ubmVjdGVkIGNsaWVudCBpcyBhIG1lbWJlciBvZi4iIiIKICAgICAgICByZXR1cm4gc2VsZi5fY29ubmVjdGlvbi5ndWlsZHMKCiAgICBAcHJvcGVydHkKICAgIGRlZiBlbW9qaXMoc2VsZik6CiAgICAgICAgIiIiTGlzdFs6Y2xhc3M6YC5FbW9qaWBdOiBUaGUgZW1vamlzIHRoYXQgdGhlIGNvbm5lY3RlZCBjbGllbnQgaGFzLiIiIgogICAgICAgIHJldHVybiBzZWxmLl9jb25uZWN0aW9uLmVtb2ppcwoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNhY2hlZF9tZXNzYWdlcyhzZWxmKToKICAgICAgICAiIiJTZXF1ZW5jZVs6Y2xhc3M6YC5NZXNzYWdlYF06IFJlYWQtb25seSBsaXN0IG9mIG1lc3NhZ2VzIHRoZSBjb25uZWN0ZWQgY2xpZW50IGhhcyBjYWNoZWQuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuMQogICAgICAgICIiIgogICAgICAgIHJldHVybiB1dGlscy5TZXF1ZW5jZVByb3h5KHNlbGYuX2Nvbm5lY3Rpb24uX21lc3NhZ2VzIG9yIFtdKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHByaXZhdGVfY2hhbm5lbHMoc2VsZik6CiAgICAgICAgIiIiTGlzdFs6Y2xhc3M6YC5hYmMuUHJpdmF0ZUNoYW5uZWxgXTogVGhlIHByaXZhdGUgY2hhbm5lbHMgdGhhdCB0aGUgY29ubmVjdGVkIGNsaWVudCBpcyBwYXJ0aWNpcGF0aW5nIG9uLgoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgcmV0dXJucyBvbmx5IHVwIHRvIDEyOCBtb3N0IHJlY2VudCBwcml2YXRlIGNoYW5uZWxzIGR1ZSB0byBhbiBpbnRlcm5hbCB3b3JraW5nCiAgICAgICAgICAgIG9uIGhvdyBEaXNjb3JkIGRlYWxzIHdpdGggcHJpdmF0ZSBjaGFubmVscy4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fY29ubmVjdGlvbi5wcml2YXRlX2NoYW5uZWxzCgogICAgQHByb3BlcnR5CiAgICBkZWYgdm9pY2VfY2xpZW50cyhzZWxmKToKICAgICAgICAiIiJMaXN0WzpjbGFzczpgLlZvaWNlUHJvdG9jb2xgXTogUmVwcmVzZW50cyBhIGxpc3Qgb2Ygdm9pY2UgY29ubmVjdGlvbnMuCgogICAgICAgIFRoZXNlIGFyZSB1c3VhbGx5IDpjbGFzczpgLlZvaWNlQ2xpZW50YCBpbnN0YW5jZXMuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX2Nvbm5lY3Rpb24udm9pY2VfY2xpZW50cwoKICAgIGRlZiBpc19yZWFkeShzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YGJvb2xgOiBTcGVjaWZpZXMgaWYgdGhlIGNsaWVudCdzIGludGVybmFsIGNhY2hlIGlzIHJlYWR5IGZvciB1c2UuIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX3JlYWR5LmlzX3NldCgpCgogICAgYXN5bmMgZGVmIF9ydW5fZXZlbnQoc2VsZiwgY29ybywgZXZlbnRfbmFtZSwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGF3YWl0IGNvcm8oKmFyZ3MsICoqa3dhcmdzKQogICAgICAgIGV4Y2VwdCBhc3luY2lvLkNhbmNlbGxlZEVycm9yOgogICAgICAgICAgICBwYXNzCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5vbl9lcnJvcihldmVudF9uYW1lLCAqYXJncywgKiprd2FyZ3MpCiAgICAgICAgICAgIGV4Y2VwdCBhc3luY2lvLkNhbmNlbGxlZEVycm9yOgogICAgICAgICAgICAgICAgcGFzcwoKICAgIGRlZiBfc2NoZWR1bGVfZXZlbnQoc2VsZiwgY29ybywgZXZlbnRfbmFtZSwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICB3cmFwcGVkID0gc2VsZi5fcnVuX2V2ZW50KGNvcm8sIGV2ZW50X25hbWUsICphcmdzLCAqKmt3YXJncykKICAgICAgICAjIFNjaGVkdWxlcyB0aGUgdGFzawogICAgICAgIHJldHVybiBfQ2xpZW50RXZlbnRUYXNrKG9yaWdpbmFsX2Nvcm89Y29ybywgZXZlbnRfbmFtZT1ldmVudF9uYW1lLCBjb3JvPXdyYXBwZWQsIGxvb3A9c2VsZi5sb29wKQoKICAgIGRlZiBkaXNwYXRjaChzZWxmLCBldmVudCwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICBsb2cuZGVidWcoJ0Rpc3BhdGNoaW5nIGV2ZW50ICVzJywgZXZlbnQpCiAgICAgICAgbWV0aG9kID0gJ29uXycgKyBldmVudAoKICAgICAgICBsaXN0ZW5lcnMgPSBzZWxmLl9saXN0ZW5lcnMuZ2V0KGV2ZW50KQogICAgICAgIGlmIGxpc3RlbmVyczoKICAgICAgICAgICAgcmVtb3ZlZCA9IFtdCiAgICAgICAgICAgIGZvciBpLCAoZnV0dXJlLCBjb25kaXRpb24pIGluIGVudW1lcmF0ZShsaXN0ZW5lcnMpOgogICAgICAgICAgICAgICAgaWYgZnV0dXJlLmNhbmNlbGxlZCgpOgogICAgICAgICAgICAgICAgICAgIHJlbW92ZWQuYXBwZW5kKGkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY29uZGl0aW9uKCphcmdzKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleGM6CiAgICAgICAgICAgICAgICAgICAgZnV0dXJlLnNldF9leGNlcHRpb24oZXhjKQogICAgICAgICAgICAgICAgICAgIHJlbW92ZWQuYXBwZW5kKGkpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIHJlc3VsdDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGFyZ3MpID09IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdXR1cmUuc2V0X3Jlc3VsdChOb25lKQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGxlbihhcmdzKSA9PSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnV0dXJlLnNldF9yZXN1bHQoYXJnc1swXSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1dHVyZS5zZXRfcmVzdWx0KGFyZ3MpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZWQuYXBwZW5kKGkpCgogICAgICAgICAgICBpZiBsZW4ocmVtb3ZlZCkgPT0gbGVuKGxpc3RlbmVycyk6CiAgICAgICAgICAgICAgICBzZWxmLl9saXN0ZW5lcnMucG9wKGV2ZW50KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZm9yIGlkeCBpbiByZXZlcnNlZChyZW1vdmVkKToKICAgICAgICAgICAgICAgICAgICBkZWwgbGlzdGVuZXJzW2lkeF0KCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb3JvID0gZ2V0YXR0cihzZWxmLCBtZXRob2QpCiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICAgICBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5fc2NoZWR1bGVfZXZlbnQoY29ybywgbWV0aG9kLCAqYXJncywgKiprd2FyZ3MpCgogICAgYXN5bmMgZGVmIG9uX2Vycm9yKHNlbGYsIGV2ZW50X21ldGhvZCwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgVGhlIGRlZmF1bHQgZXJyb3IgaGFuZGxlciBwcm92aWRlZCBieSB0aGUgY2xpZW50LgoKICAgICAgICBCeSBkZWZhdWx0IHRoaXMgcHJpbnRzIHRvIDpkYXRhOmBzeXMuc3RkZXJyYCBob3dldmVyIGl0IGNvdWxkIGJlCiAgICAgICAgb3ZlcnJpZGRlbiB0byBoYXZlIGEgZGlmZmVyZW50IGltcGxlbWVudGF0aW9uLgogICAgICAgIENoZWNrIDpmdW5jOmB+ZGlzY29yZC5vbl9lcnJvcmAgZm9yIG1vcmUgZGV0YWlscy4KICAgICAgICAiIiIKICAgICAgICBwcmludCgnSWdub3JpbmcgZXhjZXB0aW9uIGluIHt9Jy5mb3JtYXQoZXZlbnRfbWV0aG9kKSwgZmlsZT1zeXMuc3RkZXJyKQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQoKICAgIEB1dGlscy5kZXByZWNhdGVkKCdHdWlsZC5jaHVuaycpCiAgICBhc3luYyBkZWYgcmVxdWVzdF9vZmZsaW5lX21lbWJlcnMoc2VsZiwgKmd1aWxkcyk6CiAgICAgICAgciIiInxjb3JvfAoKICAgICAgICBSZXF1ZXN0cyBwcmV2aW91c2x5IG9mZmxpbmUgbWVtYmVycyBmcm9tIHRoZSBndWlsZCB0byBiZSBmaWxsZWQgdXAKICAgICAgICBpbnRvIHRoZSA6YXR0cjpgLkd1aWxkLm1lbWJlcnNgIGNhY2hlLiBUaGlzIGZ1bmN0aW9uIGlzIHVzdWFsbHkgbm90CiAgICAgICAgY2FsbGVkLiBJdCBzaG91bGQgb25seSBiZSB1c2VkIGlmIHlvdSBoYXZlIHRoZSBgYGZldGNoX29mZmxpbmVfbWVtYmVyc2BgCiAgICAgICAgcGFyYW1ldGVyIHNldCB0byBgYEZhbHNlYGAuCgogICAgICAgIFdoZW4gdGhlIGNsaWVudCBsb2dzIG9uIGFuZCBjb25uZWN0cyB0byB0aGUgd2Vic29ja2V0LCBEaXNjb3JkIGRvZXMKICAgICAgICBub3QgcHJvdmlkZSB0aGUgbGlicmFyeSB3aXRoIG9mZmxpbmUgbWVtYmVycyBpZiB0aGUgbnVtYmVyIG9mIG1lbWJlcnMKICAgICAgICBpbiB0aGUgZ3VpbGQgaXMgbGFyZ2VyIHRoYW4gMjUwLiBZb3UgY2FuIGNoZWNrIGlmIGEgZ3VpbGQgaXMgbGFyZ2UKICAgICAgICBpZiA6YXR0cjpgLkd1aWxkLmxhcmdlYCBpcyBgYFRydWVgYC4KCiAgICAgICAgLi4gd2FybmluZzo6CgogICAgICAgICAgICBUaGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkLiBVc2UgOm1ldGg6YEd1aWxkLmNodW5rYCBpbnN0ZWFkLgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICBcKmd1aWxkczogOmNsYXNzOmAuR3VpbGRgCiAgICAgICAgICAgIEFuIGFyZ3VtZW50IGxpc3Qgb2YgZ3VpbGRzIHRvIHJlcXVlc3Qgb2ZmbGluZSBtZW1iZXJzIGZvci4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIDpleGM6YC5JbnZhbGlkQXJndW1lbnRgCiAgICAgICAgICAgIElmIGFueSBndWlsZCBpcyB1bmF2YWlsYWJsZSBpbiB0aGUgY29sbGVjdGlvbi4KICAgICAgICAiIiIKICAgICAgICBpZiBhbnkoZy51bmF2YWlsYWJsZSBmb3IgZyBpbiBndWlsZHMpOgogICAgICAgICAgICByYWlzZSBJbnZhbGlkQXJndW1lbnQoJ0FuIHVuYXZhaWxhYmxlIGd1aWxkIHdhcyBwYXNzZWQuJykKCiAgICAgICAgZm9yIGd1aWxkIGluIGd1aWxkczoKICAgICAgICAgICAgYXdhaXQgc2VsZi5fY29ubmVjdGlvbi5jaHVua19ndWlsZChndWlsZCkKCiAgICAjIGhvb2tzCgogICAgYXN5bmMgZGVmIF9jYWxsX2JlZm9yZV9pZGVudGlmeV9ob29rKHNlbGYsIHNoYXJkX2lkLCAqLCBpbml0aWFsPUZhbHNlKToKICAgICAgICAjIFRoaXMgaG9vayBpcyBhbiBpbnRlcm5hbCBob29rIHRoYXQgYWN0dWFsbHkgY2FsbHMgdGhlIHB1YmxpYyBvbmUuCiAgICAgICAgIyBJdCBhbGxvd3MgdGhlIGxpYnJhcnkgdG8gaGF2ZSBpdHMgb3duIGhvb2sgd2l0aG91dCBzdGVwcGluZyBvbiB0aGUKICAgICAgICAjIHRvZXMgb2YgdGhvc2Ugd2hvIG5lZWQgdG8gb3ZlcnJpZGUgdGhlaXIgb3duIGhvb2suCiAgICAgICAgYXdhaXQgc2VsZi5iZWZvcmVfaWRlbnRpZnlfaG9vayhzaGFyZF9pZCwgaW5pdGlhbD1pbml0aWFsKQoKICAgIGFzeW5jIGRlZiBiZWZvcmVfaWRlbnRpZnlfaG9vayhzZWxmLCBzaGFyZF9pZCwgKiwgaW5pdGlhbD1GYWxzZSk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIEEgaG9vayB0aGF0IGlzIGNhbGxlZCBiZWZvcmUgSURFTlRJRllpbmcgYSBzZXNzaW9uLiBUaGlzIGlzIHVzZWZ1bAogICAgICAgIGlmIHlvdSB3aXNoIHRvIGhhdmUgbW9yZSBjb250cm9sIG92ZXIgdGhlIHN5bmNocm9uaXphdGlvbiBvZiBtdWx0aXBsZQogICAgICAgIElERU5USUZZaW5nIGNsaWVudHMuCgogICAgICAgIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIHNsZWVwcyBmb3IgNSBzZWNvbmRzLgoKICAgICAgICAuLiB2ZXJzaW9uYWRkZWQ6OiAxLjQKCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tLQogICAgICAgIHNoYXJkX2lkOiA6Y2xhc3M6YGludGAKICAgICAgICAgICAgVGhlIHNoYXJkIElEIHRoYXQgcmVxdWVzdGVkIGJlaW5nIElERU5USUZZJ2QKICAgICAgICBpbml0aWFsOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgdGhpcyBJREVOVElGWSBpcyB0aGUgZmlyc3QgaW5pdGlhbCBJREVOVElGWS4KICAgICAgICAiIiIKCiAgICAgICAgaWYgbm90IGluaXRpYWw6CiAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoNS4wKQoKICAgICMgbG9naW4gc3RhdGUgbWFuYWdlbWVudAoKICAgIGFzeW5jIGRlZiBsb2dpbihzZWxmLCB0b2tlbiwgKiwgYm90PVRydWUpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBMb2dzIGluIHRoZSBjbGllbnQgd2l0aCB0aGUgc3BlY2lmaWVkIGNyZWRlbnRpYWxzLgoKICAgICAgICBUaGlzIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIGluIHR3byBkaWZmZXJlbnQgd2F5cy4KCiAgICAgICAgLi4gd2FybmluZzo6CgogICAgICAgICAgICBMb2dnaW5nIG9uIHdpdGggYSB1c2VyIHRva2VuIGlzIGFnYWluc3QgdGhlIERpc2NvcmQKICAgICAgICAgICAgYFRlcm1zIG9mIFNlcnZpY2UgPGh0dHBzOi8vc3VwcG9ydC5kaXNjb3JkLmNvbS9oYy9lbi11cy9hcnRpY2xlcy8xMTUwMDIxOTIzNTI+YF8KICAgICAgICAgICAgYW5kIGRvaW5nIHNvIG1pZ2h0IHBvdGVudGlhbGx5IGdldCB5b3VyIGFjY291bnQgYmFubmVkLgogICAgICAgICAgICBVc2UgdGhpcyBhdCB5b3VyIG93biByaXNrLgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICB0b2tlbjogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSBhdXRoZW50aWNhdGlvbiB0b2tlbi4gRG8gbm90IHByZWZpeCB0aGlzIHRva2VuIHdpdGgKICAgICAgICAgICAgYW55dGhpbmcgYXMgdGhlIGxpYnJhcnkgd2lsbCBkbyBpdCBmb3IgeW91LgogICAgICAgIGJvdDogOmNsYXNzOmBib29sYAogICAgICAgICAgICBLZXl3b3JkIGFyZ3VtZW50IHRoYXQgc3BlY2lmaWVzIGlmIHRoZSBhY2NvdW50IGxvZ2dpbmcgb24gaXMgYSBib3QKICAgICAgICAgICAgdG9rZW4gb3Igbm90LgoKICAgICAgICAgICAgLi4gZGVwcmVjYXRlZDo6IDEuNwoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0KICAgICAgICA6ZXhjOmAuTG9naW5GYWlsdXJlYAogICAgICAgICAgICBUaGUgd3JvbmcgY3JlZGVudGlhbHMgYXJlIHBhc3NlZC4KICAgICAgICA6ZXhjOmAuSFRUUEV4Y2VwdGlvbmAKICAgICAgICAgICAgQW4gdW5rbm93biBIVFRQIHJlbGF0ZWQgZXJyb3Igb2NjdXJyZWQsCiAgICAgICAgICAgIHVzdWFsbHkgd2hlbiBpdCBpc24ndCAyMDAgb3IgdGhlIGtub3duIGluY29ycmVjdCBjcmVkZW50aWFscwogICAgICAgICAgICBwYXNzaW5nIHN0YXR1cyBjb2RlLgogICAgICAgICIiIgoKICAgICAgICBsb2cuaW5mbygnbG9nZ2luZyBpbiB1c2luZyBzdGF0aWMgdG9rZW4nKQogICAgICAgIGF3YWl0IHNlbGYuaHR0cC5zdGF0aWNfbG9naW4odG9rZW4uc3RyaXAoKSwgYm90PWJvdCkKICAgICAgICBzZWxmLl9jb25uZWN0aW9uLmlzX2JvdCA9IGJvdAoKICAgIEB1dGlscy5kZXByZWNhdGVkKCdDbGllbnQuY2xvc2UnKQogICAgYXN5bmMgZGVmIGxvZ291dChzZWxmKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgTG9ncyBvdXQgb2YgRGlzY29yZCBhbmQgY2xvc2VzIGFsbCBjb25uZWN0aW9ucy4KICAgICAgICAKICAgICAgICAuLiBkZXByZWNhdGVkOjogMS43CgogICAgICAgIC4uIG5vdGU6OgoKICAgICAgICAgICAgVGhpcyBpcyBqdXN0IGFuIGFsaWFzIHRvIDptZXRoOmBjbG9zZWAuIElmIHlvdSB3YW50CiAgICAgICAgICAgIHRvIGRvIGV4dHJhbmVvdXMgY2xlYW51cCB3aGVuIHN1YmNsYXNzaW5nLCBpdCBpcyBzdWdnZXN0ZWQKICAgICAgICAgICAgdG8gb3ZlcnJpZGUgOm1ldGg6YGNsb3NlYCBpbnN0ZWFkLgogICAgICAgICIiIgogICAgICAgIGF3YWl0IHNlbGYuY2xvc2UoKQoKICAgIGFzeW5jIGRlZiBjb25uZWN0KHNlbGYsICosIHJlY29ubmVjdD1UcnVlKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgQ3JlYXRlcyBhIHdlYnNvY2tldCBjb25uZWN0aW9uIGFuZCBsZXRzIHRoZSB3ZWJzb2NrZXQgbGlzdGVuCiAgICAgICAgdG8gbWVzc2FnZXMgZnJvbSBEaXNjb3JkLiBUaGlzIGlzIGEgbG9vcCB0aGF0IHJ1bnMgdGhlIGVudGlyZQogICAgICAgIGV2ZW50IHN5c3RlbSBhbmQgbWlzY2VsbGFuZW91cyBhc3BlY3RzIG9mIHRoZSBsaWJyYXJ5LiBDb250cm9sCiAgICAgICAgaXMgbm90IHJlc3VtZWQgdW50aWwgdGhlIFdlYlNvY2tldCBjb25uZWN0aW9uIGlzIHRlcm1pbmF0ZWQuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIHJlY29ubmVjdDogOmNsYXNzOmBib29sYAogICAgICAgICAgICBJZiB3ZSBzaG91bGQgYXR0ZW1wdCByZWNvbm5lY3RpbmcsIGVpdGhlciBkdWUgdG8gaW50ZXJuZXQKICAgICAgICAgICAgZmFpbHVyZSBvciBhIHNwZWNpZmljIGZhaWx1cmUgb24gRGlzY29yZCdzIHBhcnQuIENlcnRhaW4KICAgICAgICAgICAgZGlzY29ubmVjdHMgdGhhdCBsZWFkIHRvIGJhZCBzdGF0ZSB3aWxsIG5vdCBiZSBoYW5kbGVkIChzdWNoIGFzCiAgICAgICAgICAgIGludmFsaWQgc2hhcmRpbmcgcGF5bG9hZHMgb3IgYmFkIHRva2VucykuCgogICAgICAgIFJhaXNlcwogICAgICAgIC0tLS0tLS0KICAgICAgICA6ZXhjOmAuR2F0ZXdheU5vdEZvdW5kYAogICAgICAgICAgICBJZiB0aGUgZ2F0ZXdheSB0byBjb25uZWN0IHRvIERpc2NvcmQgaXMgbm90IGZvdW5kLiBVc3VhbGx5IGlmIHRoaXMKICAgICAgICAgICAgaXMgdGhyb3duIHRoZW4gdGhlcmUgaXMgYSBEaXNjb3JkIEFQSSBvdXRhZ2UuCiAgICAgICAgOmV4YzpgLkNvbm5lY3Rpb25DbG9zZWRgCiAgICAgICAgICAgIFRoZSB3ZWJzb2NrZXQgY29ubmVjdGlvbiBoYXMgYmVlbiB0ZXJtaW5hdGVkLgogICAgICAgICIiIgoKICAgICAgICBiYWNrb2ZmID0gRXhwb25lbnRpYWxCYWNrb2ZmKCkKICAgICAgICB3c19wYXJhbXMgPSB7CiAgICAgICAgICAgICdpbml0aWFsJzogVHJ1ZSwKICAgICAgICAgICAgJ3NoYXJkX2lkJzogc2VsZi5zaGFyZF9pZCwKICAgICAgICB9CiAgICAgICAgd2hpbGUgbm90IHNlbGYuaXNfY2xvc2VkKCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGNvcm8gPSBEaXNjb3JkV2ViU29ja2V0LmZyb21fY2xpZW50KHNlbGYsICoqd3NfcGFyYW1zKQogICAgICAgICAgICAgICAgc2VsZi53cyA9IGF3YWl0IGFzeW5jaW8ud2FpdF9mb3IoY29ybywgdGltZW91dD02MC4wKQogICAgICAgICAgICAgICAgd3NfcGFyYW1zWydpbml0aWFsJ10gPSBGYWxzZQogICAgICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLndzLnBvbGxfZXZlbnQoKQogICAgICAgICAgICBleGNlcHQgUmVjb25uZWN0V2ViU29ja2V0IGFzIGU6CiAgICAgICAgICAgICAgICBsb2cuaW5mbygnR290IGEgcmVxdWVzdCB0byAlcyB0aGUgd2Vic29ja2V0LicsIGUub3ApCiAgICAgICAgICAgICAgICBzZWxmLmRpc3BhdGNoKCdkaXNjb25uZWN0JykKICAgICAgICAgICAgICAgIHdzX3BhcmFtcy51cGRhdGUoc2VxdWVuY2U9c2VsZi53cy5zZXF1ZW5jZSwgcmVzdW1lPWUucmVzdW1lLCBzZXNzaW9uPXNlbGYud3Muc2Vzc2lvbl9pZCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGV4Y2VwdCAoT1NFcnJvciwKICAgICAgICAgICAgICAgICAgICBIVFRQRXhjZXB0aW9uLAogICAgICAgICAgICAgICAgICAgIEdhdGV3YXlOb3RGb3VuZCwKICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uQ2xvc2VkLAogICAgICAgICAgICAgICAgICAgIGFpb2h0dHAuQ2xpZW50RXJyb3IsCiAgICAgICAgICAgICAgICAgICAgYXN5bmNpby5UaW1lb3V0RXJyb3IpIGFzIGV4YzoKCiAgICAgICAgICAgICAgICBzZWxmLmRpc3BhdGNoKCdkaXNjb25uZWN0JykKICAgICAgICAgICAgICAgIGlmIG5vdCByZWNvbm5lY3Q6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShleGMsIENvbm5lY3Rpb25DbG9zZWQpIGFuZCBleGMuY29kZSA9PSAxMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAjIGNsZWFuIGNsb3NlLCBkb24ndCByZS1yYWlzZSB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgICAgICAgICAgaWYgc2VsZi5pc19jbG9zZWQoKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgICAgICAgICAjIElmIHdlIGdldCBjb25uZWN0aW9uIHJlc2V0IGJ5IHBlZXIgdGhlbiB0cnkgdG8gUkVTVU1FCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGV4YywgT1NFcnJvcikgYW5kIGV4Yy5lcnJubyBpbiAoNTQsIDEwMDU0KToKICAgICAgICAgICAgICAgICAgICB3c19wYXJhbXMudXBkYXRlKHNlcXVlbmNlPXNlbGYud3Muc2VxdWVuY2UsIGluaXRpYWw9RmFsc2UsIHJlc3VtZT1UcnVlLCBzZXNzaW9uPXNlbGYud3Muc2Vzc2lvbl9pZCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgICAgICMgV2Ugc2hvdWxkIG9ubHkgZ2V0IHRoaXMgd2hlbiBhbiB1bmhhbmRsZWQgY2xvc2UgY29kZSBoYXBwZW5zLAogICAgICAgICAgICAgICAgIyBzdWNoIGFzIGEgY2xlYW4gZGlzY29ubmVjdCAoMTAwMCkgb3IgYSBiYWQgc3RhdGUgKGJhZCB0b2tlbiwgbm8gc2hhcmRpbmcsIGV0YykKICAgICAgICAgICAgICAgICMgc29tZXRpbWVzLCBkaXNjb3JkIHNlbmRzIHVzIDEwMDAgZm9yIHVua25vd24gcmVhc29ucyBzbyB3ZSBzaG91bGQgcmVjb25uZWN0CiAgICAgICAgICAgICAgICAjIHJlZ2FyZGxlc3MgYW5kIHJlbHkgb24gaXNfY2xvc2VkIGluc3RlYWQKICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZXhjLCBDb25uZWN0aW9uQ2xvc2VkKToKICAgICAgICAgICAgICAgICAgICBpZiBleGMuY29kZSA9PSA0MDE0OgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBQcml2aWxlZ2VkSW50ZW50c1JlcXVpcmVkKGV4Yy5zaGFyZF9pZCkgZnJvbSBOb25lCiAgICAgICAgICAgICAgICAgICAgaWYgZXhjLmNvZGUgIT0gMTAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgICAgICAgICAgcmV0cnkgPSBiYWNrb2ZmLmRlbGF5KCkKICAgICAgICAgICAgICAgIGxvZy5leGNlcHRpb24oIkF0dGVtcHRpbmcgYSByZWNvbm5lY3QgaW4gJS4yZnMiLCByZXRyeSkKICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAocmV0cnkpCiAgICAgICAgICAgICAgICAjIEFsd2F5cyB0cnkgdG8gUkVTVU1FIHRoZSBjb25uZWN0aW9uCiAgICAgICAgICAgICAgICAjIElmIHRoZSBjb25uZWN0aW9uIGlzIG5vdCBSRVNVTUUtYWJsZSB0aGVuIHRoZSBnYXRld2F5IHdpbGwgaW52YWxpZGF0ZSB0aGUgc2Vzc2lvbi4KICAgICAgICAgICAgICAgICMgVGhpcyBpcyBhcHBhcmVudGx5IHdoYXQgdGhlIG9mZmljaWFsIERpc2NvcmQgY2xpZW50IGRvZXMuCiAgICAgICAgICAgICAgICB3c19wYXJhbXMudXBkYXRlKHNlcXVlbmNlPXNlbGYud3Muc2VxdWVuY2UsIHJlc3VtZT1UcnVlLCBzZXNzaW9uPXNlbGYud3Muc2Vzc2lvbl9pZCkKCiAgICBhc3luYyBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIENsb3NlcyB0aGUgY29ubmVjdGlvbiB0byBEaXNjb3JkLgogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuX2Nsb3NlZDoKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGF3YWl0IHNlbGYuaHR0cC5jbG9zZSgpCiAgICAgICAgc2VsZi5fY2xvc2VkID0gVHJ1ZQoKICAgICAgICBmb3Igdm9pY2UgaW4gc2VsZi52b2ljZV9jbGllbnRzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhd2FpdCB2b2ljZS5kaXNjb25uZWN0KCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICMgaWYgYW4gZXJyb3IgaGFwcGVucyBkdXJpbmcgZGlzY29ubmVjdHMsIGRpc3JlZ2FyZCBpdC4KICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgaWYgc2VsZi53cyBpcyBub3QgTm9uZSBhbmQgc2VsZi53cy5vcGVuOgogICAgICAgICAgICBhd2FpdCBzZWxmLndzLmNsb3NlKGNvZGU9MTAwMCkKCiAgICAgICAgc2VsZi5fcmVhZHkuY2xlYXIoKQoKICAgIGRlZiBjbGVhcihzZWxmKToKICAgICAgICAiIiJDbGVhcnMgdGhlIGludGVybmFsIHN0YXRlIG9mIHRoZSBib3QuCgogICAgICAgIEFmdGVyIHRoaXMsIHRoZSBib3QgY2FuIGJlIGNvbnNpZGVyZWQgInJlLW9wZW5lZCIsIGkuZS4gOm1ldGg6YGlzX2Nsb3NlZGAKICAgICAgICBhbmQgOm1ldGg6YGlzX3JlYWR5YCBib3RoIHJldHVybiBgYEZhbHNlYGAgYWxvbmcgd2l0aCB0aGUgYm90J3MgaW50ZXJuYWwKICAgICAgICBjYWNoZSBjbGVhcmVkLgogICAgICAgICIiIgogICAgICAgIHNlbGYuX2Nsb3NlZCA9IEZhbHNlCiAgICAgICAgc2VsZi5fcmVhZHkuY2xlYXIoKQogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24uY2xlYXIoKQogICAgICAgIHNlbGYuaHR0cC5yZWNyZWF0ZSgpCgogICAgYXN5bmMgZGVmIHN0YXJ0KHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIEEgc2hvcnRoYW5kIGNvcm91dGluZSBmb3IgOm1ldGg6YGxvZ2luYCArIDptZXRoOmBjb25uZWN0YC4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIFR5cGVFcnJvcgogICAgICAgICAgICBBbiB1bmV4cGVjdGVkIGtleXdvcmQgYXJndW1lbnQgd2FzIHJlY2VpdmVkLgogICAgICAgICIiIgogICAgICAgIGJvdCA9IGt3YXJncy5wb3AoJ2JvdCcsIFRydWUpCiAgICAgICAgcmVjb25uZWN0ID0ga3dhcmdzLnBvcCgncmVjb25uZWN0JywgVHJ1ZSkKCiAgICAgICAgaWYga3dhcmdzOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoInVuZXhwZWN0ZWQga2V5d29yZCBhcmd1bWVudChzKSAlcyIgJSBsaXN0KGt3YXJncy5rZXlzKCkpKQoKICAgICAgICBhd2FpdCBzZWxmLmxvZ2luKCphcmdzLCBib3Q9Ym90KQogICAgICAgIGF3YWl0IHNlbGYuY29ubmVjdChyZWNvbm5lY3Q9cmVjb25uZWN0KQoKICAgIGRlZiBydW4oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAiIiJBIGJsb2NraW5nIGNhbGwgdGhhdCBhYnN0cmFjdHMgYXdheSB0aGUgZXZlbnQgbG9vcAogICAgICAgIGluaXRpYWxpc2F0aW9uIGZyb20geW91LgoKICAgICAgICBJZiB5b3Ugd2FudCBtb3JlIGNvbnRyb2wgb3ZlciB0aGUgZXZlbnQgbG9vcCB0aGVuIHRoaXMKICAgICAgICBmdW5jdGlvbiBzaG91bGQgbm90IGJlIHVzZWQuIFVzZSA6bWV0aDpgc3RhcnRgIGNvcm91dGluZQogICAgICAgIG9yIDptZXRoOmBjb25uZWN0YCArIDptZXRoOmBsb2dpbmAuCgogICAgICAgIFJvdWdobHkgRXF1aXZhbGVudCB0bzogOjoKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGxvb3AucnVuX3VudGlsX2NvbXBsZXRlKHN0YXJ0KCphcmdzLCAqKmt3YXJncykpCiAgICAgICAgICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICAgICAgICAgIGxvb3AucnVuX3VudGlsX2NvbXBsZXRlKGNsb3NlKCkpCiAgICAgICAgICAgICAgICAjIGNhbmNlbCBhbGwgdGFza3MgbGluZ2VyaW5nCiAgICAgICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICAgICBsb29wLmNsb3NlKCkKCiAgICAgICAgLi4gd2FybmluZzo6CgogICAgICAgICAgICBUaGlzIGZ1bmN0aW9uIG11c3QgYmUgdGhlIGxhc3QgZnVuY3Rpb24gdG8gY2FsbCBkdWUgdG8gdGhlIGZhY3QgdGhhdCBpdAogICAgICAgICAgICBpcyBibG9ja2luZy4gVGhhdCBtZWFucyB0aGF0IHJlZ2lzdHJhdGlvbiBvZiBldmVudHMgb3IgYW55dGhpbmcgYmVpbmcKICAgICAgICAgICAgY2FsbGVkIGFmdGVyIHRoaXMgZnVuY3Rpb24gY2FsbCB3aWxsIG5vdCBleGVjdXRlIHVudGlsIGl0IHJldHVybnMuCiAgICAgICAgIiIiCiAgICAgICAgbG9vcCA9IHNlbGYubG9vcAoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvb3AuYWRkX3NpZ25hbF9oYW5kbGVyKHNpZ25hbC5TSUdJTlQsIGxhbWJkYTogbG9vcC5zdG9wKCkpCiAgICAgICAgICAgIGxvb3AuYWRkX3NpZ25hbF9oYW5kbGVyKHNpZ25hbC5TSUdURVJNLCBsYW1iZGE6IGxvb3Auc3RvcCgpKQogICAgICAgIGV4Y2VwdCBOb3RJbXBsZW1lbnRlZEVycm9yOgogICAgICAgICAgICBwYXNzCgogICAgICAgIGFzeW5jIGRlZiBydW5uZXIoKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5zdGFydCgqYXJncywgKiprd2FyZ3MpCiAgICAgICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5pc19jbG9zZWQoKToKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmNsb3NlKCkKCiAgICAgICAgZGVmIHN0b3BfbG9vcF9vbl9jb21wbGV0aW9uKGYpOgogICAgICAgICAgICBsb29wLnN0b3AoKQoKICAgICAgICBmdXR1cmUgPSBhc3luY2lvLmVuc3VyZV9mdXR1cmUocnVubmVyKCksIGxvb3A9bG9vcCkKICAgICAgICBmdXR1cmUuYWRkX2RvbmVfY2FsbGJhY2soc3RvcF9sb29wX29uX2NvbXBsZXRpb24pCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb29wLnJ1bl9mb3JldmVyKCkKICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgIGxvZy5pbmZvKCdSZWNlaXZlZCBzaWduYWwgdG8gdGVybWluYXRlIGJvdCBhbmQgZXZlbnQgbG9vcC4nKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIGZ1dHVyZS5yZW1vdmVfZG9uZV9jYWxsYmFjayhzdG9wX2xvb3Bfb25fY29tcGxldGlvbikKICAgICAgICAgICAgbG9nLmluZm8oJ0NsZWFuaW5nIHVwIHRhc2tzLicpCiAgICAgICAgICAgIF9jbGVhbnVwX2xvb3AobG9vcCkKCiAgICAgICAgaWYgbm90IGZ1dHVyZS5jYW5jZWxsZWQoKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0dXJuIGZ1dHVyZS5yZXN1bHQoKQogICAgICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgICAgICAjIEkgYW0gdW5zdXJlIHdoeSB0aGlzIGdldHMgcmFpc2VkIGhlcmUgYnV0IHN1cHByZXNzIGl0IGFueXdheQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAjIHByb3BlcnRpZXMKCiAgICBkZWYgaXNfY2xvc2VkKHNlbGYpOgogICAgICAgICIiIjpjbGFzczpgYm9vbGA6IEluZGljYXRlcyBpZiB0aGUgd2Vic29ja2V0IGNvbm5lY3Rpb24gaXMgY2xvc2VkLiIiIgogICAgICAgIHJldHVybiBzZWxmLl9jbG9zZWQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBhY3Rpdml0eShzZWxmKToKICAgICAgICAiIiJPcHRpb25hbFs6Y2xhc3M6YC5CYXNlQWN0aXZpdHlgXTogVGhlIGFjdGl2aXR5IGJlaW5nIHVzZWQgdXBvbgogICAgICAgIGxvZ2dpbmcgaW4uCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGNyZWF0ZV9hY3Rpdml0eShzZWxmLl9jb25uZWN0aW9uLl9hY3Rpdml0eSkKCiAgICBAYWN0aXZpdHkuc2V0dGVyCiAgICBkZWYgYWN0aXZpdHkoc2VsZiwgdmFsdWUpOgogICAgICAgIGlmIHZhbHVlIGlzIE5vbmU6CiAgICAgICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24uX2FjdGl2aXR5ID0gTm9uZQogICAgICAgIGVsaWYgaXNpbnN0YW5jZSh2YWx1ZSwgQmFzZUFjdGl2aXR5KToKICAgICAgICAgICAgc2VsZi5fY29ubmVjdGlvbi5fYWN0aXZpdHkgPSB2YWx1ZS50b19kaWN0KCkKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ2FjdGl2aXR5IG11c3QgZGVyaXZlIGZyb20gQmFzZUFjdGl2aXR5LicpCgogICAgQHByb3BlcnR5CiAgICBkZWYgYWxsb3dlZF9tZW50aW9ucyhzZWxmKToKICAgICAgICAiIiJPcHRpb25hbFs6Y2xhc3M6YH5kaXNjb3JkLkFsbG93ZWRNZW50aW9uc2BdOiBUaGUgYWxsb3dlZCBtZW50aW9uIGNvbmZpZ3VyYXRpb24uCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNAogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9jb25uZWN0aW9uLmFsbG93ZWRfbWVudGlvbnMKCiAgICBAYWxsb3dlZF9tZW50aW9ucy5zZXR0ZXIKICAgIGRlZiBhbGxvd2VkX21lbnRpb25zKHNlbGYsIHZhbHVlKToKICAgICAgICBpZiB2YWx1ZSBpcyBOb25lIG9yIGlzaW5zdGFuY2UodmFsdWUsIEFsbG93ZWRNZW50aW9ucyk6CiAgICAgICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24uYWxsb3dlZF9tZW50aW9ucyA9IHZhbHVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCdhbGxvd2VkX21lbnRpb25zIG11c3QgYmUgQWxsb3dlZE1lbnRpb25zIG5vdCB7MC5fX2NsYXNzX18hcn0nLmZvcm1hdCh2YWx1ZSkpCgogICAgQHByb3BlcnR5CiAgICBkZWYgaW50ZW50cyhzZWxmKToKICAgICAgICAiIiI6Y2xhc3M6YH5kaXNjb3JkLkludGVudHNgOiBUaGUgaW50ZW50cyBjb25maWd1cmVkIGZvciB0aGlzIGNvbm5lY3Rpb24uCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuNQogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9jb25uZWN0aW9uLmludGVudHMKCiAgICAjIGhlbHBlcnMvZ2V0dGVycwoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHVzZXJzKHNlbGYpOgogICAgICAgICIiIkxpc3RbOmNsYXNzOmB+ZGlzY29yZC5Vc2VyYF06IFJldHVybnMgYSBsaXN0IG9mIGFsbCB0aGUgdXNlcnMgdGhlIGJvdCBjYW4gc2VlLiIiIgogICAgICAgIHJldHVybiBsaXN0KHNlbGYuX2Nvbm5lY3Rpb24uX3VzZXJzLnZhbHVlcygpKQoKICAgIGRlZiBnZXRfY2hhbm5lbChzZWxmLCBpZCk6CiAgICAgICAgIiIiUmV0dXJucyBhIGNoYW5uZWwgd2l0aCB0aGUgZ2l2ZW4gSUQuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIGlkOiA6Y2xhc3M6YGludGAKICAgICAgICAgICAgVGhlIElEIHRvIHNlYXJjaCBmb3IuCgogICAgICAgIFJldHVybnMKICAgICAgICAtLS0tLS0tLQogICAgICAgIE9wdGlvbmFsW1VuaW9uWzpjbGFzczpgLmFiYy5HdWlsZENoYW5uZWxgLCA6Y2xhc3M6YC5hYmMuUHJpdmF0ZUNoYW5uZWxgXV0KICAgICAgICAgICAgVGhlIHJldHVybmVkIGNoYW5uZWwgb3IgYGBOb25lYGAgaWYgbm90IGZvdW5kLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9jb25uZWN0aW9uLmdldF9jaGFubmVsKGlkKQoKICAgIGRlZiBnZXRfZ3VpbGQoc2VsZiwgaWQpOgogICAgICAgICIiIlJldHVybnMgYSBndWlsZCB3aXRoIHRoZSBnaXZlbiBJRC4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgaWQ6IDpjbGFzczpgaW50YAogICAgICAgICAgICBUaGUgSUQgdG8gc2VhcmNoIGZvci4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgT3B0aW9uYWxbOmNsYXNzOmAuR3VpbGRgXQogICAgICAgICAgICBUaGUgZ3VpbGQgb3IgYGBOb25lYGAgaWYgbm90IGZvdW5kLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9jb25uZWN0aW9uLl9nZXRfZ3VpbGQoaWQpCgogICAgZGVmIGdldF91c2VyKHNlbGYsIGlkKToKICAgICAgICAiIiJSZXR1cm5zIGEgdXNlciB3aXRoIHRoZSBnaXZlbiBJRC4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgaWQ6IDpjbGFzczpgaW50YAogICAgICAgICAgICBUaGUgSUQgdG8gc2VhcmNoIGZvci4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgT3B0aW9uYWxbOmNsYXNzOmB+ZGlzY29yZC5Vc2VyYF0KICAgICAgICAgICAgVGhlIHVzZXIgb3IgYGBOb25lYGAgaWYgbm90IGZvdW5kLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9jb25uZWN0aW9uLmdldF91c2VyKGlkKQoKICAgIGRlZiBnZXRfZW1vamkoc2VsZiwgaWQpOgogICAgICAgICIiIlJldHVybnMgYW4gZW1vamkgd2l0aCB0aGUgZ2l2ZW4gSUQuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIGlkOiA6Y2xhc3M6YGludGAKICAgICAgICAgICAgVGhlIElEIHRvIHNlYXJjaCBmb3IuCgogICAgICAgIFJldHVybnMKICAgICAgICAtLS0tLS0tLQogICAgICAgIE9wdGlvbmFsWzpjbGFzczpgLkVtb2ppYF0KICAgICAgICAgICAgVGhlIGN1c3RvbSBlbW9qaSBvciBgYE5vbmVgYCBpZiBub3QgZm91bmQuCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX2Nvbm5lY3Rpb24uZ2V0X2Vtb2ppKGlkKQoKICAgIGRlZiBnZXRfYWxsX2NoYW5uZWxzKHNlbGYpOgogICAgICAgICIiIkEgZ2VuZXJhdG9yIHRoYXQgcmV0cmlldmVzIGV2ZXJ5IDpjbGFzczpgLmFiYy5HdWlsZENoYW5uZWxgIHRoZSBjbGllbnQgY2FuICdhY2Nlc3MnLgoKICAgICAgICBUaGlzIGlzIGVxdWl2YWxlbnQgdG86IDo6CgogICAgICAgICAgICBmb3IgZ3VpbGQgaW4gY2xpZW50Lmd1aWxkczoKICAgICAgICAgICAgICAgIGZvciBjaGFubmVsIGluIGd1aWxkLmNoYW5uZWxzOgogICAgICAgICAgICAgICAgICAgIHlpZWxkIGNoYW5uZWwKCiAgICAgICAgLi4gbm90ZTo6CgogICAgICAgICAgICBKdXN0IGJlY2F1c2UgeW91IHJlY2VpdmUgYSA6Y2xhc3M6YC5hYmMuR3VpbGRDaGFubmVsYCBkb2VzIG5vdCBtZWFuIHRoYXQKICAgICAgICAgICAgeW91IGNhbiBjb21tdW5pY2F0ZSBpbiBzYWlkIGNoYW5uZWwuIDptZXRoOmAuYWJjLkd1aWxkQ2hhbm5lbC5wZXJtaXNzaW9uc19mb3JgIHNob3VsZAogICAgICAgICAgICBiZSB1c2VkIGZvciB0aGF0LgoKICAgICAgICBZaWVsZHMKICAgICAgICAtLS0tLS0KICAgICAgICA6Y2xhc3M6YC5hYmMuR3VpbGRDaGFubmVsYAogICAgICAgICAgICBBIGNoYW5uZWwgdGhlIGNsaWVudCBjYW4gJ2FjY2VzcycuCiAgICAgICAgIiIiCgogICAgICAgIGZvciBndWlsZCBpbiBzZWxmLmd1aWxkczoKICAgICAgICAgICAgZm9yIGNoYW5uZWwgaW4gZ3VpbGQuY2hhbm5lbHM6CiAgICAgICAgICAgICAgICB5aWVsZCBjaGFubmVsCgogICAgZGVmIGdldF9hbGxfbWVtYmVycyhzZWxmKToKICAgICAgICAiIiJSZXR1cm5zIGEgZ2VuZXJhdG9yIHdpdGggZXZlcnkgOmNsYXNzOmAuTWVtYmVyYCB0aGUgY2xpZW50IGNhbiBzZWUuCgogICAgICAgIFRoaXMgaXMgZXF1aXZhbGVudCB0bzogOjoKCiAgICAgICAgICAgIGZvciBndWlsZCBpbiBjbGllbnQuZ3VpbGRzOgogICAgICAgICAgICAgICAgZm9yIG1lbWJlciBpbiBndWlsZC5tZW1iZXJzOgogICAgICAgICAgICAgICAgICAgIHlpZWxkIG1lbWJlcgoKICAgICAgICBZaWVsZHMKICAgICAgICAtLS0tLS0KICAgICAgICA6Y2xhc3M6YC5NZW1iZXJgCiAgICAgICAgICAgIEEgbWVtYmVyIHRoZSBjbGllbnQgY2FuIHNlZS4KICAgICAgICAiIiIKICAgICAgICBmb3IgZ3VpbGQgaW4gc2VsZi5ndWlsZHM6CiAgICAgICAgICAgIGZvciBtZW1iZXIgaW4gZ3VpbGQubWVtYmVyczoKICAgICAgICAgICAgICAgIHlpZWxkIG1lbWJlcgoKICAgICMgbGlzdGVuZXJzL3dhaXRlcnMKCiAgICBhc3luYyBkZWYgd2FpdF91bnRpbF9yZWFkeShzZWxmKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgV2FpdHMgdW50aWwgdGhlIGNsaWVudCdzIGludGVybmFsIGNhY2hlIGlzIGFsbCByZWFkeS4KICAgICAgICAiIiIKICAgICAgICBhd2FpdCBzZWxmLl9yZWFkeS53YWl0KCkKCiAgICBkZWYgd2FpdF9mb3Ioc2VsZiwgZXZlbnQsICosIGNoZWNrPU5vbmUsIHRpbWVvdXQ9Tm9uZSk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIFdhaXRzIGZvciBhIFdlYlNvY2tldCBldmVudCB0byBiZSBkaXNwYXRjaGVkLgoKICAgICAgICBUaGlzIGNvdWxkIGJlIHVzZWQgdG8gd2FpdCBmb3IgYSB1c2VyIHRvIHJlcGx5IHRvIGEgbWVzc2FnZSwKICAgICAgICBvciB0byByZWFjdCB0byBhIG1lc3NhZ2UsIG9yIHRvIGVkaXQgYSBtZXNzYWdlIGluIGEgc2VsZi1jb250YWluZWQKICAgICAgICB3YXkuCgogICAgICAgIFRoZSBgYHRpbWVvdXRgYCBwYXJhbWV0ZXIgaXMgcGFzc2VkIG9udG8gOmZ1bmM6YGFzeW5jaW8ud2FpdF9mb3JgLiBCeSBkZWZhdWx0LAogICAgICAgIGl0IGRvZXMgbm90IHRpbWVvdXQuIE5vdGUgdGhhdCB0aGlzIGRvZXMgcHJvcGFnYXRlIHRoZQogICAgICAgIDpleGM6YGFzeW5jaW8uVGltZW91dEVycm9yYCBmb3IgeW91IGluIGNhc2Ugb2YgdGltZW91dCBhbmQgaXMgcHJvdmlkZWQgZm9yCiAgICAgICAgZWFzZSBvZiB1c2UuCgogICAgICAgIEluIGNhc2UgdGhlIGV2ZW50IHJldHVybnMgbXVsdGlwbGUgYXJndW1lbnRzLCBhIDpjbGFzczpgdHVwbGVgIGNvbnRhaW5pbmcgdGhvc2UKICAgICAgICBhcmd1bWVudHMgaXMgcmV0dXJuZWQgaW5zdGVhZC4gUGxlYXNlIGNoZWNrIHRoZQogICAgICAgIDpyZWY6YGRvY3VtZW50YXRpb24gPGRpc2NvcmQtYXBpLWV2ZW50cz5gIGZvciBhIGxpc3Qgb2YgZXZlbnRzIGFuZCB0aGVpcgogICAgICAgIHBhcmFtZXRlcnMuCgogICAgICAgIFRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgKipmaXJzdCBldmVudCB0aGF0IG1lZXRzIHRoZSByZXF1aXJlbWVudHMqKi4KCiAgICAgICAgRXhhbXBsZXMKICAgICAgICAtLS0tLS0tLS0KCiAgICAgICAgV2FpdGluZyBmb3IgYSB1c2VyIHJlcGx5OiA6OgoKICAgICAgICAgICAgQGNsaWVudC5ldmVudAogICAgICAgICAgICBhc3luYyBkZWYgb25fbWVzc2FnZShtZXNzYWdlKToKICAgICAgICAgICAgICAgIGlmIG1lc3NhZ2UuY29udGVudC5zdGFydHN3aXRoKCckZ3JlZXQnKToKICAgICAgICAgICAgICAgICAgICBjaGFubmVsID0gbWVzc2FnZS5jaGFubmVsCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2hhbm5lbC5zZW5kKCdTYXkgaGVsbG8hJykKCiAgICAgICAgICAgICAgICAgICAgZGVmIGNoZWNrKG0pOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5jb250ZW50ID09ICdoZWxsbycgYW5kIG0uY2hhbm5lbCA9PSBjaGFubmVsCgogICAgICAgICAgICAgICAgICAgIG1zZyA9IGF3YWl0IGNsaWVudC53YWl0X2ZvcignbWVzc2FnZScsIGNoZWNrPWNoZWNrKQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGNoYW5uZWwuc2VuZCgnSGVsbG8gey5hdXRob3J9IScuZm9ybWF0KG1zZykpCgogICAgICAgIFdhaXRpbmcgZm9yIGEgdGh1bWJzIHVwIHJlYWN0aW9uIGZyb20gdGhlIG1lc3NhZ2UgYXV0aG9yOiA6OgoKICAgICAgICAgICAgQGNsaWVudC5ldmVudAogICAgICAgICAgICBhc3luYyBkZWYgb25fbWVzc2FnZShtZXNzYWdlKToKICAgICAgICAgICAgICAgIGlmIG1lc3NhZ2UuY29udGVudC5zdGFydHN3aXRoKCckdGh1bWInKToKICAgICAgICAgICAgICAgICAgICBjaGFubmVsID0gbWVzc2FnZS5jaGFubmVsCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2hhbm5lbC5zZW5kKCdTZW5kIG1lIHRoYXQgXE57VEhVTUJTIFVQIFNJR059IHJlYWN0aW9uLCBtYXRlJykKCiAgICAgICAgICAgICAgICAgICAgZGVmIGNoZWNrKHJlYWN0aW9uLCB1c2VyKToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXIgPT0gbWVzc2FnZS5hdXRob3IgYW5kIHN0cihyZWFjdGlvbi5lbW9qaSkgPT0gJ1xOe1RIVU1CUyBVUCBTSUdOfScKCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICByZWFjdGlvbiwgdXNlciA9IGF3YWl0IGNsaWVudC53YWl0X2ZvcigncmVhY3Rpb25fYWRkJywgdGltZW91dD02MC4wLCBjaGVjaz1jaGVjaykKICAgICAgICAgICAgICAgICAgICBleGNlcHQgYXN5bmNpby5UaW1lb3V0RXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNoYW5uZWwuc2VuZCgnXE57VEhVTUJTIERPV04gU0lHTn0nKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNoYW5uZWwuc2VuZCgnXE57VEhVTUJTIFVQIFNJR059JykKCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLS0KICAgICAgICBldmVudDogOmNsYXNzOmBzdHJgCiAgICAgICAgICAgIFRoZSBldmVudCBuYW1lLCBzaW1pbGFyIHRvIHRoZSA6cmVmOmBldmVudCByZWZlcmVuY2UgPGRpc2NvcmQtYXBpLWV2ZW50cz5gLAogICAgICAgICAgICBidXQgd2l0aG91dCB0aGUgYGBvbl9gYCBwcmVmaXgsIHRvIHdhaXQgZm9yLgogICAgICAgIGNoZWNrOiBPcHRpb25hbFtDYWxsYWJsZVsuLi4sIDpjbGFzczpgYm9vbGBdXQogICAgICAgICAgICBBIHByZWRpY2F0ZSB0byBjaGVjayB3aGF0IHRvIHdhaXQgZm9yLiBUaGUgYXJndW1lbnRzIG11c3QgbWVldCB0aGUKICAgICAgICAgICAgcGFyYW1ldGVycyBvZiB0aGUgZXZlbnQgYmVpbmcgd2FpdGVkIGZvci4KICAgICAgICB0aW1lb3V0OiBPcHRpb25hbFs6Y2xhc3M6YGZsb2F0YF0KICAgICAgICAgICAgVGhlIG51bWJlciBvZiBzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHRpbWluZyBvdXQgYW5kIHJhaXNpbmcKICAgICAgICAgICAgOmV4YzpgYXN5bmNpby5UaW1lb3V0RXJyb3JgLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tCiAgICAgICAgYXN5bmNpby5UaW1lb3V0RXJyb3IKICAgICAgICAgICAgSWYgYSB0aW1lb3V0IGlzIHByb3ZpZGVkIGFuZCBpdCB3YXMgcmVhY2hlZC4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgQW55CiAgICAgICAgICAgIFJldHVybnMgbm8gYXJndW1lbnRzLCBhIHNpbmdsZSBhcmd1bWVudCwgb3IgYSA6Y2xhc3M6YHR1cGxlYCBvZiBtdWx0aXBsZQogICAgICAgICAgICBhcmd1bWVudHMgdGhhdCBtaXJyb3JzIHRoZSBwYXJhbWV0ZXJzIHBhc3NlZCBpbiB0aGUKICAgICAgICAgICAgOnJlZjpgZXZlbnQgcmVmZXJlbmNlIDxkaXNjb3JkLWFwaS1ldmVudHM+YC4KICAgICAgICAiIiIKCiAgICAgICAgZnV0dXJlID0gc2VsZi5sb29wLmNyZWF0ZV9mdXR1cmUoKQogICAgICAgIGlmIGNoZWNrIGlzIE5vbmU6CiAgICAgICAgICAgIGRlZiBfY2hlY2soKmFyZ3MpOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgY2hlY2sgPSBfY2hlY2sKCiAgICAgICAgZXYgPSBldmVudC5sb3dlcigpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsaXN0ZW5lcnMgPSBzZWxmLl9saXN0ZW5lcnNbZXZdCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICBsaXN0ZW5lcnMgPSBbXQogICAgICAgICAgICBzZWxmLl9saXN0ZW5lcnNbZXZdID0gbGlzdGVuZXJzCgogICAgICAgIGxpc3RlbmVycy5hcHBlbmQoKGZ1dHVyZSwgY2hlY2spKQogICAgICAgIHJldHVybiBhc3luY2lvLndhaXRfZm9yKGZ1dHVyZSwgdGltZW91dCkKCiAgICAjIGV2ZW50IHJlZ2lzdHJhdGlvbgoKICAgIGRlZiBldmVudChzZWxmLCBjb3JvKToKICAgICAgICAiIiJBIGRlY29yYXRvciB0aGF0IHJlZ2lzdGVycyBhbiBldmVudCB0byBsaXN0ZW4gdG8uCgogICAgICAgIFlvdSBjYW4gZmluZCBtb3JlIGluZm8gYWJvdXQgdGhlIGV2ZW50cyBvbiB0aGUgOnJlZjpgZG9jdW1lbnRhdGlvbiBiZWxvdyA8ZGlzY29yZC1hcGktZXZlbnRzPmAuCgogICAgICAgIFRoZSBldmVudHMgbXVzdCBiZSBhIDpyZWY6YGNvcm91dGluZSA8Y29yb3V0aW5lPmAsIGlmIG5vdCwgOmV4YzpgVHlwZUVycm9yYCBpcyByYWlzZWQuCgogICAgICAgIEV4YW1wbGUKICAgICAgICAtLS0tLS0tLS0KCiAgICAgICAgLi4gY29kZS1ibG9jazo6IHB5dGhvbjMKCiAgICAgICAgICAgIEBjbGllbnQuZXZlbnQKICAgICAgICAgICAgYXN5bmMgZGVmIG9uX3JlYWR5KCk6CiAgICAgICAgICAgICAgICBwcmludCgnUmVhZHkhJykKCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLS0KICAgICAgICBUeXBlRXJyb3IKICAgICAgICAgICAgVGhlIGNvcm91dGluZSBwYXNzZWQgaXMgbm90IGFjdHVhbGx5IGEgY29yb3V0aW5lLgogICAgICAgICIiIgoKICAgICAgICBpZiBub3QgYXN5bmNpby5pc2Nvcm91dGluZWZ1bmN0aW9uKGNvcm8pOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ2V2ZW50IHJlZ2lzdGVyZWQgbXVzdCBiZSBhIGNvcm91dGluZSBmdW5jdGlvbicpCgogICAgICAgIHNldGF0dHIoc2VsZiwgY29yby5fX25hbWVfXywgY29ybykKICAgICAgICBsb2cuZGVidWcoJyVzIGhhcyBzdWNjZXNzZnVsbHkgYmVlbiByZWdpc3RlcmVkIGFzIGFuIGV2ZW50JywgY29yby5fX25hbWVfXykKICAgICAgICByZXR1cm4gY29ybwoKICAgIGFzeW5jIGRlZiBjaGFuZ2VfcHJlc2VuY2Uoc2VsZiwgKiwgYWN0aXZpdHk9Tm9uZSwgc3RhdHVzPU5vbmUsIGFmaz1GYWxzZSk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIENoYW5nZXMgdGhlIGNsaWVudCdzIHByZXNlbmNlLgoKICAgICAgICBFeGFtcGxlCiAgICAgICAgLS0tLS0tLS0tCgogICAgICAgIC4uIGNvZGUtYmxvY2s6OiBweXRob24zCgogICAgICAgICAgICBnYW1lID0gZGlzY29yZC5HYW1lKCJ3aXRoIHRoZSBBUEkiKQogICAgICAgICAgICBhd2FpdCBjbGllbnQuY2hhbmdlX3ByZXNlbmNlKHN0YXR1cz1kaXNjb3JkLlN0YXR1cy5pZGxlLCBhY3Rpdml0eT1nYW1lKQoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLQogICAgICAgIGFjdGl2aXR5OiBPcHRpb25hbFs6Y2xhc3M6YC5CYXNlQWN0aXZpdHlgXQogICAgICAgICAgICBUaGUgYWN0aXZpdHkgYmVpbmcgZG9uZS4gYGBOb25lYGAgaWYgbm8gY3VycmVudGx5IGFjdGl2ZSBhY3Rpdml0eSBpcyBkb25lLgogICAgICAgIHN0YXR1czogT3B0aW9uYWxbOmNsYXNzOmAuU3RhdHVzYF0KICAgICAgICAgICAgSW5kaWNhdGVzIHdoYXQgc3RhdHVzIHRvIGNoYW5nZSB0by4gSWYgYGBOb25lYGAsIHRoZW4KICAgICAgICAgICAgOmF0dHI6YC5TdGF0dXMub25saW5lYCBpcyB1c2VkLgogICAgICAgIGFmazogT3B0aW9uYWxbOmNsYXNzOmBib29sYF0KICAgICAgICAgICAgSW5kaWNhdGVzIGlmIHlvdSBhcmUgZ29pbmcgQUZLLiBUaGlzIGFsbG93cyB0aGUgZGlzY29yZAogICAgICAgICAgICBjbGllbnQgdG8ga25vdyBob3cgdG8gaGFuZGxlIHB1c2ggbm90aWZpY2F0aW9ucyBiZXR0ZXIKICAgICAgICAgICAgZm9yIHlvdSBpbiBjYXNlIHlvdSBhcmUgYWN0dWFsbHkgaWRsZSBhbmQgbm90IGx5aW5nLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0KICAgICAgICA6ZXhjOmAuSW52YWxpZEFyZ3VtZW50YAogICAgICAgICAgICBJZiB0aGUgYGBhY3Rpdml0eWBgIHBhcmFtZXRlciBpcyBub3QgdGhlIHByb3BlciB0eXBlLgogICAgICAgICIiIgoKICAgICAgICBpZiBzdGF0dXMgaXMgTm9uZToKICAgICAgICAgICAgc3RhdHVzID0gJ29ubGluZScKICAgICAgICAgICAgc3RhdHVzX2VudW0gPSBTdGF0dXMub25saW5lCiAgICAgICAgZWxpZiBzdGF0dXMgaXMgU3RhdHVzLm9mZmxpbmU6CiAgICAgICAgICAgIHN0YXR1cyA9ICdpbnZpc2libGUnCiAgICAgICAgICAgIHN0YXR1c19lbnVtID0gU3RhdHVzLm9mZmxpbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICBzdGF0dXNfZW51bSA9IHN0YXR1cwogICAgICAgICAgICBzdGF0dXMgPSBzdHIoc3RhdHVzKQoKICAgICAgICBhd2FpdCBzZWxmLndzLmNoYW5nZV9wcmVzZW5jZShhY3Rpdml0eT1hY3Rpdml0eSwgc3RhdHVzPXN0YXR1cywgYWZrPWFmaykKCiAgICAgICAgZm9yIGd1aWxkIGluIHNlbGYuX2Nvbm5lY3Rpb24uZ3VpbGRzOgogICAgICAgICAgICBtZSA9IGd1aWxkLm1lCiAgICAgICAgICAgIGlmIG1lIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgaWYgYWN0aXZpdHkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBtZS5hY3Rpdml0aWVzID0gKGFjdGl2aXR5LCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG1lLmFjdGl2aXRpZXMgPSAoKQoKICAgICAgICAgICAgbWUuc3RhdHVzID0gc3RhdHVzX2VudW0KCiAgICAjIEd1aWxkIHN0dWZmCgogICAgZGVmIGZldGNoX2d1aWxkcyhzZWxmLCAqLCBsaW1pdD0xMDAsIGJlZm9yZT1Ob25lLCBhZnRlcj1Ob25lKToKICAgICAgICAiIiJSZXRyaWV2ZXMgYW4gOmNsYXNzOmAuQXN5bmNJdGVyYXRvcmAgdGhhdCBlbmFibGVzIHJlY2VpdmluZyB5b3VyIGd1aWxkcy4KCiAgICAgICAgLi4gbm90ZTo6CgogICAgICAgICAgICBVc2luZyB0aGlzLCB5b3Ugd2lsbCBvbmx5IHJlY2VpdmUgOmF0dHI6YC5HdWlsZC5vd25lcmAsIDphdHRyOmAuR3VpbGQuaWNvbmAsCiAgICAgICAgICAgIDphdHRyOmAuR3VpbGQuaWRgLCBhbmQgOmF0dHI6YC5HdWlsZC5uYW1lYCBwZXIgOmNsYXNzOmAuR3VpbGRgLgoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgbWV0aG9kIGlzIGFuIEFQSSBjYWxsLiBGb3IgZ2VuZXJhbCB1c2FnZSwgY29uc2lkZXIgOmF0dHI6YGd1aWxkc2AgaW5zdGVhZC4KCiAgICAgICAgRXhhbXBsZXMKICAgICAgICAtLS0tLS0tLS0KCiAgICAgICAgVXNhZ2UgOjoKCiAgICAgICAgICAgIGFzeW5jIGZvciBndWlsZCBpbiBjbGllbnQuZmV0Y2hfZ3VpbGRzKGxpbWl0PTE1MCk6CiAgICAgICAgICAgICAgICBwcmludChndWlsZC5uYW1lKQoKICAgICAgICBGbGF0dGVuaW5nIGludG8gYSBsaXN0IDo6CgogICAgICAgICAgICBndWlsZHMgPSBhd2FpdCBjbGllbnQuZmV0Y2hfZ3VpbGRzKGxpbWl0PTE1MCkuZmxhdHRlbigpCiAgICAgICAgICAgICMgZ3VpbGRzIGlzIG5vdyBhIGxpc3Qgb2YgR3VpbGQuLi4KCiAgICAgICAgQWxsIHBhcmFtZXRlcnMgYXJlIG9wdGlvbmFsLgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0KICAgICAgICBsaW1pdDogT3B0aW9uYWxbOmNsYXNzOmBpbnRgXQogICAgICAgICAgICBUaGUgbnVtYmVyIG9mIGd1aWxkcyB0byByZXRyaWV2ZS4KICAgICAgICAgICAgSWYgYGBOb25lYGAsIGl0IHJldHJpZXZlcyBldmVyeSBndWlsZCB5b3UgaGF2ZSBhY2Nlc3MgdG8uIE5vdGUsIGhvd2V2ZXIsCiAgICAgICAgICAgIHRoYXQgdGhpcyB3b3VsZCBtYWtlIGl0IGEgc2xvdyBvcGVyYXRpb24uCiAgICAgICAgICAgIERlZmF1bHRzIHRvIGBgMTAwYGAuCiAgICAgICAgYmVmb3JlOiBVbmlvbls6Y2xhc3M6YC5hYmMuU25vd2ZsYWtlYCwgOmNsYXNzOmBkYXRldGltZS5kYXRldGltZWBdCiAgICAgICAgICAgIFJldHJpZXZlcyBndWlsZHMgYmVmb3JlIHRoaXMgZGF0ZSBvciBvYmplY3QuCiAgICAgICAgICAgIElmIGEgZGF0ZSBpcyBwcm92aWRlZCBpdCBtdXN0IGJlIGEgdGltZXpvbmUtbmFpdmUgZGF0ZXRpbWUgcmVwcmVzZW50aW5nIFVUQyB0aW1lLgogICAgICAgIGFmdGVyOiBVbmlvbls6Y2xhc3M6YC5hYmMuU25vd2ZsYWtlYCwgOmNsYXNzOmBkYXRldGltZS5kYXRldGltZWBdCiAgICAgICAgICAgIFJldHJpZXZlIGd1aWxkcyBhZnRlciB0aGlzIGRhdGUgb3Igb2JqZWN0LgogICAgICAgICAgICBJZiBhIGRhdGUgaXMgcHJvdmlkZWQgaXQgbXVzdCBiZSBhIHRpbWV6b25lLW5haXZlIGRhdGV0aW1lIHJlcHJlc2VudGluZyBVVEMgdGltZS4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tCiAgICAgICAgOmV4YzpgLkhUVFBFeGNlcHRpb25gCiAgICAgICAgICAgIEdldHRpbmcgdGhlIGd1aWxkcyBmYWlsZWQuCgogICAgICAgIFlpZWxkcwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgOmNsYXNzOmAuR3VpbGRgCiAgICAgICAgICAgIFRoZSBndWlsZCB3aXRoIHRoZSBndWlsZCBkYXRhIHBhcnNlZC4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gR3VpbGRJdGVyYXRvcihzZWxmLCBsaW1pdD1saW1pdCwgYmVmb3JlPWJlZm9yZSwgYWZ0ZXI9YWZ0ZXIpCgogICAgYXN5bmMgZGVmIGZldGNoX3RlbXBsYXRlKHNlbGYsIGNvZGUpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBHZXRzIGEgOmNsYXNzOmAuVGVtcGxhdGVgIGZyb20gYSBkaXNjb3JkLm5ldyBVUkwgb3IgY29kZS4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgY29kZTogVW5pb25bOmNsYXNzOmAuVGVtcGxhdGVgLCA6Y2xhc3M6YHN0cmBdCiAgICAgICAgICAgIFRoZSBEaXNjb3JkIFRlbXBsYXRlIENvZGUgb3IgVVJMIChtdXN0IGJlIGEgZGlzY29yZC5uZXcgVVJMKS4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIDpleGM6YC5Ob3RGb3VuZGAKICAgICAgICAgICAgVGhlIHRlbXBsYXRlIGlzIGludmFsaWQuCiAgICAgICAgOmV4YzpgLkhUVFBFeGNlcHRpb25gCiAgICAgICAgICAgIEdldHRpbmcgdGhlIHRlbXBsYXRlIGZhaWxlZC4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgOmNsYXNzOmAuVGVtcGxhdGVgCiAgICAgICAgICAgIFRoZSB0ZW1wbGF0ZSBmcm9tIHRoZSBVUkwvY29kZS4KICAgICAgICAiIiIKICAgICAgICBjb2RlID0gdXRpbHMucmVzb2x2ZV90ZW1wbGF0ZShjb2RlKQogICAgICAgIGRhdGEgPSBhd2FpdCBzZWxmLmh0dHAuZ2V0X3RlbXBsYXRlKGNvZGUpCiAgICAgICAgcmV0dXJuIFRlbXBsYXRlKGRhdGE9ZGF0YSwgc3RhdGU9c2VsZi5fY29ubmVjdGlvbikKCiAgICBhc3luYyBkZWYgZmV0Y2hfZ3VpbGQoc2VsZiwgZ3VpbGRfaWQpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBSZXRyaWV2ZXMgYSA6Y2xhc3M6YC5HdWlsZGAgZnJvbSBhbiBJRC4KCiAgICAgICAgLi4gbm90ZTo6CgogICAgICAgICAgICBVc2luZyB0aGlzLCB5b3Ugd2lsbCAqKm5vdCoqIHJlY2VpdmUgOmF0dHI6YC5HdWlsZC5jaGFubmVsc2AsIDphdHRyOmAuR3VpbGQubWVtYmVyc2AsCiAgICAgICAgICAgIDphdHRyOmAuTWVtYmVyLmFjdGl2aXR5YCBhbmQgOmF0dHI6YC5NZW1iZXIudm9pY2VgIHBlciA6Y2xhc3M6YC5NZW1iZXJgLgoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgbWV0aG9kIGlzIGFuIEFQSSBjYWxsLiBGb3IgZ2VuZXJhbCB1c2FnZSwgY29uc2lkZXIgOm1ldGg6YGdldF9ndWlsZGAgaW5zdGVhZC4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgZ3VpbGRfaWQ6IDpjbGFzczpgaW50YAogICAgICAgICAgICBUaGUgZ3VpbGQncyBJRCB0byBmZXRjaCBmcm9tLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0KICAgICAgICA6ZXhjOmAuRm9yYmlkZGVuYAogICAgICAgICAgICBZb3UgZG8gbm90IGhhdmUgYWNjZXNzIHRvIHRoZSBndWlsZC4KICAgICAgICA6ZXhjOmAuSFRUUEV4Y2VwdGlvbmAKICAgICAgICAgICAgR2V0dGluZyB0aGUgZ3VpbGQgZmFpbGVkLgoKICAgICAgICBSZXR1cm5zCiAgICAgICAgLS0tLS0tLS0KICAgICAgICA6Y2xhc3M6YC5HdWlsZGAKICAgICAgICAgICAgVGhlIGd1aWxkIGZyb20gdGhlIElELgogICAgICAgICIiIgogICAgICAgIGRhdGEgPSBhd2FpdCBzZWxmLmh0dHAuZ2V0X2d1aWxkKGd1aWxkX2lkKQogICAgICAgIHJldHVybiBHdWlsZChkYXRhPWRhdGEsIHN0YXRlPXNlbGYuX2Nvbm5lY3Rpb24pCgogICAgYXN5bmMgZGVmIGNyZWF0ZV9ndWlsZChzZWxmLCBuYW1lLCByZWdpb249Tm9uZSwgaWNvbj1Ob25lLCAqLCBjb2RlPU5vbmUpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBDcmVhdGVzIGEgOmNsYXNzOmAuR3VpbGRgLgoKICAgICAgICBCb3QgYWNjb3VudHMgaW4gbW9yZSB0aGFuIDEwIGd1aWxkcyBhcmUgbm90IGFsbG93ZWQgdG8gY3JlYXRlIGd1aWxkcy4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0KICAgICAgICBuYW1lOiA6Y2xhc3M6YHN0cmAKICAgICAgICAgICAgVGhlIG5hbWUgb2YgdGhlIGd1aWxkLgogICAgICAgIHJlZ2lvbjogOmNsYXNzOmAuVm9pY2VSZWdpb25gCiAgICAgICAgICAgIFRoZSByZWdpb24gZm9yIHRoZSB2b2ljZSBjb21tdW5pY2F0aW9uIHNlcnZlci4KICAgICAgICAgICAgRGVmYXVsdHMgdG8gOmF0dHI6YC5Wb2ljZVJlZ2lvbi51c193ZXN0YC4KICAgICAgICBpY29uOiA6Y2xhc3M6YGJ5dGVzYAogICAgICAgICAgICBUaGUgOnRlcm06YHB5OmJ5dGVzLWxpa2Ugb2JqZWN0YCByZXByZXNlbnRpbmcgdGhlIGljb24uIFNlZSA6bWV0aDpgLkNsaWVudFVzZXIuZWRpdGAKICAgICAgICAgICAgZm9yIG1vcmUgZGV0YWlscyBvbiB3aGF0IGlzIGV4cGVjdGVkLgogICAgICAgIGNvZGU6IE9wdGlvbmFsWzpjbGFzczpgc3RyYF0KICAgICAgICAgICAgVGhlIGNvZGUgZm9yIGEgdGVtcGxhdGUgdG8gY3JlYXRlIHRoZSBndWlsZCB3aXRoLgoKICAgICAgICAgICAgLi4gdmVyc2lvbmFkZGVkOjogMS40CgogICAgICAgIFJhaXNlcwogICAgICAgIC0tLS0tLQogICAgICAgIDpleGM6YC5IVFRQRXhjZXB0aW9uYAogICAgICAgICAgICBHdWlsZCBjcmVhdGlvbiBmYWlsZWQuCiAgICAgICAgOmV4YzpgLkludmFsaWRBcmd1bWVudGAKICAgICAgICAgICAgSW52YWxpZCBpY29uIGltYWdlIGZvcm1hdCBnaXZlbi4gTXVzdCBiZSBQTkcgb3IgSlBHLgoKICAgICAgICBSZXR1cm5zCiAgICAgICAgLS0tLS0tLQogICAgICAgIDpjbGFzczpgLkd1aWxkYAogICAgICAgICAgICBUaGUgZ3VpbGQgY3JlYXRlZC4gVGhpcyBpcyBub3QgdGhlIHNhbWUgZ3VpbGQgdGhhdCBpcwogICAgICAgICAgICBhZGRlZCB0byBjYWNoZS4KICAgICAgICAiIiIKICAgICAgICBpZiBpY29uIGlzIG5vdCBOb25lOgogICAgICAgICAgICBpY29uID0gdXRpbHMuX2J5dGVzX3RvX2Jhc2U2NF9kYXRhKGljb24pCgogICAgICAgIHJlZ2lvbiA9IHJlZ2lvbiBvciBWb2ljZVJlZ2lvbi51c193ZXN0CiAgICAgICAgcmVnaW9uX3ZhbHVlID0gcmVnaW9uLnZhbHVlCgogICAgICAgIGlmIGNvZGU6CiAgICAgICAgICAgIGRhdGEgPSBhd2FpdCBzZWxmLmh0dHAuY3JlYXRlX2Zyb21fdGVtcGxhdGUoY29kZSwgbmFtZSwgcmVnaW9uX3ZhbHVlLCBpY29uKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRhdGEgPSBhd2FpdCBzZWxmLmh0dHAuY3JlYXRlX2d1aWxkKG5hbWUsIHJlZ2lvbl92YWx1ZSwgaWNvbikKICAgICAgICByZXR1cm4gR3VpbGQoZGF0YT1kYXRhLCBzdGF0ZT1zZWxmLl9jb25uZWN0aW9uKQoKICAgICMgSW52aXRlIG1hbmFnZW1lbnQKCiAgICBhc3luYyBkZWYgZmV0Y2hfaW52aXRlKHNlbGYsIHVybCwgKiwgd2l0aF9jb3VudHM9VHJ1ZSk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIEdldHMgYW4gOmNsYXNzOmAuSW52aXRlYCBmcm9tIGEgZGlzY29yZC5nZyBVUkwgb3IgSUQuCgogICAgICAgIC4uIG5vdGU6OgoKICAgICAgICAgICAgSWYgdGhlIGludml0ZSBpcyBmb3IgYSBndWlsZCB5b3UgaGF2ZSBub3Qgam9pbmVkLCB0aGUgZ3VpbGQgYW5kIGNoYW5uZWwKICAgICAgICAgICAgYXR0cmlidXRlcyBvZiB0aGUgcmV0dXJuZWQgOmNsYXNzOmAuSW52aXRlYCB3aWxsIGJlIDpjbGFzczpgLlBhcnRpYWxJbnZpdGVHdWlsZGAgYW5kCiAgICAgICAgICAgIDpjbGFzczpgLlBhcnRpYWxJbnZpdGVDaGFubmVsYCByZXNwZWN0aXZlbHkuCgogICAgICAgIFBhcmFtZXRlcnMKICAgICAgICAtLS0tLS0tLS0tLQogICAgICAgIHVybDogVW5pb25bOmNsYXNzOmAuSW52aXRlYCwgOmNsYXNzOmBzdHJgXQogICAgICAgICAgICBUaGUgRGlzY29yZCBpbnZpdGUgSUQgb3IgVVJMIChtdXN0IGJlIGEgZGlzY29yZC5nZyBVUkwpLgogICAgICAgIHdpdGhfY291bnRzOiA6Y2xhc3M6YGJvb2xgCiAgICAgICAgICAgIFdoZXRoZXIgdG8gaW5jbHVkZSBjb3VudCBpbmZvcm1hdGlvbiBpbiB0aGUgaW52aXRlLiBUaGlzIGZpbGxzIHRoZQogICAgICAgICAgICA6YXR0cjpgLkludml0ZS5hcHByb3hpbWF0ZV9tZW1iZXJfY291bnRgIGFuZCA6YXR0cjpgLkludml0ZS5hcHByb3hpbWF0ZV9wcmVzZW5jZV9jb3VudGAKICAgICAgICAgICAgZmllbGRzLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tCiAgICAgICAgOmV4YzpgLk5vdEZvdW5kYAogICAgICAgICAgICBUaGUgaW52aXRlIGhhcyBleHBpcmVkIG9yIGlzIGludmFsaWQuCiAgICAgICAgOmV4YzpgLkhUVFBFeGNlcHRpb25gCiAgICAgICAgICAgIEdldHRpbmcgdGhlIGludml0ZSBmYWlsZWQuCgogICAgICAgIFJldHVybnMKICAgICAgICAtLS0tLS0tLQogICAgICAgIDpjbGFzczpgLkludml0ZWAKICAgICAgICAgICAgVGhlIGludml0ZSBmcm9tIHRoZSBVUkwvSUQuCiAgICAgICAgIiIiCgogICAgICAgIGludml0ZV9pZCA9IHV0aWxzLnJlc29sdmVfaW52aXRlKHVybCkKICAgICAgICBkYXRhID0gYXdhaXQgc2VsZi5odHRwLmdldF9pbnZpdGUoaW52aXRlX2lkLCB3aXRoX2NvdW50cz13aXRoX2NvdW50cykKICAgICAgICByZXR1cm4gSW52aXRlLmZyb21faW5jb21wbGV0ZShzdGF0ZT1zZWxmLl9jb25uZWN0aW9uLCBkYXRhPWRhdGEpCgogICAgYXN5bmMgZGVmIGRlbGV0ZV9pbnZpdGUoc2VsZiwgaW52aXRlKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgUmV2b2tlcyBhbiA6Y2xhc3M6YC5JbnZpdGVgLCBVUkwsIG9yIElEIHRvIGFuIGludml0ZS4KCiAgICAgICAgWW91IG11c3QgaGF2ZSB0aGUgOmF0dHI6YH4uUGVybWlzc2lvbnMubWFuYWdlX2NoYW5uZWxzYCBwZXJtaXNzaW9uIGluCiAgICAgICAgdGhlIGFzc29jaWF0ZWQgZ3VpbGQgdG8gZG8gdGhpcy4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0KICAgICAgICBpbnZpdGU6IFVuaW9uWzpjbGFzczpgLkludml0ZWAsIDpjbGFzczpgc3RyYF0KICAgICAgICAgICAgVGhlIGludml0ZSB0byByZXZva2UuCgogICAgICAgIFJhaXNlcwogICAgICAgIC0tLS0tLS0KICAgICAgICA6ZXhjOmAuRm9yYmlkZGVuYAogICAgICAgICAgICBZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbnMgdG8gcmV2b2tlIGludml0ZXMuCiAgICAgICAgOmV4YzpgLk5vdEZvdW5kYAogICAgICAgICAgICBUaGUgaW52aXRlIGlzIGludmFsaWQgb3IgZXhwaXJlZC4KICAgICAgICA6ZXhjOmAuSFRUUEV4Y2VwdGlvbmAKICAgICAgICAgICAgUmV2b2tpbmcgdGhlIGludml0ZSBmYWlsZWQuCiAgICAgICAgIiIiCgogICAgICAgIGludml0ZV9pZCA9IHV0aWxzLnJlc29sdmVfaW52aXRlKGludml0ZSkKICAgICAgICBhd2FpdCBzZWxmLmh0dHAuZGVsZXRlX2ludml0ZShpbnZpdGVfaWQpCgogICAgIyBNaXNjZWxsYW5lb3VzIHN0dWZmCgogICAgYXN5bmMgZGVmIGZldGNoX3dpZGdldChzZWxmLCBndWlsZF9pZCk6CiAgICAgICAgIiIifGNvcm98CgogICAgICAgIEdldHMgYSA6Y2xhc3M6YC5XaWRnZXRgIGZyb20gYSBndWlsZCBJRC4KCiAgICAgICAgLi4gbm90ZTo6CgogICAgICAgICAgICBUaGUgZ3VpbGQgbXVzdCBoYXZlIHRoZSB3aWRnZXQgZW5hYmxlZCB0byBnZXQgdGhpcyBpbmZvcm1hdGlvbi4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgZ3VpbGRfaWQ6IDpjbGFzczpgaW50YAogICAgICAgICAgICBUaGUgSUQgb2YgdGhlIGd1aWxkLgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tCiAgICAgICAgOmV4YzpgLkZvcmJpZGRlbmAKICAgICAgICAgICAgVGhlIHdpZGdldCBmb3IgdGhpcyBndWlsZCBpcyBkaXNhYmxlZC4KICAgICAgICA6ZXhjOmAuSFRUUEV4Y2VwdGlvbmAKICAgICAgICAgICAgUmV0cmlldmluZyB0aGUgd2lkZ2V0IGZhaWxlZC4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgOmNsYXNzOmAuV2lkZ2V0YAogICAgICAgICAgICBUaGUgZ3VpbGQncyB3aWRnZXQuCiAgICAgICAgIiIiCiAgICAgICAgZGF0YSA9IGF3YWl0IHNlbGYuaHR0cC5nZXRfd2lkZ2V0KGd1aWxkX2lkKQoKICAgICAgICByZXR1cm4gV2lkZ2V0KHN0YXRlPXNlbGYuX2Nvbm5lY3Rpb24sIGRhdGE9ZGF0YSkKCiAgICBhc3luYyBkZWYgYXBwbGljYXRpb25faW5mbyhzZWxmKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgUmV0cmlldmVzIHRoZSBib3QncyBhcHBsaWNhdGlvbiBpbmZvcm1hdGlvbi4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIDpleGM6YC5IVFRQRXhjZXB0aW9uYAogICAgICAgICAgICBSZXRyaWV2aW5nIHRoZSBpbmZvcm1hdGlvbiBmYWlsZWQgc29tZWhvdy4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgOmNsYXNzOmAuQXBwSW5mb2AKICAgICAgICAgICAgVGhlIGJvdCdzIGFwcGxpY2F0aW9uIGluZm9ybWF0aW9uLgogICAgICAgICIiIgogICAgICAgIGRhdGEgPSBhd2FpdCBzZWxmLmh0dHAuYXBwbGljYXRpb25faW5mbygpCiAgICAgICAgaWYgJ3JwY19vcmlnaW5zJyBub3QgaW4gZGF0YToKICAgICAgICAgICAgZGF0YVsncnBjX29yaWdpbnMnXSA9IE5vbmUKICAgICAgICByZXR1cm4gQXBwSW5mbyhzZWxmLl9jb25uZWN0aW9uLCBkYXRhKQoKICAgIGFzeW5jIGRlZiBmZXRjaF91c2VyKHNlbGYsIHVzZXJfaWQpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBSZXRyaWV2ZXMgYSA6Y2xhc3M6YH5kaXNjb3JkLlVzZXJgIGJhc2VkIG9uIHRoZWlyIElELiBUaGlzIGNhbiBvbmx5CiAgICAgICAgYmUgdXNlZCBieSBib3QgYWNjb3VudHMuIFlvdSBkbyBub3QgaGF2ZSB0byBzaGFyZSBhbnkgZ3VpbGRzCiAgICAgICAgd2l0aCB0aGUgdXNlciB0byBnZXQgdGhpcyBpbmZvcm1hdGlvbiwgaG93ZXZlciBtYW55IG9wZXJhdGlvbnMKICAgICAgICBkbyByZXF1aXJlIHRoYXQgeW91IGRvLgoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgbWV0aG9kIGlzIGFuIEFQSSBjYWxsLiBJZiB5b3UgaGF2ZSA6YXR0cjpgSW50ZW50cy5tZW1iZXJzYCBhbmQgbWVtYmVyIGNhY2hlIGVuYWJsZWQsIGNvbnNpZGVyIDptZXRoOmBnZXRfdXNlcmAgaW5zdGVhZC4KCiAgICAgICAgUGFyYW1ldGVycwogICAgICAgIC0tLS0tLS0tLS0tCiAgICAgICAgdXNlcl9pZDogOmNsYXNzOmBpbnRgCiAgICAgICAgICAgIFRoZSB1c2VyJ3MgSUQgdG8gZmV0Y2ggZnJvbS4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIDpleGM6YC5Ob3RGb3VuZGAKICAgICAgICAgICAgQSB1c2VyIHdpdGggdGhpcyBJRCBkb2VzIG5vdCBleGlzdC4KICAgICAgICA6ZXhjOmAuSFRUUEV4Y2VwdGlvbmAKICAgICAgICAgICAgRmV0Y2hpbmcgdGhlIHVzZXIgZmFpbGVkLgoKICAgICAgICBSZXR1cm5zCiAgICAgICAgLS0tLS0tLS0KICAgICAgICA6Y2xhc3M6YH5kaXNjb3JkLlVzZXJgCiAgICAgICAgICAgIFRoZSB1c2VyIHlvdSByZXF1ZXN0ZWQuCiAgICAgICAgIiIiCiAgICAgICAgZGF0YSA9IGF3YWl0IHNlbGYuaHR0cC5nZXRfdXNlcih1c2VyX2lkKQogICAgICAgIHJldHVybiBVc2VyKHN0YXRlPXNlbGYuX2Nvbm5lY3Rpb24sIGRhdGE9ZGF0YSkKCiAgICBAdXRpbHMuZGVwcmVjYXRlZCgpCiAgICBhc3luYyBkZWYgZmV0Y2hfdXNlcl9wcm9maWxlKHNlbGYsIHVzZXJfaWQpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBHZXRzIGFuIGFyYml0cmFyeSB1c2VyJ3MgcHJvZmlsZS4KCiAgICAgICAgLi4gZGVwcmVjYXRlZDo6IDEuNwoKICAgICAgICAuLiBub3RlOjoKCiAgICAgICAgICAgIFRoaXMgY2FuIG9ubHkgYmUgdXNlZCBieSBub24tYm90IGFjY291bnRzLgoKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLS0tCiAgICAgICAgdXNlcl9pZDogOmNsYXNzOmBpbnRgCiAgICAgICAgICAgIFRoZSBJRCBvZiB0aGUgdXNlciB0byBmZXRjaCB0aGVpciBwcm9maWxlIGZvci4KCiAgICAgICAgUmFpc2VzCiAgICAgICAgLS0tLS0tLQogICAgICAgIDpleGM6YC5Gb3JiaWRkZW5gCiAgICAgICAgICAgIE5vdCBhbGxvd2VkIHRvIGZldGNoIHByb2ZpbGVzLgogICAgICAgIDpleGM6YC5IVFRQRXhjZXB0aW9uYAogICAgICAgICAgICBGZXRjaGluZyB0aGUgcHJvZmlsZSBmYWlsZWQuCgogICAgICAgIFJldHVybnMKICAgICAgICAtLS0tLS0tLQogICAgICAgIDpjbGFzczpgLlByb2ZpbGVgCiAgICAgICAgICAgIFRoZSBwcm9maWxlIG9mIHRoZSB1c2VyLgogICAgICAgICIiIgoKICAgICAgICBzdGF0ZSA9IHNlbGYuX2Nvbm5lY3Rpb24KICAgICAgICBkYXRhID0gYXdhaXQgc2VsZi5odHRwLmdldF91c2VyX3Byb2ZpbGUodXNlcl9pZCkKCiAgICAgICAgZGVmIHRyYW5zZm9ybShkKToKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLl9nZXRfZ3VpbGQoaW50KGRbJ2lkJ10pKQoKICAgICAgICBzaW5jZSA9IGRhdGEuZ2V0KCdwcmVtaXVtX3NpbmNlJykKICAgICAgICBtdXR1YWxfZ3VpbGRzID0gbGlzdChmaWx0ZXIoTm9uZSwgbWFwKHRyYW5zZm9ybSwgZGF0YS5nZXQoJ211dHVhbF9ndWlsZHMnLCBbXSkpKSkKICAgICAgICB1c2VyID0gZGF0YVsndXNlciddCiAgICAgICAgcmV0dXJuIFByb2ZpbGUoZmxhZ3M9dXNlci5nZXQoJ2ZsYWdzJywgMCksCiAgICAgICAgICAgICAgICAgICAgICAgcHJlbWl1bV9zaW5jZT11dGlscy5wYXJzZV90aW1lKHNpbmNlKSwKICAgICAgICAgICAgICAgICAgICAgICBtdXR1YWxfZ3VpbGRzPW11dHVhbF9ndWlsZHMsCiAgICAgICAgICAgICAgICAgICAgICAgdXNlcj1Vc2VyKGRhdGE9dXNlciwgc3RhdGU9c3RhdGUpLAogICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3RlZF9hY2NvdW50cz1kYXRhWydjb25uZWN0ZWRfYWNjb3VudHMnXSkKCiAgICBhc3luYyBkZWYgZmV0Y2hfY2hhbm5lbChzZWxmLCBjaGFubmVsX2lkKToKICAgICAgICAiIiJ8Y29yb3wKCiAgICAgICAgUmV0cmlldmVzIGEgOmNsYXNzOmAuYWJjLkd1aWxkQ2hhbm5lbGAgb3IgOmNsYXNzOmAuYWJjLlByaXZhdGVDaGFubmVsYCB3aXRoIHRoZSBzcGVjaWZpZWQgSUQuCgogICAgICAgIC4uIG5vdGU6OgoKICAgICAgICAgICAgVGhpcyBtZXRob2QgaXMgYW4gQVBJIGNhbGwuIEZvciBnZW5lcmFsIHVzYWdlLCBjb25zaWRlciA6bWV0aDpgZ2V0X2NoYW5uZWxgIGluc3RlYWQuCgogICAgICAgIC4uIHZlcnNpb25hZGRlZDo6IDEuMgoKICAgICAgICBSYWlzZXMKICAgICAgICAtLS0tLS0tCiAgICAgICAgOmV4YzpgLkludmFsaWREYXRhYAogICAgICAgICAgICBBbiB1bmtub3duIGNoYW5uZWwgdHlwZSB3YXMgcmVjZWl2ZWQgZnJvbSBEaXNjb3JkLgogICAgICAgIDpleGM6YC5IVFRQRXhjZXB0aW9uYAogICAgICAgICAgICBSZXRyaWV2aW5nIHRoZSBjaGFubmVsIGZhaWxlZC4KICAgICAgICA6ZXhjOmAuTm90Rm91bmRgCiAgICAgICAgICAgIEludmFsaWQgQ2hhbm5lbCBJRC4KICAgICAgICA6ZXhjOmAuRm9yYmlkZGVuYAogICAgICAgICAgICBZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBmZXRjaCB0aGlzIGNoYW5uZWwuCgogICAgICAgIFJldHVybnMKICAgICAgICAtLS0tLS0tLQogICAgICAgIFVuaW9uWzpjbGFzczpgLmFiYy5HdWlsZENoYW5uZWxgLCA6Y2xhc3M6YC5hYmMuUHJpdmF0ZUNoYW5uZWxgXQogICAgICAgICAgICBUaGUgY2hhbm5lbCBmcm9tIHRoZSBJRC4KICAgICAgICAiIiIKICAgICAgICBkYXRhID0gYXdhaXQgc2VsZi5odHRwLmdldF9jaGFubmVsKGNoYW5uZWxfaWQpCgogICAgICAgIGZhY3RvcnksIGNoX3R5cGUgPSBfY2hhbm5lbF9mYWN0b3J5KGRhdGFbJ3R5cGUnXSkKICAgICAgICBpZiBmYWN0b3J5IGlzIE5vbmU6CiAgICAgICAgICAgIHJhaXNlIEludmFsaWREYXRhKCdVbmtub3duIGNoYW5uZWwgdHlwZSB7dHlwZX0gZm9yIGNoYW5uZWwgSUQge2lkfS4nLmZvcm1hdF9tYXAoZGF0YSkpCgogICAgICAgIGlmIGNoX3R5cGUgaW4gKENoYW5uZWxUeXBlLmdyb3VwLCBDaGFubmVsVHlwZS5wcml2YXRlKToKICAgICAgICAgICAgY2hhbm5lbCA9IGZhY3RvcnkobWU9c2VsZi51c2VyLCBkYXRhPWRhdGEsIHN0YXRlPXNlbGYuX2Nvbm5lY3Rpb24pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZ3VpbGRfaWQgPSBpbnQoZGF0YVsnZ3VpbGRfaWQnXSkKICAgICAgICAgICAgZ3VpbGQgPSBzZWxmLmdldF9ndWlsZChndWlsZF9pZCkgb3IgT2JqZWN0KGlkPWd1aWxkX2lkKQogICAgICAgICAgICBjaGFubmVsID0gZmFjdG9yeShndWlsZD1ndWlsZCwgc3RhdGU9c2VsZi5fY29ubmVjdGlvbiwgZGF0YT1kYXRhKQoKICAgICAgICByZXR1cm4gY2hhbm5lbAoKICAgIGFzeW5jIGRlZiBmZXRjaF93ZWJob29rKHNlbGYsIHdlYmhvb2tfaWQpOgogICAgICAgICIiInxjb3JvfAoKICAgICAgICBSZXRyaWV2ZXMgYSA6Y2xhc3M6YC5XZWJob29rYCB3aXRoIHRoZSBzcGVjaWZpZWQgSUQuCgogICAgICAgIFJhaXNlcwogICAgICAgIC0tLS0tLS0tCiAgICAgICAgOmV4YzpgLkhUVFBFeGNlcHRpb25gCiAgICAgICAgICAgIFJldHJpZXZpbmcgdGhlIHdlYmhvb2sgZmFpbGVkLgogICAgICAgIDpleGM6YC5Ob3RGb3VuZGAKICAgICAgICAgICAgSW52YWxpZCB3ZWJob29rIElELgogICAgICAgIDpleGM6YC5Gb3JiaWRkZW5gCiAgICAgICAgICAgIFlvdSBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGZldGNoIHRoaXMgd2ViaG9vay4KCiAgICAgICAgUmV0dXJucwogICAgICAgIC0tLS0tLS0tLQogICAgICAgIDpjbGFzczpgLldlYmhvb2tgCiAgICAgICAgICAgIFRoZSB3ZWJob29rIHlvdSByZXF1ZXN0ZWQuCiAgICAgICAgIiIiCiAgICAgICAgZGF0YSA9IGF3YWl0IHNlbGYuaHR0cC5nZXRfd2ViaG9vayh3ZWJob29rX2lkKQogICAgICAgIHJldHVybiBXZWJob29rLmZyb21fc3RhdGUoZGF0YSwgc3RhdGU9c2VsZi5fY29ubmVjdGlvbikK
