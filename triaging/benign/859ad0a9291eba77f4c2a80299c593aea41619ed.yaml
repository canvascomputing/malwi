statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/urlib3/1.21.1/urlib3-1.21.1/urlib3-1.21.1/urllib3/contrib/appengine.py
  contents:
  - name: <module>
    score: 0.0
    code: |-
      """
      This module provides a pool manager that uses Google App Engine's
      `URLFetch Service <https://cloud.google.com/appengine/docs/python/urlfetch>`_.

      Example usage::

          from urllib3 import PoolManager
          from urllib3.contrib.appengine import AppEngineManager, is_appengine_sandbox

          if is_appengine_sandbox():
              # AppEngineManager uses AppEngine's URLFetch API behind the scenes
              http = AppEngineManager()
          else:
              # PoolManager uses a socket-level API behind the scenes
              http = PoolManager()

          r = http.request('GET', 'https://google.com/')

      There are `limitations <https://cloud.google.com/appengine/docs/python/\
      urlfetch/#Python_Quotas_and_limits>`_ to the URLFetch service and it may not be
      the best choice for your application. There are three options for using
      urllib3 on Google App Engine:

      1. You can use :class:`AppEngineManager` with URLFetch. URLFetch is
         cost-effective in many circumstances as long as your usage is within the
         limitations.
      2. You can use a normal :class:`~urllib3.PoolManager` by enabling sockets.
         Sockets also have `limitations and restrictions
         <https://cloud.google.com/appengine/docs/python/sockets/\
         #limitations-and-restrictions>`_ and have a lower free quota than URLFetch.
         To use sockets, be sure to specify the following in your ``app.yaml``::

              env_variables:
                  GAE_USE_SOCKETS_HTTPLIB : 'true'

      3. If you are using `App Engine Flexible
      <https://cloud.google.com/appengine/docs/flexible/>`_, you can use the standard
      :class:`PoolManager` without any configuration or special environment variables.
      """

      from __future__ import absolute_import
      import logging
      import os
      import warnings
      from ..packages.six.moves.urllib.parse import urljoin

      from ..exceptions import (
          HTTPError,
          HTTPWarning,
          MaxRetryError,
          ProtocolError,
          TimeoutError,
          SSLError
      )

      from ..packages.six import BytesIO
      from ..request import RequestMethods
      from ..response import HTTPResponse
      from ..util.timeout import Timeout
      from ..util.retry import Retry

      try:
          from google.appengine.api import urlfetch
      except ImportError:
          urlfetch = None


      log = logging.getLogger(__name__)


      class AppEnginePlatformWarning(HTTPWarning):
          pass
    tokens: resume load_const STRING_FILE_PATH store_name __doc__ load_const INTEGER load_const import_name __future__ import_from absolute_import store_name absolute_import pop_top load_const INTEGER load_const import_name logging store_name logging load_const INTEGER load_const import_name os store_name os load_const INTEGER load_const import_name warnings store_name warnings load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from urljoin store_name urljoin pop_top load_const INTEGER load_const import_name exceptions import_from HTTPError store_name HTTPError import_from HTTPWarning store_name HTTPWarning import_from MaxRetryError store_name MaxRetryError import_from ProtocolError store_name ProtocolError import_from TimeoutError store_name TimeoutError import_from SSLError store_name SSLError pop_top load_const INTEGER load_const import_name packages.six import_from BytesIO store_name BytesIO pop_top load_const INTEGER load_const import_name request import_from RequestMethods store_name RequestMethods pop_top load_const INTEGER load_const import_name response import_from HTTPResponse store_name HTTPResponse pop_top load_const INTEGER load_const import_name util.timeout import_from Timeout store_name Timeout pop_top load_const INTEGER load_const import_name util.retry import_from Retry store_name Retry pop_top nop load_const INTEGER load_const import_name STRING_LEN_S_ENT_HIGH import_from urlfetch store_name urlfetch pop_top push_null load_name logging load_attr getLogger load_name __name__ call store_name log push_null load_build_class load_const OBJECT make_function load_const STRING_BASE64_LEN_S_ENT_HIGH load_name HTTPWarning call store_name STRING_BASE64_LEN_S_ENT_HIGH push_null load_build_class load_const OBJECT make_function load_const STRING_LEN_S_ENT_HIGH load_name HTTPError call store_name STRING_LEN_S_ENT_HIGH push_null load_build_class load_const OBJECT make_function load_const STRING_BASE64_LEN_S_ENT_HIGH load_name RequestMethods call store_name STRING_BASE64_LEN_S_ENT_HIGH load_const OBJECT make_function store_name is_appengine load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH load_const OBJECT make_function store_name STRING_LEN_S_ENT_HIGH return_const None push_exc_info load_name ImportError check_exc_match pop_jump_if_false TO_NUMBER pop_top load_const store_name urlfetch pop_except jump_backward TO_NUMBER reraise copy pop_except reraise
    hash: 84eb1349bfb6d13a02fd3f89571429088a2212ff1fff481245f10f496083dc52
sources:
  .repo_cache/malicious_repos/pypi_malregistry/urlib3/1.21.1/urlib3-1.21.1/urlib3-1.21.1/urllib3/contrib/appengine.py: IiIiClRoaXMgbW9kdWxlIHByb3ZpZGVzIGEgcG9vbCBtYW5hZ2VyIHRoYXQgdXNlcyBHb29nbGUgQXBwIEVuZ2luZSdzCmBVUkxGZXRjaCBTZXJ2aWNlIDxodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vYXBwZW5naW5lL2RvY3MvcHl0aG9uL3VybGZldGNoPmBfLgoKRXhhbXBsZSB1c2FnZTo6CgogICAgZnJvbSB1cmxsaWIzIGltcG9ydCBQb29sTWFuYWdlcgogICAgZnJvbSB1cmxsaWIzLmNvbnRyaWIuYXBwZW5naW5lIGltcG9ydCBBcHBFbmdpbmVNYW5hZ2VyLCBpc19hcHBlbmdpbmVfc2FuZGJveAoKICAgIGlmIGlzX2FwcGVuZ2luZV9zYW5kYm94KCk6CiAgICAgICAgIyBBcHBFbmdpbmVNYW5hZ2VyIHVzZXMgQXBwRW5naW5lJ3MgVVJMRmV0Y2ggQVBJIGJlaGluZCB0aGUgc2NlbmVzCiAgICAgICAgaHR0cCA9IEFwcEVuZ2luZU1hbmFnZXIoKQogICAgZWxzZToKICAgICAgICAjIFBvb2xNYW5hZ2VyIHVzZXMgYSBzb2NrZXQtbGV2ZWwgQVBJIGJlaGluZCB0aGUgc2NlbmVzCiAgICAgICAgaHR0cCA9IFBvb2xNYW5hZ2VyKCkKCiAgICByID0gaHR0cC5yZXF1ZXN0KCdHRVQnLCAnaHR0cHM6Ly9nb29nbGUuY29tLycpCgpUaGVyZSBhcmUgYGxpbWl0YXRpb25zIDxodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vYXBwZW5naW5lL2RvY3MvcHl0aG9uL1wKdXJsZmV0Y2gvI1B5dGhvbl9RdW90YXNfYW5kX2xpbWl0cz5gXyB0byB0aGUgVVJMRmV0Y2ggc2VydmljZSBhbmQgaXQgbWF5IG5vdCBiZQp0aGUgYmVzdCBjaG9pY2UgZm9yIHlvdXIgYXBwbGljYXRpb24uIFRoZXJlIGFyZSB0aHJlZSBvcHRpb25zIGZvciB1c2luZwp1cmxsaWIzIG9uIEdvb2dsZSBBcHAgRW5naW5lOgoKMS4gWW91IGNhbiB1c2UgOmNsYXNzOmBBcHBFbmdpbmVNYW5hZ2VyYCB3aXRoIFVSTEZldGNoLiBVUkxGZXRjaCBpcwogICBjb3N0LWVmZmVjdGl2ZSBpbiBtYW55IGNpcmN1bXN0YW5jZXMgYXMgbG9uZyBhcyB5b3VyIHVzYWdlIGlzIHdpdGhpbiB0aGUKICAgbGltaXRhdGlvbnMuCjIuIFlvdSBjYW4gdXNlIGEgbm9ybWFsIDpjbGFzczpgfnVybGxpYjMuUG9vbE1hbmFnZXJgIGJ5IGVuYWJsaW5nIHNvY2tldHMuCiAgIFNvY2tldHMgYWxzbyBoYXZlIGBsaW1pdGF0aW9ucyBhbmQgcmVzdHJpY3Rpb25zCiAgIDxodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vYXBwZW5naW5lL2RvY3MvcHl0aG9uL3NvY2tldHMvXAogICAjbGltaXRhdGlvbnMtYW5kLXJlc3RyaWN0aW9ucz5gXyBhbmQgaGF2ZSBhIGxvd2VyIGZyZWUgcXVvdGEgdGhhbiBVUkxGZXRjaC4KICAgVG8gdXNlIHNvY2tldHMsIGJlIHN1cmUgdG8gc3BlY2lmeSB0aGUgZm9sbG93aW5nIGluIHlvdXIgYGBhcHAueWFtbGBgOjoKCiAgICAgICAgZW52X3ZhcmlhYmxlczoKICAgICAgICAgICAgR0FFX1VTRV9TT0NLRVRTX0hUVFBMSUIgOiAndHJ1ZScKCjMuIElmIHlvdSBhcmUgdXNpbmcgYEFwcCBFbmdpbmUgRmxleGlibGUKPGh0dHBzOi8vY2xvdWQuZ29vZ2xlLmNvbS9hcHBlbmdpbmUvZG9jcy9mbGV4aWJsZS8+YF8sIHlvdSBjYW4gdXNlIHRoZSBzdGFuZGFyZAo6Y2xhc3M6YFBvb2xNYW5hZ2VyYCB3aXRob3V0IGFueSBjb25maWd1cmF0aW9uIG9yIHNwZWNpYWwgZW52aXJvbm1lbnQgdmFyaWFibGVzLgoiIiIKCmZyb20gX19mdXR1cmVfXyBpbXBvcnQgYWJzb2x1dGVfaW1wb3J0CmltcG9ydCBsb2dnaW5nCmltcG9ydCBvcwppbXBvcnQgd2FybmluZ3MKZnJvbSAuLnBhY2thZ2VzLnNpeC5tb3Zlcy51cmxsaWIucGFyc2UgaW1wb3J0IHVybGpvaW4KCmZyb20gLi5leGNlcHRpb25zIGltcG9ydCAoCiAgICBIVFRQRXJyb3IsCiAgICBIVFRQV2FybmluZywKICAgIE1heFJldHJ5RXJyb3IsCiAgICBQcm90b2NvbEVycm9yLAogICAgVGltZW91dEVycm9yLAogICAgU1NMRXJyb3IKKQoKZnJvbSAuLnBhY2thZ2VzLnNpeCBpbXBvcnQgQnl0ZXNJTwpmcm9tIC4ucmVxdWVzdCBpbXBvcnQgUmVxdWVzdE1ldGhvZHMKZnJvbSAuLnJlc3BvbnNlIGltcG9ydCBIVFRQUmVzcG9uc2UKZnJvbSAuLnV0aWwudGltZW91dCBpbXBvcnQgVGltZW91dApmcm9tIC4udXRpbC5yZXRyeSBpbXBvcnQgUmV0cnkKCnRyeToKICAgIGZyb20gZ29vZ2xlLmFwcGVuZ2luZS5hcGkgaW1wb3J0IHVybGZldGNoCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIHVybGZldGNoID0gTm9uZQoKCmxvZyA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQoKCmNsYXNzIEFwcEVuZ2luZVBsYXRmb3JtV2FybmluZyhIVFRQV2FybmluZyk6CiAgICBwYXNzCgoKY2xhc3MgQXBwRW5naW5lUGxhdGZvcm1FcnJvcihIVFRQRXJyb3IpOgogICAgcGFzcwoKCmNsYXNzIEFwcEVuZ2luZU1hbmFnZXIoUmVxdWVzdE1ldGhvZHMpOgogICAgIiIiCiAgICBDb25uZWN0aW9uIG1hbmFnZXIgZm9yIEdvb2dsZSBBcHAgRW5naW5lIHNhbmRib3ggYXBwbGljYXRpb25zLgoKICAgIFRoaXMgbWFuYWdlciB1c2VzIHRoZSBVUkxGZXRjaCBzZXJ2aWNlIGRpcmVjdGx5IGluc3RlYWQgb2YgdXNpbmcgdGhlCiAgICBlbXVsYXRlZCBodHRwbGliLCBhbmQgaXMgc3ViamVjdCB0byBVUkxGZXRjaCBsaW1pdGF0aW9ucyBhcyBkZXNjcmliZWQgaW4KICAgIHRoZSBBcHAgRW5naW5lIGRvY3VtZW50YXRpb24gYGhlcmUKICAgIDxodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vYXBwZW5naW5lL2RvY3MvcHl0aG9uL3VybGZldGNoPmBfLgoKICAgIE5vdGFibHkgaXQgd2lsbCByYWlzZSBhbiA6Y2xhc3M6YEFwcEVuZ2luZVBsYXRmb3JtRXJyb3JgIGlmOgogICAgICAgICogVVJMRmV0Y2ggaXMgbm90IGF2YWlsYWJsZS4KICAgICAgICAqIElmIHlvdSBhdHRlbXB0IHRvIHVzZSB0aGlzIG9uIEFwcCBFbmdpbmUgRmxleGlibGUsIGFzIGZ1bGwgc29ja2V0CiAgICAgICAgICBzdXBwb3J0IGlzIGF2YWlsYWJsZS4KICAgICAgICAqIElmIGEgcmVxdWVzdCBzaXplIGlzIG1vcmUgdGhhbiAxMCBtZWdhYnl0ZXMuCiAgICAgICAgKiBJZiBhIHJlc3BvbnNlIHNpemUgaXMgbW9yZSB0aGFuIDMyIG1lZ2FidHllcy4KICAgICAgICAqIElmIHlvdSB1c2UgYW4gdW5zdXBwb3J0ZWQgcmVxdWVzdCBtZXRob2Qgc3VjaCBhcyBPUFRJT05TLgoKICAgIEJleW9uZCB0aG9zZSBjYXNlcywgaXQgd2lsbCByYWlzZSBub3JtYWwgdXJsbGliMyBlcnJvcnMuCiAgICAiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgaGVhZGVycz1Ob25lLCByZXRyaWVzPU5vbmUsIHZhbGlkYXRlX2NlcnRpZmljYXRlPVRydWUsCiAgICAgICAgICAgICAgICAgdXJsZmV0Y2hfcmV0cmllcz1UcnVlKToKICAgICAgICBpZiBub3QgdXJsZmV0Y2g6CiAgICAgICAgICAgIHJhaXNlIEFwcEVuZ2luZVBsYXRmb3JtRXJyb3IoCiAgICAgICAgICAgICAgICAiVVJMRmV0Y2ggaXMgbm90IGF2YWlsYWJsZSBpbiB0aGlzIGVudmlyb25tZW50LiIpCgogICAgICAgIGlmIGlzX3Byb2RfYXBwZW5naW5lX212bXMoKToKICAgICAgICAgICAgcmFpc2UgQXBwRW5naW5lUGxhdGZvcm1FcnJvcigKICAgICAgICAgICAgICAgICJVc2Ugbm9ybWFsIHVybGxpYjMuUG9vbE1hbmFnZXIgaW5zdGVhZCBvZiBBcHBFbmdpbmVNYW5hZ2VyIgogICAgICAgICAgICAgICAgIm9uIE1hbmFnZWQgVk1zLCBhcyB1c2luZyBVUkxGZXRjaCBpcyBub3QgbmVjZXNzYXJ5IGluICIKICAgICAgICAgICAgICAgICJ0aGlzIGVudmlyb25tZW50LiIpCgogICAgICAgIHdhcm5pbmdzLndhcm4oCiAgICAgICAgICAgICJ1cmxsaWIzIGlzIHVzaW5nIFVSTEZldGNoIG9uIEdvb2dsZSBBcHAgRW5naW5lIHNhbmRib3ggaW5zdGVhZCAiCiAgICAgICAgICAgICJvZiBzb2NrZXRzLiBUbyB1c2Ugc29ja2V0cyBkaXJlY3RseSBpbnN0ZWFkIG9mIFVSTEZldGNoIHNlZSAiCiAgICAgICAgICAgICJodHRwczovL3VybGxpYjMucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L3JlZmVyZW5jZS91cmxsaWIzLmNvbnRyaWIuaHRtbC4iLAogICAgICAgICAgICBBcHBFbmdpbmVQbGF0Zm9ybVdhcm5pbmcpCgogICAgICAgIFJlcXVlc3RNZXRob2RzLl9faW5pdF9fKHNlbGYsIGhlYWRlcnMpCiAgICAgICAgc2VsZi52YWxpZGF0ZV9jZXJ0aWZpY2F0ZSA9IHZhbGlkYXRlX2NlcnRpZmljYXRlCiAgICAgICAgc2VsZi51cmxmZXRjaF9yZXRyaWVzID0gdXJsZmV0Y2hfcmV0cmllcwoKICAgICAgICBzZWxmLnJldHJpZXMgPSByZXRyaWVzIG9yIFJldHJ5LkRFRkFVTFQKCiAgICBkZWYgX19lbnRlcl9fKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmCgogICAgZGVmIF9fZXhpdF9fKHNlbGYsIGV4Y190eXBlLCBleGNfdmFsLCBleGNfdGIpOgogICAgICAgICMgUmV0dXJuIEZhbHNlIHRvIHJlLXJhaXNlIGFueSBwb3RlbnRpYWwgZXhjZXB0aW9ucwogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiB1cmxvcGVuKHNlbGYsIG1ldGhvZCwgdXJsLCBib2R5PU5vbmUsIGhlYWRlcnM9Tm9uZSwKICAgICAgICAgICAgICAgIHJldHJpZXM9Tm9uZSwgcmVkaXJlY3Q9VHJ1ZSwgdGltZW91dD1UaW1lb3V0LkRFRkFVTFRfVElNRU9VVCwKICAgICAgICAgICAgICAgICoqcmVzcG9uc2Vfa3cpOgoKICAgICAgICByZXRyaWVzID0gc2VsZi5fZ2V0X3JldHJpZXMocmV0cmllcywgcmVkaXJlY3QpCgogICAgICAgIHRyeToKICAgICAgICAgICAgZm9sbG93X3JlZGlyZWN0cyA9ICgKICAgICAgICAgICAgICAgICAgICByZWRpcmVjdCBhbmQKICAgICAgICAgICAgICAgICAgICByZXRyaWVzLnJlZGlyZWN0ICE9IDAgYW5kCiAgICAgICAgICAgICAgICAgICAgcmV0cmllcy50b3RhbCkKICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxmZXRjaC5mZXRjaCgKICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgIHBheWxvYWQ9Ym9keSwKICAgICAgICAgICAgICAgIG1ldGhvZD1tZXRob2QsCiAgICAgICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMgb3Ige30sCiAgICAgICAgICAgICAgICBhbGxvd190cnVuY2F0ZWQ9RmFsc2UsCiAgICAgICAgICAgICAgICBmb2xsb3dfcmVkaXJlY3RzPXNlbGYudXJsZmV0Y2hfcmV0cmllcyBhbmQgZm9sbG93X3JlZGlyZWN0cywKICAgICAgICAgICAgICAgIGRlYWRsaW5lPXNlbGYuX2dldF9hYnNvbHV0ZV90aW1lb3V0KHRpbWVvdXQpLAogICAgICAgICAgICAgICAgdmFsaWRhdGVfY2VydGlmaWNhdGU9c2VsZi52YWxpZGF0ZV9jZXJ0aWZpY2F0ZSwKICAgICAgICAgICAgKQogICAgICAgIGV4Y2VwdCB1cmxmZXRjaC5EZWFkbGluZUV4Y2VlZGVkRXJyb3IgYXMgZToKICAgICAgICAgICAgcmFpc2UgVGltZW91dEVycm9yKHNlbGYsIGUpCgogICAgICAgIGV4Y2VwdCB1cmxmZXRjaC5JbnZhbGlkVVJMRXJyb3IgYXMgZToKICAgICAgICAgICAgaWYgJ3RvbyBsYXJnZScgaW4gc3RyKGUpOgogICAgICAgICAgICAgICAgcmFpc2UgQXBwRW5naW5lUGxhdGZvcm1FcnJvcigKICAgICAgICAgICAgICAgICAgICAiVVJMRmV0Y2ggcmVxdWVzdCB0b28gbGFyZ2UsIFVSTEZldGNoIG9ubHkgIgogICAgICAgICAgICAgICAgICAgICJzdXBwb3J0cyByZXF1ZXN0cyB1cCB0byAxMG1iIGluIHNpemUuIiwgZSkKICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xFcnJvcihlKQoKICAgICAgICBleGNlcHQgdXJsZmV0Y2guRG93bmxvYWRFcnJvciBhcyBlOgogICAgICAgICAgICBpZiAnVG9vIG1hbnkgcmVkaXJlY3RzJyBpbiBzdHIoZSk6CiAgICAgICAgICAgICAgICByYWlzZSBNYXhSZXRyeUVycm9yKHNlbGYsIHVybCwgcmVhc29uPWUpCiAgICAgICAgICAgIHJhaXNlIFByb3RvY29sRXJyb3IoZSkKCiAgICAgICAgZXhjZXB0IHVybGZldGNoLlJlc3BvbnNlVG9vTGFyZ2VFcnJvciBhcyBlOgogICAgICAgICAgICByYWlzZSBBcHBFbmdpbmVQbGF0Zm9ybUVycm9yKAogICAgICAgICAgICAgICAgIlVSTEZldGNoIHJlc3BvbnNlIHRvbyBsYXJnZSwgVVJMRmV0Y2ggb25seSBzdXBwb3J0cyIKICAgICAgICAgICAgICAgICJyZXNwb25zZXMgdXAgdG8gMzJtYiBpbiBzaXplLiIsIGUpCgogICAgICAgIGV4Y2VwdCB1cmxmZXRjaC5TU0xDZXJ0aWZpY2F0ZUVycm9yIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIFNTTEVycm9yKGUpCgogICAgICAgIGV4Y2VwdCB1cmxmZXRjaC5JbnZhbGlkTWV0aG9kRXJyb3IgYXMgZToKICAgICAgICAgICAgcmFpc2UgQXBwRW5naW5lUGxhdGZvcm1FcnJvcigKICAgICAgICAgICAgICAgICJVUkxGZXRjaCBkb2VzIG5vdCBzdXBwb3J0IG1ldGhvZDogJXMiICUgbWV0aG9kLCBlKQoKICAgICAgICBodHRwX3Jlc3BvbnNlID0gc2VsZi5fdXJsZmV0Y2hfcmVzcG9uc2VfdG9faHR0cF9yZXNwb25zZSgKICAgICAgICAgICAgcmVzcG9uc2UsIHJldHJpZXM9cmV0cmllcywgKipyZXNwb25zZV9rdykKCiAgICAgICAgIyBIYW5kbGUgcmVkaXJlY3Q/CiAgICAgICAgcmVkaXJlY3RfbG9jYXRpb24gPSByZWRpcmVjdCBhbmQgaHR0cF9yZXNwb25zZS5nZXRfcmVkaXJlY3RfbG9jYXRpb24oKQogICAgICAgIGlmIHJlZGlyZWN0X2xvY2F0aW9uOgogICAgICAgICAgICAjIENoZWNrIGZvciByZWRpcmVjdCByZXNwb25zZQogICAgICAgICAgICBpZiAoc2VsZi51cmxmZXRjaF9yZXRyaWVzIGFuZCByZXRyaWVzLnJhaXNlX29uX3JlZGlyZWN0KToKICAgICAgICAgICAgICAgIHJhaXNlIE1heFJldHJ5RXJyb3Ioc2VsZiwgdXJsLCAidG9vIG1hbnkgcmVkaXJlY3RzIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIGh0dHBfcmVzcG9uc2Uuc3RhdHVzID09IDMwMzoKICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSAnR0VUJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByZXRyaWVzID0gcmV0cmllcy5pbmNyZW1lbnQobWV0aG9kLCB1cmwsIHJlc3BvbnNlPWh0dHBfcmVzcG9uc2UsIF9wb29sPXNlbGYpCiAgICAgICAgICAgICAgICBleGNlcHQgTWF4UmV0cnlFcnJvcjoKICAgICAgICAgICAgICAgICAgICBpZiByZXRyaWVzLnJhaXNlX29uX3JlZGlyZWN0OgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBNYXhSZXRyeUVycm9yKHNlbGYsIHVybCwgInRvbyBtYW55IHJlZGlyZWN0cyIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGh0dHBfcmVzcG9uc2UKCiAgICAgICAgICAgICAgICByZXRyaWVzLnNsZWVwX2Zvcl9yZXRyeShodHRwX3Jlc3BvbnNlKQogICAgICAgICAgICAgICAgbG9nLmRlYnVnKCJSZWRpcmVjdGluZyAlcyAtPiAlcyIsIHVybCwgcmVkaXJlY3RfbG9jYXRpb24pCiAgICAgICAgICAgICAgICByZWRpcmVjdF91cmwgPSB1cmxqb2luKHVybCwgcmVkaXJlY3RfbG9jYXRpb24pCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi51cmxvcGVuKAogICAgICAgICAgICAgICAgICAgIG1ldGhvZCwgcmVkaXJlY3RfdXJsLCBib2R5LCBoZWFkZXJzLAogICAgICAgICAgICAgICAgICAgIHJldHJpZXM9cmV0cmllcywgcmVkaXJlY3Q9cmVkaXJlY3QsCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0LCAqKnJlc3BvbnNlX2t3KQoKICAgICAgICAjIENoZWNrIGlmIHdlIHNob3VsZCByZXRyeSB0aGUgSFRUUCByZXNwb25zZS4KICAgICAgICBoYXNfcmV0cnlfYWZ0ZXIgPSBib29sKGh0dHBfcmVzcG9uc2UuZ2V0aGVhZGVyKCdSZXRyeS1BZnRlcicpKQogICAgICAgIGlmIHJldHJpZXMuaXNfcmV0cnkobWV0aG9kLCBodHRwX3Jlc3BvbnNlLnN0YXR1cywgaGFzX3JldHJ5X2FmdGVyKToKICAgICAgICAgICAgcmV0cmllcyA9IHJldHJpZXMuaW5jcmVtZW50KAogICAgICAgICAgICAgICAgbWV0aG9kLCB1cmwsIHJlc3BvbnNlPWh0dHBfcmVzcG9uc2UsIF9wb29sPXNlbGYpCiAgICAgICAgICAgIGxvZy5kZWJ1ZygiUmV0cnk6ICVzIiwgdXJsKQogICAgICAgICAgICByZXRyaWVzLnNsZWVwKGh0dHBfcmVzcG9uc2UpCiAgICAgICAgICAgIHJldHVybiBzZWxmLnVybG9wZW4oCiAgICAgICAgICAgICAgICBtZXRob2QsIHVybCwKICAgICAgICAgICAgICAgIGJvZHk9Ym9keSwgaGVhZGVycz1oZWFkZXJzLAogICAgICAgICAgICAgICAgcmV0cmllcz1yZXRyaWVzLCByZWRpcmVjdD1yZWRpcmVjdCwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dCwgKipyZXNwb25zZV9rdykKCiAgICAgICAgcmV0dXJuIGh0dHBfcmVzcG9uc2UKCiAgICBkZWYgX3VybGZldGNoX3Jlc3BvbnNlX3RvX2h0dHBfcmVzcG9uc2Uoc2VsZiwgdXJsZmV0Y2hfcmVzcCwgKipyZXNwb25zZV9rdyk6CgogICAgICAgIGlmIGlzX3Byb2RfYXBwZW5naW5lKCk6CiAgICAgICAgICAgICMgUHJvZHVjdGlvbiBHQUUgaGFuZGxlcyBkZWZsYXRlIGVuY29kaW5nIGF1dG9tYXRpY2FsbHksIGJ1dCBkb2VzCiAgICAgICAgICAgICMgbm90IHJlbW92ZSB0aGUgZW5jb2RpbmcgaGVhZGVyLgogICAgICAgICAgICBjb250ZW50X2VuY29kaW5nID0gdXJsZmV0Y2hfcmVzcC5oZWFkZXJzLmdldCgnY29udGVudC1lbmNvZGluZycpCgogICAgICAgICAgICBpZiBjb250ZW50X2VuY29kaW5nID09ICdkZWZsYXRlJzoKICAgICAgICAgICAgICAgIGRlbCB1cmxmZXRjaF9yZXNwLmhlYWRlcnNbJ2NvbnRlbnQtZW5jb2RpbmcnXQoKICAgICAgICB0cmFuc2Zlcl9lbmNvZGluZyA9IHVybGZldGNoX3Jlc3AuaGVhZGVycy5nZXQoJ3RyYW5zZmVyLWVuY29kaW5nJykKICAgICAgICAjIFdlIGhhdmUgYSBmdWxsIHJlc3BvbnNlJ3MgY29udGVudCwKICAgICAgICAjIHNvIGxldCdzIG1ha2Ugc3VyZSB3ZSBkb24ndCByZXBvcnQgb3Vyc2VsdmVzIGFzIGNodW5rZWQgZGF0YS4KICAgICAgICBpZiB0cmFuc2Zlcl9lbmNvZGluZyA9PSAnY2h1bmtlZCc6CiAgICAgICAgICAgIGVuY29kaW5ncyA9IHRyYW5zZmVyX2VuY29kaW5nLnNwbGl0KCIsIikKICAgICAgICAgICAgZW5jb2RpbmdzLnJlbW92ZSgnY2h1bmtlZCcpCiAgICAgICAgICAgIHVybGZldGNoX3Jlc3AuaGVhZGVyc1sndHJhbnNmZXItZW5jb2RpbmcnXSA9ICcsJy5qb2luKGVuY29kaW5ncykKCiAgICAgICAgcmV0dXJuIEhUVFBSZXNwb25zZSgKICAgICAgICAgICAgIyBJbiBvcmRlciBmb3IgZGVjb2RpbmcgdG8gd29yaywgd2UgbXVzdCBwcmVzZW50IHRoZSBjb250ZW50IGFzCiAgICAgICAgICAgICMgYSBmaWxlLWxpa2Ugb2JqZWN0LgogICAgICAgICAgICBib2R5PUJ5dGVzSU8odXJsZmV0Y2hfcmVzcC5jb250ZW50KSwKICAgICAgICAgICAgaGVhZGVycz11cmxmZXRjaF9yZXNwLmhlYWRlcnMsCiAgICAgICAgICAgIHN0YXR1cz11cmxmZXRjaF9yZXNwLnN0YXR1c19jb2RlLAogICAgICAgICAgICAqKnJlc3BvbnNlX2t3CiAgICAgICAgKQoKICAgIGRlZiBfZ2V0X2Fic29sdXRlX3RpbWVvdXQoc2VsZiwgdGltZW91dCk6CiAgICAgICAgaWYgdGltZW91dCBpcyBUaW1lb3V0LkRFRkFVTFRfVElNRU9VVDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUgICMgRGVmZXIgdG8gVVJMRmV0Y2gncyBkZWZhdWx0LgogICAgICAgIGlmIGlzaW5zdGFuY2UodGltZW91dCwgVGltZW91dCk6CiAgICAgICAgICAgIGlmIHRpbWVvdXQuX3JlYWQgaXMgbm90IE5vbmUgb3IgdGltZW91dC5fY29ubmVjdCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHdhcm5pbmdzLndhcm4oCiAgICAgICAgICAgICAgICAgICAgIlVSTEZldGNoIGRvZXMgbm90IHN1cHBvcnQgZ3JhbnVsYXIgdGltZW91dCBzZXR0aW5ncywgIgogICAgICAgICAgICAgICAgICAgICJyZXZlcnRpbmcgdG8gdG90YWwgb3IgZGVmYXVsdCBVUkxGZXRjaCB0aW1lb3V0LiIsCiAgICAgICAgICAgICAgICAgICAgQXBwRW5naW5lUGxhdGZvcm1XYXJuaW5nKQogICAgICAgICAgICByZXR1cm4gdGltZW91dC50b3RhbAogICAgICAgIHJldHVybiB0aW1lb3V0CgogICAgZGVmIF9nZXRfcmV0cmllcyhzZWxmLCByZXRyaWVzLCByZWRpcmVjdCk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UocmV0cmllcywgUmV0cnkpOgogICAgICAgICAgICByZXRyaWVzID0gUmV0cnkuZnJvbV9pbnQoCiAgICAgICAgICAgICAgICByZXRyaWVzLCByZWRpcmVjdD1yZWRpcmVjdCwgZGVmYXVsdD1zZWxmLnJldHJpZXMpCgogICAgICAgIGlmIHJldHJpZXMuY29ubmVjdCBvciByZXRyaWVzLnJlYWQgb3IgcmV0cmllcy5yZWRpcmVjdDoKICAgICAgICAgICAgd2FybmluZ3Mud2FybigKICAgICAgICAgICAgICAgICJVUkxGZXRjaCBvbmx5IHN1cHBvcnRzIHRvdGFsIHJldHJpZXMgYW5kIGRvZXMgbm90ICIKICAgICAgICAgICAgICAgICJyZWNvZ25pemUgY29ubmVjdCwgcmVhZCwgb3IgcmVkaXJlY3QgcmV0cnkgcGFyYW1ldGVycy4iLAogICAgICAgICAgICAgICAgQXBwRW5naW5lUGxhdGZvcm1XYXJuaW5nKQoKICAgICAgICByZXR1cm4gcmV0cmllcwoKCmRlZiBpc19hcHBlbmdpbmUoKToKICAgIHJldHVybiAoaXNfbG9jYWxfYXBwZW5naW5lKCkgb3IKICAgICAgICAgICAgaXNfcHJvZF9hcHBlbmdpbmUoKSBvcgogICAgICAgICAgICBpc19wcm9kX2FwcGVuZ2luZV9tdm1zKCkpCgoKZGVmIGlzX2FwcGVuZ2luZV9zYW5kYm94KCk6CiAgICByZXR1cm4gaXNfYXBwZW5naW5lKCkgYW5kIG5vdCBpc19wcm9kX2FwcGVuZ2luZV9tdm1zKCkKCgpkZWYgaXNfbG9jYWxfYXBwZW5naW5lKCk6CiAgICByZXR1cm4gKCdBUFBFTkdJTkVfUlVOVElNRScgaW4gb3MuZW52aXJvbiBhbmQKICAgICAgICAgICAgJ0RldmVsb3BtZW50LycgaW4gb3MuZW52aXJvblsnU0VSVkVSX1NPRlRXQVJFJ10pCgoKZGVmIGlzX3Byb2RfYXBwZW5naW5lKCk6CiAgICByZXR1cm4gKCdBUFBFTkdJTkVfUlVOVElNRScgaW4gb3MuZW52aXJvbiBhbmQKICAgICAgICAgICAgJ0dvb2dsZSBBcHAgRW5naW5lLycgaW4gb3MuZW52aXJvblsnU0VSVkVSX1NPRlRXQVJFJ10gYW5kCiAgICAgICAgICAgIG5vdCBpc19wcm9kX2FwcGVuZ2luZV9tdm1zKCkpCgoKZGVmIGlzX3Byb2RfYXBwZW5naW5lX212bXMoKToKICAgIHJldHVybiBvcy5lbnZpcm9uLmdldCgnR0FFX1ZNJywgRmFsc2UpID09ICd0cnVlJwo=
