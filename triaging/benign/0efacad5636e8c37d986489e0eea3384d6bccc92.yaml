statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/quantiumbase/0.8.1/quantiumbase-0.8.1/quantiumbase-0.8.1/quantiumbase/core.py
  contents:
  - name: DatabaseURL
    score: 0.0
    code: |-
      def __bool__(self) -> bool:
              return True
    tokens: resume load_name __name__ store_name __module__ load_const DatabaseURL store_name __qualname__ load_const url load_name typing load_attr Union load_name str load_const DatabaseURL build_tuple binary_subscr build_tuple load_const OBJECT make_function annotations store_name __init__ load_name property load_const return load_name SplitResult build_tuple load_const OBJECT make_function annotations call store_name components load_name property load_const return load_name str build_tuple load_const OBJECT make_function annotations call store_name scheme load_name property load_const return load_name str build_tuple load_const OBJECT make_function annotations call store_name dialect load_name property load_const return load_name str build_tuple load_const OBJECT make_function annotations call store_name driver load_name property load_const return load_name typing load_attr Optional load_name bytes binary_subscr build_tuple load_const OBJECT make_function annotations call store_name userinfo load_name property load_const return load_name typing load_attr Optional load_name str binary_subscr build_tuple load_const OBJECT make_function annotations call store_name username load_name property load_const return load_name typing load_attr Optional load_name str binary_subscr build_tuple load_const OBJECT make_function annotations call store_name password load_name property load_const return load_name typing load_attr Optional load_name str binary_subscr build_tuple load_const OBJECT make_function annotations call store_name hostname load_name property load_const return load_name typing load_attr Optional load_name int binary_subscr build_tuple load_const OBJECT make_function annotations call store_name port load_name property load_const return load_name typing load_attr Optional load_name str binary_subscr build_tuple load_const OBJECT make_function annotations call store_name netloc load_name property load_const return load_name str build_tuple load_const OBJECT make_function annotations call store_name database load_name property load_const return load_name dict build_tuple load_const OBJECT make_function annotations call store_name options load_const kwargs load_name typing load_attr Any load_const return load_const DatabaseURL build_tuple load_const OBJECT make_function annotations store_name replace load_name property load_const return load_name str build_tuple load_const OBJECT make_function annotations call store_name STRING_LEN_S_ENT_HIGH load_const return load_name str build_tuple load_const OBJECT make_function annotations store_name __str__ load_const return load_name str build_tuple load_const OBJECT make_function annotations store_name __repr__ load_const other load_name typing load_attr Any load_const return load_name bool build_tuple load_const OBJECT make_function annotations store_name __eq__ return_const None
    hash: e8c330d012ca811b63035852c16001311c61e23450c65cb0cbb0e5af0cff76b8
sources:
  .repo_cache/malicious_repos/pypi_malregistry/quantiumbase/0.8.1/quantiumbase-0.8.1/quantiumbase-0.8.1/quantiumbase/core.py: aW1wb3J0IGFzeW5jaW8KaW1wb3J0IGNvbnRleHRsaWIKaW1wb3J0IGZ1bmN0b29scwppbXBvcnQgbG9nZ2luZwppbXBvcnQgdHlwaW5nCmZyb20gY29udGV4dHZhcnMgaW1wb3J0IENvbnRleHRWYXIKZnJvbSB0eXBlcyBpbXBvcnQgVHJhY2ViYWNrVHlwZQpmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgU3BsaXRSZXN1bHQsIHBhcnNlX3FzbCwgdW5xdW90ZSwgdXJsc3BsaXQKCmZyb20gc3FsYWxjaGVteSBpbXBvcnQgdGV4dApmcm9tIHNxbGFsY2hlbXkuc3FsIGltcG9ydCBDbGF1c2VFbGVtZW50Cgpmcm9tIHF1YW50aXVtYmFzZS5pbXBvcnRlciBpbXBvcnQgaW1wb3J0X2Zyb21fc3RyaW5nCmZyb20gcXVhbnRpdW1iYXNlLmludGVyZmFjZXMgaW1wb3J0IERhdGFiYXNlQmFja2VuZCwgUmVjb3JkCgp0cnk6ICAjIHByYWdtYTogbm8gY292ZXIKICAgIGltcG9ydCBjbGljawoKICAgICMgRXh0cmEgbG9nIGluZm8gZm9yIG9wdGlvbmFsIGNvbG91cmVkIHRlcm1pbmFsIG91dHB1dHMuCiAgICBMT0dfRVhUUkEgPSB7CiAgICAgICAgImNvbG9yX21lc3NhZ2UiOiAiUXVlcnk6ICIgKyBjbGljay5zdHlsZSgiJXMiLCBib2xkPVRydWUpICsgIiBBcmdzOiAlcyIKICAgIH0KICAgIENPTk5FQ1RfRVhUUkEgPSB7CiAgICAgICAgImNvbG9yX21lc3NhZ2UiOiAiQ29ubmVjdGVkIHRvIGRhdGFiYXNlICIgKyBjbGljay5zdHlsZSgiJXMiLCBib2xkPVRydWUpCiAgICB9CiAgICBESVNDT05ORUNUX0VYVFJBID0gewogICAgICAgICJjb2xvcl9tZXNzYWdlIjogIkRpc2Nvbm5lY3RlZCBmcm9tIGRhdGFiYXNlICIgKyBjbGljay5zdHlsZSgiJXMiLCBib2xkPVRydWUpCiAgICB9CmV4Y2VwdCBJbXBvcnRFcnJvcjogICMgcHJhZ21hOiBubyBjb3ZlcgogICAgTE9HX0VYVFJBID0ge30KICAgIENPTk5FQ1RfRVhUUkEgPSB7fQogICAgRElTQ09OTkVDVF9FWFRSQSA9IHt9CgoKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoInF1YW50aXVtYmFzZSIpCgoKY2xhc3MgRGF0YWJhc2U6CiAgICBTVVBQT1JURURfQkFDS0VORFMgPSB7CiAgICAgICAgInBvc3RncmVzcWwiOiAicXVhbnRpdW1iYXNlLmJhY2tlbmRzLnBvc3RncmVzOlBvc3RncmVzQmFja2VuZCIsCiAgICAgICAgInBvc3RncmVzcWwrYWlvcGciOiAicXVhbnRpdW1iYXNlLmJhY2tlbmRzLmFpb3BnOkFpb3BnQmFja2VuZCIsCiAgICAgICAgInBvc3RncmVzIjogInF1YW50aXVtYmFzZS5iYWNrZW5kcy5wb3N0Z3JlczpQb3N0Z3Jlc0JhY2tlbmQiLAogICAgICAgICJteXNxbCI6ICJxdWFudGl1bWJhc2UuYmFja2VuZHMubXlzcWw6TXlTUUxCYWNrZW5kIiwKICAgICAgICAibXlzcWwrYXN5bmNteSI6ICJxdWFudGl1bWJhc2UuYmFja2VuZHMuYXN5bmNteTpBc3luY015QmFja2VuZCIsCiAgICAgICAgInNxbGl0ZSI6ICJxdWFudGl1bWJhc2UuYmFja2VuZHMuc3FsaXRlOlNRTGl0ZUJhY2tlbmQiLAogICAgfQoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIHVybDogdHlwaW5nLlVuaW9uW3N0ciwgIkRhdGFiYXNlVVJMIl0sCiAgICAgICAgKiwKICAgICAgICBmb3JjZV9yb2xsYmFjazogYm9vbCA9IEZhbHNlLAogICAgICAgICoqb3B0aW9uczogdHlwaW5nLkFueSwKICAgICk6CiAgICAgICAgc2VsZi51cmwgPSBEYXRhYmFzZVVSTCh1cmwpCiAgICAgICAgc2VsZi5vcHRpb25zID0gb3B0aW9ucwogICAgICAgIHNlbGYuaXNfY29ubmVjdGVkID0gRmFsc2UKCiAgICAgICAgc2VsZi5fZm9yY2Vfcm9sbGJhY2sgPSBmb3JjZV9yb2xsYmFjawoKICAgICAgICBiYWNrZW5kX3N0ciA9IHNlbGYuX2dldF9iYWNrZW5kKCkKICAgICAgICBiYWNrZW5kX2NscyA9IGltcG9ydF9mcm9tX3N0cmluZyhiYWNrZW5kX3N0cikKICAgICAgICBhc3NlcnQgaXNzdWJjbGFzcyhiYWNrZW5kX2NscywgRGF0YWJhc2VCYWNrZW5kKQogICAgICAgIHNlbGYuX2JhY2tlbmQgPSBiYWNrZW5kX2NscyhzZWxmLnVybCwgKipzZWxmLm9wdGlvbnMpCgogICAgICAgICMgQ29ubmVjdGlvbnMgYXJlIHN0b3JlZCBhcyB0YXNrLWxvY2FsIHN0YXRlLgogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb25fY29udGV4dCA9IENvbnRleHRWYXIoImNvbm5lY3Rpb25fY29udGV4dCIpICAjIHR5cGU6IENvbnRleHRWYXIKCiAgICAgICAgIyBXaGVuIGBmb3JjZV9yb2xsYmFjaz1UcnVlYCBpcyB1c2VkLCB3ZSB1c2UgYSBzaW5nbGUgZ2xvYmFsCiAgICAgICAgIyBjb25uZWN0aW9uLCB3aXRoaW4gYSB0cmFuc2FjdGlvbiB0aGF0IGFsd2F5cyByb2xscyBiYWNrLgogICAgICAgIHNlbGYuX2dsb2JhbF9jb25uZWN0aW9uID0gTm9uZSAgIyB0eXBlOiB0eXBpbmcuT3B0aW9uYWxbQ29ubmVjdGlvbl0KICAgICAgICBzZWxmLl9nbG9iYWxfdHJhbnNhY3Rpb24gPSBOb25lICAjIHR5cGU6IHR5cGluZy5PcHRpb25hbFtUcmFuc2FjdGlvbl0KCiAgICBhc3luYyBkZWYgY29ubmVjdChzZWxmKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIEVzdGFibGlzaCB0aGUgY29ubmVjdGlvbiBwb29sLgogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoIkFscmVhZHkgY29ubmVjdGVkLCBza2lwcGluZyBjb25uZWN0aW9uIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgYXdhaXQgc2VsZi5fYmFja2VuZC5jb25uZWN0KCkKICAgICAgICBsb2dnZXIuaW5mbygKICAgICAgICAgICAgIkNvbm5lY3RlZCB0byBkYXRhYmFzZSAlcyIsIHNlbGYudXJsLm9ic2N1cmVfcGFzc3dvcmQsIGV4dHJhPUNPTk5FQ1RfRVhUUkEKICAgICAgICApCiAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBUcnVlCgogICAgICAgIGlmIHNlbGYuX2ZvcmNlX3JvbGxiYWNrOgogICAgICAgICAgICBhc3NlcnQgc2VsZi5fZ2xvYmFsX2Nvbm5lY3Rpb24gaXMgTm9uZQogICAgICAgICAgICBhc3NlcnQgc2VsZi5fZ2xvYmFsX3RyYW5zYWN0aW9uIGlzIE5vbmUKCiAgICAgICAgICAgIHNlbGYuX2dsb2JhbF9jb25uZWN0aW9uID0gQ29ubmVjdGlvbihzZWxmLl9iYWNrZW5kKQogICAgICAgICAgICBzZWxmLl9nbG9iYWxfdHJhbnNhY3Rpb24gPSBzZWxmLl9nbG9iYWxfY29ubmVjdGlvbi50cmFuc2FjdGlvbigKICAgICAgICAgICAgICAgIGZvcmNlX3JvbGxiYWNrPVRydWUKICAgICAgICAgICAgKQoKICAgICAgICAgICAgYXdhaXQgc2VsZi5fZ2xvYmFsX3RyYW5zYWN0aW9uLl9fYWVudGVyX18oKQoKICAgIGFzeW5jIGRlZiBkaXNjb25uZWN0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgQ2xvc2UgYWxsIGNvbm5lY3Rpb25zIGluIHRoZSBjb25uZWN0aW9uIHBvb2wuCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuaXNfY29ubmVjdGVkOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoIkFscmVhZHkgZGlzY29ubmVjdGVkLCBza2lwcGluZyBkaXNjb25uZWN0aW9uIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgaWYgc2VsZi5fZm9yY2Vfcm9sbGJhY2s6CiAgICAgICAgICAgIGFzc2VydCBzZWxmLl9nbG9iYWxfY29ubmVjdGlvbiBpcyBub3QgTm9uZQogICAgICAgICAgICBhc3NlcnQgc2VsZi5fZ2xvYmFsX3RyYW5zYWN0aW9uIGlzIG5vdCBOb25lCgogICAgICAgICAgICBhd2FpdCBzZWxmLl9nbG9iYWxfdHJhbnNhY3Rpb24uX19hZXhpdF9fKCkKCiAgICAgICAgICAgIHNlbGYuX2dsb2JhbF90cmFuc2FjdGlvbiA9IE5vbmUKICAgICAgICAgICAgc2VsZi5fZ2xvYmFsX2Nvbm5lY3Rpb24gPSBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5fY29ubmVjdGlvbl9jb250ZXh0ID0gQ29udGV4dFZhcigiY29ubmVjdGlvbl9jb250ZXh0IikKCiAgICAgICAgYXdhaXQgc2VsZi5fYmFja2VuZC5kaXNjb25uZWN0KCkKICAgICAgICBsb2dnZXIuaW5mbygKICAgICAgICAgICAgIkRpc2Nvbm5lY3RlZCBmcm9tIGRhdGFiYXNlICVzIiwKICAgICAgICAgICAgc2VsZi51cmwub2JzY3VyZV9wYXNzd29yZCwKICAgICAgICAgICAgZXh0cmE9RElTQ09OTkVDVF9FWFRSQSwKICAgICAgICApCiAgICAgICAgc2VsZi5pc19jb25uZWN0ZWQgPSBGYWxzZQoKICAgIGFzeW5jIGRlZiBfX2FlbnRlcl9fKHNlbGYpIC0+ICJEYXRhYmFzZSI6CiAgICAgICAgYXdhaXQgc2VsZi5jb25uZWN0KCkKICAgICAgICByZXR1cm4gc2VsZgoKICAgIGFzeW5jIGRlZiBfX2FleGl0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBleGNfdHlwZTogdHlwaW5nLk9wdGlvbmFsW3R5cGluZy5UeXBlW0Jhc2VFeGNlcHRpb25dXSA9IE5vbmUsCiAgICAgICAgZXhjX3ZhbHVlOiB0eXBpbmcuT3B0aW9uYWxbQmFzZUV4Y2VwdGlvbl0gPSBOb25lLAogICAgICAgIHRyYWNlYmFjazogdHlwaW5nLk9wdGlvbmFsW1RyYWNlYmFja1R5cGVdID0gTm9uZSwKICAgICkgLT4gTm9uZToKICAgICAgICBhd2FpdCBzZWxmLmRpc2Nvbm5lY3QoKQoKICAgIGFzeW5jIGRlZiBmZXRjaF9hbGwoCiAgICAgICAgc2VsZiwKICAgICAgICBxdWVyeTogdHlwaW5nLlVuaW9uW0NsYXVzZUVsZW1lbnQsIHN0cl0sCiAgICAgICAgdmFsdWVzOiB0eXBpbmcuT3B0aW9uYWxbZGljdF0gPSBOb25lLAogICAgKSAtPiB0eXBpbmcuTGlzdFtSZWNvcmRdOgogICAgICAgIGFzeW5jIHdpdGggc2VsZi5jb25uZWN0aW9uKCkgYXMgY29ubmVjdGlvbjoKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGNvbm5lY3Rpb24uZmV0Y2hfYWxsKHF1ZXJ5LCB2YWx1ZXMpCgogICAgYXN5bmMgZGVmIGZldGNoX29uZSgKICAgICAgICBzZWxmLAogICAgICAgIHF1ZXJ5OiB0eXBpbmcuVW5pb25bQ2xhdXNlRWxlbWVudCwgc3RyXSwKICAgICAgICB2YWx1ZXM6IHR5cGluZy5PcHRpb25hbFtkaWN0XSA9IE5vbmUsCiAgICApIC0+IHR5cGluZy5PcHRpb25hbFtSZWNvcmRdOgogICAgICAgIGFzeW5jIHdpdGggc2VsZi5jb25uZWN0aW9uKCkgYXMgY29ubmVjdGlvbjoKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGNvbm5lY3Rpb24uZmV0Y2hfb25lKHF1ZXJ5LCB2YWx1ZXMpCgogICAgYXN5bmMgZGVmIGZldGNoX3ZhbCgKICAgICAgICBzZWxmLAogICAgICAgIHF1ZXJ5OiB0eXBpbmcuVW5pb25bQ2xhdXNlRWxlbWVudCwgc3RyXSwKICAgICAgICB2YWx1ZXM6IHR5cGluZy5PcHRpb25hbFtkaWN0XSA9IE5vbmUsCiAgICAgICAgY29sdW1uOiB0eXBpbmcuQW55ID0gMCwKICAgICkgLT4gdHlwaW5nLkFueToKICAgICAgICBhc3luYyB3aXRoIHNlbGYuY29ubmVjdGlvbigpIGFzIGNvbm5lY3Rpb246CiAgICAgICAgICAgIHJldHVybiBhd2FpdCBjb25uZWN0aW9uLmZldGNoX3ZhbChxdWVyeSwgdmFsdWVzLCBjb2x1bW49Y29sdW1uKQoKICAgIGFzeW5jIGRlZiBleGVjdXRlKAogICAgICAgIHNlbGYsCiAgICAgICAgcXVlcnk6IHR5cGluZy5VbmlvbltDbGF1c2VFbGVtZW50LCBzdHJdLAogICAgICAgIHZhbHVlczogdHlwaW5nLk9wdGlvbmFsW2RpY3RdID0gTm9uZSwKICAgICkgLT4gdHlwaW5nLkFueToKICAgICAgICBhc3luYyB3aXRoIHNlbGYuY29ubmVjdGlvbigpIGFzIGNvbm5lY3Rpb246CiAgICAgICAgICAgIHJldHVybiBhd2FpdCBjb25uZWN0aW9uLmV4ZWN1dGUocXVlcnksIHZhbHVlcykKCiAgICBhc3luYyBkZWYgZXhlY3V0ZV9tYW55KAogICAgICAgIHNlbGYsIHF1ZXJ5OiB0eXBpbmcuVW5pb25bQ2xhdXNlRWxlbWVudCwgc3RyXSwgdmFsdWVzOiBsaXN0CiAgICApIC0+IE5vbmU6CiAgICAgICAgYXN5bmMgd2l0aCBzZWxmLmNvbm5lY3Rpb24oKSBhcyBjb25uZWN0aW9uOgogICAgICAgICAgICByZXR1cm4gYXdhaXQgY29ubmVjdGlvbi5leGVjdXRlX21hbnkocXVlcnksIHZhbHVlcykKCiAgICBhc3luYyBkZWYgaXRlcmF0ZSgKICAgICAgICBzZWxmLAogICAgICAgIHF1ZXJ5OiB0eXBpbmcuVW5pb25bQ2xhdXNlRWxlbWVudCwgc3RyXSwKICAgICAgICB2YWx1ZXM6IHR5cGluZy5PcHRpb25hbFtkaWN0XSA9IE5vbmUsCiAgICApIC0+IHR5cGluZy5Bc3luY0dlbmVyYXRvclt0eXBpbmcuTWFwcGluZywgTm9uZV06CiAgICAgICAgYXN5bmMgd2l0aCBzZWxmLmNvbm5lY3Rpb24oKSBhcyBjb25uZWN0aW9uOgogICAgICAgICAgICBhc3luYyBmb3IgcmVjb3JkIGluIGNvbm5lY3Rpb24uaXRlcmF0ZShxdWVyeSwgdmFsdWVzKToKICAgICAgICAgICAgICAgIHlpZWxkIHJlY29yZAoKICAgIGRlZiBjb25uZWN0aW9uKHNlbGYpIC0+ICJDb25uZWN0aW9uIjoKICAgICAgICBpZiBzZWxmLl9nbG9iYWxfY29ubmVjdGlvbiBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dsb2JhbF9jb25uZWN0aW9uCgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2Nvbm5lY3Rpb25fY29udGV4dC5nZXQoKQogICAgICAgIGV4Y2VwdCBMb29rdXBFcnJvcjoKICAgICAgICAgICAgY29ubmVjdGlvbiA9IENvbm5lY3Rpb24oc2VsZi5fYmFja2VuZCkKICAgICAgICAgICAgc2VsZi5fY29ubmVjdGlvbl9jb250ZXh0LnNldChjb25uZWN0aW9uKQogICAgICAgICAgICByZXR1cm4gY29ubmVjdGlvbgoKICAgIGRlZiB0cmFuc2FjdGlvbigKICAgICAgICBzZWxmLCAqLCBmb3JjZV9yb2xsYmFjazogYm9vbCA9IEZhbHNlLCAqKmt3YXJnczogdHlwaW5nLkFueQogICAgKSAtPiAiVHJhbnNhY3Rpb24iOgogICAgICAgIHJldHVybiBUcmFuc2FjdGlvbihzZWxmLmNvbm5lY3Rpb24sIGZvcmNlX3JvbGxiYWNrPWZvcmNlX3JvbGxiYWNrLCAqKmt3YXJncykKCiAgICBAY29udGV4dGxpYi5jb250ZXh0bWFuYWdlcgogICAgZGVmIGZvcmNlX3JvbGxiYWNrKHNlbGYpIC0+IHR5cGluZy5JdGVyYXRvcltOb25lXToKICAgICAgICBpbml0aWFsID0gc2VsZi5fZm9yY2Vfcm9sbGJhY2sKICAgICAgICBzZWxmLl9mb3JjZV9yb2xsYmFjayA9IFRydWUKICAgICAgICB0cnk6CiAgICAgICAgICAgIHlpZWxkCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgc2VsZi5fZm9yY2Vfcm9sbGJhY2sgPSBpbml0aWFsCgogICAgZGVmIF9nZXRfYmFja2VuZChzZWxmKSAtPiBzdHI6CiAgICAgICAgcmV0dXJuIHNlbGYuU1VQUE9SVEVEX0JBQ0tFTkRTLmdldCgKICAgICAgICAgICAgc2VsZi51cmwuc2NoZW1lLCBzZWxmLlNVUFBPUlRFRF9CQUNLRU5EU1tzZWxmLnVybC5kaWFsZWN0XQogICAgICAgICkKCgpjbGFzcyBDb25uZWN0aW9uOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGJhY2tlbmQ6IERhdGFiYXNlQmFja2VuZCkgLT4gTm9uZToKICAgICAgICBzZWxmLl9iYWNrZW5kID0gYmFja2VuZAoKICAgICAgICBzZWxmLl9jb25uZWN0aW9uX2xvY2sgPSBhc3luY2lvLkxvY2soKQogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24gPSBzZWxmLl9iYWNrZW5kLmNvbm5lY3Rpb24oKQogICAgICAgIHNlbGYuX2Nvbm5lY3Rpb25fY291bnRlciA9IDAKCiAgICAgICAgc2VsZi5fdHJhbnNhY3Rpb25fbG9jayA9IGFzeW5jaW8uTG9jaygpCiAgICAgICAgc2VsZi5fdHJhbnNhY3Rpb25fc3RhY2sgPSBbXSAgIyB0eXBlOiB0eXBpbmcuTGlzdFtUcmFuc2FjdGlvbl0KCiAgICAgICAgc2VsZi5fcXVlcnlfbG9jayA9IGFzeW5jaW8uTG9jaygpCgogICAgYXN5bmMgZGVmIF9fYWVudGVyX18oc2VsZikgLT4gIkNvbm5lY3Rpb24iOgogICAgICAgIGFzeW5jIHdpdGggc2VsZi5fY29ubmVjdGlvbl9sb2NrOgogICAgICAgICAgICBzZWxmLl9jb25uZWN0aW9uX2NvdW50ZXIgKz0gMQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBzZWxmLl9jb25uZWN0aW9uX2NvdW50ZXIgPT0gMToKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLmFjcXVpcmUoKQogICAgICAgICAgICBleGNlcHQgQmFzZUV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgc2VsZi5fY29ubmVjdGlvbl9jb3VudGVyIC09IDEKICAgICAgICAgICAgICAgIHJhaXNlIGUKICAgICAgICByZXR1cm4gc2VsZgoKICAgIGFzeW5jIGRlZiBfX2FleGl0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBleGNfdHlwZTogdHlwaW5nLk9wdGlvbmFsW3R5cGluZy5UeXBlW0Jhc2VFeGNlcHRpb25dXSA9IE5vbmUsCiAgICAgICAgZXhjX3ZhbHVlOiB0eXBpbmcuT3B0aW9uYWxbQmFzZUV4Y2VwdGlvbl0gPSBOb25lLAogICAgICAgIHRyYWNlYmFjazogdHlwaW5nLk9wdGlvbmFsW1RyYWNlYmFja1R5cGVdID0gTm9uZSwKICAgICkgLT4gTm9uZToKICAgICAgICBhc3luYyB3aXRoIHNlbGYuX2Nvbm5lY3Rpb25fbG9jazoKICAgICAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24gaXMgbm90IE5vbmUKICAgICAgICAgICAgc2VsZi5fY29ubmVjdGlvbl9jb3VudGVyIC09IDEKICAgICAgICAgICAgaWYgc2VsZi5fY29ubmVjdGlvbl9jb3VudGVyID09IDA6CiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLnJlbGVhc2UoKQoKICAgIGFzeW5jIGRlZiBmZXRjaF9hbGwoCiAgICAgICAgc2VsZiwKICAgICAgICBxdWVyeTogdHlwaW5nLlVuaW9uW0NsYXVzZUVsZW1lbnQsIHN0cl0sCiAgICAgICAgdmFsdWVzOiB0eXBpbmcuT3B0aW9uYWxbZGljdF0gPSBOb25lLAogICAgKSAtPiB0eXBpbmcuTGlzdFtSZWNvcmRdOgogICAgICAgIGJ1aWx0X3F1ZXJ5ID0gc2VsZi5fYnVpbGRfcXVlcnkocXVlcnksIHZhbHVlcykKICAgICAgICBhc3luYyB3aXRoIHNlbGYuX3F1ZXJ5X2xvY2s6CiAgICAgICAgICAgIHJldHVybiBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLmZldGNoX2FsbChidWlsdF9xdWVyeSkKCiAgICBhc3luYyBkZWYgZmV0Y2hfb25lKAogICAgICAgIHNlbGYsCiAgICAgICAgcXVlcnk6IHR5cGluZy5VbmlvbltDbGF1c2VFbGVtZW50LCBzdHJdLAogICAgICAgIHZhbHVlczogdHlwaW5nLk9wdGlvbmFsW2RpY3RdID0gTm9uZSwKICAgICkgLT4gdHlwaW5nLk9wdGlvbmFsW1JlY29yZF06CiAgICAgICAgYnVpbHRfcXVlcnkgPSBzZWxmLl9idWlsZF9xdWVyeShxdWVyeSwgdmFsdWVzKQogICAgICAgIGFzeW5jIHdpdGggc2VsZi5fcXVlcnlfbG9jazoKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHNlbGYuX2Nvbm5lY3Rpb24uZmV0Y2hfb25lKGJ1aWx0X3F1ZXJ5KQoKICAgIGFzeW5jIGRlZiBmZXRjaF92YWwoCiAgICAgICAgc2VsZiwKICAgICAgICBxdWVyeTogdHlwaW5nLlVuaW9uW0NsYXVzZUVsZW1lbnQsIHN0cl0sCiAgICAgICAgdmFsdWVzOiB0eXBpbmcuT3B0aW9uYWxbZGljdF0gPSBOb25lLAogICAgICAgIGNvbHVtbjogdHlwaW5nLkFueSA9IDAsCiAgICApIC0+IHR5cGluZy5Bbnk6CiAgICAgICAgYnVpbHRfcXVlcnkgPSBzZWxmLl9idWlsZF9xdWVyeShxdWVyeSwgdmFsdWVzKQogICAgICAgIGFzeW5jIHdpdGggc2VsZi5fcXVlcnlfbG9jazoKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHNlbGYuX2Nvbm5lY3Rpb24uZmV0Y2hfdmFsKGJ1aWx0X3F1ZXJ5LCBjb2x1bW4pCgogICAgYXN5bmMgZGVmIGV4ZWN1dGUoCiAgICAgICAgc2VsZiwKICAgICAgICBxdWVyeTogdHlwaW5nLlVuaW9uW0NsYXVzZUVsZW1lbnQsIHN0cl0sCiAgICAgICAgdmFsdWVzOiB0eXBpbmcuT3B0aW9uYWxbZGljdF0gPSBOb25lLAogICAgKSAtPiB0eXBpbmcuQW55OgogICAgICAgIGJ1aWx0X3F1ZXJ5ID0gc2VsZi5fYnVpbGRfcXVlcnkocXVlcnksIHZhbHVlcykKICAgICAgICBhc3luYyB3aXRoIHNlbGYuX3F1ZXJ5X2xvY2s6CiAgICAgICAgICAgIHJldHVybiBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLmV4ZWN1dGUoYnVpbHRfcXVlcnkpCgogICAgYXN5bmMgZGVmIGV4ZWN1dGVfbWFueSgKICAgICAgICBzZWxmLCBxdWVyeTogdHlwaW5nLlVuaW9uW0NsYXVzZUVsZW1lbnQsIHN0cl0sIHZhbHVlczogbGlzdAogICAgKSAtPiBOb25lOgogICAgICAgIHF1ZXJpZXMgPSBbc2VsZi5fYnVpbGRfcXVlcnkocXVlcnksIHZhbHVlc19zZXQpIGZvciB2YWx1ZXNfc2V0IGluIHZhbHVlc10KICAgICAgICBhc3luYyB3aXRoIHNlbGYuX3F1ZXJ5X2xvY2s6CiAgICAgICAgICAgIGF3YWl0IHNlbGYuX2Nvbm5lY3Rpb24uZXhlY3V0ZV9tYW55KHF1ZXJpZXMpCgogICAgYXN5bmMgZGVmIGl0ZXJhdGUoCiAgICAgICAgc2VsZiwKICAgICAgICBxdWVyeTogdHlwaW5nLlVuaW9uW0NsYXVzZUVsZW1lbnQsIHN0cl0sCiAgICAgICAgdmFsdWVzOiB0eXBpbmcuT3B0aW9uYWxbZGljdF0gPSBOb25lLAogICAgKSAtPiB0eXBpbmcuQXN5bmNHZW5lcmF0b3JbdHlwaW5nLkFueSwgTm9uZV06CiAgICAgICAgYnVpbHRfcXVlcnkgPSBzZWxmLl9idWlsZF9xdWVyeShxdWVyeSwgdmFsdWVzKQogICAgICAgIGFzeW5jIHdpdGggc2VsZi50cmFuc2FjdGlvbigpOgogICAgICAgICAgICBhc3luYyB3aXRoIHNlbGYuX3F1ZXJ5X2xvY2s6CiAgICAgICAgICAgICAgICBhc3luYyBmb3IgcmVjb3JkIGluIHNlbGYuX2Nvbm5lY3Rpb24uaXRlcmF0ZShidWlsdF9xdWVyeSk6CiAgICAgICAgICAgICAgICAgICAgeWllbGQgcmVjb3JkCgogICAgZGVmIHRyYW5zYWN0aW9uKAogICAgICAgIHNlbGYsICosIGZvcmNlX3JvbGxiYWNrOiBib29sID0gRmFsc2UsICoqa3dhcmdzOiB0eXBpbmcuQW55CiAgICApIC0+ICJUcmFuc2FjdGlvbiI6CiAgICAgICAgZGVmIGNvbm5lY3Rpb25fY2FsbGFibGUoKSAtPiBDb25uZWN0aW9uOgogICAgICAgICAgICByZXR1cm4gc2VsZgoKICAgICAgICByZXR1cm4gVHJhbnNhY3Rpb24oY29ubmVjdGlvbl9jYWxsYWJsZSwgZm9yY2Vfcm9sbGJhY2ssICoqa3dhcmdzKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHJhd19jb25uZWN0aW9uKHNlbGYpIC0+IHR5cGluZy5Bbnk6CiAgICAgICAgcmV0dXJuIHNlbGYuX2Nvbm5lY3Rpb24ucmF3X2Nvbm5lY3Rpb24KCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgX2J1aWxkX3F1ZXJ5KAogICAgICAgIHF1ZXJ5OiB0eXBpbmcuVW5pb25bQ2xhdXNlRWxlbWVudCwgc3RyXSwgdmFsdWVzOiB0eXBpbmcuT3B0aW9uYWxbZGljdF0gPSBOb25lCiAgICApIC0+IENsYXVzZUVsZW1lbnQ6CiAgICAgICAgaWYgaXNpbnN0YW5jZShxdWVyeSwgc3RyKToKICAgICAgICAgICAgcXVlcnkgPSB0ZXh0KHF1ZXJ5KQoKICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5LmJpbmRwYXJhbXMoKip2YWx1ZXMpIGlmIHZhbHVlcyBpcyBub3QgTm9uZSBlbHNlIHF1ZXJ5CiAgICAgICAgZWxpZiB2YWx1ZXM6CiAgICAgICAgICAgIHJldHVybiBxdWVyeS52YWx1ZXMoKip2YWx1ZXMpCgogICAgICAgIHJldHVybiBxdWVyeQoKCl9DYWxsYWJsZVR5cGUgPSB0eXBpbmcuVHlwZVZhcigiX0NhbGxhYmxlVHlwZSIsIGJvdW5kPXR5cGluZy5DYWxsYWJsZSkKCgpjbGFzcyBUcmFuc2FjdGlvbjoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIGNvbm5lY3Rpb25fY2FsbGFibGU6IHR5cGluZy5DYWxsYWJsZVtbXSwgQ29ubmVjdGlvbl0sCiAgICAgICAgZm9yY2Vfcm9sbGJhY2s6IGJvb2wsCiAgICAgICAgKiprd2FyZ3M6IHR5cGluZy5BbnksCiAgICApIC0+IE5vbmU6CiAgICAgICAgc2VsZi5fY29ubmVjdGlvbl9jYWxsYWJsZSA9IGNvbm5lY3Rpb25fY2FsbGFibGUKICAgICAgICBzZWxmLl9mb3JjZV9yb2xsYmFjayA9IGZvcmNlX3JvbGxiYWNrCiAgICAgICAgc2VsZi5fZXh0cmFfb3B0aW9ucyA9IGt3YXJncwoKICAgIGFzeW5jIGRlZiBfX2FlbnRlcl9fKHNlbGYpIC0+ICJUcmFuc2FjdGlvbiI6CiAgICAgICAgIiIiCiAgICAgICAgQ2FsbGVkIHdoZW4gZW50ZXJpbmcgYGFzeW5jIHdpdGggZGF0YWJhc2UudHJhbnNhY3Rpb24oKWAKICAgICAgICAiIiIKICAgICAgICBhd2FpdCBzZWxmLnN0YXJ0KCkKICAgICAgICByZXR1cm4gc2VsZgoKICAgIGFzeW5jIGRlZiBfX2FleGl0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBleGNfdHlwZTogdHlwaW5nLk9wdGlvbmFsW3R5cGluZy5UeXBlW0Jhc2VFeGNlcHRpb25dXSA9IE5vbmUsCiAgICAgICAgZXhjX3ZhbHVlOiB0eXBpbmcuT3B0aW9uYWxbQmFzZUV4Y2VwdGlvbl0gPSBOb25lLAogICAgICAgIHRyYWNlYmFjazogdHlwaW5nLk9wdGlvbmFsW1RyYWNlYmFja1R5cGVdID0gTm9uZSwKICAgICkgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBDYWxsZWQgd2hlbiBleGl0aW5nIGBhc3luYyB3aXRoIGRhdGFiYXNlLnRyYW5zYWN0aW9uKClgCiAgICAgICAgIiIiCiAgICAgICAgaWYgZXhjX3R5cGUgaXMgbm90IE5vbmUgb3Igc2VsZi5fZm9yY2Vfcm9sbGJhY2s6CiAgICAgICAgICAgIGF3YWl0IHNlbGYucm9sbGJhY2soKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGF3YWl0IHNlbGYuY29tbWl0KCkKCiAgICBkZWYgX19hd2FpdF9fKHNlbGYpIC0+IHR5cGluZy5HZW5lcmF0b3JbTm9uZSwgTm9uZSwgIlRyYW5zYWN0aW9uIl06CiAgICAgICAgIiIiCiAgICAgICAgQ2FsbGVkIGlmIHVzaW5nIHRoZSBsb3ctbGV2ZWwgYHRyYW5zYWN0aW9uID0gYXdhaXQgZGF0YWJhc2UudHJhbnNhY3Rpb24oKWAKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5zdGFydCgpLl9fYXdhaXRfXygpCgogICAgZGVmIF9fY2FsbF9fKHNlbGYsIGZ1bmM6IF9DYWxsYWJsZVR5cGUpIC0+IF9DYWxsYWJsZVR5cGU6CiAgICAgICAgIiIiCiAgICAgICAgQ2FsbGVkIGlmIHVzaW5nIGBAZGF0YWJhc2UudHJhbnNhY3Rpb24oKWAgYXMgYSBkZWNvcmF0b3IuCiAgICAgICAgIiIiCgogICAgICAgIEBmdW5jdG9vbHMud3JhcHMoZnVuYykKICAgICAgICBhc3luYyBkZWYgd3JhcHBlcigqYXJnczogdHlwaW5nLkFueSwgKiprd2FyZ3M6IHR5cGluZy5BbnkpIC0+IHR5cGluZy5Bbnk6CiAgICAgICAgICAgIGFzeW5jIHdpdGggc2VsZjoKICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBmdW5jKCphcmdzLCAqKmt3YXJncykKCiAgICAgICAgcmV0dXJuIHdyYXBwZXIgICMgdHlwZTogaWdub3JlCgogICAgYXN5bmMgZGVmIHN0YXJ0KHNlbGYpIC0+ICJUcmFuc2FjdGlvbiI6CiAgICAgICAgc2VsZi5fY29ubmVjdGlvbiA9IHNlbGYuX2Nvbm5lY3Rpb25fY2FsbGFibGUoKQogICAgICAgIHNlbGYuX3RyYW5zYWN0aW9uID0gc2VsZi5fY29ubmVjdGlvbi5fY29ubmVjdGlvbi50cmFuc2FjdGlvbigpCgogICAgICAgIGFzeW5jIHdpdGggc2VsZi5fY29ubmVjdGlvbi5fdHJhbnNhY3Rpb25fbG9jazoKICAgICAgICAgICAgaXNfcm9vdCA9IG5vdCBzZWxmLl9jb25uZWN0aW9uLl90cmFuc2FjdGlvbl9zdGFjawogICAgICAgICAgICBhd2FpdCBzZWxmLl9jb25uZWN0aW9uLl9fYWVudGVyX18oKQogICAgICAgICAgICBhd2FpdCBzZWxmLl90cmFuc2FjdGlvbi5zdGFydCgKICAgICAgICAgICAgICAgIGlzX3Jvb3Q9aXNfcm9vdCwgZXh0cmFfb3B0aW9ucz1zZWxmLl9leHRyYV9vcHRpb25zCiAgICAgICAgICAgICkKICAgICAgICAgICAgc2VsZi5fY29ubmVjdGlvbi5fdHJhbnNhY3Rpb25fc3RhY2suYXBwZW5kKHNlbGYpCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBhc3luYyBkZWYgY29tbWl0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgYXN5bmMgd2l0aCBzZWxmLl9jb25uZWN0aW9uLl90cmFuc2FjdGlvbl9sb2NrOgogICAgICAgICAgICBhc3NlcnQgc2VsZi5fY29ubmVjdGlvbi5fdHJhbnNhY3Rpb25fc3RhY2tbLTFdIGlzIHNlbGYKICAgICAgICAgICAgc2VsZi5fY29ubmVjdGlvbi5fdHJhbnNhY3Rpb25fc3RhY2sucG9wKCkKICAgICAgICAgICAgYXdhaXQgc2VsZi5fdHJhbnNhY3Rpb24uY29tbWl0KCkKICAgICAgICAgICAgYXdhaXQgc2VsZi5fY29ubmVjdGlvbi5fX2FleGl0X18oKQoKICAgIGFzeW5jIGRlZiByb2xsYmFjayhzZWxmKSAtPiBOb25lOgogICAgICAgIGFzeW5jIHdpdGggc2VsZi5fY29ubmVjdGlvbi5fdHJhbnNhY3Rpb25fbG9jazoKICAgICAgICAgICAgYXNzZXJ0IHNlbGYuX2Nvbm5lY3Rpb24uX3RyYW5zYWN0aW9uX3N0YWNrWy0xXSBpcyBzZWxmCiAgICAgICAgICAgIHNlbGYuX2Nvbm5lY3Rpb24uX3RyYW5zYWN0aW9uX3N0YWNrLnBvcCgpCiAgICAgICAgICAgIGF3YWl0IHNlbGYuX3RyYW5zYWN0aW9uLnJvbGxiYWNrKCkKICAgICAgICAgICAgYXdhaXQgc2VsZi5fY29ubmVjdGlvbi5fX2FleGl0X18oKQoKCmNsYXNzIF9FbXB0eU5ldGxvYyhzdHIpOgogICAgZGVmIF9fYm9vbF9fKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgcmV0dXJuIFRydWUKCgpjbGFzcyBEYXRhYmFzZVVSTDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB1cmw6IHR5cGluZy5VbmlvbltzdHIsICJEYXRhYmFzZVVSTCJdKToKICAgICAgICBpZiBpc2luc3RhbmNlKHVybCwgRGF0YWJhc2VVUkwpOgogICAgICAgICAgICBzZWxmLl91cmw6IHN0ciA9IHVybC5fdXJsCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKHVybCwgc3RyKToKICAgICAgICAgICAgc2VsZi5fdXJsID0gdXJsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKAogICAgICAgICAgICAgICAgZiJJbnZhbGlkIHR5cGUgZm9yIERhdGFiYXNlVVJMLiBFeHBlY3RlZCBzdHIgb3IgRGF0YWJhc2VVUkwsIGdvdCB7dHlwZSh1cmwpfSIKICAgICAgICAgICAgKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNvbXBvbmVudHMoc2VsZikgLT4gU3BsaXRSZXN1bHQ6CiAgICAgICAgaWYgbm90IGhhc2F0dHIoc2VsZiwgIl9jb21wb25lbnRzIik6CiAgICAgICAgICAgIHNlbGYuX2NvbXBvbmVudHMgPSB1cmxzcGxpdChzZWxmLl91cmwpCiAgICAgICAgcmV0dXJuIHNlbGYuX2NvbXBvbmVudHMKCiAgICBAcHJvcGVydHkKICAgIGRlZiBzY2hlbWUoc2VsZikgLT4gc3RyOgogICAgICAgIHJldHVybiBzZWxmLmNvbXBvbmVudHMuc2NoZW1lCgogICAgQHByb3BlcnR5CiAgICBkZWYgZGlhbGVjdChzZWxmKSAtPiBzdHI6CiAgICAgICAgcmV0dXJuIHNlbGYuY29tcG9uZW50cy5zY2hlbWUuc3BsaXQoIisiKVswXQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGRyaXZlcihzZWxmKSAtPiBzdHI6CiAgICAgICAgaWYgIisiIG5vdCBpbiBzZWxmLmNvbXBvbmVudHMuc2NoZW1lOgogICAgICAgICAgICByZXR1cm4gIiIKICAgICAgICByZXR1cm4gc2VsZi5jb21wb25lbnRzLnNjaGVtZS5zcGxpdCgiKyIsIDEpWzFdCgogICAgQHByb3BlcnR5CiAgICBkZWYgdXNlcmluZm8oc2VsZikgLT4gdHlwaW5nLk9wdGlvbmFsW2J5dGVzXToKICAgICAgICBpZiBzZWxmLmNvbXBvbmVudHMudXNlcm5hbWU6CiAgICAgICAgICAgIGluZm8gPSBzZWxmLmNvbXBvbmVudHMudXNlcm5hbWUKICAgICAgICAgICAgaWYgc2VsZi5jb21wb25lbnRzLnBhc3N3b3JkOgogICAgICAgICAgICAgICAgaW5mbyArPSAiOiIgKyBzZWxmLmNvbXBvbmVudHMucGFzc3dvcmQKICAgICAgICAgICAgcmV0dXJuIGluZm8uZW5jb2RlKCJ1dGYtOCIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBAcHJvcGVydHkKICAgIGRlZiB1c2VybmFtZShzZWxmKSAtPiB0eXBpbmcuT3B0aW9uYWxbc3RyXToKICAgICAgICBpZiBzZWxmLmNvbXBvbmVudHMudXNlcm5hbWUgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICByZXR1cm4gdW5xdW90ZShzZWxmLmNvbXBvbmVudHMudXNlcm5hbWUpCgogICAgQHByb3BlcnR5CiAgICBkZWYgcGFzc3dvcmQoc2VsZikgLT4gdHlwaW5nLk9wdGlvbmFsW3N0cl06CiAgICAgICAgaWYgc2VsZi5jb21wb25lbnRzLnBhc3N3b3JkIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgcmV0dXJuIHVucXVvdGUoc2VsZi5jb21wb25lbnRzLnBhc3N3b3JkKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGhvc3RuYW1lKHNlbGYpIC0+IHR5cGluZy5PcHRpb25hbFtzdHJdOgogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIHNlbGYuY29tcG9uZW50cy5ob3N0bmFtZQogICAgICAgICAgICBvciBzZWxmLm9wdGlvbnMuZ2V0KCJob3N0IikKICAgICAgICAgICAgb3Igc2VsZi5vcHRpb25zLmdldCgidW5peF9zb2NrIikKICAgICAgICApCgogICAgQHByb3BlcnR5CiAgICBkZWYgcG9ydChzZWxmKSAtPiB0eXBpbmcuT3B0aW9uYWxbaW50XToKICAgICAgICByZXR1cm4gc2VsZi5jb21wb25lbnRzLnBvcnQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBuZXRsb2Moc2VsZikgLT4gdHlwaW5nLk9wdGlvbmFsW3N0cl06CiAgICAgICAgcmV0dXJuIHNlbGYuY29tcG9uZW50cy5uZXRsb2MKCiAgICBAcHJvcGVydHkKICAgIGRlZiBkYXRhYmFzZShzZWxmKSAtPiBzdHI6CiAgICAgICAgcGF0aCA9IHNlbGYuY29tcG9uZW50cy5wYXRoCiAgICAgICAgaWYgcGF0aC5zdGFydHN3aXRoKCIvIik6CiAgICAgICAgICAgIHBhdGggPSBwYXRoWzE6XQogICAgICAgIHJldHVybiB1bnF1b3RlKHBhdGgpCgogICAgQHByb3BlcnR5CiAgICBkZWYgb3B0aW9ucyhzZWxmKSAtPiBkaWN0OgogICAgICAgIGlmIG5vdCBoYXNhdHRyKHNlbGYsICJfb3B0aW9ucyIpOgogICAgICAgICAgICBzZWxmLl9vcHRpb25zID0gZGljdChwYXJzZV9xc2woc2VsZi5jb21wb25lbnRzLnF1ZXJ5KSkKICAgICAgICByZXR1cm4gc2VsZi5fb3B0aW9ucwoKICAgIGRlZiByZXBsYWNlKHNlbGYsICoqa3dhcmdzOiB0eXBpbmcuQW55KSAtPiAiRGF0YWJhc2VVUkwiOgogICAgICAgIGlmICgKICAgICAgICAgICAgInVzZXJuYW1lIiBpbiBrd2FyZ3MKICAgICAgICAgICAgb3IgInBhc3N3b3JkIiBpbiBrd2FyZ3MKICAgICAgICAgICAgb3IgImhvc3RuYW1lIiBpbiBrd2FyZ3MKICAgICAgICAgICAgb3IgInBvcnQiIGluIGt3YXJncwogICAgICAgICk6CiAgICAgICAgICAgIGhvc3RuYW1lID0ga3dhcmdzLnBvcCgiaG9zdG5hbWUiLCBzZWxmLmhvc3RuYW1lKQogICAgICAgICAgICBwb3J0ID0ga3dhcmdzLnBvcCgicG9ydCIsIHNlbGYucG9ydCkKICAgICAgICAgICAgdXNlcm5hbWUgPSBrd2FyZ3MucG9wKCJ1c2VybmFtZSIsIHNlbGYuY29tcG9uZW50cy51c2VybmFtZSkKICAgICAgICAgICAgcGFzc3dvcmQgPSBrd2FyZ3MucG9wKCJwYXNzd29yZCIsIHNlbGYuY29tcG9uZW50cy5wYXNzd29yZCkKCiAgICAgICAgICAgIG5ldGxvYyA9IGhvc3RuYW1lCiAgICAgICAgICAgIGlmIHBvcnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBuZXRsb2MgKz0gZiI6e3BvcnR9IgogICAgICAgICAgICBpZiB1c2VybmFtZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHVzZXJwYXNzID0gdXNlcm5hbWUKICAgICAgICAgICAgICAgIGlmIHBhc3N3b3JkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHVzZXJwYXNzICs9IGYiOntwYXNzd29yZH0iCiAgICAgICAgICAgICAgICBuZXRsb2MgPSBmInt1c2VycGFzc31Ae25ldGxvY30iCgogICAgICAgICAgICBrd2FyZ3NbIm5ldGxvYyJdID0gbmV0bG9jCgogICAgICAgIGlmICJkYXRhYmFzZSIgaW4ga3dhcmdzOgogICAgICAgICAgICBrd2FyZ3NbInBhdGgiXSA9ICIvIiArIGt3YXJncy5wb3AoImRhdGFiYXNlIikKCiAgICAgICAgaWYgImRpYWxlY3QiIGluIGt3YXJncyBvciAiZHJpdmVyIiBpbiBrd2FyZ3M6CiAgICAgICAgICAgIGRpYWxlY3QgPSBrd2FyZ3MucG9wKCJkaWFsZWN0Iiwgc2VsZi5kaWFsZWN0KQogICAgICAgICAgICBkcml2ZXIgPSBrd2FyZ3MucG9wKCJkcml2ZXIiLCBzZWxmLmRyaXZlcikKICAgICAgICAgICAga3dhcmdzWyJzY2hlbWUiXSA9IGYie2RpYWxlY3R9K3tkcml2ZXJ9IiBpZiBkcml2ZXIgZWxzZSBkaWFsZWN0CgogICAgICAgIGlmIG5vdCBrd2FyZ3MuZ2V0KCJuZXRsb2MiLCBzZWxmLm5ldGxvYyk6CiAgICAgICAgICAgICMgVXNpbmcgYW4gZW1wdHkgc3RyaW5nIHRoYXQgZXZhbHVhdGVzIGFzIFRydWUgbWVhbnMgd2UgZW5kIHVwCiAgICAgICAgICAgICMgd2l0aCBVUkxzIGxpa2UgYHNxbGl0ZTovLy9kYXRhYmFzZWAgaW5zdGVhZCBvZiBgc3FsaXRlOi9kYXRhYmFzZWAKICAgICAgICAgICAga3dhcmdzWyJuZXRsb2MiXSA9IF9FbXB0eU5ldGxvYygpCgogICAgICAgIGNvbXBvbmVudHMgPSBzZWxmLmNvbXBvbmVudHMuX3JlcGxhY2UoKiprd2FyZ3MpCiAgICAgICAgcmV0dXJuIHNlbGYuX19jbGFzc19fKGNvbXBvbmVudHMuZ2V0dXJsKCkpCgogICAgQHByb3BlcnR5CiAgICBkZWYgb2JzY3VyZV9wYXNzd29yZChzZWxmKSAtPiBzdHI6CiAgICAgICAgaWYgc2VsZi5wYXNzd29yZDoKICAgICAgICAgICAgcmV0dXJuIHNlbGYucmVwbGFjZShwYXNzd29yZD0iKioqKioqKioiKS5fdXJsCiAgICAgICAgcmV0dXJuIHNlbGYuX3VybAoKICAgIGRlZiBfX3N0cl9fKHNlbGYpIC0+IHN0cjoKICAgICAgICByZXR1cm4gc2VsZi5fdXJsCgogICAgZGVmIF9fcmVwcl9fKHNlbGYpIC0+IHN0cjoKICAgICAgICByZXR1cm4gZiJ7c2VsZi5fX2NsYXNzX18uX19uYW1lX199KHtyZXByKHNlbGYub2JzY3VyZV9wYXNzd29yZCl9KSIKCiAgICBkZWYgX19lcV9fKHNlbGYsIG90aGVyOiB0eXBpbmcuQW55KSAtPiBib29sOgogICAgICAgIHJldHVybiBzdHIoc2VsZikgPT0gc3RyKG90aGVyKQo=
