statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/clidriver.py
  contents:
  - name: ServiceCommand.lineage
    score: 0.0
    code: |-
      @property
          def lineage(self):
              return self._lineage
    tokens: resume load_fast self load_attr _lineage return_value
    hash: 81e66d0d995f32549e4a0b6a40c6ca19213b26a8e8fed940b4183d1f42221077
sources:
  .repo_cache/malicious_repos/pypi_malregistry/awscl/1.27.67/awscl-1.27.67/awscl-1.27.67/awscli/clidriver.py: IyBDb3B5cmlnaHQgMjAxMi0yMDEzIEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKS4gWW91CiMgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZgojIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXQKIwojICAgICBodHRwOi8vYXdzLmFtYXpvbi5jb20vYXBhY2hlMi4wLwojCiMgb3IgaW4gdGhlICJsaWNlbnNlIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcwojIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GCiMgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljCiMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KaW1wb3J0IHN5cwppbXBvcnQgc2lnbmFsCmltcG9ydCBsb2dnaW5nCgppbXBvcnQgYm90b2NvcmUuc2Vzc2lvbgpmcm9tIGJvdG9jb3JlIGltcG9ydCBfX3ZlcnNpb25fXyBhcyBib3RvY29yZV92ZXJzaW9uCmZyb20gYm90b2NvcmUuaG9va3MgaW1wb3J0IEhpZXJhcmNoaWNhbEVtaXR0ZXIKZnJvbSBib3RvY29yZSBpbXBvcnQgeGZvcm1fbmFtZQpmcm9tIGJvdG9jb3JlLmNvbXBhdCBpbXBvcnQgY29weV9rd2FyZ3MsIE9yZGVyZWREaWN0CmZyb20gYm90b2NvcmUuZXhjZXB0aW9ucyBpbXBvcnQgTm9DcmVkZW50aWFsc0Vycm9yCmZyb20gYm90b2NvcmUuZXhjZXB0aW9ucyBpbXBvcnQgTm9SZWdpb25FcnJvcgpmcm9tIGJvdG9jb3JlLmV4Y2VwdGlvbnMgaW1wb3J0IFByb2ZpbGVOb3RGb3VuZApmcm9tIGJvdG9jb3JlLmhpc3RvcnkgaW1wb3J0IGdldF9nbG9iYWxfaGlzdG9yeV9yZWNvcmRlcgoKZnJvbSBhd3NjbGkgaW1wb3J0IEVudmlyb25tZW50VmFyaWFibGVzLCBfX3ZlcnNpb25fXwpmcm9tIGF3c2NsaS5jb21wYXQgaW1wb3J0IGdldF9zdGRlcnJfdGV4dF93cml0ZXIKZnJvbSBhd3NjbGkuZm9ybWF0dGVyIGltcG9ydCBnZXRfZm9ybWF0dGVyCmZyb20gYXdzY2xpLnBsdWdpbiBpbXBvcnQgbG9hZF9wbHVnaW5zCmZyb20gYXdzY2xpLmNvbW1hbmRzIGltcG9ydCBDTElDb21tYW5kCmZyb20gYXdzY2xpLmNvbXBhdCBpbXBvcnQgc2l4CmZyb20gYXdzY2xpLmFyZ3BhcnNlciBpbXBvcnQgTWFpbkFyZ1BhcnNlcgpmcm9tIGF3c2NsaS5hcmdwYXJzZXIgaW1wb3J0IFNlcnZpY2VBcmdQYXJzZXIKZnJvbSBhd3NjbGkuYXJncGFyc2VyIGltcG9ydCBBcmdUYWJsZUFyZ1BhcnNlcgpmcm9tIGF3c2NsaS5hcmdwYXJzZXIgaW1wb3J0IFVTQUdFCmZyb20gYXdzY2xpLmhlbHAgaW1wb3J0IFByb3ZpZGVySGVscENvbW1hbmQKZnJvbSBhd3NjbGkuaGVscCBpbXBvcnQgU2VydmljZUhlbHBDb21tYW5kCmZyb20gYXdzY2xpLmhlbHAgaW1wb3J0IE9wZXJhdGlvbkhlbHBDb21tYW5kCmZyb20gYXdzY2xpLmFyZ3VtZW50cyBpbXBvcnQgQ3VzdG9tQXJndW1lbnQKZnJvbSBhd3NjbGkuYXJndW1lbnRzIGltcG9ydCBMaXN0QXJndW1lbnQKZnJvbSBhd3NjbGkuYXJndW1lbnRzIGltcG9ydCBCb29sZWFuQXJndW1lbnQKZnJvbSBhd3NjbGkuYXJndW1lbnRzIGltcG9ydCBDTElBcmd1bWVudApmcm9tIGF3c2NsaS5hcmd1bWVudHMgaW1wb3J0IFVua25vd25Bcmd1bWVudEVycm9yCmZyb20gYXdzY2xpLmFyZ3Byb2Nlc3MgaW1wb3J0IHVucGFja19hcmd1bWVudApmcm9tIGF3c2NsaS5hbGlhcyBpbXBvcnQgQWxpYXNMb2FkZXIKZnJvbSBhd3NjbGkuYWxpYXMgaW1wb3J0IEFsaWFzQ29tbWFuZEluamVjdG9yCmZyb20gYXdzY2xpLnV0aWxzIGltcG9ydCBlbWl0X3RvcF9sZXZlbF9hcmdzX3BhcnNlZF9ldmVudApmcm9tIGF3c2NsaS51dGlscyBpbXBvcnQgd3JpdGVfZXhjZXB0aW9uCgoKTE9HID0gbG9nZ2luZy5nZXRMb2dnZXIoJ2F3c2NsaS5jbGlkcml2ZXInKQpMT0dfRk9STUFUID0gKAogICAgJyUoYXNjdGltZSlzIC0gJSh0aHJlYWROYW1lKXMgLSAlKG5hbWUpcyAtICUobGV2ZWxuYW1lKXMgLSAlKG1lc3NhZ2UpcycpCkhJU1RPUllfUkVDT1JERVIgPSBnZXRfZ2xvYmFsX2hpc3RvcnlfcmVjb3JkZXIoKQojIERvbid0IHJlbW92ZSB0aGlzIGxpbmUuICBUaGUgaWRuYSBlbmNvZGluZwojIGlzIHVzZWQgYnkgZ2V0YWRkcmluZm8gd2hlbiBkZWFsaW5nIHdpdGggdW5pY29kZSBob3N0bmFtZXMsCiMgYW5kIGluIHNvbWUgY2FzZXMsIHRoZXJlIGFwcGVhcnMgdG8gYmUgYSByYWNlIGNvbmRpdGlvbgojIHdoZXJlIHRocmVhZHMgd2lsbCBnZXQgYSBMb29rdXBFcnJvciBvbiBnZXRhZGRyaW5mbygpIHNheWluZwojIHRoYXQgdGhlIGVuY29kaW5nIGRvZXNuJ3QgZXhpc3QuICBVc2luZyB0aGUgaWRuYSBlbmNvZGluZyBiZWZvcmUKIyBydW5uaW5nIGFueSBDTEkgY29kZSAoYW5kIGFueSB0aHJlYWRzIGl0IG1heSBjcmVhdGUpIGVuc3VyZXMgdGhhdAojIHRoZSBlbmNvZGluZ3MuaWRuYSBpcyBpbXBvcnRlZCBhbmQgcmVnaXN0ZXJlZCBpbiB0aGUgY29kZWNzIHJlZ2lzdHJ5LAojIHdoaWNoIHdpbGwgc3RvcCB0aGUgTG9va3VwRXJyb3JzIGZyb20gaGFwcGVuaW5nLgojIFNlZTogaHR0cHM6Ly9idWdzLnB5dGhvbi5vcmcvaXNzdWUyOTI4OAp1JycuZW5jb2RlKCdpZG5hJykKCgpkZWYgbWFpbigpOgogICAgZHJpdmVyID0gY3JlYXRlX2NsaWRyaXZlcigpCiAgICByYyA9IGRyaXZlci5tYWluKCkKICAgIEhJU1RPUllfUkVDT1JERVIucmVjb3JkKCdDTElfUkMnLCByYywgJ0NMSScpCiAgICByZXR1cm4gcmMKCgpkZWYgY3JlYXRlX2NsaWRyaXZlcigpOgogICAgc2Vzc2lvbiA9IGJvdG9jb3JlLnNlc3Npb24uU2Vzc2lvbihFbnZpcm9ubWVudFZhcmlhYmxlcykKICAgIF9zZXRfdXNlcl9hZ2VudF9mb3Jfc2Vzc2lvbihzZXNzaW9uKQogICAgbG9hZF9wbHVnaW5zKHNlc3Npb24uZnVsbF9jb25maWcuZ2V0KCdwbHVnaW5zJywge30pLAogICAgICAgICAgICAgICAgIGV2ZW50X2hvb2tzPXNlc3Npb24uZ2V0X2NvbXBvbmVudCgnZXZlbnRfZW1pdHRlcicpKQogICAgZHJpdmVyID0gQ0xJRHJpdmVyKHNlc3Npb249c2Vzc2lvbikKICAgIHJldHVybiBkcml2ZXIKCgpkZWYgX3NldF91c2VyX2FnZW50X2Zvcl9zZXNzaW9uKHNlc3Npb24pOgogICAgc2Vzc2lvbi51c2VyX2FnZW50X25hbWUgPSAnYXdzLWNsaScKICAgIHNlc3Npb24udXNlcl9hZ2VudF92ZXJzaW9uID0gX192ZXJzaW9uX18KICAgIHNlc3Npb24udXNlcl9hZ2VudF9leHRyYSA9ICdib3RvY29yZS8lcycgJSBib3RvY29yZV92ZXJzaW9uCgoKY2xhc3MgQ0xJRHJpdmVyKG9iamVjdCk6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNlc3Npb249Tm9uZSk6CiAgICAgICAgaWYgc2Vzc2lvbiBpcyBOb25lOgogICAgICAgICAgICBzZWxmLnNlc3Npb24gPSBib3RvY29yZS5zZXNzaW9uLmdldF9zZXNzaW9uKEVudmlyb25tZW50VmFyaWFibGVzKQogICAgICAgICAgICBfc2V0X3VzZXJfYWdlbnRfZm9yX3Nlc3Npb24oc2VsZi5zZXNzaW9uKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuc2Vzc2lvbiA9IHNlc3Npb24KICAgICAgICBzZWxmLl9jbGlfZGF0YSA9IE5vbmUKICAgICAgICBzZWxmLl9jb21tYW5kX3RhYmxlID0gTm9uZQogICAgICAgIHNlbGYuX2FyZ3VtZW50X3RhYmxlID0gTm9uZQogICAgICAgIHNlbGYuYWxpYXNfbG9hZGVyID0gQWxpYXNMb2FkZXIoKQoKICAgIGRlZiBfZ2V0X2NsaV9kYXRhKHNlbGYpOgogICAgICAgICMgTm90IGNyYXp5IGFib3V0IHRoaXMgYnV0IHRoZSBkYXRhIGluIGhlcmUgaXMgbmVlZGVkIGluCiAgICAgICAgIyBzZXZlcmFsIHBsYWNlcyAoZS5nLiBNYWluQXJnUGFyc2VyLCBQcm92aWRlckhlbHApIHNvCiAgICAgICAgIyB3ZSBsb2FkIGl0IGhlcmUgb25jZS4KICAgICAgICBpZiBzZWxmLl9jbGlfZGF0YSBpcyBOb25lOgogICAgICAgICAgICBzZWxmLl9jbGlfZGF0YSA9IHNlbGYuc2Vzc2lvbi5nZXRfZGF0YSgnY2xpJykKICAgICAgICByZXR1cm4gc2VsZi5fY2xpX2RhdGEKCiAgICBkZWYgX2dldF9jb21tYW5kX3RhYmxlKHNlbGYpOgogICAgICAgIGlmIHNlbGYuX2NvbW1hbmRfdGFibGUgaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5fY29tbWFuZF90YWJsZSA9IHNlbGYuX2J1aWxkX2NvbW1hbmRfdGFibGUoKQogICAgICAgIHJldHVybiBzZWxmLl9jb21tYW5kX3RhYmxlCgogICAgZGVmIF9nZXRfYXJndW1lbnRfdGFibGUoc2VsZik6CiAgICAgICAgaWYgc2VsZi5fYXJndW1lbnRfdGFibGUgaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5fYXJndW1lbnRfdGFibGUgPSBzZWxmLl9idWlsZF9hcmd1bWVudF90YWJsZSgpCiAgICAgICAgcmV0dXJuIHNlbGYuX2FyZ3VtZW50X3RhYmxlCgogICAgZGVmIF9idWlsZF9jb21tYW5kX3RhYmxlKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIENyZWF0ZSB0aGUgbWFpbiBwYXJzZXIgdG8gaGFuZGxlIHRoZSBnbG9iYWwgYXJndW1lbnRzLgoKICAgICAgICA6cnR5cGU6IGBgYXJncGFyc2VyLkFyZ3VtZW50UGFyc2VyYGAKICAgICAgICA6cmV0dXJuOiBUaGUgcGFyc2VyIG9iamVjdAoKICAgICAgICAiIiIKICAgICAgICBjb21tYW5kX3RhYmxlID0gc2VsZi5fYnVpbGRfYnVpbHRpbl9jb21tYW5kcyhzZWxmLnNlc3Npb24pCiAgICAgICAgc2VsZi5zZXNzaW9uLmVtaXQoJ2J1aWxkaW5nLWNvbW1hbmQtdGFibGUubWFpbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZF90YWJsZT1jb21tYW5kX3RhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb249c2VsZi5zZXNzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRfb2JqZWN0PXNlbGYpCiAgICAgICAgcmV0dXJuIGNvbW1hbmRfdGFibGUKCiAgICBkZWYgX2J1aWxkX2J1aWx0aW5fY29tbWFuZHMoc2VsZiwgc2Vzc2lvbik6CiAgICAgICAgY29tbWFuZHMgPSBPcmRlcmVkRGljdCgpCiAgICAgICAgc2VydmljZXMgPSBzZXNzaW9uLmdldF9hdmFpbGFibGVfc2VydmljZXMoKQogICAgICAgIGZvciBzZXJ2aWNlX25hbWUgaW4gc2VydmljZXM6CiAgICAgICAgICAgIGNvbW1hbmRzW3NlcnZpY2VfbmFtZV0gPSBTZXJ2aWNlQ29tbWFuZChjbGlfbmFtZT1zZXJ2aWNlX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uPXNlbGYuc2Vzc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VfbmFtZT1zZXJ2aWNlX25hbWUpCiAgICAgICAgcmV0dXJuIGNvbW1hbmRzCgogICAgZGVmIF9hZGRfYWxpYXNlcyhzZWxmLCBjb21tYW5kX3RhYmxlLCBwYXJzZXIpOgogICAgICAgIGluamVjdG9yID0gQWxpYXNDb21tYW5kSW5qZWN0b3IoCiAgICAgICAgICAgIHNlbGYuc2Vzc2lvbiwgc2VsZi5hbGlhc19sb2FkZXIpCiAgICAgICAgaW5qZWN0b3IuaW5qZWN0X2FsaWFzZXMoY29tbWFuZF90YWJsZSwgcGFyc2VyKQoKICAgIGRlZiBfYnVpbGRfYXJndW1lbnRfdGFibGUoc2VsZik6CiAgICAgICAgYXJndW1lbnRfdGFibGUgPSBPcmRlcmVkRGljdCgpCiAgICAgICAgY2xpX2RhdGEgPSBzZWxmLl9nZXRfY2xpX2RhdGEoKQogICAgICAgIGNsaV9hcmd1bWVudHMgPSBjbGlfZGF0YS5nZXQoJ29wdGlvbnMnLCBOb25lKQogICAgICAgIGZvciBvcHRpb24gaW4gY2xpX2FyZ3VtZW50czoKICAgICAgICAgICAgb3B0aW9uX3BhcmFtcyA9IGNvcHlfa3dhcmdzKGNsaV9hcmd1bWVudHNbb3B0aW9uXSkKICAgICAgICAgICAgY2xpX2FyZ3VtZW50ID0gc2VsZi5fY3JlYXRlX2NsaV9hcmd1bWVudChvcHRpb24sIG9wdGlvbl9wYXJhbXMpCiAgICAgICAgICAgIGNsaV9hcmd1bWVudC5hZGRfdG9fYXJnX3RhYmxlKGFyZ3VtZW50X3RhYmxlKQogICAgICAgICMgVGhlbiB0aGUgZmluYWwgc3RlcCBpcyB0byBzZW5kIG91dCBhbiBldmVudCBzbyBoYW5kbGVycwogICAgICAgICMgY2FuIGFkZCBleHRyYSBhcmd1bWVudHMgb3IgbW9kaWZ5IGV4aXN0aW5nIGFyZ3VtZW50cy4KICAgICAgICBzZWxmLnNlc3Npb24uZW1pdCgnYnVpbGRpbmctdG9wLWxldmVsLXBhcmFtcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRfdGFibGU9YXJndW1lbnRfdGFibGUpCiAgICAgICAgcmV0dXJuIGFyZ3VtZW50X3RhYmxlCgogICAgZGVmIF9jcmVhdGVfY2xpX2FyZ3VtZW50KHNlbGYsIG9wdGlvbl9uYW1lLCBvcHRpb25fcGFyYW1zKToKICAgICAgICByZXR1cm4gQ3VzdG9tQXJndW1lbnQoCiAgICAgICAgICAgIG9wdGlvbl9uYW1lLCBoZWxwX3RleHQ9b3B0aW9uX3BhcmFtcy5nZXQoJ2hlbHAnLCAnJyksCiAgICAgICAgICAgIGRlc3Q9b3B0aW9uX3BhcmFtcy5nZXQoJ2Rlc3QnKSwKICAgICAgICAgICAgZGVmYXVsdD1vcHRpb25fcGFyYW1zLmdldCgnZGVmYXVsdCcpLAogICAgICAgICAgICBhY3Rpb249b3B0aW9uX3BhcmFtcy5nZXQoJ2FjdGlvbicpLAogICAgICAgICAgICByZXF1aXJlZD1vcHRpb25fcGFyYW1zLmdldCgncmVxdWlyZWQnKSwKICAgICAgICAgICAgY2hvaWNlcz1vcHRpb25fcGFyYW1zLmdldCgnY2hvaWNlcycpLAogICAgICAgICAgICBjbGlfdHlwZV9uYW1lPW9wdGlvbl9wYXJhbXMuZ2V0KCd0eXBlJykpCgogICAgZGVmIGNyZWF0ZV9oZWxwX2NvbW1hbmQoc2VsZik6CiAgICAgICAgY2xpX2RhdGEgPSBzZWxmLl9nZXRfY2xpX2RhdGEoKQogICAgICAgIHJldHVybiBQcm92aWRlckhlbHBDb21tYW5kKHNlbGYuc2Vzc2lvbiwgc2VsZi5fZ2V0X2NvbW1hbmRfdGFibGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9nZXRfYXJndW1lbnRfdGFibGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlfZGF0YS5nZXQoJ2Rlc2NyaXB0aW9uJywgTm9uZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpX2RhdGEuZ2V0KCdzeW5vcHNpcycsIE5vbmUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaV9kYXRhLmdldCgnaGVscF91c2FnZScsIE5vbmUpKQoKICAgIGRlZiBfY3JlYXRlX3BhcnNlcihzZWxmLCBjb21tYW5kX3RhYmxlKToKICAgICAgICAjIEFsc28gYWRkIGEgJ2hlbHAnIGNvbW1hbmQuCiAgICAgICAgY29tbWFuZF90YWJsZVsnaGVscCddID0gc2VsZi5jcmVhdGVfaGVscF9jb21tYW5kKCkKICAgICAgICBjbGlfZGF0YSA9IHNlbGYuX2dldF9jbGlfZGF0YSgpCiAgICAgICAgcGFyc2VyID0gTWFpbkFyZ1BhcnNlcigKICAgICAgICAgICAgY29tbWFuZF90YWJsZSwgc2VsZi5zZXNzaW9uLnVzZXJfYWdlbnQoKSwKICAgICAgICAgICAgY2xpX2RhdGEuZ2V0KCdkZXNjcmlwdGlvbicsIE5vbmUpLAogICAgICAgICAgICBzZWxmLl9nZXRfYXJndW1lbnRfdGFibGUoKSwKICAgICAgICAgICAgcHJvZz0iYXdzIikKICAgICAgICByZXR1cm4gcGFyc2VyCgogICAgZGVmIG1haW4oc2VsZiwgYXJncz1Ob25lKToKICAgICAgICAiIiIKCiAgICAgICAgOnBhcmFtIGFyZ3M6IExpc3Qgb2YgYXJndW1lbnRzLCB3aXRoIHRoZSAnYXdzJyByZW1vdmVkLiAgRm9yIGV4YW1wbGUsCiAgICAgICAgICAgIHRoZSBjb21tYW5kICJhd3MgczMgbGlzdC1vYmplY3RzIC0tYnVja2V0IGZvbyIgd2lsbCBoYXZlIGFuCiAgICAgICAgICAgIGFyZ3MgbGlzdCBvZiBgYFsnczMnLCAnbGlzdC1vYmplY3RzJywgJy0tYnVja2V0JywgJ2ZvbyddYGAuCgogICAgICAgICIiIgogICAgICAgIGlmIGFyZ3MgaXMgTm9uZToKICAgICAgICAgICAgYXJncyA9IHN5cy5hcmd2WzE6XQogICAgICAgIGNvbW1hbmRfdGFibGUgPSBzZWxmLl9nZXRfY29tbWFuZF90YWJsZSgpCiAgICAgICAgcGFyc2VyID0gc2VsZi5fY3JlYXRlX3BhcnNlcihjb21tYW5kX3RhYmxlKQogICAgICAgIHNlbGYuX2FkZF9hbGlhc2VzKGNvbW1hbmRfdGFibGUsIHBhcnNlcikKICAgICAgICBwYXJzZWRfYXJncywgcmVtYWluaW5nID0gcGFyc2VyLnBhcnNlX2tub3duX2FyZ3MoYXJncykKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQmVjYXVzZSBfaGFuZGxlX3RvcF9sZXZlbF9hcmdzIGVtaXRzIGV2ZW50cywgaXQncyBwb3NzaWJsZQogICAgICAgICAgICAjIHRoYXQgZXhjZXB0aW9ucyBjYW4gYmUgcmFpc2VkLCB3aGljaCBzaG91bGQgaGF2ZSB0aGUgc2FtZQogICAgICAgICAgICAjIGdlbmVyYWwgZXhjZXB0aW9uIGhhbmRsaW5nIGxvZ2ljIGFzIGNhbGxpbmcgaW50byB0aGUKICAgICAgICAgICAgIyBjb21tYW5kIHRhYmxlLiAgVGhpcyBpcyB3aHkgaXQncyBpbiB0aGUgdHJ5L2V4Y2VwdCBjbGF1c2UuCiAgICAgICAgICAgIHNlbGYuX2hhbmRsZV90b3BfbGV2ZWxfYXJncyhwYXJzZWRfYXJncykKICAgICAgICAgICAgc2VsZi5fZW1pdF9zZXNzaW9uX2V2ZW50KHBhcnNlZF9hcmdzKQogICAgICAgICAgICBISVNUT1JZX1JFQ09SREVSLnJlY29yZCgKICAgICAgICAgICAgICAgICdDTElfVkVSU0lPTicsIHNlbGYuc2Vzc2lvbi51c2VyX2FnZW50KCksICdDTEknKQogICAgICAgICAgICBISVNUT1JZX1JFQ09SREVSLnJlY29yZCgnQ0xJX0FSR1VNRU5UUycsIGFyZ3MsICdDTEknKQogICAgICAgICAgICByZXR1cm4gY29tbWFuZF90YWJsZVtwYXJzZWRfYXJncy5jb21tYW5kXShyZW1haW5pbmcsIHBhcnNlZF9hcmdzKQogICAgICAgIGV4Y2VwdCBVbmtub3duQXJndW1lbnRFcnJvciBhcyBlOgogICAgICAgICAgICBzeXMuc3RkZXJyLndyaXRlKCJ1c2FnZTogJXNcbiIgJSBVU0FHRSkKICAgICAgICAgICAgc3lzLnN0ZGVyci53cml0ZShzdHIoZSkpCiAgICAgICAgICAgIHN5cy5zdGRlcnIud3JpdGUoIlxuIikKICAgICAgICAgICAgcmV0dXJuIDI1NQogICAgICAgIGV4Y2VwdCBOb1JlZ2lvbkVycm9yIGFzIGU6CiAgICAgICAgICAgIG1zZyA9ICgnJXMgWW91IGNhbiBhbHNvIGNvbmZpZ3VyZSB5b3VyIHJlZ2lvbiBieSBydW5uaW5nICcKICAgICAgICAgICAgICAgICAgICciYXdzIGNvbmZpZ3VyZSIuJyAlIGUpCiAgICAgICAgICAgIHNlbGYuX3Nob3dfZXJyb3IobXNnKQogICAgICAgICAgICByZXR1cm4gMjU1CiAgICAgICAgZXhjZXB0IE5vQ3JlZGVudGlhbHNFcnJvciBhcyBlOgogICAgICAgICAgICBtc2cgPSAoJyVzLiBZb3UgY2FuIGNvbmZpZ3VyZSBjcmVkZW50aWFscyBieSBydW5uaW5nICcKICAgICAgICAgICAgICAgICAgICciYXdzIGNvbmZpZ3VyZSIuJyAlIGUpCiAgICAgICAgICAgIHNlbGYuX3Nob3dfZXJyb3IobXNnKQogICAgICAgICAgICByZXR1cm4gMjU1CiAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgICAgICAjIFNoZWxsIHN0YW5kYXJkIGZvciBzaWduYWxzIHRoYXQgdGVybWluYXRlCiAgICAgICAgICAgICMgdGhlIHByb2Nlc3MgaXMgdG8gcmV0dXJuIDEyOCArIHNpZ251bSwgaW4gdGhpcyBjYXNlCiAgICAgICAgICAgICMgU0lHSU5UPTIsIHNvIHdlJ2xsIGhhdmUgYW4gUkMgb2YgMTMwLgogICAgICAgICAgICBzeXMuc3Rkb3V0LndyaXRlKCJcbiIpCiAgICAgICAgICAgIHJldHVybiAxMjggKyBzaWduYWwuU0lHSU5UCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBMT0cuZGVidWcoIkV4Y2VwdGlvbiBjYXVnaHQgaW4gbWFpbigpIiwgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgTE9HLmRlYnVnKCJFeGl0aW5nIHdpdGggcmMgMjU1IikKICAgICAgICAgICAgd3JpdGVfZXhjZXB0aW9uKGUsIG91dGZpbGU9Z2V0X3N0ZGVycl90ZXh0X3dyaXRlcigpKQogICAgICAgICAgICByZXR1cm4gMjU1CgogICAgZGVmIF9lbWl0X3Nlc3Npb25fZXZlbnQoc2VsZiwgcGFyc2VkX2FyZ3MpOgogICAgICAgICMgVGhpcyBldmVudCBpcyBndWFyYW50ZWVkIHRvIHJ1biBhZnRlciB0aGUgc2Vzc2lvbiBoYXMgYmVlbgogICAgICAgICMgaW5pdGlhbGl6ZWQgYW5kIGEgcHJvZmlsZSBoYXMgYmVlbiBzZXQuICBUaGlzIHdhcyBwcmV2aW91c2x5CiAgICAgICAgIyBwcm9ibGVtYXRpYyBiZWNhdXNlIGlmIHNvbWV0aGluZyBpbiBDTElEcml2ZXIgY2F1c2VkIHRoZQogICAgICAgICMgc2Vzc2lvbiBjb21wb25lbnRzIHRvIGJlIHJlc2V0IChzdWNoIGFzIHNlc3Npb24ucHJvZmlsZSA9IGZvbykKICAgICAgICAjIHRoZW4gYWxsIHRoZSBwcmlvciByZWdpc3RlcmVkIGNvbXBvbmVudHMgd291bGQgYmUgcmVtb3ZlZC4KICAgICAgICBzZWxmLnNlc3Npb24uZW1pdCgKICAgICAgICAgICAgJ3Nlc3Npb24taW5pdGlhbGl6ZWQnLCBzZXNzaW9uPXNlbGYuc2Vzc2lvbiwKICAgICAgICAgICAgcGFyc2VkX2FyZ3M9cGFyc2VkX2FyZ3MpCgogICAgZGVmIF9zaG93X2Vycm9yKHNlbGYsIG1zZyk6CiAgICAgICAgTE9HLmRlYnVnKG1zZywgZXhjX2luZm89VHJ1ZSkKICAgICAgICBzeXMuc3RkZXJyLndyaXRlKG1zZykKICAgICAgICBzeXMuc3RkZXJyLndyaXRlKCdcbicpCgogICAgZGVmIF9oYW5kbGVfdG9wX2xldmVsX2FyZ3Moc2VsZiwgYXJncyk6CiAgICAgICAgZW1pdF90b3BfbGV2ZWxfYXJnc19wYXJzZWRfZXZlbnQoc2VsZi5zZXNzaW9uLCBhcmdzKQogICAgICAgIGlmIGFyZ3MucHJvZmlsZToKICAgICAgICAgICAgc2VsZi5zZXNzaW9uLnNldF9jb25maWdfdmFyaWFibGUoJ3Byb2ZpbGUnLCBhcmdzLnByb2ZpbGUpCiAgICAgICAgaWYgYXJncy5yZWdpb246CiAgICAgICAgICAgIHNlbGYuc2Vzc2lvbi5zZXRfY29uZmlnX3ZhcmlhYmxlKCdyZWdpb24nLCBhcmdzLnJlZ2lvbikKICAgICAgICBpZiBhcmdzLmRlYnVnOgogICAgICAgICAgICAjIFRPRE86CiAgICAgICAgICAgICMgVW5mb3J0dW5hdGVseSwgYnkgc2V0dGluZyBkZWJ1ZyBtb2RlIGhlcmUsIHdlIG1pc3Mgb3V0CiAgICAgICAgICAgICMgb24gYWxsIG9mIHRoZSBkZWJ1ZyBldmVudHMgcHJpb3IgdG8gdGhpcyBzdWNoIGFzIHRoZQogICAgICAgICAgICAjIGxvYWRpbmcgb2YgcGx1Z2lucywgZXRjLgogICAgICAgICAgICBzZWxmLnNlc3Npb24uc2V0X3N0cmVhbV9sb2dnZXIoJ2JvdG9jb3JlJywgbG9nZ2luZy5ERUJVRywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdF9zdHJpbmc9TE9HX0ZPUk1BVCkKICAgICAgICAgICAgc2VsZi5zZXNzaW9uLnNldF9zdHJlYW1fbG9nZ2VyKCdhd3NjbGknLCBsb2dnaW5nLkRFQlVHLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0X3N0cmluZz1MT0dfRk9STUFUKQogICAgICAgICAgICBzZWxmLnNlc3Npb24uc2V0X3N0cmVhbV9sb2dnZXIoJ3MzdHJhbnNmZXInLCBsb2dnaW5nLkRFQlVHLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0X3N0cmluZz1MT0dfRk9STUFUKQogICAgICAgICAgICBzZWxmLnNlc3Npb24uc2V0X3N0cmVhbV9sb2dnZXIoJ3VybGxpYjMnLCBsb2dnaW5nLkRFQlVHLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0X3N0cmluZz1MT0dfRk9STUFUKQogICAgICAgICAgICBMT0cuZGVidWcoIkNMSSB2ZXJzaW9uOiAlcyIsIHNlbGYuc2Vzc2lvbi51c2VyX2FnZW50KCkpCiAgICAgICAgICAgIExPRy5kZWJ1ZygiQXJndW1lbnRzIGVudGVyZWQgdG8gQ0xJOiAlcyIsIHN5cy5hcmd2WzE6XSkKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5zZXNzaW9uLnNldF9zdHJlYW1fbG9nZ2VyKGxvZ2dlcl9uYW1lPSdhd3NjbGknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nX2xldmVsPWxvZ2dpbmcuRVJST1IpCgoKY2xhc3MgU2VydmljZUNvbW1hbmQoQ0xJQ29tbWFuZCk6CgogICAgIiIiQSBzZXJ2aWNlIGNvbW1hbmQgZm9yIHRoZSBDTEkuCgogICAgRm9yIGV4YW1wbGUsIGBgYXdzIGVjMiAuLi5gYCB3ZSdkIGNyZWF0ZSBhIFNlcnZpY2VDb21tYW5kCiAgICBvYmplY3QgdGhhdCByZXByZXNlbnRzIHRoZSBlYzIgc2VydmljZS4KCiAgICAiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgY2xpX25hbWUsIHNlc3Npb24sIHNlcnZpY2VfbmFtZT1Ob25lKToKICAgICAgICAjIFRoZSBjbGlfbmFtZSBpcyB0aGUgbmFtZSB0aGUgdXNlciB0eXBlcywgdGhlIG5hbWUgd2Ugc2hvdwogICAgICAgICMgaW4gZG9jLCBldGMuCiAgICAgICAgIyBUaGUgc2VydmljZV9uYW1lIGlzIHRoZSBuYW1lIHdlIHVzZWQgaW50ZXJuYWxseSB3aXRoIGJvdG9jb3JlLgogICAgICAgICMgRm9yIGV4YW1wbGUsIHdlIGhhdmUgdGhlICdzM2FwaScgYXMgdGhlIGNsaV9uYW1lIGZvciB0aGUgc2VydmljZQogICAgICAgICMgYnV0IHRoaXMgaXMgYWN0dWFsbHkgYm91bmQgdG8gdGhlICdzMycgc2VydmljZSBuYW1lIGluIGJvdG9jb3JlLAogICAgICAgICMgaS5lLiB3ZSBsb2FkIHMzLmpzb24gZnJvbSB0aGUgYm90b2NvcmUgZGF0YSBkaXIuICBNb3N0IG9mCiAgICAgICAgIyB0aGUgdGltZSB0aGVzZSBhcmUgdGhlIHNhbWUgdGhpbmcgYnV0IGluIHRoZSBjYXNlIG9mIHJlbmFtZXMsCiAgICAgICAgIyB3ZSB3YW50IHVzZXJzL2V4dGVybmFsIHRoaW5ncyB0byBiZSBhYmxlIHRvIHJlbmFtZSB0aGUgY2xpIG5hbWUKICAgICAgICAjIGJ1dCAqbm90KiB0aGUgc2VydmljZSBuYW1lLCBhcyB0aGlzIGhhcyB0byBiZSBleGFjdGx5IHdoYXQKICAgICAgICAjIGJvdG9jb3JlIGV4cGVjdHMuCiAgICAgICAgc2VsZi5fbmFtZSA9IGNsaV9uYW1lCiAgICAgICAgc2VsZi5zZXNzaW9uID0gc2Vzc2lvbgogICAgICAgIHNlbGYuX2NvbW1hbmRfdGFibGUgPSBOb25lCiAgICAgICAgaWYgc2VydmljZV9uYW1lIGlzIE5vbmU6CiAgICAgICAgICAgICMgVGhlbiBkZWZhdWx0IHRvIHVzaW5nIHRoZSBjbGkgbmFtZS4KICAgICAgICAgICAgc2VsZi5fc2VydmljZV9uYW1lID0gY2xpX25hbWUKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLl9zZXJ2aWNlX25hbWUgPSBzZXJ2aWNlX25hbWUKICAgICAgICBzZWxmLl9saW5lYWdlID0gW3NlbGZdCiAgICAgICAgc2VsZi5fc2VydmljZV9tb2RlbCA9IE5vbmUKCiAgICBAcHJvcGVydHkKICAgIGRlZiBuYW1lKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9uYW1lCgogICAgQG5hbWUuc2V0dGVyCiAgICBkZWYgbmFtZShzZWxmLCB2YWx1ZSk6CiAgICAgICAgc2VsZi5fbmFtZSA9IHZhbHVlCgogICAgQHByb3BlcnR5CiAgICBkZWYgc2VydmljZV9tb2RlbChzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5fZ2V0X3NlcnZpY2VfbW9kZWwoKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGxpbmVhZ2Uoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2xpbmVhZ2UKCiAgICBAbGluZWFnZS5zZXR0ZXIKICAgIGRlZiBsaW5lYWdlKHNlbGYsIHZhbHVlKToKICAgICAgICBzZWxmLl9saW5lYWdlID0gdmFsdWUKCiAgICBkZWYgX2dldF9jb21tYW5kX3RhYmxlKHNlbGYpOgogICAgICAgIGlmIHNlbGYuX2NvbW1hbmRfdGFibGUgaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5fY29tbWFuZF90YWJsZSA9IHNlbGYuX2NyZWF0ZV9jb21tYW5kX3RhYmxlKCkKICAgICAgICByZXR1cm4gc2VsZi5fY29tbWFuZF90YWJsZQoKICAgIGRlZiBfZ2V0X3NlcnZpY2VfbW9kZWwoc2VsZik6CiAgICAgICAgaWYgc2VsZi5fc2VydmljZV9tb2RlbCBpcyBOb25lOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhcGlfdmVyc2lvbiA9IHNlbGYuc2Vzc2lvbi5nZXRfY29uZmlnX3ZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICdhcGlfdmVyc2lvbnMnKS5nZXQoc2VsZi5fc2VydmljZV9uYW1lLCBOb25lKQogICAgICAgICAgICBleGNlcHQgUHJvZmlsZU5vdEZvdW5kOgogICAgICAgICAgICAgICAgYXBpX3ZlcnNpb24gPSBOb25lCiAgICAgICAgICAgIHNlbGYuX3NlcnZpY2VfbW9kZWwgPSBzZWxmLnNlc3Npb24uZ2V0X3NlcnZpY2VfbW9kZWwoCiAgICAgICAgICAgICAgICBzZWxmLl9zZXJ2aWNlX25hbWUsIGFwaV92ZXJzaW9uPWFwaV92ZXJzaW9uKQogICAgICAgIHJldHVybiBzZWxmLl9zZXJ2aWNlX21vZGVsCgogICAgZGVmIF9fY2FsbF9fKHNlbGYsIGFyZ3MsIHBhcnNlZF9nbG9iYWxzKToKICAgICAgICAjIE9uY2Ugd2Uga25vdyB3ZSdyZSB0cnlpbmcgdG8gY2FsbCBhIHNlcnZpY2UgZm9yIHRoaXMgb3BlcmF0aW9uCiAgICAgICAgIyB3ZSBjYW4gZ28gYWhlYWQgYW5kIGNyZWF0ZSB0aGUgcGFyc2VyIGZvciBpdC4gIFdlCiAgICAgICAgIyBjYW4gYWxzbyBncmFiIHRoZSBTZXJ2aWNlIG9iamVjdCBmcm9tIGJvdG9jb3JlLgogICAgICAgIHNlcnZpY2VfcGFyc2VyID0gc2VsZi5fY3JlYXRlX3BhcnNlcigpCiAgICAgICAgcGFyc2VkX2FyZ3MsIHJlbWFpbmluZyA9IHNlcnZpY2VfcGFyc2VyLnBhcnNlX2tub3duX2FyZ3MoYXJncykKICAgICAgICBjb21tYW5kX3RhYmxlID0gc2VsZi5fZ2V0X2NvbW1hbmRfdGFibGUoKQogICAgICAgIHJldHVybiBjb21tYW5kX3RhYmxlW3BhcnNlZF9hcmdzLm9wZXJhdGlvbl0ocmVtYWluaW5nLCBwYXJzZWRfZ2xvYmFscykKCiAgICBkZWYgX2NyZWF0ZV9jb21tYW5kX3RhYmxlKHNlbGYpOgogICAgICAgIGNvbW1hbmRfdGFibGUgPSBPcmRlcmVkRGljdCgpCiAgICAgICAgc2VydmljZV9tb2RlbCA9IHNlbGYuX2dldF9zZXJ2aWNlX21vZGVsKCkKICAgICAgICBmb3Igb3BlcmF0aW9uX25hbWUgaW4gc2VydmljZV9tb2RlbC5vcGVyYXRpb25fbmFtZXM6CiAgICAgICAgICAgIGNsaV9uYW1lID0geGZvcm1fbmFtZShvcGVyYXRpb25fbmFtZSwgJy0nKQogICAgICAgICAgICBvcGVyYXRpb25fbW9kZWwgPSBzZXJ2aWNlX21vZGVsLm9wZXJhdGlvbl9tb2RlbChvcGVyYXRpb25fbmFtZSkKICAgICAgICAgICAgY29tbWFuZF90YWJsZVtjbGlfbmFtZV0gPSBTZXJ2aWNlT3BlcmF0aW9uKAogICAgICAgICAgICAgICAgbmFtZT1jbGlfbmFtZSwKICAgICAgICAgICAgICAgIHBhcmVudF9uYW1lPXNlbGYuX25hbWUsCiAgICAgICAgICAgICAgICBzZXNzaW9uPXNlbGYuc2Vzc2lvbiwKICAgICAgICAgICAgICAgIG9wZXJhdGlvbl9tb2RlbD1vcGVyYXRpb25fbW9kZWwsCiAgICAgICAgICAgICAgICBvcGVyYXRpb25fY2FsbGVyPUNMSU9wZXJhdGlvbkNhbGxlcihzZWxmLnNlc3Npb24pLAogICAgICAgICAgICApCiAgICAgICAgc2VsZi5zZXNzaW9uLmVtaXQoJ2J1aWxkaW5nLWNvbW1hbmQtdGFibGUuJXMnICUgc2VsZi5fbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kX3RhYmxlPWNvbW1hbmRfdGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbj1zZWxmLnNlc3Npb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZF9vYmplY3Q9c2VsZikKICAgICAgICBzZWxmLl9hZGRfbGluZWFnZShjb21tYW5kX3RhYmxlKQogICAgICAgIHJldHVybiBjb21tYW5kX3RhYmxlCgogICAgZGVmIF9hZGRfbGluZWFnZShzZWxmLCBjb21tYW5kX3RhYmxlKToKICAgICAgICBmb3IgY29tbWFuZCBpbiBjb21tYW5kX3RhYmxlOgogICAgICAgICAgICBjb21tYW5kX29iaiA9IGNvbW1hbmRfdGFibGVbY29tbWFuZF0KICAgICAgICAgICAgY29tbWFuZF9vYmoubGluZWFnZSA9IHNlbGYubGluZWFnZSArIFtjb21tYW5kX29ial0KCiAgICBkZWYgY3JlYXRlX2hlbHBfY29tbWFuZChzZWxmKToKICAgICAgICBjb21tYW5kX3RhYmxlID0gc2VsZi5fZ2V0X2NvbW1hbmRfdGFibGUoKQogICAgICAgIHJldHVybiBTZXJ2aWNlSGVscENvbW1hbmQoc2Vzc2lvbj1zZWxmLnNlc3Npb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmo9c2VsZi5fZ2V0X3NlcnZpY2VfbW9kZWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRfdGFibGU9Y29tbWFuZF90YWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ190YWJsZT1Ob25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRfY2xhc3M9Jy4nLmpvaW4oc2VsZi5saW5lYWdlX25hbWVzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9c2VsZi5fbmFtZSkKCiAgICBkZWYgX2NyZWF0ZV9wYXJzZXIoc2VsZik6CiAgICAgICAgY29tbWFuZF90YWJsZSA9IHNlbGYuX2dldF9jb21tYW5kX3RhYmxlKCkKICAgICAgICAjIEFsc28gYWRkIGEgJ2hlbHAnIGNvbW1hbmQuCiAgICAgICAgY29tbWFuZF90YWJsZVsnaGVscCddID0gc2VsZi5jcmVhdGVfaGVscF9jb21tYW5kKCkKICAgICAgICByZXR1cm4gU2VydmljZUFyZ1BhcnNlcigKICAgICAgICAgICAgb3BlcmF0aW9uc190YWJsZT1jb21tYW5kX3RhYmxlLCBzZXJ2aWNlX25hbWU9c2VsZi5fbmFtZSkKCgpjbGFzcyBTZXJ2aWNlT3BlcmF0aW9uKG9iamVjdCk6CgogICAgIiIiQSBzaW5nbGUgb3BlcmF0aW9uIG9mIGEgc2VydmljZS4KCiAgICBUaGlzIGNsYXNzIHJlcHJlc2VudHMgYSBzaW5nbGUgb3BlcmF0aW9uIGZvciBhIHNlcnZpY2UsIGZvcgogICAgZXhhbXBsZSBgYGVjMi5EZXNjcmliZUluc3RhbmNlc2BgLgoKICAgICIiIgoKICAgIEFSR19UWVBFUyA9IHsKICAgICAgICAnbGlzdCc6IExpc3RBcmd1bWVudCwKICAgICAgICAnYm9vbGVhbic6IEJvb2xlYW5Bcmd1bWVudCwKICAgIH0KICAgIERFRkFVTFRfQVJHX0NMQVNTID0gQ0xJQXJndW1lbnQKCiAgICBkZWYgX19pbml0X18oc2VsZiwgbmFtZSwgcGFyZW50X25hbWUsIG9wZXJhdGlvbl9jYWxsZXIsCiAgICAgICAgICAgICAgICAgb3BlcmF0aW9uX21vZGVsLCBzZXNzaW9uKToKICAgICAgICAiIiIKCiAgICAgICAgOnR5cGUgbmFtZTogc3RyCiAgICAgICAgOnBhcmFtIG5hbWU6IFRoZSBuYW1lIG9mIHRoZSBvcGVyYXRpb24vc3ViY29tbWFuZC4KCiAgICAgICAgOnR5cGUgcGFyZW50X25hbWU6IHN0cgogICAgICAgIDpwYXJhbSBwYXJlbnRfbmFtZTogVGhlIG5hbWUgb2YgdGhlIHBhcmVudCBjb21tYW5kLgoKICAgICAgICA6dHlwZSBvcGVyYXRpb25fbW9kZWw6IGBgYm90b2NvcmUubW9kZWwuT3BlcmF0aW9uTW9kZWxgYAogICAgICAgIDpwYXJhbSBvcGVyYXRpb25fb2JqZWN0OiBUaGUgb3BlcmF0aW9uIG1vZGVsCiAgICAgICAgICAgIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHN1YmNvbW1hbmQuCgogICAgICAgIDp0eXBlIG9wZXJhdGlvbl9jYWxsZXI6IGBgQ0xJT3BlcmF0aW9uQ2FsbGVyYGAKICAgICAgICA6cGFyYW0gb3BlcmF0aW9uX2NhbGxlcjogQW4gb2JqZWN0IHRoYXQgY2FuIHByb3Blcmx5IGNhbGwgdGhlCiAgICAgICAgICAgIG9wZXJhdGlvbi4KCiAgICAgICAgOnR5cGUgc2Vzc2lvbjogYGBib3RvY29yZS5zZXNzaW9uLlNlc3Npb25gYAogICAgICAgIDpwYXJhbSBzZXNzaW9uOiBUaGUgc2Vzc2lvbiBvYmplY3QuCgogICAgICAgICIiIgogICAgICAgIHNlbGYuX2FyZ190YWJsZSA9IE5vbmUKICAgICAgICBzZWxmLl9uYW1lID0gbmFtZQogICAgICAgICMgVGhlc2UgaXMgdXNlZCBzbyB3ZSBjYW4gZmlndXJlIG91dCB3aGF0IHRoZSBwcm9wZXIgZXZlbnQKICAgICAgICAjIG5hbWUgc2hvdWxkIGJlIDxwYXJlbnQgbmFtZT4uPG5hbWU+LgogICAgICAgIHNlbGYuX3BhcmVudF9uYW1lID0gcGFyZW50X25hbWUKICAgICAgICBzZWxmLl9vcGVyYXRpb25fY2FsbGVyID0gb3BlcmF0aW9uX2NhbGxlcgogICAgICAgIHNlbGYuX2xpbmVhZ2UgPSBbc2VsZl0KICAgICAgICBzZWxmLl9vcGVyYXRpb25fbW9kZWwgPSBvcGVyYXRpb25fbW9kZWwKICAgICAgICBzZWxmLl9zZXNzaW9uID0gc2Vzc2lvbgogICAgICAgIGlmIG9wZXJhdGlvbl9tb2RlbC5kZXByZWNhdGVkOgogICAgICAgICAgICBzZWxmLl9VTkRPQ1VNRU5URUQgPSBUcnVlCgogICAgQHByb3BlcnR5CiAgICBkZWYgbmFtZShzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5fbmFtZQoKICAgIEBuYW1lLnNldHRlcgogICAgZGVmIG5hbWUoc2VsZiwgdmFsdWUpOgogICAgICAgIHNlbGYuX25hbWUgPSB2YWx1ZQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGxpbmVhZ2Uoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2xpbmVhZ2UKCiAgICBAbGluZWFnZS5zZXR0ZXIKICAgIGRlZiBsaW5lYWdlKHNlbGYsIHZhbHVlKToKICAgICAgICBzZWxmLl9saW5lYWdlID0gdmFsdWUKCiAgICBAcHJvcGVydHkKICAgIGRlZiBsaW5lYWdlX25hbWVzKHNlbGYpOgogICAgICAgICMgUmVwcmVzZW50cyB0aGUgbGluZWFnZSBvZiBhIGNvbW1hbmQgaW4gdGVybXMgb2YgY29tbWFuZCBgYG5hbWVgYAogICAgICAgIHJldHVybiBbY21kLm5hbWUgZm9yIGNtZCBpbiBzZWxmLmxpbmVhZ2VdCgogICAgQHByb3BlcnR5CiAgICBkZWYgYXJnX3RhYmxlKHNlbGYpOgogICAgICAgIGlmIHNlbGYuX2FyZ190YWJsZSBpcyBOb25lOgogICAgICAgICAgICBzZWxmLl9hcmdfdGFibGUgPSBzZWxmLl9jcmVhdGVfYXJndW1lbnRfdGFibGUoKQogICAgICAgIHJldHVybiBzZWxmLl9hcmdfdGFibGUKCiAgICBkZWYgX19jYWxsX18oc2VsZiwgYXJncywgcGFyc2VkX2dsb2JhbHMpOgogICAgICAgICMgT25jZSB3ZSBrbm93IHdlJ3JlIHRyeWluZyB0byBjYWxsIGEgcGFydGljdWxhciBvcGVyYXRpb24KICAgICAgICAjIG9mIGEgc2VydmljZSB3ZSBjYW4gZ28gYWhlYWQgYW5kIGxvYWQgdGhlIHBhcmFtZXRlcnMuCiAgICAgICAgZXZlbnQgPSAnYmVmb3JlLWJ1aWxkaW5nLWFyZ3VtZW50LXRhYmxlLXBhcnNlci4lcy4lcycgJSBcCiAgICAgICAgICAgIChzZWxmLl9wYXJlbnRfbmFtZSwgc2VsZi5fbmFtZSkKICAgICAgICBzZWxmLl9lbWl0KGV2ZW50LCBhcmd1bWVudF90YWJsZT1zZWxmLmFyZ190YWJsZSwgYXJncz1hcmdzLAogICAgICAgICAgICAgICAgICAgc2Vzc2lvbj1zZWxmLl9zZXNzaW9uLCBwYXJzZWRfZ2xvYmFscz1wYXJzZWRfZ2xvYmFscykKICAgICAgICBvcGVyYXRpb25fcGFyc2VyID0gc2VsZi5fY3JlYXRlX29wZXJhdGlvbl9wYXJzZXIoc2VsZi5hcmdfdGFibGUpCiAgICAgICAgc2VsZi5fYWRkX2hlbHAob3BlcmF0aW9uX3BhcnNlcikKICAgICAgICBwYXJzZWRfYXJncywgcmVtYWluaW5nID0gb3BlcmF0aW9uX3BhcnNlci5wYXJzZV9rbm93bl9hcmdzKGFyZ3MpCiAgICAgICAgaWYgcGFyc2VkX2FyZ3MuaGVscCA9PSAnaGVscCc6CiAgICAgICAgICAgIG9wX2hlbHAgPSBzZWxmLmNyZWF0ZV9oZWxwX2NvbW1hbmQoKQogICAgICAgICAgICByZXR1cm4gb3BfaGVscChyZW1haW5pbmcsIHBhcnNlZF9nbG9iYWxzKQogICAgICAgIGVsaWYgcGFyc2VkX2FyZ3MuaGVscDoKICAgICAgICAgICAgcmVtYWluaW5nLmFwcGVuZChwYXJzZWRfYXJncy5oZWxwKQogICAgICAgIGlmIHJlbWFpbmluZzoKICAgICAgICAgICAgcmFpc2UgVW5rbm93bkFyZ3VtZW50RXJyb3IoCiAgICAgICAgICAgICAgICAiVW5rbm93biBvcHRpb25zOiAlcyIgJSAnLCAnLmpvaW4ocmVtYWluaW5nKSkKICAgICAgICBldmVudCA9ICdvcGVyYXRpb24tYXJncy1wYXJzZWQuJXMuJXMnICUgKHNlbGYuX3BhcmVudF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbmFtZSkKICAgICAgICBzZWxmLl9lbWl0KGV2ZW50LCBwYXJzZWRfYXJncz1wYXJzZWRfYXJncywKICAgICAgICAgICAgICAgICAgIHBhcnNlZF9nbG9iYWxzPXBhcnNlZF9nbG9iYWxzKQogICAgICAgIGNhbGxfcGFyYW1ldGVycyA9IHNlbGYuX2J1aWxkX2NhbGxfcGFyYW1ldGVycygKICAgICAgICAgICAgcGFyc2VkX2FyZ3MsIHNlbGYuYXJnX3RhYmxlKQoKICAgICAgICBldmVudCA9ICdjYWxsaW5nLWNvbW1hbmQuJXMuJXMnICUgKHNlbGYuX3BhcmVudF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbmFtZSkKICAgICAgICBvdmVycmlkZSA9IHNlbGYuX2VtaXRfZmlyc3Rfbm9uX25vbmVfcmVzcG9uc2UoCiAgICAgICAgICAgIGV2ZW50LAogICAgICAgICAgICBjYWxsX3BhcmFtZXRlcnM9Y2FsbF9wYXJhbWV0ZXJzLAogICAgICAgICAgICBwYXJzZWRfYXJncz1wYXJzZWRfYXJncywKICAgICAgICAgICAgcGFyc2VkX2dsb2JhbHM9cGFyc2VkX2dsb2JhbHMKICAgICAgICApCiAgICAgICAgIyBUaGVyZSBhcmUgdHdvIHBvc3NpYmxlIHZhbHVlcyBmb3Igb3ZlcnJpZGUuIEl0IGNhbiBiZSBzb21lIHR5cGUKICAgICAgICAjIG9mIGV4Y2VwdGlvbiB0aGF0IHdpbGwgYmUgcmFpc2VkIGlmIGRldGVjdGVkIG9yIGl0IGNhbiByZXByZXNlbnQKICAgICAgICAjIHRoZSBkZXNpcmVkIHJldHVybiBjb2RlLiBOb3RlIHRoYXQgYSByZXR1cm4gY29kZSBvZiAwIHJlcHJlc2VudHMKICAgICAgICAjIGEgc3VjY2Vzcy4KICAgICAgICBpZiBvdmVycmlkZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShvdmVycmlkZSwgRXhjZXB0aW9uKToKICAgICAgICAgICAgICAgICMgSWYgdGhlIG92ZXJyaWRlIHZhbHVlIHByb3ZpZGVkIGJhY2sgaXMgYW4gZXhjZXB0aW9uIHRoZW4KICAgICAgICAgICAgICAgICMgcmFpc2UgdGhlIGV4Y2VwdGlvbgogICAgICAgICAgICAgICAgcmFpc2Ugb3ZlcnJpZGUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgVGhpcyBpcyB0aGUgdmFsdWUgdXN1YWxseSByZXR1cm5lZCBieSB0aGUgYGBpbnZva2UoKWBgCiAgICAgICAgICAgICAgICAjIG1ldGhvZCBvZiB0aGUgb3BlcmF0aW9uIGNhbGxlci4gSXQgcmVwcmVzZW50cyB0aGUgcmV0dXJuCiAgICAgICAgICAgICAgICAjIGNvZGUgb2YgdGhlIG9wZXJhdGlvbi4KICAgICAgICAgICAgICAgIHJldHVybiBvdmVycmlkZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgTm8gb3ZlcnJpZGUgdmFsdWUgd2FzIHN1cHBsaWVkLgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3BlcmF0aW9uX2NhbGxlci5pbnZva2UoCiAgICAgICAgICAgICAgICBzZWxmLl9vcGVyYXRpb25fbW9kZWwuc2VydmljZV9tb2RlbC5zZXJ2aWNlX25hbWUsCiAgICAgICAgICAgICAgICBzZWxmLl9vcGVyYXRpb25fbW9kZWwubmFtZSwKICAgICAgICAgICAgICAgIGNhbGxfcGFyYW1ldGVycywgcGFyc2VkX2dsb2JhbHMpCgogICAgZGVmIGNyZWF0ZV9oZWxwX2NvbW1hbmQoc2VsZik6CiAgICAgICAgcmV0dXJuIE9wZXJhdGlvbkhlbHBDb21tYW5kKAogICAgICAgICAgICBzZWxmLl9zZXNzaW9uLAogICAgICAgICAgICBvcGVyYXRpb25fbW9kZWw9c2VsZi5fb3BlcmF0aW9uX21vZGVsLAogICAgICAgICAgICBhcmdfdGFibGU9c2VsZi5hcmdfdGFibGUsCiAgICAgICAgICAgIG5hbWU9c2VsZi5fbmFtZSwgZXZlbnRfY2xhc3M9Jy4nLmpvaW4oc2VsZi5saW5lYWdlX25hbWVzKSkKCiAgICBkZWYgX2FkZF9oZWxwKHNlbGYsIHBhcnNlcik6CiAgICAgICAgIyBUaGUgJ2hlbHAnIG91dHB1dCBpcyBwcm9jZXNzZWQgYSBsaXR0bGUgZGlmZmVyZW50bHkgZnJvbQogICAgICAgICMgdGhlIG9wZXJhdGlvbiBoZWxwIGJlY2F1c2UgdGhlIGFyZ190YWJsZSBoYXMKICAgICAgICAjIENMSUFyZ3VtZW50cyBmb3IgdmFsdWVzLgogICAgICAgIHBhcnNlci5hZGRfYXJndW1lbnQoJ2hlbHAnLCBuYXJncz0nPycpCgogICAgZGVmIF9idWlsZF9jYWxsX3BhcmFtZXRlcnMoc2VsZiwgYXJncywgYXJnX3RhYmxlKToKICAgICAgICAjIFdlIG5lZWQgdG8gY29udmVydCB0aGUgYXJncyBzcGVjaWZpZWQgb24gdGhlIGNvbW1hbmQKICAgICAgICAjIGxpbmUgYXMgdmFsaWQgKiprd2FyZ3Mgd2UgY2FuIGhhbmQgdG8gYm90b2NvcmUuCiAgICAgICAgc2VydmljZV9wYXJhbXMgPSB7fQogICAgICAgICMgYXJncyBpcyBhbiBhcmdwYXJzZS5OYW1lc3BhY2Ugb2JqZWN0IHNvIHdlJ3JlIHVzaW5nIHZhcnMoKQogICAgICAgICMgc28gd2UgY2FuIGl0ZXJhdGUgb3ZlciB0aGUgcGFyc2VkIGtleS92YWx1ZXMuCiAgICAgICAgcGFyc2VkX2FyZ3MgPSB2YXJzKGFyZ3MpCiAgICAgICAgZm9yIGFyZ19vYmplY3QgaW4gYXJnX3RhYmxlLnZhbHVlcygpOgogICAgICAgICAgICBweV9uYW1lID0gYXJnX29iamVjdC5weV9uYW1lCiAgICAgICAgICAgIGlmIHB5X25hbWUgaW4gcGFyc2VkX2FyZ3M6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlZF9hcmdzW3B5X25hbWVdCiAgICAgICAgICAgICAgICB2YWx1ZSA9IHNlbGYuX3VucGFja19hcmcoYXJnX29iamVjdCwgdmFsdWUpCiAgICAgICAgICAgICAgICBhcmdfb2JqZWN0LmFkZF90b19wYXJhbXMoc2VydmljZV9wYXJhbXMsIHZhbHVlKQogICAgICAgIHJldHVybiBzZXJ2aWNlX3BhcmFtcwoKICAgIGRlZiBfdW5wYWNrX2FyZyhzZWxmLCBjbGlfYXJndW1lbnQsIHZhbHVlKToKICAgICAgICAjIFVucGFja3MgYSBjb21tYW5kbGluZSBhcmd1bWVudCBpbnRvIGEgUHl0aG9uIHZhbHVlIGJ5IGZpcmluZyB0aGUKICAgICAgICAjIGxvYWQtY2xpLWFyZy5zZXJ2aWNlLW5hbWUub3BlcmF0aW9uLW5hbWUgZXZlbnQuCiAgICAgICAgc2Vzc2lvbiA9IHNlbGYuX3Nlc3Npb24KICAgICAgICBzZXJ2aWNlX25hbWUgPSBzZWxmLl9vcGVyYXRpb25fbW9kZWwuc2VydmljZV9tb2RlbC5lbmRwb2ludF9wcmVmaXgKICAgICAgICBvcGVyYXRpb25fbmFtZSA9IHhmb3JtX25hbWUoc2VsZi5fbmFtZSwgJy0nKQoKICAgICAgICByZXR1cm4gdW5wYWNrX2FyZ3VtZW50KHNlc3Npb24sIHNlcnZpY2VfbmFtZSwgb3BlcmF0aW9uX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlfYXJndW1lbnQsIHZhbHVlKQoKICAgIGRlZiBfY3JlYXRlX2FyZ3VtZW50X3RhYmxlKHNlbGYpOgogICAgICAgIGFyZ3VtZW50X3RhYmxlID0gT3JkZXJlZERpY3QoKQogICAgICAgIGlucHV0X3NoYXBlID0gc2VsZi5fb3BlcmF0aW9uX21vZGVsLmlucHV0X3NoYXBlCiAgICAgICAgcmVxdWlyZWRfYXJndW1lbnRzID0gW10KICAgICAgICBhcmdfZGljdCA9IHt9CiAgICAgICAgaWYgaW5wdXRfc2hhcGUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJlcXVpcmVkX2FyZ3VtZW50cyA9IGlucHV0X3NoYXBlLnJlcXVpcmVkX21lbWJlcnMKICAgICAgICAgICAgYXJnX2RpY3QgPSBpbnB1dF9zaGFwZS5tZW1iZXJzCiAgICAgICAgZm9yIGFyZ19uYW1lLCBhcmdfc2hhcGUgaW4gYXJnX2RpY3QuaXRlbXMoKToKICAgICAgICAgICAgY2xpX2FyZ19uYW1lID0geGZvcm1fbmFtZShhcmdfbmFtZSwgJy0nKQogICAgICAgICAgICBhcmdfY2xhc3MgPSBzZWxmLkFSR19UWVBFUy5nZXQoYXJnX3NoYXBlLnR5cGVfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuREVGQVVMVF9BUkdfQ0xBU1MpCiAgICAgICAgICAgIGlzX3Rva2VuID0gYXJnX3NoYXBlLm1ldGFkYXRhLmdldCgnaWRlbXBvdGVuY3lUb2tlbicsIEZhbHNlKQogICAgICAgICAgICBpc19yZXF1aXJlZCA9IGFyZ19uYW1lIGluIHJlcXVpcmVkX2FyZ3VtZW50cyBhbmQgbm90IGlzX3Rva2VuCiAgICAgICAgICAgIGV2ZW50X2VtaXR0ZXIgPSBzZWxmLl9zZXNzaW9uLmdldF9jb21wb25lbnQoJ2V2ZW50X2VtaXR0ZXInKQogICAgICAgICAgICBhcmdfb2JqZWN0ID0gYXJnX2NsYXNzKAogICAgICAgICAgICAgICAgbmFtZT1jbGlfYXJnX25hbWUsCiAgICAgICAgICAgICAgICBhcmd1bWVudF9tb2RlbD1hcmdfc2hhcGUsCiAgICAgICAgICAgICAgICBpc19yZXF1aXJlZD1pc19yZXF1aXJlZCwKICAgICAgICAgICAgICAgIG9wZXJhdGlvbl9tb2RlbD1zZWxmLl9vcGVyYXRpb25fbW9kZWwsCiAgICAgICAgICAgICAgICBzZXJpYWxpemVkX25hbWU9YXJnX25hbWUsCiAgICAgICAgICAgICAgICBldmVudF9lbWl0dGVyPWV2ZW50X2VtaXR0ZXIpCiAgICAgICAgICAgIGFyZ19vYmplY3QuYWRkX3RvX2FyZ190YWJsZShhcmd1bWVudF90YWJsZSkKICAgICAgICBMT0cuZGVidWcoYXJndW1lbnRfdGFibGUpCiAgICAgICAgc2VsZi5fZW1pdCgnYnVpbGRpbmctYXJndW1lbnQtdGFibGUuJXMuJXMnICUgKHNlbGYuX3BhcmVudF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9uYW1lKSwKICAgICAgICAgICAgICAgICAgIG9wZXJhdGlvbl9tb2RlbD1zZWxmLl9vcGVyYXRpb25fbW9kZWwsCiAgICAgICAgICAgICAgICAgICBzZXNzaW9uPXNlbGYuX3Nlc3Npb24sCiAgICAgICAgICAgICAgICAgICBjb21tYW5kPXNlbGYsCiAgICAgICAgICAgICAgICAgICBhcmd1bWVudF90YWJsZT1hcmd1bWVudF90YWJsZSkKICAgICAgICByZXR1cm4gYXJndW1lbnRfdGFibGUKCiAgICBkZWYgX2VtaXQoc2VsZiwgbmFtZSwgKiprd2FyZ3MpOgogICAgICAgIHJldHVybiBzZWxmLl9zZXNzaW9uLmVtaXQobmFtZSwgKiprd2FyZ3MpCgogICAgZGVmIF9lbWl0X2ZpcnN0X25vbl9ub25lX3Jlc3BvbnNlKHNlbGYsIG5hbWUsICoqa3dhcmdzKToKICAgICAgICByZXR1cm4gc2VsZi5fc2Vzc2lvbi5lbWl0X2ZpcnN0X25vbl9ub25lX3Jlc3BvbnNlKAogICAgICAgICAgICBuYW1lLCAqKmt3YXJncykKCiAgICBkZWYgX2NyZWF0ZV9vcGVyYXRpb25fcGFyc2VyKHNlbGYsIGFyZ190YWJsZSk6CiAgICAgICAgcGFyc2VyID0gQXJnVGFibGVBcmdQYXJzZXIoYXJnX3RhYmxlKQogICAgICAgIHJldHVybiBwYXJzZXIKCgpjbGFzcyBDTElPcGVyYXRpb25DYWxsZXIob2JqZWN0KToKCiAgICAiIiJDYWxsIGFuIEFXUyBvcGVyYXRpb24gYW5kIGZvcm1hdCB0aGUgcmVzcG9uc2UuIiIiCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNlc3Npb24pOgogICAgICAgIHNlbGYuX3Nlc3Npb24gPSBzZXNzaW9uCgogICAgZGVmIGludm9rZShzZWxmLCBzZXJ2aWNlX25hbWUsIG9wZXJhdGlvbl9uYW1lLCBwYXJhbWV0ZXJzLCBwYXJzZWRfZ2xvYmFscyk6CiAgICAgICAgIiIiSW52b2tlIGFuIG9wZXJhdGlvbiBhbmQgZm9ybWF0IHRoZSByZXNwb25zZS4KCiAgICAgICAgOnR5cGUgc2VydmljZV9uYW1lOiBzdHIKICAgICAgICA6cGFyYW0gc2VydmljZV9uYW1lOiBUaGUgbmFtZSBvZiB0aGUgc2VydmljZS4gIE5vdGUgdGhpcyBpcyB0aGUgc2VydmljZSBuYW1lLAogICAgICAgICAgICBub3QgdGhlIGVuZHBvaW50IHByZWZpeCAoZS5nLiBgYHNlc2BgIG5vdCBgYGVtYWlsYGApLgoKICAgICAgICA6dHlwZSBvcGVyYXRpb25fbmFtZTogc3RyCiAgICAgICAgOnBhcmFtIG9wZXJhdGlvbl9uYW1lOiBUaGUgb3BlcmF0aW9uIG5hbWUgb2YgdGhlIHNlcnZpY2UuICBUaGUgY2FzaW5nCiAgICAgICAgICAgIG9mIHRoZSBvcGVyYXRpb24gbmFtZSBzaG91bGQgbWF0Y2ggdGhlIGV4YWN0IGNhc2luZyB1c2VkIGJ5IHRoZSBzZXJ2aWNlLAogICAgICAgICAgICBlLmcuIGBgRGVzY3JpYmVJbnN0YW5jZXNgYCwgbm90IGBgZGVzY3JpYmUtaW5zdGFuY2VzYGAgb3IKICAgICAgICAgICAgYGBkZXNjcmliZV9pbnN0YW5jZXNgYC4KCiAgICAgICAgOnR5cGUgcGFyYW1ldGVyczogZGljdAogICAgICAgIDpwYXJhbSBwYXJhbWV0ZXJzOiBUaGUgcGFyYW1ldGVycyBmb3IgdGhlIG9wZXJhdGlvbiBjYWxsLiAgQWdhaW4sIHRoZXNlIHZhbHVlcwogICAgICAgICAgICBoYXZlIHRoZSBzYW1lIGNhc2luZyB1c2VkIGJ5IHRoZSBzZXJ2aWNlLgoKICAgICAgICA6dHlwZSBwYXJzZWRfZ2xvYmFsczogTmFtZXNwYWNlCiAgICAgICAgOnBhcmFtIHBhcnNlZF9nbG9iYWxzOiBUaGUgcGFyc2VkIGdsb2JhbHMgZnJvbSB0aGUgY29tbWFuZCBsaW5lLgoKICAgICAgICA6cmV0dXJuOiBOb25lLCB0aGUgcmVzdWx0IGlzIGRpc3BsYXllZCB0aHJvdWdoIGEgZm9ybWF0dGVyLCBidXQgbm8KICAgICAgICAgICAgdmFsdWUgaXMgcmV0dXJuZWQuCgogICAgICAgICIiIgogICAgICAgIGNsaWVudCA9IHNlbGYuX3Nlc3Npb24uY3JlYXRlX2NsaWVudCgKICAgICAgICAgICAgc2VydmljZV9uYW1lLCByZWdpb25fbmFtZT1wYXJzZWRfZ2xvYmFscy5yZWdpb24sCiAgICAgICAgICAgIGVuZHBvaW50X3VybD1wYXJzZWRfZ2xvYmFscy5lbmRwb2ludF91cmwsCiAgICAgICAgICAgIHZlcmlmeT1wYXJzZWRfZ2xvYmFscy52ZXJpZnlfc3NsKQogICAgICAgIHJlc3BvbnNlID0gc2VsZi5fbWFrZV9jbGllbnRfY2FsbCgKICAgICAgICAgICAgY2xpZW50LCBvcGVyYXRpb25fbmFtZSwgcGFyYW1ldGVycywgcGFyc2VkX2dsb2JhbHMpCiAgICAgICAgc2VsZi5fZGlzcGxheV9yZXNwb25zZShvcGVyYXRpb25fbmFtZSwgcmVzcG9uc2UsIHBhcnNlZF9nbG9iYWxzKQogICAgICAgIHJldHVybiAwCgogICAgZGVmIF9tYWtlX2NsaWVudF9jYWxsKHNlbGYsIGNsaWVudCwgb3BlcmF0aW9uX25hbWUsIHBhcmFtZXRlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VkX2dsb2JhbHMpOgogICAgICAgIHB5X29wZXJhdGlvbl9uYW1lID0geGZvcm1fbmFtZShvcGVyYXRpb25fbmFtZSkKICAgICAgICBpZiBjbGllbnQuY2FuX3BhZ2luYXRlKHB5X29wZXJhdGlvbl9uYW1lKSBhbmQgcGFyc2VkX2dsb2JhbHMucGFnaW5hdGU6CiAgICAgICAgICAgIHBhZ2luYXRvciA9IGNsaWVudC5nZXRfcGFnaW5hdG9yKHB5X29wZXJhdGlvbl9uYW1lKQogICAgICAgICAgICByZXNwb25zZSA9IHBhZ2luYXRvci5wYWdpbmF0ZSgqKnBhcmFtZXRlcnMpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmVzcG9uc2UgPSBnZXRhdHRyKGNsaWVudCwgeGZvcm1fbmFtZShvcGVyYXRpb25fbmFtZSkpKAogICAgICAgICAgICAgICAgKipwYXJhbWV0ZXJzKQogICAgICAgIHJldHVybiByZXNwb25zZQoKICAgIGRlZiBfZGlzcGxheV9yZXNwb25zZShzZWxmLCBjb21tYW5kX25hbWUsIHJlc3BvbnNlLAogICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlZF9nbG9iYWxzKToKICAgICAgICBvdXRwdXQgPSBwYXJzZWRfZ2xvYmFscy5vdXRwdXQKICAgICAgICBpZiBvdXRwdXQgaXMgTm9uZToKICAgICAgICAgICAgb3V0cHV0ID0gc2VsZi5fc2Vzc2lvbi5nZXRfY29uZmlnX3ZhcmlhYmxlKCdvdXRwdXQnKQogICAgICAgIGZvcm1hdHRlciA9IGdldF9mb3JtYXR0ZXIob3V0cHV0LCBwYXJzZWRfZ2xvYmFscykKICAgICAgICBmb3JtYXR0ZXIoY29tbWFuZF9uYW1lLCByZXNwb25zZSkK
