statistics:
  total_files: 1
  skipped_files: 0.0
  processed_objects: 1
  malicious_objects: 0
details:
- path: .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/util/selectors.py
  contents:
  - name: _SelectorMapping.__init__
    score: 0.0
    code: |-
      def __init__(self, selector):
              self._selector = selector
    tokens: resume load_fast selector load_fast self store_attr _selector return_const None
    hash: ab89420e9ca5a8040f31c6981e7798b5425a9a215d242c1a462fbe231e62f647
sources:
  ? .repo_cache/malicious_repos/pypi_malregistry/python-aliyun-sdk-core/2.13.36/python-aliyun-sdk-core-2.13.36/python-aliyun-sdk-core-2.13.36/aliyunsdkcore/vendored/requests/packages/urllib3/util/selectors.py
  : IyBCYWNrcG9ydCBvZiBzZWxlY3RvcnMucHkgZnJvbSBQeXRob24gMy41KyB0byBzdXBwb3J0IFB5dGhvbiA8IDMuNAojIEFsc28gaGFzIHRoZSBiZWhhdmlvciBzcGVjaWZpZWQgaW4gUEVQIDQ3NSB3aGljaCBpcyB0byByZXRyeSBzeXNjYWxscwojIGluIHRoZSBjYXNlIG9mIGFuIEVJTlRSIGVycm9yLiBUaGlzIG1vZHVsZSBpcyByZXF1aXJlZCBiZWNhdXNlIHNlbGVjdG9yczM0CiMgZG9lcyBub3QgZm9sbG93IHRoaXMgYmVoYXZpb3IgYW5kIGluc3RlYWQgcmV0dXJucyB0aGF0IG5vIGRpbGUgZGVzY3JpcHRvcgojIGV2ZW50cyBoYXZlIG9jY3VycmVkIHJhdGhlciB0aGFuIHJldHJ5IHRoZSBzeXNjYWxsLiBUaGUgZGVjaXNpb24gdG8gZHJvcAojIHN1cHBvcnQgZm9yIHNlbGVjdC5kZXZwb2xsIGlzIG1hZGUgdG8gbWFpbnRhaW4gMTAwJSB0ZXN0IGNvdmVyYWdlLgoKaW1wb3J0IGVycm5vCmltcG9ydCBtYXRoCmltcG9ydCBzZWxlY3QKaW1wb3J0IHNvY2tldAppbXBvcnQgc3lzCmltcG9ydCB0aW1lCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IG5hbWVkdHVwbGUKCnRyeToKICAgIGZyb20gY29sbGVjdGlvbnMuYWJjIGltcG9ydCBNYXBwaW5nCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIGZyb20gY29sbGVjdGlvbnMgaW1wb3J0IE1hcHBpbmcKCgp0cnk6CiAgICBtb25vdG9uaWMgPSB0aW1lLm1vbm90b25pYwpleGNlcHQgKEF0dHJpYnV0ZUVycm9yLCBJbXBvcnRFcnJvcik6ICAjIFB5dGhvbiAzLjM8CiAgICBtb25vdG9uaWMgPSB0aW1lLnRpbWUKCkVWRU5UX1JFQUQgPSAoMSA8PCAwKQpFVkVOVF9XUklURSA9ICgxIDw8IDEpCgpIQVNfU0VMRUNUID0gVHJ1ZSAgIyBWYXJpYWJsZSB0aGF0IHNob3dzIHdoZXRoZXIgdGhlIHBsYXRmb3JtIGhhcyBhIHNlbGVjdG9yLgpfU1lTQ0FMTF9TRU5USU5FTCA9IG9iamVjdCgpICAjIFNlbnRpbmVsIGluIGNhc2UgYSBzeXN0ZW0gY2FsbCByZXR1cm5zIE5vbmUuCl9ERUZBVUxUX1NFTEVDVE9SID0gTm9uZQoKCmNsYXNzIFNlbGVjdG9yRXJyb3IoRXhjZXB0aW9uKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBlcnJjb2RlKToKICAgICAgICBzdXBlcihTZWxlY3RvckVycm9yLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5lcnJubyA9IGVycmNvZGUKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgcmV0dXJuICI8U2VsZWN0b3JFcnJvciBlcnJubz17MH0+Ii5mb3JtYXQoc2VsZi5lcnJubykKCiAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5fX3JlcHJfXygpCgoKZGVmIF9maWxlb2JqX3RvX2ZkKGZpbGVvYmopOgogICAgIiIiIFJldHVybiBhIGZpbGUgZGVzY3JpcHRvciBmcm9tIGEgZmlsZSBvYmplY3QuIElmCiAgICBnaXZlbiBhbiBpbnRlZ2VyIHdpbGwgc2ltcGx5IHJldHVybiB0aGF0IGludGVnZXIgYmFjay4gIiIiCiAgICBpZiBpc2luc3RhbmNlKGZpbGVvYmosIGludCk6CiAgICAgICAgZmQgPSBmaWxlb2JqCiAgICBlbHNlOgogICAgICAgIHRyeToKICAgICAgICAgICAgZmQgPSBpbnQoZmlsZW9iai5maWxlbm8oKSkKICAgICAgICBleGNlcHQgKEF0dHJpYnV0ZUVycm9yLCBUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJJbnZhbGlkIGZpbGUgb2JqZWN0OiB7MCFyfSIuZm9ybWF0KGZpbGVvYmopKQogICAgaWYgZmQgPCAwOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIkludmFsaWQgZmlsZSBkZXNjcmlwdG9yOiB7MH0iLmZvcm1hdChmZCkpCiAgICByZXR1cm4gZmQKCgojIERldGVybWluZSB3aGljaCBmdW5jdGlvbiB0byB1c2UgdG8gd3JhcCBzeXN0ZW0gY2FsbHMgYmVjYXVzZSBQeXRob24gMy41KwojIGFscmVhZHkgaGFuZGxlcyB0aGUgY2FzZSB3aGVuIHN5c3RlbSBjYWxscyBhcmUgaW50ZXJydXB0ZWQuCmlmIHN5cy52ZXJzaW9uX2luZm8gPj0gKDMsIDUpOgogICAgZGVmIF9zeXNjYWxsX3dyYXBwZXIoZnVuYywgXywgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAiIiIgVGhpcyBpcyB0aGUgc2hvcnQtY2lyY3VpdCB2ZXJzaW9uIG9mIHRoZSBiZWxvdyBsb2dpYwogICAgICAgIGJlY2F1c2UgaW4gUHl0aG9uIDMuNSsgYWxsIHN5c3RlbSBjYWxscyBhdXRvbWF0aWNhbGx5IHJlc3RhcnQKICAgICAgICBhbmQgcmVjYWxjdWxhdGUgdGhlaXIgdGltZW91dHMuICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIGZ1bmMoKmFyZ3MsICoqa3dhcmdzKQogICAgICAgIGV4Y2VwdCAoT1NFcnJvciwgSU9FcnJvciwgc2VsZWN0LmVycm9yKSBhcyBlOgogICAgICAgICAgICBlcnJjb2RlID0gTm9uZQogICAgICAgICAgICBpZiBoYXNhdHRyKGUsICJlcnJubyIpOgogICAgICAgICAgICAgICAgZXJyY29kZSA9IGUuZXJybm8KICAgICAgICAgICAgcmFpc2UgU2VsZWN0b3JFcnJvcihlcnJjb2RlKQplbHNlOgogICAgZGVmIF9zeXNjYWxsX3dyYXBwZXIoZnVuYywgcmVjYWxjX3RpbWVvdXQsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgIiIiIFdyYXBwZXIgZnVuY3Rpb24gZm9yIHN5c2NhbGxzIHRoYXQgY291bGQgZmFpbCBkdWUgdG8gRUlOVFIuCiAgICAgICAgQWxsIGZ1bmN0aW9ucyBzaG91bGQgYmUgcmV0cmllZCBpZiB0aGVyZSBpcyB0aW1lIGxlZnQgaW4gdGhlIHRpbWVvdXQKICAgICAgICBpbiBhY2NvcmRhbmNlIHdpdGggUEVQIDQ3NS4gIiIiCiAgICAgICAgdGltZW91dCA9IGt3YXJncy5nZXQoInRpbWVvdXQiLCBOb25lKQogICAgICAgIGlmIHRpbWVvdXQgaXMgTm9uZToKICAgICAgICAgICAgZXhwaXJlcyA9IE5vbmUKICAgICAgICAgICAgcmVjYWxjX3RpbWVvdXQgPSBGYWxzZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRpbWVvdXQgPSBmbG9hdCh0aW1lb3V0KQogICAgICAgICAgICBpZiB0aW1lb3V0IDwgMC4wOiAgIyBUaW1lb3V0IGxlc3MgdGhhbiAwIHRyZWF0ZWQgYXMgbm8gdGltZW91dC4KICAgICAgICAgICAgICAgIGV4cGlyZXMgPSBOb25lCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBleHBpcmVzID0gbW9ub3RvbmljKCkgKyB0aW1lb3V0CgogICAgICAgIGFyZ3MgPSBsaXN0KGFyZ3MpCiAgICAgICAgaWYgcmVjYWxjX3RpbWVvdXQgYW5kICJ0aW1lb3V0IiBub3QgaW4ga3dhcmdzOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKAogICAgICAgICAgICAgICAgIlRpbWVvdXQgbXVzdCBiZSBpbiBhcmdzIG9yIGt3YXJncyB0byBiZSByZWNhbGN1bGF0ZWQiKQoKICAgICAgICByZXN1bHQgPSBfU1lTQ0FMTF9TRU5USU5FTAogICAgICAgIHdoaWxlIHJlc3VsdCBpcyBfU1lTQ0FMTF9TRU5USU5FTDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYygqYXJncywgKiprd2FyZ3MpCiAgICAgICAgICAgICMgT1NFcnJvciBpcyB0aHJvd24gYnkgc2VsZWN0LnNlbGVjdAogICAgICAgICAgICAjIElPRXJyb3IgaXMgdGhyb3duIGJ5IHNlbGVjdC5lcG9sbC5wb2xsCiAgICAgICAgICAgICMgc2VsZWN0LmVycm9yIGlzIHRocm93biBieSBzZWxlY3QucG9sbC5wb2xsCiAgICAgICAgICAgICMgQXJlbid0IHdlIHRoYW5rZnVsIGZvciBQeXRob24gMy54IHJld29yayBmb3IgZXhjZXB0aW9ucz8KICAgICAgICAgICAgZXhjZXB0IChPU0Vycm9yLCBJT0Vycm9yLCBzZWxlY3QuZXJyb3IpIGFzIGU6CiAgICAgICAgICAgICAgICAjIHNlbGVjdC5lcnJvciB3YXNuJ3QgYSBzdWJjbGFzcyBvZiBPU0Vycm9yIGluIHRoZSBwYXN0LgogICAgICAgICAgICAgICAgZXJyY29kZSA9IE5vbmUKICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIoZSwgImVycm5vIik6CiAgICAgICAgICAgICAgICAgICAgZXJyY29kZSA9IGUuZXJybm8KICAgICAgICAgICAgICAgIGVsaWYgaGFzYXR0cihlLCAiYXJncyIpOgogICAgICAgICAgICAgICAgICAgIGVycmNvZGUgPSBlLmFyZ3NbMF0KCiAgICAgICAgICAgICAgICAjIEFsc28gdGVzdCBmb3IgdGhlIFdpbmRvd3MgZXF1aXZhbGVudCBvZiBFSU5UUi4KICAgICAgICAgICAgICAgIGlzX2ludGVycnVwdCA9IChlcnJjb2RlID09IGVycm5vLkVJTlRSIG9yIChoYXNhdHRyKGVycm5vLCAiV1NBRUlOVFIiKSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJjb2RlID09IGVycm5vLldTQUVJTlRSKSkKCiAgICAgICAgICAgICAgICBpZiBpc19pbnRlcnJ1cHQ6CiAgICAgICAgICAgICAgICAgICAgaWYgZXhwaXJlcyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF90aW1lID0gbW9ub3RvbmljKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY3VycmVudF90aW1lID4gZXhwaXJlczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIE9TRXJyb3IoZXJybm89ZXJybm8uRVRJTUVET1VUKQogICAgICAgICAgICAgICAgICAgICAgICBpZiByZWNhbGNfdGltZW91dDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJ0aW1lb3V0IiBpbiBrd2FyZ3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga3dhcmdzWyJ0aW1lb3V0Il0gPSBleHBpcmVzIC0gY3VycmVudF90aW1lCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIGlmIGVycmNvZGU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgU2VsZWN0b3JFcnJvcihlcnJjb2RlKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgIHJldHVybiByZXN1bHQKCgpTZWxlY3RvcktleSA9IG5hbWVkdHVwbGUoJ1NlbGVjdG9yS2V5JywgWydmaWxlb2JqJywgJ2ZkJywgJ2V2ZW50cycsICdkYXRhJ10pCgoKY2xhc3MgX1NlbGVjdG9yTWFwcGluZyhNYXBwaW5nKToKICAgICIiIiBNYXBwaW5nIG9mIGZpbGUgb2JqZWN0cyB0byBzZWxlY3RvciBrZXlzICIiIgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzZWxlY3Rvcik6CiAgICAgICAgc2VsZi5fc2VsZWN0b3IgPSBzZWxlY3RvcgoKICAgIGRlZiBfX2xlbl9fKHNlbGYpOgogICAgICAgIHJldHVybiBsZW4oc2VsZi5fc2VsZWN0b3IuX2ZkX3RvX2tleSkKCiAgICBkZWYgX19nZXRpdGVtX18oc2VsZiwgZmlsZW9iaik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBmZCA9IHNlbGYuX3NlbGVjdG9yLl9maWxlb2JqX2xvb2t1cChmaWxlb2JqKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2VsZWN0b3IuX2ZkX3RvX2tleVtmZF0KICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHJhaXNlIEtleUVycm9yKCJ7MCFyfSBpcyBub3QgcmVnaXN0ZXJlZC4iLmZvcm1hdChmaWxlb2JqKSkKCiAgICBkZWYgX19pdGVyX18oc2VsZik6CiAgICAgICAgcmV0dXJuIGl0ZXIoc2VsZi5fc2VsZWN0b3IuX2ZkX3RvX2tleSkKCgpjbGFzcyBCYXNlU2VsZWN0b3Iob2JqZWN0KToKICAgICIiIiBBYnN0cmFjdCBTZWxlY3RvciBjbGFzcwoKICAgIEEgc2VsZWN0b3Igc3VwcG9ydHMgcmVnaXN0ZXJpbmcgZmlsZSBvYmplY3RzIHRvIGJlIG1vbml0b3JlZAogICAgZm9yIHNwZWNpZmljIEkvTyBldmVudHMuCgogICAgQSBmaWxlIG9iamVjdCBpcyBhIGZpbGUgZGVzY3JpcHRvciBvciBhbnkgb2JqZWN0IHdpdGggYQogICAgYGZpbGVubygpYCBtZXRob2QuIEFuIGFyYml0cmFyeSBvYmplY3QgY2FuIGJlIGF0dGFjaGVkIHRvIHRoZQogICAgZmlsZSBvYmplY3Qgd2hpY2ggY2FuIGJlIHVzZWQgZm9yIGV4YW1wbGUgdG8gc3RvcmUgY29udGV4dCBpbmZvLAogICAgYSBjYWxsYmFjaywgZXRjLgoKICAgIEEgc2VsZWN0b3IgY2FuIHVzZSB2YXJpb3VzIGltcGxlbWVudGF0aW9ucyAoc2VsZWN0KCksIHBvbGwoKSwgZXBvbGwoKSwKICAgIGFuZCBrcXVldWUoKSkgZGVwZW5kaW5nIG9uIHRoZSBwbGF0Zm9ybS4gVGhlICdEZWZhdWx0U2VsZWN0b3InIGNsYXNzIHVzZXMKICAgIHRoZSBtb3N0IGVmZmljaWVudCBpbXBsZW1lbnRhdGlvbiBmb3IgdGhlIGN1cnJlbnQgcGxhdGZvcm0uCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAjIE1hcHMgZmlsZSBkZXNjcmlwdG9ycyB0byBrZXlzLgogICAgICAgIHNlbGYuX2ZkX3RvX2tleSA9IHt9CgogICAgICAgICMgUmVhZC1vbmx5IG1hcHBpbmcgcmV0dXJuZWQgYnkgZ2V0X21hcCgpCiAgICAgICAgc2VsZi5fbWFwID0gX1NlbGVjdG9yTWFwcGluZyhzZWxmKQoKICAgIGRlZiBfZmlsZW9ial9sb29rdXAoc2VsZiwgZmlsZW9iaik6CiAgICAgICAgIiIiIFJldHVybiBhIGZpbGUgZGVzY3JpcHRvciBmcm9tIGEgZmlsZSBvYmplY3QuCiAgICAgICAgVGhpcyB3cmFwcyBfZmlsZW9ial90b19mZCgpIHRvIGRvIGFuIGV4aGF1c3RpdmUKICAgICAgICBzZWFyY2ggaW4gY2FzZSB0aGUgb2JqZWN0IGlzIGludmFsaWQgYnV0IHdlIHN0aWxsCiAgICAgICAgaGF2ZSBpdCBpbiBvdXIgbWFwLiBVc2VkIGJ5IHVucmVnaXN0ZXIoKSBzbyB3ZSBjYW4KICAgICAgICB1bnJlZ2lzdGVyIGFuIG9iamVjdCB0aGF0IHdhcyBwcmV2aW91c2x5IHJlZ2lzdGVyZWQKICAgICAgICBldmVuIGlmIGl0IGlzIGNsb3NlZC4gSXQgaXMgYWxzbyB1c2VkIGJ5IF9TZWxlY3Rvck1hcHBpbmcKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiBfZmlsZW9ial90b19mZChmaWxlb2JqKQogICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgoKICAgICAgICAgICAgIyBTZWFyY2ggdGhyb3VnaCBhbGwgb3VyIG1hcHBlZCBrZXlzLgogICAgICAgICAgICBmb3Iga2V5IGluIHNlbGYuX2ZkX3RvX2tleS52YWx1ZXMoKToKICAgICAgICAgICAgICAgIGlmIGtleS5maWxlb2JqIGlzIGZpbGVvYmo6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleS5mZAoKICAgICAgICAgICAgIyBSYWlzZSBWYWx1ZUVycm9yIGFmdGVyIGFsbC4KICAgICAgICAgICAgcmFpc2UKCiAgICBkZWYgcmVnaXN0ZXIoc2VsZiwgZmlsZW9iaiwgZXZlbnRzLCBkYXRhPU5vbmUpOgogICAgICAgICIiIiBSZWdpc3RlciBhIGZpbGUgb2JqZWN0IGZvciBhIHNldCBvZiBldmVudHMgdG8gbW9uaXRvci4gIiIiCiAgICAgICAgaWYgKG5vdCBldmVudHMpIG9yIChldmVudHMgJiB+KEVWRU5UX1JFQUQgfCBFVkVOVF9XUklURSkpOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJJbnZhbGlkIGV2ZW50czogezAhcn0iLmZvcm1hdChldmVudHMpKQoKICAgICAgICBrZXkgPSBTZWxlY3RvcktleShmaWxlb2JqLCBzZWxmLl9maWxlb2JqX2xvb2t1cChmaWxlb2JqKSwgZXZlbnRzLCBkYXRhKQoKICAgICAgICBpZiBrZXkuZmQgaW4gc2VsZi5fZmRfdG9fa2V5OgogICAgICAgICAgICByYWlzZSBLZXlFcnJvcigiezAhcn0gKEZEIHsxfSkgaXMgYWxyZWFkeSByZWdpc3RlcmVkIgogICAgICAgICAgICAgICAgICAgICAgICAgICAuZm9ybWF0KGZpbGVvYmosIGtleS5mZCkpCgogICAgICAgIHNlbGYuX2ZkX3RvX2tleVtrZXkuZmRdID0ga2V5CiAgICAgICAgcmV0dXJuIGtleQoKICAgIGRlZiB1bnJlZ2lzdGVyKHNlbGYsIGZpbGVvYmopOgogICAgICAgICIiIiBVbnJlZ2lzdGVyIGEgZmlsZSBvYmplY3QgZnJvbSBiZWluZyBtb25pdG9yZWQuICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAga2V5ID0gc2VsZi5fZmRfdG9fa2V5LnBvcChzZWxmLl9maWxlb2JqX2xvb2t1cChmaWxlb2JqKSkKICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHJhaXNlIEtleUVycm9yKCJ7MCFyfSBpcyBub3QgcmVnaXN0ZXJlZCIuZm9ybWF0KGZpbGVvYmopKQoKICAgICAgICAjIEdldHRpbmcgdGhlIGZpbGVubyBvZiBhIGNsb3NlZCBzb2NrZXQgb24gV2luZG93cyBlcnJvcnMgd2l0aCBFQkFERi4KICAgICAgICBleGNlcHQgc29ja2V0LmVycm9yIGFzIGU6ICAjIFBsYXRmb3JtLXNwZWNpZmljOiBXaW5kb3dzLgogICAgICAgICAgICBpZiBlLmVycm5vICE9IGVycm5vLkVCQURGOgogICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGZvciBrZXkgaW4gc2VsZi5fZmRfdG9fa2V5LnZhbHVlcygpOgogICAgICAgICAgICAgICAgICAgIGlmIGtleS5maWxlb2JqIGlzIGZpbGVvYmo6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2ZkX3RvX2tleS5wb3Aoa2V5LmZkKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByYWlzZSBLZXlFcnJvcigiezAhcn0gaXMgbm90IHJlZ2lzdGVyZWQiLmZvcm1hdChmaWxlb2JqKSkKICAgICAgICByZXR1cm4ga2V5CgogICAgZGVmIG1vZGlmeShzZWxmLCBmaWxlb2JqLCBldmVudHMsIGRhdGE9Tm9uZSk6CiAgICAgICAgIiIiIENoYW5nZSBhIHJlZ2lzdGVyZWQgZmlsZSBvYmplY3QgbW9uaXRvcmVkIGV2ZW50cyBhbmQgZGF0YS4gIiIiCiAgICAgICAgIyBOT1RFOiBTb21lIHN1YmNsYXNzZXMgb3B0aW1pemUgdGhpcyBvcGVyYXRpb24gZXZlbiBmdXJ0aGVyLgogICAgICAgIHRyeToKICAgICAgICAgICAga2V5ID0gc2VsZi5fZmRfdG9fa2V5W3NlbGYuX2ZpbGVvYmpfbG9va3VwKGZpbGVvYmopXQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcmFpc2UgS2V5RXJyb3IoInswIXJ9IGlzIG5vdCByZWdpc3RlcmVkIi5mb3JtYXQoZmlsZW9iaikpCgogICAgICAgIGlmIGV2ZW50cyAhPSBrZXkuZXZlbnRzOgogICAgICAgICAgICBzZWxmLnVucmVnaXN0ZXIoZmlsZW9iaikKICAgICAgICAgICAga2V5ID0gc2VsZi5yZWdpc3RlcihmaWxlb2JqLCBldmVudHMsIGRhdGEpCgogICAgICAgIGVsaWYgZGF0YSAhPSBrZXkuZGF0YToKICAgICAgICAgICAgIyBVc2UgYSBzaG9ydGN1dCB0byB1cGRhdGUgdGhlIGRhdGEuCiAgICAgICAgICAgIGtleSA9IGtleS5fcmVwbGFjZShkYXRhPWRhdGEpCiAgICAgICAgICAgIHNlbGYuX2ZkX3RvX2tleVtrZXkuZmRdID0ga2V5CgogICAgICAgIHJldHVybiBrZXkKCiAgICBkZWYgc2VsZWN0KHNlbGYsIHRpbWVvdXQ9Tm9uZSk6CiAgICAgICAgIiIiIFBlcmZvcm0gdGhlIGFjdHVhbCBzZWxlY3Rpb24gdW50aWwgc29tZSBtb25pdG9yZWQgZmlsZSBvYmplY3RzCiAgICAgICAgYXJlIHJlYWR5IG9yIHRoZSB0aW1lb3V0IGV4cGlyZXMuICIiIgogICAgICAgIHJhaXNlIE5vdEltcGxlbWVudGVkRXJyb3IoKQoKICAgIGRlZiBjbG9zZShzZWxmKToKICAgICAgICAiIiIgQ2xvc2UgdGhlIHNlbGVjdG9yLiBUaGlzIG11c3QgYmUgY2FsbGVkIHRvIGVuc3VyZSB0aGF0IGFsbAogICAgICAgIHVuZGVybHlpbmcgcmVzb3VyY2VzIGFyZSBmcmVlZC4gIiIiCiAgICAgICAgc2VsZi5fZmRfdG9fa2V5LmNsZWFyKCkKICAgICAgICBzZWxmLl9tYXAgPSBOb25lCgogICAgZGVmIGdldF9rZXkoc2VsZiwgZmlsZW9iaik6CiAgICAgICAgIiIiIFJldHVybiB0aGUga2V5IGFzc29jaWF0ZWQgd2l0aCBhIHJlZ2lzdGVyZWQgZmlsZSBvYmplY3QuICIiIgogICAgICAgIG1hcHBpbmcgPSBzZWxmLmdldF9tYXAoKQogICAgICAgIGlmIG1hcHBpbmcgaXMgTm9uZToKICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKCJTZWxlY3RvciBpcyBjbG9zZWQiKQogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIG1hcHBpbmdbZmlsZW9ial0KICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHJhaXNlIEtleUVycm9yKCJ7MCFyfSBpcyBub3QgcmVnaXN0ZXJlZCIuZm9ybWF0KGZpbGVvYmopKQoKICAgIGRlZiBnZXRfbWFwKHNlbGYpOgogICAgICAgICIiIiBSZXR1cm4gYSBtYXBwaW5nIG9mIGZpbGUgb2JqZWN0cyB0byBzZWxlY3RvciBrZXlzICIiIgogICAgICAgIHJldHVybiBzZWxmLl9tYXAKCiAgICBkZWYgX2tleV9mcm9tX2ZkKHNlbGYsIGZkKToKICAgICAgICAiIiIgUmV0dXJuIHRoZSBrZXkgYXNzb2NpYXRlZCB0byBhIGdpdmVuIGZpbGUgZGVzY3JpcHRvcgogICAgICAgICBSZXR1cm4gTm9uZSBpZiBpdCBpcyBub3QgZm91bmQuICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2ZkX3RvX2tleVtmZF0KICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIF9fZW50ZXJfXyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZgoKICAgIGRlZiBfX2V4aXRfXyhzZWxmLCAqYXJncyk6CiAgICAgICAgc2VsZi5jbG9zZSgpCgoKIyBBbG1vc3QgYWxsIHBsYXRmb3JtcyBoYXZlIHNlbGVjdC5zZWxlY3QoKQppZiBoYXNhdHRyKHNlbGVjdCwgInNlbGVjdCIpOgogICAgY2xhc3MgU2VsZWN0U2VsZWN0b3IoQmFzZVNlbGVjdG9yKToKICAgICAgICAiIiIgU2VsZWN0LWJhc2VkIHNlbGVjdG9yLiAiIiIKICAgICAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgICAgIHN1cGVyKFNlbGVjdFNlbGVjdG9yLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgICAgIHNlbGYuX3JlYWRlcnMgPSBzZXQoKQogICAgICAgICAgICBzZWxmLl93cml0ZXJzID0gc2V0KCkKCiAgICAgICAgZGVmIHJlZ2lzdGVyKHNlbGYsIGZpbGVvYmosIGV2ZW50cywgZGF0YT1Ob25lKToKICAgICAgICAgICAga2V5ID0gc3VwZXIoU2VsZWN0U2VsZWN0b3IsIHNlbGYpLnJlZ2lzdGVyKGZpbGVvYmosIGV2ZW50cywgZGF0YSkKICAgICAgICAgICAgaWYgZXZlbnRzICYgRVZFTlRfUkVBRDoKICAgICAgICAgICAgICAgIHNlbGYuX3JlYWRlcnMuYWRkKGtleS5mZCkKICAgICAgICAgICAgaWYgZXZlbnRzICYgRVZFTlRfV1JJVEU6CiAgICAgICAgICAgICAgICBzZWxmLl93cml0ZXJzLmFkZChrZXkuZmQpCiAgICAgICAgICAgIHJldHVybiBrZXkKCiAgICAgICAgZGVmIHVucmVnaXN0ZXIoc2VsZiwgZmlsZW9iaik6CiAgICAgICAgICAgIGtleSA9IHN1cGVyKFNlbGVjdFNlbGVjdG9yLCBzZWxmKS51bnJlZ2lzdGVyKGZpbGVvYmopCiAgICAgICAgICAgIHNlbGYuX3JlYWRlcnMuZGlzY2FyZChrZXkuZmQpCiAgICAgICAgICAgIHNlbGYuX3dyaXRlcnMuZGlzY2FyZChrZXkuZmQpCiAgICAgICAgICAgIHJldHVybiBrZXkKCiAgICAgICAgZGVmIF9zZWxlY3Qoc2VsZiwgciwgdywgdGltZW91dD1Ob25lKToKICAgICAgICAgICAgIiIiIFdyYXBwZXIgZm9yIHNlbGVjdC5zZWxlY3QgYmVjYXVzZSB0aW1lb3V0IGlzIGEgcG9zaXRpb25hbCBhcmcgIiIiCiAgICAgICAgICAgIHJldHVybiBzZWxlY3Quc2VsZWN0KHIsIHcsIFtdLCB0aW1lb3V0KQoKICAgICAgICBkZWYgc2VsZWN0KHNlbGYsIHRpbWVvdXQ9Tm9uZSk6CiAgICAgICAgICAgICMgU2VsZWN0aW5nIG9uIGVtcHR5IGxpc3RzIG9uIFdpbmRvd3MgZXJyb3JzIG91dC4KICAgICAgICAgICAgaWYgbm90IGxlbihzZWxmLl9yZWFkZXJzKSBhbmQgbm90IGxlbihzZWxmLl93cml0ZXJzKToKICAgICAgICAgICAgICAgIHJldHVybiBbXQoKICAgICAgICAgICAgdGltZW91dCA9IE5vbmUgaWYgdGltZW91dCBpcyBOb25lIGVsc2UgbWF4KHRpbWVvdXQsIDAuMCkKICAgICAgICAgICAgcmVhZHkgPSBbXQogICAgICAgICAgICByLCB3LCBfID0gX3N5c2NhbGxfd3JhcHBlcihzZWxmLl9zZWxlY3QsIFRydWUsIHNlbGYuX3JlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3dyaXRlcnMsIHRpbWVvdXQpCiAgICAgICAgICAgIHIgPSBzZXQocikKICAgICAgICAgICAgdyA9IHNldCh3KQogICAgICAgICAgICBmb3IgZmQgaW4gciB8IHc6CiAgICAgICAgICAgICAgICBldmVudHMgPSAwCiAgICAgICAgICAgICAgICBpZiBmZCBpbiByOgogICAgICAgICAgICAgICAgICAgIGV2ZW50cyB8PSBFVkVOVF9SRUFECiAgICAgICAgICAgICAgICBpZiBmZCBpbiB3OgogICAgICAgICAgICAgICAgICAgIGV2ZW50cyB8PSBFVkVOVF9XUklURQoKICAgICAgICAgICAgICAgIGtleSA9IHNlbGYuX2tleV9mcm9tX2ZkKGZkKQogICAgICAgICAgICAgICAgaWYga2V5OgogICAgICAgICAgICAgICAgICAgIHJlYWR5LmFwcGVuZCgoa2V5LCBldmVudHMgJiBrZXkuZXZlbnRzKSkKICAgICAgICAgICAgcmV0dXJuIHJlYWR5CgoKaWYgaGFzYXR0cihzZWxlY3QsICJwb2xsIik6CiAgICBjbGFzcyBQb2xsU2VsZWN0b3IoQmFzZVNlbGVjdG9yKToKICAgICAgICAiIiIgUG9sbC1iYXNlZCBzZWxlY3RvciAiIiIKICAgICAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgICAgIHN1cGVyKFBvbGxTZWxlY3Rvciwgc2VsZikuX19pbml0X18oKQogICAgICAgICAgICBzZWxmLl9wb2xsID0gc2VsZWN0LnBvbGwoKQoKICAgICAgICBkZWYgcmVnaXN0ZXIoc2VsZiwgZmlsZW9iaiwgZXZlbnRzLCBkYXRhPU5vbmUpOgogICAgICAgICAgICBrZXkgPSBzdXBlcihQb2xsU2VsZWN0b3IsIHNlbGYpLnJlZ2lzdGVyKGZpbGVvYmosIGV2ZW50cywgZGF0YSkKICAgICAgICAgICAgZXZlbnRfbWFzayA9IDAKICAgICAgICAgICAgaWYgZXZlbnRzICYgRVZFTlRfUkVBRDoKICAgICAgICAgICAgICAgIGV2ZW50X21hc2sgfD0gc2VsZWN0LlBPTExJTgogICAgICAgICAgICBpZiBldmVudHMgJiBFVkVOVF9XUklURToKICAgICAgICAgICAgICAgIGV2ZW50X21hc2sgfD0gc2VsZWN0LlBPTExPVVQKICAgICAgICAgICAgc2VsZi5fcG9sbC5yZWdpc3RlcihrZXkuZmQsIGV2ZW50X21hc2spCiAgICAgICAgICAgIHJldHVybiBrZXkKCiAgICAgICAgZGVmIHVucmVnaXN0ZXIoc2VsZiwgZmlsZW9iaik6CiAgICAgICAgICAgIGtleSA9IHN1cGVyKFBvbGxTZWxlY3Rvciwgc2VsZikudW5yZWdpc3RlcihmaWxlb2JqKQogICAgICAgICAgICBzZWxmLl9wb2xsLnVucmVnaXN0ZXIoa2V5LmZkKQogICAgICAgICAgICByZXR1cm4ga2V5CgogICAgICAgIGRlZiBfd3JhcF9wb2xsKHNlbGYsIHRpbWVvdXQ9Tm9uZSk6CiAgICAgICAgICAgICIiIiBXcmFwcGVyIGZ1bmN0aW9uIGZvciBzZWxlY3QucG9sbC5wb2xsKCkgc28gdGhhdAogICAgICAgICAgICBfc3lzY2FsbF93cmFwcGVyIGNhbiB3b3JrIHdpdGggb25seSBzZWNvbmRzLiAiIiIKICAgICAgICAgICAgaWYgdGltZW91dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGlmIHRpbWVvdXQgPD0gMDoKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gMAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIHNlbGVjdC5wb2xsLnBvbGwoKSBoYXMgYSByZXNvbHV0aW9uIG9mIDEgbWlsbGlzZWNvbmQsCiAgICAgICAgICAgICAgICAgICAgIyByb3VuZCBhd2F5IGZyb20gemVybyB0byB3YWl0ICphdCBsZWFzdCogdGltZW91dCBzZWNvbmRzLgogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBtYXRoLmNlaWwodGltZW91dCAqIDFlMykKCiAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuX3BvbGwucG9sbCh0aW1lb3V0KQogICAgICAgICAgICByZXR1cm4gcmVzdWx0CgogICAgICAgIGRlZiBzZWxlY3Qoc2VsZiwgdGltZW91dD1Ob25lKToKICAgICAgICAgICAgcmVhZHkgPSBbXQogICAgICAgICAgICBmZF9ldmVudHMgPSBfc3lzY2FsbF93cmFwcGVyKHNlbGYuX3dyYXBfcG9sbCwgVHJ1ZSwgdGltZW91dD10aW1lb3V0KQogICAgICAgICAgICBmb3IgZmQsIGV2ZW50X21hc2sgaW4gZmRfZXZlbnRzOgogICAgICAgICAgICAgICAgZXZlbnRzID0gMAogICAgICAgICAgICAgICAgaWYgZXZlbnRfbWFzayAmIH5zZWxlY3QuUE9MTElOOgogICAgICAgICAgICAgICAgICAgIGV2ZW50cyB8PSBFVkVOVF9XUklURQogICAgICAgICAgICAgICAgaWYgZXZlbnRfbWFzayAmIH5zZWxlY3QuUE9MTE9VVDoKICAgICAgICAgICAgICAgICAgICBldmVudHMgfD0gRVZFTlRfUkVBRAoKICAgICAgICAgICAgICAgIGtleSA9IHNlbGYuX2tleV9mcm9tX2ZkKGZkKQogICAgICAgICAgICAgICAgaWYga2V5OgogICAgICAgICAgICAgICAgICAgIHJlYWR5LmFwcGVuZCgoa2V5LCBldmVudHMgJiBrZXkuZXZlbnRzKSkKCiAgICAgICAgICAgIHJldHVybiByZWFkeQoKCmlmIGhhc2F0dHIoc2VsZWN0LCAiZXBvbGwiKToKICAgIGNsYXNzIEVwb2xsU2VsZWN0b3IoQmFzZVNlbGVjdG9yKToKICAgICAgICAiIiIgRXBvbGwtYmFzZWQgc2VsZWN0b3IgIiIiCiAgICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBzdXBlcihFcG9sbFNlbGVjdG9yLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgICAgIHNlbGYuX2Vwb2xsID0gc2VsZWN0LmVwb2xsKCkKCiAgICAgICAgZGVmIGZpbGVubyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2Vwb2xsLmZpbGVubygpCgogICAgICAgIGRlZiByZWdpc3RlcihzZWxmLCBmaWxlb2JqLCBldmVudHMsIGRhdGE9Tm9uZSk6CiAgICAgICAgICAgIGtleSA9IHN1cGVyKEVwb2xsU2VsZWN0b3IsIHNlbGYpLnJlZ2lzdGVyKGZpbGVvYmosIGV2ZW50cywgZGF0YSkKICAgICAgICAgICAgZXZlbnRzX21hc2sgPSAwCiAgICAgICAgICAgIGlmIGV2ZW50cyAmIEVWRU5UX1JFQUQ6CiAgICAgICAgICAgICAgICBldmVudHNfbWFzayB8PSBzZWxlY3QuRVBPTExJTgogICAgICAgICAgICBpZiBldmVudHMgJiBFVkVOVF9XUklURToKICAgICAgICAgICAgICAgIGV2ZW50c19tYXNrIHw9IHNlbGVjdC5FUE9MTE9VVAogICAgICAgICAgICBfc3lzY2FsbF93cmFwcGVyKHNlbGYuX2Vwb2xsLnJlZ2lzdGVyLCBGYWxzZSwga2V5LmZkLCBldmVudHNfbWFzaykKICAgICAgICAgICAgcmV0dXJuIGtleQoKICAgICAgICBkZWYgdW5yZWdpc3RlcihzZWxmLCBmaWxlb2JqKToKICAgICAgICAgICAga2V5ID0gc3VwZXIoRXBvbGxTZWxlY3Rvciwgc2VsZikudW5yZWdpc3RlcihmaWxlb2JqKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBfc3lzY2FsbF93cmFwcGVyKHNlbGYuX2Vwb2xsLnVucmVnaXN0ZXIsIEZhbHNlLCBrZXkuZmQpCiAgICAgICAgICAgIGV4Y2VwdCBTZWxlY3RvckVycm9yOgogICAgICAgICAgICAgICAgIyBUaGlzIGNhbiBvY2N1ciB3aGVuIHRoZSBmZCB3YXMgY2xvc2VkIHNpbmNlIHJlZ2lzdHJ5LgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICByZXR1cm4ga2V5CgogICAgICAgIGRlZiBzZWxlY3Qoc2VsZiwgdGltZW91dD1Ob25lKToKICAgICAgICAgICAgaWYgdGltZW91dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGlmIHRpbWVvdXQgPD0gMDoKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gMC4wCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgc2VsZWN0LmVwb2xsLnBvbGwoKSBoYXMgYSByZXNvbHV0aW9uIG9mIDEgbWlsbGlzZWNvbmQKICAgICAgICAgICAgICAgICAgICAjIGJ1dCBsdWNraWx5IHRha2VzIHNlY29uZHMgc28gd2UgZG9uJ3QgbmVlZCBhIHdyYXBwZXIKICAgICAgICAgICAgICAgICAgICAjIGxpa2UgUG9sbFNlbGVjdG9yLiBKdXN0IGZvciBiZXR0ZXIgcm91bmRpbmcuCiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG1hdGguY2VpbCh0aW1lb3V0ICogMWUzKSAqIDFlLTMKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBmbG9hdCh0aW1lb3V0KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdGltZW91dCA9IC0xLjAgICMgZXBvbGwucG9sbCgpIG11c3QgaGF2ZSBhIGZsb2F0LgoKICAgICAgICAgICAgIyBXZSBhbHdheXMgd2FudCBhdCBsZWFzdCAxIHRvIGVuc3VyZSB0aGF0IHNlbGVjdCBjYW4gYmUgY2FsbGVkCiAgICAgICAgICAgICMgd2l0aCBubyBmaWxlIGRlc2NyaXB0b3JzIHJlZ2lzdGVyZWQuIE90aGVyd2lzZSB3aWxsIGZhaWwuCiAgICAgICAgICAgIG1heF9ldmVudHMgPSBtYXgobGVuKHNlbGYuX2ZkX3RvX2tleSksIDEpCgogICAgICAgICAgICByZWFkeSA9IFtdCiAgICAgICAgICAgIGZkX2V2ZW50cyA9IF9zeXNjYWxsX3dyYXBwZXIoc2VsZi5fZXBvbGwucG9sbCwgVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ZXZlbnRzPW1heF9ldmVudHMpCiAgICAgICAgICAgIGZvciBmZCwgZXZlbnRfbWFzayBpbiBmZF9ldmVudHM6CiAgICAgICAgICAgICAgICBldmVudHMgPSAwCiAgICAgICAgICAgICAgICBpZiBldmVudF9tYXNrICYgfnNlbGVjdC5FUE9MTElOOgogICAgICAgICAgICAgICAgICAgIGV2ZW50cyB8PSBFVkVOVF9XUklURQogICAgICAgICAgICAgICAgaWYgZXZlbnRfbWFzayAmIH5zZWxlY3QuRVBPTExPVVQ6CiAgICAgICAgICAgICAgICAgICAgZXZlbnRzIHw9IEVWRU5UX1JFQUQKCiAgICAgICAgICAgICAgICBrZXkgPSBzZWxmLl9rZXlfZnJvbV9mZChmZCkKICAgICAgICAgICAgICAgIGlmIGtleToKICAgICAgICAgICAgICAgICAgICByZWFkeS5hcHBlbmQoKGtleSwgZXZlbnRzICYga2V5LmV2ZW50cykpCiAgICAgICAgICAgIHJldHVybiByZWFkeQoKICAgICAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgICAgIHNlbGYuX2Vwb2xsLmNsb3NlKCkKICAgICAgICAgICAgc3VwZXIoRXBvbGxTZWxlY3Rvciwgc2VsZikuY2xvc2UoKQoKCmlmIGhhc2F0dHIoc2VsZWN0LCAia3F1ZXVlIik6CiAgICBjbGFzcyBLcXVldWVTZWxlY3RvcihCYXNlU2VsZWN0b3IpOgogICAgICAgICIiIiBLcXVldWUgLyBLZXZlbnQtYmFzZWQgc2VsZWN0b3IgIiIiCiAgICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgICAgICBzdXBlcihLcXVldWVTZWxlY3Rvciwgc2VsZikuX19pbml0X18oKQogICAgICAgICAgICBzZWxmLl9rcXVldWUgPSBzZWxlY3Qua3F1ZXVlKCkKCiAgICAgICAgZGVmIGZpbGVubyhzZWxmKToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2txdWV1ZS5maWxlbm8oKQoKICAgICAgICBkZWYgcmVnaXN0ZXIoc2VsZiwgZmlsZW9iaiwgZXZlbnRzLCBkYXRhPU5vbmUpOgogICAgICAgICAgICBrZXkgPSBzdXBlcihLcXVldWVTZWxlY3Rvciwgc2VsZikucmVnaXN0ZXIoZmlsZW9iaiwgZXZlbnRzLCBkYXRhKQogICAgICAgICAgICBpZiBldmVudHMgJiBFVkVOVF9SRUFEOgogICAgICAgICAgICAgICAga2V2ZW50ID0gc2VsZWN0LmtldmVudChrZXkuZmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdC5LUV9GSUxURVJfUkVBRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0LktRX0VWX0FERCkKCiAgICAgICAgICAgICAgICBfc3lzY2FsbF93cmFwcGVyKHNlbGYuX2txdWV1ZS5jb250cm9sLCBGYWxzZSwgW2tldmVudF0sIDAsIDApCgogICAgICAgICAgICBpZiBldmVudHMgJiBFVkVOVF9XUklURToKICAgICAgICAgICAgICAgIGtldmVudCA9IHNlbGVjdC5rZXZlbnQoa2V5LmZkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3QuS1FfRklMVEVSX1dSSVRFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3QuS1FfRVZfQUREKQoKICAgICAgICAgICAgICAgIF9zeXNjYWxsX3dyYXBwZXIoc2VsZi5fa3F1ZXVlLmNvbnRyb2wsIEZhbHNlLCBba2V2ZW50XSwgMCwgMCkKCiAgICAgICAgICAgIHJldHVybiBrZXkKCiAgICAgICAgZGVmIHVucmVnaXN0ZXIoc2VsZiwgZmlsZW9iaik6CiAgICAgICAgICAgIGtleSA9IHN1cGVyKEtxdWV1ZVNlbGVjdG9yLCBzZWxmKS51bnJlZ2lzdGVyKGZpbGVvYmopCiAgICAgICAgICAgIGlmIGtleS5ldmVudHMgJiBFVkVOVF9SRUFEOgogICAgICAgICAgICAgICAga2V2ZW50ID0gc2VsZWN0LmtldmVudChrZXkuZmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdC5LUV9GSUxURVJfUkVBRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0LktRX0VWX0RFTEVURSkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBfc3lzY2FsbF93cmFwcGVyKHNlbGYuX2txdWV1ZS5jb250cm9sLCBGYWxzZSwgW2tldmVudF0sIDAsIDApCiAgICAgICAgICAgICAgICBleGNlcHQgU2VsZWN0b3JFcnJvcjoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGlmIGtleS5ldmVudHMgJiBFVkVOVF9XUklURToKICAgICAgICAgICAgICAgIGtldmVudCA9IHNlbGVjdC5rZXZlbnQoa2V5LmZkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3QuS1FfRklMVEVSX1dSSVRFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3QuS1FfRVZfREVMRVRFKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIF9zeXNjYWxsX3dyYXBwZXIoc2VsZi5fa3F1ZXVlLmNvbnRyb2wsIEZhbHNlLCBba2V2ZW50XSwgMCwgMCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBTZWxlY3RvckVycm9yOgogICAgICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgIHJldHVybiBrZXkKCiAgICAgICAgZGVmIHNlbGVjdChzZWxmLCB0aW1lb3V0PU5vbmUpOgogICAgICAgICAgICBpZiB0aW1lb3V0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdGltZW91dCA9IG1heCh0aW1lb3V0LCAwKQoKICAgICAgICAgICAgbWF4X2V2ZW50cyA9IGxlbihzZWxmLl9mZF90b19rZXkpICogMgogICAgICAgICAgICByZWFkeV9mZHMgPSB7fQoKICAgICAgICAgICAga2V2ZW50X2xpc3QgPSBfc3lzY2FsbF93cmFwcGVyKHNlbGYuX2txdWV1ZS5jb250cm9sLCBUcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTm9uZSwgbWF4X2V2ZW50cywgdGltZW91dCkKCiAgICAgICAgICAgIGZvciBrZXZlbnQgaW4ga2V2ZW50X2xpc3Q6CiAgICAgICAgICAgICAgICBmZCA9IGtldmVudC5pZGVudAogICAgICAgICAgICAgICAgZXZlbnRfbWFzayA9IGtldmVudC5maWx0ZXIKICAgICAgICAgICAgICAgIGV2ZW50cyA9IDAKICAgICAgICAgICAgICAgIGlmIGV2ZW50X21hc2sgPT0gc2VsZWN0LktRX0ZJTFRFUl9SRUFEOgogICAgICAgICAgICAgICAgICAgIGV2ZW50cyB8PSBFVkVOVF9SRUFECiAgICAgICAgICAgICAgICBpZiBldmVudF9tYXNrID09IHNlbGVjdC5LUV9GSUxURVJfV1JJVEU6CiAgICAgICAgICAgICAgICAgICAgZXZlbnRzIHw9IEVWRU5UX1dSSVRFCgogICAgICAgICAgICAgICAga2V5ID0gc2VsZi5fa2V5X2Zyb21fZmQoZmQpCiAgICAgICAgICAgICAgICBpZiBrZXk6CiAgICAgICAgICAgICAgICAgICAgaWYga2V5LmZkIG5vdCBpbiByZWFkeV9mZHM6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWR5X2Zkc1trZXkuZmRdID0gKGtleSwgZXZlbnRzICYga2V5LmV2ZW50cykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBvbGRfZXZlbnRzID0gcmVhZHlfZmRzW2tleS5mZF1bMV0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZHlfZmRzW2tleS5mZF0gPSAoa2V5LCAoZXZlbnRzIHwgb2xkX2V2ZW50cykgJiBrZXkuZXZlbnRzKQoKICAgICAgICAgICAgcmV0dXJuIGxpc3QocmVhZHlfZmRzLnZhbHVlcygpKQoKICAgICAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgICAgIHNlbGYuX2txdWV1ZS5jbG9zZSgpCiAgICAgICAgICAgIHN1cGVyKEtxdWV1ZVNlbGVjdG9yLCBzZWxmKS5jbG9zZSgpCgoKaWYgbm90IGhhc2F0dHIoc2VsZWN0LCAnc2VsZWN0Jyk6ICAjIFBsYXRmb3JtLXNwZWNpZmljOiBBcHBFbmdpbmUKICAgIEhBU19TRUxFQ1QgPSBGYWxzZQoKCmRlZiBfY2FuX2FsbG9jYXRlKHN0cnVjdCk6CiAgICAiIiIgQ2hlY2tzIHRoYXQgc2VsZWN0IHN0cnVjdHMgY2FuIGJlIGFsbG9jYXRlZCBieSB0aGUgdW5kZXJseWluZwogICAgb3BlcmF0aW5nIHN5c3RlbSwgbm90IGp1c3QgYWR2ZXJ0aXNlZCBieSB0aGUgc2VsZWN0IG1vZHVsZS4gV2UgZG9uJ3QKICAgIGNoZWNrIHNlbGVjdCgpIGJlY2F1c2Ugd2UnbGwgYmUgaG9wZWZ1bCB0aGF0IG1vc3QgcGxhdGZvcm1zIHRoYXQKICAgIGRvbid0IGhhdmUgaXQgYXZhaWxhYmxlIHdpbGwgbm90IGFkdmVydGlzZSBpdC4gKGllOiBHQUUpICIiIgogICAgdHJ5OgogICAgICAgICMgc2VsZWN0LnBvbGwoKSBvYmplY3RzIHdvbid0IGZhaWwgdW50aWwgdXNlZC4KICAgICAgICBpZiBzdHJ1Y3QgPT0gJ3BvbGwnOgogICAgICAgICAgICBwID0gc2VsZWN0LnBvbGwoKQogICAgICAgICAgICBwLnBvbGwoMCkKCiAgICAgICAgIyBBbGwgb3RoZXJzIHdpbGwgZmFpbCBvbiBhbGxvY2F0aW9uLgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGdldGF0dHIoc2VsZWN0LCBzdHJ1Y3QpKCkuY2xvc2UoKQogICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQgKE9TRXJyb3IsIEF0dHJpYnV0ZUVycm9yKSBhcyBlOgogICAgICAgIHJldHVybiBGYWxzZQoKCiMgQ2hvb3NlIHRoZSBiZXN0IGltcGxlbWVudGF0aW9uLCByb3VnaGx5OgojIGtxdWV1ZSA9PSBlcG9sbCA+IHBvbGwgPiBzZWxlY3QuIERldnBvbGwgbm90IHN1cHBvcnRlZC4gKFNlZSBhYm92ZSkKIyBzZWxlY3QoKSBhbHNvIGNhbid0IGFjY2VwdCBhIEZEID4gRkRfU0VUU0laRSAodXN1YWxseSBhcm91bmQgMTAyNCkKZGVmIERlZmF1bHRTZWxlY3RvcigpOgogICAgIiIiIFRoaXMgZnVuY3Rpb24gc2VydmVzIGFzIGEgZmlyc3QgY2FsbCBmb3IgRGVmYXVsdFNlbGVjdG9yIHRvCiAgICBkZXRlY3QgaWYgdGhlIHNlbGVjdCBtb2R1bGUgaXMgYmVpbmcgbW9ua2V5LXBhdGNoZWQgaW5jb3JyZWN0bHkKICAgIGJ5IGV2ZW50bGV0LCBncmVlbmxldCwgYW5kIHByZXNlcnZlIHByb3BlciBiZWhhdmlvci4gIiIiCiAgICBnbG9iYWwgX0RFRkFVTFRfU0VMRUNUT1IKICAgIGlmIF9ERUZBVUxUX1NFTEVDVE9SIGlzIE5vbmU6CiAgICAgICAgaWYgX2Nhbl9hbGxvY2F0ZSgna3F1ZXVlJyk6CiAgICAgICAgICAgIF9ERUZBVUxUX1NFTEVDVE9SID0gS3F1ZXVlU2VsZWN0b3IKICAgICAgICBlbGlmIF9jYW5fYWxsb2NhdGUoJ2Vwb2xsJyk6CiAgICAgICAgICAgIF9ERUZBVUxUX1NFTEVDVE9SID0gRXBvbGxTZWxlY3RvcgogICAgICAgIGVsaWYgX2Nhbl9hbGxvY2F0ZSgncG9sbCcpOgogICAgICAgICAgICBfREVGQVVMVF9TRUxFQ1RPUiA9IFBvbGxTZWxlY3RvcgogICAgICAgIGVsaWYgaGFzYXR0cihzZWxlY3QsICdzZWxlY3QnKToKICAgICAgICAgICAgX0RFRkFVTFRfU0VMRUNUT1IgPSBTZWxlY3RTZWxlY3RvcgogICAgICAgIGVsc2U6ICAjIFBsYXRmb3JtLXNwZWNpZmljOiBBcHBFbmdpbmUKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignUGxhdGZvcm0gZG9lcyBub3QgaGF2ZSBhIHNlbGVjdG9yJykKICAgIHJldHVybiBfREVGQVVMVF9TRUxFQ1RPUigpCg==
